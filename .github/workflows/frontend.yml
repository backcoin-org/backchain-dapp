name: Frontend CI

on:
  push:
    branches: [main, v69-redesign]
    paths:
      - "pages/**"
      - "modules/**"
      - "app.js"
      - "index.html"
      - "state.js"
      - "config.js"
      - "utils.js"
      - "ui-feedback.js"
      - "dom-elements.js"
      - "styles/**"
      - "vite.config.*"
      - "package.json"
  pull_request:
    branches: [main, v69-redesign]
    paths:
      - "pages/**"
      - "modules/**"
      - "app.js"
      - "index.html"
      - "state.js"
      - "config.js"
      - "utils.js"
      - "ui-feedback.js"
      - "dom-elements.js"
      - "styles/**"
      - "vite.config.*"
      - "package.json"

jobs:
  build:
    name: Build Frontend
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Build frontend
        run: npm run build

      - name: Report build output size
        run: |
          echo "============================================"
          echo "  Frontend Build Report"
          echo "============================================"
          echo ""
          if [ -d "dist" ]; then
            TOTAL_SIZE=$(du -sh dist | cut -f1)
            FILE_COUNT=$(find dist -type f | wc -l)
            echo "Total build size: $TOTAL_SIZE"
            echo "Total files: $FILE_COUNT"
            echo ""
            echo "Largest files:"
            find dist -type f -exec du -h {} + | sort -rh | head -10
          else
            echo "WARNING: dist/ directory not found after build"
            exit 1
          fi
          echo ""
          echo "============================================"
