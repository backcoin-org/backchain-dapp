import{defaultConfig as Lu,createWeb3Modal as Ru}from"https://esm.sh/@web3modal/ethers@5.1.11?bundle";import{initializeApp as _u}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getAuth as Fu,onAuthStateChanged as Mu,signInAnonymously as Du}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import{getFirestore as Ou,collection as Ee,query as Pe,where as Ie,orderBy as ka,getDocs as st,doc as se,getDoc as De,limit as Hu,serverTimestamp as Be,writeBatch as Hn,updateDoc as ma,increment as Ge,setDoc as Ya,Timestamp as pi,addDoc as ia,deleteDoc as Uu,onSnapshot as na}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=a(s);fetch(s.href,r)}})();const Oe={sidebar:document.getElementById("sidebar"),sidebarBackdrop:document.getElementById("sidebar-backdrop"),menuBtn:document.getElementById("menu-btn"),navLinks:document.getElementById("nav-links"),mainContentSections:document.querySelectorAll("main section"),connectButtonDesktop:document.getElementById("connectButtonDesktop"),connectButtonMobile:document.getElementById("connectButtonMobile"),mobileAppDisplay:document.getElementById("mobileAppDisplay"),desktopDisconnected:document.getElementById("desktopDisconnected"),desktopConnectedInfo:document.getElementById("desktopConnectedInfo"),desktopUserAddress:document.getElementById("desktopUserAddress"),desktopUserBalance:document.getElementById("desktopUserBalance"),modalContainer:document.getElementById("modal-container"),toastContainer:document.getElementById("toast-container"),dashboard:document.getElementById("dashboard"),earn:document.getElementById("mine"),store:document.getElementById("store"),rental:document.getElementById("rental"),rewards:document.getElementById("rewards"),actions:document.getElementById("actions"),presale:document.getElementById("presale"),faucet:document.getElementById("faucet"),airdrop:document.getElementById("airdrop"),dao:document.getElementById("dao"),about:document.getElementById("about"),admin:document.getElementById("admin"),tokenomics:document.getElementById("tokenomics"),notary:document.getElementById("notary"),statTotalSupply:document.getElementById("statTotalSupply"),statValidators:document.getElementById("statValidators"),statTotalPStake:document.getElementById("statTotalPStake"),statScarcity:document.getElementById("statScarcity"),statLockedPercentage:document.getElementById("statLockedPercentage"),statUserBalance:document.getElementById("statUserBalance"),statUserPStake:document.getElementById("statUserPStake"),statUserRewards:document.getElementById("statUserRewards")},ju={provider:null,publicProvider:null,web3Provider:null,signer:null,userAddress:null,isConnected:!1,bkcTokenContract:null,ecosystemManagerContract:null,stakingPoolContract:null,buybackMinerContract:null,rewardBoosterContract:null,fortunePoolContract:null,agoraContract:null,notaryContract:null,charityPoolContract:null,rentalManagerContract:null,faucetContract:null,liquidityPoolContract:null,governanceContract:null,bkcTokenContractPublic:null,ecosystemManagerContractPublic:null,stakingPoolContractPublic:null,buybackMinerContractPublic:null,fortunePoolContractPublic:null,agoraContractPublic:null,notaryContractPublic:null,charityPoolContractPublic:null,rentalManagerContractPublic:null,faucetContractPublic:null,currentUserBalance:0n,currentUserNativeBalance:0n,userTotalPStake:0n,userDelegations:[],myBoosters:[],activityHistory:[],totalNetworkPStake:0n,allValidatorsData:[],systemFees:{},systemPStakes:{},boosterDiscounts:{},notaryFee:void 0,notaryMinPStake:void 0},Wu={set(e,t,a){const n=e[t];if(e[t]=a,["currentUserBalance","isConnected","userTotalPStake","totalNetworkPStake"].includes(t)){if(n===a)return!0;window.updateUIState&&window.updateUIState()}return!0}},c=new Proxy(ju,Wu),Gu="modulepreload",Yu=function(e){return"/"+e},fi={},Y=function(t,a,n){let s=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),o=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(a.map(l=>{if(l=Yu(l),l in fi)return;fi[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Gu,d||(p.as="script"),p.crossOrigin="",p.href=l,o&&p.setAttribute("nonce",o),document.head.appendChild(p),d)return new Promise((m,g)=>{p.addEventListener("load",m),p.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return s.then(i=>{for(const o of i||[])o.status==="rejected"&&r(o.reason);return t().catch(r)})};let mi=!1;const b=(e,t="info",a=null)=>{if(!Oe.toastContainer)return;const n={success:{icon:"fa-check-circle",color:"bg-green-600",border:"border-green-400"},error:{icon:"fa-exclamation-triangle",color:"bg-red-600",border:"border-red-400"},info:{icon:"fa-info-circle",color:"bg-blue-600",border:"border-blue-400"},warning:{icon:"fa-exclamation-circle",color:"bg-yellow-600",border:"border-yellow-400"}},s=n[t]||n.info,r=document.createElement("div");r.className=`flex items-center w-full max-w-xs p-4 text-white rounded-lg shadow-lg transition-all duration-500 ease-out 
                       transform translate-x-full opacity-0 
                       ${s.color} border-l-4 ${s.border} mb-3`;let i=`
        <div class="flex items-center flex-1">
            <i class="fa-solid ${s.icon} text-xl mr-3"></i>
            <div class="text-sm font-medium leading-tight">${e}</div>
        </div>
    `;if(a){const o=`https://sepolia.arbiscan.io/tx/${a}`;i+=`<a href="${o}" target="_blank" title="View on Arbiscan" class="ml-3 flex-shrink-0 text-white/80 hover:text-white transition-colors">
                        <i class="fa-solid fa-arrow-up-right-from-square text-sm"></i>
                      </a>`}i+=`<button class="ml-3 text-white/80 hover:text-white transition-colors focus:outline-none" onclick="this.closest('.shadow-lg').remove()">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>`,r.innerHTML=i,Oe.toastContainer.appendChild(r),requestAnimationFrame(()=>{r.classList.remove("translate-x-full","opacity-0"),r.classList.add("translate-x-0","opacity-100")}),setTimeout(()=>{r.classList.remove("translate-x-0","opacity-100"),r.classList.add("translate-x-full","opacity-0"),setTimeout(()=>r.remove(),500)},5e3)},Ye=()=>{if(!Oe.modalContainer)return;const e=document.getElementById("modal-backdrop");if(e){const t=document.getElementById("modal-content");t&&(t.classList.remove("animate-fade-in-up"),t.classList.add("animate-fade-out-down")),e.classList.remove("opacity-100"),e.classList.add("opacity-0"),setTimeout(()=>{Oe.modalContainer.innerHTML=""},300)}},Tn=(e,t="max-w-md",a=!0)=>{var r,i;if(!Oe.modalContainer)return;const s=`
        <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 transition-opacity duration-300 opacity-0">
            <div id="modal-content" class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 w-full ${t} shadow-2xl animate-fade-in-up max-h-[90vh] overflow-y-auto relative">
                <button class="closeModalBtn absolute top-4 right-4 text-zinc-500 hover:text-white text-xl transition-colors focus:outline-none"><i class="fa-solid fa-xmark"></i></button>
                ${e}
            </div>
        </div>
        <style>@keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }@keyframes fade-out-down { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }.animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }.animate-fade-out-down { animation: fade-out-down 0.3s ease-in forwards; }.pulse-gold { animation: pulse-gold 2s infinite; }@keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); } 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); } }@keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }.animate-glow { animation: glow 2s ease-in-out infinite; }@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }.animate-float { animation: float 3s ease-in-out infinite; }@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }.animate-shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }</style>
    `;Oe.modalContainer.innerHTML=s,requestAnimationFrame(()=>{const o=document.getElementById("modal-backdrop");o&&o.classList.remove("opacity-0"),o&&o.classList.add("opacity-100")}),(r=document.getElementById("modal-backdrop"))==null||r.addEventListener("click",o=>{a&&o.target.id==="modal-backdrop"&&Ye()}),(i=document.getElementById("modal-content"))==null||i.querySelectorAll(".closeModalBtn").forEach(o=>{o.addEventListener("click",Ye)})};async function Ku(e,t){if(!window.ethereum){b("MetaMask not detected","error");return}try{const{addresses:a}=await Y(async()=>{const{addresses:r}=await Promise.resolve().then(()=>Mo);return{addresses:r}},void 0),n=(a==null?void 0:a.rewardBooster)||"0x5507F70c71b8e1C694841E214fe8F9Dd7c899448";await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:n,tokenId:e.toString()}}})?b(`${t} NFT #${e} added to wallet!`,"success"):b("NFT not added to wallet","info")}catch(a){console.error("Error adding NFT to wallet:",a),b("Failed to add NFT to wallet","error")}}function Vu(){const e=window.location.origin,t=encodeURIComponent("Check out Backcoin - The Unstoppable DeFi Protocol on Arbitrum! Build your own business. Be Your Own CEO. ðŸš€ #Backcoin #DeFi #Arbitrum #BeYourOwnCEO"),a=`
        <div class="text-center py-2">
            <div class="mb-4">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-full mb-3">
                    <i class="fa-solid fa-share-nodes text-3xl text-amber-400"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">Spread the Word</h2>
                <p class="text-zinc-400 text-sm">Help us grow the unstoppable community!</p>
            </div>

            <!-- Social Share Grid -->
            <div class="grid grid-cols-4 gap-3 mb-5">
                <a href="https://twitter.com/intent/tweet?text=${t}&url=${encodeURIComponent(e)}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-sky-600 border border-zinc-700 hover:border-sky-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-x-twitter text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">Twitter</span>
                </a>
                <a href="https://t.me/share/url?url=${encodeURIComponent(e)}&text=${t}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-blue-600 border border-zinc-700 hover:border-blue-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-telegram text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">Telegram</span>
                </a>
                <a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(e)}&title=Backcoin%20Protocol&summary=${t}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-blue-700 border border-zinc-700 hover:border-blue-600 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-linkedin-in text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">LinkedIn</span>
                </a>
                <a href="https://wa.me/?text=${t}%20${encodeURIComponent(e)}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-green-600 border border-zinc-700 hover:border-green-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-whatsapp text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">WhatsApp</span>
                </a>
            </div>

            <!-- Copy Link Section -->
            <div class="flex items-center gap-2 bg-zinc-800/70 border border-zinc-700 rounded-xl p-2">
                <div class="flex-1 px-3 py-2 bg-black/30 rounded-lg overflow-hidden">
                    <p id="share-url-text" class="text-xs font-mono text-zinc-400 truncate">${e}</p>
                </div>
                <button id="copy-link-btn" onclick="navigator.clipboard.writeText('${e}').then(() => { 
                            document.getElementById('copy-link-btn').innerHTML = '<i class=\\'fa-solid fa-check\\'></i>'; 
                            document.getElementById('copy-link-btn').classList.add('bg-green-600', 'border-green-500');
                            document.getElementById('copy-link-btn').classList.remove('bg-amber-600', 'border-amber-500', 'hover:bg-amber-500');
                            setTimeout(() => { 
                                document.getElementById('copy-link-btn').innerHTML = '<i class=\\'fa-solid fa-copy\\'></i>'; 
                                document.getElementById('copy-link-btn').classList.remove('bg-green-600', 'border-green-500');
                                document.getElementById('copy-link-btn').classList.add('bg-amber-600', 'border-amber-500', 'hover:bg-amber-500');
                            }, 2000); 
                        })" 
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-amber-600 hover:bg-amber-500 border border-amber-500 rounded-lg text-white transition-all duration-300">
                    <i class="fa-solid fa-copy"></i>
                </button>
            </div>

            <!-- Footer -->
            <p class="mt-4 text-[11px] text-zinc-600">
                <i class="fa-solid fa-heart text-red-500 mr-1"></i>
                Thank you for supporting Backcoin!
            </p>
        </div>
    `;Tn(a,"max-w-md")}function qu(){if(document.getElementById("splash-styles"))return;const e=document.createElement("style");e.id="splash-styles",e.textContent=`
        @keyframes splash-in { 0% { opacity:0; transform:scale(0.92) translateY(12px); } 100% { opacity:1; transform:scale(1) translateY(0); } }
        @keyframes splash-out { 0% { opacity:1; transform:scale(1); } 100% { opacity:0; transform:scale(0.95) translateY(-8px); } }
        @keyframes quote-line { 0% { width:0; } 100% { width:100%; } }
        @keyframes letter-in { 0% { opacity:0; transform:translateY(6px); } 100% { opacity:1; transform:translateY(0); } }
        @keyframes splash-progress { 0% { width:0; } 100% { width:100%; } }
        .splash-enter { animation: splash-in 0.6s cubic-bezier(0.16,1,0.3,1) forwards; }
        .splash-exit  { animation: splash-out 0.4s ease-in forwards; }
        .quote-line   { animation: quote-line 2s ease-out 0.4s both; }
        .letter-stagger span { display:inline-block; opacity:0; animation: letter-in 0.3s ease-out both; }
        .splash-bar { height:2px; background:linear-gradient(90deg,#b45309,#f59e0b,#b45309); border-radius:9999px; animation: splash-progress 6s linear forwards; }
    `,document.head.appendChild(e)}function Xu(e="Backchain"){return[...e].map((t,a)=>`<span style="animation-delay:${.6+a*.05}s">${t}</span>`).join("")}function da(e="welcome-splash"){const t=document.getElementById(e);if(!t||t._dismissed)return;t._dismissed=!0;const a=t.querySelector(".splash-enter,.splash-content");a&&(a.classList.remove("splash-enter"),a.classList.add("splash-exit")),t.style.opacity="0",setTimeout(()=>t.remove(),500)}function Ju(){if(mi)return;mi=!0,qu();const e=Xu(),t=document.createElement("div");t.id="welcome-splash",t.className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm cursor-pointer",t.style.opacity="0",t.style.transition="opacity 0.3s ease",t.innerHTML=`
        <div class="splash-enter text-center px-8 max-w-sm">
            <img src="/assets/bkc_logo_3d.png" alt="" class="h-16 w-16 mx-auto rounded-full mb-5 ring-1 ring-amber-500/30 shadow-lg shadow-amber-500/20">

            <p class="text-3xl font-black text-white tracking-wide letter-stagger mb-1">${e}</p>
            <p class="text-zinc-500 text-[11px] uppercase tracking-[0.25em] mb-6">Unstoppable DeFi</p>

            <div class="relative mb-6">
                <div class="h-px bg-gradient-to-r from-transparent via-amber-500/40 to-transparent quote-line"></div>
                <p class="text-zinc-400 text-sm italic mt-4 leading-relaxed">
                    "I may not agree with what you say, but I will defend to the death your right to say it."
                </p>
                <p class="text-amber-500/70 text-xs font-semibold mt-2">â€” Voltaire</p>
                <div class="h-px bg-gradient-to-r from-transparent via-amber-500/40 to-transparent mt-4 quote-line"></div>
            </div>

            <p class="text-zinc-600 text-[10px] uppercase tracking-widest">
                No admin keys &bull; No pause &bull; No blacklists
            </p>

            <div class="w-48 mt-8 mx-auto bg-zinc-800/60 rounded-full overflow-hidden">
                <div class="splash-bar"></div>
            </div>
        </div>
    `,document.body.appendChild(t),requestAnimationFrame(()=>{t.style.opacity="1"}),t.addEventListener("click",()=>da()),setTimeout(()=>da(),6500)}const Zu=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";console.log(`Environment: ${Zu?"DEVELOPMENT":"PRODUCTION"}`);const er="ZWla0YY4A0Hw7e_rwyOXB",Se={chainId:"0x66eee",chainIdDecimal:421614,chainName:"Arbitrum Sepolia",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.arbiscan.io"],rpcUrls:[`https://arb-sepolia.g.alchemy.com/v2/${er}`,"https://arbitrum-sepolia.blockpi.network/v1/rpc/public","https://arbitrum-sepolia-rpc.publicnode.com"]},kt=[{name:"Alchemy",url:`https://arb-sepolia.g.alchemy.com/v2/${er}`,priority:1,isPublic:!1,corsCompatible:!0},{name:"BlockPI",url:"https://arbitrum-sepolia.blockpi.network/v1/rpc/public",priority:2,isPublic:!0,corsCompatible:!0},{name:"PublicNode",url:"https://arbitrum-sepolia-rpc.publicnode.com",priority:3,isPublic:!0,corsCompatible:!0},{name:"Arbitrum Official",url:"https://sepolia-rollup.arbitrum.io/rpc",priority:4,isPublic:!0,corsCompatible:!1}].filter(e=>e.url!==null),tr=`https://arb-sepolia.g.alchemy.com/v2/${er}`;let et=0,Da=new Map;function ga(){var e;return((e=kt[et])==null?void 0:e.url)||tr}function ar(){const e=et;do{et=(et+1)%kt.length;const a=kt[et];if(!a.corsCompatible){console.warn(`â­ï¸ Skipping ${a.name} (CORS incompatible)`);continue}if(et===e)return console.warn("âš ï¸ All RPCs have been tried. Resetting to primary."),et=0,kt[0].url}while(Da.get(kt[et].url)==="unhealthy");const t=kt[et];return console.log(`ðŸ”„ Switched to RPC: ${t.name}`),t.url}function Io(e){Da.set(e,"unhealthy"),console.warn(`âŒ RPC marked unhealthy: ${e}`),setTimeout(()=>{Da.delete(e),console.log(`â™»ï¸ RPC health reset: ${e}`)},6e4)}function Ao(e){Da.set(e,"healthy")}function Po(){et=0,Da.clear(),console.log(`âœ… Reset to primary RPC: ${kt[0].name}`)}const Bo="https://gateway.lighthouse.storage/ipfs/",Cn=["https://dweb.link/ipfs/","https://w3s.link/ipfs/","https://nftstorage.link/ipfs/","https://cloudflare-ipfs.com/ipfs/","https://ipfs.io/ipfs/"],y={},M={bkcToken:null,backchainEcosystem:null,stakingPool:null,buybackMiner:null,rewardBooster:null,nftPoolFactory:null,fortunePool:null,agora:null,notary:null,charityPool:null,rentalManager:null,liquidityPool:null,faucet:null,backchainGovernance:null,treasuryWallet:null};async function So(){try{const e=await fetch(`./deployment-addresses.json?t=${Date.now()}`);if(!e.ok)throw new Error(`Failed to fetch deployment-addresses.json: ${e.status}`);const t=await e.json(),a=["bkcToken","backchainEcosystem","stakingPool","buybackMiner"];if(!a.every(s=>t[s]||t[gi(s)])){const s=a.filter(r=>!t[r]&&!t[gi(r)]);throw new Error(`Missing required addresses: ${s.join(", ")}`)}return y.bkcToken=t.bkcToken,y.backchainEcosystem=t.backchainEcosystem||t.ecosystemManager,y.stakingPool=t.stakingPool||t.delegationManager,y.buybackMiner=t.buybackMiner||t.miningManager,y.rewardBooster=t.rewardBooster||t.rewardBoosterNFT,y.nftPoolFactory=t.nftPoolFactory||t.nftLiquidityPoolFactory,y.fortunePool=t.fortunePool||t.fortunePoolV2,y.agora=t.agora||t.backchat,y.notary=t.notary||t.decentralizedNotary,y.charityPool=t.charityPool,y.rentalManager=t.rentalManager,y.liquidityPool=t.liquidityPool,y.faucet=t.faucet||t.simpleBkcFaucet,y.backchainGovernance=t.backchainGovernance,y.treasuryWallet=t.treasuryWallet,y.pool_bronze=t.pool_bronze,y.pool_silver=t.pool_silver,y.pool_gold=t.pool_gold,y.pool_diamond=t.pool_diamond,Object.assign(M,y),console.log("âœ… V9 contract addresses loaded"),console.log("   Ecosystem:",y.backchainEcosystem),console.log("   StakingPool:",y.stakingPool),console.log("   Agora:",y.agora),console.log("   FortunePool:",y.fortunePool),!0}catch(e){return console.error("âŒ Failed to load contract addresses:",e),!1}}function gi(e){return{backchainEcosystem:"ecosystemManager",stakingPool:"delegationManager",buybackMiner:"miningManager",rewardBooster:"rewardBoosterNFT",nftPoolFactory:"nftLiquidityPoolFactory",agora:"backchat",notary:"decentralizedNotary"}[e]||e}const Te=[{name:"Diamond",boostBips:5e3,burnRate:0,keepRate:100,color:"text-cyan-400",emoji:"ðŸ’Ž",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq",borderColor:"border-cyan-400/50",glowColor:"bg-cyan-500/10",bgGradient:"from-cyan-500/20 to-blue-500/20"},{name:"Gold",boostBips:4e3,burnRate:10,keepRate:90,color:"text-amber-400",emoji:"ðŸ¥‡",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44",borderColor:"border-amber-400/50",glowColor:"bg-amber-500/10",bgGradient:"from-amber-500/20 to-yellow-500/20"},{name:"Silver",boostBips:2500,burnRate:25,keepRate:75,color:"text-gray-300",emoji:"ðŸ¥ˆ",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4",borderColor:"border-gray-400/50",glowColor:"bg-gray-500/10",bgGradient:"from-gray-400/20 to-zinc-500/20"},{name:"Bronze",boostBips:1e3,burnRate:40,keepRate:60,color:"text-yellow-600",emoji:"ðŸ¥‰",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m",borderColor:"border-yellow-600/50",glowColor:"bg-yellow-600/10",bgGradient:"from-yellow-600/20 to-orange-600/20"}];function zo(e){const t=[...Te].sort((a,n)=>n.boostBips-a.boostBips);for(const a of t)if(e>=a.boostBips)return a;return null}function No(e){return e>=5e3?0:e>=4e3?10:e>=2500?25:e>=1e3?40:50}function ut(e){return 100-No(e)}const Un=["function name() view returns (string)","function symbol() view returns (string)","function decimals() view returns (uint8)","function totalSupply() view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function transferFrom(address from, address to, uint256 amount) returns (bool)","function MAX_SUPPLY() view returns (uint256)","function TGE_SUPPLY() view returns (uint256)","function totalBurned() view returns (uint256)","function mintableRemaining() view returns (uint256)","function totalMinted() view returns (uint256)","event Transfer(address indexed from, address indexed to, uint256 value)","event Approval(address indexed owner, address indexed spender, uint256 value)"],jn=["function totalPStake() view returns (uint256)","function totalBkcDelegated() view returns (uint256)","function userTotalPStake(address _user) view returns (uint256)","function pendingRewards(address _user) view returns (uint256)","function savedRewards(address _user) view returns (uint256)","function MIN_LOCK_DAYS() view returns (uint256)","function MAX_LOCK_DAYS() view returns (uint256)","function REFERRER_CUT_BPS() view returns (uint256)","function forceUnstakePenaltyBps() view returns (uint256)","function getDelegationsOf(address _user) view returns (tuple(uint128 amount, uint128 pStake, uint64 lockEnd, uint64 lockDays, uint256 rewardDebt)[])","function getDelegation(address _user, uint256 _index) view returns (uint256 amount, uint256 pStake, uint256 lockEnd, uint256 lockDays, uint256 pendingReward)","function delegationCount(address _user) view returns (uint256)","function delegate(uint256 _amount, uint256 _lockDays, address _operator) external payable","function unstake(uint256 _index) external","function forceUnstake(uint256 _index, address _operator) external payable","function claimRewards(address _operator) external payable","function claimRewards() external","function getUserBestBoost(address _user) view returns (uint256)","function getBurnRateForBoost(uint256 _boostBps) pure returns (uint256)","function getTierName(uint256 _boostBps) pure returns (string)","function previewClaim(address _user) view returns (uint256 totalRewards, uint256 burnAmount, uint256 referrerCut, uint256 userReceives, uint256 burnRateBps, uint256 nftBoost)","function getStakingStats() view returns (uint256 totalPStake, uint256 totalBkcDelegated, uint256 totalRewardsDistributed, uint256 totalBurnedOnClaim, uint256 totalForceUnstakePenalties, uint256 totalEthFeesCollected, uint256 accRewardPerShare)","function getUserSummary(address _user) view returns (uint256 userTotalPStake, uint256 delegationCount, uint256 savedRewards, uint256 totalPending, uint256 nftBoost, uint256 burnRateBps)","event Delegated(address indexed user, uint256 indexed delegationIndex, uint256 amount, uint256 pStake, uint256 lockDays, address operator)","event Unstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned)","event ForceUnstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned, uint256 penaltyBurned, address operator)","event RewardsClaimed(address indexed user, uint256 totalRewards, uint256 burnedAmount, uint256 userReceived, uint256 cutAmount, address cutRecipient, uint256 nftBoostUsed, address operator)","event TokensBurnedOnClaim(address indexed user, uint256 burnedAmount, uint256 burnRateBps, uint256 totalBurnedAllTime)"],Ea=["function listNFT(uint256 tokenId, uint96 pricePerHour, uint16 minHours, uint16 maxHours) external","function updateListing(uint256 tokenId, uint96 pricePerHour, uint16 minHours, uint16 maxHours) external","function withdrawNFT(uint256 tokenId) external","function rentNFT(uint256 tokenId, uint256 hours_, address operator) external payable","function withdrawEarnings() external","function getListing(uint256 tokenId) view returns (address owner, uint96 pricePerHour, uint16 minHours, uint16 maxHours, uint96 totalEarnings, uint32 rentalCount, bool currentlyRented, uint48 rentalEndTime)","function getRental(uint256 tokenId) view returns (address tenant, uint48 endTime, bool isActive)","function isRented(uint256 tokenId) view returns (bool)","function getRemainingTime(uint256 tokenId) view returns (uint256)","function hasActiveRental(address user) view returns (bool)","function getUserBestBoost(address user) view returns (uint256)","function pendingEarnings(address owner) view returns (uint256)","function userActiveRental(address user) view returns (uint256)","function getAllListedTokenIds() view returns (uint256[])","function getListingCount() view returns (uint256)","function getRentalCost(uint256 tokenId, uint256 hours_) view returns (uint256 rentalCost, uint256 ethFee, uint256 totalCost)","function getStats() view returns (uint256 activeListings, uint256 volume, uint256 rentals, uint256 ethFees, uint256 earningsWithdrawn)","event NFTListed(uint256 indexed tokenId, address indexed owner, uint96 pricePerHour, uint16 minHours, uint16 maxHours)","event ListingUpdated(uint256 indexed tokenId, uint96 pricePerHour, uint16 minHours, uint16 maxHours)","event NFTRented(uint256 indexed tokenId, address indexed tenant, address indexed owner, uint256 hours_, uint256 rentalCost, uint256 ethFee, uint48 endTime, address operator)","event NFTWithdrawn(uint256 indexed tokenId, address indexed owner)","event EarningsWithdrawn(address indexed owner, uint256 amount)"],nr=["function buyNFT(uint256 maxBkcPrice, address operator) external payable returns (uint256 tokenId)","function buySpecificNFT(uint256 tokenId, uint256 maxBkcPrice, address operator) external payable","function sellNFT(uint256 tokenId, uint256 minPayout, address operator) external payable","function getBuyPrice() view returns (uint256)","function getSellPrice() view returns (uint256)","function getTotalBuyCost() view returns (uint256 bkcCost, uint256 ethCost)","function getTotalSellInfo() view returns (uint256 bkcPayout, uint256 ethCost)","function getEthFees() view returns (uint256 buyFee, uint256 sellFee)","function getSpread() view returns (uint256 spread, uint256 spreadBips)","function getPoolInfo() view returns (uint256 bkcBalance, uint256 nftCount, uint256 k, bool initialized, uint8 tier)","function getAvailableNFTs() view returns (uint256[])","function isNFTInPool(uint256 tokenId) view returns (bool)","function bkcBalance() view returns (uint256)","function nftCount() view returns (uint256)","function tier() view returns (uint8)","function initialized() view returns (bool)","function getTierName() view returns (string)","function getStats() view returns (uint256 volume, uint256 buys, uint256 sells, uint256 ethFees)","function totalVolume() view returns (uint256)","function totalBuys() view returns (uint256)","function totalSells() view returns (uint256)","function totalEthFees() view returns (uint256)","event NFTPurchased(address indexed buyer, uint256 indexed tokenId, uint256 price, uint256 ethFee, uint256 newNftCount, address operator)","event NFTSold(address indexed seller, uint256 indexed tokenId, uint256 payout, uint256 ethFee, uint256 newNftCount, address operator)"],Wn=["function commitPlay(bytes32 _commitHash, uint256 _wagerAmount, uint8 _tierMask, address _operator) external payable returns (uint256 gameId)","function revealPlay(uint256 _gameId, uint256[] calldata _guesses, bytes32 _userSecret) external returns (uint256 prizeWon)","function claimExpired(uint256 _gameId) external","function fundPrizePool(uint256 _amount) external","function generateCommitHash(uint256[] calldata _guesses, bytes32 _userSecret) pure returns (bytes32)","function TIER_COUNT() view returns (uint8)","function BKC_FEE_BPS() view returns (uint256)","function MAX_PAYOUT_BPS() view returns (uint256)","function REVEAL_DELAY() view returns (uint256)","function REVEAL_WINDOW() view returns (uint256)","function POOL_CAP() view returns (uint256)","function getTierInfo(uint8 _tier) pure returns (uint256 range, uint256 multiplier, uint256 winChanceBps)","function getAllTiers() pure returns (uint256[3] ranges, uint256[3] multipliers, uint256[3] winChances)","function getGame(uint256 _gameId) view returns (address player, uint48 commitBlock, uint8 tierMask, uint8 status, address operator, uint96 wagerAmount)","function getGameResult(uint256 _gameId) view returns (address player, uint128 grossWager, uint128 prizeWon, uint8 tierMask, uint8 matchCount, uint48 revealBlock)","function getGameStatus(uint256 _gameId) view returns (uint8 status, bool canReveal, uint256 blocksUntilReveal, uint256 blocksUntilExpiry)","function activeGame(address _player) view returns (uint256)","function getRequiredFee(uint8 _tierMask) view returns (uint256 fee)","function calculatePotentialWinnings(uint256 _wagerAmount, uint8 _tierMask) view returns (uint256 netToPool, uint256 bkcFee, uint256 maxPrize, uint256 maxPrizeAfterCap)","function gameCounter() view returns (uint256)","function prizePool() view returns (uint256)","function getPoolStats() view returns (uint256 prizePool, uint256 totalGamesPlayed, uint256 totalBkcWagered, uint256 totalBkcWon, uint256 totalBkcForfeited, uint256 totalBkcBurned, uint256 maxPayoutNow)","event GameCommitted(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint8 tierMask, address operator)","event GameRevealed(uint256 indexed gameId, address indexed player, uint256 grossWager, uint256 prizeWon, uint8 tierMask, uint8 matchCount, address operator)","event GameDetails(uint256 indexed gameId, uint8 tierMask, uint256[] guesses, uint256[] rolls, bool[] matches)","event GameExpired(uint256 indexed gameId, address indexed player, uint256 forfeitedAmount)","event PrizePoolFunded(address indexed funder, uint256 amount)","event PoolExcessBurned(uint256 amount, uint256 newTotalBurned)"],$o=["function balanceOf(address _owner) view returns (uint256)","function ownerOf(uint256 _tokenId) view returns (address)","function approve(address _to, uint256 _tokenId) external","function setApprovalForAll(address _operator, bool _approved) external","function transferFrom(address _from, address _to, uint256 _tokenId) external","function safeTransferFrom(address _from, address _to, uint256 _tokenId) external","function totalSupply() view returns (uint256)","function getUserBestBoost(address _user) view returns (uint256)","function getTokenInfo(uint256 _tokenId) view returns (address owner, uint8 tier, uint256 boostBips)","function getUserTokens(address _user) view returns (uint256[] tokenIds, uint8[] tiers)","function getTierBoost(uint8 _tier) pure returns (uint256)","function getTierName(uint8 _tier) pure returns (string)","event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)","event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId)"],Gn=["function certify(bytes32 _documentHash, string _meta, uint8 _docType, address _operator) external payable returns (uint256 certId)","function batchCertify(bytes32[] _documentHashes, string[] _metas, uint8[] _docTypes, address _operator) external payable returns (uint256 startId)","function transferCertificate(bytes32 _documentHash, address _newOwner) external","function verify(bytes32 _documentHash) view returns (bool exists, address owner, uint48 timestamp, uint8 docType, string meta)","function getCertificate(uint256 _certId) view returns (bytes32 documentHash, address owner, uint48 timestamp, uint8 docType, string meta)","function getFee() view returns (uint256)","function getStats() view returns (uint256 certCount, uint256 totalEthCollected)","function certCount() view returns (uint256)","function totalEthCollected() view returns (uint256)","function MAX_BATCH_SIZE() view returns (uint8)","event Certified(uint256 indexed certId, address indexed owner, bytes32 indexed documentHash, uint8 docType, address operator)","event BatchCertified(address indexed owner, uint256 startId, uint256 count, address operator)","event CertificateTransferred(bytes32 indexed documentHash, address indexed from, address indexed to)"],Yn=["function claim() external","function canClaim(address user) view returns (bool)","function getCooldownRemaining(address user) view returns (uint256)","function getUserInfo(address user) view returns (uint256 lastClaim, uint256 claims, bool eligible, uint256 cooldownLeft)","function getFaucetStatus() view returns (uint256 ethBalance, uint256 tokenBalance, uint256 ethPerDrip, uint256 tokensPerDrip, uint256 estimatedEthClaims, uint256 estimatedTokenClaims)","function getStats() view returns (uint256 tokens, uint256 eth, uint256 claims, uint256 users)","function cooldown() view returns (uint256)","function tokensPerClaim() view returns (uint256)","function ethPerClaim() view returns (uint256)","function paused() view returns (bool)","event Claimed(address indexed recipient, uint256 tokens, uint256 eth, address indexed via)"],Qt=["function calculateFee(bytes32 _actionId, uint256 _txValue) view returns (uint256)","function bkcToken() view returns (address)","function treasury() view returns (address)","function buybackAccumulated() view returns (uint256)","function referredBy(address _user) view returns (address)","function referralCount(address _referrer) view returns (uint256)","function setReferrer(address _referrer) external","function setReferrerFor(address _user, address _referrer) external","function referralRelayer() view returns (address)","function referralBps() view returns (uint16)","event ReferrerSet(address indexed user, address indexed referrer)","event ReferralRelayerUpdated(address indexed oldRelayer, address indexed newRelayer)","event ReferralBpsUpdated(uint16 newBps)","function totalEthCollected() view returns (uint256)","function totalBkcCollected() view returns (uint256)","function totalFeeEvents() view returns (uint256)","function getStats() view returns (uint256 ethCollected, uint256 bkcCollected, uint256 feeEvents, uint256 buybackEth, uint256 moduleCount)","function isAuthorized(address _contract) view returns (bool)","function moduleCount() view returns (uint256)","function pendingEth(address account) view returns (uint256)","function withdrawEth() external","function getModuleConfig(bytes32 _moduleId) view returns (bool active, uint16 customBps, uint16 operatorBps, uint16 treasuryBps, uint16 buybackBps)","event FeeCollected(bytes32 indexed moduleId, address indexed user, address operator, address customRecipient, uint256 ethAmount, uint256 bkcAmount)","event EthDistributed(bytes32 indexed moduleId, uint256 toReferrer, uint256 toCustom, uint256 toOperator, uint256 toTreasury, uint256 toBuyback)","event EthWithdrawn(address indexed recipient, uint256 amount)"],Kn=["function executeBuyback() external","function executeBuybackWithSlippage(uint256 _minTotalBkcOut) external","function MAX_SUPPLY() view returns (uint256)","function MAX_MINTABLE() view returns (uint256)","function CALLER_BPS() view returns (uint256)","function BURN_BPS() view returns (uint256)","function liquidityPool() view returns (address)","function owner() view returns (address)","function currentMiningRate() view returns (uint256 rateBps)","function pendingBuybackETH() view returns (uint256)","function getSupplyInfo() view returns (uint256 currentSupply, uint256 maxSupply, uint256 totalMintedViaMining, uint256 remainingMintable, uint256 miningRateBps, uint256 totalBurnedLifetime)","function previewBuyback() view returns (uint256 ethAvailable, uint256 estimatedBkcPurchased, uint256 estimatedBkcMined, uint256 estimatedBurn, uint256 estimatedToStakers, uint256 estimatedCallerReward, uint256 currentMiningRateBps, bool isReady)","function previewMiningAtSupply(uint256 _supplyLevel, uint256 _purchaseAmount) pure returns (uint256 miningAmount, uint256 rateBps)","function getBuybackStats() view returns (uint256 totalBuybacks, uint256 totalEthSpent, uint256 totalBkcPurchased, uint256 totalBkcMined, uint256 totalBkcBurned, uint256 totalBkcToStakers, uint256 totalCallerRewards, uint256 avgEthPerBuyback, uint256 avgBkcPerBuyback)","function getLastBuyback() view returns (uint256 timestamp, uint256 blockNumber, address caller, uint256 ethSpent, uint256 bkcTotal, uint256 timeSinceLast)","function totalBuybacks() view returns (uint256)","function totalEthSpent() view returns (uint256)","function totalBkcPurchased() view returns (uint256)","function totalBkcMined() view returns (uint256)","function totalBkcBurned() view returns (uint256)","function totalBkcToStakers() view returns (uint256)","function totalCallerRewards() view returns (uint256)","event BuybackExecuted(address indexed caller, uint256 indexed buybackNumber, uint256 callerReward, uint256 ethSpent, uint256 bkcPurchased, uint256 bkcMined, uint256 bkcBurned, uint256 bkcToStakers, uint256 miningRateBps)"],Vn=["function createCampaign(string title, string metadataUri, uint96 goal, uint256 durationDays, address operator) external payable returns (uint256)","function donate(uint256 campaignId, address operator) external payable","function boostCampaign(uint256 campaignId, address operator) external payable","function closeCampaign(uint256 campaignId) external","function withdraw(uint256 campaignId) external","function getCampaign(uint256 campaignId) view returns (address owner, uint48 deadline, uint8 status, uint96 raised, uint96 goal, uint32 donorCount, bool isBoosted, string title, string metadataUri)","function canWithdraw(uint256 campaignId) view returns (bool)","function titles(uint256 campaignId) view returns (string)","function metadataUris(uint256 campaignId) view returns (string)","function campaignCount() view returns (uint256)","function previewDonation(uint256 amount) view returns (uint256 fee, uint256 netToCampaign)","function getStats() view returns (uint256 campaignCount, uint256 totalDonated, uint256 totalWithdrawn, uint256 totalEthFees)","event CampaignCreated(uint256 indexed campaignId, address indexed owner, uint96 goal, uint48 deadline, address operator)","event DonationMade(uint256 indexed campaignId, address indexed donor, uint256 grossAmount, uint256 netAmount, address operator)","event CampaignBoosted(uint256 indexed campaignId, address indexed booster, uint48 boostExpiry, address operator)","event CampaignClosed(uint256 indexed campaignId, address indexed owner, uint96 raised)","event FundsWithdrawn(uint256 indexed campaignId, address indexed owner, uint96 amount)"],ea=["function createPost(string contentHash, uint8 tag, uint8 contentType, address operator) external payable","function createReply(uint256 parentId, string contentHash, uint8 contentType, address operator) external payable","function createRepost(uint256 originalId, string contentHash, address operator) external payable","function deletePost(uint256 postId) external","function changeTag(uint256 postId, uint8 newTag) external","function like(uint256 postId, address operator) external payable","function superLike(uint256 postId, address operator) external payable","function downvote(uint256 postId, address operator) external payable","function follow(address user, address operator) external payable","function unfollow(address user) external","function reportPost(uint256 postId, uint8 category) external payable","function hasReported(uint256 postId, address user) view returns (bool)","function reportCount(uint256 postId) view returns (uint256)","function boostPost(uint256 postId, uint8 tier, address operator) external payable","function tipPost(uint256 postId, address operator) external payable","function createProfile(string username, string metadataURI, address operator) external payable","function updateProfile(string metadataURI) external","function pinPost(uint256 postId) external","function boostProfile(address operator) external payable","function obtainBadge(uint8 tier, address operator) external payable","function VOTE_PRICE() view returns (uint256)","function TAG_COUNT() view returns (uint8)","function REPORT_PRICE() view returns (uint256)","function MIN_TIP() view returns (uint256)","function PROFILE_BOOST_PRICE() view returns (uint256)","function BOOST_TIER_COUNT() view returns (uint8)","function BADGE_TIER_COUNT() view returns (uint8)","function postCounter() view returns (uint256)","function totalProfiles() view returns (uint256)","function getPost(uint256 postId) view returns (address author, uint8 tag, uint8 contentType, bool deleted, uint32 createdAt, uint256 replyTo, uint256 repostOf, uint256 likes, uint256 superLikes, uint256 downvotes, uint256 replies, uint256 reposts)","function getPostMeta(uint256 postId) view returns (uint256 reports, uint256 illegalReports, uint8 boostTier, uint64 boostExp, bool isBoosted, uint256 boostSpent, uint256 tips)","function getUserProfile(address user) view returns (bytes32 usernameHash, string metadataURI, uint256 pinned, bool boosted, bool hasBadge, uint8 badgeTier, uint64 boostExp, uint64 badgeExp)","function isProfileBoosted(address user) view returns (bool)","function hasTrustBadge(address user) view returns (bool)","function isPostBoosted(uint256 postId) view returns (bool)","function isUsernameAvailable(string username) view returns (bool)","function getUsernamePrice(uint256 length) pure returns (uint256)","function getBoostPrice(uint8 tier) pure returns (uint256)","function getBadgePrice(uint8 tier) pure returns (uint256)","function hasLiked(uint256 postId, address user) view returns (bool)","function getOperatorStats(address operator) view returns (uint256 posts_, uint256 engagement)","function getGlobalStats() view returns (uint256 totalPosts, uint256 totalProfiles, uint256[15] tagCounts)","function version() pure returns (string)","event PostCreated(uint256 indexed postId, address indexed author, uint8 tag, uint8 contentType, string contentHash, address operator)","event ReplyCreated(uint256 indexed postId, uint256 indexed parentId, address indexed author, uint8 tag, uint8 contentType, string contentHash, address operator)","event RepostCreated(uint256 indexed postId, uint256 indexed originalId, address indexed author, uint8 tag, string contentHash, address operator)","event PostDeleted(uint256 indexed postId, address indexed author)","event TagChanged(uint256 indexed postId, uint8 oldTag, uint8 newTag)","event Liked(uint256 indexed postId, address indexed liker, address indexed author, address operator)","event SuperLiked(uint256 indexed postId, address indexed voter, address indexed author, uint256 count, address operator)","event Downvoted(uint256 indexed postId, address indexed voter, address indexed author, uint256 count, address operator)","event Followed(address indexed follower, address indexed followed, address operator)","event Unfollowed(address indexed follower, address indexed followed)","event PostReported(uint256 indexed postId, address indexed reporter, address indexed author, uint8 category, uint256 totalReports)","event PostBoosted(uint256 indexed postId, address indexed booster, uint8 tier, uint256 amount, uint64 newExpiry, address operator)","event PostTipped(uint256 indexed postId, address indexed tipper, address indexed author, uint256 amount, address operator)","event ProfileCreated(address indexed user, string username, string metadataURI, address operator)","event ProfileUpdated(address indexed user, string metadataURI)","event ProfileBoosted(address indexed user, uint256 daysAdded, uint64 expiresAt, address operator)","event BadgeObtained(address indexed user, uint8 tier, uint64 expiresAt, address operator)"];let bi=0;const Qu=5e3;async function Lo(){try{return window.ethereum?await window.ethereum.request({method:"eth_chainId"})===Se.chainId:!1}catch(e){return console.warn("Network check failed:",e.message),!1}}async function ba(){if(!window.ethereum)return console.warn("MetaMask not detected"),!1;try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:Se.chainId,chainName:Se.chainName,nativeCurrency:Se.nativeCurrency,rpcUrls:Se.rpcUrls,blockExplorerUrls:Se.blockExplorerUrls}]}),console.log("âœ… MetaMask network config updated"),!0}catch(e){return e.code===4001?(console.log("User rejected network update"),!1):(console.warn("Could not update MetaMask network:",e.message),!1)}}async function Ro(){if(!window.ethereum)return console.warn("MetaMask not detected"),!1;try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:Se.chainId}]}),console.log("âœ… Switched to Arbitrum Sepolia"),!0}catch(e){return e.code===4902?(console.log("ðŸ”„ Network not found, adding..."),await ba()):e.code===4001?(console.log("User rejected network switch"),!1):(console.error("Network switch error:",e),!1)}}async function Oa(){var e;if(!window.ethereum)return{healthy:!1,reason:"no_provider"};try{const t=new window.ethers.BrowserProvider(window.ethereum),a=new Promise((s,r)=>setTimeout(()=>r(new Error("timeout")),5e3)),n=t.getBlockNumber();return await Promise.race([n,a]),{healthy:!0}}catch(t){const a=((e=t==null?void 0:t.message)==null?void 0:e.toLowerCase())||"";return a.includes("timeout")?{healthy:!1,reason:"timeout"}:a.includes("too many")||a.includes("rate limit")||a.includes("-32002")?{healthy:!1,reason:"rate_limited"}:a.includes("failed to fetch")||a.includes("network")?{healthy:!1,reason:"network_error"}:{healthy:!1,reason:"unknown",error:a}}}async function _o(){const e=Date.now();if(e-bi<Qu)return{success:!0,skipped:!0};if(bi=e,!window.ethereum)return{success:!1,error:"MetaMask not detected"};try{if(!await Lo()&&(console.log("ðŸ”„ Wrong network detected, switching..."),!await Ro()))return{success:!1,error:"Please switch to Arbitrum Sepolia network"};const a=await Oa();if(!a.healthy&&(console.log(`âš ï¸ RPC unhealthy (${a.reason}), updating MetaMask config...`),await ba())){await new Promise(r=>setTimeout(r,1e3));const s=await Oa();return s.healthy?{success:!0,fixed:!0}:{success:!1,error:"Network is congested. Please try again in a moment.",rpcReason:s.reason}}return{success:!0}}catch(t){return console.error("Network config error:",t),{success:!1,error:t.message}}}function Fo(e){window.ethereum&&window.ethereum.on("chainChanged",async t=>{console.log("ðŸ”„ Network changed to:",t);const a=t===Se.chainId;e&&e({chainId:t,isCorrectNetwork:a,needsSwitch:!a})})}const Mo=Object.freeze(Object.defineProperty({__proto__:null,IPFS_GATEWAYS:Cn,METAMASK_NETWORK_CONFIG:Se,RPC_ENDPOINTS:kt,addresses:y,agoraABI:ea,bkcTokenABI:Un,boosterTiers:Te,buybackMinerABI:Kn,charityPoolABI:Vn,checkRpcHealth:Oa,contractAddresses:M,ecosystemManagerABI:Qt,ensureCorrectNetworkConfig:_o,faucetABI:Yn,fortunePoolABI:Wn,getBurnRateFromBoost:No,getCurrentRpcUrl:ga,getKeepRateFromBoost:ut,getTierByBoost:zo,ipfsGateway:Bo,isCorrectNetwork:Lo,loadAddresses:So,markRpcHealthy:Ao,markRpcUnhealthy:Io,nftPoolABI:nr,notaryABI:Gn,rentalManagerABI:Ea,resetToPrimaryRpc:Po,rewardBoosterABI:$o,sepoliaRpcUrl:tr,setupNetworkChangeListener:Fo,stakingPoolABI:jn,switchToCorrectNetwork:Ro,switchToNextRpc:ar,updateMetaMaskNetwork:ba},Symbol.toStringTag,{value:"Module"})),Do=window.ethers,ep=5e3,tp=6e4,ap=3e4,np=3e4,sp=6e4;let ys=null,xi=0;const hi=new Map,ks=new Map,vi=new Map,wi=e=>new Promise(t=>setTimeout(t,e));async function qn(e,t){const a=new AbortController,n=setTimeout(()=>a.abort(),t);try{const s=await fetch(e,{signal:a.signal});return clearTimeout(n),s}catch(s){throw clearTimeout(n),s.name==="AbortError"?new Error("API request timed out."):s}}const rt={getHistory:"https://gethistory-4wvdcuoouq-uc.a.run.app",getBoosters:"https://getboosters-4wvdcuoouq-uc.a.run.app",getSystemData:"https://getsystemdata-4wvdcuoouq-uc.a.run.app",getNotaryHistory:"https://getnotaryhistory-4wvdcuoouq-uc.a.run.app",getRentalListings:"https://getrentallistings-4wvdcuoouq-uc.a.run.app",getUserRentals:"https://getuserrentals-4wvdcuoouq-uc.a.run.app",fortuneGames:"https://getfortunegames-4wvdcuoouq-uc.a.run.app",uploadFileToIPFS:"/api/upload",claimAirdrop:"https://us-central1-airdropbackchainnew.cloudfunctions.net/claimAirdrop"};function Oo(e){var t;return((t=e==null?void 0:e.error)==null?void 0:t.code)===429||(e==null?void 0:e.code)===429||e.message&&(e.message.includes("429")||e.message.includes("Too Many Requests")||e.message.includes("rate limit"))}function Ho(e){var a,n;const t=((a=e==null?void 0:e.error)==null?void 0:a.code)||(e==null?void 0:e.code);return t===-32603||t===-32e3||((n=e.message)==null?void 0:n.includes("Internal JSON-RPC"))}function Xn(e,t,a){if(a)return a;if(!e||!c.publicProvider)return null;try{return new Do.Contract(e,t,c.publicProvider)}catch{return null}}const oe=async(e,t,a=[],n=0n,s=2,r=!1)=>{if(!e)return n;const i=e.target||e.address,o=JSON.stringify(a,(p,m)=>typeof m=="bigint"?m.toString():m),l=`${i}-${t}-${o}`,d=Date.now(),u=["getPoolInfo","getBuyPrice","getSellPrice","getAvailableTokenIds","getAllListedTokenIds","tokenURI","tokenTier","getTokenInfo","getListing","balanceOf","totalSupply","totalPStake","MAX_SUPPLY","TGE_SUPPLY","userTotalPStake","pendingRewards","isRented","getRental","ownerOf","getDelegationsOf","allowance","getPoolStats","getAllTiers","getUserSummary","getUserBestBoost"];if(!r&&u.includes(t)){const p=hi.get(l);if(p&&d-p.timestamp<ap)return p.value}for(let p=0;p<=s;p++)try{const m=await e[t](...a);return u.includes(t)&&hi.set(l,{value:m,timestamp:d}),m}catch(m){if(Oo(m)&&p<s){const g=Math.floor(Math.random()*1e3),x=1e3*Math.pow(2,p)+g;await wi(x);continue}if(Ho(m)&&p<s){await wi(500);continue}break}return n},rp=async(e,t,a=!1)=>{const n=`balance-${(e==null?void 0:e.target)||(e==null?void 0:e.address)}-${t}`,s=Date.now();if(!a){const i=vi.get(n);if(i&&s-i.timestamp<sp)return i.value}const r=await oe(e,"balanceOf",[t],0n,2,a);return vi.set(n,{value:r,timestamp:s}),r};async function Uo(){c.systemFees||(c.systemFees={}),c.systemPStakes||(c.systemPStakes={}),c.boosterDiscounts||(c.boosterDiscounts={});const e=Date.now();if(ys&&e-xi<tp)return yi(ys),!0;try{const t=await qn(rt.getSystemData,ep);if(!t.ok)throw new Error(`API Status: ${t.status}`);const a=await t.json();return yi(a),ys=a,xi=e,!0}catch{return c.systemFees.NOTARY_SERVICE||(c.systemFees.NOTARY_SERVICE=100n),c.systemFees.CLAIM_REWARD_FEE_BIPS||(c.systemFees.CLAIM_REWARD_FEE_BIPS=500n),!1}}function yi(e){if(e.fees)for(const t in e.fees)try{c.systemFees[t]=BigInt(e.fees[t])}catch{c.systemFees[t]=0n}if(e.pStakeRequirements)for(const t in e.pStakeRequirements)try{c.systemPStakes[t]=BigInt(e.pStakeRequirements[t])}catch{c.systemPStakes[t]=0n}if(e.discounts)for(const t in e.discounts)try{c.boosterDiscounts[t]=BigInt(e.discounts[t])}catch{c.boosterDiscounts[t]=0n}if(e.oracleFeeInWei){c.systemData=c.systemData||{};try{c.systemData.oracleFeeInWei=BigInt(e.oracleFeeInWei)}catch{c.systemData.oracleFeeInWei=0n}}}async function jo(){!c.publicProvider||!c.bkcTokenContractPublic||await Promise.allSettled([oe(c.bkcTokenContractPublic,"totalSupply",[],0n),Uo()])}async function Jn(e=!1){var t,a,n;if(!(!c.isConnected||!c.userAddress))try{const s=(a=(t=c.bkcTokenContractPublic)==null?void 0:t.runner)==null?void 0:a.provider,[r,i]=await Promise.allSettled([rp(c.bkcTokenContractPublic||c.bkcTokenContract,c.userAddress,e),(n=s||c.provider)==null?void 0:n.getBalance(c.userAddress)]);r.status==="fulfilled"&&(c.currentUserBalance=r.value),i.status==="fulfilled"&&(c.currentUserNativeBalance=i.value),await Ot(e);const o=c.stakingPoolContractPublic||c.stakingPoolContract;if(o){const l=await oe(o,"userTotalPStake",[c.userAddress],0n,2,e);c.userTotalPStake=l}}catch(s){console.error("Error loading user data:",s)}}async function ip(e=!1){const t=c.stakingPoolContractPublic||c.stakingPoolContract;if(!c.isConnected||!t)return[];try{const a=await oe(t,"getDelegationsOf",[c.userAddress],[],2,e);return c.userDelegations=a.map((n,s)=>({amount:n.amount||n[0]||0n,pStake:n.pStake||n[1]||0n,lockEnd:Number(n.lockEnd||n[2]||0),lockDays:Number(n.lockDays||n[3]||0),rewardDebt:n.rewardDebt||n[4]||0n,unlockTime:BigInt(n.lockEnd||n[2]||0),lockDuration:BigInt(n.lockDays||n[3]||0)*86400n,index:s})),c.userDelegations}catch(a){return console.error("Error loading delegations:",a),[]}}async function Wo(e=!1){let t=[];try{const n=await qn(rt.getRentalListings,4e3);n.ok&&(t=await n.json())}catch{}if(t&&t.length>0){const n=t.map(s=>{var i,o,l,d,u;const r=Te.find(p=>p.boostBips===Number(s.boostBips||0));return{...s,tokenId:((i=s.tokenId)==null?void 0:i.toString())||((o=s.id)==null?void 0:o.toString()),pricePerHour:((l=s.pricePerHour)==null?void 0:l.toString())||((d=s.price)==null?void 0:d.toString())||"0",totalEarnings:((u=s.totalEarnings)==null?void 0:u.toString())||"0",rentalCount:Number(s.rentalCount||0),img:(r==null?void 0:r.img)||"./assets/nft.png",name:(r==null?void 0:r.name)||"Booster NFT"}});return c.rentalListings=n,n}const a=Xn(y.rentalManager,Ea,c.rentalManagerContractPublic);if(!a)return c.rentalListings=[],[];try{const n=await oe(a,"getAllListedTokenIds",[],[],2,!0);if(!n||n.length===0)return c.rentalListings=[],[];const r=n.slice(0,30).map(async l=>{var d,u,p,m,g,x;try{const h=await oe(a,"getListing",[l],null,1,!0);if(h&&h.owner!==Do.ZeroAddress){const C=await oe(a,"getRental",[l],null,1,!0),T=await Yo(l),A=Math.floor(Date.now()/1e3),B=C&&BigInt(C.endTime||0)>BigInt(A);return{tokenId:l.toString(),owner:h.owner,pricePerHour:((d=h.pricePerHour)==null?void 0:d.toString())||((u=h.price)==null?void 0:u.toString())||"0",minHours:((p=h.minHours)==null?void 0:p.toString())||"1",maxHours:((m=h.maxHours)==null?void 0:m.toString())||"1",totalEarnings:((g=h.totalEarnings)==null?void 0:g.toString())||"0",rentalCount:Number(h.rentalCount||0),boostBips:T.boostBips,img:T.img||"./assets/nft.png",name:T.name,isRented:B,currentTenant:B?C.tenant:null,rentalEndTime:B?(x=C.endTime)==null?void 0:x.toString():null}}}catch{}return null}),o=(await Promise.all(r)).filter(l=>l!==null);return c.rentalListings=o,o}catch{return c.rentalListings=[],[]}}async function op(e=!1){var a,n;if(!c.userAddress)return c.myRentals=[],[];try{const s=await qn(`${rt.getUserRentals}/${c.userAddress}`,4e3);if(s.ok){const i=(await s.json()).map(o=>{const l=Te.find(d=>d.boostBips===Number(o.boostBips||0));return{...o,img:(l==null?void 0:l.img)||"./assets/nft.png",name:(l==null?void 0:l.name)||"Booster NFT"}});return c.myRentals=i,i}}catch{}const t=Xn(y.rentalManager,Ea,c.rentalManagerContractPublic);if(!t)return c.myRentals=[],[];try{const s=await oe(t,"getAllListedTokenIds",[],[],2,e),r=[],i=Math.floor(Date.now()/1e3);for(const o of s.slice(0,30))try{const l=await oe(t,"getRental",[o],null,1,e);if(l&&((a=l.tenant)==null?void 0:a.toLowerCase())===c.userAddress.toLowerCase()&&(l.isActive||BigInt(l.endTime||0)>BigInt(i))){const d=await Yo(o);r.push({tokenId:o.toString(),tenant:l.tenant,endTime:((n=l.endTime)==null?void 0:n.toString())||"0",isActive:l.isActive,boostBips:d.boostBips,img:d.img,name:d.name})}}catch{}return c.myRentals=r,r}catch{return c.myRentals=[],[]}}let sn=null,ki=0;const lp=3e4;async function Go(e=!1){const t=Date.now();if(!e&&sn&&t-ki<lp)return sn;await Ot(e);let a=0,n=null,s="none";if(c.myBoosters&&c.myBoosters.length>0){const l=c.myBoosters.reduce((d,u)=>u.boostBips>d.boostBips?u:d,c.myBoosters[0]);l.boostBips>a&&(a=l.boostBips,n=l.tokenId,s="owned")}if(c.myRentals&&c.myRentals.length>0){const l=c.myRentals.reduce((d,u)=>u.boostBips>d.boostBips?u:d,c.myRentals[0]);l.boostBips>a&&(a=l.boostBips,n=l.tokenId,s="rented")}const r=Te.find(l=>l.boostBips===a),i=(r==null?void 0:r.image)||(r==null?void 0:r.realImg)||(r==null?void 0:r.img)||"assets/bkc_logo_3d.png",o=r!=null&&r.name?`${r.name} Booster`:s!=="none"?"Booster NFT":"None";return sn={highestBoost:a,boostName:o,imageUrl:i,tokenId:n?n.toString():null,source:s},ki=Date.now(),sn}async function Yo(e){const t=["function getTokenInfo(uint256) view returns (address owner, uint8 tier, uint256 boostBips)","function tokenTier(uint256) view returns (uint8)"],a=Xn(y.rewardBooster,t,c.rewardBoosterContractPublic);if(!a)return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"};try{const n=await oe(a,"getTokenInfo",[e],null);if(n){const s=Number(n.boostBips||n[2]||0),r=Te.find(i=>i.boostBips===s);return{boostBips:s,img:(r==null?void 0:r.image)||(r==null?void 0:r.img)||"./assets/nft.png",name:(r==null?void 0:r.name)||`Booster #${e}`}}return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"}}catch{return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"}}}async function sr(){const e=c.stakingPoolContractPublic||c.stakingPoolContract;if(!c.isConnected||!e)return{stakingRewards:0n,minerRewards:0n,totalRewards:0n};try{const t=await oe(e,"pendingRewards",[c.userAddress],0n);return{stakingRewards:t,minerRewards:0n,totalRewards:t}}catch{return{stakingRewards:0n,minerRewards:0n,totalRewards:0n}}}async function cp(){const e=c.stakingPoolContractPublic||c.stakingPoolContract;if(!e||!c.userAddress)return{netClaimAmount:0n,feeAmount:0n,discountPercent:0,totalRewards:0n,burnRateBps:0,nftBoost:0};const{totalRewards:t}=await sr();if(t===0n)return{netClaimAmount:0n,feeAmount:0n,discountPercent:0,totalRewards:0n,burnRateBps:0,nftBoost:0};try{const a=await oe(e,"previewClaim",[c.userAddress],null);if(a){const n=a.totalRewards||a[0]||0n,s=a.burnAmount||a[1]||0n,r=a.referrerCut||a[2]||0n,i=a.userReceives||a[3]||0n,o=Number(a.burnRateBps||a[4]||0),l=Number(a.nftBoost||a[5]||0),d=s+r;return console.log("[Data] V9 Claim preview:",{totalRewards:Number(n)/1e18,burnAmount:Number(s)/1e18,referrerCut:Number(r)/1e18,userReceives:Number(i)/1e18,burnRateBps:o,nftBoost:l}),{netClaimAmount:i,feeAmount:d,burnAmount:s,referrerCut:r,discountPercent:l/100,totalRewards:n,burnRateBps:o,nftBoost:l,baseFeeBips:5e3,finalFeeBips:o}}}catch(a){console.error("[Data] previewClaim error:",a)}return{netClaimAmount:t,feeAmount:0n,discountPercent:0,totalRewards:t,burnRateBps:0,nftBoost:0}}let Es=!1,Ts=0,rn=0;const dp=3e4,up=3,pp=12e4;async function Ot(e=!1){if(!c.userAddress)return[];const t=Date.now();if(Es)return c.myBoosters||[];if(!e&&t-Ts<dp)return c.myBoosters||[];if(rn>=up){if(t-Ts<pp)return c.myBoosters||[];rn=0}Es=!0,Ts=t;try{const a=await qn(`${rt.getBoosters}/${c.userAddress}`,5e3);if(!a.ok)throw new Error(`API Error: ${a.status}`);let n=await a.json();const s=["function ownerOf(uint256) view returns (address)","function getTokenInfo(uint256) view returns (address owner, uint8 tier, uint256 boostBips)"],r=Xn(y.rewardBooster,s,c.rewardBoosterContractPublic);if(r&&n.length>0){const i=await Promise.all(n.slice(0,50).map(async o=>{const l=BigInt(o.tokenId),d=`ownerOf-${l}`,u=Date.now();let p=Number(o.boostBips||o.boost||0);if(p===0)try{const m=await r.getTokenInfo(l);p=Number(m.boostBips||m[2]||0)}catch{}if(!e&&ks.has(d)){const m=ks.get(d);if(u-m.timestamp<np)return m.owner.toLowerCase()===c.userAddress.toLowerCase()?{tokenId:l,boostBips:p,imageUrl:o.imageUrl||o.image||null}:null}try{const m=await r.ownerOf(l);return ks.set(d,{owner:m,timestamp:u}),m.toLowerCase()===c.userAddress.toLowerCase()?{tokenId:l,boostBips:p,imageUrl:o.imageUrl||o.image||null}:null}catch(m){return Oo(m)||Ho(m)?{tokenId:l,boostBips:p,imageUrl:o.imageUrl||o.image||null}:null}}));c.myBoosters=i.filter(o=>o!==null)}else c.myBoosters=n.map(i=>({tokenId:BigInt(i.tokenId),boostBips:Number(i.boostBips||i.boost||0),imageUrl:i.imageUrl||i.image||null}));return rn=0,c.myBoosters}catch{return rn++,c.myBoosters||(c.myBoosters=[]),c.myBoosters}finally{Es=!1}}const fp={apiKey:"AIzaSyDKhF2_--fKtot96YPS8twuD0UoCpS-3T4",authDomain:"airdropbackchainnew.firebaseapp.com",projectId:"airdropbackchainnew",storageBucket:"airdropbackchainnew.appspot.com",messagingSenderId:"108371799661",appId:"1:108371799661:web:d126fcbd0ba56263561964",measurementId:"G-QD9EBZ0Y09"},Ko=_u(fp),on=Fu(Ko),U=Ou(Ko);let vt=null,_e=null,ln=null;async function Vo(e){if(!e)throw new Error("Wallet address is required for Firebase sign-in.");const t=e.toLowerCase();return _e=t,vt?(ln=await Na(t),vt):on.currentUser?(vt=on.currentUser,ln=await Na(t),vt):new Promise((a,n)=>{const s=Mu(on,async r=>{if(s(),r){vt=r;try{ln=await Na(t),a(r)}catch(i){console.error("Error linking airdrop user profile:",i),n(i)}}else Du(on).then(async i=>{vt=i.user,ln=await Na(t),a(vt)}).catch(i=>{console.error("Firebase Anonymous sign-in failed:",i),n(i)})},r=>{console.error("Firebase Auth state change error:",r),s(),n(r)})})}function gt(){if(!vt)throw new Error("User not authenticated with Firebase. Please sign-in first.");if(!_e)throw new Error("Wallet address not set. Please connect wallet first.")}async function rr(){const e=se(U,"airdrop_public_data","data_v1"),t=await De(e);if(t.exists()){const a=t.data(),n=(a.dailyTasks||[]).map(i=>{var d,u;const o=(d=i.startDate)!=null&&d.toDate?i.startDate.toDate():i.startDate?new Date(i.startDate):null,l=(u=i.endDate)!=null&&u.toDate?i.endDate.toDate():i.endDate?new Date(i.endDate):null;return{...i,id:i.id||null,startDate:o instanceof Date&&!isNaN(o)?o:null,endDate:l instanceof Date&&!isNaN(l)?l:null}}).filter(i=>i.id),s=Date.now(),r=n.filter(i=>{const o=i.startDate?i.startDate.getTime():0,l=i.endDate?i.endDate.getTime():1/0;return o<=s&&s<l});return{config:a.config||{ugcBasePoints:{}},leaderboards:a.leaderboards||{top100ByPoints:[],top100ByPosts:[],lastUpdated:null},dailyTasks:r,platformUsageConfig:a.platformUsageConfig||null}}else return console.warn("Public airdrop data document 'airdrop_public_data/data_v1' not found. Returning defaults."),{config:{isActive:!1,roundName:"Loading...",ugcBasePoints:{}},leaderboards:{top100ByPoints:[],top100ByPosts:[],lastUpdated:null},dailyTasks:[],platformUsageConfig:null}}function Ei(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let a=0;a<6;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function In(e){return e>=100?10:e>=90?9:e>=80?8:e>=70?7:e>=60?6:e>=50?5:e>=40?4:e>=30?3:e>=20?2:1}async function Na(e){gt(),e||(e=_e);const t=e.toLowerCase(),a=se(U,"airdrop_users",t),n=await De(a);if(n.exists()){const s=n.data(),r={};if(s.referralCode||(r.referralCode=Ei()),typeof s.approvedSubmissionsCount!="number"&&(r.approvedSubmissionsCount=0),typeof s.rejectedCount!="number"&&(r.rejectedCount=0),typeof s.isBanned!="boolean"&&(r.isBanned=!1),typeof s.totalPoints!="number"&&(r.totalPoints=0),typeof s.pointsMultiplier!="number"&&(r.pointsMultiplier=1),s.walletAddress!==t&&(r.walletAddress=t),Object.keys(r).length>0)try{return await ma(a,r),{id:n.id,...s,...r}}catch(i){return console.error("Error updating user default fields:",i),{id:n.id,...s}}return{id:n.id,...s}}else{const s=Ei(),r={walletAddress:t,referralCode:s,totalPoints:0,pointsMultiplier:1,approvedSubmissionsCount:0,rejectedCount:0,isBanned:!1,createdAt:Be()};return await Ya(a,r),{id:a.id,...r,createdAt:new Date}}}async function qo(e,t){if(gt(),!e||typeof e!="string"||e.trim()==="")return console.warn(`isTaskEligible called with invalid taskId: ${e}`),{eligible:!1,timeLeft:0};const a=se(U,"airdrop_users",_e,"task_claims",e),n=await De(a),s=t*60*60*1e3;if(!n.exists())return{eligible:!0,timeLeft:0};const r=n.data(),i=r==null?void 0:r.timestamp;if(typeof i!="string"||i.trim()==="")return console.warn(`Missing/invalid timestamp for task ${e}. Allowing claim.`),{eligible:!0,timeLeft:0};try{const o=new Date(i);if(isNaN(o.getTime()))return console.warn(`Invalid timestamp format for task ${e}:`,i,". Allowing claim."),{eligible:!0,timeLeft:0};const l=o.getTime(),u=Date.now()-l;return u>=s?{eligible:!0,timeLeft:0}:{eligible:!1,timeLeft:s-u}}catch(o){return console.error(`Error parsing timestamp string for task ${e}:`,i,o),{eligible:!0,timeLeft:0}}}async function mp(e,t){if(gt(),!e||!e.id)throw new Error("Invalid task data provided.");if(!(await qo(e.id,e.cooldownHours)).eligible)throw new Error("Cooldown period is still active for this task.");const n=se(U,"airdrop_users",_e),s=Math.round(e.points);if(isNaN(s)||s<0)throw new Error("Invalid points value for the task.");await ma(n,{totalPoints:Ge(s)});const r=se(U,"airdrop_users",_e,"task_claims",e.id);return await Ya(r,{timestamp:new Date().toISOString(),points:s}),s}async function gp(e){var o;const t=e.trim().toLowerCase();let a="Other",n=!0;if(t.includes("youtube.com/shorts/")){a="YouTube Shorts";const l=t.match(/\/shorts\/([a-zA-Z0-9_-]+)/);if(!l||!l[1])throw n=!1,new Error("Invalid YouTube Shorts URL: Video ID not found or incorrect format.")}else if(t.includes("youtube.com/watch?v=")||t.includes("youtu.be/")){a="YouTube";const l=t.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})(?:[?&]|$)/);if(!l||l[1].length!==11)throw n=!1,new Error("Invalid YouTube URL: Video ID not found or incorrect format.")}else{if(t.includes("youtube.com/"))throw a="YouTube",n=!1,new Error("Invalid YouTube URL: Only video links (youtube.com/watch?v=... or youtu.be/...) or Shorts links are accepted.");if(t.includes("instagram.com/p/")||t.includes("instagram.com/reel/")){a="Instagram";const l=t.match(/\/(?:p|reel)\/([a-zA-Z0-9_.-]+)/);(!l||!l[1])&&(n=!1)}else t.includes("twitter.com/")||t.includes("x.com/")?t.match(/(\w+)\/(?:status|statuses)\/(\d+)/)&&(a="X/Twitter"):t.includes("facebook.com/")&&t.includes("/posts/")?a="Facebook":t.includes("t.me/")||t.includes("telegram.org/")?a="Telegram":t.includes("tiktok.com/")?a="TikTok":t.includes("reddit.com/r/")?a="Reddit":t.includes("linkedin.com/posts/")&&(a="LinkedIn")}const r=((o=(await rr()).config)==null?void 0:o.ugcBasePoints)||{},i=r[a]||r.Other||1e3;if(isNaN(i)||i<0)throw new Error(`Invalid base points configured for platform: ${a}. Please contact admin.`);return{platform:a,basePoints:i,isValid:n,normalizedUrl:t}}async function bp(e){var q;gt();const t=se(U,"airdrop_users",_e),a=Ee(U,"airdrop_users",_e,"submissions"),n=Ee(U,"all_submissions_log"),s=e.trim();if(!s||!s.toLowerCase().startsWith("http://")&&!s.toLowerCase().startsWith("https://"))throw new Error("The provided URL must start with http:// or https://.");let r;try{r=await gp(s)}catch(H){throw H}const{platform:i,basePoints:o,isValid:l,normalizedUrl:d}=r;if(!l)throw new Error(`The provided URL for ${i} does not appear valid for submission.`);const u=Pe(a,ka("submittedAt","desc"),Hu(1)),p=await st(u);if(!p.empty){const re=(q=p.docs[0].data().submittedAt)==null?void 0:q.toDate();if(re){const X=new Date,W=5*60*1e3,pe=X.getTime()-re.getTime();if(pe<W){const je=W-pe,Lt=Math.ceil(je/6e4);throw new Error(`We're building a strong community, and we value quality over quantity. To prevent spam, please wait ${Lt} more minute(s) before submitting another post. We appreciate your thoughtful contribution!`)}}}const m=Pe(n,Ie("normalizedUrl","==",d),Ie("status","in",["pending","approved","auditing","flagged_suspicious"]));if(!(await st(m)).empty)throw new Error("This content link has already been submitted. Repeatedly submitting duplicate or fraudulent content may lead to account suspension.");const x=await De(t);if(!x.exists())throw new Error("User profile not found.");const h=x.data(),C=h.approvedSubmissionsCount||0,T=In(C),A=Math.round(o*T),B=Be(),z={url:s,platform:i,status:"pending",basePoints:o,_pointsCalculated:A,_multiplierApplied:T,pointsAwarded:0,submittedAt:B,resolvedAt:null},S={userId:_e,walletAddress:h.walletAddress,normalizedUrl:d,platform:i,status:"pending",basePoints:o,submittedAt:B,resolvedAt:null},I=Hn(U),R=se(a);I.set(R,z);const D=se(n,R.id);I.set(D,S),await I.commit()}async function xp(){gt();const e=Ee(U,"airdrop_users",_e,"submissions"),t=Pe(e,ka("submittedAt","desc"));return(await st(t)).docs.map(n=>{var r,i;const s=n.data();return{submissionId:n.id,...s,submittedAt:(r=s.submittedAt)!=null&&r.toDate?s.submittedAt.toDate():null,resolvedAt:(i=s.resolvedAt)!=null&&i.toDate?s.resolvedAt.toDate():null}})}async function hp(e){gt();const t=_e,a=se(U,"airdrop_users",t),n=se(U,"airdrop_users",t,"submissions",e),s=se(U,"all_submissions_log",e),r=await De(n);if(!r.exists())throw new Error("Cannot confirm submission: Document not found or already processed.");const i=r.data(),o=i.status;if(o==="approved"||o==="rejected")throw new Error(`Submission is already in status: ${o}.`);let l=i._pointsCalculated,d=i._multiplierApplied;if(typeof l!="number"||isNaN(l)||l<=0){console.warn(`[ConfirmSubmission] Legacy/Invalid submission ${e} missing/invalid _pointsCalculated. Recalculating...`);const p=i.basePoints||0,m=await De(a);if(!m.exists())throw new Error("User profile not found for recalculation.");const x=m.data().approvedSubmissionsCount||0;d=In(x),l=Math.round(p*d),(isNaN(l)||l<=0)&&(console.warn(`[ConfirmSubmission] Recalculation failed (basePoints: ${p}). Using fallback 1000.`),l=Math.round(1e3*d))}const u=Hn(U);u.update(a,{totalPoints:Ge(l),approvedSubmissionsCount:Ge(1)}),u.update(n,{status:"approved",pointsAwarded:l,_pointsCalculated:l,_multiplierApplied:d,resolvedAt:Be()}),await De(s).then(p=>p.exists())&&u.update(s,{status:"approved",resolvedAt:Be()}),await u.commit()}async function Xo(e){gt();const a=se(U,"airdrop_users",_e,"submissions",e),n=se(U,"all_submissions_log",e),s=await De(a);if(!s.exists())return console.warn(`Delete submission skipped: Document ${e} not found.`);const r=s.data().status;if(r==="approved"||r==="rejected")throw new Error(`This submission was already ${r} and cannot be deleted.`);if(r==="flagged_suspicious")throw new Error("Flagged submissions must be resolved, not deleted.");const i=Hn(U);i.update(a,{status:"deleted_by_user",resolvedAt:Be()}),await De(n).then(o=>o.exists())&&i.update(n,{status:"deleted_by_user",resolvedAt:Be(),pointsAwarded:0}),await i.commit()}async function vp(e){const t=se(U,"airdrop_public_data","data_v1");await Ya(t,{config:{ugcBasePoints:e}},{merge:!0})}async function wp(){const e=Ee(U,"daily_tasks"),t=Pe(e,ka("endDate","asc"));return(await st(t)).docs.map(n=>{var s,r;return{id:n.id,...n.data(),startDate:(s=n.data().startDate)!=null&&s.toDate?n.data().startDate.toDate():null,endDate:(r=n.data().endDate)!=null&&r.toDate?n.data().endDate.toDate():null}})}async function yp(e){const t={...e};t.startDate instanceof Date&&(t.startDate=pi.fromDate(t.startDate)),t.endDate instanceof Date&&(t.endDate=pi.fromDate(t.endDate));const a=e.id;if(!a)delete t.id,await ia(Ee(U,"daily_tasks"),t);else{const n=se(U,"daily_tasks",a);delete t.id,await Ya(n,t,{merge:!0})}}async function kp(e){if(!e)throw new Error("Task ID is required for deletion.");await Uu(se(U,"daily_tasks",e))}async function Ep(){const e=Ee(U,"all_submissions_log"),t=Pe(e,Ie("status","in",["pending","auditing","flagged_suspicious"]),ka("submittedAt","desc"));return(await st(t)).docs.map(n=>{var r,i;const s=n.data();return{userId:s.userId,walletAddress:s.walletAddress,submissionId:n.id,...s,submittedAt:(r=s.submittedAt)!=null&&r.toDate?s.submittedAt.toDate():null,resolvedAt:(i=s.resolvedAt)!=null&&i.toDate?s.resolvedAt.toDate():null}})}async function Jo(e,t,a){var T,A,B;if(!e)throw new Error("User ID (walletAddress) is required.");const n=e.toLowerCase(),s=se(U,"airdrop_users",n),r=se(U,"airdrop_users",n,"submissions",t),i=se(U,"all_submissions_log",t),[o,l,d]=await Promise.all([De(s),De(r),De(i)]);if(!l.exists())throw new Error("Submission not found in user collection.");if(!o.exists())throw new Error("User profile not found.");d.exists()||console.warn(`Log entry ${t} not found. Log will not be updated.`);const u=l.data(),p=o.data(),m=u.status;if(m===a){console.warn(`Admin action ignored: Submission ${t} already has status ${a}.`);return}const g=Hn(U),x={};let h=0,C=u._multiplierApplied||0;if(a==="approved"){let z=u._pointsCalculated;if(typeof z!="number"||isNaN(z)||z<=0){console.warn(`[Admin] Legacy/Invalid submission ${t} missing/invalid _pointsCalculated. Recalculating...`);const S=u.basePoints||0,I=p.approvedSubmissionsCount||0,R=In(I);if(z=Math.round(S*R),isNaN(z)||z<=0){console.warn(`[Admin] Recalculation failed (basePoints: ${S}). Using fallback 1000.`);const D=In(I);z=Math.round(1e3*D)}C=R}h=z,x.totalPoints=Ge(z),x.approvedSubmissionsCount=Ge(1),m==="rejected"&&(x.rejectedCount=Ge(-1))}else if(a==="rejected"){if(m!=="rejected"){const z=p.rejectedCount||0;x.rejectedCount=Ge(1),z+1>=3&&(x.isBanned=!0)}else if(m==="approved"){const z=u.pointsAwarded||0;x.totalPoints=Ge(-z),x.approvedSubmissionsCount=Ge(-1);const S=p.rejectedCount||0;x.rejectedCount=Ge(1),S+1>=3&&(x.isBanned=!0)}h=0}if(((T=x.approvedSubmissionsCount)==null?void 0:T.operand)<0&&(p.approvedSubmissionsCount||0)<=0&&(x.approvedSubmissionsCount=0),((A=x.rejectedCount)==null?void 0:A.operand)<0&&(p.rejectedCount||0)<=0&&(x.rejectedCount=0),((B=x.totalPoints)==null?void 0:B.operand)<0){const z=p.totalPoints||0,S=Math.abs(x.totalPoints.operand);z<S&&(x.totalPoints=0)}Object.keys(x).length>0&&g.update(s,x),g.update(r,{status:a,pointsAwarded:h,_pointsCalculated:a==="approved"?h:u._pointsCalculated||0,_multiplierApplied:C,resolvedAt:Be()}),d.exists()&&g.update(i,{status:a,resolvedAt:Be()}),await g.commit()}async function Tp(){const e=Ee(U,"airdrop_users"),t=Pe(e,ka("totalPoints","desc"));return(await st(t)).docs.map(n=>({id:n.id,...n.data()}))}async function Cp(e,t){if(!e)throw new Error("User ID is required.");const a=e.toLowerCase(),n=Ee(U,"airdrop_users",a,"submissions"),s=Pe(n,Ie("status","==",t),ka("resolvedAt","desc"));return(await st(s)).docs.map(i=>{var o,l;return{submissionId:i.id,userId:a,...i.data(),submittedAt:(o=i.data().submittedAt)!=null&&o.toDate?i.data().submittedAt.toDate():null,resolvedAt:(l=i.data().resolvedAt)!=null&&l.toDate?i.data().resolvedAt.toDate():null}})}async function Zo(e,t){if(!e)throw new Error("User ID is required.");const a=e.toLowerCase(),n=se(U,"airdrop_users",a),s={isBanned:t};t===!1&&(s.rejectedCount=0),await ma(n,s)}async function Ti(){gt();try{const e=Ee(U,"airdrop_users",_e,"platform_usage"),t=await st(e),a={};return t.forEach(n=>{a[n.id]=n.data()}),a}catch(e){return console.error("Error fetching platform usage:",e),{}}}async function Qo(e){gt();const t=se(U,"airdrop_public_data","data_v1");await ma(t,{platformUsageConfig:e}),console.log("âœ… Platform usage config saved:",e)}const G=window.ethers,el=421614,Ip="0x66eee";let Ve=null,Ci=0,wt=0;const Ap=5e3,Ii=3,Pp=6e4;let ir=0;const Bp=3;let tl=null;const Sp="cd4bdedee7a7e909ebd3df8bbc502aed",zp={chainId:Se.chainIdDecimal,name:Se.chainName,currency:Se.nativeCurrency.symbol,explorerUrl:Se.blockExplorerUrls[0],rpcUrl:Se.rpcUrls[0]},Np={name:"Backcoin Protocol",description:"DeFi Ecosystem",url:window.location.origin,icons:[window.location.origin+"/assets/bkc_logo_3d.png"]},$p=Lu({metadata:Np,enableEIP6963:!0,enableInjected:!0,enableCoinbase:!1,rpcUrl:tr,defaultChainId:el,enableEmail:!0,enableEns:!1,auth:{email:!0,showWallets:!0,walletFeatures:!0}}),Mt=Ru({ethersConfig:$p,chains:[zp],projectId:Sp,enableAnalytics:!0,themeMode:"dark",themeVariables:{"--w3m-accent":"#f59e0b","--w3m-border-radius-master":"1px","--w3m-z-index":100}});function Lp(e){var n,s;const t=((n=e==null?void 0:e.message)==null?void 0:n.toLowerCase())||"",a=(e==null?void 0:e.code)||((s=e==null?void 0:e.error)==null?void 0:s.code);return a===-32603||a===-32e3||a===429||t.includes("failed to fetch")||t.includes("network error")||t.includes("timeout")||t.includes("rate limit")||t.includes("too many requests")||t.includes("internal json-rpc")||t.includes("unexpected token")||t.includes("<html")}function Rs(e){return new G.JsonRpcProvider(e||ga())}async function al(e,t=Bp){var n;let a=null;for(let s=0;s<t;s++)try{const r=await e();return Ao(ga()),ir=0,r}catch(r){if(a=r,Lp(r)){console.warn(`âš ï¸ RPC error (attempt ${s+1}/${t}):`,(n=r.message)==null?void 0:n.slice(0,80)),Io(ga());const i=ar();console.log(`ðŸ”„ Switching to: ${i}`),await Zn(),await new Promise(o=>setTimeout(o,500*(s+1)))}else throw r}throw console.error("âŒ All RPC attempts failed"),a}async function Zn(){const e=ga();try{c.publicProvider=Rs(e),tl=c.publicProvider;const t=c.publicProvider;K(y.bkcToken)&&(c.bkcTokenContractPublic=new G.Contract(y.bkcToken,Un,t)),K(y.backchainEcosystem)&&(c.ecosystemManagerContractPublic=new G.Contract(y.backchainEcosystem,Qt,t)),K(y.stakingPool)&&(c.stakingPoolContractPublic=new G.Contract(y.stakingPool,jn,t)),K(y.buybackMiner)&&(c.buybackMinerContractPublic=new G.Contract(y.buybackMiner,Kn,t)),K(y.fortunePool)&&(c.fortunePoolContractPublic=new G.Contract(y.fortunePool,Wn,t)),K(y.agora)&&(c.agoraContractPublic=new G.Contract(y.agora,ea,t)),K(y.notary)&&(c.notaryContractPublic=new G.Contract(y.notary,Gn,t)),K(y.charityPool)&&(c.charityPoolContractPublic=new G.Contract(y.charityPool,Vn,t)),K(y.rentalManager)&&(c.rentalManagerContractPublic=new G.Contract(y.rentalManager,Ea,t)),K(y.faucet)&&(c.faucetContractPublic=new G.Contract(y.faucet,Yn,t)),console.log(`âœ… Public provider recreated with: ${e.slice(0,50)}...`)}catch(t){console.error("Failed to recreate public provider:",t)}}function Rp(e){if(!e)return!1;try{return G.isAddress(e)}catch{return!1}}function K(e){return e&&e!==G.ZeroAddress&&!e.startsWith("0x...")}function _p(e){if(!e)return;const t=localStorage.getItem(`balance_${e.toLowerCase()}`);if(t)try{c.currentUserBalance=BigInt(t),window.updateUIState&&window.updateUIState()}catch{}}function Fp(e){try{const t=e;K(y.bkcToken)&&(c.bkcTokenContract=new G.Contract(y.bkcToken,Un,t)),K(y.backchainEcosystem)&&(c.ecosystemManagerContract=new G.Contract(y.backchainEcosystem,Qt,t)),K(y.stakingPool)&&(c.stakingPoolContract=new G.Contract(y.stakingPool,jn,t)),K(y.buybackMiner)&&(c.buybackMinerContract=new G.Contract(y.buybackMiner,Kn,t)),K(y.rewardBooster)&&(c.rewardBoosterContract=new G.Contract(y.rewardBooster,$o,t)),K(y.fortunePool)&&(c.fortunePoolContract=new G.Contract(y.fortunePool,Wn,t)),K(y.agora)&&(c.agoraContract=new G.Contract(y.agora,ea,t)),K(y.notary)&&(c.notaryContract=new G.Contract(y.notary,Gn,t)),K(y.charityPool)&&(c.charityPoolContract=new G.Contract(y.charityPool,Vn,t)),K(y.rentalManager)&&(c.rentalManagerContract=new G.Contract(y.rentalManager,Ea,t)),K(y.faucet)&&(c.faucetContract=new G.Contract(y.faucet,Yn,t))}catch{console.warn("Contract init partial failure")}}function nl(){if(Ve&&(clearInterval(Ve),Ve=null),!c.bkcTokenContractPublic||!c.userAddress){console.warn("Cannot start balance polling: missing contract or address");return}wt=0,ir=0,setTimeout(()=>{Ai()},1e3),Ve=setInterval(Ai,Pp),console.log("âœ… Balance polling started (60s interval)")}async function Ai(){var t;if(document.hidden||!c.isConnected||!c.userAddress||!c.bkcTokenContractPublic)return;const e=Date.now();try{const a=await al(async()=>await c.bkcTokenContractPublic.balanceOf(c.userAddress),2);wt=0;const n=c.currentUserBalance||0n;a.toString()!==n.toString()&&(c.currentUserBalance=a,localStorage.setItem(`balance_${c.userAddress.toLowerCase()}`,a.toString()),e-Ci>Ap&&(Ci=e,window.updateUIState&&window.updateUIState(!1)))}catch(a){wt++,wt<=3&&console.warn(`âš ï¸ Balance check failed (${wt}/${Ii}):`,(t=a.message)==null?void 0:t.slice(0,50)),wt>=Ii&&(console.warn("âŒ Too many balance check errors. Stopping polling temporarily."),Ve&&(clearInterval(Ve),Ve=null),setTimeout(()=>{console.log("ðŸ”„ Attempting to restart balance polling with primary RPC..."),Po(),Zn().then(()=>{wt=0,nl()})},6e4))}}async function Mp(e){try{const t=await e.getNetwork();if(Number(t.chainId)===el)return!0;try{return await e.send("wallet_switchEthereumChain",[{chainId:Ip}]),!0}catch{return!0}}catch{return!0}}async function Pi(e,t){try{if(!Rp(t))return!1;await Mp(e),c.provider=e;try{c.signer=await e.getSigner()}catch(a){c.signer=e,console.warn(`Could not get standard Signer. Using Provider as read-only. Warning: ${a.message}`)}c.userAddress=t,c.isConnected=!0,_p(t),Fp(c.signer);try{Vo(c.userAddress)}catch{}return Jn().then(()=>{window.updateUIState&&window.updateUIState(!1)}).catch(()=>{}),nl(),!0}catch(a){return console.error("Setup warning:",a),!!t}}async function Dp(){try{if(window.ethereum){const a=await _o();a.fixed?console.log("âœ… MetaMask network config was auto-fixed"):!a.success&&!a.skipped&&console.warn("Initial network config check:",a.error)}const e=ga();console.log(`ðŸŒ Initializing public provider with: ${e.slice(0,50)}...`),c.publicProvider=Rs(e),tl=c.publicProvider;const t=c.publicProvider;K(y.bkcToken)&&(c.bkcTokenContractPublic=new G.Contract(y.bkcToken,Un,t)),K(y.backchainEcosystem)&&(c.ecosystemManagerContractPublic=new G.Contract(y.backchainEcosystem,Qt,t)),K(y.stakingPool)&&(c.stakingPoolContractPublic=new G.Contract(y.stakingPool,jn,t)),K(y.buybackMiner)&&(c.buybackMinerContractPublic=new G.Contract(y.buybackMiner,Kn,t)),K(y.fortunePool)&&(c.fortunePoolContractPublic=new G.Contract(y.fortunePool,Wn,t)),K(y.agora)&&(c.agoraContractPublic=new G.Contract(y.agora,ea,t)),K(y.notary)&&(c.notaryContractPublic=new G.Contract(y.notary,Gn,t)),K(y.charityPool)&&(c.charityPoolContractPublic=new G.Contract(y.charityPool,Vn,t)),K(y.rentalManager)&&(c.rentalManagerContractPublic=new G.Contract(y.rentalManager,Ea,t)),K(y.faucet)&&(c.faucetContractPublic=new G.Contract(y.faucet,Yn,t));try{await al(async()=>{await jo()})}catch{console.warn("Initial public data load failed, will retry on user interaction")}Fo(async a=>{a.isCorrectNetwork?(await Oa()).healthy||(console.log("âš ï¸ RPC issues after network change, updating..."),await ba(),await Zn()):(console.log("âš ï¸ User switched to wrong network"),b("Please switch back to Arbitrum Sepolia","warning"))}),Up(),window.updateUIState&&window.updateUIState(),console.log("âœ… Public provider initialized")}catch(e){console.error("Public provider error:",e),window.ethereum&&await ba();const t=ar();console.log(`ðŸ”„ Retrying with: ${t}`);try{c.publicProvider=Rs(t),console.log("âœ… Public provider initialized with fallback RPC")}catch{console.error("âŒ All RPC endpoints failed")}}}function Op(e){let t=Mt.getAddress();if(Mt.getIsConnected()&&t){const n=Mt.getWalletProvider();if(n){const s=new G.BrowserProvider(n);c.web3Provider=n,e({isConnected:!0,address:t,isNewConnection:!1}),Pi(s,t)}}const a=async({provider:n,address:s,chainId:r,isConnected:i})=>{try{if(i){let o=s||Mt.getAddress();if(!o&&n)try{o=await(await new G.BrowserProvider(n).getSigner()).getAddress()}catch{}if(o){const l=new G.BrowserProvider(n);c.web3Provider=n,e({isConnected:!0,address:o,chainId:r,isNewConnection:!0}),await Pi(l,o)}else Ve&&clearInterval(Ve),c.isConnected=!1,c.userAddress=null,c.signer=null,e({isConnected:!1})}else Ve&&clearInterval(Ve),c.isConnected=!1,c.userAddress=null,c.signer=null,e({isConnected:!1})}catch{}};Mt.subscribeProvider(a)}function or(){Mt.open()}async function Hp(){await Mt.disconnect()}function Up(){let e=0;document.addEventListener("visibilitychange",async()=>{if(!document.hidden&&c.isConnected){const t=Date.now();if(t-e<3e5)return;(await Oa()).healthy||(e=t,console.log("âš ï¸ RPC unhealthy on tab focus, fixing..."),await ba(),await Zn(),wt=0,ir=0)}}),console.log("âœ… RPC health monitoring started (event-driven, no polling)")}const sl=window.ethers,O=(e,t=18)=>{if(e===null||typeof e>"u")return 0;if(typeof e=="number")return e;if(typeof e=="string")return parseFloat(e);try{const a=BigInt(e);return parseFloat(sl.formatUnits(a,t))}catch{return 0}},bt=e=>!e||typeof e!="string"||!e.startsWith("0x")?"...":`${e.substring(0,6)}...${e.substring(e.length-4)}`,xa=e=>{try{if(e==null)return"0";const t=typeof e=="bigint"?e:BigInt(e);if(t===0n)return"0";const a=parseFloat(sl.formatEther(t));if(a===0||!isFinite(a))return"0";if(a<1e3)return a<.01?"<0.01":a%1===0?a.toString():a.toFixed(2);const n=["","k","M","B","T"],s=Math.min(Math.floor(Math.log10(a)/3),n.length-1);return(a/Math.pow(1e3,s)).toFixed(2)+n[s]}catch{return"0"}},jp=(e="An error occurred.")=>`<div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-center text-red-400 text-sm">${e}</div>`,Wp=(e="No data available.")=>`<div class="text-center p-8 bg-zinc-900/30 border border-dashed border-zinc-800 rounded-lg col-span-full">
                <i class="fa-regular fa-folder-open text-2xl text-zinc-600 mb-2"></i>
                <p class="text-zinc-500 italic text-sm">${e}</p>
            </div>`;function lr(e,t,a,n){if(!e)return;if(a<=1){e.innerHTML="";return}const s=`
        <div class="flex items-center justify-center gap-3 mt-4">
            <button class="pagination-btn prev-page-btn w-8 h-8 flex items-center justify-center rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed" 
                data-page="${t-1}" ${t===1?"disabled":""}>
                <i class="fa-solid fa-chevron-left text-xs"></i>
            </button>
            <span class="text-xs text-zinc-400 font-mono bg-zinc-900 px-3 py-1 rounded border border-zinc-800">
                ${t} / ${a}
            </span>
            <button class="pagination-btn next-page-btn w-8 h-8 flex items-center justify-center rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed" 
                data-page="${t+1}" ${t===a?"disabled":""}>
                <i class="fa-solid fa-chevron-right text-xs"></i>
            </button>
        </div>
    `;e.innerHTML=s,e.querySelectorAll(".pagination-btn").forEach(r=>{r.addEventListener("click",()=>{r.hasAttribute("disabled")||n(parseInt(r.dataset.page))})})}const rl="/api/faucet";function Qn(){var e;return(y==null?void 0:y.faucet)||(M==null?void 0:M.faucet)||((e=window.contractAddresses)==null?void 0:e.faucet)||null}const An=["function claim() external","function canClaim(address user) view returns (bool)","function getUserInfo(address user) view returns (uint256 lastClaim, uint256 claims, bool eligible, uint256 cooldownLeft)","function getCooldownRemaining(address user) view returns (uint256)","function cooldown() view returns (uint256)","function tokensPerClaim() view returns (uint256)","function ethPerClaim() view returns (uint256)","function paused() view returns (bool)","function getFaucetStatus() view returns (uint256 ethBalance, uint256 tokenBalance, uint256 ethPerDrip, uint256 tokensPerDrip, uint256 estimatedEthClaims, uint256 estimatedTokenClaims)","function getStats() view returns (uint256 tokens, uint256 eth, uint256 claims, uint256 users)","event Claimed(address indexed recipient, uint256 tokens, uint256 eth, address indexed via)"];function Gp(){var e,t;return typeof State<"u"&&(State!=null&&State.userAddress)?State.userAddress:(e=window.State)!=null&&e.userAddress?window.State.userAddress:window.userAddress?window.userAddress:(t=window.ethereum)!=null&&t.selectedAddress?window.ethereum.selectedAddress:null}function Ht(e,t="info"){if(typeof window.showToast=="function"){window.showToast(e,t);return}(t==="error"?console.error:console.log)(`[Faucet] ${e}`)}async function il(){if(typeof window.loadUserData=="function"){await window.loadUserData();return}if(typeof window.refreshBalances=="function"){await window.refreshBalances();return}}async function cr({button:e=null,address:t=null,onSuccess:a=null,onError:n=null}={}){const s=t||Gp();if(!s){const o="Please connect wallet first";return Ht(o,"error"),n&&n(new Error(o)),{success:!1,error:o}}const r=(e==null?void 0:e.innerHTML)||"Claim",i=(e==null?void 0:e.disabled)||!1;e&&(e.innerHTML='<div class="loader inline-block"></div> Claiming...',e.disabled=!0);try{const o=await fetch(`${rl}?address=${s}`,{method:"GET",headers:{Accept:"application/json"}}),l=await o.json();if(o.ok&&l.success){Ht("Tokens received!","success"),await il();const d={success:!0,txHash:l.txHash,bkcAmount:l.bkcAmount,ethAmount:l.ethAmount};return a&&a(d),d}else{const d=l.error||l.message||"Faucet unavailable";Ht(d,"error");const u=new Error(d);return n&&n(u),{success:!1,error:d}}}catch(o){return console.error("Faucet error:",o),Ht("Faucet unavailable","error"),n&&n(o),{success:!1,error:o.message}}finally{e&&(e.innerHTML=r,e.disabled=i)}}const dr=async e=>await cr({button:e});async function ol({button:e=null,onSuccess:t=null,onError:a=null}={}){const n=Qn();if(!n){const r="Faucet contract address not configured";return Ht(r,"error"),a&&a(new Error(r)),{success:!1,error:r}}const{txEngine:s}=await Y(async()=>{const{txEngine:r}=await Promise.resolve().then(()=>ae);return{txEngine:r}},void 0);return await s.execute({name:"FaucetClaim",button:e,getContract:async r=>{const i=window.ethers;return new i.Contract(n,An,r)},method:"claim",args:[],validate:async(r,i)=>{const o=window.ethers,{NetworkManager:l}=await Y(async()=>{const{NetworkManager:p}=await Promise.resolve().then(()=>ae);return{NetworkManager:p}},void 0),d=l.getProvider(),u=new o.Contract(n,An,d);try{const p=await u.getUserInfo(i),m=p[2],g=Number(p[3]);if(!m){if(g>0){const x=Math.ceil(g/60);throw new Error(`Aguarde ${x} minutos para claimar novamente`)}throw new Error("Faucet indisponÃ­vel no momento")}}catch(p){if(p.message.includes("Aguarde")||p.message.includes("indisponÃ­vel"))throw p;if(!await u.canClaim(i))throw new Error("Aguarde o cooldown para claimar novamente.")}},onSuccess:async r=>{Ht("Tokens received!","success"),await il(),t&&t(r)},onError:r=>{Ht(r.message||"Claim failed","error"),a&&a(r)}})}async function ll(e){const t=Qn();if(!t)return{canClaim:!1,error:"Faucet not configured"};try{const a=window.ethers,{NetworkManager:n}=await Y(async()=>{const{NetworkManager:i}=await Promise.resolve().then(()=>ae);return{NetworkManager:i}},void 0),s=n.getProvider(),r=new a.Contract(t,An,s);try{const i=await r.getUserInfo(e);return{canClaim:i[2],lastClaimTime:Number(i[0]),claimCount:Number(i[1]),cooldownLeft:Number(i[3]),waitSeconds:Number(i[3])}}catch{return{canClaim:await r.canClaim(e),waitSeconds:0}}}catch(a){return console.error("Error checking claim status:",a),{canClaim:!1,error:a.message}}}async function cl(){const e=Qn();if(!e)return{error:"Faucet not configured"};try{const t=window.ethers,{NetworkManager:a}=await Y(async()=>{const{NetworkManager:r}=await Promise.resolve().then(()=>ae);return{NetworkManager:r}},void 0),n=a.getProvider(),s=new t.Contract(e,An,n);try{const r=await s.getFaucetStatus(),i=r[0],o=r[1],l=r[2],d=r[3];return{bkcAmount:d,ethAmount:l,bkcAmountFormatted:t.formatEther(d),ethAmountFormatted:t.formatEther(l),bkcBalance:o,ethBalance:i,bkcBalanceFormatted:t.formatEther(o),ethBalanceFormatted:t.formatEther(i),estimatedEthClaims:Number(r[4]),estimatedTokenClaims:Number(r[5]),cooldownSeconds:Number(await s.cooldown()),cooldownMinutes:Number(await s.cooldown())/60,isPaused:await s.paused()}}catch{const[r,i,o]=await Promise.all([s.tokensPerClaim(),s.ethPerClaim(),s.cooldown()]);return{bkcAmount:r,ethAmount:i,cooldownSeconds:Number(o),cooldownMinutes:Number(o)/60,bkcAmountFormatted:t.formatEther(r),ethAmountFormatted:t.formatEther(i)}}}catch(t){return console.error("Error getting faucet info:",t),{error:t.message}}}const Yp={claim:cr,claimOnChain:ol,executeFaucetClaim:dr,canClaim:ll,getFaucetInfo:cl,getFaucetAddress:Qn,FAUCET_API_URL:rl},Kp=Object.freeze(Object.defineProperty({__proto__:null,FaucetTx:Yp,canClaim:ll,claim:cr,claimOnChain:ol,executeFaucetClaim:dr,getFaucetInfo:cl},Symbol.toStringTag,{value:"Module"})),hn={BALANCE:1e4,ALLOWANCE:3e4},Le=new Map,ge={hits:0,misses:0,sets:0,invalidations:0},Ct={get(e){const t=Le.get(e);if(!t){ge.misses++;return}if(Date.now()>t.expiresAt){Le.delete(e),ge.misses++;return}return ge.hits++,t.value},set(e,t,a){t!=null&&(Le.set(e,{value:t,expiresAt:Date.now()+a,createdAt:Date.now()}),ge.sets++)},delete(e){Le.delete(e)},clear(e){if(!e){Le.clear(),ge.invalidations++;return}for(const t of Le.keys())t.includes(e)&&Le.delete(t);ge.invalidations++},async getOrFetch(e,t,a){const n=this.get(e);if(n!==void 0)return n;try{const s=await t();return s!=null&&this.set(e,s,a),s}catch(s){throw console.warn(`[Cache] Error fetching ${e}:`,s.message),s}},has(e){return this.get(e)!==void 0},getTTL(e){const t=Le.get(e);if(!t)return 0;const a=t.expiresAt-Date.now();return a>0?a:0},invalidateByTx(e){const a={CreateCampaign:["campaign-","charity-stats","user-campaigns-","campaign-list"],Donate:["campaign-","charity-stats","token-balance-","allowance-"],CancelCampaign:["campaign-","charity-stats","user-campaigns-"],Withdraw:["campaign-","charity-stats","token-balance-"],Delegate:["delegation-","token-balance-","allowance-","user-pstake-","pending-rewards-","network-pstake"],Unstake:["delegation-","token-balance-","user-pstake-","pending-rewards-","network-pstake"],ForceUnstake:["delegation-","token-balance-","user-pstake-","pending-rewards-","network-pstake"],ClaimReward:["pending-rewards-","token-balance-","saved-rewards-"],BuyNFT:["pool-info-","pool-nfts-","token-balance-","allowance-","user-nfts-","buy-price-","sell-price-"],SellNFT:["pool-info-","pool-nfts-","token-balance-","user-nfts-","buy-price-","sell-price-"],PlayGame:["fortune-pool-","fortune-stats-","token-balance-","allowance-","user-fortune-history-"],ListNFT:["rental-listings-","rental-listing-","user-nfts-"],RentNFT:["rental-listing-","rental-active-","token-balance-","allowance-"],WithdrawNFT:["rental-listing-","rental-listings-","user-nfts-"],UpdateListing:["rental-listing-"],Notarize:["notary-","token-balance-","allowance-","user-documents-"],TokenTransfer:["token-balance-","allowance-"],Approval:["allowance-"]}[e];if(!a){console.warn(`[Cache] Unknown transaction type: ${e}`);return}a.forEach(n=>{this.clear(n)}),console.log(`[Cache] Invalidated patterns for ${e}:`,a)},getStats(){const e=Le.size,t=ge.hits+ge.misses>0?(ge.hits/(ge.hits+ge.misses)*100).toFixed(1):0;return{entries:e,hits:ge.hits,misses:ge.misses,sets:ge.sets,invalidations:ge.invalidations,hitRate:`${t}%`}},keys(){return Array.from(Le.keys())},size(){return Le.size},cleanup(){const e=Date.now();let t=0;for(const[a,n]of Le.entries())e>n.expiresAt&&(Le.delete(a),t++);return t>0&&console.log(`[Cache] Cleanup removed ${t} expired entries`),t},resetMetrics(){ge.hits=0,ge.misses=0,ge.sets=0,ge.invalidations=0}},vn={tokenBalance:(e,t)=>`token-balance-${e.toLowerCase()}-${t.toLowerCase()}`,ethBalance:e=>`eth-balance-${e.toLowerCase()}`,allowance:(e,t,a)=>`allowance-${e.toLowerCase()}-${t.toLowerCase()}-${a.toLowerCase()}`,campaign:e=>`campaign-${e}`,campaignList:()=>"campaign-list",charityStats:()=>"charity-stats",userCampaigns:e=>`user-campaigns-${e.toLowerCase()}`,delegation:(e,t)=>`delegation-${e.toLowerCase()}-${t}`,delegations:e=>`delegation-list-${e.toLowerCase()}`,userPStake:e=>`user-pstake-${e.toLowerCase()}`,pendingRewards:e=>`pending-rewards-${e.toLowerCase()}`,networkPStake:()=>"network-pstake",poolInfo:e=>`pool-info-${e.toLowerCase()}`,poolNfts:e=>`pool-nfts-${e.toLowerCase()}`,buyPrice:e=>`buy-price-${e.toLowerCase()}`,sellPrice:e=>`sell-price-${e.toLowerCase()}`,userNfts:e=>`user-nfts-${e.toLowerCase()}`,fortunePool:()=>"fortune-pool",fortuneTiers:()=>"fortune-tiers",fortuneStats:()=>"fortune-stats",userFortuneHistory:e=>`user-fortune-history-${e.toLowerCase()}`,rentalListings:()=>"rental-listings",rentalListing:e=>`rental-listing-${e}`,rentalActive:e=>`rental-active-${e}`,notaryDocument:e=>`notary-doc-${e}`,userDocuments:e=>`user-documents-${e.toLowerCase()}`,feeConfig:e=>`fee-config-${e}`,protocolConfig:()=>"protocol-config"},w={WRONG_NETWORK:"wrong_network",RPC_UNHEALTHY:"rpc_unhealthy",RPC_RATE_LIMITED:"rpc_rate_limited",NETWORK_ERROR:"network_error",WALLET_NOT_CONNECTED:"wallet_not_connected",WALLET_LOCKED:"wallet_locked",INSUFFICIENT_ETH:"insufficient_eth",INSUFFICIENT_TOKEN:"insufficient_token",INSUFFICIENT_ALLOWANCE:"insufficient_allowance",SIMULATION_REVERTED:"simulation_reverted",GAS_ESTIMATION_FAILED:"gas_estimation_failed",USER_REJECTED:"user_rejected",TX_REVERTED:"tx_reverted",TX_TIMEOUT:"tx_timeout",TX_REPLACED:"tx_replaced",TX_UNDERPRICED:"tx_underpriced",NONCE_ERROR:"nonce_error",CAMPAIGN_NOT_FOUND:"campaign_not_found",CAMPAIGN_NOT_ACTIVE:"campaign_not_active",CAMPAIGN_STILL_ACTIVE:"campaign_still_active",NOT_CAMPAIGN_CREATOR:"not_campaign_creator",DONATION_TOO_SMALL:"donation_too_small",MAX_CAMPAIGNS_REACHED:"max_campaigns_reached",INSUFFICIENT_ETH_FEE:"insufficient_eth_fee",LOCK_PERIOD_ACTIVE:"lock_period_active",LOCK_PERIOD_EXPIRED:"lock_period_expired",NO_REWARDS:"no_rewards",INVALID_DURATION:"invalid_duration",INVALID_DELEGATION_INDEX:"invalid_delegation_index",NFT_NOT_IN_POOL:"nft_not_in_pool",POOL_NOT_INITIALIZED:"pool_not_initialized",INSUFFICIENT_POOL_LIQUIDITY:"insufficient_pool_liquidity",SLIPPAGE_EXCEEDED:"slippage_exceeded",NFT_BOOST_MISMATCH:"nft_boost_mismatch",NOT_NFT_OWNER:"not_nft_owner",NO_ACTIVE_TIERS:"no_active_tiers",INVALID_GUESS_COUNT:"invalid_guess_count",INVALID_GUESS_RANGE:"invalid_guess_range",INSUFFICIENT_SERVICE_FEE:"insufficient_service_fee",RENTAL_STILL_ACTIVE:"rental_still_active",NFT_NOT_LISTED:"nft_not_listed",NFT_ALREADY_LISTED:"nft_already_listed",NOT_LISTING_OWNER:"not_listing_owner",MARKETPLACE_PAUSED:"marketplace_paused",EMPTY_METADATA:"empty_metadata",CONTRACT_ERROR:"contract_error",UNKNOWN:"unknown"},wn={[w.WRONG_NETWORK]:"Please switch to Arbitrum Sepolia network",[w.RPC_UNHEALTHY]:"Network connection issue. Retrying...",[w.RPC_RATE_LIMITED]:"Network is busy. Please wait a moment...",[w.NETWORK_ERROR]:"Network error. Please check your connection",[w.WALLET_NOT_CONNECTED]:"Please connect your wallet",[w.WALLET_LOCKED]:"Please unlock your wallet",[w.INSUFFICIENT_ETH]:"Insufficient ETH for gas fees",[w.INSUFFICIENT_TOKEN]:"Insufficient BKC balance",[w.INSUFFICIENT_ALLOWANCE]:"Token approval required",[w.SIMULATION_REVERTED]:"Transaction would fail. Please check your inputs",[w.GAS_ESTIMATION_FAILED]:"Could not estimate gas. Transaction may fail",[w.USER_REJECTED]:"Transaction cancelled",[w.TX_REVERTED]:"Transaction failed on blockchain",[w.TX_TIMEOUT]:"Transaction is taking too long. Please check your wallet",[w.TX_REPLACED]:"Transaction was replaced",[w.TX_UNDERPRICED]:"Gas price too low. Please try again",[w.NONCE_ERROR]:"Transaction sequence error. Please refresh and try again",[w.CAMPAIGN_NOT_FOUND]:"Campaign not found",[w.CAMPAIGN_NOT_ACTIVE]:"This campaign is no longer accepting donations",[w.CAMPAIGN_STILL_ACTIVE]:"Campaign is still active. Please wait until the deadline",[w.NOT_CAMPAIGN_CREATOR]:"Only the campaign creator can perform this action",[w.DONATION_TOO_SMALL]:"Donation amount is below the minimum required",[w.MAX_CAMPAIGNS_REACHED]:"You have reached the maximum number of active campaigns",[w.INSUFFICIENT_ETH_FEE]:"Insufficient ETH for withdrawal fee",[w.LOCK_PERIOD_ACTIVE]:"Your tokens are still locked",[w.LOCK_PERIOD_EXPIRED]:"Lock period has expired. Use normal unstake",[w.NO_REWARDS]:"No rewards available to claim",[w.INVALID_DURATION]:"Lock duration must be between 1 day and 10 years",[w.INVALID_DELEGATION_INDEX]:"Delegation not found",[w.NFT_NOT_IN_POOL]:"This NFT is not available in the pool",[w.POOL_NOT_INITIALIZED]:"Pool is not active yet",[w.INSUFFICIENT_POOL_LIQUIDITY]:"Insufficient liquidity in pool",[w.SLIPPAGE_EXCEEDED]:"Price changed too much. Please try again",[w.NFT_BOOST_MISMATCH]:"NFT tier does not match this pool",[w.NOT_NFT_OWNER]:"You do not own this NFT",[w.NO_ACTIVE_TIERS]:"No active prize tiers available",[w.INVALID_GUESS_COUNT]:"Invalid number of guesses provided",[w.INVALID_GUESS_RANGE]:"Your guess is outside the valid range",[w.INSUFFICIENT_SERVICE_FEE]:"Incorrect service fee amount",[w.RENTAL_STILL_ACTIVE]:"This NFT is currently being rented",[w.NFT_NOT_LISTED]:"This NFT is not listed for rent",[w.NFT_ALREADY_LISTED]:"This NFT is already listed",[w.NOT_LISTING_OWNER]:"Only the listing owner can perform this action",[w.MARKETPLACE_PAUSED]:"Marketplace is temporarily paused",[w.EMPTY_METADATA]:"Document metadata cannot be empty",[w.CONTRACT_ERROR]:"Transaction cannot be completed. Please check your inputs and try again",[w.UNKNOWN]:"An unexpected error occurred. Please try again"},Rt={[w.WRONG_NETWORK]:{layer:1,retry:!1,action:"switch_network"},[w.RPC_UNHEALTHY]:{layer:1,retry:!0,waitMs:2e3,action:"switch_rpc"},[w.RPC_RATE_LIMITED]:{layer:1,retry:!0,waitMs:"extract",action:"switch_rpc"},[w.NETWORK_ERROR]:{layer:1,retry:!0,waitMs:3e3,action:"switch_rpc"},[w.WALLET_NOT_CONNECTED]:{layer:2,retry:!1,action:"connect_wallet"},[w.WALLET_LOCKED]:{layer:2,retry:!1,action:"unlock_wallet"},[w.INSUFFICIENT_ETH]:{layer:3,retry:!1,action:"show_faucet"},[w.INSUFFICIENT_TOKEN]:{layer:3,retry:!1},[w.INSUFFICIENT_ALLOWANCE]:{layer:3,retry:!1},[w.SIMULATION_REVERTED]:{layer:4,retry:!1},[w.GAS_ESTIMATION_FAILED]:{layer:4,retry:!0,waitMs:2e3},[w.USER_REJECTED]:{layer:5,retry:!1},[w.TX_REVERTED]:{layer:5,retry:!1},[w.TX_TIMEOUT]:{layer:5,retry:!0,waitMs:5e3},[w.TX_REPLACED]:{layer:5,retry:!1},[w.TX_UNDERPRICED]:{layer:5,retry:!0,waitMs:1e3},[w.NONCE_ERROR]:{layer:5,retry:!0,waitMs:2e3},[w.CAMPAIGN_NOT_FOUND]:{layer:4,retry:!1},[w.CAMPAIGN_NOT_ACTIVE]:{layer:4,retry:!1},[w.CAMPAIGN_STILL_ACTIVE]:{layer:4,retry:!1},[w.NOT_CAMPAIGN_CREATOR]:{layer:4,retry:!1},[w.DONATION_TOO_SMALL]:{layer:4,retry:!1},[w.MAX_CAMPAIGNS_REACHED]:{layer:4,retry:!1},[w.INSUFFICIENT_ETH_FEE]:{layer:3,retry:!1},[w.LOCK_PERIOD_ACTIVE]:{layer:4,retry:!1},[w.LOCK_PERIOD_EXPIRED]:{layer:4,retry:!1},[w.NO_REWARDS]:{layer:4,retry:!1},[w.INVALID_DURATION]:{layer:4,retry:!1},[w.INVALID_DELEGATION_INDEX]:{layer:4,retry:!1},[w.NFT_NOT_IN_POOL]:{layer:4,retry:!1},[w.POOL_NOT_INITIALIZED]:{layer:4,retry:!1},[w.INSUFFICIENT_POOL_LIQUIDITY]:{layer:4,retry:!1},[w.SLIPPAGE_EXCEEDED]:{layer:4,retry:!0,waitMs:1e3},[w.NFT_BOOST_MISMATCH]:{layer:4,retry:!1},[w.NOT_NFT_OWNER]:{layer:4,retry:!1},[w.NO_ACTIVE_TIERS]:{layer:4,retry:!1},[w.INVALID_GUESS_COUNT]:{layer:4,retry:!1},[w.INVALID_GUESS_RANGE]:{layer:4,retry:!1},[w.INSUFFICIENT_SERVICE_FEE]:{layer:4,retry:!1},[w.RENTAL_STILL_ACTIVE]:{layer:4,retry:!1},[w.NFT_NOT_LISTED]:{layer:4,retry:!1},[w.NFT_ALREADY_LISTED]:{layer:4,retry:!1},[w.NOT_LISTING_OWNER]:{layer:4,retry:!1},[w.MARKETPLACE_PAUSED]:{layer:4,retry:!1},[w.EMPTY_METADATA]:{layer:4,retry:!1},[w.CONTRACT_ERROR]:{layer:4,retry:!1},[w.UNKNOWN]:{layer:5,retry:!1}},Bi=[{pattern:/user rejected/i,type:w.USER_REJECTED},{pattern:/user denied/i,type:w.USER_REJECTED},{pattern:/user cancel/i,type:w.USER_REJECTED},{pattern:/rejected by user/i,type:w.USER_REJECTED},{pattern:/cancelled/i,type:w.USER_REJECTED},{pattern:/canceled/i,type:w.USER_REJECTED},{pattern:/action_rejected/i,type:w.USER_REJECTED},{pattern:/too many errors/i,type:w.RPC_RATE_LIMITED},{pattern:/rate limit/i,type:w.RPC_RATE_LIMITED},{pattern:/retrying in/i,type:w.RPC_RATE_LIMITED},{pattern:/429/i,type:w.RPC_RATE_LIMITED},{pattern:/internal json-rpc/i,type:w.RPC_UNHEALTHY},{pattern:/-32603/i,type:w.RPC_UNHEALTHY},{pattern:/-32002/i,type:w.RPC_RATE_LIMITED},{pattern:/failed to fetch/i,type:w.NETWORK_ERROR},{pattern:/network error/i,type:w.NETWORK_ERROR},{pattern:/timeout/i,type:w.TX_TIMEOUT},{pattern:/insufficient funds/i,type:w.INSUFFICIENT_ETH},{pattern:/exceeds the balance/i,type:w.INSUFFICIENT_ETH},{pattern:/insufficient balance/i,type:w.INSUFFICIENT_TOKEN},{pattern:/transfer amount exceeds balance/i,type:w.INSUFFICIENT_TOKEN},{pattern:/exceeds balance/i,type:w.INSUFFICIENT_TOKEN},{pattern:/nonce/i,type:w.NONCE_ERROR},{pattern:/replacement.*underpriced/i,type:w.TX_UNDERPRICED},{pattern:/transaction underpriced/i,type:w.TX_UNDERPRICED},{pattern:/gas too low/i,type:w.TX_UNDERPRICED},{pattern:/reverted/i,type:w.TX_REVERTED},{pattern:/revert/i,type:w.TX_REVERTED},{pattern:/campaignnotfound/i,type:w.CAMPAIGN_NOT_FOUND},{pattern:/campaign not found/i,type:w.CAMPAIGN_NOT_FOUND},{pattern:/campaignnotactive/i,type:w.CAMPAIGN_NOT_ACTIVE},{pattern:/campaign.*not.*active/i,type:w.CAMPAIGN_NOT_ACTIVE},{pattern:/campaignstillactive/i,type:w.CAMPAIGN_STILL_ACTIVE},{pattern:/notcampaigncreator/i,type:w.NOT_CAMPAIGN_CREATOR},{pattern:/donationtoosmall/i,type:w.DONATION_TOO_SMALL},{pattern:/maxactivecampaignsreached/i,type:w.MAX_CAMPAIGNS_REACHED},{pattern:/insufficientethfee/i,type:w.INSUFFICIENT_ETH_FEE},{pattern:/lockperiodactive/i,type:w.LOCK_PERIOD_ACTIVE},{pattern:/lock.*period.*active/i,type:w.LOCK_PERIOD_ACTIVE},{pattern:/still.*locked/i,type:w.LOCK_PERIOD_ACTIVE},{pattern:/lockperiodexpired/i,type:w.LOCK_PERIOD_EXPIRED},{pattern:/norewardstoclaim/i,type:w.NO_REWARDS},{pattern:/no.*rewards/i,type:w.NO_REWARDS},{pattern:/invalidduration/i,type:w.INVALID_DURATION},{pattern:/invalidindex/i,type:w.INVALID_DELEGATION_INDEX},{pattern:/nftnotinpool/i,type:w.NFT_NOT_IN_POOL},{pattern:/poolnotinitialized/i,type:w.POOL_NOT_INITIALIZED},{pattern:/insufficientliquidity/i,type:w.INSUFFICIENT_POOL_LIQUIDITY},{pattern:/insufficientnfts/i,type:w.INSUFFICIENT_POOL_LIQUIDITY},{pattern:/slippageexceeded/i,type:w.SLIPPAGE_EXCEEDED},{pattern:/slippage/i,type:w.SLIPPAGE_EXCEEDED},{pattern:/nftboostmismatch/i,type:w.NFT_BOOST_MISMATCH},{pattern:/notnftowner/i,type:w.NOT_NFT_OWNER},{pattern:/noactivetiers/i,type:w.NO_ACTIVE_TIERS},{pattern:/invalidguesscount/i,type:w.INVALID_GUESS_COUNT},{pattern:/invalidguessrange/i,type:w.INVALID_GUESS_RANGE},{pattern:/insufficientservicefee/i,type:w.INSUFFICIENT_SERVICE_FEE},{pattern:/rentalstillactive/i,type:w.RENTAL_STILL_ACTIVE},{pattern:/nftnotlisted/i,type:w.NFT_NOT_LISTED},{pattern:/nftalreadylisted/i,type:w.NFT_ALREADY_LISTED},{pattern:/notlistingowner/i,type:w.NOT_LISTING_OWNER},{pattern:/marketplaceispaused/i,type:w.MARKETPLACE_PAUSED},{pattern:/emptymetadata/i,type:w.EMPTY_METADATA}],Q={classify(e){var n;if(e!=null&&e.errorType&&Object.values(w).includes(e.errorType))return e.errorType;const t=this._extractMessage(e),a=(e==null?void 0:e.code)||((n=e==null?void 0:e.error)==null?void 0:n.code);if(a===4001||a==="ACTION_REJECTED")return w.USER_REJECTED;if(a===-32002)return w.RPC_RATE_LIMITED;if(a===-32603||a==="CALL_EXCEPTION"){if(t.includes("base fee")||t.includes("basefee")||t.includes("max fee per gas")||t.includes("maxfeepergas")||t.includes("underpriced")||t.includes("gas too low"))return w.TX_UNDERPRICED;if(t.includes("revert")||t.includes("require")||t.includes("execution failed")||t.includes("call_exception")||(e==null?void 0:e.code)==="CALL_EXCEPTION"){for(const{pattern:s,type:r}of Bi)if(s.test(t))return r;return w.CONTRACT_ERROR}return w.RPC_UNHEALTHY}for(const{pattern:s,type:r}of Bi)if(s.test(t))return r;return w.UNKNOWN},_extractMessage(e){var a,n,s;return e?typeof e=="string"?e:[e.message,e.reason,(a=e.error)==null?void 0:a.message,(n=e.error)==null?void 0:n.reason,(s=e.data)==null?void 0:s.message,e.shortMessage,this._safeStringify(e)].filter(Boolean).join(" ").toLowerCase():""},_safeStringify(e){try{return JSON.stringify(e,(t,a)=>typeof a=="bigint"?a.toString():a)}catch{return""}},isUserRejection(e){return this.classify(e)===w.USER_REJECTED},isRetryable(e){var a;const t=this.classify(e);return((a=Rt[t])==null?void 0:a.retry)||!1},getWaitTime(e){const t=this.classify(e),a=Rt[t];return a?a.waitMs==="extract"?this._extractWaitTime(e):a.waitMs||2e3:2e3},_extractWaitTime(e){const t=this._extractMessage(e),a=t.match(/retrying in (\d+[,.]?\d*)\s*minutes?/i);if(a){const s=parseFloat(a[1].replace(",","."));return Math.ceil(s*60*1e3)+5e3}const n=t.match(/wait (\d+)\s*seconds?/i);return n?parseInt(n[1])*1e3+2e3:3e4},getMessage(e){const t=this.classify(e);return wn[t]||wn[w.UNKNOWN]},getConfig(e){const t=this.classify(e);return Rt[t]||Rt[w.UNKNOWN]},getLayer(e){var a;const t=this.classify(e);return((a=Rt[t])==null?void 0:a.layer)||5},handle(e,t="Transaction"){const a=this.classify(e),n=Rt[a]||{},s=this.getMessage(e);return console.error(`[${t}] Error:`,{type:a,layer:n.layer,retry:n.retry,message:s,original:e}),{type:a,message:s,retry:n.retry||!1,waitMs:n.retry?this.getWaitTime(e):0,layer:n.layer||5,action:n.action||null,original:e,context:t}},async handleWithRpcSwitch(e,t="Transaction"){const a=this.handle(e,t);if(a.action==="switch_rpc")try{const{NetworkManager:n}=await Y(async()=>{const{NetworkManager:r}=await Promise.resolve().then(()=>Qp);return{NetworkManager:r}},void 0);console.log("[ErrorHandler] Switching RPC due to network error...");const s=n.switchToNextRpc();try{await n.updateMetaMaskRpcs(),console.log("[ErrorHandler] MetaMask RPC updated")}catch(r){console.warn("[ErrorHandler] Could not update MetaMask:",r.message)}a.rpcSwitched=!0,a.newRpc=s,a.waitMs=Math.min(a.waitMs,2e3)}catch(n){console.warn("[ErrorHandler] Could not switch RPC:",n.message),a.rpcSwitched=!1}return a},parseSimulationError(e,t){var i;const a=this.classify(e);let n=this.getMessage(e);const r=(i={donate:{[w.CAMPAIGN_NOT_ACTIVE]:"This campaign has ended and is no longer accepting donations",[w.DONATION_TOO_SMALL]:"Minimum donation is 1 BKC"},delegate:{[w.INVALID_DURATION]:"Lock period must be between 1 day and 10 years"},playGame:{[w.INVALID_GUESS_RANGE]:"Your guess must be within the valid range for this tier"},withdraw:{[w.CAMPAIGN_STILL_ACTIVE]:"You can withdraw after the campaign deadline"},unstake:{[w.LOCK_PERIOD_ACTIVE]:"Your tokens are still locked. Use force unstake to withdraw early (penalty applies)"},claimRewards:{[w.CONTRACT_ERROR]:"No rewards available to claim",[w.NO_REWARDS]:"No rewards available to claim"}}[t])==null?void 0:i[a];return r&&(n=r),{type:a,message:n,original:e,method:t,isSimulation:!0}},create(e,t={}){const a=wn[e]||"An error occurred",n=new Error(a);return n.errorType=e,n.extra=t,n},getAction(e){var a;const t=this.classify(e);return((a=Rt[t])==null?void 0:a.action)||null}},ce={chainId:421614,chainIdHex:"0x66eee",name:"Arbitrum Sepolia",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},blockExplorer:"https://sepolia.arbiscan.io"};function dt(){const e="ZWla0YY4A0Hw7e_rwyOXB";return e?`https://arb-sepolia.g.alchemy.com/v2/${e}`:null}const Vp=[{name:"Alchemy",getUrl:dt,priority:1,isPublic:!1,isPaid:!0},{name:"Arbitrum Official",getUrl:()=>"https://sepolia-rollup.arbitrum.io/rpc",priority:2,isPublic:!0,isPaid:!1},{name:"PublicNode",getUrl:()=>"https://arbitrum-sepolia-rpc.publicnode.com",priority:3,isPublic:!0,isPaid:!1},{name:"Ankr",getUrl:()=>"https://rpc.ankr.com/arbitrum_sepolia",priority:4,isPublic:!0,isPaid:!1}];let ht=0,sa=null,_t=null,cn=0,dn=0,ra=!0;const qp=3,Xp=3e4,Jp=5e3,Si=6e4,Zp=2e3,ee={getCurrentRpcUrl(){const e=dt();if(e&&ra)return e;const t=this.getAvailableEndpoints();if(t.length===0)throw new Error("No RPC endpoints available");return t[ht%t.length].getUrl()},getPrimaryRpcUrl(){return dt()},getAvailableEndpoints(){return Vp.filter(e=>e.getUrl()!==null).sort((e,t)=>e.priority-t.priority)},getRpcUrlsForMetaMask(){const e=dt(),t=this.getAvailableEndpoints().filter(a=>a.isPublic).map(a=>a.getUrl()).filter(Boolean);return e?[e,...t]:t},switchToNextRpc(e=!0){const t=this.getAvailableEndpoints();if(ra&&dt()){ra=!1,ht=0;const s=t.find(r=>r.isPublic);if(s)return console.log(`[Network] Alchemy temporarily unavailable, using: ${s.name}`),e&&setTimeout(()=>{console.log("[Network] Retrying Alchemy..."),ra=!0,ht=0},Zp),s.getUrl()}const a=t.filter(s=>s.isPublic);if(a.length<=1)return console.warn("[Network] No alternative RPCs available"),this.getCurrentRpcUrl();ht=(ht+1)%a.length;const n=a[ht];return console.log(`[Network] Switched to RPC: ${n.name}`),n.getUrl()},resetToAlchemy(){dt()&&(ra=!0,ht=0,console.log("[Network] Reset to Alchemy RPC"))},isRateLimitError(e){var n;const t=((n=e==null?void 0:e.message)==null?void 0:n.toLowerCase())||"",a=e==null?void 0:e.code;return a===-32002||a===-32005||t.includes("rate limit")||t.includes("too many")||t.includes("exceeded")||t.includes("throttled")||t.includes("429")},async handleRateLimit(e){const t=this.getCurrentRpcUrl(),a=dt();if(a&&t===a)return console.warn("[Network] Alchemy rate limited (check your plan limits)"),await new Promise(i=>setTimeout(i,1e3)),a;console.warn("[Network] Public RPC rate limited, switching...");const s=this.switchToNextRpc(),r=Date.now();if(r-dn>Si)try{await this.updateMetaMaskRpcs(),dn=r}catch(i){console.warn("[Network] Could not update MetaMask:",i.message)}return s},async getWorkingProvider(){const e=window.ethers,t=dt();if(t)try{const n=new e.JsonRpcProvider(t);return await Promise.race([n.getBlockNumber(),new Promise((s,r)=>setTimeout(()=>r(new Error("timeout")),3e3))]),ra=!0,n}catch(n){console.warn("[Network] Alchemy temporarily unavailable:",n.message)}const a=this.getAvailableEndpoints().filter(n=>n.isPublic);for(const n of a)try{const s=n.getUrl(),r=new e.JsonRpcProvider(s);return await Promise.race([r.getBlockNumber(),new Promise((i,o)=>setTimeout(()=>o(new Error("timeout")),3e3))]),console.log(`[Network] Using fallback RPC: ${n.name}`),r}catch{console.warn(`[Network] RPC ${n.name} failed, trying next...`)}if(t)return new e.JsonRpcProvider(t);throw new Error("No working RPC endpoints available")},async isCorrectNetwork(){if(!window.ethereum)return!1;try{const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)===ce.chainId}catch(e){return console.error("[Network] Error checking network:",e),!1}},async getCurrentChainId(){if(!window.ethereum)return null;try{const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)}catch{return null}},async checkRpcHealth(){const e=Date.now(),t=this.getCurrentRpcUrl();try{const a=new AbortController,n=setTimeout(()=>a.abort(),Jp),s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_blockNumber",params:[],id:1}),signal:a.signal});if(clearTimeout(n),!s.ok)throw new Error(`HTTP ${s.status}`);const r=await s.json();if(r.error)throw new Error(r.error.message||"RPC error");const i=Date.now()-e;return cn=0,_t={healthy:!0,latency:i,blockNumber:parseInt(r.result,16),timestamp:Date.now()},_t}catch(a){cn++;const n={healthy:!1,latency:Date.now()-e,error:a.message,timestamp:Date.now()};return _t=n,cn>=qp&&(console.warn("[Network] Too many RPC failures, switching..."),this.switchToNextRpc(),cn=0),n}},getLastHealthCheck(){return _t},async isRpcHealthy(e=1e4){return _t&&Date.now()-_t.timestamp<e?_t.healthy:(await this.checkRpcHealth()).healthy},async switchNetwork(){if(!window.ethereum)throw Q.create(w.WALLET_NOT_CONNECTED);try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:ce.chainIdHex}]}),console.log("[Network] Switched to",ce.name),!0}catch(e){if(e.code===4902)return await this.addNetwork();throw e.code===4001?Q.create(w.USER_REJECTED):e}},async addNetwork(){if(!window.ethereum)throw Q.create(w.WALLET_NOT_CONNECTED);const e=this.getRpcUrlsForMetaMask();try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:ce.chainIdHex,chainName:ce.name,nativeCurrency:ce.nativeCurrency,rpcUrls:e,blockExplorerUrls:[ce.blockExplorer]}]}),console.log("[Network] Added network:",ce.name),!0}catch(t){throw t.code===4001?Q.create(w.USER_REJECTED):t}},async updateMetaMaskRpcs(){if(!window.ethereum)return!1;const e=Date.now();if(e-dn<Si)return console.log("[Network] MetaMask update on cooldown, skipping..."),!1;if(!await this.isCorrectNetwork())return console.log("[Network] Not on correct network, skipping RPC update"),!1;const a=this.getRpcUrlsForMetaMask();try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:ce.chainIdHex,chainName:ce.name,nativeCurrency:ce.nativeCurrency,rpcUrls:a,blockExplorerUrls:[ce.blockExplorer]}]}),dn=e,console.log("[Network] MetaMask RPCs updated with:",a[0]),!0}catch(n){return console.warn("[Network] Could not update MetaMask RPCs:",n.message),!1}},async forceResetMetaMaskRpc(){if(!window.ethereum)return!1;const e=dt();if(!e)return console.warn("[Network] Alchemy not configured"),!1;try{try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x1"}]})}catch{}return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:ce.chainIdHex,chainName:ce.name+" (Alchemy)",nativeCurrency:ce.nativeCurrency,rpcUrls:[e],blockExplorerUrls:[ce.blockExplorer]}]}),console.log("[Network] MetaMask reset to Alchemy RPC"),!0}catch(t){return console.error("[Network] Failed to reset MetaMask:",t.message),!1}},getProvider(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");return new e.JsonRpcProvider(this.getCurrentRpcUrl())},getBrowserProvider(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");if(!window.ethereum)throw Q.create(w.WALLET_NOT_CONNECTED);return new e.BrowserProvider(window.ethereum)},async getSigner(){var t,a;const e=this.getBrowserProvider();try{return await e.getSigner()}catch(n){if((t=n.message)!=null&&t.includes("ENS")||n.code==="UNSUPPORTED_OPERATION")try{const s=await window.ethereum.request({method:"eth_accounts"});if(s&&s.length>0)return await e.getSigner(s[0])}catch(s){console.warn("Signer fallback failed:",s)}throw n.code===4001||(a=n.message)!=null&&a.includes("user rejected")?Q.create(w.USER_REJECTED):Q.create(w.WALLET_NOT_CONNECTED)}},async getConnectedAddress(){if(!window.ethereum)return null;try{return(await window.ethereum.request({method:"eth_accounts"}))[0]||null}catch{return null}},async requestConnection(){if(!window.ethereum)throw Q.create(w.WALLET_NOT_CONNECTED);try{const e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e||e.length===0)throw Q.create(w.WALLET_NOT_CONNECTED);return e[0]}catch(e){throw e.code===4001?Q.create(w.USER_REJECTED):e}},startHealthMonitoring(e=Xp){sa&&this.stopHealthMonitoring(),this.checkRpcHealth(),sa=setInterval(()=>{this.checkRpcHealth()},e),console.log("[Network] Health monitoring started")},stopHealthMonitoring(){sa&&(clearInterval(sa),sa=null,console.log("[Network] Health monitoring stopped"))},isMonitoring(){return sa!==null},formatAddress(e,t=4){return e?`${e.slice(0,t+2)}...${e.slice(-t)}`:""},getAddressExplorerUrl(e){return`${ce.blockExplorer}/address/${e}`},getTxExplorerUrl(e){return`${ce.blockExplorer}/tx/${e}`},isMetaMaskInstalled(){return typeof window.ethereum<"u"&&window.ethereum.isMetaMask},async getStatus(){var n;const[e,t,a]=await Promise.all([this.isCorrectNetwork(),this.getConnectedAddress(),this.checkRpcHealth()]);return{isConnected:!!t,address:t,isCorrectNetwork:e,currentChainId:await this.getCurrentChainId(),targetChainId:ce.chainId,rpcHealthy:a.healthy,rpcLatency:a.latency,currentRpc:((n=this.getAvailableEndpoints()[ht])==null?void 0:n.name)||"Unknown"}}},Qp=Object.freeze(Object.defineProperty({__proto__:null,NETWORK_CONFIG:ce,NetworkManager:ee},Symbol.toStringTag,{value:"Module"})),lt={SAFETY_MARGIN_PERCENT:20,MIN_GAS_LIMITS:{transfer:21000n,erc20Transfer:65000n,erc20Approve:50000n,contractCall:100000n,complexCall:300000n},MAX_GAS_LIMIT:15000000n,MIN_GAS_PRICE_GWEI:.01,MAX_GAS_PRICE_GWEI:100,GAS_PRICE_CACHE_TTL:15e3},dl={async estimateGas(e,t,a=[],n={}){try{return await e[t].estimateGas(...a,n)}catch(s){throw s}},async estimateGasWithMargin(e,t,a=[],n={}){const s=await this.estimateGas(e,t,a,n);return this.addSafetyMargin(s)},addSafetyMargin(e,t=lt.SAFETY_MARGIN_PERCENT){const a=BigInt(e),n=a*BigInt(t)/100n;let s=a+n;return s>lt.MAX_GAS_LIMIT&&(console.warn("[Gas] Estimate exceeds max limit, capping"),s=lt.MAX_GAS_LIMIT),s},getMinGasLimit(e="contractCall"){return lt.MIN_GAS_LIMITS[e]||lt.MIN_GAS_LIMITS.contractCall},async getGasPrice(){return await Ct.getOrFetch("gas-price-current",async()=>(await ee.getProvider().getFeeData()).gasPrice||0n,lt.GAS_PRICE_CACHE_TTL)},async getFeeData(){return await Ct.getOrFetch("gas-fee-data",async()=>{const a=await ee.getProvider().getFeeData();return{gasPrice:a.gasPrice||0n,maxFeePerGas:a.maxFeePerGas||0n,maxPriorityFeePerGas:a.maxPriorityFeePerGas||0n}},lt.GAS_PRICE_CACHE_TTL)},async getGasPriceGwei(){const e=window.ethers,t=await this.getGasPrice();return parseFloat(e.formatUnits(t,"gwei"))},async calculateCost(e,t=null){const a=window.ethers;t||(t=await this.getGasPrice());const n=BigInt(e)*BigInt(t),s=a.formatEther(n);return{wei:n,eth:parseFloat(s),formatted:this.formatEth(s)}},async estimateTransactionCost(e,t,a=[],n={}){const s=await this.estimateGas(e,t,a,n),r=this.addSafetyMargin(s),i=await this.getGasPrice(),o=await this.calculateCost(r,i);return{gasEstimate:s,gasWithMargin:r,gasPrice:i,...o}},async validateGasBalance(e,t,a=null){const n=window.ethers,s=ee.getProvider();a||(a=await this.getGasPrice());const r=await s.getBalance(e),i=BigInt(t)*BigInt(a),o=r>=i;return{sufficient:o,balance:r,required:i,shortage:o?0n:i-r,balanceFormatted:n.formatEther(r),requiredFormatted:n.formatEther(i)}},async hasMinimumGas(e,t=null){const a=window.ethers,s=await ee.getProvider().getBalance(e),r=t||a.parseEther("0.001");return s>=r},formatEth(e,t=6){const a=parseFloat(e);return a===0?"0 ETH":a<1e-6?"< 0.000001 ETH":`${a.toFixed(t).replace(/\.?0+$/,"")} ETH`},formatGasPrice(e){const t=window.ethers,a=parseFloat(t.formatUnits(e,"gwei"));return a<.01?"< 0.01 gwei":a<1?`${a.toFixed(2)} gwei`:`${a.toFixed(1)} gwei`},formatGasLimit(e){return Number(e).toLocaleString()},formatGasSummary(e){return`~${e.formatted} (${this.formatGasLimit(e.gasWithMargin||0n)} gas)`},compareEstimates(e,t){const a=BigInt(e),n=BigInt(t);if(n===0n)return 0;const s=a>n?a-n:n-a;return Number(s*100n/n)},isGasPriceReasonable(e){const t=window.ethers,a=parseFloat(t.formatUnits(e,"gwei"));return a<lt.MIN_GAS_PRICE_GWEI?{reasonable:!1,warning:"Gas price unusually low, transaction may be slow"}:a>lt.MAX_GAS_PRICE_GWEI?{reasonable:!1,warning:"Gas price unusually high, consider waiting"}:{reasonable:!0,warning:null}},async getRecommendedSettings(e){const t=await this.getFeeData();return{gasLimit:this.addSafetyMargin(e),maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas}},async createTxOverrides(e,t={}){return{gasLimit:(await this.getRecommendedSettings(e)).gasLimit,...t}}},zi=500000000000000n,Ni=["function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)"],ie={async validateNetwork(){if(!await ee.isCorrectNetwork()){const t=await ee.getCurrentChainId();throw Q.create(w.WRONG_NETWORK,{currentChainId:t,expectedChainId:ce.chainId})}},async validateRpcHealth(){const e=await ee.checkRpcHealth();if(!e.healthy&&(ee.switchToNextRpc(),!(await ee.checkRpcHealth()).healthy))throw Q.create(w.RPC_UNHEALTHY,{error:e.error})},async validateWalletConnected(e=null){if(!window.ethereum)throw Q.create(w.WALLET_NOT_CONNECTED);const t=e||await ee.getConnectedAddress();if(!t)throw Q.create(w.WALLET_NOT_CONNECTED);return t},async validatePreTransaction(){return await this.validateNetwork(),await this.validateRpcHealth(),await this.validateWalletConnected()},async validateEthForGas(e,t=zi){const a=window.ethers,n=vn.ethBalance(e),s=await Ct.getOrFetch(n,async()=>await ee.getProvider().getBalance(e),hn.BALANCE);if(s<t)throw Q.create(w.INSUFFICIENT_ETH,{balance:a.formatEther(s),required:a.formatEther(t)});return s},async validateTokenBalance(e,t,a){const n=window.ethers,s=vn.tokenBalance(e,a),r=await Ct.getOrFetch(s,async()=>{const i=ee.getProvider();return await new n.Contract(e,Ni,i).balanceOf(a)},hn.BALANCE);if(r<t)throw Q.create(w.INSUFFICIENT_TOKEN,{balance:n.formatEther(r),required:n.formatEther(t)});return r},async needsApproval(e,t,a,n){const s=window.ethers,r=vn.allowance(e,n,t);return await Ct.getOrFetch(r,async()=>{const o=ee.getProvider();return await new s.Contract(e,Ni,o).allowance(n,t)},hn.ALLOWANCE)<a},async validateAllowance(e,t,a,n){if(await this.needsApproval(e,t,a,n))throw Q.create(w.INSUFFICIENT_ALLOWANCE,{token:e,spender:t,required:a.toString()})},async validateBalances({userAddress:e,tokenAddress:t=null,tokenAmount:a=null,spenderAddress:n=null,ethAmount:s=zi}){await this.validateEthForGas(e,s),t&&a&&await this.validateTokenBalance(t,a,e)},validatePositive(e,t="Amount"){if(BigInt(e)<=0n)throw new Error(`${t} must be greater than zero`)},validateRange(e,t,a,n="Value"){const s=BigInt(e),r=BigInt(t),i=BigInt(a);if(s<r||s>i)throw new Error(`${n} must be between ${t} and ${a}`)},validateNotEmpty(e,t="Field"){if(!e||e.trim().length===0)throw new Error(`${t} cannot be empty`)},validateAddress(e,t="Address"){const a=window.ethers;if(!e||!a.isAddress(e))throw new Error(`Invalid ${t}`)},charity:{validateCreateCampaign({title:e,description:t,goalAmount:a,durationDays:n}){ie.validateNotEmpty(e,"Title"),ie.validateNotEmpty(t,"Description"),ie.validatePositive(a,"Goal amount"),ie.validateRange(n,1,180,"Duration")},validateDonate({campaignId:e,amount:t}){if(e==null)throw new Error("Campaign ID is required");ie.validatePositive(t,"Donation amount")}},staking:{validateDelegate({amount:e,lockDays:t}){ie.validatePositive(e,"Stake amount"),ie.validateRange(t,1,3650,"Lock duration")},validateUnstake({delegationIndex:e}){if(e==null||e<0)throw new Error("Invalid delegation index")}},nftPool:{validateBuy({maxPrice:e}){e!=null&&ie.validatePositive(e,"Max price")},validateSell({tokenId:e,minPayout:t}){if(e==null)throw new Error("Token ID is required");t!=null&&ie.validatePositive(t,"Min payout")}},fortune:{validatePlay({wagerAmount:e,guesses:t,isCumulative:a}){if(ie.validatePositive(e,"Wager amount"),!Array.isArray(t)||t.length===0)throw new Error("At least one guess is required");t.forEach((n,s)=>{if(typeof n!="number"||n<1)throw new Error(`Invalid guess at position ${s+1}`)})}},rental:{validateList({tokenId:e,pricePerHour:t,minHours:a,maxHours:n}){if(e==null)throw new Error("Token ID is required");ie.validatePositive(t,"Price per hour"),ie.validateRange(a,1,720,"Minimum hours"),ie.validateRange(n,a,720,"Maximum hours")},validateRent({tokenId:e,hours:t}){if(e==null)throw new Error("Token ID is required");ie.validatePositive(t,"Rental hours")}},notary:{validateNotarize({ipfsCid:e,description:t,contentHash:a}){if(ie.validateNotEmpty(e,"IPFS CID"),a&&(a.startsWith("0x")?a.slice(2):a).length!==64)throw new Error("Content hash must be 32 bytes")}}},un={DEFAULT_MAX_RETRIES:2,RETRY_BASE_DELAY:2e3,APPROVAL_MULTIPLIER:10n,APPROVAL_WAIT_TIME:1500,CONFIRMATION_TIMEOUT:6e4,CONFIRMATION_RETRY_DELAY:3e3,GAS_SAFETY_MARGIN:20,DEFAULT_GAS_LIMIT:500000n},$i=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"];class ul{constructor(t,a,n=!0){this.button=t,this.txName=a,this.showToasts=n,this.originalContent=null,this.originalDisabled=!1,this.button&&(this.originalContent=this.button.innerHTML,this.originalDisabled=this.button.disabled)}setPhase(t){if(!this.button)return;const n={validating:{text:"Validating...",icon:"ðŸ”"},approving:{text:"Approving...",icon:"âœ…"},simulating:{text:"Simulating...",icon:"ðŸ§ª"},confirming:{text:"Confirm in Wallet",icon:"ðŸ‘›"},waiting:{text:"Processing...",icon:"â³"},success:{text:"Success!",icon:"ðŸŽ‰"},error:{text:"Failed",icon:"âŒ"}}[t]||{text:t,icon:"â³"};this.button.disabled=!0,this.button.innerHTML=`
            <span class="tx-status">
                <span class="tx-icon">${n.icon}</span>
                <span class="tx-text">${n.text}</span>
            </span>
        `}setRetry(t,a){this.button&&(this.button.innerHTML=`
            <span class="tx-status">
                <span class="tx-icon">ðŸ”„</span>
                <span class="tx-text">Retry ${t}/${a}...</span>
            </span>
        `)}cleanup(){this.button&&(this.button.innerHTML=this.originalContent,this.button.disabled=this.originalDisabled)}showSuccess(t=2e3){this.setPhase("success"),setTimeout(()=>this.cleanup(),t)}showError(t=2e3){this.setPhase("error"),setTimeout(()=>this.cleanup(),t)}}class pl{constructor(){this.pendingTxIds=new Set}_resolveArgs(t){return typeof t=="function"?t():t||[]}_resolveApproval(t){return t?typeof t=="object"?{token:t.token,spender:t.spender,amount:t.amount}:t:null}_validateContractMethod(t,a){if(!t)throw new Error("Contract instance is null or undefined");if(typeof t[a]!="function"){const n=Object.keys(t).filter(s=>typeof t[s]=="function").filter(s=>!s.startsWith("_")&&!["on","once","emit","removeListener"].includes(s)).slice(0,15);throw console.error(`[TX] Contract method "${a}" not found!`),console.error("[TX] Available methods:",n),new Error(`Contract method "${a}" not found. This usually means the ABI doesn't match the contract. Available methods: ${n.join(", ")}`)}return typeof t[a].estimateGas!="function"&&console.warn(`[TX] Method ${a} exists but estimateGas is not available`),!0}async execute(t){var B,z;const{name:a,txId:n=null,button:s=null,showToasts:r=!0,getContract:i,method:o,args:l=[],approval:d=null,validate:u=null,onSuccess:p=null,onError:m=null,maxRetries:g=un.DEFAULT_MAX_RETRIES,invalidateCache:x=!0,skipSimulation:h=!1,fixedGasLimit:C=un.DEFAULT_GAS_LIMIT}=t,T=n||`${a}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(this.pendingTxIds.has(T))return console.warn(`[TX] Transaction ${T} already in progress`),{success:!1,reason:"DUPLICATE_TX",message:"Transaction already in progress"};this.pendingTxIds.add(T);const A=new ul(s,a,r);try{A.setPhase("validating"),console.log(`[TX] Starting: ${a}`),await ie.validateNetwork(),await ie.validateRpcHealth();const S=await ie.validateWalletConnected();console.log(`[TX] User address: ${S}`);const I=await ee.getSigner();console.log("[TX] Signer obtained");try{await ie.validateEthForGas(S)}catch(ne){console.warn("[TX] ETH gas validation failed, continuing anyway:",ne.message)}const R=this._resolveApproval(d);R&&R.amount>0n&&await ie.validateTokenBalance(R.token,R.amount,S),u&&(console.log("[TX] Running custom validation..."),await u(I,S));const D=this._resolveApproval(t.approval);D&&D.amount>0n&&await ie.needsApproval(D.token,D.spender,D.amount,S)&&(A.setPhase("approving"),console.log("[TX] Requesting token approval..."),await this._executeApproval(D,I,S),Ct.clear("allowance-")),console.log("[TX] Getting contract instance...");const q=await i(I);this._validateContractMethod(q,o),console.log(`[TX] Contract method "${o}" validated`);const H=t.value;H&&console.log("[TX] Transaction value (ETH):",H.toString());const re=H?{value:H}:{},X=this._resolveArgs(l);console.log("[TX] Args resolved:",X.map(ne=>typeof ne=="bigint"?ne.toString():typeof ne=="string"&&ne.length>50?ne.substring(0,50)+"...":ne));let W;if(h)console.log(`[TX] Skipping simulation, using fixed gas limit: ${C}`),W=C;else{A.setPhase("simulating"),console.log("[TX] Simulating transaction...");try{const ne=ee.getProvider(),We=await q.getAddress(),ws=new ethers.Contract(We,q.interface,ne);if(!ws[o]||typeof ws[o].estimateGas!="function")throw new Error(`estimateGas not available for method "${o}"`);W=await ws[o].estimateGas(...X,{...re,from:S}),console.log(`[TX] Gas estimate: ${W.toString()}`)}catch(ne){if(console.error("[TX] Simulation failed:",ne.message),(B=ne.message)!=null&&B.includes("not found")||(z=ne.message)!=null&&z.includes("undefined"))throw new Error(`Contract method "${o}" is not callable. Check that the ABI matches the deployed contract.`);const We=Q.parseSimulationError(ne,o);throw Q.create(We.type,{message:We.message,original:ne})}}A.setPhase("confirming"),console.log("[TX] Requesting signature...");const pe=dl.addSafetyMargin(W),je={...re,gasLimit:pe};try{const We=await ee.getProvider().getFeeData();We.maxFeePerGas&&(je.maxFeePerGas=We.maxFeePerGas*120n/100n,je.maxPriorityFeePerGas=We.maxPriorityFeePerGas||0n)}catch{}const Lt=this._resolveArgs(l),xt=await this._executeWithRetry(()=>q[o](...Lt,je),{maxRetries:g,ui:A,signer:I,name:a});console.log(`[TX] Transaction submitted: ${xt.hash}`),A.setPhase("waiting"),console.log("[TX] Waiting for confirmation...");const Qe=await this._waitForConfirmation(xt,I.provider);if(console.log(`[TX] Confirmed in block ${Qe.blockNumber}`),A.showSuccess(),x&&Ct.invalidateByTx(a),p)try{await p(Qe)}catch(ne){console.warn("[TX] onSuccess callback error:",ne)}return{success:!0,receipt:Qe,txHash:Qe.hash||xt.hash,blockNumber:Qe.blockNumber}}catch(S){console.error("[TX] Error:",(S==null?void 0:S.message)||S),s&&(console.log("[TX] Restoring button..."),s.disabled=!1,A.originalContent&&(s.innerHTML=A.originalContent));let I;try{I=await Q.handleWithRpcSwitch(S,a),I.rpcSwitched&&console.log(`[TX] RPC switched to: ${I.newRpc}`)}catch(R){console.warn("[TX] Error in handleWithRpcSwitch:",R),I=Q.handle(S,a)}if(I.type!==w.USER_REJECTED&&s&&!m){const R=A.originalContent;s.innerHTML='<span style="display:flex;align-items:center;justify-content:center;gap:8px"><span>âŒ</span><span>Failed</span></span>',setTimeout(()=>{s&&(s.innerHTML=R)},1500)}if(m)try{m(I)}catch(R){console.warn("[TX] onError callback error:",R)}return{success:!1,error:I,message:I.message,cancelled:I.type===w.USER_REJECTED}}finally{this.pendingTxIds.delete(T),setTimeout(()=>{s&&s.disabled&&(console.log("[TX] Safety cleanup triggered"),A.cleanup())},5e3)}}async _executeApproval(t,a,n){const s=window.ethers,{token:r,spender:i,amount:o}=t;console.log(`[TX] Approving ${s.formatEther(o)} tokens...`);const l=new s.Contract(r,$i,a),d=o*un.APPROVAL_MULTIPLIER;try{let u={gasLimit:100000n};try{const T=await ee.getProvider().getFeeData();T.maxFeePerGas&&(u.maxFeePerGas=T.maxFeePerGas*120n/100n,u.maxPriorityFeePerGas=T.maxPriorityFeePerGas||0n)}catch{}const p=await l.approve(i,d,u),m=ee.getProvider();let g=null;for(let C=0;C<30&&(await new Promise(T=>setTimeout(T,1500)),g=await m.getTransactionReceipt(p.hash),!g);C++);if(g||(g=await p.wait()),g.status===0)throw new Error("Approval transaction reverted");if(console.log("[TX] Approval confirmed"),await new Promise(C=>setTimeout(C,un.APPROVAL_WAIT_TIME)),await new s.Contract(r,$i,m).allowance(n,i)<o)throw new Error("Approval not reflected on-chain")}catch(u){throw Q.isUserRejection(u)?Q.create(w.USER_REJECTED):u}}async _executeWithRetry(t,{maxRetries:a,ui:n,signer:s,name:r}){let i;for(let o=1;o<=a+1;o++)try{return o>1&&(n.setRetry(o,a+1),console.log(`[TX] Retry ${o}/${a+1}`),(await ee.checkRpcHealth()).healthy||(console.log("[TX] RPC unhealthy, switching..."),ee.switchToNextRpc(),await new Promise(d=>setTimeout(d,2e3)))),await t()}catch(l){if(i=l,Q.isUserRejection(l)||!Q.isRetryable(l)||o===a+1)throw l;const d=Q.getWaitTime(l);console.log(`[TX] Waiting ${d}ms before retry...`),await new Promise(u=>setTimeout(u,d))}throw i}async _waitForConfirmation(t,a){const n=ee.getProvider();for(let s=0;s<30;s++){await new Promise(r=>setTimeout(r,1500));try{const r=await n.getTransactionReceipt(t.hash);if(r&&r.status===1)return console.log("[TX] Confirmed via Alchemy"),r;if(r&&r.status===0)throw new Error("Transaction reverted on-chain")}catch(r){if(r.message==="Transaction reverted on-chain")throw r}}return console.warn("[TX] Could not verify receipt after 45s, assuming success"),{hash:t.hash,status:1,blockNumber:0}}isPending(t){return this.pendingTxIds.has(t)}getPendingCount(){return this.pendingTxIds.size}clearPending(){this.pendingTxIds.clear()}}const j=new pl,es="bkc_operator",ta="0x0000000000000000000000000000000000000000";function ts(){var t;const e=window.ethers;try{const a=localStorage.getItem(es);if(a&&at(a))return Yt(a);if(window.BACKCHAIN_OPERATOR&&at(window.BACKCHAIN_OPERATOR))return Yt(window.BACKCHAIN_OPERATOR);if((t=window.addresses)!=null&&t.operator&&at(window.addresses.operator))return Yt(window.addresses.operator)}catch(a){console.warn("[Operator] Error getting operator:",a)}return(e==null?void 0:e.ZeroAddress)||ta}function Z(e){const t=window.ethers,a=(t==null?void 0:t.ZeroAddress)||ta;return e===null?a:e&&at(e)?Yt(e):ts()}function ur(e){if(!e)return as(),!0;if(!at(e))return console.warn("[Operator] Invalid address:",e),!1;try{const t=Yt(e);return localStorage.setItem(es,t),window.BACKCHAIN_OPERATOR=t,window.dispatchEvent(new CustomEvent("operatorChanged",{detail:{address:t}})),console.log("[Operator] Set to:",t),!0}catch(t){return console.error("[Operator] Error setting:",t),!1}}function as(){try{localStorage.removeItem(es),delete window.BACKCHAIN_OPERATOR,window.dispatchEvent(new CustomEvent("operatorChanged",{detail:{address:null}})),console.log("[Operator] Cleared")}catch(e){console.warn("[Operator] Error clearing:",e)}}function fl(){const e=window.ethers,t=(e==null?void 0:e.ZeroAddress)||ta,a=ts();return a&&a!==t}function Ka(){var n;const e=window.ethers,t=(e==null?void 0:e.ZeroAddress)||ta,a=localStorage.getItem(es);return a&&at(a)?{address:a,source:"localStorage",isSet:!0}:window.BACKCHAIN_OPERATOR&&at(window.BACKCHAIN_OPERATOR)?{address:window.BACKCHAIN_OPERATOR,source:"global",isSet:!0}:(n=window.addresses)!=null&&n.operator&&at(window.addresses.operator)?{address:window.addresses.operator,source:"config",isSet:!0}:{address:t,source:"none",isSet:!1}}function at(e){const t=window.ethers;return!e||typeof e!="string"||!e.match(/^0x[a-fA-F0-9]{40}$/)?!1:t!=null&&t.isAddress?t.isAddress(e):!0}function Yt(e){const t=window.ethers;if(!e)return(t==null?void 0:t.ZeroAddress)||ta;try{if(t!=null&&t.getAddress)return t.getAddress(e)}catch{}return e}function Va(e){const t=window.ethers,a=(t==null?void 0:t.ZeroAddress)||ta;return!e||e===a?"None":`${e.slice(0,6)}...${e.slice(-4)}`}const ef={get:ts,set:ur,clear:as,has:fl,resolve:Z,info:Ka,isValid:at,normalize:Yt,short:Va,ZERO:ta};window.Operator=ef;const tf=["function getFeeConfig(bytes32 _actionId) view returns (uint8 feeType, uint16 bps, uint32 multiplier, uint32 gasEstimate)"],Li=10000n;async function te(e,t=0n){try{const a=window.ethers,n=ee.getProvider(),s=(y==null?void 0:y.backchainEcosystem)||(M==null?void 0:M.backchainEcosystem);if(!s)return console.warn("[FeeCalc] Ecosystem address not available"),0n;const i=await new a.Contract(s,tf,n).getFeeConfig(e),o=BigInt(i.bps);if(o===0n)return 0n;if(Number(i.feeType)===0){const l=await n.getFeeData(),d=l.gasPrice||l.maxFeePerGas||100000000n,u=d*150n/100n,p=BigInt(i.gasEstimate)*u*o*BigInt(i.multiplier)/Li;return console.log(`[FeeCalc] Gas-based: ${a.formatEther(p)} ETH (gasEst=${i.gasEstimate}, gasPrice=${d}â†’${u} +50%, bps=${o}, mult=${i.multiplier})`),p}else{const l=t*o/Li;return console.log(`[FeeCalc] Value-based: ${a.formatEther(l)} ETH`),l}}catch(a){return console.error("[FeeCalc] Error:",a.message),0n}}const ae=Object.freeze(Object.defineProperty({__proto__:null,CacheKeys:vn,CacheManager:Ct,CacheTTL:hn,ErrorHandler:Q,ErrorMessages:wn,ErrorTypes:w,GasManager:dl,NETWORK_CONFIG:ce,NetworkManager:ee,TransactionEngine:pl,TransactionUI:ul,ValidationLayer:ie,calculateFeeClientSide:te,clearOperator:as,getOperator:ts,getOperatorInfo:Ka,hasOperator:fl,isValidAddress:at,normalizeAddress:Yt,resolveOperator:Z,setOperator:ur,shortAddress:Va,txEngine:j},Symbol.toStringTag,{value:"Module"}));function ml(){var t;const e=(y==null?void 0:y.charityPool)||(M==null?void 0:M.charityPool)||((t=window.contractAddresses)==null?void 0:t.charityPool);if(!e)throw console.error("âŒ CharityPool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{CHARITY_POOL:e}}const qa=["function createCampaign(string calldata title, string calldata metadataUri, uint96 goal, uint256 durationDays, address operator) external payable returns (uint256 campaignId)","function donate(uint256 campaignId, address operator) external payable","function boostCampaign(uint256 campaignId, address operator) external payable","function closeCampaign(uint256 campaignId) external","function withdraw(uint256 campaignId) external","function getCampaign(uint256 campaignId) view returns (address owner, uint48 deadline, uint8 status, uint96 raised, uint96 goal, uint32 donorCount, bool isBoosted, string memory title, string memory metadataUri)","function canWithdraw(uint256 campaignId) view returns (bool)","function previewDonation(uint256 amount) view returns (uint256 fee, uint256 netToCampaign)","function campaignCount() view returns (uint256)","function getStats() view returns (uint256 campaignCount, uint256 totalDonated, uint256 totalWithdrawn, uint256 totalEthFees)","function version() view returns (string)","event CampaignCreated(uint256 indexed campaignId, address indexed creator, uint96 goal, uint48 deadline, address operator)","event DonationMade(uint256 indexed campaignId, address indexed donor, uint256 grossAmount, uint256 netDonation, address operator)","event CampaignBoosted(uint256 indexed campaignId, address indexed booster, uint48 boostExpiry, address operator)","event CampaignClosed(uint256 indexed campaignId, address indexed creator, uint96 raised)","event FundsWithdrawn(uint256 indexed campaignId, address indexed creator, uint96 amount)"],Ta={ACTIVE:0,CLOSED:1,WITHDRAWN:2};function Xa(e){const t=window.ethers,a=ml();return new t.Contract(a.CHARITY_POOL,qa,e)}async function it(){const e=window.ethers,{NetworkManager:t}=await Y(async()=>{const{NetworkManager:s}=await Promise.resolve().then(()=>ae);return{NetworkManager:s}},void 0),a=t.getProvider(),n=ml();return new e.Contract(n.CHARITY_POOL,qa,a)}async function gl({title:e,metadataUri:t="",description:a,goalAmount:n,durationDays:s,operator:r,button:i=null,onSuccess:o=null,onError:l=null}){const d=window.ethers;if(!e||e.trim().length===0)throw new Error("Title is required");if(e.length>100)throw new Error("Title must be 100 characters or less");if(s<1||s>365)throw new Error("Duration must be between 1 and 365 days");const u=BigInt(n);if(u<=0n)throw new Error("Goal amount must be greater than 0");const p=t||a||"";let m=r,g=0n;return await j.execute({name:"CreateCampaign",button:i,getContract:async x=>Xa(x),method:"createCampaign",args:()=>[e,p,u,BigInt(s),Z(m)],get value(){return g},validate:async(x,h)=>{await it();try{const{NetworkManager:C}=await Y(async()=>{const{NetworkManager:B}=await Promise.resolve().then(()=>ae);return{NetworkManager:B}},void 0),T=C.getProvider();if(g=d.parseEther("0.0001"),await T.getBalance(h)<g+d.parseEther("0.001"))throw new Error("Insufficient ETH for creation fee + gas")}catch(C){if(C.message.includes("Insufficient"))throw C}},onSuccess:async x=>{let h=null;try{const C=new d.Interface(qa);for(const T of x.logs)try{const A=C.parseLog(T);if(A.name==="CampaignCreated"){h=Number(A.args.campaignId);break}}catch{}}catch{}o&&o(x,h)},onError:l})}async function bl({campaignId:e,amount:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers;if(e==null)throw new Error("Campaign ID is required");const o=BigInt(t);if(o<=0n)throw new Error("Donation amount must be greater than 0");let l=e,d=a;return await j.execute({name:"Donate",button:n,getContract:async u=>Xa(u),method:"donate",args:()=>[l,Z(d)],value:o,validate:async(u,p)=>{const g=await(await it()).getCampaign(l);if(g.owner===i.ZeroAddress)throw new Error("Campaign not found");if(Number(g.status)!==Ta.ACTIVE)throw new Error("Campaign is not active");const x=Math.floor(Date.now()/1e3);if(Number(g.deadline)<=x)throw new Error("Campaign has ended")},onSuccess:async u=>{let p=null;try{const m=new i.Interface(qa);for(const g of u.logs)try{const x=m.parseLog(g);if(x.name==="DonationMade"){p={grossAmount:x.args.grossAmount,netDonation:x.args.netDonation};break}}catch{}}catch{}s&&s(u,p)},onError:r})}async function pr({campaignId:e,button:t=null,onSuccess:a=null,onError:n=null}){const s=window.ethers;if(e==null)throw new Error("Campaign ID is required");return await j.execute({name:"CloseCampaign",button:t,getContract:async r=>Xa(r),method:"closeCampaign",args:[e],validate:async(r,i)=>{const l=await(await it()).getCampaign(e);if(l.owner===s.ZeroAddress)throw new Error("Campaign not found");if(l.owner.toLowerCase()!==i.toLowerCase())throw new Error("Only the campaign creator can close");if(Number(l.status)!==Ta.ACTIVE)throw new Error("Campaign is not active")},onSuccess:a,onError:n})}const xl=pr;async function hl({campaignId:e,button:t=null,onSuccess:a=null,onError:n=null}){const s=window.ethers;if(e==null)throw new Error("Campaign ID is required");return await j.execute({name:"Withdraw",button:t,getContract:async r=>Xa(r),method:"withdraw",args:[e],validate:async(r,i)=>{const o=await it(),l=await o.getCampaign(e);if(l.owner===s.ZeroAddress)throw new Error("Campaign not found");if(l.owner.toLowerCase()!==i.toLowerCase())throw new Error("Only the campaign creator can withdraw");if(Number(l.status)===Ta.WITHDRAWN)throw new Error("Funds already withdrawn");if(!await o.canWithdraw(e))throw new Error("Cannot withdraw yet â€” campaign must be closed or past deadline")},onSuccess:async r=>{let i=null;try{const o=new s.Interface(qa);for(const l of r.logs)try{const d=o.parseLog(l);if(d.name==="FundsWithdrawn"){i={amount:d.args.amount};break}}catch{}}catch{}a&&a(r,i)},onError:n})}async function vl({campaignId:e,operator:t,button:a=null,onSuccess:n=null,onError:s=null}){const r=window.ethers;if(e==null)throw new Error("Campaign ID is required");let i=t,o=r.parseEther("0.0001");return await j.execute({name:"BoostCampaign",button:a,getContract:async l=>Xa(l),method:"boostCampaign",args:()=>[e,Z(i)],get value(){return o},validate:async(l,d)=>{const p=await(await it()).getCampaign(e);if(p.owner===r.ZeroAddress)throw new Error("Campaign not found");if(Number(p.status)!==Ta.ACTIVE)throw new Error("Campaign is not active");const m=Math.floor(Date.now()/1e3);if(Number(p.deadline)<=m)throw new Error("Campaign has ended")},onSuccess:n,onError:s})}async function wl(e){const a=await(await it()).getCampaign(e),n=Math.floor(Date.now()/1e3);return{id:e,creator:a.owner,title:a.title,metadataUri:a.metadataUri,goalAmount:a.goal,raisedAmount:a.raised,donationCount:Number(a.donorCount),deadline:Number(a.deadline),status:Number(a.status),statusName:["ACTIVE","CLOSED","WITHDRAWN"][Number(a.status)]||"UNKNOWN",isBoosted:a.isBoosted,progress:a.goal>0n?Number(a.raised*100n/a.goal):0,isEnded:Number(a.deadline)<n,isActive:Number(a.status)===Ta.ACTIVE&&Number(a.deadline)>n}}async function yl(){const e=await it();return Number(await e.campaignCount())}async function kl(e){return await(await it()).canWithdraw(e)}async function El(e){const t=window.ethers,n=await(await it()).previewDonation(e);return{fee:n.fee||n[0],netToCampaign:n.netToCampaign||n[1],feeFormatted:t.formatEther(n.fee||n[0]),netFormatted:t.formatEther(n.netToCampaign||n[1])}}async function Tl(){const e=window.ethers,a=await(await it()).getStats();return{totalCampaigns:Number(a.campaignCount||a[0]),totalDonated:a.totalDonated||a[1],totalDonatedFormatted:e.formatEther(a.totalDonated||a[1]),totalWithdrawn:a.totalWithdrawn||a[2],totalWithdrawnFormatted:e.formatEther(a.totalWithdrawn||a[2]),totalEthFees:a.totalEthFees||a[3],totalEthFeesFormatted:e.formatEther(a.totalEthFees||a[3])}}const Xe={createCampaign:gl,donate:bl,closeCampaign:pr,cancelCampaign:xl,withdraw:hl,boostCampaign:vl,getCampaign:wl,getCampaignCount:yl,canWithdraw:kl,previewDonation:El,getStats:Tl,CampaignStatus:Ta},af=Object.freeze(Object.defineProperty({__proto__:null,CharityTx:Xe,boostCampaign:vl,canWithdraw:kl,cancelCampaign:xl,closeCampaign:pr,createCampaign:gl,donate:bl,getCampaign:wl,getCampaignCount:yl,getStats:Tl,previewDonation:El,withdraw:hl},Symbol.toStringTag,{value:"Module"}));function fr(){var a,n;const e=(y==null?void 0:y.stakingPool)||(M==null?void 0:M.stakingPool)||((a=window.contractAddresses)==null?void 0:a.stakingPool),t=(y==null?void 0:y.bkcToken)||(M==null?void 0:M.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw console.error("âŒ StakingPool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");if(!t)throw console.error("âŒ BKC Token address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,STAKING_POOL:e}}const Cl=["function delegate(uint256 amount, uint256 lockDays, address operator) external payable","function unstake(uint256 index) external","function forceUnstake(uint256 index, address operator) external payable","function claimRewards(address operator) external payable","function pendingRewards(address user) view returns (uint256)","function previewClaim(address user) view returns (uint256 totalRewards, uint256 burnAmount, uint256 referrerCut, uint256 userReceives, uint256 burnRateBps, uint256 nftBoost)","function getDelegationsOf(address user) view returns (tuple(uint128 amount, uint128 pStake, uint64 lockEnd, uint64 lockDays, uint256 rewardDebt)[])","function getDelegation(address user, uint256 index) view returns (uint256 amount, uint256 pStake, uint256 lockEnd, uint256 lockDays, uint256 pendingReward)","function delegationCount(address user) view returns (uint256)","function userTotalPStake(address user) view returns (uint256)","function totalPStake() view returns (uint256)","function MIN_LOCK_DAYS() view returns (uint256)","function MAX_LOCK_DAYS() view returns (uint256)","function forceUnstakePenaltyBps() view returns (uint256)","function getUserBestBoost(address user) view returns (uint256)","function getBurnRateForBoost(uint256 boostBps) view returns (uint256)","function getTierName(uint256 boostBps) view returns (string)","function getUserSummary(address user) view returns (uint256 userTotalPStake, uint256 delegationCount, uint256 savedRewards, uint256 totalPending, uint256 nftBoost, uint256 burnRateBps)","function getStakingStats() view returns (uint256 totalPStake, uint256 totalBkcDelegated, uint256 totalRewardsDistributed, uint256 totalBurnedOnClaim, uint256 totalForceUnstakePenalties, uint256 totalEthFeesCollected, uint256 accRewardPerShare)","event Delegated(address indexed user, uint256 indexed delegationIndex, uint256 amount, uint256 pStake, uint256 lockDays, address operator)","event Unstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned)","event ForceUnstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned, uint256 penaltyBurned, address operator)","event RewardsClaimed(address indexed user, uint256 totalRewards, uint256 burnedAmount, uint256 userReceived, uint256 cutAmount, address cutRecipient, uint256 nftBoostUsed, address operator)"];function qt(e){const t=window.ethers,a=fr();return new t.Contract(a.STAKING_POOL,Cl,e)}async function St(){const e=window.ethers,{NetworkManager:t}=await Y(async()=>{const{NetworkManager:s}=await Promise.resolve().then(()=>ae);return{NetworkManager:s}},void 0),a=t.getProvider(),n=fr();return new e.Contract(n.STAKING_POOL,Cl,a)}async function Il({amount:e,lockDays:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){if(t==null)throw new Error("lockDays must be provided");const i=Number(t);if(i<1||i>3650)throw new Error("Lock duration must be between 1 and 3650 days");const o=BigInt(e);let l=a;return await j.execute({name:"Delegate",button:n,getContract:async d=>qt(d),method:"delegate",args:()=>[o,BigInt(i),Z(l)],approval:(()=>{const d=fr();return{token:d.BKC_TOKEN,spender:d.STAKING_POOL,amount:o}})(),onSuccess:s,onError:r})}async function Al({delegationIndex:e,button:t=null,onSuccess:a=null,onError:n=null}){ie.staking.validateUnstake({delegationIndex:e});let s=e;return await j.execute({name:"Unstake",button:t,getContract:async r=>qt(r),method:"unstake",args:[s],validate:async(r,i)=>{const l=await qt(r).getDelegationsOf(i);if(s>=l.length)throw new Error("Delegation not found");const d=l[s],u=Math.floor(Date.now()/1e3);if(Number(d.lockEnd)>u){const p=Math.ceil((Number(d.lockEnd)-u)/86400);throw new Error(`Lock period still active. ${p} day(s) remaining. Use Force Unstake if needed.`)}},onSuccess:a,onError:n})}async function Pl({delegationIndex:e,operator:t,button:a=null,onSuccess:n=null,onError:s=null}){ie.staking.validateUnstake({delegationIndex:e});let r=e,i=t;return await j.execute({name:"ForceUnstake",button:a,getContract:async o=>qt(o),method:"forceUnstake",args:()=>[r,Z(i)],validate:async(o,l)=>{const u=await qt(o).getDelegationsOf(l);if(r>=u.length)throw new Error("Delegation not found");const p=u[r],m=Math.floor(Date.now()/1e3);if(Number(p.lockEnd)<=m)throw new Error("Lock period has ended. Use normal Unstake to avoid penalty.")},onSuccess:n,onError:s})}async function Bl({operator:e,button:t=null,onSuccess:a=null,onError:n=null}={}){let s=e;return await j.execute({name:"ClaimRewards",button:t,getContract:async r=>qt(r),method:"claimRewards",args:()=>[Z(s)],validate:async(r,i)=>{if(await qt(r).pendingRewards(i)<=0n)throw new Error("No rewards available to claim")},onSuccess:a,onError:n})}async function Sl(e){const a=await(await St()).getDelegationsOf(e),n=Math.floor(Date.now()/1e3);return a.map((s,r)=>({index:r,amount:s.amount,pStake:s.pStake,lockEnd:Number(s.lockEnd),lockDays:Number(s.lockDays),isUnlocked:Number(s.lockEnd)<=n,daysRemaining:Number(s.lockEnd)>n?Math.ceil((Number(s.lockEnd)-n)/86400):0}))}async function zl(e){return await(await St()).pendingRewards(e)}async function Nl(e){return await(await St()).userTotalPStake(e)}async function $l(){return await(await St()).totalPStake()}async function Ll(){const e=await St();try{const t=await e.forceUnstakePenaltyBps();return Number(t)/100}catch{return 10}}async function Rl(){const e=await St(),[t,a,n]=await Promise.all([e.MIN_LOCK_DAYS(),e.MAX_LOCK_DAYS(),e.forceUnstakePenaltyBps().catch(()=>1000n)]);return{minLockDays:Number(t),maxLockDays:Number(a),penaltyPercent:Number(n)/100,penaltyBips:Number(n)}}async function _l(e){const a=await(await St()).previewClaim(e);return{totalRewards:a.totalRewards,burnAmount:a.burnAmount,referrerCut:a.referrerCut,userReceives:a.userReceives,burnRateBps:Number(a.burnRateBps),nftBoost:Number(a.nftBoost)}}async function Fl(e){const a=await(await St()).getUserSummary(e);return{userTotalPStake:a.userTotalPStake||a[0],delegationCount:Number(a.delegationCount||a[1]),savedRewards:a.savedRewards||a[2],totalPending:a.totalPending||a[3],nftBoost:Number(a.nftBoost||a[4]),burnRateBps:Number(a.burnRateBps||a[5])}}const ha={delegate:Il,unstake:Al,forceUnstake:Pl,claimRewards:Bl,getUserDelegations:Sl,getPendingRewards:zl,getUserPStake:Nl,getTotalPStake:$l,getEarlyUnstakePenalty:Ll,getStakingConfig:Rl,previewClaim:_l,getUserSummary:Fl},nf=Object.freeze(Object.defineProperty({__proto__:null,StakingTx:ha,claimRewards:Bl,delegate:Il,forceUnstake:Pl,getEarlyUnstakePenalty:Ll,getPendingRewards:zl,getStakingConfig:Rl,getTotalPStake:$l,getUserDelegations:Sl,getUserPStake:Nl,getUserSummary:Fl,previewClaim:_l,unstake:Al},Symbol.toStringTag,{value:"Module"})),Ml=["diamond","gold","silver","bronze"];function ns(e=null){var s,r,i;const t=(y==null?void 0:y.bkcToken)||(M==null?void 0:M.bkcToken)||((s=window.contractAddresses)==null?void 0:s.bkcToken),a=(y==null?void 0:y.rewardBooster)||(M==null?void 0:M.rewardBooster)||((r=window.contractAddresses)==null?void 0:r.rewardBooster);let n=null;if(e){const o=`pool_${e.toLowerCase()}`;n=(y==null?void 0:y[o])||(M==null?void 0:M[o])||((i=window.contractAddresses)==null?void 0:i[o])}if(!t||!a)throw new Error("Contract addresses not loaded");return{BKC_TOKEN:t,NFT_CONTRACT:a,NFT_POOL:n}}function Ca(e){var a;const t=`pool_${e.toLowerCase()}`;return(y==null?void 0:y[t])||(M==null?void 0:M[t])||((a=window.contractAddresses)==null?void 0:a[t])||null}function sf(){const e={};for(const t of Ml){const a=Ca(t);a&&(e[t]=a)}return e}const mr=["function buyNFT(uint256 maxBkcPrice, address operator) external payable returns (uint256 tokenId)","function buySpecificNFT(uint256 tokenId, uint256 maxBkcPrice, address operator) external payable","function sellNFT(uint256 tokenId, uint256 minPayout, address operator) external payable","function getBuyPrice() view returns (uint256)","function getSellPrice() view returns (uint256)","function getTotalBuyCost() view returns (uint256 bkcCost, uint256 ethCost)","function getTotalSellInfo() view returns (uint256 bkcPayout, uint256 ethCost)","function getEthFees() view returns (uint256 buyFee, uint256 sellFee)","function getSpread() view returns (uint256 spread, uint256 spreadBips)","function getPoolInfo() view returns (uint256 bkcBalance, uint256 nftCount, uint256 k, bool initialized, uint8 tier)","function getAvailableNFTs() view returns (uint256[])","function isNFTInPool(uint256 tokenId) view returns (bool)","function tier() view returns (uint8)","function getTierName() view returns (string)","function getStats() view returns (uint256 volume, uint256 buys, uint256 sells, uint256 ethFees)","event NFTPurchased(address indexed buyer, uint256 indexed tokenId, uint256 price, uint256 ethFee, uint256 nftCount, address operator)","event NFTSold(address indexed seller, uint256 indexed tokenId, uint256 payout, uint256 ethFee, uint256 nftCount, address operator)"],Dl=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function ownerOf(uint256 tokenId) view returns (address)","function balanceOf(address owner) view returns (uint256)","function tokenTier(uint256 tokenId) view returns (uint8)"];function gr(e,t){return new window.ethers.Contract(t,mr,e)}async function Ne(e){const{NetworkManager:t}=await Y(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>ae);return{NetworkManager:a}},void 0);return new window.ethers.Contract(e,mr,t.getProvider())}function Xt(e,t){const a=window.ethers;return a.keccak256(a.AbiCoder.defaultAbiCoder().encode(["string","uint8"],[e,Number(t)]))}function _s(e){const t=ns();return new window.ethers.Contract(t.NFT_CONTRACT,Dl,e)}async function rf(){const{NetworkManager:e}=await Y(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>ae);return{NetworkManager:a}},void 0),t=ns();return new window.ethers.Contract(t.NFT_CONTRACT,Dl,e.getProvider())}async function br({poolAddress:e,poolTier:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers,o=ns(),l=e||Ca(t);if(!l)throw new Error("Pool address or valid pool tier is required");let d=a,u=0n,p=0n;return await j.execute({name:"BuyNFT",button:n,getContract:async m=>gr(m,l),method:"buyNFT",args:()=>[u,Z(d)],get value(){return p},get approval(){return u>0n?{token:o.BKC_TOKEN,spender:l,amount:u}:null},validate:async(m,g)=>{const x=await Ne(l),[h]=await x.getTotalBuyCost();u=h;const C=await x.tier();p=await te(Xt("NFT_BUY_T",C)),console.log(`[BuyNFT] Price: ${i.formatEther(u)} BKC, Fee: ${i.formatEther(p)} ETH`);const T=await x.getPoolInfo();if(Number(T[1])<=1)throw new Error("No NFTs available in pool");const{NetworkManager:A}=await Y(async()=>{const{NetworkManager:R}=await Promise.resolve().then(()=>ae);return{NetworkManager:R}},void 0),B=A.getProvider();if(await new i.Contract(o.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],B).balanceOf(g)<u)throw new Error(`Insufficient BKC. Need ${i.formatEther(u)} BKC`);if(await B.getBalance(g)<p+i.parseEther("0.001"))throw new Error("Insufficient ETH for fee + gas")},onSuccess:async m=>{let g=null;try{const x=new i.Interface(mr);for(const h of m.logs)try{const C=x.parseLog(h);if((C==null?void 0:C.name)==="NFTPurchased"){g=Number(C.args.tokenId);break}}catch{}}catch{}s&&s(m,g)},onError:r})}async function Ol({poolAddress:e,poolTier:t,tokenId:a,operator:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=window.ethers,l=ns(),d=e||Ca(t);if(!d)throw new Error("Pool address or valid pool tier is required");if(a===void 0)throw new Error("Token ID is required");let u=n,p=0n,m=0n;return await j.execute({name:"BuySpecificNFT",button:s,getContract:async g=>gr(g,d),method:"buySpecificNFT",args:()=>[a,p,Z(u)],get value(){return m},get approval(){return p>0n?{token:l.BKC_TOKEN,spender:d,amount:p}:null},validate:async(g,x)=>{const h=await Ne(d);if(!await h.isNFTInPool(a))throw new Error("NFT is not in pool");const[C]=await h.getTotalBuyCost();p=C;const T=await h.tier();m=await te(Xt("NFT_BUY_T",T));const{NetworkManager:A}=await Y(async()=>{const{NetworkManager:S}=await Promise.resolve().then(()=>ae);return{NetworkManager:S}},void 0),B=A.getProvider();if(await new o.Contract(l.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],B).balanceOf(x)<p)throw new Error("Insufficient BKC");if(await B.getBalance(x)<m+o.parseEther("0.001"))throw new Error("Insufficient ETH")},onSuccess:r,onError:i})}async function xr({poolAddress:e,poolTier:t,tokenId:a,minPayout:n,operator:s,button:r=null,onSuccess:i=null,onError:o=null}){const l=window.ethers,d=e||Ca(t);if(!d)throw new Error("Pool address or valid pool tier is required");if(a===void 0)throw new Error("Token ID is required");let u=s,p=0n,m=0n;return await j.execute({name:"SellNFT",button:r,getContract:async g=>gr(g,d),method:"sellNFT",args:()=>[a,p,Z(u)],get value(){return m},validate:async(g,x)=>{const h=await Ne(d),C=_s(g);if((await C.ownerOf(a)).toLowerCase()!==x.toLowerCase())throw new Error("You do not own this NFT");const A=await h.tier(),B=await C.tokenTier(a);if(A!==B)throw new Error("NFT tier does not match pool tier");const[z]=await h.getTotalSellInfo();p=n?BigInt(n):z*95n/100n;const S=await h.tier();m=await te(Xt("NFT_SELL_T",S));const{NetworkManager:I}=await Y(async()=>{const{NetworkManager:D}=await Promise.resolve().then(()=>ae);return{NetworkManager:D}},void 0);if(await I.getProvider().getBalance(x)<m+l.parseEther("0.001"))throw new Error("Insufficient ETH");if(!await C.isApprovedForAll(x,d)){const{NetworkManager:D}=await Y(async()=>{const{NetworkManager:X}=await Promise.resolve().then(()=>ae);return{NetworkManager:X}},void 0),q=await D.getProvider().getFeeData(),H={gasLimit:100000n};q.maxFeePerGas&&(H.maxFeePerGas=q.maxFeePerGas*120n/100n,H.maxPriorityFeePerGas=q.maxPriorityFeePerGas||0n),await(await C.setApprovalForAll(d,!0,H)).wait()}},onSuccess:i,onError:o})}async function Hl({poolAddress:e,poolTier:t,button:a=null,onSuccess:n=null,onError:s=null}){const r=e||Ca(t);if(!r)throw new Error("Pool address or valid pool tier is required");return await j.execute({name:"ApproveAllNFTs",button:a,getContract:async i=>_s(i),method:"setApprovalForAll",args:[r,!0],validate:async(i,o)=>{if(await _s(i).isApprovedForAll(o,r))throw new Error("Already approved")},onSuccess:n,onError:s})}async function Ul(e){return await(await Ne(e)).getBuyPrice()}async function jl(e){return await(await Ne(e)).getSellPrice()}async function Wl(e){const t=window.ethers,a=await Ne(e),[n]=await a.getTotalBuyCost(),s=await a.tier(),r=await te(Xt("NFT_BUY_T",s));return{bkcCost:n,bkcFormatted:t.formatEther(n),ethCost:r,ethFormatted:t.formatEther(r)}}async function Gl(e){const t=window.ethers,a=await Ne(e),[n]=await a.getTotalSellInfo(),s=await a.tier(),r=await te(Xt("NFT_SELL_T",s));return{bkcPayout:n,bkcFormatted:t.formatEther(n),ethCost:r,ethFormatted:t.formatEther(r)}}async function Yl(e){const t=window.ethers,a=await Ne(e),[n,s,r]=await Promise.all([a.getPoolInfo(),a.getBuyPrice().catch(()=>0n),a.getSellPrice().catch(()=>0n)]);return{bkcBalance:n[0],nftCount:Number(n[1]),k:n[2],initialized:n[3],tier:Number(n[4]),buyPrice:s,buyPriceFormatted:t.formatEther(s),sellPrice:r,sellPriceFormatted:t.formatEther(r)}}async function Kl(e){return(await(await Ne(e)).getAvailableNFTs()).map(a=>Number(a))}async function hr(e){const t=window.ethers,n=await(await Ne(e)).tier(),s=await te(Xt("NFT_BUY_T",n)),r=await te(Xt("NFT_SELL_T",n));return{buyFee:s,buyFeeFormatted:t.formatEther(s),sellFee:r,sellFeeFormatted:t.formatEther(r)}}const Vl=hr;async function vr(e){const t=window.ethers,n=await(await Ne(e)).getStats();return{volume:n[0],volumeFormatted:t.formatEther(n[0]),buys:Number(n[1]),sells:Number(n[2]),ethFees:n[3],ethFeesFormatted:t.formatEther(n[3])}}const ql=vr;async function Xl(e){return await(await Ne(e)).getTierName()}async function Jl(e){const t=window.ethers,a=await Ne(e);try{const n=await a.getSpread();return{spread:n.spread,spreadFormatted:t.formatEther(n.spread),spreadBips:Number(n.spreadBips),spreadPercent:Number(n.spreadBips)/100}}catch{const[n,s]=await Promise.all([a.getBuyPrice().catch(()=>0n),a.getSellPrice().catch(()=>0n)]),r=n>s?n-s:0n,i=s>0n?Number(r*10000n/s):0;return{spread:r,spreadFormatted:t.formatEther(r),spreadBips:i,spreadPercent:i/100}}}async function Zl(e,t){return await(await Ne(e)).isNFTInPool(t)}async function Ql(e,t){return await(await rf()).isApprovedForAll(e,t)}const ec=br,tc=xr,Fs={buyNft:br,buySpecificNft:Ol,sellNft:xr,approveAllNfts:Hl,buyFromPool:ec,sellToPool:tc,getBuyPrice:Ul,getSellPrice:jl,getTotalBuyCost:Wl,getTotalSellInfo:Gl,getEthFees:hr,getEthFeeConfig:Vl,getPoolInfo:Yl,getAvailableNfts:Kl,isNFTInPool:Zl,isApprovedForAll:Ql,getStats:vr,getTradingStats:ql,getTierName:Xl,getSpread:Jl,getPoolAddress:Ca,getAllPools:sf,POOL_TIERS:Ml},of=Object.freeze(Object.defineProperty({__proto__:null,NftTx:Fs,approveAllNfts:Hl,buyFromPool:ec,buyNft:br,buySpecificNft:Ol,getAvailableNfts:Kl,getBuyPrice:Ul,getEthFeeConfig:Vl,getEthFees:hr,getPoolInfo:Yl,getSellPrice:jl,getSpread:Jl,getStats:vr,getTierName:Xl,getTotalBuyCost:Wl,getTotalSellInfo:Gl,getTradingStats:ql,isApprovedForAll:Ql,isNFTInPool:Zl,sellNft:xr,sellToPool:tc},Symbol.toStringTag,{value:"Module"}));function wr(){var a,n;const e=(y==null?void 0:y.fortunePool)||(M==null?void 0:M.fortunePool)||((a=window.contractAddresses)==null?void 0:a.fortunePool),t=(y==null?void 0:y.bkcToken)||(M==null?void 0:M.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw console.error("âŒ FortunePool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");if(!t)throw console.error("âŒ BKC Token address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,FORTUNE_POOL:e}}const ss=["function commitPlay(bytes32 commitHash, uint256 wagerAmount, uint8 tierMask, address operator) external payable returns (uint256 gameId)","function revealPlay(uint256 gameId, uint256[] calldata guesses, bytes32 userSecret) external returns (uint256 prizeWon)","function claimExpired(uint256 gameId) external","function fundPrizePool(uint256 amount) external","function getTierInfo(uint8 tier) view returns (uint256 range, uint256 multiplier, uint256 winChanceBps)","function getAllTiers() view returns (uint256[3] ranges, uint256[3] multipliers, uint256[3] winChances)","function TIER_COUNT() view returns (uint8)","function getGame(uint256 gameId) view returns (address player, uint48 commitBlock, uint8 tierMask, uint8 status, address operator, uint96 wagerAmount)","function getGameResult(uint256 gameId) view returns (address player, uint128 grossWager, uint128 prizeWon, uint8 tierMask, uint8 matchCount, uint48 revealBlock)","function getGameStatus(uint256 gameId) view returns (uint8 status, bool canReveal, uint256 blocksUntilReveal, uint256 blocksUntilExpiry)","function calculatePotentialWinnings(uint256 wagerAmount, uint8 tierMask) view returns (uint256 netToPool, uint256 bkcFee, uint256 maxPrize, uint256 maxPrizeAfterCap)","function getRequiredFee(uint8 tierMask) view returns (uint256 fee)","function generateCommitHash(uint256[] calldata guesses, bytes32 userSecret) pure returns (bytes32)","function gameCounter() view returns (uint256)","function prizePool() view returns (uint256)","function getPoolStats() view returns (uint256 prizePool, uint256 totalGamesPlayed, uint256 totalBkcWagered, uint256 totalBkcWon, uint256 totalBkcForfeited, uint256 totalBkcBurned, uint256 maxPayoutNow)","function REVEAL_DELAY() view returns (uint256)","function REVEAL_WINDOW() view returns (uint256)","function BKC_FEE_BPS() view returns (uint256)","function MAX_PAYOUT_BPS() view returns (uint256)","event GameCommitted(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint8 tierMask, address operator)","event GameRevealed(uint256 indexed gameId, address indexed player, uint256 grossWager, uint256 prizeWon, uint8 tierMask, uint8 matchCount, address operator)","event GameDetails(uint256 indexed gameId, uint8 tierMask, uint256[] guesses, uint256[] rolls, bool[] matches)","event GameExpired(uint256 indexed gameId, address indexed player, uint256 forfeitedAmount)"],yr=[{range:4,multiplierBps:3e4},{range:20,multiplierBps:15e4},{range:100,multiplierBps:75e4}];function ac(e){const t=window.ethers,a=wr();return new t.Contract(a.FORTUNE_POOL,ss,e)}async function aa(){const e=window.ethers,{NetworkManager:t}=await Y(async()=>{const{NetworkManager:s}=await Promise.resolve().then(()=>ae);return{NetworkManager:s}},void 0),a=t.getProvider(),n=wr();return new e.Contract(n.FORTUNE_POOL,ss,a)}const kr="fortune_pending_games";function rs(){try{return JSON.parse(localStorage.getItem(kr)||"{}")}catch{return{}}}function lf(e,t){const a=rs();a[e]={...t,savedAt:Date.now()},localStorage.setItem(kr,JSON.stringify(a))}function cf(e){const t=rs();delete t[e],localStorage.setItem(kr,JSON.stringify(t))}function nc(e,t){const a=window.ethers,s=a.AbiCoder.defaultAbiCoder().encode(["uint256[]","bytes32"],[e.map(r=>BigInt(r)),t]);return a.keccak256(s)}function sc(){const e=window.ethers;return e.hexlify(e.randomBytes(32))}function df(e){let t=0;for(;e;)t+=e&1,e>>=1;return t}async function Er({commitmentHash:e,wagerAmount:t,tierMask:a,operator:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=window.ethers,l=wr(),d=BigInt(t),u=Number(a);if(u<1||u>7)throw new Error("tierMask must be 1-7");let p=n,m=0n;try{const g=[o.id("FORTUNE_TIER0"),o.id("FORTUNE_TIER1"),o.id("FORTUNE_TIER2")];for(let x=0;x<3;x++)u&1<<x&&(m+=await te(g[x]));console.log("[FortuneTx] ETH fee:",o.formatEther(m))}catch(g){throw console.error("[FortuneTx] Could not calculate ETH fee:",g.message),new Error("Could not calculate ETH fee")}return await j.execute({name:"CommitPlay",button:s,getContract:async g=>ac(g),method:"commitPlay",args:()=>[e,d,u,Z(p)],value:m,approval:{token:l.BKC_TOKEN,spender:l.FORTUNE_POOL,amount:d},validate:async(g,x)=>{if(d<=0n)throw new Error("Wager amount must be greater than 0");const{NetworkManager:h}=await Y(async()=>{const{NetworkManager:T}=await Promise.resolve().then(()=>ae);return{NetworkManager:T}},void 0),C=await h.getProvider().getBalance(x);if(m>0n&&C<m+o.parseEther("0.001"))throw new Error(`Insufficient ETH for fee (${o.formatEther(m)} ETH required)`)},onSuccess:async g=>{let x=null;try{const h=new o.Interface(ss);for(const C of g.logs)try{const T=h.parseLog(C);if(T.name==="GameCommitted"){x=Number(T.args.gameId);break}}catch{}}catch{}r&&r({gameId:x,txHash:g.hash,commitBlock:g.blockNumber,player:g.from})},onError:i})}async function Tr({gameId:e,guesses:t,userSecret:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers,o=t.map(l=>BigInt(l));return await j.execute({name:"RevealPlay",button:n,skipSimulation:!0,fixedGasLimit:500000n,getContract:async l=>ac(l),method:"revealPlay",args:[e,o,a],validate:async(l,d)=>{const u=await aa(),p=await u.getGameStatus(e);if(Number(p.status)===3)throw new Error("Game has expired.");if((await u.getGame(e)).player.toLowerCase()!==d.toLowerCase())throw new Error("You are not the owner of this game")},onSuccess:async l=>{let d=null,u=null;try{const p=new i.Interface(ss);for(const m of l.logs)try{const g=p.parseLog(m);g.name==="GameRevealed"?d={gameId:Number(g.args.gameId),grossWager:g.args.grossWager,prizeWon:g.args.prizeWon,tierMask:Number(g.args.tierMask),matchCount:Number(g.args.matchCount),won:g.args.prizeWon>0n}:g.name==="GameDetails"&&(u={guesses:g.args.guesses.map(x=>Number(x)),rolls:g.args.rolls.map(x=>Number(x)),matches:[...g.args.matches]})}catch{}}catch{}d&&u&&(d.rolls=u.rolls,d.guesses=u.guesses,d.matches=u.matches),cf(e),s&&s(l,d)},onError:r})}async function rc({wagerAmount:e,guess:t,guesses:a,tierMask:n=1,operator:s,button:r=null,onSuccess:i=null,onError:o=null}){const l=Number(n);if(l<1||l>7)throw new Error("tierMask must be 1-7");const d=df(l);let u=[];if(a&&Array.isArray(a)&&a.length>0)u=a.map(x=>Number(x));else if(t!==void 0)u=[Number(Array.isArray(t)?t[0]:t)];else throw new Error("Guess(es) required");if(u.length!==d)throw new Error(`tierMask selects ${d} tier(s) but ${u.length} guess(es) provided`);let p=0;for(let x=0;x<3;x++)if(l&1<<x){const h=yr[x].range;if(u[p]<1||u[p]>h)throw new Error(`Tier ${x} guess must be between 1 and ${h}`);p++}const m=sc(),g=nc(u,m);return await Er({commitmentHash:g,wagerAmount:e,tierMask:l,operator:s,button:r,onSuccess:x=>{lf(x.gameId,{guesses:u,userSecret:m,tierMask:l,wagerAmount:e.toString(),commitmentHash:g,player:x.player,commitTimestamp:Date.now()}),i&&i({...x,guesses:u,userSecret:m,tierMask:l})},onError:o})}async function ic(){const e=await aa();try{const t=await e.getAllTiers(),a=[];for(let n=0;n<3;n++)a.push({tierId:n,maxRange:Number(t.ranges[n]),multiplierBps:Number(t.multipliers[n]),multiplier:Number(t.multipliers[n])/1e4,winChanceBps:Number(t.winChances[n]),active:!0});return a}catch{return yr.map((t,a)=>({tierId:a,maxRange:t.range,multiplierBps:t.multiplierBps,multiplier:t.multiplierBps/1e4,active:!0}))}}async function oc(e){const t=await aa();try{const a=await t.getTierInfo(e);return{tierId:e,maxRange:Number(a.range),multiplierBps:Number(a.multiplier),multiplier:Number(a.multiplier)/1e4,winChanceBps:Number(a.winChanceBps)}}catch{return null}}async function lc(e=1){const t=window.ethers,a=Number(e);try{const n=[t.id("FORTUNE_TIER0"),t.id("FORTUNE_TIER1"),t.id("FORTUNE_TIER2")];let s=0n;for(let r=0;r<3;r++)a&1<<r&&(s+=await te(n[r]));return s}catch{return 0n}}async function cc(){const e=window.ethers,t=await aa();try{const a=await t.getPoolStats();return{prizePoolBalance:a[0],prizePoolFormatted:e.formatEther(a[0]),gameCounter:Number(a[1]),totalWageredAllTime:a[2],totalWageredFormatted:e.formatEther(a[2]),totalPaidOutAllTime:a[3],totalPaidOutFormatted:e.formatEther(a[3]),totalForfeited:a[4],totalBurned:a[5],maxPayoutNow:a[6],maxPayoutFormatted:e.formatEther(a[6])}}catch{const[a,n]=await Promise.all([t.gameCounter().catch(()=>0n),t.prizePool().catch(()=>0n)]);return{gameCounter:Number(a),prizePoolBalance:n,prizePoolFormatted:e.formatEther(n)}}}async function dc(){return 3}async function uc(e,t=1){const a=window.ethers,n=await aa();try{const s=await n.calculatePotentialWinnings(e,Number(t));return{netToPool:s.netToPool||s[0],bkcFee:s.bkcFee||s[1],maxPrize:s.maxPrize||s[2],maxPrizeFormatted:a.formatEther(s.maxPrize||s[2]),maxPrizeAfterCap:s.maxPrizeAfterCap||s[3],maxPrizeAfterCapFormatted:a.formatEther(s.maxPrizeAfterCap||s[3])}}catch{return{netToPool:0n,bkcFee:0n,maxPrize:0n,maxPrizeAfterCap:0n}}}async function pc(e){const t=await aa();try{const a=await t.getGameResult(e);return{player:a.player,grossWager:a.grossWager,prizeWon:a.prizeWon,tierMask:Number(a.tierMask),matchCount:Number(a.matchCount),revealBlock:Number(a.revealBlock),won:a.prizeWon>0n}}catch{return null}}async function fc(e){const t=await aa();try{const a=await t.getGameStatus(e);return{status:Number(a.status),statusName:["NONE","COMMITTED","REVEALED","EXPIRED"][Number(a.status)]||"UNKNOWN",canReveal:a.canReveal,isExpired:Number(a.status)===3,blocksUntilReveal:Number(a.blocksUntilReveal),blocksUntilExpiry:Number(a.blocksUntilExpiry)}}catch{return null}}function mc(){return rs()}function Cr(e){return rs()[e]||null}async function gc(e,t={}){const a=Cr(e);if(!a)throw new Error(`No pending game found with ID ${e}`);return await Tr({gameId:e,guesses:a.guesses,userSecret:a.userSecret,...t})}const Ir={commitPlay:Er,revealPlay:Tr,playGame:rc,revealPendingGame:gc,getPendingGamesForReveal:mc,getPendingGame:Cr,generateCommitmentHashLocal:nc,generateSecret:sc,getActiveTiers:ic,getTierById:oc,getServiceFee:lc,getPoolStats:cc,getActiveTierCount:dc,calculatePotentialWin:uc,getGameResult:pc,getCommitmentStatus:fc,TIERS:yr},uf=Object.freeze(Object.defineProperty({__proto__:null,FortuneTx:Ir,calculatePotentialWin:uc,commitPlay:Er,getActiveTierCount:dc,getActiveTiers:ic,getCommitmentStatus:fc,getGameResult:pc,getPendingGame:Cr,getPendingGamesForReveal:mc,getPoolStats:cc,getServiceFee:lc,getTierById:oc,playGame:rc,revealPendingGame:gc,revealPlay:Tr},Symbol.toStringTag,{value:"Module"}));function is(){var a,n;const e=(y==null?void 0:y.rentalManager)||(M==null?void 0:M.rentalManager)||((a=window.contractAddresses)==null?void 0:a.rentalManager),t=(y==null?void 0:y.rewardBooster)||(M==null?void 0:M.rewardBooster)||((n=window.contractAddresses)==null?void 0:n.rewardBooster);if(!e||!t)throw new Error("Contract addresses not loaded. Please refresh the page.");return{RENTAL_MANAGER:e,NFT_CONTRACT:t}}const Ar=["function listNFT(uint256 tokenId, uint96 pricePerHour, uint16 minHours, uint16 maxHours) external","function updateListing(uint256 tokenId, uint96 pricePerHour, uint16 minHours, uint16 maxHours) external","function withdrawNFT(uint256 tokenId) external","function rentNFT(uint256 tokenId, uint256 hours_, address operator) external payable","function withdrawEarnings() external","function getListing(uint256 tokenId) view returns (address owner, uint96 pricePerHour, uint16 minHours, uint16 maxHours, uint96 totalEarnings, uint32 rentalCount, bool currentlyRented, uint48 rentalEndTime)","function getAllListedTokenIds() view returns (uint256[])","function getListingCount() view returns (uint256)","function getRental(uint256 tokenId) view returns (address tenant, uint48 endTime, bool isActive)","function isRented(uint256 tokenId) view returns (bool)","function getRemainingTime(uint256 tokenId) view returns (uint256)","function hasActiveRental(address user) view returns (bool)","function getRentalCost(uint256 tokenId, uint256 hours_) view returns (uint256 rentalCost, uint256 ethFee, uint256 totalCost)","function pendingEarnings(address user) view returns (uint256)","function getStats() view returns (uint256 activeListings, uint256 volume, uint256 rentals, uint256 ethFees, uint256 earningsWithdrawn)","event NFTListed(uint256 indexed tokenId, address indexed owner, uint96 pricePerHour, uint16 minHours, uint16 maxHours)","event NFTRented(uint256 indexed tokenId, address indexed tenant, address indexed owner, uint256 hours_, uint256 rentalCost, uint256 ethFee, uint48 endTime, address operator)","event NFTWithdrawn(uint256 indexed tokenId, address indexed owner)","event EarningsWithdrawn(address indexed owner, uint256 amount)"],pf=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function ownerOf(uint256 tokenId) view returns (address)"];function Ja(e){const t=is();return new window.ethers.Contract(t.RENTAL_MANAGER,Ar,e)}async function $e(){const{NetworkManager:e}=await Y(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>ae);return{NetworkManager:a}},void 0),t=is();return new window.ethers.Contract(t.RENTAL_MANAGER,Ar,e.getProvider())}function ff(e){const t=is();return new window.ethers.Contract(t.NFT_CONTRACT,pf,e)}async function Pr({tokenId:e,pricePerHour:t,minHours:a,maxHours:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=is(),l=BigInt(t);return await j.execute({name:"ListNFT",button:s,getContract:async d=>Ja(d),method:"listNFT",args:[e,l,a,n],validate:async(d,u)=>{const p=ff(d);if((await p.ownerOf(e)).toLowerCase()!==u.toLowerCase())throw new Error("You do not own this NFT");if(!await p.isApprovedForAll(u,o.RENTAL_MANAGER)){const{NetworkManager:x}=await Y(async()=>{const{NetworkManager:A}=await Promise.resolve().then(()=>ae);return{NetworkManager:A}},void 0),h=await x.getProvider().getFeeData(),C={gasLimit:100000n};h.maxFeePerGas&&(C.maxFeePerGas=h.maxFeePerGas*120n/100n,C.maxPriorityFeePerGas=h.maxPriorityFeePerGas||0n),await(await p.setApprovalForAll(o.RENTAL_MANAGER,!0,C)).wait()}},onSuccess:r,onError:i})}async function Br({tokenId:e,hours:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers;let o=a,l=0n;return await j.execute({name:"RentNFT",button:n,getContract:async d=>Ja(d),method:"rentNFT",args:()=>[e,t,Z(o)],get value(){return l},validate:async(d,u)=>{const p=await $e(),m=await p.getListing(e);if(m.owner===i.ZeroAddress)throw new Error("NFT is not listed for rent");if(m.currentlyRented)throw new Error("NFT is currently rented");if(t<Number(m.minHours)||t>Number(m.maxHours))throw new Error(`Hours must be between ${m.minHours} and ${m.maxHours}`);const g=await p.getRentalCost(e,t),x=g.rentalCost||g[0],h=await te(i.id("RENTAL_RENT"),x);l=x+h;const{NetworkManager:C}=await Y(async()=>{const{NetworkManager:A}=await Promise.resolve().then(()=>ae);return{NetworkManager:A}},void 0);if(await C.getProvider().getBalance(u)<l+i.parseEther("0.001"))throw new Error(`Insufficient ETH. Need ${i.formatEther(l)} ETH + gas`)},onSuccess:async d=>{let u=null;try{const p=new i.Interface(Ar);for(const m of d.logs)try{const g=p.parseLog(m);if((g==null?void 0:g.name)==="NFTRented"){u={endTime:Number(g.args.endTime),rentalCost:g.args.rentalCost,ethFee:g.args.ethFee};break}}catch{}}catch{}s&&s(d,u)},onError:r})}async function Sr({tokenId:e,button:t=null,onSuccess:a=null,onError:n=null}){const s=window.ethers;return await j.execute({name:"WithdrawNFT",button:t,getContract:async r=>Ja(r),method:"withdrawNFT",args:[e],validate:async(r,i)=>{const l=await(await $e()).getListing(e);if(l.owner===s.ZeroAddress)throw new Error("NFT is not listed");if(l.owner.toLowerCase()!==i.toLowerCase())throw new Error("Only the owner can withdraw");if(l.currentlyRented)throw new Error("Cannot withdraw while NFT is rented")},onSuccess:a,onError:n})}async function bc({button:e=null,onSuccess:t=null,onError:a=null}={}){const n=window.ethers;return await j.execute({name:"WithdrawEarnings",button:e,getContract:async s=>Ja(s),method:"withdrawEarnings",args:[],validate:async(s,r)=>{const o=await(await $e()).pendingEarnings(r);if(o===0n)throw new Error("No earnings to withdraw");console.log("[RentalTx] Withdrawing:",n.formatEther(o),"ETH")},onSuccess:t,onError:a})}async function xc({tokenId:e,pricePerHour:t,minHours:a,maxHours:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=BigInt(t);return await j.execute({name:"UpdateListing",button:s,getContract:async l=>Ja(l),method:"updateListing",args:[e,o,a,n],validate:async(l,d)=>{const p=await(await $e()).getListing(e);if(p.owner===window.ethers.ZeroAddress)throw new Error("NFT is not listed");if(p.owner.toLowerCase()!==d.toLowerCase())throw new Error("Only the owner can update")},onSuccess:r,onError:i})}async function hc(e){const t=window.ethers,n=await(await $e()).getListing(e);return{owner:n.owner,pricePerHour:n.pricePerHour,pricePerHourFormatted:t.formatEther(n.pricePerHour),minHours:Number(n.minHours),maxHours:Number(n.maxHours),totalEarnings:n.totalEarnings,totalEarningsFormatted:t.formatEther(n.totalEarnings),rentalCount:Number(n.rentalCount),isActive:n.owner!==t.ZeroAddress,currentlyRented:n.currentlyRented,rentalEndTime:Number(n.rentalEndTime)}}async function vc(e){const a=await(await $e()).getRental(e),n=Math.floor(Date.now()/1e3),s=Number(a.endTime);return{tenant:a.tenant,endTime:s,isActive:a.isActive,hoursRemaining:a.isActive?Math.max(0,Math.ceil((s-n)/3600)):0}}async function wc(){return(await(await $e()).getAllListedTokenIds()).map(a=>Number(a))}async function yc(){const e=await $e();return Number(await e.getListingCount())}async function kc(e,t){const a=window.ethers,s=await(await $e()).getRentalCost(e,t),r=s.rentalCost||s[0],i=await te(a.id("RENTAL_RENT"),r),o=r+i;return{rentalCost:r,rentalCostFormatted:a.formatEther(r),ethFee:i,ethFeeFormatted:a.formatEther(i),totalCost:o,totalCostFormatted:a.formatEther(o)}}async function Ec(e){return await(await $e()).isRented(e)}async function Tc(e){const t=await $e();return Number(await t.getRemainingTime(e))}async function Cc(e){const t=await $e();try{return await t.hasActiveRental(e)}catch{return!1}}async function Ic(e){const t=window.ethers,n=await(await $e()).pendingEarnings(e);return{amount:n,formatted:t.formatEther(n)}}async function Ac(){const e=window.ethers,t=await $e();try{const a=await t.getStats();return{activeListings:Number(a.activeListings||a[0]),totalVolume:a.volume||a[1],totalVolumeFormatted:e.formatEther(a.volume||a[1]),totalRentals:Number(a.rentals||a[2]),totalEthFees:a.ethFees||a[3],totalEthFeesFormatted:e.formatEther(a.ethFees||a[3]),totalEarningsWithdrawn:a.earningsWithdrawn||a[4],totalEarningsWithdrawnFormatted:e.formatEther(a.earningsWithdrawn||a[4])}}catch{return{activeListings:0,totalVolume:0n,totalVolumeFormatted:"0",totalRentals:0,totalEthFees:0n,totalEthFeesFormatted:"0"}}}const Pc=Pr,Bc=Br,Sc=Sr,zt={listNft:Pr,rentNft:Br,withdrawNft:Sr,withdrawEarnings:bc,updateListing:xc,list:Pc,rent:Bc,withdraw:Sc,getListing:hc,getAllListedTokenIds:wc,getListingCount:yc,getRentalCost:kc,getRental:vc,isRented:Ec,getRemainingRentalTime:Tc,hasActiveRental:Cc,getPendingEarnings:Ic,getMarketplaceStats:Ac},mf=Object.freeze(Object.defineProperty({__proto__:null,RentalTx:zt,getAllListedTokenIds:wc,getListing:hc,getListingCount:yc,getMarketplaceStats:Ac,getPendingEarnings:Ic,getRemainingRentalTime:Tc,getRental:vc,getRentalCost:kc,hasActiveRental:Cc,isRented:Ec,list:Pc,listNft:Pr,rent:Bc,rentNft:Br,updateListing:xc,withdraw:Sc,withdrawEarnings:bc,withdrawNft:Sr},Symbol.toStringTag,{value:"Module"}));function zc(){var t;const e=(y==null?void 0:y.notary)||(M==null?void 0:M.notary)||((t=window.contractAddresses)==null?void 0:t.notary);if(!e)throw console.error("âŒ Notary address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{NOTARY:e}}const zr=["function certify(bytes32 documentHash, string calldata meta, uint8 docType, address operator) external payable returns (uint256 certId)","function batchCertify(bytes32[] calldata documentHashes, string[] calldata metas, uint8[] calldata docTypes, address operator) external payable returns (uint256 startId)","function transferCertificate(bytes32 documentHash, address newOwner) external","function verify(bytes32 documentHash) view returns (bool exists, address owner, uint48 timestamp, uint8 docType, string memory meta)","function getCertificate(uint256 certId) view returns (bytes32 documentHash, address owner, uint48 timestamp, uint8 docType, string memory meta)","function getFee() view returns (uint256)","function getStats() view returns (uint256 certCount, uint256 totalEthCollected)","function certCount() view returns (uint256)","function version() view returns (string)","event Certified(uint256 indexed certId, address indexed owner, bytes32 indexed documentHash, uint8 docType, address operator)","event BatchCertified(address indexed owner, uint256 startId, uint256 count, address operator)","event CertificateTransferred(bytes32 indexed documentHash, address indexed from, address indexed to)"],gf={GENERAL:0,CONTRACT:1,IDENTITY:2,DIPLOMA:3,PROPERTY:4,FINANCIAL:5,LEGAL:6,MEDICAL:7,IP:8,OTHER:9};function bf(e){const t=window.ethers;if(!t)throw new Error("ethers.js not loaded");if(!e)throw new Error("Signer is required for write operations");const a=zc();return new t.Contract(a.NOTARY,zr,e)}async function Ia(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");const{NetworkManager:t}=await Y(async()=>{const{NetworkManager:s}=await Promise.resolve().then(()=>ae);return{NetworkManager:s}},void 0),a=t.getProvider();if(!a)throw new Error("Provider not available");const n=zc();return new e.Contract(n.NOTARY,zr,a)}function xf(e){if(!e)return!1;const t=e.startsWith("0x")?e:`0x${e}`;return/^0x[a-fA-F0-9]{64}$/.test(t)}async function Nr({documentHash:e,meta:t="",docType:a=0,operator:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=window.ethers;if(!e)throw new Error("Document hash is required");const l=e.startsWith("0x")?e:`0x${e}`;if(!xf(l))throw new Error("Invalid document hash format. Must be a valid bytes32 (64 hex characters)");if(a<0||a>9)throw new Error("Document type must be between 0 and 9");let d=n,u=0n;return await j.execute({name:"Certify",button:s,getContract:async p=>bf(p),method:"certify",args:()=>[l,t||"",a,Z(d)],get value(){return u},validate:async(p,m)=>{const g=await Ia();if((await g.verify(l)).exists)throw new Error("This document hash has already been certified");u=await g.getFee(),console.log("[NotaryTx] Fee:",o.formatEther(u),"ETH");const{NetworkManager:h}=await Y(async()=>{const{NetworkManager:B}=await Promise.resolve().then(()=>ae);return{NetworkManager:B}},void 0),T=await h.getProvider().getBalance(m),A=u+o.parseEther("0.001");if(T<A)throw new Error(`Insufficient ETH. Need ~${o.formatEther(A)} ETH for fee + gas`)},onSuccess:async p=>{let m=null;try{const g=new o.Interface(zr);for(const x of p.logs)try{const h=g.parseLog(x);if(h&&h.name==="Certified"){m=Number(h.args.certId);break}}catch{}}catch{}r&&r(p,m)},onError:p=>{console.error("[NotaryTx] Certification failed:",p),i&&i(p)}})}const Nc=Nr;async function os(e){const t=await Ia(),a=e.startsWith("0x")?e:`0x${e}`;try{const n=await t.verify(a);return{exists:n.exists,owner:n.exists?n.owner:null,timestamp:n.exists?Number(n.timestamp):null,date:n.exists?new Date(Number(n.timestamp)*1e3):null,docType:n.exists?Number(n.docType):null,meta:n.exists?n.meta:null}}catch(n){return console.error("[NotaryTx] verify error:",n),{exists:!1,owner:null,timestamp:null,date:null,docType:null,meta:null}}}const $c=os;async function $r(e){const t=await Ia();try{const a=await t.getCertificate(e);return a.documentHash==="0x"+"0".repeat(64)?null:{id:e,documentHash:a.documentHash,owner:a.owner,timestamp:Number(a.timestamp),date:new Date(Number(a.timestamp)*1e3),docType:Number(a.docType),meta:a.meta}}catch{return null}}const Lc=$r;async function Rc(){const e=window.ethers,a=await(await Ia()).getFee();return{ethFee:a,ethFormatted:e.formatEther(a)+" ETH"}}async function _c(){const e=await Ia();return Number(await e.certCount())}async function Fc(){const e=window.ethers,a=await(await Ia()).getStats();return{totalCertifications:Number(a.certCount||a[0]),totalETHCollected:a.totalEthCollected||a[1],totalETHFormatted:e.formatEther(a.totalEthCollected||a[1])}}async function ls(e){let t;if(e instanceof ArrayBuffer)t=e;else if(e instanceof Blob||e instanceof File)t=await e.arrayBuffer();else throw new Error("Invalid file type. Expected File, Blob, or ArrayBuffer");const a=await crypto.subtle.digest("SHA-256",t);return"0x"+Array.from(new Uint8Array(a)).map(s=>s.toString(16).padStart(2,"0")).join("")}async function Lr(e,t){const a=await ls(e);return Ri(t)===Ri(a)}function Ri(e){return(e.startsWith("0x")?e:`0x${e}`).toLowerCase()}async function Mc(e,t){const a=t||await ls(e),n=await os(a);let s=!0;return t&&(s=await Lr(e,t)),{contentHash:a,hashMatches:s,existsOnChain:n.exists,certId:null,owner:n.owner,timestamp:n.timestamp,date:n.date,docType:n.docType,isVerified:s&&n.exists}}const pt={certify:Nr,notarize:Nc,verify:os,verifyByHash:$c,getCertificate:$r,getDocument:Lc,getTotalDocuments:_c,getFee:Rc,getStats:Fc,calculateFileHash:ls,verifyDocumentHash:Lr,verifyDocumentOnChain:Mc,DOC_TYPES:gf},hf=Object.freeze(Object.defineProperty({__proto__:null,NotaryTx:pt,calculateFileHash:ls,certify:Nr,getCertificate:$r,getDocument:Lc,getFee:Rc,getStats:Fc,getTotalDocuments:_c,notarize:Nc,verify:os,verifyByHash:$c,verifyDocumentHash:Lr,verifyDocumentOnChain:Mc},Symbol.toStringTag,{value:"Module"}));function Dc(){var t;const e=(y==null?void 0:y.agora)||(M==null?void 0:M.agora)||((t=window.contractAddresses)==null?void 0:t.agora);if(!e)throw new Error("Agora contract address not loaded");return{AGORA:e}}const cs=ea;function he(e){return new window.ethers.Contract(Dc().AGORA,cs,e)}async function we(){const{NetworkManager:e}=await Y(async()=>{const{NetworkManager:t}=await Promise.resolve().then(()=>ae);return{NetworkManager:t}},void 0);return new window.ethers.Contract(Dc().AGORA,cs,e.getProvider())}async function Oc({username:e,metadataURI:t="",operator:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers;let o=a,l=0n;return await j.execute({name:"CreateProfile",button:n,skipSimulation:!0,fixedGasLimit:300000n,getContract:async d=>he(d),method:"createProfile",args:()=>[e,t||"",Z(o)],get value(){return l},validate:async(d,u)=>{const p=await we();if(!e||e.length<1||e.length>15)throw new Error("Username must be 1-15 characters");if(!/^[a-z0-9_]+$/.test(e))throw new Error("Username: lowercase letters, numbers, underscores only");if(!await p.isUsernameAvailable(e))throw new Error("Username is already taken");l=await p.getUsernamePrice(e.length),console.log("[Agora] Username fee:",i.formatEther(l),"ETH");const{NetworkManager:g}=await Y(async()=>{const{NetworkManager:h}=await Promise.resolve().then(()=>ae);return{NetworkManager:h}},void 0);if(await g.getProvider().getBalance(u)<l+i.parseEther("0.001"))throw new Error(`Insufficient ETH. Need ~${i.formatEther(l+i.parseEther("0.001"))} ETH`)},onSuccess:s,onError:r})}async function Hc({metadataURI:e,button:t=null,onSuccess:a=null,onError:n=null}){return await j.execute({name:"UpdateProfile",button:t,skipSimulation:!0,fixedGasLimit:200000n,getContract:async s=>he(s),method:"updateProfile",args:[e||""],onSuccess:a,onError:n})}async function Uc({content:e,tag:t=0,contentType:a=0,operator:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=window.ethers;let l=n,d=0n;return await j.execute({name:"CreatePost",button:s,skipSimulation:!0,fixedGasLimit:300000n,getContract:async u=>he(u),method:"createPost",args:()=>[e,t,a,Z(l)],get value(){return d},validate:async(u,p)=>{if(!e||e.length===0)throw new Error("Content is required");if(t<0||t>14)throw new Error("Tag must be 0-14");const g={0:"AGORA_POST",1:"AGORA_POST_IMAGE",2:"AGORA_POST_VIDEO",3:"AGORA_POST",4:"AGORA_LIVE"}[a]||"AGORA_POST";d=await te(o.id(g),0n),console.log(`[Agora] Post fee (${g}):`,o.formatEther(d),"ETH")},onSuccess:async u=>{let p=null;try{const m=new o.Interface(cs);for(const g of u.logs)try{const x=m.parseLog(g);if((x==null?void 0:x.name)==="PostCreated"){p=Number(x.args[0]);break}}catch{}}catch{}r&&r(u,p)},onError:i})}async function jc({parentId:e,content:t,contentType:a=0,operator:n,button:s=null,onSuccess:r=null,onError:i=null}){const o=window.ethers;let l=n,d=0n;return await j.execute({name:"CreateReply",button:s,skipSimulation:!0,fixedGasLimit:350000n,getContract:async u=>he(u),method:"createReply",args:()=>[e,t,a,Z(l)],get value(){return d},validate:async(u,p)=>{if(!t)throw new Error("Content is required");d=await te(o.id("AGORA_REPLY"),0n)},onSuccess:async u=>{let p=null;try{const m=new o.Interface(cs);for(const g of u.logs)try{const x=m.parseLog(g);if((x==null?void 0:x.name)==="ReplyCreated"){p=Number(x.args[0]);break}}catch{}}catch{}r&&r(u,p)},onError:i})}async function Wc({originalPostId:e,quote:t="",operator:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers;let o=a,l=0n;return await j.execute({name:"CreateRepost",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async d=>he(d),method:"createRepost",args:()=>[e,t||"",Z(o)],get value(){return l},validate:async()=>{l=await te(i.id("AGORA_REPOST"),0n)},onSuccess:s,onError:r})}async function Gc({postId:e,operator:t,button:a=null,onSuccess:n=null,onError:s=null}){const r=window.ethers;let i=t,o=0n;return await j.execute({name:"Like",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async l=>he(l),method:"like",args:()=>[e,Z(i)],get value(){return o},validate:async(l,d)=>{if(await(await we()).hasLiked(e,d))throw new Error("Already liked this post");o=await te(r.id("AGORA_LIKE"),0n)},onSuccess:n,onError:s})}async function Yc({postId:e,ethAmount:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){let i=a;const o=BigInt(t);return await j.execute({name:"SuperLike",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async l=>he(l),method:"superLike",args:()=>[e,Z(i)],value:o,validate:async()=>{if(o<100000000n)throw new Error("Minimum super like is 100 gwei")},onSuccess:s,onError:r})}async function Kc({postId:e,ethAmount:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){let i=a;const o=BigInt(t);return await j.execute({name:"Downvote",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async l=>he(l),method:"downvote",args:()=>[e,Z(i)],value:o,validate:async()=>{if(o<100000000n)throw new Error("Minimum downvote is 100 gwei")},onSuccess:s,onError:r})}async function Vc({toFollow:e,operator:t,button:a=null,onSuccess:n=null,onError:s=null}){const r=window.ethers;let i=t,o=0n;return await j.execute({name:"Follow",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async l=>he(l),method:"follow",args:()=>[e,Z(i)],get value(){return o},validate:async(l,d)=>{if(!e||e==="0x0000000000000000000000000000000000000000")throw new Error("Invalid address");if(e.toLowerCase()===d.toLowerCase())throw new Error("Cannot follow yourself");o=await te(r.id("AGORA_FOLLOW"),0n)},onSuccess:n,onError:s})}async function qc({toUnfollow:e,button:t=null,onSuccess:a=null,onError:n=null}){return await j.execute({name:"Unfollow",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async s=>he(s),method:"unfollow",args:[e],onSuccess:a,onError:n})}async function Xc({postId:e,button:t=null,onSuccess:a=null,onError:n=null}){return await j.execute({name:"DeletePost",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async s=>he(s),method:"deletePost",args:[e],onSuccess:a,onError:n})}async function Jc({postId:e,button:t=null,onSuccess:a=null,onError:n=null}){return await j.execute({name:"PinPost",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async s=>he(s),method:"pinPost",args:[e],onSuccess:a,onError:n})}async function Zc({postId:e,newTag:t,button:a=null,onSuccess:n=null,onError:s=null}){return await j.execute({name:"ChangeTag",button:a,skipSimulation:!0,fixedGasLimit:100000n,getContract:async r=>he(r),method:"changeTag",args:[e,t],onSuccess:n,onError:s})}async function Qc({days:e=1,operator:t,button:a=null,onSuccess:n=null,onError:s=null}){const r=window.ethers;let i=t;const o=r.id("AGORA_PROFILE_BOOST"),d=await te(o)*BigInt(e);return await j.execute({name:"BoostProfile",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async u=>he(u),method:"boostProfile",args:()=>[Z(i)],value:d,onSuccess:n,onError:s})}async function ed({tier:e=0,operator:t,button:a=null,onSuccess:n=null,onError:s=null}){const r=window.ethers;let i=t;const o=["AGORA_BADGE_VERIFIED","AGORA_BADGE_PREMIUM","AGORA_BADGE_ELITE"],l=r.id(o[e]||o[0]),d=await te(l);return await j.execute({name:"ObtainBadge",button:a,skipSimulation:!0,fixedGasLimit:250000n,getContract:async u=>he(u),method:"obtainBadge",args:()=>[e,Z(i)],value:d,onSuccess:n,onError:s})}async function td({postId:e,category:t=0,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){const i=window.ethers;let o=a;const l=i.id("AGORA_REPORT"),d=await te(l);return await j.execute({name:"ReportPost",button:n,skipSimulation:!0,fixedGasLimit:200000n,getContract:async u=>he(u),method:"reportPost",args:()=>[e,t,Z(o)],value:d,validate:async(u,p)=>{if(await(await we()).hasReported(e,p))throw new Error("You already reported this post")},onSuccess:s,onError:r})}async function ad({postId:e,tier:t=0,ethAmount:a,operator:n,button:s=null,onSuccess:r=null,onError:i=null}){let o=n;const l=BigInt(a);return await j.execute({name:"BoostPost",button:s,skipSimulation:!0,fixedGasLimit:250000n,getContract:async d=>he(d),method:"boostPost",args:()=>[e,t,Z(o)],value:l,validate:async()=>{const d=window.ethers,u=t===1?d.parseEther("0.01"):d.parseEther("0.002");if(l<u)throw new Error(`Minimum boost is ${d.formatEther(u)} ETH/day`)},onSuccess:r,onError:i})}async function nd({postId:e,ethAmount:t,operator:a,button:n=null,onSuccess:s=null,onError:r=null}){let i=a;const o=BigInt(t);return await j.execute({name:"TipPost",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async l=>he(l),method:"tipPost",args:()=>[e,Z(i)],value:o,validate:async()=>{const l=window.ethers;if(o<l.parseEther("0.0001"))throw new Error("Minimum tip is 0.0001 ETH")},onSuccess:s,onError:r})}async function Rr(e){const t=window.ethers,n=await(await we()).getUsernamePrice(e);return{fee:n,formatted:t.formatEther(n)}}const sd=Rr;async function rd(e){const a=await(await we()).getPost(e);return{author:a.author,tag:Number(a.tag),contentType:Number(a.contentType),deleted:a.deleted,createdAt:Number(a.createdAt),replyTo:Number(a._replyTo),repostOf:Number(a._repostOf),likes:Number(a.likes),superLikes:Number(a.superLikes),downvotes:Number(a.downvotes),replies:Number(a.replies),reposts:Number(a.reposts)}}async function id(){const e=await we();return Number(await e.postCounter())}async function od(e){const a=await(await we()).getUserProfile(e);return{usernameHash:a.usernameHash,metadataURI:a.metadataURI,pinnedPost:Number(a.pinned),boosted:a.boosted,hasBadge:a.hasBadge,badgeTier:Number(a.badgeTier||a._badgeTier||0),boostExpiry:Number(a.boostExp),badgeExpiry:Number(a.badgeExp)}}async function ld(e){const a=await(await we()).getPostMeta(e);return{reports:Number(a.reports),illegalReports:Number(a.illegalReports),boostTier:Number(a.boostTier),boostExpiry:Number(a.boostExp),isBoosted:a.isBoosted,boostSpent:a.boostSpent,tips:a.tips}}async function cd(e){return await(await we()).isUsernameAvailable(e)}async function dd(e,t){return await(await we()).hasLiked(e,t)}async function ud(e){return await(await we()).isProfileBoosted(e)}async function pd(e){return await(await we()).hasTrustBadge(e)}async function fd(e){const a=await(await we()).getUserProfile(e);return Number(a.boostExp)}async function md(e){const a=await(await we()).getUserProfile(e);return Number(a.badgeExp)}async function gd(){const t=await(await we()).getGlobalStats();return{totalPosts:Number(t._totalPosts||t[0]),totalProfiles:Number(t._totalProfiles||t[1]),tagCounts:(t._tagCounts||t[2]).map(a=>Number(a))}}async function bd(e){const a=await(await we()).getOperatorStats(e);return{posts:Number(a.posts_||a[0]),engagement:Number(a.engagement||a[1])}}async function xd(){return await(await we()).version()}const le={createProfile:Oc,updateProfile:Hc,createPost:Uc,createReply:jc,createRepost:Wc,deletePost:Xc,pinPost:Jc,changeTag:Zc,like:Gc,superLike:Yc,downvote:Kc,follow:Vc,unfollow:qc,reportPost:td,boostPost:ad,tipPost:nd,boostProfile:Qc,obtainBadge:ed,getUsernamePrice:Rr,getUsernameFee:sd,getPost:rd,getPostMeta:ld,getPostCount:id,getUserProfile:od,isUsernameAvailable:cd,hasUserLiked:dd,isProfileBoosted:ud,hasTrustBadge:pd,getBoostExpiry:fd,getBadgeExpiry:md,getGlobalStats:gd,getOperatorStats:bd,getVersion:xd},vf=Object.freeze(Object.defineProperty({__proto__:null,BackchatTx:le,boostPost:ad,boostProfile:Qc,changeTag:Zc,createPost:Uc,createProfile:Oc,createReply:jc,createRepost:Wc,deletePost:Xc,downvote:Kc,follow:Vc,getBadgeExpiry:md,getBoostExpiry:fd,getGlobalStats:gd,getOperatorStats:bd,getPost:rd,getPostCount:id,getPostMeta:ld,getUserProfile:od,getUsernameFee:sd,getUsernamePrice:Rr,getVersion:xd,hasTrustBadge:pd,hasUserLiked:dd,isProfileBoosted:ud,isUsernameAvailable:cd,like:Gc,obtainBadge:ed,pinPost:Jc,reportPost:td,superLike:Yc,tipPost:nd,unfollow:qc,updateProfile:Hc},Symbol.toStringTag,{value:"Module"}));(async()=>(await Y(async()=>{const{CharityTx:e}=await Promise.resolve().then(()=>af);return{CharityTx:e}},void 0)).CharityTx)(),(async()=>(await Y(async()=>{const{StakingTx:e}=await Promise.resolve().then(()=>nf);return{StakingTx:e}},void 0)).StakingTx)(),(async()=>(await Y(async()=>{const{NftTx:e}=await Promise.resolve().then(()=>of);return{NftTx:e}},void 0)).NftTx)(),(async()=>(await Y(async()=>{const{FortuneTx:e}=await Promise.resolve().then(()=>uf);return{FortuneTx:e}},void 0)).FortuneTx)(),(async()=>(await Y(async()=>{const{RentalTx:e}=await Promise.resolve().then(()=>mf);return{RentalTx:e}},void 0)).RentalTx)(),(async()=>(await Y(async()=>{const{NotaryTx:e}=await Promise.resolve().then(()=>hf);return{NotaryTx:e}},void 0)).NotaryTx)(),(async()=>(await Y(async()=>{const{FaucetTx:e}=await Promise.resolve().then(()=>Kp);return{FaucetTx:e}},void 0)).FaucetTx)(),(async()=>(await Y(async()=>{const{BackchatTx:e}=await Promise.resolve().then(()=>vf);return{BackchatTx:e}},void 0)).BackchatTx)();const va=window.ethers,_={hasRenderedOnce:!1,lastUpdate:0,activities:[],networkActivities:[],filteredActivities:[],userProfile:null,pagination:{currentPage:1,itemsPerPage:8},filters:{type:"ALL",sort:"NEWEST"},metricsCache:{},economicData:null,isLoadingNetworkActivity:!1,networkActivitiesTimestamp:0,faucet:{canClaim:!0,cooldownEnd:null,isLoading:!1,lastCheck:0}},_i="https://sepolia.arbiscan.io/tx/",wf="/api/faucet",yf="https://getrecentactivity-4wvdcuoouq-uc.a.run.app",kf="https://getsystemdata-4wvdcuoouq-uc.a.run.app",_r="1,000",Fr="0.01",F={STAKING:{icon:"fa-lock",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”’ Staked",emoji:"ðŸ”’"},UNSTAKING:{icon:"fa-unlock",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ”“ Unstaked",emoji:"ðŸ”“"},FORCE_UNSTAKE:{icon:"fa-bolt",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"âš¡ Force Unstaked",emoji:"âš¡"},CLAIM:{icon:"fa-coins",color:"#fbbf24",bg:"rgba(245,158,11,0.15)",label:"ðŸª™ Rewards Claimed",emoji:"ðŸª™"},NFT_BUY:{icon:"fa-bag-shopping",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ›ï¸ Bought NFT",emoji:"ðŸ›ï¸"},NFT_SELL:{icon:"fa-hand-holding-dollar",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ’° Sold NFT",emoji:"ðŸ’°"},NFT_MINT:{icon:"fa-gem",color:"#fde047",bg:"rgba(234,179,8,0.15)",label:"ðŸ’Ž Minted Booster",emoji:"ðŸ’Ž"},NFT_TRANSFER:{icon:"fa-arrow-right-arrow-left",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"â†”ï¸ Transfer",emoji:"â†”ï¸"},RENTAL_LIST:{icon:"fa-tag",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ·ï¸ Listed NFT",emoji:"ðŸ·ï¸"},RENTAL_RENT:{icon:"fa-clock",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"â° Rented NFT",emoji:"â°"},RENTAL_WITHDRAW:{icon:"fa-rotate-left",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"â†©ï¸ Withdrawn",emoji:"â†©ï¸"},RENTAL_PROMOTE:{icon:"fa-bullhorn",color:"#fbbf24",bg:"rgba(251,191,36,0.2)",label:"ðŸ“¢ Promoted NFT",emoji:"ðŸ“¢"},FORTUNE_COMMIT:{icon:"fa-lock",color:"#a855f7",bg:"rgba(168,85,247,0.2)",label:"ðŸ” Game Committed",emoji:"ðŸ”"},FORTUNE_REVEAL:{icon:"fa-dice",color:"#f97316",bg:"rgba(249,115,22,0.2)",label:"ðŸŽ² Game Revealed",emoji:"ðŸŽ²"},FORTUNE_BET:{icon:"fa-paw",color:"#f97316",bg:"rgba(249,115,22,0.2)",label:"ðŸ¯ Fortune Bet",emoji:"ðŸ¯"},FORTUNE_COMBO:{icon:"fa-rocket",color:"#a855f7",bg:"rgba(168,85,247,0.2)",label:"ðŸš€ Combo Mode",emoji:"ðŸš€"},FORTUNE_WIN:{icon:"fa-trophy",color:"#facc15",bg:"rgba(234,179,8,0.25)",label:"ðŸ† Winner!",emoji:"ðŸ†"},NOTARY:{icon:"fa-stamp",color:"#818cf8",bg:"rgba(99,102,241,0.15)",label:"ðŸ“œ Notarized",emoji:"ðŸ“œ"},BACKCHAT_POST:{icon:"fa-comment",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ’¬ Posted",emoji:"ðŸ’¬"},BACKCHAT_LIKE:{icon:"fa-heart",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"â¤ï¸ Liked",emoji:"â¤ï¸"},BACKCHAT_REPLY:{icon:"fa-reply",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"â†©ï¸ Replied",emoji:"â†©ï¸"},BACKCHAT_SUPERLIKE:{icon:"fa-star",color:"#fbbf24",bg:"rgba(251,191,36,0.2)",label:"â­ Super Liked",emoji:"â­"},BACKCHAT_REPOST:{icon:"fa-retweet",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”„ Reposted",emoji:"ðŸ”„"},BACKCHAT_FOLLOW:{icon:"fa-user-plus",color:"#a78bfa",bg:"rgba(167,139,250,0.15)",label:"ðŸ‘¥ Followed",emoji:"ðŸ‘¥"},BACKCHAT_PROFILE:{icon:"fa-user",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"ðŸ‘¤ Profile Created",emoji:"ðŸ‘¤"},BACKCHAT_BOOST:{icon:"fa-rocket",color:"#f97316",bg:"rgba(249,115,22,0.15)",label:"ðŸš€ Profile Boosted",emoji:"ðŸš€"},BACKCHAT_BADGE:{icon:"fa-circle-check",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"âœ… Badge Activated",emoji:"âœ…"},BACKCHAT_TIP:{icon:"fa-coins",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"ðŸ’° Tipped BKC",emoji:"ðŸ’°"},BACKCHAT_WITHDRAW:{icon:"fa-wallet",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ’¸ ETH Withdrawn",emoji:"ðŸ’¸"},CHARITY_DONATE:{icon:"fa-heart",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"ðŸ’ Donated",emoji:"ðŸ’"},CHARITY_CREATE:{icon:"fa-hand-holding-heart",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"ðŸŒ± Campaign Created",emoji:"ðŸŒ±"},CHARITY_CANCEL:{icon:"fa-heart-crack",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ’” Campaign Cancelled",emoji:"ðŸ’”"},CHARITY_WITHDRAW:{icon:"fa-hand-holding-dollar",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ’° Funds Withdrawn",emoji:"ðŸ’°"},CHARITY_GOAL_REACHED:{icon:"fa-trophy",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"ðŸ† Goal Reached!",emoji:"ðŸ†"},FAUCET:{icon:"fa-droplet",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ’§ Faucet Claim",emoji:"ðŸ’§"},FEE_COLLECTED:{icon:"fa-receipt",color:"#f59e0b",bg:"rgba(245,158,11,0.15)",label:"ðŸ§¾ Fee Collected",emoji:"ðŸ§¾"},REFERRER_SET:{icon:"fa-link",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ”— Referral Set",emoji:"ðŸ”—"},BUYBACK:{icon:"fa-hammer",color:"#f97316",bg:"rgba(249,115,22,0.15)",label:"â›ï¸ Buyback",emoji:"â›ï¸"},SWAP:{icon:"fa-arrow-right-arrow-left",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ”„ Swap",emoji:"ðŸ”„"},LIQUIDITY_ADD:{icon:"fa-droplet",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ’§ Liquidity Added",emoji:"ðŸ’§"},LIQUIDITY_REMOVE:{icon:"fa-droplet-slash",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ’§ Liquidity Removed",emoji:"ðŸ’§"},RENTAL_EARNINGS:{icon:"fa-money-bill-wave",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ’° Earnings Withdrawn",emoji:"ðŸ’°"},FORTUNE_EXPIRED:{icon:"fa-hourglass-end",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"â° Game Expired",emoji:"â°"},CHARITY_BOOST:{icon:"fa-rocket",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"ðŸš€ Campaign Boosted",emoji:"ðŸš€"},CHARITY_CLOSED:{icon:"fa-lock",color:"#71717a",bg:"rgba(39,39,42,0.5)",label:"ðŸ”’ Campaign Closed",emoji:"ðŸ”’"},AGORA_DOWNVOTE:{icon:"fa-thumbs-down",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ‘Ž Downvoted",emoji:"ðŸ‘Ž"},AGORA_UNFOLLOW:{icon:"fa-user-minus",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ‘¤ Unfollowed",emoji:"ðŸ‘¤"},DEFAULT:{icon:"fa-circle",color:"#71717a",bg:"rgba(39,39,42,0.5)",label:"Activity",emoji:"ðŸ“‹"}};function Ef(e){if(!e)return"Just now";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3,a=new Date(t*1e3),s=new Date-a,r=Math.floor(s/6e4),i=Math.floor(s/36e5),o=Math.floor(s/864e5);return r<1?"Just now":r<60?`${r}m ago`:i<24?`${i}h ago`:o<7?`${o}d ago`:a.toLocaleDateString()}catch{return"Recent"}}function Tf(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function pn(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toFixed(0)}function Cf(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function If(e,t={}){const a=(e||"").toUpperCase().trim();return a==="STAKING"||a==="STAKED"||a==="STAKE"||a==="DELEGATED"||a==="DELEGATION"||a.includes("DELEGAT")?F.STAKING:a==="UNSTAKING"||a==="UNSTAKED"||a==="UNSTAKE"||a==="UNDELEGATED"?F.UNSTAKING:a==="FORCE_UNSTAKE"||a==="FORCEUNSTAKE"||a==="FORCE_UNSTAKED"?F.FORCE_UNSTAKE:a==="CLAIM"||a==="CLAIMED"||a==="REWARD"||a==="REWARDS"||a==="REWARD_CLAIMED"||a==="REWARDCLAIMED"||a==="CLAIMREWARD"||a==="CLAIM_REWARD"?F.CLAIM:a==="NFT_BUY"||a==="NFTBUY"||a==="NFTBOUGHT"||a==="BOOSTER_BUY"||a==="BOOSTERBUY"||a==="BOOSTERBOUGHT"||a.includes("BUY")&&(a.includes("NFT")||a.includes("BOOSTER"))||a.includes("BOUGHT")&&a.includes("NFT")?F.NFT_BUY:a==="NFT_SELL"||a==="NFTSELL"||a==="NFTSOLD"||a==="BOOSTER_SELL"||a==="BOOSTERSELL"||a==="BOOSTERSOLD"||a.includes("SELL")&&(a.includes("NFT")||a.includes("BOOSTER"))||a.includes("SOLD")&&a.includes("NFT")?F.NFT_SELL:a==="NFT_MINT"||a==="NFTMINT"||a==="BOOSTER_MINT"||a==="BOOSTERMINT"||a==="MINTED"||a==="BOOSTERMINTED"?F.NFT_MINT:a==="NFT_TRANSFER"||a==="NFTTRANSFER"||a==="BOOSTER_TRANSFER"||a==="BOOSTERTRANSFER"||a==="TRANSFER"?F.NFT_TRANSFER:a==="RENTAL_LIST"||a==="RENTALLISTED"||a==="RENTAL_LISTED"||a==="LISTED"||a.includes("LIST")&&a.includes("RENTAL")?F.RENTAL_LIST:a==="RENTAL_RENT"||a==="RENTALRENTED"||a==="RENTAL_RENTED"||a==="RENTED"||a.includes("RENT")&&!a.includes("LIST")?F.RENTAL_RENT:a==="RENTAL_WITHDRAW"||a==="RENTALWITHDRAWN"||a==="RENTAL_WITHDRAWN"?F.RENTAL_WITHDRAW:a==="RENTAL_PROMOTE"||a==="RENTALPROMOTED"||a==="RENTAL_PROMOTED"||a.includes("PROMOT")||a.includes("ADS")||a.includes("ADVERTIS")?F.RENTAL_PROMOTE:a==="FORTUNE_COMMIT"||a==="FORTUNECOMMIT"||a==="GAMECOMMITTED"||a==="GAME_COMMITTED"||a==="COMMITTED"?F.FORTUNE_COMMIT:a==="FORTUNE_REVEAL"||a==="FORTUNEREVEAL"||a==="GAMEREVEALED"||a==="GAME_REVEALED"||a==="REVEALED"?F.FORTUNE_REVEAL:a==="FORTUNE_EXPIRED"||a==="FORTUNEEXPIRED"||a==="GAMEEXPIRED"||a==="GAME_EXPIRED"||a==="EXPIRED"?F.FORTUNE_EXPIRED:a.includes("GAME")||a.includes("FORTUNE")||a.includes("REQUEST")||a.includes("FULFILLED")||a.includes("RESULT")?(t==null?void 0:t.isWin)||(t==null?void 0:t.prizeWon)&&BigInt(t.prizeWon||0)>0n?F.FORTUNE_WIN:(t==null?void 0:t.isCumulative)?F.FORTUNE_COMBO:F.FORTUNE_BET:a==="POSTCREATED"||a==="POST_CREATED"||a==="POSTED"||a==="BACKCHAT_POST"||a.includes("POST")&&!a.includes("REPOST")?F.BACKCHAT_POST:a==="SUPERLIKED"||a==="SUPER_LIKED"||a.includes("SUPERLIKE")?F.BACKCHAT_SUPERLIKE:a==="LIKED"||a==="POSTLIKED"||a==="POST_LIKED"||a.includes("LIKE")&&!a.includes("SUPER")?F.BACKCHAT_LIKE:a==="REPLYCREATED"||a==="REPLY_CREATED"||a.includes("REPLY")?F.BACKCHAT_REPLY:a==="REPOSTCREATED"||a==="REPOST_CREATED"||a.includes("REPOST")?F.BACKCHAT_REPOST:a==="AGORAUNFOLLOWED"||a==="UNFOLLOWED"||a.includes("UNFOLLOW")?F.AGORA_UNFOLLOW:a==="AGORADOWNVOTED"||a==="DOWNVOTED"||a.includes("DOWNVOT")?F.AGORA_DOWNVOTE:a==="FOLLOWED"||a==="USER_FOLLOWED"||a==="AGORAFOLLOWED"||a.includes("FOLLOW")?F.BACKCHAT_FOLLOW:a==="PROFILECREATED"||a==="PROFILE_CREATED"||a.includes("PROFILE")&&a.includes("CREAT")?F.BACKCHAT_PROFILE:a==="CHARITYCAMPAIGNBOOSTED"||a==="CAMPAIGN_BOOSTED"?F.CHARITY_BOOST:a==="PROFILEBOOSTED"||a==="PROFILE_BOOSTED"||a==="AGORAPROFILEBOOSTED"||a==="BOOSTED"||a.includes("BOOST")&&!a.includes("NFT")&&!a.includes("CAMPAIGN")&&!a.includes("CHARITY")?F.BACKCHAT_BOOST:a==="BADGEACTIVATED"||a==="BADGE_ACTIVATED"||a.includes("BADGE")?F.BACKCHAT_BADGE:a==="TIPPROCESSED"||a==="TIP_PROCESSED"||a==="TIPPED"||a.includes("TIP")?F.BACKCHAT_TIP:a==="ETHWITHDRAWN"||a==="ETH_WITHDRAWN"||a==="BACKCHAT_WITHDRAW"?F.BACKCHAT_WITHDRAW:a==="CHARITYDONATION"||a==="DONATIONMADE"||a==="CHARITY_DONATE"||a==="DONATED"||a==="DONATION"||a.includes("DONATION")?F.CHARITY_DONATE:a==="CHARITYCAMPAIGNCREATED"||a==="CAMPAIGNCREATED"||a==="CHARITY_CREATE"||a==="CAMPAIGN_CREATED"||a.includes("CAMPAIGNCREATED")?F.CHARITY_CREATE:a==="CHARITYCAMPAIGNCANCELLED"||a==="CAMPAIGNCANCELLED"||a==="CHARITY_CANCEL"||a==="CAMPAIGN_CANCELLED"||a.includes("CANCELLED")?F.CHARITY_CANCEL:a==="CHARITYCAMPAIGNCLOSED"||a==="CAMPAIGNCLOSED"||a==="CHARITY_CLOSED"||a==="CAMPAIGN_CLOSED"?F.CHARITY_CLOSED:a==="RENTALEARNINGSWITHDRAWN"||a==="RENTAL_EARNINGS_WITHDRAWN"?F.RENTAL_EARNINGS:a==="CHARITYFUNDSWITHDRAWN"||a==="FUNDSWITHDRAWN"||a==="CHARITY_WITHDRAW"||a==="CAMPAIGN_WITHDRAW"||a.includes("WITHDRAWN")?F.CHARITY_WITHDRAW:a==="CHARITYGOALREACHED"||a==="GOALREACHED"||a==="CHARITY_GOAL"||a==="CAMPAIGN_COMPLETED"?F.CHARITY_GOAL_REACHED:a==="NOTARYREGISTER"||a==="NOTARIZED"||a.includes("NOTARY")||a.includes("DOCUMENT")?F.NOTARY:a==="FAUCETCLAIM"||a.includes("FAUCET")||a.includes("DISTRIBUTED")?F.FAUCET:a==="FEECOLLECTED"||a==="FEE_COLLECTED"?F.FEE_COLLECTED:a==="REFERRERSET"||a==="REFERRER_SET"?F.REFERRER_SET:a==="BUYBACKEXECUTED"||a==="BUYBACK_EXECUTED"||a.includes("BUYBACK")?F.BUYBACK:a==="SWAPETHFORBKC"||a==="SWAPBKCFORETH"||a.includes("SWAP")?F.SWAP:a==="LIQUIDITYADDED"||a==="LIQUIDITY_ADDED"?F.LIQUIDITY_ADD:a==="LIQUIDITYREMOVED"||a==="LIQUIDITY_REMOVED"?F.LIQUIDITY_REMOVE:F.DEFAULT}let Cs=null,Ft=0n;function hd(e){const t=document.getElementById("dash-user-rewards");if(!t||!c.isConnected){Cs&&cancelAnimationFrame(Cs);return}const a=e-Ft;a>-1000000000n&&a<1000000000n?Ft=e:Ft+=a/8n,Ft<0n&&(Ft=0n),t.innerHTML=`${O(Ft).toFixed(4)} <span class="dash-reward-suffix">BKC</span>`,Ft!==e&&(Cs=requestAnimationFrame(()=>hd(e)))}async function Fi(e){if(!c.isConnected||!c.userAddress)return b("Conecte a wallet primeiro","error");const t=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Enviando...',_.faucet.isLoading=!0;let a=!1;try{console.log("[Faucet] Tentando API relayer...");const n=await fetch(`${wf}?address=${c.userAddress}`,{method:"GET",headers:{Accept:"application/json"}}),s=await n.json();if(console.log("[Faucet] API response:",n.status,s),n.ok&&s.success){a=!0,b(`Faucet: ${_r} BKC + ${Fr} ETH enviados!`,"success"),_.faucet.canClaim=!1;try{localStorage.setItem("bkc_faucet_"+c.userAddress.toLowerCase(),"1")}catch{}Pn(),setTimeout(()=>{yd.update(!0)},4e3)}else{const r=s.error||s.message||"Faucet unavailable";if(console.warn("[Faucet] API error:",r),a=!0,s.alreadyClaimed||r.toLowerCase().includes("already claimed")||r.toLowerCase().includes("one-time")){b("You already claimed your one-time faucet tokens.","warning"),_.faucet.canClaim=!1;try{localStorage.setItem("bkc_faucet_"+c.userAddress.toLowerCase(),"1")}catch{}Pn()}else b(r,"error")}}catch(n){console.warn("[Faucet] API offline:",n.message)}a||b("Faucet temporarily unavailable. Try again later.","error"),_.faucet.isLoading=!1,e.disabled=!1,e.innerHTML=t}function Pn(){const e=document.getElementById("dashboard-faucet-widget");if(!e)return;const t=document.getElementById("faucet-title"),a=document.getElementById("faucet-desc"),n=document.getElementById("faucet-status"),s=document.getElementById("faucet-action-btn");if(!c.isConnected){e.style.opacity="0.5",t&&(t.innerText="Get Free Testnet Tokens"),a&&(a.innerText="Connect your wallet to claim BKC + ETH for gas"),n&&n.classList.add("hidden"),s&&(s.className="dash-btn-secondary",s.innerHTML='<i class="fa-solid fa-wallet"></i> Connect Wallet',s.disabled=!0);return}e.style.opacity="1",_.faucet.canClaim?(t&&(t.innerText="Get Free Testnet Tokens"),a&&(a.innerText="Claim BKC tokens and ETH for gas â€” one-time per wallet"),n&&n.classList.add("hidden"),s&&(s.className="dash-btn-primary dash-btn-cyan",s.innerHTML='<i class="fa-solid fa-faucet"></i> Claim Free Tokens',s.disabled=!1)):(t&&(t.innerText="Testnet Tokens Received"),a&&(a.innerText=`Already received ${_r} BKC + ${Fr} ETH for testing on this wallet`),n&&(n.classList.remove("hidden"),n.innerHTML='<i class="fa-solid fa-circle-check" style="margin-right:4px;color:#4ade80"></i>One-time claim used'),s&&(s.className="dash-btn-secondary",s.innerHTML='<i class="fa-solid fa-check"></i> Already Claimed',s.disabled=!0))}function Af(){try{const e=window.location.hash||"",t=e.indexOf("?");if(t===-1)return;const n=new URLSearchParams(e.substring(t)).get("ref");if(n&&va.isAddress(n)){const s=localStorage.getItem("backchain_referrer");(!s||s.toLowerCase()!==n.toLowerCase())&&(localStorage.setItem("backchain_referrer",n),console.log("[Referral] Saved referrer from URL:",n))}}catch{}}async function Pf(){if(!c.isConnected||!c.userAddress)return{count:0,referrer:null};try{const e=y==null?void 0:y.backchainEcosystem;if(!e)return{count:0,referrer:null};const{ecosystemManagerABI:t}=await Y(async()=>{const{ecosystemManagerABI:o}=await Promise.resolve().then(()=>Mo);return{ecosystemManagerABI:o}},void 0),{NetworkManager:a}=await Y(async()=>{const{NetworkManager:o}=await Promise.resolve().then(()=>ae);return{NetworkManager:o}},void 0),n=a.getProvider(),s=new va.Contract(e,t,n),[r,i]=await Promise.all([s.referralCount(c.userAddress),s.referredBy(c.userAddress)]);return{count:Number(r),referrer:i!=="0x0000000000000000000000000000000000000000"?i:null}}catch(e){return console.warn("[Referral] Load failed:",e.message),{count:0,referrer:null}}}async function fn(){const e=document.getElementById("dashboard-referral-widget");if(!e)return;const t=document.getElementById("referral-title"),a=document.getElementById("referral-desc"),n=document.getElementById("referral-stats"),s=document.getElementById("referral-link-container"),r=document.getElementById("referral-link-text"),i=document.getElementById("referral-share-btn"),o=document.getElementById("referral-count");if(!c.isConnected||!c.userAddress){e.style.opacity="0.5",t&&(t.innerText="Invite & Earn Forever"),a&&(a.innerText="Connect your wallet to get your referral link"),n&&(n.style.display="none"),s&&(s.style.display="none"),i&&(i.style.display="none");return}e.style.opacity="1";const l=`${window.location.origin}/#dashboard?ref=${c.userAddress}`;r&&(r.textContent=l),s&&(s.style.display="flex"),i&&(i.style.display="");const d=await Pf();o&&(o.textContent=d.count),n&&(n.style.display="flex"),d.count>0?(t&&(t.innerText=`${d.count} Referral${d.count>1?"s":""} Earning for You`),a&&(a.innerText="You earn 10% ETH on all fees + 5% BKC on staking claims. Keep sharing!")):(t&&(t.innerText="Invite & Earn Dual Rewards"),a&&(a.innerText="Share your link. Earn 10% ETH + 5% BKC from your referrals â€” forever."))}function Bf(){if(!c.userAddress)return;const e=`${window.location.origin}/#dashboard?ref=${c.userAddress}`;navigator.clipboard.writeText(e).then(()=>{b("Referral link copied!","success");const t=document.getElementById("referral-copy-btn");t&&(t.innerHTML='<i class="fa-solid fa-check"></i>',setTimeout(()=>{t.innerHTML='<i class="fa-solid fa-copy"></i>'},2e3))}).catch(()=>b("Failed to copy","error"))}function Sf(){if(!c.userAddress)return;const e=`${window.location.origin}/#dashboard?ref=${c.userAddress}`,t=`Join Backchain and earn crypto!

Stake BKC and earn daily rewards
Refer friends â€” earn 10% ETH + 5% BKC FOREVER

${e}

#Backchain #DeFi #Arbitrum #Web3`;navigator.share?navigator.share({title:"Backchain â€” Invite & Earn",text:t,url:e}).catch(()=>{}):navigator.clipboard.writeText(t).then(()=>b("Share text copied!","success")).catch(()=>{})}async function zf(){try{if(await c.provider.getBalance(c.userAddress)<va.parseEther("0.002")){const t=document.getElementById("no-gas-modal-dash");return t&&(t.classList.remove("hidden"),t.classList.add("flex")),!1}return!0}catch{return!0}}function Nf(){if(document.getElementById("dash-styles-v69"))return;const e=document.createElement("style");e.id="dash-styles-v69",e.textContent=`
        /* â”€â”€ CSS Variables â”€â”€ */
        .dash-shell {
            --dash-bg: #0c0c0e;
            --dash-surface: #141417;
            --dash-surface-2: #1c1c21;
            --dash-surface-3: #222228;
            --dash-border: rgba(255,255,255,0.06);
            --dash-border-h: rgba(255,255,255,0.12);
            --dash-text: #f0f0f2;
            --dash-text-2: #a0a0ab;
            --dash-text-3: #5c5c68;
            --dash-accent: #f59e0b;
            --dash-green: #4ade80;
            --dash-purple: #a78bfa;
            --dash-cyan: #22d3ee;
            --dash-radius: 16px;
            --dash-radius-sm: 10px;
            --dash-tr: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* â”€â”€ Animations â”€â”€ */
        @keyframes dash-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes dash-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes dash-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes dash-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
        @keyframes dash-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes dash-pulse-ring { 0% { transform: scale(0.9); opacity: 0.6; } 100% { transform: scale(1.4); opacity: 0; } }

        /* â”€â”€ Shell â”€â”€ */
        .dash-shell { max-width: 1200px; margin: 0 auto; padding: 0 16px 40px; animation: dash-fadeIn 0.4s ease-out; }

        /* â”€â”€ Hero Section â”€â”€ */
        .dash-hero {
            position: relative;
            background: linear-gradient(135deg, rgba(20,20,23,0.95), rgba(12,12,14,0.98));
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius);
            padding: 28px 24px;
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out;
        }
        .dash-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(245,158,11,0.06) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 4s ease-in-out infinite;
        }
        .dash-hero-inner { display: flex; gap: 24px; position: relative; z-index: 1; }
        .dash-hero-left { flex: 1.2; min-width: 0; }
        .dash-hero-right { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
        .dash-hero-label { font-size: 11px; color: var(--dash-text-3); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 4px; }
        .dash-reward-value {
            font-size: clamp(28px, 5vw, 40px);
            font-weight: 800;
            color: var(--dash-green);
            font-variant-numeric: tabular-nums;
            line-height: 1.1;
            text-shadow: 0 0 30px rgba(74,222,128,0.2);
        }
        .dash-reward-suffix { font-size: 14px; color: rgba(74,222,128,0.6); font-weight: 600; }
        .dash-hero-pstake { display: flex; align-items: center; gap: 12px; margin-top: 16px; padding-top: 14px; border-top: 1px solid var(--dash-border); }
        .dash-hero-pstake-label { font-size: 10px; color: var(--dash-text-3); text-transform: uppercase; }
        .dash-hero-pstake-value { font-size: 18px; font-weight: 700; color: var(--dash-purple); font-family: 'SF Mono', monospace; }
        .dash-hero-ghost {
            position: absolute;
            top: 12px;
            right: 16px;
            width: 64px;
            height: 64px;
            opacity: 0.06;
            animation: dash-float 6s ease-in-out infinite;
            pointer-events: none;
        }

        /* â”€â”€ Claim Button â”€â”€ */
        .dash-claim-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding: 10px 24px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
            font-weight: 700;
            font-size: 14px;
            border-radius: var(--dash-radius-sm);
            border: none;
            cursor: pointer;
            transition: all var(--dash-tr);
            box-shadow: 0 4px 20px rgba(34,197,94,0.25);
        }
        .dash-claim-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(34,197,94,0.35); }
        .dash-claim-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
        .dash-stake-link {
            font-size: 12px; color: var(--dash-purple); font-weight: 600; cursor: pointer;
            transition: color var(--dash-tr); margin-left: auto;
        }
        .dash-stake-link:hover { color: var(--dash-text); }

        /* â”€â”€ Gain Upsell â”€â”€ */
        .dash-gain-area {
            display: none;
            margin-top: 10px;
            padding: 6px 10px;
            background: linear-gradient(90deg, rgba(245,158,11,0.08), rgba(74,222,128,0.08));
            border: 1px solid rgba(245,158,11,0.2);
            border-radius: 8px;
            font-size: 10px;
            color: var(--dash-accent);
            font-weight: 700;
        }
        .dash-gain-area.visible { display: inline-block; }

        /* â”€â”€ Faucet Section â”€â”€ */
        .dash-faucet-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 22px;
            background: linear-gradient(135deg, rgba(6,182,212,0.06), rgba(34,197,94,0.04));
            border: 1px solid rgba(6,182,212,0.15);
            border-radius: var(--dash-radius);
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out 0.1s both;
            transition: opacity var(--dash-tr);
        }
        .dash-faucet-section::before {
            content: '';
            position: absolute;
            top: -60%; left: -15%;
            width: 280px; height: 280px;
            background: radial-gradient(circle, rgba(6,182,212,0.05) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 5s ease-in-out infinite;
        }
        .dash-faucet-icon {
            width: 48px; height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(6,182,212,0.15), rgba(34,197,94,0.1));
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: #22d3ee;
            flex-shrink: 0;
            animation: dash-float 4s ease-in-out infinite;
            position: relative; z-index: 1;
        }
        .dash-faucet-info { flex: 1; min-width: 0; position: relative; z-index: 1; }
        .dash-faucet-info h3 { font-size: 14px; font-weight: 800; color: var(--dash-text); margin: 0 0 2px; }
        .dash-faucet-info p { font-size: 11px; color: var(--dash-text-2); margin: 0; }
        .dash-faucet-amounts { display: flex; gap: 10px; margin-top: 8px; }
        .dash-faucet-badge {
            font-size: 11px; font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--dash-border);
            display: inline-flex; align-items: center; gap: 4px;
        }
        .dash-faucet-info .faucet-status-text { font-size: 12px; color: var(--dash-accent); font-family: 'SF Mono', monospace; margin-top: 6px; }
        .dash-faucet-actions { position: relative; z-index: 1; flex-shrink: 0; }

        /* â”€â”€ Referral Section â”€â”€ */
        .dash-referral-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 22px;
            background: linear-gradient(135deg, rgba(167,139,250,0.06), rgba(139,92,246,0.04));
            border: 1px solid rgba(167,139,250,0.15);
            border-radius: var(--dash-radius);
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out 0.15s both;
            transition: opacity var(--dash-tr);
        }
        .dash-referral-section::before {
            content: '';
            position: absolute;
            top: -60%; right: -15%;
            width: 280px; height: 280px;
            background: radial-gradient(circle, rgba(167,139,250,0.05) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 5s ease-in-out infinite 1s;
        }
        .dash-referral-icon {
            width: 48px; height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(167,139,250,0.15), rgba(139,92,246,0.1));
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: #a78bfa;
            flex-shrink: 0;
            animation: dash-float 4s ease-in-out infinite 0.5s;
            position: relative; z-index: 1;
        }
        .dash-referral-info { flex: 1; min-width: 0; position: relative; z-index: 1; }
        .dash-referral-info h3 { font-size: 14px; font-weight: 800; color: var(--dash-text); margin: 0 0 2px; }
        .dash-referral-info p { font-size: 11px; color: var(--dash-text-2); margin: 0; }
        .dash-referral-stats {
            display: flex; gap: 12px; margin-top: 8px;
        }
        .dash-referral-stat {
            font-size: 11px; font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--dash-border);
            display: inline-flex; align-items: center; gap: 4px;
        }
        .dash-referral-link-box {
            display: flex; align-items: center; gap: 6px;
            margin-top: 8px;
            padding: 6px 10px;
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            border-radius: 8px;
            font-size: 11px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            color: var(--dash-text-3);
            max-width: 380px;
        }
        .dash-referral-link-box span { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .dash-referral-link-box button {
            background: none; border: none; color: #a78bfa; cursor: pointer;
            padding: 2px 6px; font-size: 12px; border-radius: 4px;
            transition: background var(--dash-tr);
        }
        .dash-referral-link-box button:hover { background: rgba(167,139,250,0.1); }
        .dash-referral-actions { position: relative; z-index: 1; flex-shrink: 0; display: flex; gap: 8px; }
        .dash-btn-purple {
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
            color: #fff;
            box-shadow: 0 4px 20px rgba(139,92,246,0.25);
        }
        .dash-btn-purple:hover { box-shadow: 0 4px 28px rgba(139,92,246,0.4); transform: translateY(-1px); }
        @media (max-width: 640px) {
            .dash-referral-section { flex-direction: column; text-align: center; padding: 16px; }
            .dash-referral-actions { width: 100%; justify-content: center; }
            .dash-referral-link-box { max-width: 100%; }
            .dash-referral-stats { justify-content: center; }
        }

        /* â”€â”€ Quick Actions Grid â”€â”€ */
        .dash-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .dash-action-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            cursor: pointer;
            transition: all var(--dash-tr);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        .dash-action-card::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity var(--dash-tr);
            pointer-events: none;
        }
        .dash-action-card:hover { border-color: var(--dash-border-h); transform: translateY(-2px); }
        .dash-action-card:hover::before { opacity: 1; }
        .dash-action-icon {
            width: 38px; height: 38px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .dash-action-text h4 { font-size: 13px; font-weight: 700; color: var(--dash-text); margin: 0; }
        .dash-action-text p { font-size: 10px; color: var(--dash-text-3); margin: 2px 0 0; }
        .dash-action-arrow { font-size: 10px; color: var(--dash-text-3); margin-left: auto; transition: transform var(--dash-tr); }
        .dash-action-card:hover .dash-action-arrow { transform: translateX(3px); color: var(--dash-text-2); }

        /* Action card themes */
        .dash-action-card.backchat::before { background: linear-gradient(135deg, rgba(6,182,212,0.06), transparent); }
        .dash-action-card.backchat:hover { border-color: rgba(6,182,212,0.3); }
        .dash-action-card.stake::before { background: linear-gradient(135deg, rgba(167,139,250,0.06), transparent); }
        .dash-action-card.stake:hover { border-color: rgba(167,139,250,0.3); }
        .dash-action-card.fortune::before { background: linear-gradient(135deg, rgba(249,115,22,0.06), transparent); }
        .dash-action-card.fortune:hover { border-color: rgba(249,115,22,0.3); }
        .dash-action-card.notary::before { background: linear-gradient(135deg, rgba(129,140,248,0.06), transparent); }
        .dash-action-card.notary:hover { border-color: rgba(129,140,248,0.3); }
        .dash-action-card.charity::before { background: linear-gradient(135deg, rgba(236,72,153,0.06), transparent); }
        .dash-action-card.charity:hover { border-color: rgba(236,72,153,0.3); }
        .dash-action-card.nft::before { background: linear-gradient(135deg, rgba(245,158,11,0.06), transparent); }
        .dash-action-card.nft:hover { border-color: rgba(245,158,11,0.3); }

        /* â”€â”€ Metrics Bar â”€â”€ */
        .dash-metrics-bar {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }
        .dash-metric-pill {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 10px 12px;
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            transition: border-color var(--dash-tr);
        }
        .dash-metric-pill:hover { border-color: var(--dash-border-h); }
        .dash-metric-pill-label { font-size: 9px; color: var(--dash-text-3); text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .dash-metric-pill-label i { font-size: 9px; }
        .dash-metric-pill-value { font-size: 14px; font-weight: 700; color: var(--dash-text); font-variant-numeric: tabular-nums; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* â”€â”€ Activity Panel â”€â”€ */
        .dash-activity-panel {
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius);
            padding: 16px;
            animation: dash-fadeIn 0.5s ease-out 0.1s both;
        }
        .dash-activity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .dash-activity-title { font-size: 13px; font-weight: 700; color: var(--dash-text); display: flex; align-items: center; gap: 8px; }
        .dash-activity-title i { color: var(--dash-text-3); font-size: 12px; }
        .dash-sort-btn {
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            color: var(--dash-text-3);
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--dash-tr);
        }
        .dash-sort-btn:hover { color: var(--dash-text); border-color: var(--dash-border-h); }

        /* â”€â”€ Filter Chips â”€â”€ */
        .dash-filter-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .dash-chip {
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            color: var(--dash-text-3);
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            border-radius: 20px;
            cursor: pointer;
            transition: all var(--dash-tr);
            white-space: nowrap;
        }
        .dash-chip:hover { color: var(--dash-text-2); border-color: var(--dash-border-h); }
        .dash-chip.active { color: var(--dash-accent); background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.3); }
        .dash-chip i { opacity: 0.5; transition: opacity var(--dash-tr); }
        .dash-chip.active i { opacity: 1; }

        /* â”€â”€ Activity List â”€â”€ */
        .dash-activity-list { display: flex; flex-direction: column; gap: 6px; min-height: 150px; max-height: 520px; overflow-y: auto; }
        .dash-activity-list::-webkit-scrollbar { width: 4px; }
        .dash-activity-list::-webkit-scrollbar-track { background: transparent; }
        .dash-activity-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }

        .dash-activity-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--dash-surface-2);
            border: 1px solid transparent;
            border-radius: 8px;
            transition: all var(--dash-tr);
            text-decoration: none;
            gap: 10px;
        }
        .dash-activity-item:hover { background: var(--dash-surface-3); border-color: var(--dash-border-h); }
        .dash-activity-item-icon {
            width: 32px; height: 32px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
            font-size: 12px;
        }
        .dash-activity-item-info { flex: 1; min-width: 0; }
        .dash-activity-item-label { font-size: 12px; font-weight: 600; color: var(--dash-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dash-activity-item-meta { font-size: 10px; color: var(--dash-text-3); margin-top: 1px; }
        .dash-activity-item-amount { font-size: 12px; font-weight: 600; color: var(--dash-text); font-family: 'SF Mono', monospace; text-align: right; white-space: nowrap; }
        .dash-activity-item-amount .unit { font-size: 10px; color: var(--dash-text-3); }
        .dash-activity-item-link { font-size: 9px; color: var(--dash-text-3); transition: color var(--dash-tr); }
        .dash-activity-item:hover .dash-activity-item-link { color: #60a5fa; }

        /* Fortune special item */
        .dash-fortune-item {
            display: block;
            padding: 10px 12px;
            background: var(--dash-surface-2);
            border: 1px solid transparent;
            border-radius: 8px;
            text-decoration: none;
            transition: all var(--dash-tr);
        }
        .dash-fortune-item:hover { background: var(--dash-surface-3); border-color: var(--dash-border-h); }

        /* â”€â”€ Pagination â”€â”€ */
        .dash-pagination { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--dash-border); }
        .dash-page-btn {
            font-size: 11px; color: var(--dash-text-3); background: none; border: none; cursor: pointer;
            transition: color var(--dash-tr); padding: 4px 0;
        }
        .dash-page-btn:hover:not(:disabled) { color: var(--dash-text); }
        .dash-page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .dash-page-indicator { font-size: 10px; color: var(--dash-text-3); font-family: monospace; }

        /* â”€â”€ (sidebar removed in V69.1) â”€â”€ */

        /* â”€â”€ Buttons â”€â”€ */
        .dash-btn-primary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; font-size: 12px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--dash-tr); color: white;
        }
        .dash-btn-primary:disabled { opacity: 0.35; cursor: not-allowed; }
        .dash-btn-green { background: linear-gradient(135deg, #22c55e, #10b981); }
        .dash-btn-green:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .dash-btn-cyan:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .dash-btn-purple:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-secondary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; font-size: 12px; font-weight: 600;
            background: var(--dash-surface-2); color: var(--dash-text-2);
            border: 1px solid var(--dash-border); border-radius: 8px;
            cursor: pointer; transition: all var(--dash-tr);
        }
        .dash-btn-secondary:hover:not(:disabled) { color: var(--dash-text); border-color: var(--dash-border-h); }
        .dash-btn-secondary:disabled { opacity: 0.35; cursor: not-allowed; }
        .dash-modal-action-btn {
            width: 100%; padding: 9px; font-size: 12px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--dash-tr); color: white; text-align: center;
        }
        .dash-modal-action-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }

        /* â”€â”€ Modals â”€â”€ */
        .dash-modal-overlay {
            position: fixed; inset: 0; z-index: 50;
            display: none; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            padding: 16px; opacity: 0; transition: opacity 0.3s;
        }
        .dash-modal-overlay.visible { display: flex; opacity: 1; }
        .dash-modal {
            background: var(--dash-surface); border: 1px solid var(--dash-border-h);
            border-radius: var(--dash-radius); max-width: 360px; width: 100%;
            padding: 20px; position: relative;
            transform: scale(0.95); transition: transform 0.3s;
        }
        .dash-modal-overlay.visible .dash-modal { transform: scale(1); }

        /* â”€â”€ Loading / Empty â”€â”€ */
        .dash-loading {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 32px 16px; gap: 12px;
        }
        .dash-loading-logo { width: 40px; height: 40px; opacity: 0.4; animation: dash-float 2s ease-in-out infinite; }
        .dash-loading-text { font-size: 11px; color: var(--dash-text-3); }
        .dash-empty-text { font-size: 12px; color: var(--dash-text-3); text-align: center; padding: 24px 16px; }

        /* â”€â”€ Hero gradient border â”€â”€ */
        .dash-hero::after {
            content: '';
            position: absolute; inset: 0;
            border-radius: var(--dash-radius);
            padding: 1px;
            background: linear-gradient(135deg, rgba(245,158,11,0.25), rgba(74,222,128,0.15), rgba(167,139,250,0.15));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            -webkit-mask-composite: xor;
            pointer-events: none;
            opacity: 0.6;
        }

        /* â”€â”€ Claim button shimmer when active â”€â”€ */
        .dash-claim-btn:not(:disabled) {
            background-size: 200% 100%;
            background-image: linear-gradient(90deg, #22c55e 0%, #34d399 25%, #22c55e 50%, #10b981 100%);
            animation: dash-shimmer 3s linear infinite;
        }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 900px) {
            .dash-metrics-bar { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 640px) {
            .dash-shell { padding: 0 10px 30px; }
            .dash-hero { padding: 20px 16px; }
            .dash-hero-inner { flex-direction: column; gap: 16px; }
            .dash-hero-right { border-top: 1px solid var(--dash-border); padding-top: 16px; }
            .dash-actions-grid { grid-template-columns: repeat(2, 1fr); }
            .dash-metrics-bar { grid-template-columns: repeat(2, 1fr); }
            .dash-reward-value { font-size: 28px; }

            /* Faucet stacks vertically */
            .dash-faucet-section { flex-direction: column; text-align: center; padding: 16px; }
            .dash-faucet-actions { width: 100%; }
            .dash-faucet-actions button { width: 100%; justify-content: center; }
            .dash-faucet-amounts { justify-content: center; }

            /* Filter chips horizontal scroll */
            .dash-filter-chips {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                padding-bottom: 4px;
            }
            .dash-filter-chips::-webkit-scrollbar { display: none; }

            /* Tighter activity items */
            .dash-activity-item { padding: 8px; gap: 8px; }
        }
        @media (max-width: 380px) {
            .dash-actions-grid { grid-template-columns: 1fr; }
        }
    `,document.head.appendChild(e)}function $f(){Oe.dashboard&&(Nf(),Oe.dashboard.innerHTML=`
        <div class="dash-shell">

            <!-- HERO SECTION -->
            <div class="dash-hero" style="margin-bottom: 14px;">
                <img src="./assets/bkc_logo_3d.png" class="dash-hero-ghost" alt="">
                <div class="dash-hero-inner">
                    <div class="dash-hero-left">
                        <div class="dash-hero-label">You Will Receive</div>
                        <div id="dash-user-rewards" class="dash-reward-value">--</div>

                        <div id="dash-user-gain-area" class="dash-gain-area">
                            <i class="fa-solid fa-rocket" style="margin-right:4px"></i>
                            Earn +<span id="dash-user-potential-gain">0</span> BKC more with NFT!
                        </div>

                        <button id="dashboardClaimBtn" class="dash-claim-btn" disabled>
                            <i class="fa-solid fa-coins"></i> Claim Rewards
                        </button>

                        <div class="dash-hero-pstake">
                            <div>
                                <div class="dash-hero-pstake-label">Your pStake</div>
                                <div id="dash-user-pstake" class="dash-hero-pstake-value">--</div>
                            </div>
                            <span class="dash-stake-link delegate-link"><i class="fa-solid fa-plus" style="margin-right:3px"></i> Stake More</span>
                        </div>
                    </div>

                    <div class="dash-hero-right">
                        <div id="dash-booster-area" style="min-height: 120px; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align:center;">
                                <img src="./assets/bkc_logo_3d.png" style="width:32px;height:32px;opacity:0.3;animation:dash-float 2s infinite" alt="">
                                <p style="font-size:11px;color:var(--dash-text-3);margin-top:8px">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAUCET SECTION â€” Always Visible -->
            <div id="dashboard-faucet-widget" class="dash-faucet-section" style="margin-bottom: 14px;">
                <div class="dash-faucet-icon">
                    <i class="fa-solid fa-droplet"></i>
                </div>
                <div class="dash-faucet-info">
                    <h3 id="faucet-title">Get Free Testnet Tokens</h3>
                    <p id="faucet-desc">Claim BKC tokens and ETH for gas â€” one-time per wallet</p>
                    <div class="dash-faucet-amounts">
                        <span class="dash-faucet-badge" style="color:#22d3ee">
                            <i class="fa-solid fa-coins" style="font-size:10px"></i>${_r} BKC
                        </span>
                        <span class="dash-faucet-badge" style="color:#4ade80">
                            <i class="fa-brands fa-ethereum" style="font-size:10px"></i>${Fr} ETH
                        </span>
                    </div>
                    <p id="faucet-status" class="faucet-status-text hidden"></p>
                </div>
                <div class="dash-faucet-actions">
                    <button id="faucet-action-btn" class="dash-btn-primary dash-btn-cyan">
                        <i class="fa-solid fa-faucet"></i> Claim Free Tokens
                    </button>
                </div>
            </div>

            <!-- REFERRAL SECTION -->
            <div id="dashboard-referral-widget" class="dash-referral-section" style="margin-bottom: 14px;">
                <div class="dash-referral-icon">
                    <i class="fa-solid fa-user-plus"></i>
                </div>
                <div class="dash-referral-info">
                    <h3 id="referral-title">Invite & Earn Dual Rewards</h3>
                    <p id="referral-desc">Share your link. Earn 10% ETH + 5% BKC from your referrals â€” forever.</p>
                    <div id="referral-stats" class="dash-referral-stats" style="display:none">
                        <span class="dash-referral-stat" style="color:#a78bfa">
                            <i class="fa-solid fa-users" style="font-size:10px"></i>
                            <span id="referral-count">0</span> referred
                        </span>
                        <span class="dash-referral-stat" style="color:#4ade80">
                            <i class="fa-solid fa-coins" style="font-size:10px"></i>
                            10% ETH + 5% BKC
                        </span>
                    </div>
                    <div id="referral-link-container" class="dash-referral-link-box" style="display:none">
                        <span id="referral-link-text"></span>
                        <button id="referral-copy-btn" title="Copy link"><i class="fa-solid fa-copy"></i></button>
                    </div>
                </div>
                <div class="dash-referral-actions">
                    <button id="referral-share-btn" class="dash-btn-primary dash-btn-purple" style="display:none">
                        <i class="fa-solid fa-share-nodes"></i> Share
                    </button>
                </div>
            </div>

            <!-- QUICK ACTIONS GRID -->
            <div class="dash-actions-grid" style="margin-bottom: 14px;">
                <div class="dash-action-card backchat go-to-backchat">
                    <div class="dash-action-icon" style="background:rgba(6,182,212,0.12); color:#22d3ee;">
                        <i class="fa-solid fa-comment-dots"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Agora</h4>
                        <p>Post & discuss on-chain</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card stake delegate-link">
                    <div class="dash-action-icon" style="background:rgba(167,139,250,0.12); color:#a78bfa;">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Stake BKC</h4>
                        <p>Earn while you sleep</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card fortune go-to-fortune">
                    <div class="dash-action-icon" style="background:rgba(249,115,22,0.12); color:#f97316;">
                        <i class="fa-solid fa-paw"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Fortune Pool</h4>
                        <p id="dash-fortune-prize-text">Win up to 100x</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card notary go-to-notary">
                    <div class="dash-action-icon" style="background:rgba(129,140,248,0.12); color:#818cf8;">
                        <i class="fa-solid fa-stamp"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Notarize</h4>
                        <p id="dash-notary-count-text">Certify on blockchain</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card charity go-to-charity">
                    <div class="dash-action-icon" style="background:rgba(236,72,153,0.12); color:#ec4899;">
                        <i class="fa-solid fa-heart"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Charity Pool</h4>
                        <p>Donate & burn tokens</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card nft go-to-store">
                    <div class="dash-action-icon" style="background:rgba(245,158,11,0.12); color:#f59e0b;">
                        <i class="fa-solid fa-gem"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>NFT Market</h4>
                        <p>2x your rewards</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>
            </div>

            <!-- METRICS BAR -->
            <div class="dash-metrics-bar" style="margin-bottom: 16px;">
                <div class="dash-metric-pill" title="Total BKC tokens in circulation">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-coins" style="color:#f59e0b"></i> Supply</div>
                    <div id="dash-metric-supply" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Total staking power on network">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-layer-group" style="color:#a78bfa"></i> pStake</div>
                    <div id="dash-metric-pstake" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="BKC permanently removed from supply">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-fire" style="color:#ef4444"></i> Burned</div>
                    <div id="dash-metric-burned" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Total ETH fees collected by ecosystem">
                    <div class="dash-metric-pill-label"><i class="fa-brands fa-ethereum" style="color:#fb923c"></i> Fees</div>
                    <div id="dash-metric-fees" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="BKC locked in protocol contracts (staking, pools, etc)">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-vault" style="color:#60a5fa"></i> Locked</div>
                    <div id="dash-metric-locked" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Your BKC balance" style="border-color: rgba(245,158,11,0.2);">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-wallet" style="color:#f59e0b"></i> Balance</div>
                    <div id="dash-metric-balance" class="dash-metric-pill-value" style="color:#f59e0b">--</div>
                </div>
            </div>

            <!-- ACTIVITY FEED -->
            <div class="dash-activity-panel">
                <div class="dash-activity-header">
                    <div class="dash-activity-title">
                        <i class="fa-solid fa-bolt" style="color:var(--dash-accent)"></i>
                        <span id="activity-title">Activity</span>
                        <span id="activity-count" style="font-size:9px;color:var(--dash-text-3);background:var(--dash-surface-2);padding:2px 6px;border-radius:10px;font-weight:600;display:none">0</span>
                    </div>
                    <div style="display:flex; gap:6px; align-items:center;">
                        <button id="manual-refresh-btn" class="dash-sort-btn" title="Refresh activity">
                            <i class="fa-solid fa-rotate"></i>
                        </button>
                        <button id="activity-sort-toggle" class="dash-sort-btn" title="Toggle sort order">
                            <i class="fa-solid fa-arrow-down-wide-short"></i>
                        </button>
                    </div>
                </div>

                <div class="dash-filter-chips">
                    <button class="dash-chip active" data-filter="ALL"><i class="fa-solid fa-layer-group" style="margin-right:3px;font-size:9px"></i>All</button>
                    <button class="dash-chip" data-filter="STAKE"><i class="fa-solid fa-lock" style="margin-right:3px;font-size:9px"></i>Staking</button>
                    <button class="dash-chip" data-filter="CLAIM"><i class="fa-solid fa-coins" style="margin-right:3px;font-size:9px"></i>Claims</button>
                    <button class="dash-chip" data-filter="NFT"><i class="fa-solid fa-gem" style="margin-right:3px;font-size:9px"></i>NFT</button>
                    <button class="dash-chip" data-filter="GAME"><i class="fa-solid fa-dice" style="margin-right:3px;font-size:9px"></i>Fortune</button>
                    <button class="dash-chip" data-filter="CHARITY"><i class="fa-solid fa-heart" style="margin-right:3px;font-size:9px"></i>Charity</button>
                    <button class="dash-chip" data-filter="NOTARY"><i class="fa-solid fa-stamp" style="margin-right:3px;font-size:9px"></i>Notary</button>
                    <button class="dash-chip" data-filter="BACKCHAT"><i class="fa-solid fa-comments" style="margin-right:3px;font-size:9px"></i>Agora</button>
                    <button class="dash-chip" data-filter="FAUCET"><i class="fa-solid fa-droplet" style="margin-right:3px;font-size:9px"></i>Faucet</button>
                </div>

                <div id="dash-activity-list" class="dash-activity-list">
                    <div class="dash-loading">
                        <img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt="">
                        <span class="dash-loading-text">Loading activity...</span>
                    </div>
                </div>

                <div id="dash-pagination-controls" class="dash-pagination" style="display:none">
                    <button class="dash-page-btn" id="page-prev"><i class="fa-solid fa-chevron-left" style="margin-right:4px"></i>Prev</button>
                    <span class="dash-page-indicator" id="page-indicator">1/1</span>
                    <button class="dash-page-btn" id="page-next">Next<i class="fa-solid fa-chevron-right" style="margin-left:4px"></i></button>
                </div>
            </div>
        </div>

        ${Lf()}
        ${Rf()}
    `,Df())}function Lf(){return`
        <div id="booster-info-modal" class="dash-modal-overlay">
            <div class="dash-modal">
                <button id="close-booster-modal" style="position:absolute;top:12px;right:12px;background:none;border:none;color:var(--dash-text-3);cursor:pointer;font-size:16px"><i class="fa-solid fa-xmark"></i></button>
                <div style="text-align:center; margin-bottom:16px">
                    <div style="display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;background:rgba(245,158,11,0.15);border-radius:50%;margin-bottom:8px">
                        <i class="fa-solid fa-rocket" style="font-size:22px;color:var(--dash-accent)"></i>
                    </div>
                    <h3 style="font-size:18px;font-weight:700;color:var(--dash-text);margin:0">Boost Efficiency</h3>
                    <p style="font-size:11px;color:var(--dash-text-2);margin-top:4px">NFT holders earn up to 2x more</p>
                </div>
                <div style="background:var(--dash-surface-2);border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:6px">
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-text-2)">No NFT:</span><span style="color:var(--dash-text-3);font-weight:700">50%</span></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-text-2)">Bronze:</span><span style="color:#fde047;font-weight:700">80%</span></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-accent)">Diamond:</span><span style="color:var(--dash-green);font-weight:700">100%</span></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px">
                    <button class="dash-modal-action-btn go-to-store" style="background:linear-gradient(135deg,#d97706,#b45309)">Buy NFT</button>
                    <button class="dash-modal-action-btn go-to-rental" style="background:linear-gradient(135deg,#06b6d4,#0891b2)">Rent NFT</button>
                </div>
            </div>
        </div>
    `}function Rf(){return`
        <div id="no-gas-modal-dash" class="dash-modal-overlay">
            <div class="dash-modal" style="text-align:center;max-width:300px">
                <div style="width:48px;height:48px;background:rgba(239,68,68,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;border:1px solid rgba(239,68,68,0.2)">
                    <i class="fa-solid fa-gas-pump" style="font-size:18px;color:#ef4444"></i>
                </div>
                <h3 style="font-size:16px;font-weight:700;color:var(--dash-text);margin:0 0 4px">No Gas</h3>
                <p style="font-size:11px;color:var(--dash-text-2);margin-bottom:14px">You need Arbitrum Sepolia ETH</p>
                <button id="emergency-faucet-btn" class="dash-btn-primary dash-btn-green" style="width:100%;justify-content:center;margin-bottom:10px">
                    <i class="fa-solid fa-hand-holding-medical"></i> Get Free Gas + BKC
                </button>
                <button id="close-gas-modal-dash" style="background:none;border:none;color:var(--dash-text-3);cursor:pointer;font-size:11px">Close</button>
            </div>
        </div>
    `}async function _f(){try{const e=await fetch(kf);if(e.ok){const t=await e.json();return _.economicData=t,t}}catch{}return null}async function Ms(){var e,t,a,n,s,r,i;try{const o=await _f();let l=0n,d=0n,u=0n,p=0n,m=0n,g=0,x=0n;if(o&&((e=o.token)!=null&&e.totalSupply&&(l=BigInt(o.token.totalSupply)),(t=o.token)!=null&&t.totalBurned&&(p=BigInt(o.token.totalBurned)),(a=o.staking)!=null&&a.totalPStake&&(d=BigInt(o.staking.totalPStake)),(n=o.ecosystem)!=null&&n.totalEthCollected&&(m=BigInt(o.ecosystem.totalEthCollected)),(s=o.fortunePool)!=null&&s.prizePool&&(x=BigInt(o.fortunePool.prizePool)),(r=o.notary)!=null&&r.certCount&&(g=o.notary.certCount),(i=o.stats)!=null&&i.notarizedDocuments&&(g=Math.max(g,o.stats.notarizedDocuments))),c.bkcTokenContractPublic){l===0n&&(l=await oe(c.bkcTokenContractPublic,"totalSupply",[],0n)),p===0n&&(p=await oe(c.bkcTokenContractPublic,"totalBurned",[],0n)),d===0n&&(c.stakingPoolContractPublic||c.stakingPoolContract)&&(d=await oe(c.stakingPoolContractPublic||c.stakingPoolContract,"totalPStake",[],0n));const D=[y.stakingPool,y.fortunePool,y.rentalManager,y.buybackMiner,y.liquidityPool,y.pool_diamond,y.pool_gold,y.pool_silver,y.pool_bronze].filter(H=>H&&H!==va.ZeroAddress),q=await Promise.all(D.map(H=>oe(c.bkcTokenContractPublic,"balanceOf",[H],0n)));if(q.forEach(H=>{u+=H}),y.fortunePool&&x===0n){const H=D.indexOf(y.fortunePool);H>=0&&(x=q[H])}}c.totalSupply=l,c.totalBurned=p;const h=O(l),C=O(p),T=O(m),A=O(x),B=D=>D.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),z=O(u),S=(D,q)=>{const H=document.getElementById(D);H&&(H.innerHTML=q)};S("dash-metric-supply",`${B(h)} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`),S("dash-metric-pstake",xa(d)),S("dash-metric-burned",C>0?`<span style="color:#ef4444">${pn(C)}</span> <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`:'<span style="color:var(--dash-text-3)">0 BKC</span>'),S("dash-metric-fees",T>0?`${pn(T)} <span style="font-size:10px;color:var(--dash-text-3)">ETH</span>`:'<span style="color:var(--dash-text-3)">0 ETH</span>'),S("dash-metric-locked",z>0?`<span style="color:#60a5fa">${pn(z)}</span> <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`:'<span style="color:var(--dash-text-3)">0 BKC</span>'),vd();const I=document.getElementById("dash-fortune-prize-text");I&&(I.innerText=A>0?`Prize: ${pn(A)} BKC`:"Play to win");const R=document.getElementById("dash-notary-count-text");R&&(R.innerText=g>0?`${g} docs certified`:"Certify documents"),_.metricsCache={supply:h,burned:C,fees:T,timestamp:Date.now()}}catch(o){console.error("Metrics Error",o)}}function vd(){const e=document.getElementById("dash-metric-balance");if(!e)return;const t=c.currentUserBalance||c.bkcBalance||0n;if(!c.isConnected){e.innerHTML='<span style="font-size:11px;color:var(--dash-text-3)">Connect Wallet</span>';return}if(t===0n)e.innerHTML='0.00 <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>';else{const a=O(t);e.innerHTML=`${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`}}async function Ff(){if(c.userAddress)try{const e=await fetch(`https://getuserprofile-4wvdcuoouq-uc.a.run.app/${c.userAddress}`);e.ok&&(_.userProfile=await e.json())}catch{}}async function la(e=!1){var t,a;if(!c.isConnected){const n=document.getElementById("dash-booster-area");n&&(n.innerHTML=`
                <div style="text-align:center">
                    <p style="font-size:11px;color:var(--dash-text-3);margin-bottom:8px">Connect wallet to view</p>
                    <button onclick="window.openConnectModal()" class="dash-btn-secondary" style="font-size:11px">Connect</button>
                </div>`);return}try{const n=document.getElementById("dash-user-rewards");e&&n&&(n.style.opacity="0.6");const[,s,r]=await Promise.all([Jn(),cp(),Go()]),i=(s==null?void 0:s.netClaimAmount)||0n;hd(i),n&&(n.style.opacity="1");const o=document.getElementById("dashboardClaimBtn");o&&(o.disabled=i<=0n);const l=document.getElementById("dash-user-pstake");if(l){let d=((t=c.userData)==null?void 0:t.pStake)||((a=c.userData)==null?void 0:a.userTotalPStake)||c.userTotalPStake||0n;if(d===0n&&(c.stakingPoolContractPublic||c.stakingPoolContract)&&c.userAddress)try{d=await oe(c.stakingPoolContractPublic||c.stakingPoolContract,"userTotalPStake",[c.userAddress],0n)}catch{}l.innerText=xa(d)}vd(),Mf(r,s),Ff(),Pn()}catch(n){console.error("User Hub Error:",n)}}function Mf(e,t){var R;const a=document.getElementById("dash-booster-area");if(!a)return;const n=(e==null?void 0:e.highestBoost)||0,s=ut(n),r=(t==null?void 0:t.totalRewards)||0n,i=r*BigInt(s)/100n,l=r-i,d=zo(n),u=(e==null?void 0:e.imageUrl)||(d==null?void 0:d.image)||"./assets/bkc_logo_3d.png",p=Te.find(D=>D.name==="Diamond");if(p!=null&&p.image,n===0){if(l>0n){const D=document.getElementById("dash-user-gain-area");D&&(D.classList.add("visible"),document.getElementById("dash-user-potential-gain").innerText=O(l).toFixed(2))}a.innerHTML=`
            <div style="text-align:center;width:100%">
                <div style="position:relative;margin:0 auto 12px;width:60px;height:60px;border-radius:50%;background:rgba(239,68,68,0.08);border:2px dashed rgba(239,68,68,0.25);display:flex;align-items:center;justify-content:center">
                    <i class="fa-solid fa-shield-halved" style="font-size:24px;color:rgba(239,68,68,0.35)"></i>
                    <div style="position:absolute;bottom:-3px;right:-3px;width:20px;height:20px;border-radius:50%;background:#1c1c21;border:2px solid rgba(239,68,68,0.3);display:flex;align-items:center;justify-content:center">
                        <i class="fa-solid fa-xmark" style="font-size:9px;color:#ef4444"></i>
                    </div>
                </div>

                <p style="font-size:11px;font-weight:700;color:var(--dash-text-3);margin:0 0 6px;text-transform:uppercase;letter-spacing:0.05em">No Booster NFT</p>

                <div style="display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:8px">
                    <span style="font-size:20px;font-weight:800;color:var(--dash-accent)">${s}%</span>
                    <span style="font-size:10px;color:var(--dash-text-3);text-align:left;line-height:1.2">reward<br>keep rate</span>
                </div>

                <div style="width:100%;background:var(--dash-surface-2);border-radius:20px;height:6px;overflow:hidden;margin-bottom:10px">
                    <div style="background:linear-gradient(90deg,#ef4444,#f59e0b);height:100%;border-radius:20px;width:${s}%"></div>
                </div>

                ${r>0n&&l>0n?`
                <p style="font-size:10px;color:var(--dash-text-2);margin:0 0 10px">
                    <i class="fa-solid fa-arrow-up" style="color:var(--dash-green);margin-right:3px"></i>Get up to <span style="color:var(--dash-green);font-weight:700">+${O(l).toFixed(2)} BKC</span> with NFT
                </p>`:`
                <p style="font-size:10px;color:var(--dash-text-3);margin:0 0 10px">
                    <i class="fa-solid fa-gem" style="color:var(--dash-accent);margin-right:3px"></i>Diamond holders keep <span style="color:var(--dash-green);font-weight:700">100%</span>
                </p>`}

                <div style="display:flex;gap:6px;justify-content:center">
                    <button class="dash-btn-primary go-to-store" style="background:linear-gradient(135deg,#d97706,#b45309);font-size:11px;padding:7px 14px;flex:1">
                        <i class="fa-solid fa-gem" style="margin-right:3px"></i>Buy NFT
                    </button>
                    <button class="dash-btn-primary go-to-rental" style="background:linear-gradient(135deg,#06b6d4,#0891b2);font-size:11px;padding:7px 14px;flex:1">
                        <i class="fa-solid fa-clock" style="margin-right:3px"></i>Rent NFT
                    </button>
                </div>
                <button id="open-booster-info" style="font-size:10px;color:var(--dash-text-3);background:none;border:none;cursor:pointer;margin-top:6px"><i class="fa-solid fa-circle-info" style="margin-right:3px"></i>How it works</button>
            </div>
        `;return}const m=e.source==="rented",g=(d==null?void 0:d.name)||((R=e.boostName)==null?void 0:R.replace(" Booster","").replace("Booster","").trim())||"Booster",x=(d==null?void 0:d.color)||"color:var(--dash-accent)",h=r*50n/100n,C=i-h,T=m?"fa-clock":"fa-check-circle",A=m?"#22d3ee":"#4ade80",B=m?"rgba(6,182,212,0.12)":"rgba(74,222,128,0.12)",z=m?"rgba(6,182,212,0.3)":"rgba(74,222,128,0.3)",S=m?"RENTED":"OWNED",I=m?"Active rental":"In your wallet";a.innerHTML=`
        <div class="nft-clickable-image" data-address="${y.rewardBooster}" data-tokenid="${e.tokenId}" style="width:100%;cursor:pointer;transition:all 0.2s">
            <div style="display:flex;align-items:center;gap:10px;background:var(--dash-surface-2);border:1px solid ${z};border-radius:12px;padding:10px 12px;margin-bottom:8px">
                <div style="position:relative;width:48px;height:48px;flex-shrink:0">
                    <img src="${u}" style="width:48px;height:48px;border-radius:10px;object-fit:cover;border:2px solid ${z}" alt="${g}" onerror="this.src='./assets/bkc_logo_3d.png'">
                    <div style="position:absolute;bottom:-4px;right:-4px;width:18px;height:18px;border-radius:50%;background:${A};display:flex;align-items:center;justify-content:center;border:2px solid var(--dash-surface-2)">
                        <i class="fa-solid ${T}" style="font-size:8px;color:#000"></i>
                    </div>
                </div>
                <div style="flex:1;min-width:0">
                    <div style="display:flex;align-items:center;gap:6px">
                        <h4 style="${x};font-weight:700;font-size:13px;margin:0">${g}</h4>
                        <span style="font-size:8px;font-weight:800;color:${A};background:${B};padding:2px 6px;border-radius:4px;letter-spacing:0.05em">${S}</span>
                        <span style="font-size:9px;color:var(--dash-text-3)">#${e.tokenId}</span>
                    </div>
                    <p style="font-size:10px;color:var(--dash-text-3);margin:2px 0 0"><i class="fa-solid ${T}" style="color:${A};margin-right:3px;font-size:9px"></i>${I}</p>
                </div>
                <div style="text-align:right;flex-shrink:0">
                    <div style="font-size:18px;font-weight:800;color:var(--dash-green)">${s}%</div>
                    <div style="font-size:8px;color:var(--dash-text-3);text-transform:uppercase;letter-spacing:0.05em">keep rate</div>
                </div>
            </div>
            ${r>0n?`
            <div style="display:flex;gap:6px">
                <div style="flex:1;background:var(--dash-surface-2);border-radius:8px;padding:6px 8px;text-align:center">
                    <div style="font-size:9px;color:var(--dash-text-3);text-transform:uppercase;margin-bottom:2px">Net Reward</div>
                    <div style="font-size:12px;font-weight:700;color:var(--dash-green)">${O(i).toFixed(4)} <span style="font-size:9px;color:var(--dash-text-3)">BKC</span></div>
                </div>
                ${C>0n?`
                <div style="flex:1;background:var(--dash-surface-2);border-radius:8px;padding:6px 8px;text-align:center">
                    <div style="font-size:9px;color:var(--dash-text-3);text-transform:uppercase;margin-bottom:2px">NFT Bonus</div>
                    <div style="font-size:12px;font-weight:700;color:#34d399">+${O(C).toFixed(2)} <span style="font-size:9px;color:var(--dash-text-3)">BKC</span></div>
                </div>`:""}
            </div>`:""}
            ${s<100?`
            <p style="font-size:9px;color:var(--dash-accent);margin:6px 0 0;text-align:center"><i class="fa-solid fa-arrow-up" style="margin-right:2px"></i>Upgrade to Diamond for 100%</p>`:""}
        </div>
    `}async function Bn(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("activity-title");try{if(c.isConnected){if(_.activities.length===0){e&&(e.innerHTML='<div class="dash-loading"><img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt=""><span class="dash-loading-text">Loading your activity...</span></div>');const a=await fetch(`${rt.getHistory}/${c.userAddress}`);a.ok&&(_.activities=await a.json())}if(_.activities.length>0){t&&(t.textContent="Your Activity"),Ds();return}}t&&(t.textContent="Network Activity"),await Mi()}catch(a){console.error("Activity fetch error:",a),t&&(t.textContent="Network Activity"),await Mi()}}async function Mi(){const e=document.getElementById("dash-activity-list");if(!e||_.isLoadingNetworkActivity)return;const t=Date.now()-_.networkActivitiesTimestamp;if(_.networkActivities.length>0&&t<3e5){Di();return}_.isLoadingNetworkActivity=!0,e.innerHTML='<div class="dash-loading"><img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt=""><span class="dash-loading-text">Loading network activity...</span></div>';try{const a=await fetch(`${yf}?limit=30`);if(a.ok){const n=await a.json();_.networkActivities=Array.isArray(n)?n:n.activities||[],_.networkActivitiesTimestamp=Date.now()}else _.networkActivities=[]}catch{_.networkActivities=[]}finally{_.isLoadingNetworkActivity=!1}Di()}function Di(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("dash-pagination-controls");if(!e)return;if(_.networkActivities.length===0){e.innerHTML=`
            <div style="text-align:center;padding:32px 16px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(245,158,11,0.08);border:1px dashed rgba(245,158,11,0.2);display:flex;align-items:center;justify-content:center;margin:0 auto 12px">
                    <i class="fa-solid fa-bolt" style="font-size:18px;color:rgba(245,158,11,0.3)"></i>
                </div>
                <p style="font-size:12px;color:var(--dash-text-3);margin:0 0 4px">No network activity yet</p>
                <p style="font-size:10px;color:var(--dash-text-3);margin:0">Be the first to stake, trade or play!</p>
            </div>`,t&&(t.style.display="none");return}const a=document.getElementById("activity-count");a&&(a.style.display="inline",a.textContent=_.networkActivities.length),e.innerHTML=_.networkActivities.slice(0,15).map(n=>wd(n,!0)).join(""),t&&(t.style.display="none")}function Ds(){let e=[..._.activities];const t=_.filters.type,a=n=>(n||"").toUpperCase();t!=="ALL"&&(e=e.filter(n=>{const s=a(n.type);return t==="STAKE"?s.includes("DELEGATION")||s.includes("DELEGAT")||s.includes("STAKE")||s.includes("UNSTAKE"):t==="CLAIM"?s.includes("REWARD")||s.includes("CLAIM"):t==="NFT"?s.includes("BOOSTER")||s.includes("RENT")||s.includes("NFT")||s.includes("TRANSFER"):t==="GAME"?s.includes("FORTUNE")||s.includes("GAME")||s.includes("REQUEST")||s.includes("RESULT")||s.includes("FULFILLED"):t==="CHARITY"?s.includes("CHARITY")||s.includes("CAMPAIGN")||s.includes("DONATION")||s.includes("DONATE"):t==="NOTARY"?s.includes("NOTARY")||s.includes("NOTARIZED")||s.includes("DOCUMENT"):t==="BACKCHAT"?s.includes("POST")||s.includes("LIKE")||s.includes("REPLY")||s.includes("REPOST")||s.includes("FOLLOW")||s.includes("PROFILE")||s.includes("BOOST")||s.includes("BADGE")||s.includes("TIP")||s.includes("BACKCHAT"):t==="FAUCET"?s.includes("FAUCET"):!0})),e.sort((n,s)=>{const r=i=>i.timestamp&&i.timestamp._seconds?i.timestamp._seconds:i.createdAt&&i.createdAt._seconds?i.createdAt._seconds:i.timestamp?new Date(i.timestamp).getTime()/1e3:0;return _.filters.sort==="NEWEST"?r(s)-r(n):r(n)-r(s)}),_.filteredActivities=e,_.pagination.currentPage=1,Os()}function Os(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("dash-pagination-controls");if(!e)return;if(_.filteredActivities.length===0){const r=_.filters.type!=="ALL";e.innerHTML=`
            <div style="text-align:center;padding:32px 16px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(167,139,250,0.08);border:1px dashed rgba(167,139,250,0.2);display:flex;align-items:center;justify-content:center;margin:0 auto 12px">
                    <i class="fa-solid ${r?"fa-filter":"fa-rocket"}" style="font-size:18px;color:rgba(167,139,250,0.3)"></i>
                </div>
                <p style="font-size:12px;color:var(--dash-text-3);margin:0 0 4px">${r?"No matching activity":"No activity yet"}</p>
                <p style="font-size:10px;color:var(--dash-text-3);margin:0">${r?"Try a different filter":"Start staking, trading or playing!"}</p>
            </div>`,t&&(t.style.display="none");const i=document.getElementById("activity-count");i&&(i.style.display="none");return}const a=document.getElementById("activity-count");a&&(a.style.display="inline",a.textContent=_.filteredActivities.length);const n=(_.pagination.currentPage-1)*_.pagination.itemsPerPage,s=_.filteredActivities.slice(n,n+_.pagination.itemsPerPage);if(e.innerHTML=s.map(r=>wd(r,!1)).join(""),t){const r=Math.ceil(_.filteredActivities.length/_.pagination.itemsPerPage);r>1?(t.style.display="flex",document.getElementById("page-indicator").innerText=`${_.pagination.currentPage}/${r}`,document.getElementById("page-prev").disabled=_.pagination.currentPage===1,document.getElementById("page-next").disabled=_.pagination.currentPage>=r):t.style.display="none"}}function wd(e,t=!1){const a=Ef(e.timestamp||e.createdAt),n=Tf(e.timestamp||e.createdAt),s=e.user||e.userAddress||e.from||"",r=Cf(s),i=If(e.type,e.details);let o="";const l=(e.type||"").toUpperCase().trim(),d=e.details||{};if(l.includes("GAME")||l.includes("FORTUNE")||l.includes("REQUEST")||l.includes("FULFILLED")||l.includes("RESULT")){const h=d.rolls||e.rolls||[],C=d.guesses||e.guesses||[],T=d.isWin||d.prizeWon&&BigInt(d.prizeWon||0)>0n,A=d.isCumulative!==void 0?d.isCumulative:C.length>1,B=A?"Combo":"Jackpot",z=A?"background:rgba(168,85,247,0.15);color:#c084fc":"background:rgba(245,158,11,0.15);color:#fbbf24",S=d.wagerAmount||d.amount,I=d.prizeWon,R=S?O(BigInt(S)).toFixed(0):"0";let D='<span style="color:var(--dash-text-3)">No win</span>';T&&I&&BigInt(I)>0n&&(D=`<span style="color:var(--dash-green);font-weight:700">+${O(BigInt(I)).toFixed(0)} BKC</span>`);let q="";return h.length>0&&(q=`<div style="display:flex;gap:3px">${h.map((re,X)=>{const W=C[X],pe=W!==void 0&&Number(W)===Number(re);return`<div style="width:24px;height:24px;border-radius:4px;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid ${pe?"rgba(52,211,153,0.4)":"var(--dash-border)"};background:${pe?"rgba(52,211,153,0.1)":"var(--dash-surface-2)"};color:${pe?"#34d399":"var(--dash-text-3)"}">${re}</div>`}).join("")}</div>`),`
            <a href="${e.txHash?`${_i}${e.txHash}`:"#"}" target="_blank" class="dash-fortune-item" title="${n}">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
                    <div style="display:flex;align-items:center;gap:8px">
                        <div style="width:28px;height:28px;border-radius:6px;background:var(--dash-surface-3);display:flex;align-items:center;justify-content:center"><i class="fa-solid fa-dice" style="color:var(--dash-text-3);font-size:11px"></i></div>
                        <span style="color:var(--dash-text);font-size:12px;font-weight:600">${t?r:"You"}</span>
                        <span style="font-size:9px;font-weight:700;${z};padding:1px 6px;border-radius:4px">${B}</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--dash-text-3)">
                        <span>${a}</span>
                        <i class="fa-solid fa-external-link dash-activity-item-link"></i>
                    </div>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between">
                    <div style="font-size:11px"><span style="color:var(--dash-text-3)">Bet: ${R}</span><span style="margin:0 6px;color:var(--dash-text-3)">â†’</span>${D}</div>
                    ${q}
                </div>
            </a>
        `}if(l.includes("NOTARY")){const h=d.ipfsCid;h&&(o=`<span style="margin-left:4px;font-size:9px;color:#818cf8;font-family:monospace">${h.replace("ipfs://","").slice(0,12)}...</span>`)}if(l.includes("STAKING")||l.includes("DELEGAT")){const h=d.pStakeGenerated;h&&(o=`<span style="font-size:10px;color:var(--dash-purple)">+${O(BigInt(h)).toFixed(0)} pStake</span>`)}if(l.includes("DONATION")||l.includes("CHARITY")){const h=d.netAmount||d.amount,C=d.campaignId;h&&BigInt(h)>0n&&(o=`<span style="color:#ec4899;font-weight:700">${O(BigInt(h)).toFixed(2)} BKC</span>`,C&&(o+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">Campaign #${C}</span>`))}if(l.includes("CLAIM")||l.includes("REWARD")){const h=d.amount||e.amount;h&&(o=`<span style="color:var(--dash-accent);font-weight:700">+${O(BigInt(h)).toFixed(2)} BKC</span>`);const C=d.feePaid;C&&BigInt(C)>0n&&(o+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">(fee: ${O(BigInt(C)).toFixed(2)})</span>`)}const p=l.includes("PROMOT")||l.includes("ADS")||l.includes("ADVERTIS");if(p){const h=d.promotionFee||d.amount||e.amount;h&&BigInt(h)>0n&&(o=`<span style="color:#fbbf24;font-weight:700">${parseFloat(va.formatEther(BigInt(h))).toFixed(4)} ETH</span>`);const C=d.tokenId||e.tokenId;C&&(o+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">NFT #${C}</span>`)}const m=e.txHash?`${_i}${e.txHash}`:"#";let g="";if(p){const h=d.promotionFee||d.amount||e.amount;h&&BigInt(h)>0n&&(g=parseFloat(va.formatEther(BigInt(h))).toFixed(4))}else{let h=e.amount||d.netAmount||d.amount||d.wagerAmount||d.prizeWon||"0";const C=O(BigInt(h));g=C>.001?C.toFixed(2):""}const x=p?"ETH":"BKC";return`
        <a href="${m}" target="_blank" class="dash-activity-item" title="${n}">
            <div class="dash-activity-item-icon" style="background:${i.bg};border:1px solid transparent">
                <i class="fa-solid ${i.icon}" style="color:${i.color}"></i>
            </div>
            <div class="dash-activity-item-info">
                <div class="dash-activity-item-label">${i.label}${o?` ${o}`:""}</div>
                <div class="dash-activity-item-meta">${t?r+" Â· ":""}${a}</div>
            </div>
            <div style="display:flex;align-items:center;gap:6px">
                ${g?`<div class="dash-activity-item-amount">${g} <span class="unit">${x}</span></div>`:""}
                <i class="fa-solid fa-arrow-up-right-from-square dash-activity-item-link"></i>
            </div>
        </a>
    `}function Df(){Oe.dashboard&&Oe.dashboard.addEventListener("click",async e=>{const t=e.target;if(t.closest("#manual-refresh-btn")){const r=t.closest("#manual-refresh-btn");r.disabled=!0,r.innerHTML='<i class="fa-solid fa-rotate fa-spin"></i>',await la(!0),await Ms(),_.activities=[],_.networkActivities=[],_.networkActivitiesTimestamp=0,_.faucet.lastCheck=0,await Bn(),setTimeout(()=>{r.innerHTML='<i class="fa-solid fa-rotate"></i>',r.disabled=!1},1e3)}if(t.closest("#faucet-action-btn")){const r=t.closest("#faucet-action-btn");r.disabled||await Fi(r)}if(t.closest("#emergency-faucet-btn")&&await Fi(t.closest("#emergency-faucet-btn")),t.closest("#referral-copy-btn")&&Bf(),t.closest("#referral-share-btn")&&Sf(),t.closest(".delegate-link")&&(e.preventDefault(),window.navigateTo("mine")),t.closest(".go-to-store")&&(e.preventDefault(),window.navigateTo("store")),t.closest(".go-to-rental")&&(e.preventDefault(),window.navigateTo("rental")),t.closest(".go-to-fortune")&&(e.preventDefault(),window.navigateTo("actions")),t.closest(".go-to-notary")&&(e.preventDefault(),window.navigateTo("notary")),t.closest(".go-to-charity")&&(e.preventDefault(),window.navigateTo("charity")),t.closest(".go-to-backchat")&&(e.preventDefault(),window.navigateTo("backchat")),t.closest("#open-booster-info")){const r=document.getElementById("booster-info-modal");r&&r.classList.add("visible")}if(t.closest("#close-booster-modal")||t.id==="booster-info-modal"){const r=document.getElementById("booster-info-modal");r&&r.classList.remove("visible")}if(t.closest("#close-gas-modal-dash")||t.id==="no-gas-modal-dash"){const r=document.getElementById("no-gas-modal-dash");r&&r.classList.remove("visible")}const a=t.closest(".nft-clickable-image");if(a){const r=a.dataset.address,i=a.dataset.tokenid;r&&i&&Ku(r,i)}const n=t.closest("#dashboardClaimBtn");if(n&&!n.disabled)try{if(n.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>',n.disabled=!0,!await zf()){n.innerHTML='<i class="fa-solid fa-coins" style="margin-right:6px"></i> Claim Rewards',n.disabled=!1;return}const{stakingRewards:i,minerRewards:o}=await sr();(i>0n||o>0n)&&await ha.claimRewards({button:n,onSuccess:async()=>{b("Rewards claimed!","success"),await la(!0),_.activities=[],Bn()},onError:l=>{l.cancelled||b("Claim failed","error")}})}catch{b("Claim failed","error")}finally{n.innerHTML='<i class="fa-solid fa-coins" style="margin-right:6px"></i> Claim Rewards',n.disabled=!1}if(t.closest("#page-prev")&&_.pagination.currentPage>1&&(_.pagination.currentPage--,Os()),t.closest("#page-next")){const r=Math.ceil(_.filteredActivities.length/_.pagination.itemsPerPage);_.pagination.currentPage<r&&(_.pagination.currentPage++,Os())}t.closest("#activity-sort-toggle")&&(_.filters.sort=_.filters.sort==="NEWEST"?"OLDEST":"NEWEST",Ds());const s=t.closest(".dash-chip");s&&(document.querySelectorAll(".dash-chip").forEach(r=>r.classList.remove("active")),s.classList.add("active"),_.filters.type=s.dataset.filter,Ds())})}const yd={async render(e){if($f(),Af(),Ms(),Bn(),fn(),c.isConnected&&c.userAddress){try{localStorage.getItem("bkc_faucet_"+c.userAddress.toLowerCase())&&(_.faucet.canClaim=!1)}catch{}Pn()}c.isConnected?await la(!1):(setTimeout(async()=>{c.isConnected&&(await la(!1),fn())},500),setTimeout(async()=>{c.isConnected&&(await la(!1),fn())},1500))},update(e){const t=Date.now();t-_.lastUpdate>1e4&&(_.lastUpdate=t,Ms(),e&&(la(!1),fn()),Bn())}},Ha=window.ethers,Of="https://sepolia.arbiscan.io/tx/",oa={NONE:{boost:0,burnRate:50,keepRate:50,color:"#71717a",name:"None",icon:"â—‹",class:"stk-tier-none"},BRONZE:{boost:1e3,burnRate:40,keepRate:60,color:"#cd7f32",name:"Bronze",icon:"ðŸ¥‰",class:"stk-tier-bronze"},SILVER:{boost:2500,burnRate:25,keepRate:75,color:"#c0c0c0",name:"Silver",icon:"ðŸ¥ˆ",class:"stk-tier-silver"},GOLD:{boost:4e3,burnRate:10,keepRate:90,color:"#ffd700",name:"Gold",icon:"ðŸ¥‡",class:"stk-tier-gold"},DIAMOND:{boost:5e3,burnRate:0,keepRate:100,color:"#b9f2ff",name:"Diamond",icon:"ðŸ’Ž",class:"stk-tier-diamond"}};let ua=!1,Ua=0,Mr=3650,nt=!1,Sn=[],yn=0n,Ut=null,$a="ALL",Et=0,Hs=50,Oi="none",Ae=null,Us=0n,Dr=0n,Or=0n;function kd(e){if(e<=0)return"Ready";const t=Math.floor(e/86400),a=Math.floor(e%86400/3600),n=Math.floor(e%3600/60);return t>365?`${Math.floor(t/365)}y ${Math.floor(t%365/30)}mo`:t>30?`${Math.floor(t/30)}mo ${t%30}d`:t>0?`${t}d ${a}h`:a>0?`${a}h ${n}m`:`${n}m`}function Hf(e){if(e>=365){const t=Math.floor(e/365);return t===1?"1 Year":`${t} Years`}return e>=30?`${Math.floor(e/30)} Month(s)`:`${e} Day(s)`}function Uf(e,t){if(e<=0n||t<=0n)return 0n;const a=t/86400n,n=10000n,s=n+a*5918n/365n;return e*s/n}function jf(e){if(!e)return"Recent";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Recent"}}function Ed(e){const t=Number(e);return t>=5e3?oa.DIAMOND:t>=4e3?oa.GOLD:t>=2500?oa.SILVER:t>=1e3?oa.BRONZE:oa.NONE}function Wf(){if(document.getElementById("stk-styles-v10"))return;const e=document.createElement("style");e.id="stk-styles-v10",e.textContent=`
        .stk-shell {
            --stk-bg: #0c0c0e;
            --stk-surface: #141417;
            --stk-surface-2: #1c1c21;
            --stk-surface-3: #222228;
            --stk-border: rgba(255,255,255,0.06);
            --stk-border-h: rgba(255,255,255,0.12);
            --stk-text: #f0f0f2;
            --stk-text-2: #a0a0ab;
            --stk-text-3: #5c5c68;
            --stk-accent: #f59e0b;
            --stk-green: #4ade80;
            --stk-purple: #a78bfa;
            --stk-cyan: #22d3ee;
            --stk-red: #ef4444;
            --stk-radius: 16px;
            --stk-radius-sm: 10px;
            --stk-tr: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes stk-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes stk-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes stk-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes stk-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes stk-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }

        .stk-shell { max-width: 960px; margin: 0 auto; padding: 0 16px 40px; animation: stk-fadeIn 0.4s ease-out; }

        /* â”€â”€ Header â”€â”€ */
        .stk-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .stk-header-left { display: flex; align-items: center; gap: 14px; }
        .stk-header-icon {
            width: 48px; height: 48px; border-radius: var(--stk-radius);
            background: linear-gradient(135deg, rgba(167,139,250,0.15), rgba(139,92,246,0.1));
            border: 1px solid rgba(167,139,250,0.2);
            display: flex; align-items: center; justify-content: center;
            animation: stk-float 4s ease-in-out infinite;
        }
        .stk-header-icon i { font-size: 20px; color: var(--stk-purple); }
        .stk-header-title { font-size: 20px; font-weight: 800; color: var(--stk-text); }
        .stk-header-sub { font-size: 11px; color: var(--stk-text-3); }
        .stk-refresh-btn {
            width: 40px; height: 40px; border-radius: var(--stk-radius-sm);
            background: var(--stk-surface); border: 1px solid var(--stk-border);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all var(--stk-tr); color: var(--stk-text-3);
        }
        .stk-refresh-btn:hover { color: var(--stk-text); border-color: var(--stk-border-h); }

        /* â”€â”€ Hero Card â”€â”€ */
        .stk-hero {
            position: relative; overflow: hidden;
            background: linear-gradient(135deg, rgba(20,20,23,0.95), rgba(12,12,14,0.98));
            border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius);
            padding: 28px 24px;
            margin-bottom: 14px;
            animation: stk-scaleIn 0.5s ease-out;
        }
        .stk-hero::before {
            content: '';
            position: absolute; top: -50%; right: -20%;
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(74,222,128,0.05) 0%, transparent 70%);
            pointer-events: none; animation: stk-glow 4s ease-in-out infinite;
        }
        .stk-hero::after {
            content: '';
            position: absolute; inset: 0;
            border-radius: var(--stk-radius); padding: 1px;
            background: linear-gradient(135deg, rgba(74,222,128,0.2), rgba(167,139,250,0.15), rgba(245,158,11,0.1));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude; -webkit-mask-composite: xor;
            pointer-events: none; opacity: 0.5;
        }
        .stk-hero-inner { display: flex; gap: 24px; position: relative; z-index: 1; }
        .stk-hero-left { flex: 1.2; min-width: 0; }
        .stk-hero-right { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }

        .stk-hero-label { font-size: 11px; color: var(--stk-text-3); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 4px; }
        .stk-reward-value {
            font-size: clamp(28px, 5vw, 40px); font-weight: 800;
            color: var(--stk-green); font-variant-numeric: tabular-nums;
            line-height: 1.1; text-shadow: 0 0 30px rgba(74,222,128,0.2);
        }
        .stk-reward-suffix { font-size: 14px; color: rgba(74,222,128,0.6); font-weight: 600; }

        .stk-claim-btn {
            display: inline-flex; align-items: center; gap: 8px;
            margin-top: 16px; padding: 10px 24px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white; font-weight: 700; font-size: 14px;
            border-radius: var(--stk-radius-sm); border: none; cursor: pointer;
            transition: all var(--stk-tr); box-shadow: 0 4px 20px rgba(34,197,94,0.25);
        }
        .stk-claim-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(34,197,94,0.35); }
        .stk-claim-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
        .stk-claim-btn:not(:disabled) {
            background-size: 200% 100%;
            background-image: linear-gradient(90deg, #22c55e 0%, #34d399 25%, #22c55e 50%, #10b981 100%);
            animation: stk-shimmer 3s linear infinite;
        }
        .stk-eth-fee { font-size: 10px; color: var(--stk-text-3); margin-top: 6px; }

        .stk-breakdown { margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--stk-border); }
        .stk-breakdown-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; padding: 3px 0; }
        .stk-breakdown-label { color: var(--stk-text-3); display: flex; align-items: center; gap: 4px; }
        .stk-breakdown-val { font-weight: 700; font-family: 'SF Mono', monospace; }

        /* â”€â”€ NFT Boost Panel â”€â”€ */
        .stk-boost-panel {
            background: var(--stk-surface-2); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius-sm); padding: 16px;
        }
        .stk-tier-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 12px; border-radius: 20px;
            font-weight: 700; font-size: 12px; border: 1px solid;
        }
        .stk-tier-none { background: rgba(113,113,122,0.1); border-color: rgba(113,113,122,0.2); color: #a1a1aa; }
        .stk-tier-bronze { background: rgba(205,127,50,0.1); border-color: rgba(205,127,50,0.3); color: #cd7f32; }
        .stk-tier-silver { background: rgba(192,192,192,0.1); border-color: rgba(192,192,192,0.3); color: #e5e5e5; }
        .stk-tier-gold { background: rgba(255,215,0,0.1); border-color: rgba(255,215,0,0.3); color: #ffd700; }
        .stk-tier-diamond { background: rgba(185,242,255,0.1); border-color: rgba(185,242,255,0.3); color: #b9f2ff; }

        .stk-burn-bar { height: 8px; background: rgba(239,68,68,0.15); border-radius: 4px; overflow: hidden; position: relative; margin: 10px 0 6px; }
        .stk-burn-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(90deg, #ef4444, #f87171); border-radius: 4px; transition: width 0.5s ease; }
        .stk-keep-fill { position: absolute; right: 0; top: 0; height: 100%; background: linear-gradient(90deg, #22c55e, #4ade80); border-radius: 4px; transition: width 0.5s ease; }

        .stk-boost-cta {
            display: inline-flex; align-items: center; gap: 6px;
            margin-top: 10px; padding: 7px 14px; font-size: 11px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--stk-tr); color: #000;
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .stk-boost-cta:hover { filter: brightness(1.1); transform: translateY(-1px); }

        /* â”€â”€ Stats Row â”€â”€ */
        .stk-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 14px; }
        .stk-stat {
            display: flex; flex-direction: column; gap: 2px;
            padding: 10px 12px; background: var(--stk-surface);
            border: 1px solid var(--stk-border); border-radius: var(--stk-radius-sm);
            transition: border-color var(--stk-tr);
        }
        .stk-stat:hover { border-color: var(--stk-border-h); }
        .stk-stat-label { font-size: 9px; color: var(--stk-text-3); text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .stk-stat-label i { font-size: 9px; }
        .stk-stat-value { font-size: 14px; font-weight: 700; color: var(--stk-text); font-variant-numeric: tabular-nums; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* â”€â”€ Card Base â”€â”€ */
        .stk-card {
            background: var(--stk-surface); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius); padding: 18px;
            margin-bottom: 14px; animation: stk-fadeIn 0.5s ease-out both;
        }
        .stk-card-title { font-size: 14px; font-weight: 700; color: var(--stk-text); margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
        .stk-card-title i { color: var(--stk-text-3); font-size: 12px; }

        /* â”€â”€ Stake Form â”€â”€ */
        .stk-input-wrap { position: relative; margin-bottom: 12px; }
        .stk-amount-input {
            width: 100%; padding: 14px 70px 14px 16px;
            background: var(--stk-surface-2); border: 1px solid var(--stk-border-h);
            border-radius: var(--stk-radius-sm); color: var(--stk-text);
            font-size: 20px; font-weight: 700; font-family: 'SF Mono', 'JetBrains Mono', monospace;
            outline: none; transition: border-color var(--stk-tr);
        }
        .stk-amount-input::placeholder { color: var(--stk-text-3); font-weight: 400; }
        .stk-amount-input:focus { border-color: rgba(167,139,250,0.4); }
        .stk-amount-input.error { border-color: rgba(239,68,68,0.5); }
        .stk-max-btn {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            padding: 4px 10px; font-size: 10px; font-weight: 800;
            background: rgba(167,139,250,0.15); color: var(--stk-purple);
            border: 1px solid rgba(167,139,250,0.3); border-radius: 6px;
            cursor: pointer; transition: all var(--stk-tr);
        }
        .stk-max-btn:hover { background: rgba(167,139,250,0.25); }
        .stk-balance-row { display: flex; justify-content: space-between; align-items: center; font-size: 11px; color: var(--stk-text-3); margin-bottom: 14px; }

        /* Duration Chips */
        .stk-duration-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 14px; }
        .stk-duration-chip {
            padding: 10px 8px; text-align: center;
            background: var(--stk-surface-2); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius-sm); cursor: pointer;
            transition: all var(--stk-tr); position: relative;
        }
        .stk-duration-chip:hover { border-color: var(--stk-border-h); }
        .stk-duration-chip.selected {
            background: linear-gradient(135deg, rgba(167,139,250,0.12), rgba(139,92,246,0.08));
            border-color: rgba(167,139,250,0.4);
            box-shadow: 0 0 16px rgba(167,139,250,0.1);
        }
        .stk-duration-chip .stk-chip-label { font-size: 14px; font-weight: 700; color: var(--stk-text); }
        .stk-duration-chip .stk-chip-sub { font-size: 9px; color: var(--stk-text-3); margin-top: 2px; }
        .stk-duration-chip.selected .stk-chip-label { color: var(--stk-purple); }
        .stk-duration-chip.recommended::after {
            content: '\\2605'; position: absolute; top: -6px; right: -4px;
            width: 16px; height: 16px; font-size: 9px; line-height: 16px; text-align: center;
            background: linear-gradient(135deg, #f59e0b, #d97706); color: #000;
            border-radius: 50%;
        }

        .stk-preview-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; padding: 6px 0; }
        .stk-preview-label { color: var(--stk-text-3); }
        .stk-preview-val { color: var(--stk-text); font-weight: 700; font-family: 'SF Mono', monospace; }

        .stk-delegate-btn {
            width: 100%; padding: 12px; margin-top: 14px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white; font-weight: 700; font-size: 14px;
            border-radius: var(--stk-radius-sm); border: none; cursor: pointer;
            transition: all var(--stk-tr); box-shadow: 0 4px 20px rgba(139,92,246,0.2);
        }
        .stk-delegate-btn:hover:not(:disabled) { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 6px 28px rgba(139,92,246,0.3); }
        .stk-delegate-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }

        /* â”€â”€ Delegations â”€â”€ */
        .stk-deleg-list { display: flex; flex-direction: column; gap: 6px; max-height: 350px; overflow-y: auto; }
        .stk-deleg-list::-webkit-scrollbar { width: 4px; }
        .stk-deleg-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
        .stk-deleg-item {
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
            padding: 10px 12px; background: var(--stk-surface-2);
            border: 1px solid transparent; border-radius: 8px;
            transition: all var(--stk-tr);
        }
        .stk-deleg-item:hover { background: var(--stk-surface-3); border-color: var(--stk-border-h); transform: translateX(3px); }
        .stk-deleg-icon {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .stk-deleg-info { flex: 1; min-width: 0; }
        .stk-deleg-amount { font-size: 13px; font-weight: 700; color: var(--stk-text); }
        .stk-deleg-meta { font-size: 10px; color: var(--stk-text-3); margin-top: 1px; display: flex; align-items: center; gap: 6px; }
        .stk-countdown { font-size: 11px; font-weight: 700; color: #fbbf24; font-family: 'SF Mono', monospace; }
        .stk-unstake-btn {
            padding: 5px 10px; font-size: 10px; font-weight: 700;
            border-radius: 6px; cursor: pointer; transition: all var(--stk-tr); border: none;
        }
        .stk-unstake-ready { background: rgba(255,255,255,0.1); color: var(--stk-text); }
        .stk-unstake-ready:hover { background: rgba(255,255,255,0.2); }
        .stk-unstake-force { background: rgba(239,68,68,0.1); color: var(--stk-red); }
        .stk-unstake-force:hover { background: rgba(239,68,68,0.2); }

        /* â”€â”€ History â”€â”€ */
        .stk-tabs { display: flex; gap: 6px; margin-bottom: 12px; }
        .stk-tab {
            padding: 4px 10px; font-size: 10px; font-weight: 600;
            color: var(--stk-text-3); background: var(--stk-surface-2);
            border: 1px solid var(--stk-border); border-radius: 20px;
            cursor: pointer; transition: all var(--stk-tr); white-space: nowrap;
        }
        .stk-tab:hover { color: var(--stk-text-2); border-color: var(--stk-border-h); }
        .stk-tab.active { color: var(--stk-purple); background: rgba(167,139,250,0.1); border-color: rgba(167,139,250,0.3); }

        .stk-history-list { display: flex; flex-direction: column; gap: 4px; max-height: 400px; overflow-y: auto; }
        .stk-history-list::-webkit-scrollbar { width: 4px; }
        .stk-history-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
        .stk-history-item {
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
            padding: 8px 10px; background: var(--stk-surface-2);
            border: 1px solid transparent; border-radius: 8px;
            transition: all var(--stk-tr); text-decoration: none;
        }
        .stk-history-item:hover { background: var(--stk-surface-3); border-color: var(--stk-border-h); }
        .stk-history-icon {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 12px;
        }
        .stk-history-info { flex: 1; min-width: 0; }
        .stk-history-label { font-size: 12px; font-weight: 600; color: var(--stk-text); display: flex; align-items: center; gap: 6px; }
        .stk-history-date { font-size: 10px; color: var(--stk-text-3); margin-top: 1px; }
        .stk-history-amount { font-size: 12px; font-weight: 600; color: var(--stk-text); font-family: 'SF Mono', monospace; text-align: right; white-space: nowrap; }
        .stk-history-link { font-size: 9px; color: var(--stk-text-3); transition: color var(--stk-tr); }
        .stk-history-item:hover .stk-history-link { color: var(--stk-purple); }

        /* â”€â”€ Empty / Loading â”€â”€ */
        .stk-empty { text-align: center; padding: 32px 16px; }
        .stk-empty i { font-size: 24px; color: var(--stk-text-3); margin-bottom: 8px; display: block; }
        .stk-empty p { font-size: 12px; color: var(--stk-text-3); }
        .stk-loading { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 32px; }
        .stk-loading-icon { width: 36px; height: 36px; opacity: 0.3; animation: stk-float 2s ease-in-out infinite; }

        /* â”€â”€ Not Connected â”€â”€ */
        .stk-connect-card {
            text-align: center; padding: 48px 24px;
            background: var(--stk-surface); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius);
        }
        .stk-connect-btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 24px; margin-top: 16px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white; font-weight: 700; font-size: 14px;
            border-radius: var(--stk-radius-sm); border: none; cursor: pointer;
            transition: all var(--stk-tr);
        }
        .stk-connect-btn:hover { filter: brightness(1.1); }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 640px) {
            .stk-shell { padding: 0 10px 30px; }
            .stk-hero { padding: 20px 16px; }
            .stk-hero-inner { flex-direction: column; gap: 16px; }
            .stk-hero-right { border-top: 1px solid var(--stk-border); padding-top: 16px; }
            .stk-stats { grid-template-columns: repeat(2, 1fr); }
            .stk-reward-value { font-size: 28px; }
            .stk-duration-grid { grid-template-columns: repeat(2, 1fr); }
            .stk-tabs { flex-wrap: nowrap; overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
            .stk-tabs::-webkit-scrollbar { display: none; }
        }
    `,document.head.appendChild(e)}function Gf(){const e=document.getElementById("mine");e&&(Wf(),e.innerHTML=`
        <div class="stk-shell">

            <!-- HEADER -->
            <div class="stk-header">
                <div class="stk-header-left">
                    <div class="stk-header-icon"><i class="fa-solid fa-layer-group"></i></div>
                    <div>
                        <div class="stk-header-title">Stake & Earn</div>
                        <div class="stk-header-sub">Delegate BKC, earn rewards, reduce burn</div>
                    </div>
                </div>
                <button id="stk-refresh-btn" class="stk-refresh-btn"><i class="fa-solid fa-rotate"></i></button>
            </div>

            <!-- HERO REWARDS -->
            <div class="stk-hero">
                <div class="stk-hero-inner">
                    <div class="stk-hero-left">
                        <div class="stk-hero-label">You Will Receive</div>
                        <div id="stk-reward-value" class="stk-reward-value">-- <span class="stk-reward-suffix">BKC</span></div>

                        <div id="stk-breakdown" class="stk-breakdown" style="display:none">
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-layer-group" style="color:var(--stk-purple)"></i> Staking</span>
                                <span id="stk-break-staking" class="stk-breakdown-val" style="color:var(--stk-text)">0</span>
                            </div>
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-coins" style="color:var(--stk-accent)"></i> Mining</span>
                                <span id="stk-break-mining" class="stk-breakdown-val" style="color:var(--stk-text)">0</span>
                            </div>
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-fire" style="color:var(--stk-red)"></i> Burned</span>
                                <span id="stk-break-burned" class="stk-breakdown-val" style="color:var(--stk-red)">0</span>
                            </div>
                        </div>

                        <button id="stk-claim-btn" class="stk-claim-btn" disabled>
                            <i class="fa-solid fa-hand-holding-dollar"></i> <span>Claim Rewards</span>
                        </button>
                        <div id="stk-eth-fee" class="stk-eth-fee"></div>
                    </div>

                    <div class="stk-hero-right">
                        <div id="stk-boost-panel">
                            <div style="text-align:center">
                                <img src="./assets/bkc_logo_3d.png" style="width:32px;height:32px;opacity:0.3;animation:stk-float 2s infinite" alt="">
                                <p style="font-size:11px;color:var(--stk-text-3);margin-top:8px">Loading boost...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STATS ROW -->
            <div class="stk-stats">
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-globe" style="color:var(--stk-purple)"></i> Network pStake</div>
                    <div id="stk-stat-network" class="stk-stat-value">--</div>
                </div>
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-bolt" style="color:var(--stk-cyan)"></i> Your Power</div>
                    <div id="stk-stat-power" class="stk-stat-value">--</div>
                </div>
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-gift" style="color:var(--stk-green)"></i> Pending</div>
                    <div id="stk-stat-rewards" class="stk-stat-value">--</div>
                </div>
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-lock" style="color:var(--stk-accent)"></i> Active Locks</div>
                    <div id="stk-stat-locks" class="stk-stat-value">--</div>
                </div>
            </div>

            <!-- STAKE FORM -->
            <div class="stk-card" style="animation-delay:0.1s">
                <div class="stk-card-title"><i class="fa-solid fa-arrow-right-to-bracket"></i> Delegate BKC</div>

                <div class="stk-input-wrap">
                    <input type="number" id="stk-amount-input" class="stk-amount-input" placeholder="0.00" step="any" min="0">
                    <button id="stk-max-btn" class="stk-max-btn">MAX</button>
                </div>

                <div class="stk-balance-row">
                    <span>Available</span>
                    <span id="stk-balance-display">-- BKC</span>
                </div>

                <div class="stk-duration-grid">
                    <div class="stk-duration-chip" data-days="30">
                        <div class="stk-chip-label">1M</div>
                        <div class="stk-chip-sub">30 days</div>
                    </div>
                    <div class="stk-duration-chip" data-days="365">
                        <div class="stk-chip-label">1Y</div>
                        <div class="stk-chip-sub">365 days</div>
                    </div>
                    <div class="stk-duration-chip" data-days="1825">
                        <div class="stk-chip-label">5Y</div>
                        <div class="stk-chip-sub">1,825 days</div>
                    </div>
                    <div class="stk-duration-chip selected recommended" data-days="3650">
                        <div class="stk-chip-label">10Y</div>
                        <div class="stk-chip-sub">3,650 days</div>
                    </div>
                </div>

                <div style="background:var(--stk-surface-2);border-radius:8px;padding:10px 12px;margin-bottom:4px">
                    <div class="stk-preview-row">
                        <span class="stk-preview-label">pStake Power</span>
                        <span id="stk-preview-pstake" class="stk-preview-val" style="color:var(--stk-purple)">0</span>
                    </div>
                    <div class="stk-preview-row">
                        <span class="stk-preview-label">Net Amount</span>
                        <span id="stk-preview-net" class="stk-preview-val">0.00 BKC</span>
                    </div>
                    <div class="stk-preview-row">
                        <span class="stk-preview-label">Fee</span>
                        <span id="stk-fee-info" class="stk-preview-val" style="color:var(--stk-text-3);font-size:11px">0.5%</span>
                    </div>
                </div>

                <button id="stk-delegate-btn" class="stk-delegate-btn" disabled>
                    <i class="fa-solid fa-lock" style="margin-right:6px"></i> Delegate BKC
                </button>
            </div>

            <!-- ACTIVE DELEGATIONS -->
            <div class="stk-card" style="animation-delay:0.15s">
                <div class="stk-card-title">
                    <i class="fa-solid fa-list-check"></i> Active Delegations
                    <span id="stk-deleg-count" style="font-size:10px;color:var(--stk-text-3);margin-left:auto">0</span>
                </div>
                <div id="stk-deleg-list" class="stk-deleg-list">
                    <div class="stk-empty"><i class="fa-solid fa-inbox"></i><p>No active delegations</p></div>
                </div>
            </div>

            <!-- HISTORY -->
            <div class="stk-card" style="animation-delay:0.2s">
                <div class="stk-card-title"><i class="fa-solid fa-clock-rotate-left"></i> History</div>
                <div class="stk-tabs">
                    <button class="stk-tab active" data-filter="ALL">All</button>
                    <button class="stk-tab" data-filter="STAKE">Stakes</button>
                    <button class="stk-tab" data-filter="UNSTAKE">Unstakes</button>
                    <button class="stk-tab" data-filter="CLAIM">Claims</button>
                </div>
                <div id="stk-history-list" class="stk-history-list">
                    <div class="stk-loading">
                        <img src="./assets/bkc_logo_3d.png" class="stk-loading-icon" alt="">
                        <span style="font-size:11px;color:var(--stk-text-3)">Loading history...</span>
                    </div>
                </div>
            </div>

        </div>
    `,sm(),c.isConnected?Aa():Td())}async function Aa(e=!1){if(ua)return;const t=Date.now();if(!(!e&&t-Ua<1e4)){ua=!0,Ua=t;try{await Yf();const[,,a]=await Promise.all([Jn(),jo(),ip()]),n=c.stakingPoolContractPublic||c.stakingPoolContract;n&&(yn=await oe(n,"totalPStake",[],0n)),await Kf();const{stakingRewards:s,minerRewards:r}=await sr();Dr=s||0n,Or=r||0n,Vf(),qf(),Xf(),Jf(),em(),Ra()}catch(a){console.error("Staking data load error:",a)}finally{ua=!1}}}async function Yf(){if(c.userAddress)try{const e=c.stakingPoolContractPublic||c.stakingPoolContract;if(e){const a=await oe(e,"getUserBestBoost",[c.userAddress],0n);Et=Number(a)}if(Et===0){const a=await Go();a&&a.highestBoost>0&&(Et=a.highestBoost,Oi=a.source||"api")}else Oi="active";Hs=Ed(Et).burnRate}catch(e){console.error("NFT boost load error:",e)}}async function Kf(){const e=c.stakingPoolContractPublic||c.stakingPoolContract;if(!(!c.userAddress||!e))try{const t=await oe(e,"previewClaim",[c.userAddress],null);t&&(Ae={totalRewards:t.totalRewards||t[0]||0n,burnAmount:t.burnAmount||t[1]||0n,referrerCut:t.referrerCut||t[2]||0n,userReceives:t.userReceives||t[3]||0n,burnRateBips:t.burnRateBps||t[4]||0n,nftBoost:t.nftBoost||t[5]||0n}),Us=0n}catch(t){console.error("Claim preview error:",t);const a=Dr+Or,n=a*BigInt(Hs)/100n;Ae={totalRewards:a,burnAmount:n,referrerCut:0n,userReceives:a-n,burnRateBips:BigInt(Hs*100),nftBoost:BigInt(Et)}}}function Vf(){const e=document.getElementById("stk-reward-value"),t=document.getElementById("stk-claim-btn"),a=document.getElementById("stk-breakdown"),n=document.getElementById("stk-eth-fee"),s=(Ae==null?void 0:Ae.userReceives)||0n;Ae!=null&&Ae.totalRewards;const r=(Ae==null?void 0:Ae.burnAmount)||0n,i=s>0n;if(e){const o=O(s);e.innerHTML=`${o.toFixed(4)} <span class="stk-reward-suffix">BKC</span>`}if(t){t.disabled=!i;const o=t.querySelector("span");o&&(o.textContent=i?"Claim Rewards":"No Rewards Yet")}if(a&&i){a.style.display="";const o=O(Dr).toFixed(4),l=O(Or).toFixed(4),d=O(r).toFixed(4);document.getElementById("stk-break-staking").textContent=`${o} BKC`,document.getElementById("stk-break-mining").textContent=`${l} BKC`,document.getElementById("stk-break-burned").textContent=r>0n?`-${d} BKC`:"None",document.getElementById("stk-break-burned").style.color=r>0n?"var(--stk-red)":"var(--stk-green)"}else a&&(a.style.display="none");if(n)if(i&&Us>0n){const o=parseFloat(Ha.formatEther(Us)).toFixed(6);n.innerHTML=`<i class="fa-brands fa-ethereum" style="margin-right:3px"></i>Claim fee: ${o} ETH`}else n.textContent=""}function qf(){const e=document.getElementById("stk-boost-panel");if(!e)return;const t=Ed(Et),a=Et>0;e.innerHTML=`
        <div class="stk-boost-panel">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
                <div class="stk-tier-badge ${t.class}">
                    <span style="font-size:16px">${t.icon}</span>
                    <span>${t.name}</span>
                    <span style="opacity:0.5">|</span>
                    <span>Keep ${t.keepRate}%</span>
                </div>
                ${a?'<span style="font-size:9px;color:var(--stk-green);font-weight:700"><i class="fa-solid fa-check" style="margin-right:3px"></i>ACTIVE</span>':""}
            </div>

            <div class="stk-burn-bar">
                <div class="stk-burn-fill" style="width:${t.burnRate}%"></div>
                <div class="stk-keep-fill" style="width:${t.keepRate}%"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:10px">
                <span style="color:rgba(239,68,68,0.7)"><i class="fa-solid fa-fire" style="margin-right:3px"></i>Burn ${t.burnRate}%</span>
                <span style="color:rgba(74,222,128,0.7)"><i class="fa-solid fa-check" style="margin-right:3px"></i>Keep ${t.keepRate}%</span>
            </div>

            ${a?Et<5e3?`
                <p style="font-size:10px;color:var(--stk-text-3);margin-top:10px">
                    <i class="fa-solid fa-arrow-up" style="color:var(--stk-cyan);margin-right:3px"></i>
                    Upgrade to ${oa.DIAMOND.icon} Diamond to keep 100%
                    <span class="go-to-store" style="color:var(--stk-accent);cursor:pointer;margin-left:4px">Upgrade</span>
                </p>
            `:"":`
                <div style="margin-top:12px;padding:8px 10px;background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);border-radius:8px">
                    <p style="font-size:11px;color:var(--stk-red);font-weight:600;margin:0">You're losing ${t.burnRate}% of your rewards!</p>
                    <p style="font-size:10px;color:var(--stk-text-3);margin:4px 0 0">Diamond holders keep 100%</p>
                </div>
                <button class="stk-boost-cta go-to-store"><i class="fa-solid fa-gem" style="font-size:10px"></i> Get an NFT</button>
            `}
        </div>
    `}function Xf(){var u,p,m,g;const e=(x,h)=>{const C=document.getElementById(x);C&&(C.innerHTML=h)};e("stk-stat-network",xa(yn));const t=((u=c.userData)==null?void 0:u.pStake)||((p=c.userData)==null?void 0:p.userTotalPStake)||c.userTotalPStake||0n,a=yn>0n?Number(t*10000n/yn)/100:0;e("stk-stat-power",`${xa(t)} <span style="font-size:10px;color:var(--stk-text-3)">(${a.toFixed(2)}%)</span>`);const n=(Ae==null?void 0:Ae.userReceives)||0n,s=O(n);e("stk-stat-rewards",s>0?`<span style="color:var(--stk-green)">${s.toFixed(2)}</span> <span style="font-size:10px;color:var(--stk-text-3)">BKC</span>`:'<span style="color:var(--stk-text-3)">0 BKC</span>');const r=((m=c.userDelegations)==null?void 0:m.length)||0;e("stk-stat-locks",`${r}`);const i=c.currentUserBalance||0n,o=document.getElementById("stk-balance-display");o&&(o.textContent=i>0n?`${O(i).toFixed(2)} BKC`:"0.00 BKC");const l=((g=c.systemFees)==null?void 0:g.DELEGATION_FEE_BIPS)||50n,d=document.getElementById("stk-fee-info");d&&(d.textContent=`${Number(l)/100}%`)}function Td(){const e=(i,o)=>{const l=document.getElementById(i);l&&(l.innerHTML=o)};e("stk-reward-value",'-- <span class="stk-reward-suffix">BKC</span>'),e("stk-stat-network","--"),e("stk-stat-power","--"),e("stk-stat-rewards","--"),e("stk-stat-locks","--"),e("stk-balance-display","-- BKC");const t=document.getElementById("stk-claim-btn");t&&(t.disabled=!0);const a=document.getElementById("stk-breakdown");a&&(a.style.display="none");const n=document.getElementById("stk-deleg-list");n&&(n.innerHTML='<div class="stk-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>');const s=document.getElementById("stk-history-list");s&&(s.innerHTML='<div class="stk-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>');const r=document.getElementById("stk-boost-panel");r&&(r.innerHTML='<div class="stk-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet</p></div>')}function Jf(){const e=document.getElementById("stk-deleg-list"),t=document.getElementById("stk-deleg-count");if(!e)return;const a=c.userDelegations||[];if(t&&(t.textContent=a.length),a.length===0){e.innerHTML='<div class="stk-empty"><i class="fa-solid fa-inbox"></i><p>No active delegations</p></div>';return}Ut&&(clearInterval(Ut),Ut=null);const n=[...a].sort((s,r)=>Number(s.unlockTime)-Number(r.unlockTime));e.innerHTML=n.map((s,r)=>Zf(s,r)).join(""),Ut=setInterval(Qf,6e4),e.querySelectorAll(".stk-unstake-btn").forEach(s=>{s.addEventListener("click",()=>am(parseInt(s.dataset.index),s.classList.contains("stk-unstake-force")))})}function Zf(e,t){const a=O(e.amount||0n),n=e.lockDays||Number(e.lockDuration||0n)/86400,s=Number(e.unlockTime||e.lockEnd||0n),r=Math.floor(Date.now()/1e3),i=s>r,o=i?s-r:0,l=e.lockDuration||BigInt(e.lockDays||0)*86400n,d=e.pStake||Uf(e.amount||0n,l);return`
        <div class="stk-deleg-item">
            <div class="stk-deleg-icon" style="background:${i?"rgba(251,191,36,0.1)":"rgba(74,222,128,0.1)"}">
                <i class="fa-solid ${i?"fa-lock":"fa-lock-open"}" style="color:${i?"#fbbf24":"var(--stk-green)"}; font-size:14px"></i>
            </div>
            <div class="stk-deleg-info">
                <div class="stk-deleg-amount">${a.toFixed(2)} BKC</div>
                <div class="stk-deleg-meta">
                    <span style="color:var(--stk-purple)">${xa(d)} pS</span>
                    <span style="color:var(--stk-text-3)">|</span>
                    <span>${Hf(n)}</span>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
                ${i?`
                    <span class="stk-countdown" data-unlock-time="${s}">${kd(o)}</span>
                    <button class="stk-unstake-btn stk-unstake-force" data-index="${e.index!==void 0?e.index:t}" title="Force unstake (50% penalty)">
                        <i class="fa-solid fa-bolt" style="font-size:10px"></i>
                    </button>
                `:`
                    <span style="font-size:10px;color:var(--stk-green);font-weight:700"><i class="fa-solid fa-check" style="margin-right:3px"></i>Ready</span>
                    <button class="stk-unstake-btn stk-unstake-ready" data-index="${e.index!==void 0?e.index:t}">Unstake</button>
                `}
            </div>
        </div>
    `}function Qf(){document.querySelectorAll(".stk-countdown").forEach(e=>{const t=parseInt(e.dataset.unlockTime),a=Math.floor(Date.now()/1e3);e.textContent=kd(t-a)})}async function em(){if(c.userAddress)try{const e=rt.getHistory||"https://gethistory-4wvdcuoouq-uc.a.run.app",t=await fetch(`${e}/${c.userAddress}`);t.ok&&(Sn=(await t.json()||[]).filter(n=>{const s=(n.type||"").toUpperCase();return s.includes("DELEGAT")||s.includes("STAKE")||s.includes("UNDELEGAT")||s.includes("CLAIM")||s.includes("REWARD")||s.includes("FORCE")}),Cd())}catch(e){console.error("History load error:",e)}}function Cd(){const e=document.getElementById("stk-history-list");if(!e)return;let t=Sn;if($a!=="ALL"&&(t=Sn.filter(a=>{const n=(a.type||"").toUpperCase();switch($a){case"STAKE":return(n.includes("DELEGAT")||n.includes("STAKE"))&&!n.includes("UNSTAKE")&&!n.includes("UNDELEGAT")&&!n.includes("FORCE");case"UNSTAKE":return n.includes("UNSTAKE")||n.includes("UNDELEGAT")||n.includes("FORCE");case"CLAIM":return n.includes("CLAIM")||n.includes("REWARD");default:return!0}})),t.length===0){e.innerHTML=`<div class="stk-empty"><i class="fa-solid fa-inbox"></i><p>No ${$a==="ALL"?"":$a.toLowerCase()+" "}history yet</p></div>`;return}e.innerHTML=t.slice(0,25).map(a=>{const n=(a.type||"").toUpperCase(),s=a.details||{},r=jf(a.timestamp||a.createdAt);let i,o,l,d,u="";n.includes("FORCE")?(i="fa-bolt",o="rgba(239,68,68,0.12)",l="#ef4444",d="Force Unstaked",s.feePaid&&BigInt(s.feePaid)>0n&&(u=`<span style="color:#ef4444">-${O(BigInt(s.feePaid)).toFixed(2)}</span>`)):(n.includes("DELEGAT")||n.includes("STAKE"))&&!n.includes("UNSTAKE")?(i="fa-lock",o="rgba(74,222,128,0.12)",l="#4ade80",d="Delegated",s.pStakeGenerated&&(u=`<span style="color:var(--stk-purple)">+${O(BigInt(s.pStakeGenerated)).toFixed(0)} pS</span>`)):n.includes("UNSTAKE")||n.includes("UNDELEGAT")?(i="fa-unlock",o="rgba(249,115,22,0.12)",l="#f97316",d="Unstaked"):n.includes("CLAIM")||n.includes("REWARD")?(i="fa-coins",o="rgba(251,191,36,0.12)",l="#fbbf24",d="Claimed",s.amountReceived&&BigInt(s.amountReceived)>0n&&(u=`<span style="color:var(--stk-green)">+${O(BigInt(s.amountReceived)).toFixed(2)}</span>`),s.burnedAmount&&BigInt(s.burnedAmount)>0n&&(u+=` <span style="font-size:9px;color:rgba(239,68,68,0.6)">ðŸ”¥-${O(BigInt(s.burnedAmount)).toFixed(2)}</span>`)):(i="fa-circle",o="rgba(113,113,122,0.12)",l="#71717a",d=a.type||"Activity");const p=a.txHash?`${Of}${a.txHash}`:"#",m=a.amount||s.amount||s.amountReceived||"0";let g=0;try{g=O(BigInt(m))}catch{}const x=g>.001?g.toFixed(2):"";return`
            <a href="${p}" target="_blank" class="stk-history-item">
                <div class="stk-history-icon" style="background:${o}">
                    <i class="fa-solid ${i}" style="color:${l}"></i>
                </div>
                <div class="stk-history-info">
                    <div class="stk-history-label">${d} ${u?`<span style="font-size:10px">${u}</span>`:""}</div>
                    <div class="stk-history-date">${r}</div>
                </div>
                <div style="display:flex;align-items:center;gap:6px">
                    ${x?`<span class="stk-history-amount">${x} <span style="font-size:10px;color:var(--stk-text-3)">BKC</span></span>`:""}
                    <i class="fa-solid fa-arrow-up-right-from-square stk-history-link"></i>
                </div>
            </a>
        `}).join("")}function Ra(){var n;const e=document.getElementById("stk-amount-input"),t=document.getElementById("stk-delegate-btn");if(!e)return;const a=e.value;if(!a||parseFloat(a)<=0){const s=document.getElementById("stk-preview-pstake");s&&(s.textContent="0");const r=document.getElementById("stk-preview-net");r&&(r.textContent="0.00 BKC"),t&&(t.disabled=!0);return}try{const s=Ha.parseUnits(a,18),r=((n=c.systemFees)==null?void 0:n.DELEGATION_FEE_BIPS)||50n,i=s*BigInt(r)/10000n,o=s-i,l=BigInt(Mr),d=10000n,u=d+l*5918n/365n,p=o*u/d,m=document.getElementById("stk-preview-pstake");m&&(m.textContent=xa(p));const g=document.getElementById("stk-preview-net");g&&(g.textContent=`${O(o).toFixed(4)} BKC`);const x=c.currentUserBalance||0n;s>x?(e.classList.add("error"),t&&(t.disabled=!0)):(e.classList.remove("error"),t&&(t.disabled=nt))}catch{t&&(t.disabled=!0)}}async function tm(){if(nt)return;const e=document.getElementById("stk-amount-input"),t=document.getElementById("stk-delegate-btn");if(!e||!t)return;const a=e.value;if(!a||parseFloat(a)<=0)return b("Enter an amount","warning");const n=c.currentUserBalance||0n;let s;try{if(s=Ha.parseUnits(a,18),s>n)return b("Insufficient BKC balance","error")}catch{return b("Invalid amount","error")}try{if(await c.publicProvider.getBalance(c.userAddress)<Ha.parseEther("0.001"))return b("Insufficient ETH for gas","error")}catch{}nt=!0;try{await ha.delegate({amount:s,lockDays:Mr,button:t,onSuccess:async()=>{e.value="",b("Delegation successful!","success"),ua=!1,Ua=0,await Aa(!0)},onError:r=>{r.cancelled||b("Delegation failed: "+(r.reason||r.message||"Unknown error"),"error")}})}catch(r){b("Delegation failed: "+(r.reason||r.message||"Unknown error"),"error")}finally{nt=!1,Ra()}}async function am(e,t){if(nt||t&&!confirm("Force unstake will incur a 50% penalty. Continue?"))return;const a=document.querySelector(`.stk-unstake-btn[data-index='${e}']`);nt=!0;try{await(t?ha.forceUnstake:ha.unstake)({delegationIndex:BigInt(e),button:a,onSuccess:async()=>{b(t?"Force unstaked (50% penalty)":"Unstaked successfully!",t?"warning":"success"),ua=!1,Ua=0,await Aa(!0)},onError:s=>{s.cancelled||b("Unstake failed: "+(s.reason||s.message||"Unknown error"),"error")}})}catch(n){b("Unstake failed: "+(n.reason||n.message||"Unknown error"),"error")}finally{nt=!1}}async function nm(){if(nt)return;const e=document.getElementById("stk-claim-btn");nt=!0;try{await ha.claimRewards({button:e,onSuccess:async()=>{b("Rewards claimed!","success"),ua=!1,Ua=0,Sn=[],await Aa(!0)},onError:t=>{t.cancelled||b("Claim failed: "+(t.reason||t.message||"Unknown error"),"error")}})}catch(t){b("Claim failed: "+(t.reason||t.message||"Unknown error"),"error")}finally{nt=!1}}function sm(){var o;const e=document.getElementById("mine");if(!e)return;const t=document.getElementById("stk-amount-input"),a=document.getElementById("stk-max-btn"),n=document.getElementById("stk-delegate-btn"),s=document.getElementById("stk-refresh-btn"),r=document.querySelectorAll(".stk-duration-chip"),i=document.querySelectorAll(".stk-tab");t==null||t.addEventListener("input",Ra),a==null||a.addEventListener("click",()=>{const l=c.currentUserBalance||0n;t&&(t.value=Ha.formatUnits(l,18),Ra())}),r.forEach(l=>{l.addEventListener("click",()=>{r.forEach(d=>d.classList.remove("selected")),l.classList.add("selected"),Mr=parseInt(l.dataset.days),Ra()})}),i.forEach(l=>{l.addEventListener("click",()=>{i.forEach(d=>d.classList.remove("active")),l.classList.add("active"),$a=l.dataset.filter,Cd()})}),n==null||n.addEventListener("click",tm),s==null||s.addEventListener("click",()=>{const l=s.querySelector("i");l==null||l.classList.add("fa-spin"),Aa(!0).then(()=>{setTimeout(()=>l==null?void 0:l.classList.remove("fa-spin"),500)})}),(o=document.getElementById("stk-claim-btn"))==null||o.addEventListener("click",nm),e.addEventListener("click",l=>{l.target.closest(".go-to-store")&&(l.preventDefault(),window.navigateTo("store")),l.target.closest(".go-to-rental")&&(l.preventDefault(),window.navigateTo("rental"))})}function rm(){Ut&&(clearInterval(Ut),Ut=null)}function im(e){e?Aa():Td()}const js={render:Gf,update:im,cleanup:rm},Me=window.ethers,om="https://sepolia.arbiscan.io/tx/",lm=3e4,Ws={Diamond:{color:"#22d3ee",gradient:"from-cyan-500/20 to-blue-500/20",border:"border-cyan-500/40",text:"text-cyan-400",glow:"shadow-cyan-500/30",icon:"ðŸ’Ž",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq",keepRate:100,burnRate:0},Gold:{color:"#fbbf24",gradient:"from-yellow-500/20 to-amber-500/20",border:"border-yellow-500/40",text:"text-yellow-400",glow:"shadow-yellow-500/30",icon:"ðŸ¥‡",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44",keepRate:90,burnRate:10},Silver:{color:"#9ca3af",gradient:"from-gray-400/20 to-slate-400/20",border:"border-gray-400/40",text:"text-gray-300",glow:"shadow-gray-400/30",icon:"ðŸ¥ˆ",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4",keepRate:75,burnRate:25},Bronze:{color:"#f97316",gradient:"from-orange-600/20 to-amber-700/20",border:"border-orange-600/40",text:"text-orange-400",glow:"shadow-orange-500/30",icon:"ðŸ¥‰",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m",keepRate:60,burnRate:40}};function ds(e){return Ws[e]||Ws.Bronze}const N={tradeDirection:"buy",selectedPoolBoostBips:null,buyPrice:0n,sellPrice:0n,netSellPrice:0n,poolNFTCount:0,userBalanceOfSelectedNFT:0,availableToSellCount:0,firstAvailableTokenId:null,firstAvailableTokenIdForBuy:null,bestBoosterTokenId:0n,bestBoosterBips:0,isDataLoading:!1,tradeHistory:[]},zn=new Map,Hr=new Map;let mn=!1,Dt=null;const cm=["function getPoolAddress(uint256 boostBips) view returns (address)","function isPool(address) view returns (bool)"];function dm(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function um(e){const t=Hr.get(e);return t&&Date.now()-t.timestamp<lm?t.data:null}function Id(e,t){Hr.set(e,{data:t,timestamp:Date.now()})}function Is(e){Hr.delete(e)}function pm(){if(document.getElementById("swap-styles-v9"))return;const e=document.createElement("style");e.id="swap-styles-v9",e.textContent=`
        /* Trade Image Animations */
        @keyframes trade-float {
            0%, 100% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-8px) rotate(1deg); }
        }
        @keyframes trade-pulse {
            0%, 100% { filter: drop-shadow(0 0 15px rgba(34,197,94,0.3)); }
            50% { filter: drop-shadow(0 0 30px rgba(34,197,94,0.6)); }
        }
        @keyframes trade-buy {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(34,197,94,0.4)); transform: scale(1); }
            50% { filter: drop-shadow(0 0 40px rgba(34,197,94,0.7)); transform: scale(1.05); }
        }
        @keyframes trade-sell {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(239,68,68,0.4)); transform: scale(1); }
            50% { filter: drop-shadow(0 0 40px rgba(239,68,68,0.7)); transform: scale(1.05); }
        }
        @keyframes trade-spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        @keyframes trade-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 50px rgba(34,197,94,0.9)); }
            100% { transform: scale(1); }
        }
        .trade-float { animation: trade-float 4s ease-in-out infinite; }
        .trade-pulse { animation: trade-pulse 2s ease-in-out infinite; }
        .trade-buy { animation: trade-buy 2s ease-in-out infinite; }
        .trade-sell { animation: trade-sell 2s ease-in-out infinite; }
        .trade-spin { animation: trade-spin 1.5s ease-in-out; }
        .trade-success { animation: trade-success 0.8s ease-out; }
        
        .swap-container {
            font-family: 'Inter', -apple-system, sans-serif;
        }
        
        .swap-card {
            background: linear-gradient(180deg, rgba(24,24,27,0.95) 0%, rgba(9,9,11,0.98) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            backdrop-filter: blur(20px);
        }
        
        .tier-chip {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tier-chip:hover {
            transform: translateY(-2px);
        }
        
        .tier-chip.active {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(139,92,246,0.3);
        }
        
        .swap-input-box {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.4);
            transition: all 0.2s ease;
        }
        
        .swap-input-box:hover {
            border-color: rgba(113,113,122,0.5);
        }
        
        .swap-input-box.active {
            border-color: rgba(245,158,11,0.5);
            background: rgba(39,39,42,0.7);
        }
        
        .swap-arrow-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .swap-arrow-btn:hover {
            transform: rotate(180deg);
            background: rgba(63,63,70,0.8);
        }
        
        .swap-btn {
            transition: all 0.2s ease;
        }
        
        .swap-btn:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 40px -10px currentColor;
        }
        
        .swap-btn:not(:disabled):active {
            transform: translateY(0);
        }
        
        .token-selector {
            background: rgba(39,39,42,0.8);
            border: 1px solid rgba(63,63,70,0.5);
            transition: all 0.2s ease;
        }
        
        .token-selector:hover {
            background: rgba(63,63,70,0.8);
            border-color: rgba(113,113,122,0.5);
        }
        
        .inventory-item {
            transition: all 0.2s ease;
        }
        
        .inventory-item:hover {
            transform: scale(1.05);
            border-color: rgba(245,158,11,0.5);
        }
        
        .history-item {
            transition: all 0.2s ease;
        }
        
        .history-item:hover {
            background: rgba(63,63,70,0.5) !important;
            transform: translateX(4px);
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .skeleton {
            background: linear-gradient(90deg, rgba(39,39,42,0.5) 25%, rgba(63,63,70,0.5) 50%, rgba(39,39,42,0.5) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(39,39,42,0.3);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(113,113,122,0.5);
            border-radius: 2px;
        }
        
        /* Tier Grid - Responsive */
        .tier-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        @media (max-width: 400px) {
            .tier-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    `,document.head.appendChild(e)}function fm(){return`
        <div class="flex flex-col items-center justify-center py-12">
            <div class="relative w-16 h-16">
                <div class="absolute inset-0 rounded-full border-2 border-zinc-700"></div>
                <div class="absolute inset-0 rounded-full border-2 border-transparent border-t-purple-500 animate-spin"></div>
                <div class="absolute inset-2 rounded-full bg-zinc-800 flex items-center justify-center">
                    <i class="fa-solid fa-gem text-xl text-purple-400"></i>
                </div>
            </div>
            <p class="text-zinc-500 text-xs mt-4">Loading pool...</p>
        </div>
    `}const mm={async render(e){pm(),await Uo();const t=document.getElementById("store");t&&((t.innerHTML.trim()===""||e)&&(t.innerHTML=`
                <div class="swap-container max-w-lg mx-auto py-6 px-4">
                    
                    <!-- Header with NFT Icon -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden"
                                 id="trade-mascot">
                                <img src="${Ws.Diamond.image}" alt="NFT" class="w-full h-full object-contain" onerror="this.outerHTML='<span class=\\'text-3xl\\'>ðŸ’Ž</span>'">
                            </div>
                            <div>
                                <h1 class="text-lg font-semibold text-white">NFT Market</h1>
                                <p class="text-xs text-zinc-500">Keep up to 100% of rewards</p>
                            </div>
                        </div>
                        <button id="refresh-btn" class="w-8 h-8 rounded-lg bg-zinc-800/50 hover:bg-zinc-700 flex items-center justify-center text-zinc-400 hover:text-white transition-colors">
                            <i class="fa-solid fa-rotate text-xs"></i>
                        </button>
                    </div>
                    
                    <!-- Main Swap Card -->
                    <div class="swap-card rounded-2xl p-4 mb-4">
                        
                        <!-- Tier Selector - GRID Layout V6.8 -->
                        <div class="mb-4">
                            <p class="text-xs text-zinc-500 mb-2">Select NFT Tier (Higher = Keep More Rewards)</p>
                            <div id="tier-selector" class="tier-grid">
                                ${gm()}
                            </div>
                        </div>
                        
                        <!-- Swap Interface -->
                        <div id="swap-interface">
                            ${fm()}
                        </div>
                        
                    </div>
                    
                    <!-- My NFTs (Collapsible) -->
                    <div class="swap-card rounded-2xl overflow-hidden mb-4">
                        <button id="inventory-toggle" class="w-full flex justify-between items-center p-4 hover:bg-zinc-800/30 transition-colors">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-wallet text-amber-500 text-sm"></i>
                                <span class="text-sm font-medium text-white">My NFTs</span>
                                <span id="nft-count" class="text-xs bg-zinc-700 px-2 py-0.5 rounded-full text-zinc-300">0</span>
                            </div>
                            <i id="inventory-chevron" class="fa-solid fa-chevron-down text-zinc-500 text-xs transition-transform"></i>
                        </button>
                        <div id="inventory-panel" class="hidden border-t border-zinc-800">
                            <div id="inventory-grid" class="p-4 grid grid-cols-4 gap-2 max-h-[200px] overflow-y-auto custom-scroll">
                                ${Wp("No NFTs")}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trade History (Collapsible) - OPEN by default -->
                    <div class="swap-card rounded-2xl overflow-hidden">
                        <button id="history-toggle" class="w-full flex justify-between items-center p-4 hover:bg-zinc-800/30 transition-colors">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-clock-rotate-left text-green-500 text-sm"></i>
                                <span class="text-sm font-medium text-white">Trade History</span>
                                <span id="history-count" class="text-xs bg-zinc-700 px-2 py-0.5 rounded-full text-zinc-300">0</span>
                            </div>
                            <i id="history-chevron" class="fa-solid fa-chevron-down text-zinc-500 text-xs transition-transform" style="transform: rotate(180deg)"></i>
                        </button>
                        <div id="history-panel" class="border-t border-zinc-800">
                            <div id="history-list" class="p-4 space-y-2 max-h-[300px] overflow-y-auto custom-scroll">
                                <div class="text-center py-4 text-xs text-zinc-600">Loading history...</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            `,vm()),N.selectedPoolBoostBips===null&&Te.length>0&&(N.selectedPoolBoostBips=Te[0].boostBips),await yt(),await La())},async update(){N.selectedPoolBoostBips!==null&&!N.isDataLoading&&document.getElementById("store")&&!document.hidden&&await yt()}};async function La(){const e=document.getElementById("history-list");if(!c.userAddress){e&&(e.innerHTML='<div class="text-center py-4 text-xs text-zinc-600">Connect wallet to view history</div>');return}try{const t=rt.getHistory||"https://gethistory-4wvdcuoouq-uc.a.run.app",a=await fetch(`${t}/${c.userAddress}`);if(!a.ok)throw new Error(`HTTP ${a.status}`);const n=await a.json();console.log("All history types:",[...new Set((n||[]).map(r=>r.type))]),N.tradeHistory=(n||[]).filter(r=>{const i=(r.type||"").toUpperCase();return i==="NFTBOUGHT"||i==="NFTSOLD"||i==="NFT_BOUGHT"||i==="NFT_SOLD"||i==="NFTPURCHASED"||i==="NFT_PURCHASED"||i.includes("NFTBOUGHT")||i.includes("NFTSOLD")||i.includes("NFTPURCHASED")}),console.log("NFT trade history:",N.tradeHistory.length,"items");const s=document.getElementById("history-count");s&&(s.textContent=N.tradeHistory.length),Hi()}catch(t){console.error("History load error:",t),N.tradeHistory=[],Hi()}}function Hi(){const e=document.getElementById("history-list");if(e){if(!c.isConnected){e.innerHTML='<div class="text-center py-4 text-xs text-zinc-600">Connect wallet to view history</div>';return}if(N.tradeHistory.length===0){e.innerHTML=`
            <div class="text-center py-6">
                <div class="w-12 h-12 mx-auto rounded-full bg-zinc-800/50 flex items-center justify-center mb-2">
                    <i class="fa-solid fa-receipt text-zinc-600 text-lg"></i>
                </div>
                <p class="text-zinc-600 text-xs">No NFT trades yet</p>
                <p class="text-zinc-700 text-[10px] mt-1">Buy or sell NFTs to see history</p>
            </div>
        `;return}e.innerHTML=N.tradeHistory.slice(0,20).map(t=>{const a=(t.type||"").toUpperCase(),n=t.details||{},s=dm(t.timestamp||t.createdAt),r=a.includes("BOUGHT")||a.includes("PURCHASED"),i=r?"fa-cart-plus":"fa-money-bill-transfer",o=r?"#22c55e":"#f59e0b",l=r?"rgba(34,197,94,0.15)":"rgba(245,158,11,0.15)",d=r?"ðŸ›’ Bought NFT":"ðŸ’° Sold NFT",u=r?"-":"+",p=t.txHash?`${om}${t.txHash}`:"#";let m="";try{let h=t.amount||n.amount||n.price||n.payout||"0";if(typeof h=="string"&&h!=="0"){const C=O(BigInt(h));C>.001&&(m=C.toFixed(2))}}catch{}const g=n.tokenId||"",x=n.boostBips||n.boost||"";return`
            <a href="${p}" target="_blank" class="history-item flex items-center justify-between p-3 hover:bg-zinc-800/60 border border-zinc-700/30 rounded-lg transition-all group bg-zinc-800/20">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-lg flex items-center justify-center border border-zinc-700/30" style="background: ${l}">
                        <i class="fa-solid ${i} text-sm" style="color: ${o}"></i>
                    </div>
                    <div>
                        <p class="text-white text-xs font-medium">
                            ${d}
                            ${g?`<span class="ml-1 text-[10px] text-amber-400 font-mono">#${g}</span>`:""}
                            ${x?`<span class="ml-1 text-[9px] text-purple-400">+${Number(x)/100}%</span>`:""}
                        </p>
                        <p class="text-zinc-600 text-[10px]">${s}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    ${m?`<span class="text-xs font-mono font-bold ${r?"text-white":"text-green-400"}">${u}${m} <span class="text-zinc-500">BKC</span></span>`:""}
                    <i class="fa-solid fa-arrow-up-right-from-square text-zinc-600 group-hover:text-blue-400 text-[9px]"></i>
                </div>
            </a>
        `}).join("")}}function gm(){return Te.map((e,t)=>{const a=ds(e.name),n=t===0,s=ut(e.boostBips),r=a.icon||e.emoji||"ðŸ’Ž";return`
            <button class="tier-chip flex flex-col items-center gap-1 p-2 rounded-xl border transition-all
                ${n?`bg-gradient-to-br ${a.gradient} ${a.border} ${a.text} active`:"bg-zinc-800/50 border-zinc-700/50 text-zinc-400 hover:border-zinc-600"}"
                data-boost="${e.boostBips}"
                data-tier="${e.name}">
                <div class="w-8 h-8 flex items-center justify-center">
                    ${a.image?`<img src="${a.image}" alt="${e.name}" class="w-full h-full object-contain rounded" onerror="this.outerHTML='<span class=\\'text-2xl\\'>${r}</span>'">`:`<span class="text-2xl">${r}</span>`}
                </div>
                <span class="text-[10px] font-medium truncate w-full text-center">${e.name}</span>
                <span class="text-[9px] ${s===100?"text-green-400 font-bold":"opacity-70"}">Keep ${s}%</span>
            </button>
        `}).join("")}function Ui(e){document.querySelectorAll(".tier-chip").forEach(t=>{const a=Number(t.dataset.boost)===e,n=t.dataset.tier,s=ds(n);t.className=`tier-chip flex flex-col items-center gap-1 p-2 rounded-xl border transition-all ${a?`bg-gradient-to-br ${s.gradient} ${s.border} ${s.text} active`:"bg-zinc-800/50 border-zinc-700/50 text-zinc-400 hover:border-zinc-600"}`})}function Nn(){const e=document.getElementById("swap-interface");if(!e)return;const t=Te.find(x=>x.boostBips===N.selectedPoolBoostBips),a=ds(t==null?void 0:t.name),n=N.tradeDirection==="buy";xm(n);const s=n?N.buyPrice:N.netSellPrice,r=O(s).toFixed(2),i=O(c.currentUserBalance||0n).toFixed(2),o=n&&N.firstAvailableTokenIdForBuy===null,l=!n&&N.availableToSellCount===0,d=!n&&N.userBalanceOfSelectedNFT>N.availableToSellCount,u=n&&N.buyPrice>(c.currentUserBalance||0n),p=n?"":d?`<span class="${l?"text-red-400":"text-zinc-400"}">${N.availableToSellCount}</span>/<span class="text-zinc-500">${N.userBalanceOfSelectedNFT}</span> <span class="text-[9px] text-blue-400">(${N.userBalanceOfSelectedNFT-N.availableToSellCount} rented)</span>`:`<span class="${l?"text-red-400":"text-zinc-400"}">${N.userBalanceOfSelectedNFT}</span>`,m=a.icon||(t==null?void 0:t.emoji)||"ðŸ’Ž",g=a.image||"";ut((t==null?void 0:t.boostBips)||0),e.innerHTML=`
        <div class="fade-in">
            
            <!-- From Section -->
            <div class="swap-input-box rounded-2xl p-4 mb-1">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-zinc-500">${n?"You pay":"You sell"}</span>
                    <span class="text-xs text-zinc-600">
                        ${n?`Balance: <span class="${u?"text-red-400":"text-zinc-400"}">${i}</span>`:`Available: ${p}`}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-semibold ${u&&n?"text-red-400":"text-white"}">
                        ${n?r:"1"}
                        ${!n&&N.firstAvailableTokenId?`<span class="text-sm text-amber-400 ml-2">#${N.firstAvailableTokenId.toString()}</span>`:""}
                    </span>
                    <div class="token-selector flex items-center gap-2 px-3 py-2 rounded-xl cursor-default">
                        ${n?'<img src="./assets/bkc_logo_3d.png" class="w-6 h-6 rounded">':g?`<img src="${g}" alt="${t==null?void 0:t.name}" class="w-6 h-6 object-contain rounded" onerror="this.outerHTML='<span class=\\'text-xl\\'>${m}</span>'">`:`<span class="text-xl">${m}</span>`}
                        <span class="text-white text-sm font-medium">${n?"BKC":(t==null?void 0:t.name)||"NFT"}</span>
                    </div>
                </div>
            </div>
            
            <!-- Swap Arrow -->
            <div class="flex justify-center -my-3 relative z-10">
                <button id="swap-direction-btn" class="swap-arrow-btn w-10 h-10 rounded-xl bg-zinc-800 border-4 border-zinc-900 flex items-center justify-center text-zinc-400 hover:text-white">
                    <i class="fa-solid fa-arrow-down"></i>
                </button>
            </div>
            
            <!-- To Section -->
            <div class="swap-input-box rounded-2xl p-4 mt-1 mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-zinc-500">You receive</span>
                    <span class="text-xs text-zinc-600">
                        ${n?`In pool: <span class="${o?"text-red-400":"text-green-400"}">${N.poolNFTCount}</span>`:"Net after fee"}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-semibold text-white">${n?"1":O(N.netSellPrice).toFixed(2)}</span>
                    <div class="token-selector flex items-center gap-2 px-3 py-2 rounded-xl cursor-default">
                        ${n?g?`<img src="${g}" alt="${t==null?void 0:t.name}" class="w-6 h-6 object-contain rounded" onerror="this.outerHTML='<span class=\\'text-xl\\'>${m}</span>'">`:`<span class="text-xl">${m}</span>`:'<img src="./assets/bkc_logo_3d.png" class="w-6 h-6 rounded">'}
                        <span class="text-white text-sm font-medium">${n?(t==null?void 0:t.name)||"NFT":"BKC"}</span>
                    </div>
                </div>
            </div>
            
            <!-- Pool Info - V6.8 -->
            <div class="flex justify-between items-center text-[10px] text-zinc-600 mb-4 px-1">
                <span class="flex items-center gap-1">
                    ${g?`<img src="${g}" alt="${t==null?void 0:t.name}" class="w-4 h-4 object-contain" onerror="this.outerHTML='<span>${m}</span>'">`:`<span>${m}</span>`}
                    <span>${(t==null?void 0:t.name)||"Unknown"} Pool</span>
                </span>
                <span class="text-green-400">Keep ${ut((t==null?void 0:t.boostBips)||0)}% of rewards</span>
            </div>
            
            <!-- Execute Button -->
            ${bm(n,o,l,u,d)}
        </div>
    `}function bm(e,t,a,n,s=!1){return c.isConnected?e?t?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-zinc-500 bg-zinc-800 cursor-not-allowed">
                    <i class="fa-solid fa-box-open mr-2"></i> Sold Out
                </button>
            `:n?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-red-400 bg-red-950/30 cursor-not-allowed border border-red-500/30">
                    <i class="fa-solid fa-coins mr-2"></i> Insufficient BKC
                </button>
            `:`
            <button id="execute-btn" data-action="buy" class="swap-btn w-full py-4 rounded-2xl font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500">
                <i class="fa-solid fa-cart-plus mr-2"></i> Buy NFT
            </button>
        `:a&&s?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-blue-400 bg-blue-950/30 cursor-not-allowed border border-blue-500/30">
                    <i class="fa-solid fa-key mr-2"></i> All NFTs Rented
                </button>
            `:a?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-zinc-500 bg-zinc-800 cursor-not-allowed">
                    <i class="fa-solid fa-gem mr-2"></i> No NFT to Sell
                </button>
            `:`
            <button id="execute-btn" data-action="sell" class="swap-btn w-full py-4 rounded-2xl font-semibold text-white bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500">
                <i class="fa-solid fa-money-bill-transfer mr-2"></i> Sell NFT
            </button>
        `:`
            <button id="execute-btn" data-action="connect" class="swap-btn w-full py-4 rounded-2xl font-semibold text-white bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500">
                <i class="fa-solid fa-wallet mr-2"></i> Connect Wallet
            </button>
        `}function xm(e){const t=document.getElementById("trade-mascot");t&&(t.className=`w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden ${e?"trade-buy":"trade-sell"}`)}function ji(){const e=document.getElementById("inventory-grid"),t=document.getElementById("nft-count");if(!e)return;const a=c.myBoosters||[];if(t&&(t.textContent=a.length),!c.isConnected){e.innerHTML='<div class="col-span-4 text-center py-4 text-xs text-zinc-600">Connect wallet</div>';return}if(a.length===0){e.innerHTML=`
            <div class="col-span-4 text-center py-4">
                <p class="text-zinc-600 text-xs">No NFTs owned</p>
                <p class="text-zinc-700 text-[10px] mt-1">Buy from pool to get started</p>
            </div>
        `;return}const n=c.rentalListings||[],s=new Set(n.map(i=>{var o;return(o=i.tokenId)==null?void 0:o.toString()})),r=Math.floor(Date.now()/1e3);e.innerHTML=a.map(i=>{var A;const o=Te.find(B=>B.boostBips===Number(i.boostBips)),l=ds(o==null?void 0:o.name),d=ut(Number(i.boostBips)),u=l.icon||(o==null?void 0:o.emoji)||"ðŸ’Ž",p=N.firstAvailableTokenId&&BigInt(i.tokenId)===N.firstAvailableTokenId,m=(A=i.tokenId)==null?void 0:A.toString(),g=s.has(m),x=n.find(B=>{var z;return((z=B.tokenId)==null?void 0:z.toString())===m}),h=x&&x.rentalEndTime&&Number(x.rentalEndTime)>r,C=g||h;let T="";return h?T='<span class="absolute top-1 right-1 bg-blue-500 text-white text-[7px] px-1.5 py-0.5 rounded-full font-bold">ðŸ”‘</span>':g&&(T='<span class="absolute top-1 right-1 bg-green-500 text-white text-[7px] px-1.5 py-0.5 rounded-full font-bold">ðŸ“‹</span>'),`
            <div class="inventory-item ${C?"opacity-50 cursor-not-allowed":"cursor-pointer"} rounded-xl p-2 border ${p&&!C?"border-amber-500 ring-2 ring-amber-500/50 bg-amber-500/10":"border-zinc-700/50 bg-zinc-800/30"} hover:bg-zinc-800/50 transition-all relative"
                 data-boost="${i.boostBips}" 
                 data-tokenid="${i.tokenId}"
                 data-unavailable="${C}">
                ${T}
                <div class="w-full aspect-square rounded-lg bg-gradient-to-br ${l.gradient} border ${l.border} flex items-center justify-center overflow-hidden ${C?"grayscale":""}">
                    ${l.image?`<img src="${l.image}" alt="${o==null?void 0:o.name}" class="w-full h-full object-contain p-1" onerror="this.outerHTML='<span class=\\'text-3xl\\'>${u}</span>'">`:`<span class="text-3xl">${u}</span>`}
                </div>
                <p class="text-[9px] text-center mt-1 ${l.text} truncate">${(o==null?void 0:o.name)||"NFT"}</p>
                <p class="text-[8px] text-center ${d===100?"text-green-400":"text-zinc-500"}">Keep ${d}%</p>
                <p class="text-[7px] text-center ${p&&!C?"text-amber-400 font-bold":"text-zinc-600"}">#${i.tokenId}</p>
            </div>
        `}).join("")}async function yt(e=!1){var n,s;if(N.selectedPoolBoostBips===null)return;const t=N.selectedPoolBoostBips,a=Date.now();if(Dt=a,!e){const r=um(t);if(r){Gs(r),Nn(),ji(),hm(t,a);return}}N.isDataLoading=!0;try{const r=c.myBoosters||[],i=c.rentalListings||[],o=new Set(i.map(W=>{var pe;return(pe=W.tokenId)==null?void 0:pe.toString()})),l=Math.floor(Date.now()/1e3),d=r.filter(W=>Number(W.boostBips)===t),u=d.filter(W=>{var Qe;const pe=(Qe=W.tokenId)==null?void 0:Qe.toString(),je=i.find(ne=>{var We;return((We=ne.tokenId)==null?void 0:We.toString())===pe}),Lt=o.has(pe),xt=je&&je.rentalEndTime&&Number(je.rentalEndTime)>l;return!Lt&&!xt}),p=Te.find(W=>W.boostBips===t);if(!p){console.warn("Tier not found for boostBips:",t);return}const m=`pool_${p.name.toLowerCase()}`;let g=y[m]||zn.get(t);if(!g){const W=y.nftPoolFactory||y.nftLiquidityPoolFactory;if(W&&c.publicProvider)try{g=await new Me.Contract(W,cm,c.publicProvider).getPoolAddress(t),g&&g!==Me.ZeroAddress&&zn.set(t,g)}catch(pe){console.warn("Factory lookup failed:",pe.message)}}if(Dt!==a)return;if(!g||g===Me.ZeroAddress){const W=document.getElementById("swap-interface");W&&(W.innerHTML=`
                    <div class="text-center py-12">
                        <div class="w-12 h-12 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fa-solid fa-store-slash text-zinc-600"></i>
                        </div>
                        <p class="text-zinc-400 text-sm">Pool not available</p>
                        <p class="text-zinc-600 text-xs mt-1">${p.name} pool coming soon</p>
                    </div>
                `);return}const x=new Me.Contract(g,nr,c.publicProvider),[h,C,T]=await Promise.all([oe(x,"getBuyPrice",[],Me.MaxUint256).catch(()=>Me.MaxUint256),oe(x,"getSellPrice",[],0n).catch(()=>0n),x.getAvailableNFTs().catch(()=>[])]);if(Dt!==a)return;const A=Array.isArray(T)?[...T]:[],B=h===Me.MaxUint256?0n:h,z=C;let S=((n=c.systemFees)==null?void 0:n.NFT_POOL_SELL_TAX_BIPS)||1000n,I=BigInt(((s=c.boosterDiscounts)==null?void 0:s[N.bestBoosterBips])||0);const R=typeof S=="bigint"?S:BigInt(S),D=typeof I=="bigint"?I:BigInt(I),q=R>D?R-D:0n,H=z*q/10000n,re=z-H,X={buyPrice:B,sellPrice:z,netSellPrice:re,poolNFTCount:A.length,firstAvailableTokenIdForBuy:A.length>0?BigInt(A[A.length-1]):null,userBalanceOfSelectedNFT:d.length,availableToSellCount:u.length,availableNFTsOfTier:u};Id(t,X),Gs(X,t)}catch(r){if(console.warn("Store Data Warning:",r.message),Dt===a){const i=document.getElementById("swap-interface");i&&(i.innerHTML=`
                    <div class="text-center py-12">
                        <div class="w-12 h-12 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fa-solid fa-exclamation-triangle text-amber-500"></i>
                        </div>
                        <p class="text-zinc-400 text-sm">Pool unavailable</p>
                        <p class="text-zinc-600 text-xs mt-1">${r.message}</p>
                    </div>
                `)}return}finally{Dt===a&&(N.isDataLoading=!1,Nn(),ji())}}async function hm(e,t){var a,n;try{const s=c.myBoosters||[],r=c.rentalListings||[],i=new Set(r.map(X=>{var W;return(W=X.tokenId)==null?void 0:W.toString()})),o=Math.floor(Date.now()/1e3),l=s.filter(X=>Number(X.boostBips)===e),d=l.filter(X=>{var xt;const W=(xt=X.tokenId)==null?void 0:xt.toString(),pe=r.find(Qe=>{var ne;return((ne=Qe.tokenId)==null?void 0:ne.toString())===W}),je=i.has(W),Lt=pe&&pe.rentalEndTime&&Number(pe.rentalEndTime)>o;return!je&&!Lt}),u=Te.find(X=>X.boostBips===e);if(!u)return;const p=`pool_${u.name.toLowerCase()}`;let m=y[p]||zn.get(e);if(!m||m===Me.ZeroAddress)return;const g=new Me.Contract(m,nr,c.publicProvider),[x,h,C]=await Promise.all([oe(g,"getBuyPrice",[],Me.MaxUint256).catch(()=>Me.MaxUint256),oe(g,"getSellPrice",[],0n).catch(()=>0n),g.getAvailableNFTs().catch(()=>[])]);if(Dt!==t)return;const T=Array.isArray(C)?[...C]:[],A=x===Me.MaxUint256?0n:x,B=h;let z=((a=c.systemFees)==null?void 0:a.NFT_POOL_SELL_TAX_BIPS)||1000n,S=BigInt(((n=c.boosterDiscounts)==null?void 0:n[N.bestBoosterBips])||0);const I=typeof z=="bigint"?z:BigInt(z),R=typeof S=="bigint"?S:BigInt(S),D=I>R?I-R:0n,q=B*D/10000n,H=B-q,re={buyPrice:A,sellPrice:B,netSellPrice:H,poolNFTCount:T.length,firstAvailableTokenIdForBuy:T.length>0?BigInt(T[T.length-1]):null,userBalanceOfSelectedNFT:l.length,availableToSellCount:d.length,availableNFTsOfTier:d};Id(e,re),N.selectedPoolBoostBips===e&&Dt===t&&(Gs(re,e),Nn())}catch(s){console.warn("Background refresh failed:",s.message)}}function Gs(e,t){var s,r,i;N.buyPrice=e.buyPrice,N.sellPrice=e.sellPrice,N.netSellPrice=e.netSellPrice,N.poolNFTCount=e.poolNFTCount,N.firstAvailableTokenIdForBuy=e.firstAvailableTokenIdForBuy,N.userBalanceOfSelectedNFT=e.userBalanceOfSelectedNFT,N.availableToSellCount=e.availableToSellCount;const a=N.firstAvailableTokenId;!(a&&((s=e.availableNFTsOfTier)==null?void 0:s.some(o=>BigInt(o.tokenId)===a)))&&((r=e.availableNFTsOfTier)==null?void 0:r.length)>0?N.firstAvailableTokenId=BigInt(e.availableNFTsOfTier[0].tokenId):(i=e.availableNFTsOfTier)!=null&&i.length||(N.firstAvailableTokenId=null)}function vm(){const e=document.getElementById("store");e&&e.addEventListener("click",async t=>{if(t.target.closest("#refresh-btn")){const i=t.target.closest("#refresh-btn").querySelector("i");i.classList.add("fa-spin"),Is(N.selectedPoolBoostBips),await Promise.all([Ot(!0),Wo()]),await yt(!0),La(),i.classList.remove("fa-spin");return}const a=t.target.closest(".tier-chip");if(a){const r=Number(a.dataset.boost);N.selectedPoolBoostBips!==r&&(N.selectedPoolBoostBips=r,N.firstAvailableTokenId=null,Ui(r),await yt());return}if(t.target.closest("#swap-direction-btn")){N.tradeDirection=N.tradeDirection==="buy"?"sell":"buy",Nn();return}if(t.target.closest("#inventory-toggle")){const r=document.getElementById("inventory-panel"),i=document.getElementById("inventory-chevron");r&&i&&(r.classList.toggle("hidden"),i.style.transform=r.classList.contains("hidden")?"":"rotate(180deg)");return}if(t.target.closest("#history-toggle")){const r=document.getElementById("history-panel"),i=document.getElementById("history-chevron");r&&i&&(r.classList.toggle("hidden"),i.style.transform=r.classList.contains("hidden")?"":"rotate(180deg)");return}const n=t.target.closest(".inventory-item");if(n){if(n.dataset.unavailable==="true"){b("This NFT is listed for rental and cannot be sold","warning");return}const i=Number(n.dataset.boost),o=n.dataset.tokenid;N.selectedPoolBoostBips=i,N.tradeDirection="sell",o&&(N.firstAvailableTokenId=BigInt(o),console.log("User selected NFT #"+o+" for sale")),Ui(i),await yt();return}const s=t.target.closest("#execute-btn");if(s){if(t.preventDefault(),t.stopPropagation(),mn||s.disabled)return;const r=s.dataset.action,i=document.getElementById("trade-mascot");if(r==="connect"){window.openConnectModal();return}const o=Te.find(u=>u.boostBips===N.selectedPoolBoostBips);if(!o)return;const l=`pool_${o.name.toLowerCase()}`,d=y[l]||zn.get(o.boostBips);if(!d){b("Pool address not found","error");return}mn=!0,i&&(i.className="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden trade-spin");try{if(N.tradeDirection==="buy")await Fs.buyFromPool({poolAddress:d,button:s,onSuccess:async u=>{i&&(i.className="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden trade-success"),b("ðŸŸ¢ NFT Purchased!","success"),Is(N.selectedPoolBoostBips),await Promise.all([Ot(!0),yt(!0)]),La()},onError:u=>{if(!u.cancelled&&u.type!=="user_rejected"){const p=u.message||u.reason||"Transaction failed";b("Buy failed: "+p,"error")}}});else{if(!N.firstAvailableTokenId){b("No NFT selected for sale","error"),mn=!1;return}await Fs.sellToPool({poolAddress:d,tokenId:N.firstAvailableTokenId,button:s,onSuccess:async u=>{i&&(i.className="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden trade-success"),b("ðŸ”´ NFT Sold!","success"),Is(N.selectedPoolBoostBips),await Promise.all([Ot(!0),yt(!0)]),La()},onError:u=>{if(!u.cancelled&&u.type!=="user_rejected"){const p=u.message||u.reason||"Transaction failed";b("Sell failed: "+p,"error")}}})}}finally{mn=!1,setTimeout(async()=>{try{await Promise.all([Ot(!0),yt(!0)]),La()}catch(u){console.warn("[Store] Post-transaction refresh failed:",u.message)}},2e3),i&&setTimeout(()=>{const u=N.tradeDirection==="buy";i.className=`w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden ${u?"trade-buy":"trade-sell"}`},800)}}})}const Ur="https://sepolia.arbiscan.io/tx/",wm="https://sepolia.arbiscan.io/address/",ym=(y==null?void 0:y.fortunePool)||"0x277dB00d533Bbc0fc267bbD954640aDA38ee6B37",pa=1e3,km=3e3,Wi={pt:{title:"Compartilhe & Ganhe!",subtitle:`+${pa} pontos para o Airdrop`,later:"Talvez depois"},en:{title:"Share & Earn!",subtitle:`+${pa} points for Airdrop`,later:"Maybe later"},es:{title:"Â¡Comparte y Gana!",subtitle:`+${pa} puntos para el Airdrop`,later:"QuizÃ¡s despuÃ©s"}},Em={pt:{win:e=>`ðŸŽ‰ Ganhei ${e.toLocaleString()} BKC no Fortune Pool!

ðŸ¯ Loteria on-chain com resultados instantÃ¢neos!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #Arbitrum`,lose:`ðŸ¯ Jogando Fortune Pool no @backcoin!

Loteria on-chain verificÃ¡vel!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #Arbitrum`},en:{win:e=>`ðŸŽ‰ Just won ${e.toLocaleString()} BKC on Fortune Pool!

ðŸ¯ On-chain lottery with instant results!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #Arbitrum`,lose:`ðŸ¯ Playing Fortune Pool on @backcoin!

Verifiable on-chain lottery!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #Arbitrum`},es:{win:e=>`ðŸŽ‰ Â¡GanÃ© ${e.toLocaleString()} BKC en Fortune Pool!

ðŸ¯ Â¡LoterÃ­a on-chain con resultados instantÃ¡neos!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #Arbitrum`,lose:`ðŸ¯ Â¡Jugando Fortune Pool en @backcoin!

LoterÃ­a on-chain verificable!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #Arbitrum`}},Tm={pt:"./assets/pt.png",en:"./assets/en.png",es:"./assets/es.png"};let Sa="en";const fe=[{id:0,name:"Easy",emoji:"ðŸ€",range:4,multiplier:3,chance:"25%",color:"emerald",hex:"#10b981",bgFrom:"from-emerald-500/20",bgTo:"to-green-600/10",borderColor:"border-emerald-500/50",textColor:"text-emerald-400"},{id:1,name:"Medium",emoji:"âš¡",range:20,multiplier:15,chance:"5%",color:"violet",hex:"#8b5cf6",bgFrom:"from-violet-500/20",bgTo:"to-purple-600/10",borderColor:"border-violet-500/50",textColor:"text-violet-400"},{id:2,name:"Hard",emoji:"ðŸ‘‘",range:100,multiplier:75,chance:"1%",color:"amber",hex:"#f59e0b",bgFrom:"from-amber-500/20",bgTo:"to-orange-600/10",borderColor:"border-amber-500/50",textColor:"text-amber-400"}],Ad=fe.reduce((e,t)=>e+t.multiplier,0),Cm=fe[2].multiplier;fe[2].range;const Pd=1-fe.reduce((e,t)=>e*(1-1/t.range),1),Im=(Pd*100).toFixed(0);Math.round((Pd-1/fe[0].range)/(1/fe[0].range)*100);const v={mode:"combo",phase:"intro",guess:2,guesses:[2,5,50],comboStep:0,wager:10,gameId:null,result:null,txHash:null,poolData:null,history:[],serviceFee:0n,serviceFee1x:0n,serviceFee5x:0n,tiersData:null,commitment:{hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:5,waitStartTime:null,canReveal:!1}};let Re=null;function ot(e){switch(e){case"easy":return{tiers:[fe[0]],tierMask:1,multi:fe[0].multiplier,isSingle:!0};case"medium":return{tiers:[fe[1]],tierMask:2,multi:fe[1].multiplier,isSingle:!0};case"hard":return{tiers:[fe[2]],tierMask:4,multi:fe[2].multiplier,isSingle:!0};case"combo":return{tiers:fe,tierMask:7,multi:Ad,isSingle:!1};default:return{tiers:[fe[0]],tierMask:1,multi:fe[0].multiplier,isSingle:!0}}}function Am(){if(document.getElementById("fortune-styles-v11"))return;const e=document.createElement("style");e.id="fortune-styles-v11",e.textContent=`
        /* (tiger animations removed for mobile optimization) */

        /* Step wizard intro */
        @keyframes intro-pop { 0% { transform: scale(0); } 70% { transform: scale(1.15); } 100% { transform: scale(1); } }
        .intro-pop { animation: intro-pop 0.6s ease-out; }
        @keyframes intro-fade { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        .intro-fade { animation: intro-fade 0.5s ease-out 0.3s both; }
        @keyframes intro-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .intro-pulse { animation: intro-pulse 2s ease-in-out infinite 1s; }

        /* Hide number input arrows */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] { -moz-appearance: textfield; }

        /* Slot spin */
        @keyframes slot-spin {
            0% { transform: translateY(-100%); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        .slot-spin { animation: slot-spin 0.1s linear infinite; }

        /* Number reveal */
        @keyframes number-reveal {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(10deg); }
            70% { transform: scale(0.9) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .number-reveal { animation: number-reveal 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; }

        /* Match/Miss */
        @keyframes match-pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        .match-pulse { animation: match-pulse 0.8s ease-out 3; }
        @keyframes miss-shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .miss-shake { animation: miss-shake 0.5s ease-out; }

        /* Glow pulse */
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px var(--glow-color, rgba(249,115,22,0.3)); }
            50% { box-shadow: 0 0 40px var(--glow-color, rgba(249,115,22,0.6)); }
        }
        .glow-pulse { animation: glow-pulse 1s ease-in-out infinite; }

        /* Progress bar shimmer */
        @keyframes progress-shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        @keyframes progress-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.75; }
        }
        .progress-animate {
            background: linear-gradient(90deg, #10b981, #f59e0b, #ea580c, #f59e0b, #10b981) !important;
            background-size: 200% 100% !important;
            animation: progress-shimmer 2s linear infinite, progress-pulse 1.5s ease-in-out infinite;
        }

        /* Confetti */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .confetti {
            position: fixed;
            pointer-events: none;
            animation: confetti-fall 3s ease-out forwards;
            z-index: 9999;
        }
        .confetti-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999;
        }

        /* Coin rain */
        @keyframes coin-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .coin {
            position: fixed; font-size: 24px; pointer-events: none;
            animation: coin-fall 3s ease-out forwards; z-index: 9999;
        }

        /* Slider */
        .fortune-slider {
            -webkit-appearance: none;
            height: 8px; border-radius: 4px; background: #27272a;
        }
        .fortune-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px; height: 24px; border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            cursor: pointer; box-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }
        .fortune-slider::-moz-range-thumb {
            width: 24px; height: 24px; border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            cursor: pointer; border: none;
        }

        /* Waiting dots */
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .waiting-dots::after { content: ''; animation: dots 1.5s infinite; }

        /* Waiting phase */
        @keyframes countdown-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .countdown-pulse { animation: countdown-pulse 1s ease-in-out infinite; }
        @keyframes waiting-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        .waiting-glow { animation: waiting-glow 2s ease-in-out infinite; }
        @keyframes hourglass-spin {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
            100% { transform: rotate(360deg); }
        }
        .hourglass-spin { animation: hourglass-spin 2s ease-in-out infinite; }

        /* Processing pulse */
        @keyframes processing-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.98); }
        }
        .processing-pulse { animation: processing-pulse 1.5s ease-in-out infinite; }

        /* Prize pool glow */
        @keyframes prize-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.15), inset 0 0 30px rgba(245, 158, 11, 0.05); }
            50% { box-shadow: 0 0 35px rgba(245, 158, 11, 0.3), inset 0 0 40px rgba(245, 158, 11, 0.1); }
        }
        .prize-glow { animation: prize-glow 3s ease-in-out infinite; }

        /* Tab active indicator */
        .tab-active {
            border-bottom: 3px solid #f59e0b;
            color: #f59e0b !important;
        }

        /* Reel land animation */
        @keyframes reel-land {
            0% { transform: translateY(-300%); opacity: 0; }
            60% { transform: translateY(10%); opacity: 1; }
            80% { transform: translateY(-5%); }
            100% { transform: translateY(0); opacity: 1; }
        }
        .reel-land { animation: reel-land 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    `,document.head.appendChild(e)}function Pm(){Am();const e=document.getElementById("actions");if(!e){console.error("[FortunePool] Container #actions not found!");return}e.innerHTML=`
        <div class="max-w-md mx-auto px-4 py-3">
            <div id="game-area"></div>
        </div>
    `,ue(),$n(),Sm()}function Bm(){Re&&(clearInterval(Re),Re=null),v.phase="intro",v.result=null,v._balanceLoaded=!1,v._wagerInit=!1,v.commitment={hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:v.commitment.revealDelay||5,waitStartTime:null,canReveal:!1}}async function Gi(){var a;if(!c.userAddress)return;const e=JSON.parse(localStorage.getItem("fortune_pending_games")||"{}"),t=Object.entries(e).find(([,n])=>{var s,r;return((s=n.player)==null?void 0:s.toLowerCase())===((r=c.userAddress)==null?void 0:r.toLowerCase())&&!n.revealed});if(t){const[n,s]=t;console.log("[FortunePool] Recovering active game from localStorage:",n);try{if(c.fortunePoolContractPublic){const r=await c.fortunePoolContractPublic.getGameStatus(Number(n)),i=Number(r.status);if(i===0||i===3){console.log("[FortunePool] Game",n,"is expired on-chain, clearing"),delete e[n],localStorage.setItem("fortune_pending_games",JSON.stringify(e)),b("Previous game expired. Start a new one!","info"),v.phase="tier",ue();return}}}catch{}v.gameId=Number(n),v.commitment.userSecret=s.userSecret,v.mode=s.tierMask===1?"easy":s.tierMask===2?"medium":s.tierMask===4?"hard":"combo",v.guesses=s.guesses||[2,5,50],v.guess=((a=s.guesses)==null?void 0:a[0])||(v.mode==="hard"?50:v.mode==="medium"?5:2),v.commitment.waitStartTime=s.commitTimestamp||Date.now(),v.commitment.canReveal=!0,v.phase="waiting",Sd(),Nd();return}b("You have an active game but recovery data was lost. Wait ~50s for it to expire, then try again.","error"),v.phase="tier",ue()}async function Sm(){var e,t;if(c.userAddress)try{const a=JSON.parse(localStorage.getItem("fortune_pending_games")||"{}"),n=Object.entries(a).find(([,s])=>{var r,i;return((r=s.player)==null?void 0:r.toLowerCase())===((i=c.userAddress)==null?void 0:i.toLowerCase())&&!s.revealed});if(n){const[s,r]=n;console.log("[FortunePool] Recovering pending game:",s);try{if(c.fortunePoolContractPublic){const i=await c.fortunePoolContractPublic.getGameStatus(Number(s)),o=Number(i.status);if(o===0||o===3){console.log("[FortunePool] Pending game",s,"is expired, clearing"),delete a[s],localStorage.setItem("fortune_pending_games",JSON.stringify(a)),b("Previous game expired. Start a new one!","info");return}}}catch{}v.gameId=r.gameId||Number(s),v.commitment.userSecret=r.userSecret,v.mode=r.tierMask===1?"easy":r.tierMask===2?"medium":r.tierMask===4?"hard":"combo",v.guesses=r.guesses||[2,5,50],v.guess=((e=r.guesses)==null?void 0:e[0])||(v.mode==="hard"?50:v.mode==="medium"?5:2),v.wager=r.wagerAmount?Number(((t=window.ethers)==null?void 0:t.formatEther(BigInt(r.wagerAmount)))||10):10,v.commitment.waitStartTime=r.commitTimestamp||Date.now(),v.commitment.canReveal=!1,v.phase="waiting",ue(),Dm()}}catch(a){console.warn("[FortunePool] Pending game recovery failed:",a)}}function Bd(){try{const e=JSON.parse(localStorage.getItem("fortune_pending_games")||"{}");v.gameId&&e[v.gameId]&&(delete e[v.gameId],localStorage.setItem("fortune_pending_games",JSON.stringify(e)))}catch{}v.phase="tier",v.gameId=null,v.commitment={hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:5,waitStartTime:null,canReveal:!1},ye=0,b("Previous game expired. Start a new one!","info"),ue()}function ue(){const e=document.getElementById("game-area");if(e)switch(v.phase){case"intro":Yi(e);break;case"tier":zm(e);break;case"numbers":Nm(e);break;case"wager":$m(e);break;case"processing":Fm(e);break;case"waiting":Mm(e);break;case"result":Um(e);break;default:Yi(e)}}function Yi(e){var n;const t=v.poolData?O(v.poolData.prizePool||0n).toFixed(0)+" BKC":"...";e.innerHTML=`
        <div id="intro-splash" class="flex flex-col items-center justify-center min-h-[65vh] text-center cursor-pointer">
            <div class="text-7xl mb-5 intro-pop">ðŸ¯</div>
            <p class="text-zinc-500 text-xs uppercase tracking-[0.3em] mb-2 intro-fade">Accumulated Prize</p>
            <p class="text-4xl font-black text-amber-400 intro-fade intro-pulse" id="intro-prize">${t}</p>
            <p class="text-zinc-400 text-sm mt-3 intro-fade">Win up to <span class="text-amber-400 font-bold">${Cm}x</span> your bet</p>
            <div class="mt-8 text-zinc-600 text-xs animate-pulse intro-fade">Tap to play</div>
        </div>
    `;const a=()=>{v.phase==="intro"&&(v.phase="tier",ue())};(n=document.getElementById("intro-splash"))==null||n.addEventListener("click",a),setTimeout(a,2500)}function zm(e){e.innerHTML=`
        <div class="space-y-3">
            <div class="flex items-center justify-between px-1 mb-1">
                <p class="text-white font-bold text-lg">Choose Your Game</p>
                <span class="text-xs text-zinc-500">Step 1 of 3</span>
            </div>

            <div class="space-y-2.5">
                ${fe.map(t=>`
                    <button class="tier-card w-full flex items-center gap-4 p-4 bg-gradient-to-r ${t.bgFrom} ${t.bgTo} border ${t.borderColor} rounded-2xl hover:scale-[1.02] active:scale-[0.98] transition-all text-left" data-mode="${t.name.toLowerCase()}">
                        <div class="text-3xl flex-shrink-0">${t.emoji}</div>
                        <div class="flex-1 min-w-0">
                            <p class="${t.textColor} font-bold">${t.name}</p>
                            <p class="text-zinc-400 text-xs">Pick 1â€“${t.range} &bull; ${t.chance} chance</p>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <p class="${t.textColor} font-black text-2xl">${t.multiplier}x</p>
                        </div>
                    </button>
                `).join("")}

                <button class="tier-card w-full flex items-center gap-4 p-4 bg-gradient-to-r from-violet-900/30 via-purple-900/20 to-violet-900/30 border border-violet-500/40 rounded-2xl hover:scale-[1.02] active:scale-[0.98] transition-all text-left" data-mode="combo">
                    <div class="text-3xl flex-shrink-0">ðŸŽ°</div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <p class="text-violet-300 font-bold">Combo</p>
                            <span class="px-1.5 py-0.5 bg-emerald-500/20 border border-emerald-500/40 rounded text-[9px] text-emerald-400 font-bold">BEST ODDS</span>
                        </div>
                        <p class="text-zinc-400 text-xs">All 3 tiers &bull; ~${Im}% chance</p>
                    </div>
                    <div class="text-right flex-shrink-0">
                        <p class="text-violet-400 font-black text-2xl">${Ad}x</p>
                    </div>
                </button>
            </div>

            <div class="text-center pt-1">
                <a href="${wm}${ym}" target="_blank" rel="noopener"
                   class="inline-flex items-center gap-1.5 text-zinc-600 text-xs hover:text-zinc-400 transition-colors">
                    <i class="fa-solid fa-file-contract text-[10px]"></i> Verify Contract
                </a>
            </div>
        </div>
    `,e.querySelectorAll(".tier-card").forEach(t=>{t.addEventListener("click",()=>{const a=t.dataset.mode;if(v.mode=a,a==="combo")v.comboStep=0,v.guess=v.guesses[0];else{const n=ot(a);v.guess=Math.min(v.guess,n.tiers[0].range)}v.phase="numbers",ue()})})}function Nm(e){var n,s,r,i;const t=v.mode==="combo",a=t?fe[v.comboStep]:ot(v.mode).tiers[0];t&&(v.guess=v.guesses[v.comboStep]),e.innerHTML=`
        <div class="space-y-3">
            <div class="flex items-center justify-between px-1">
                <button id="btn-back-tier" class="flex items-center gap-1.5 text-zinc-400 hover:text-white transition-colors text-sm">
                    <i class="fa-solid fa-arrow-left text-xs"></i> Back
                </button>
                <span class="text-xs text-zinc-500">Step 2 of 3</span>
            </div>

            <div class="text-center">
                <p class="text-white font-bold text-lg">${t?"Pick Numbers":"Pick a Number"}</p>
                <p class="text-zinc-400 text-xs">${t?`${a.emoji} ${a.name} (1â€“${a.range}) &bull; ${a.chance} &bull; ${a.multiplier}x`:`${a.emoji} ${a.name}: 1â€“${a.range} &bull; ${a.chance} chance &bull; ${a.multiplier}x`}</p>
            </div>

            ${t?`
                <div class="flex items-center justify-center gap-2">
                    ${fe.map((o,l)=>`
                        <div class="w-9 h-9 rounded-full flex items-center justify-center text-sm ${l===v.comboStep?`bg-gradient-to-br ${o.bgFrom} ${o.bgTo} border-2 ${o.borderColor}`:l<v.comboStep?"bg-emerald-500/20 border-2 border-emerald-500/50":"bg-zinc-800 border-2 border-zinc-700"}">
                            ${l<v.comboStep?'<i class="fa-solid fa-check text-emerald-400 text-xs"></i>':`<span class="${l===v.comboStep?o.textColor:"text-zinc-500"} font-bold">${o.emoji}</span>`}
                        </div>
                    `).join('<div class="w-4 h-px bg-zinc-700"></div>')}
                </div>
            `:""}

            <div class="bg-gradient-to-br ${a.bgFrom} ${a.bgTo} border ${a.borderColor} rounded-2xl p-5">
                <div id="number-picker"></div>
            </div>

            ${t?`
                <div class="flex gap-2">
                    <button id="btn-combo-prev" class="flex-1 py-3 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-xl transition-colors text-sm ${v.comboStep===0?"opacity-30 pointer-events-none":""}">
                        <i class="fa-solid fa-arrow-left mr-1"></i>Prev
                    </button>
                    <button id="btn-combo-next" class="flex-1 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl transition-all text-sm">
                        ${v.comboStep<2?'Next <i class="fa-solid fa-arrow-right ml-1"></i>':'Set Wager <i class="fa-solid fa-arrow-right ml-1"></i>'}
                    </button>
                </div>
            `:`
                <button id="btn-next-wager" class="w-full py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl transition-all text-base">
                    Next â€” Set Wager <i class="fa-solid fa-arrow-right ml-1"></i>
                </button>
            `}
        </div>
    `,Lm(a),(n=document.getElementById("btn-back-tier"))==null||n.addEventListener("click",()=>{t&&(v.guesses[v.comboStep]=v.guess),v.phase="tier",ue()}),(s=document.getElementById("btn-next-wager"))==null||s.addEventListener("click",()=>{v.phase="wager",ue()}),(r=document.getElementById("btn-combo-prev"))==null||r.addEventListener("click",()=>{v.comboStep>0&&(v.guesses[v.comboStep]=v.guess,v.comboStep--,v.guess=v.guesses[v.comboStep],ue())}),(i=document.getElementById("btn-combo-next"))==null||i.addEventListener("click",()=>{v.guesses[v.comboStep]=v.guess,v.comboStep<2?(v.comboStep++,v.guess=v.guesses[v.comboStep],ue()):(v.phase="wager",ue())})}function $m(e){const t=ot(v.mode),a=v.mode==="combo",n=O(c.currentUserBalance||0n),s=n>=1,r=s&&c.isConnected;a&&(v.guesses[v.comboStep]=v.guess),!v._wagerInit&&n>=2&&(v.wager=Math.max(10,Math.floor(n/2)),v._wagerInit=!0),v.wager>n&&n>0&&(v.wager=Math.floor(n));const i=Math.max(1,Math.floor(n/2)),o=Math.max(1,Math.floor(n/4)),l=Math.max(1,Math.floor(n/10)),d=Math.max(1,Math.floor(n)),u=a?v.guesses:[v.guess],p=t.tiers;e.innerHTML=`
        <div class="space-y-3">
            <div class="flex items-center justify-between px-1">
                <button id="btn-back-numbers" class="flex items-center gap-1.5 text-zinc-400 hover:text-white transition-colors text-sm">
                    <i class="fa-solid fa-arrow-left text-xs"></i> Back
                </button>
                <span class="text-xs text-zinc-500">Step 3 of 3</span>
            </div>

            <!-- Summary of picks -->
            <div class="flex items-center justify-center gap-3 py-2">
                ${p.map((m,g)=>`
                    <div class="text-center">
                        <p class="text-[10px] ${m.textColor} mb-1">${m.emoji}</p>
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br ${m.bgFrom} ${m.bgTo} border ${m.borderColor} flex items-center justify-center">
                            <span class="text-base font-black ${m.textColor}">${u[g]}</span>
                        </div>
                    </div>
                `).join("")}
            </div>

            <!-- Wager controls -->
            <div class="bg-zinc-900/60 border border-zinc-800/50 rounded-2xl p-4">
                <div class="flex items-center justify-between mb-2">
                    <label class="text-sm text-zinc-400 font-bold"><i class="fa-solid fa-coins text-amber-400 mr-1.5"></i>Wager</label>
                    <span class="text-xs text-zinc-500">Bal: <span class="text-amber-400 font-bold">${n.toFixed(0)}</span> BKC</span>
                </div>

                <div class="flex items-center justify-center gap-2 mb-3">
                    <button id="wager-minus" class="w-10 h-10 rounded-lg bg-zinc-800 hover:bg-red-500/20 border border-zinc-700 text-zinc-400 hover:text-red-400 font-bold text-lg transition-all">&minus;</button>
                    <input type="number" id="custom-wager" value="${v.wager}" min="1" max="${d}"
                        class="w-28 h-14 text-center text-3xl font-black rounded-xl bg-zinc-900/80 border-2 border-amber-500/50 text-amber-400 focus:outline-none focus:border-amber-400 appearance-none"
                        style="-moz-appearance: textfield;">
                    <button id="wager-plus" class="w-10 h-10 rounded-lg bg-zinc-800 hover:bg-emerald-500/20 border border-zinc-700 text-zinc-400 hover:text-emerald-400 font-bold text-lg transition-all">+</button>
                </div>

                <div class="grid grid-cols-4 gap-1.5 mb-3">
                    ${[{val:l,label:"10%"},{val:o,label:"25%"},{val:i,label:"50%"},{val:d,label:"MAX"}].map(({val:m,label:g})=>`
                        <button class="wager-btn py-2 text-xs font-bold rounded-lg transition-all ${v.wager===m?"bg-amber-500/25 border border-amber-500/60 text-amber-400":"bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-amber-500/30"}" data-value="${m}">
                            <span class="block text-[10px] opacity-70">${m.toLocaleString()}</span>
                            <span class="block font-black">${g}</span>
                        </button>
                    `).join("")}
                </div>

                <div class="bg-emerald-500/10 rounded-xl p-3 mb-3 border border-emerald-500/20 text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Potential Win</p>
                    <p class="text-emerald-400 font-black text-2xl" id="potential-win">${(v.wager*t.multi).toLocaleString()} BKC</p>
                </div>

                <button id="btn-play" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-400 hover:to-green-400 text-white font-bold rounded-xl transition-all text-lg ${r?"":"opacity-40 cursor-not-allowed"}" ${r?"":"disabled"}>
                    <i class="fa-solid fa-play mr-2"></i>Play &mdash; ${v.wager.toLocaleString()} BKC
                </button>

                ${c.isConnected?"":'<p class="text-center text-zinc-500 text-xs mt-2">Connect wallet to play</p>'}
                ${c.isConnected&&!s?`
                    <button id="btn-faucet" class="w-full mt-2 py-2.5 bg-amber-500/10 border border-amber-500/30 rounded-lg text-amber-400 text-sm font-bold hover:bg-amber-500/20 transition-colors">
                        <i class="fa-solid fa-faucet mr-1"></i>Get Test Tokens
                    </button>
                `:""}
            </div>
        </div>
    `,Rm(t.multi,n)}function Lm(e){var n,s,r,i,o;const t=document.getElementById("number-picker");if(!t)return;const a=v.guess;if(e.range<=5)t.innerHTML=`
            <div class="flex justify-center gap-3">
                ${Array.from({length:e.range},(l,d)=>d+1).map(l=>`
                    <button class="num-pick w-14 h-14 rounded-2xl font-black text-2xl transition-all active:scale-95 ${l===a?"":"bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-zinc-700"}"
                        data-num="${l}"
                        style="${l===a?`background: ${e.hex}; color: white; box-shadow: 0 0 15px ${e.hex}60; transform: scale(1.1)`:""}">
                        ${l}
                    </button>
                `).join("")}
            </div>
        `;else if(e.range<=15)t.innerHTML=`
            <div class="grid grid-cols-5 gap-2 justify-items-center">
                ${Array.from({length:e.range},(l,d)=>d+1).map(l=>`
                    <button class="num-pick w-12 h-12 rounded-xl font-bold text-lg transition-all active:scale-95 ${l===a?"":"bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-zinc-700"}"
                        data-num="${l}"
                        style="${l===a?`background: ${e.hex}; color: white; box-shadow: 0 0 12px ${e.hex}60; transform: scale(1.05)`:""}">
                        ${l}
                    </button>
                `).join("")}
            </div>
        `;else{t.innerHTML=`
            <div class="flex items-center justify-center gap-3 mb-3">
                <button class="np-minus-10 w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xs transition-all border border-zinc-700">-10</button>
                <button class="np-minus w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-lg transition-all border border-zinc-700">&minus;</button>
                <input type="number" id="np-number" min="1" max="${e.range}" value="${a}"
                    class="w-20 h-20 text-center text-3xl font-black rounded-2xl border-2 text-zinc-900 focus:outline-none appearance-none shadow-lg"
                    style="background: ${e.hex}; border-color: ${e.hex}; box-shadow: 0 0 20px ${e.hex}50; -moz-appearance: textfield;">
                <button class="np-plus w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-lg transition-all border border-zinc-700">+</button>
                <button class="np-plus-10 w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xs transition-all border border-zinc-700">+10</button>
            </div>
            <div class="mb-3 px-1">
                <input type="range" id="np-slider" min="1" max="${e.range}" value="${a}"
                    class="fortune-slider w-full h-3 rounded-full appearance-none cursor-pointer"
                    style="background: linear-gradient(to right, ${e.hex} 0%, ${e.hex} ${a/e.range*100}%, #27272a ${a/e.range*100}%, #27272a 100%)">
                <div class="flex justify-between text-[10px] text-zinc-600 mt-1 px-1">
                    <span>1</span><span>${Math.round(e.range/4)}</span><span>${Math.round(e.range/2)}</span><span>${Math.round(e.range*3/4)}</span><span>${e.range}</span>
                </div>
            </div>
            <div class="flex justify-center gap-1.5 flex-wrap">
                ${[7,13,21,50,77,99,137].map(p=>`
                    <button class="np-quick px-2 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="${p}">${p}</button>
                `).join("")}
                <button id="np-random" class="px-2 py-1.5 text-xs rounded-lg border transition-all"
                    style="background: ${e.hex}20; border-color: ${e.hex}50; color: ${e.hex}">
                    <i class="fa-solid fa-dice mr-1"></i>Random
                </button>
            </div>
        `;const l=document.getElementById("np-number"),d=document.getElementById("np-slider"),u=p=>{if(p=Math.max(1,Math.min(e.range,p)),v.guess=p,l&&(l.value=p),d){d.value=p;const m=p/e.range*100;d.style.background=`linear-gradient(to right, ${e.hex} 0%, ${e.hex} ${m}%, #27272a ${m}%, #27272a 100%)`}};l==null||l.addEventListener("input",p=>u(parseInt(p.target.value)||1)),l==null||l.addEventListener("blur",p=>u(parseInt(p.target.value)||1)),d==null||d.addEventListener("input",p=>u(parseInt(p.target.value))),(n=t.querySelector(".np-minus"))==null||n.addEventListener("click",()=>u(v.guess-1)),(s=t.querySelector(".np-plus"))==null||s.addEventListener("click",()=>u(v.guess+1)),(r=t.querySelector(".np-minus-10"))==null||r.addEventListener("click",()=>u(v.guess-10)),(i=t.querySelector(".np-plus-10"))==null||i.addEventListener("click",()=>u(v.guess+10)),t.querySelectorAll(".np-quick").forEach(p=>{p.addEventListener("click",()=>u(parseInt(p.dataset.num)))}),(o=document.getElementById("np-random"))==null||o.addEventListener("click",()=>{u(Math.floor(Math.random()*e.range)+1)});return}t.querySelectorAll(".num-pick").forEach(l=>{l.addEventListener("click",()=>{const d=parseInt(l.dataset.num);v.guess=d;const u=e.range<=5?1.1:1.05;t.querySelectorAll(".num-pick").forEach(p=>{parseInt(p.dataset.num)===d?(p.style.cssText=`background: ${e.hex}; color: white; box-shadow: 0 0 15px ${e.hex}60; transform: scale(${u})`,p.classList.remove("bg-zinc-800","border","border-zinc-700","text-zinc-300")):(p.style.cssText="",p.classList.contains("bg-zinc-800")||p.classList.add("bg-zinc-800","border","border-zinc-700","text-zinc-300"))})})})}function Rm(e,t){var n,s,r,i,o,l;const a=d=>{v.wager=Math.max(1,Math.min(Math.floor(d),Math.floor(t)));const u=document.getElementById("custom-wager"),p=document.getElementById("potential-win"),m=document.getElementById("btn-play");u&&(u.value=v.wager),p&&(p.textContent=(v.wager*e).toLocaleString()+" BKC"),m&&(m.innerHTML=`<i class="fa-solid fa-play mr-2"></i>Play &mdash; ${v.wager.toLocaleString()} BKC`),document.querySelectorAll(".wager-btn").forEach(g=>{const x=parseInt(g.dataset.value),h=v.wager===x;g.className=`wager-btn py-2 text-xs font-bold rounded-lg transition-all ${h?"bg-amber-500/25 border border-amber-500/60 text-amber-400":"bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-amber-500/30"}`})};document.querySelectorAll(".wager-btn").forEach(d=>{d.addEventListener("click",()=>a(parseInt(d.dataset.value)||1))}),(n=document.getElementById("custom-wager"))==null||n.addEventListener("input",d=>a(parseInt(d.target.value)||1)),(s=document.getElementById("wager-minus"))==null||s.addEventListener("click",()=>a(v.wager-1)),(r=document.getElementById("wager-plus"))==null||r.addEventListener("click",()=>a(v.wager+1)),(i=document.getElementById("btn-back-numbers"))==null||i.addEventListener("click",()=>{v.mode==="combo"&&(v.comboStep=2),v.phase="numbers",ue()}),(o=document.getElementById("btn-faucet"))==null||o.addEventListener("click",async()=>{b("Requesting tokens...","info");try{const d=await fetch(`/api/faucet?address=${c.userAddress}`),u=await d.json();if(d.ok&&u.success)b("Tokens received!","success"),await Jn(),ue();else{const p=u.error||"Faucet unavailable";b(p,p.toLowerCase().includes("cooldown")?"warning":"error")}}catch{b("Faucet temporarily unavailable","error")}}),(l=document.getElementById("btn-play"))==null||l.addEventListener("click",()=>{if(!c.isConnected)return b("Connect wallet first","warning");if(v.wager<1)return b("Min: 1 BKC","warning");_m()})}async function _m(){v.phase="processing",ye=0,ue();try{const e=ot(v.mode),t=e.isSingle?[v.guess]:v.guesses,a=e.tierMask,n=window.ethers.parseEther(v.wager.toString());await Ir.playGame({wagerAmount:n,guesses:t,tierMask:a,button:document.getElementById("btn-play"),onSuccess:s=>{v.gameId=(s==null?void 0:s.gameId)||Date.now(),v.commitment={hash:null,userSecret:(s==null?void 0:s.userSecret)||null,commitBlock:(s==null?void 0:s.commitBlock)||null,commitTxHash:(s==null?void 0:s.txHash)||null,revealDelay:v.commitment.revealDelay||5,waitStartTime:Date.now(),canReveal:!0},v.txHash=(s==null?void 0:s.txHash)||null,console.log("[FortunePool] Game committed:",v.gameId,"Block:",v.commitment.commitBlock),v.phase="waiting",Sd(),Nd()},onError:s=>{var r;if(!s.cancelled){const i=s.message||"",o=((r=s.original)==null?void 0:r.data)||s.data||i;if(String(o).includes("0xbfec5558")||i.includes("active game")){b("You have a pending game. Attempting to recover...","warning"),Gi();return}b(i||"Commit failed","error")}v.phase="wager",ue()}})}catch(e){console.error("Commit error:",e);const t=e.message||"";if(String(e.data||t).includes("0xbfec5558")||t.includes("active game")){b("You have a pending game. Attempting to recover...","warning"),Gi();return}b("Error: "+(t||"Transaction failed"),"error"),v.phase="wager",ue()}}function Fm(e){const t=ot(v.mode),a=t.isSingle?[v.guess]:v.guesses,n=t.tiers;e.innerHTML=`
        <div class="bg-gradient-to-br from-zinc-900 to-zinc-800/50 border border-zinc-700/50 rounded-2xl p-6 processing-pulse">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center">
                    <i class="fa-solid fa-dice text-3xl text-amber-400 animate-bounce"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">Committing<span class="waiting-dots"></span></h2>
                <p class="text-zinc-400 text-sm">Locking your numbers on-chain</p>
            </div>

            <!-- Animated Reels -->
            <div class="flex justify-center gap-4 mb-6">
                ${n.map((s,r)=>`
                    <div class="text-center">
                        <p class="text-xs text-zinc-500 mb-2">${s.emoji} ${s.name}</p>
                        <div class="w-20 h-24 rounded-2xl bg-gradient-to-br ${s.bgFrom} ${s.bgTo} border-2 ${s.borderColor} flex items-center justify-center overflow-hidden glow-pulse" style="--glow-color: ${s.hex}50">
                            <span class="text-4xl font-black ${s.textColor} slot-spin" id="spin-${r}">?</span>
                        </div>
                    </div>
                `).join("")}
            </div>

            <!-- Your Picks -->
            <div class="border-t border-zinc-700/50 pt-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">Your Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((s,r)=>{const i=a[r];return`
                            <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${s.bgFrom} ${s.bgTo} border-2 ${s.borderColor} flex items-center justify-center">
                                <span class="text-xl font-black ${s.textColor}">${i}</span>
                            </div>
                        `}).join("")}
                </div>
            </div>
        </div>
    `,n.forEach((s,r)=>{const i=document.getElementById(`spin-${r}`);i&&setInterval(()=>{i.textContent=Math.floor(Math.random()*s.range)+1},80)})}function Sd(){const e=document.getElementById("game-area");if(!e)return;const t=ot(v.mode),a=t.isSingle?[v.guess]:v.guesses,n=t.tiers;e.innerHTML=`
        <div class="bg-gradient-to-br from-violet-900/30 to-purple-900/20 border border-violet-500/30 rounded-2xl p-6 waiting-glow">
            <!-- Steps Progress -->
            <div class="mb-5">
                <div class="flex items-center justify-between mb-4">
                    <div id="step-1" class="flex items-center gap-2">
                        <div class="w-7 h-7 rounded-full bg-emerald-500 flex items-center justify-center">
                            <i class="fa-solid fa-check text-white text-xs"></i>
                        </div>
                        <span class="text-emerald-400 text-sm font-medium">Play Recorded</span>
                    </div>
                    <div class="flex-1 h-px bg-zinc-700 mx-2"></div>
                    <div id="step-2" class="flex items-center gap-2">
                        <div id="step-2-icon" class="w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center">
                            <i class="fa-solid fa-spinner fa-spin text-white text-xs"></i>
                        </div>
                        <span id="step-2-text" class="text-amber-400 text-sm font-medium">Confirming...</span>
                    </div>
                    <div class="flex-1 h-px bg-zinc-700 mx-2"></div>
                    <div id="step-3" class="flex items-center gap-2">
                        <div id="step-3-icon" class="w-7 h-7 rounded-full bg-zinc-700 flex items-center justify-center">
                            <span class="text-zinc-500 text-xs font-bold">3</span>
                        </div>
                        <span id="step-3-text" class="text-zinc-500 text-sm font-medium">Result</span>
                    </div>
                </div>
                <!-- Progress bar -->
                <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                    <div id="reveal-progress" class="h-full bg-gradient-to-r from-emerald-500 via-amber-500 to-orange-500 rounded-full transition-all duration-1000 progress-animate" style="width: 33%"></div>
                </div>
                <p id="reveal-status-text" class="text-center text-xs text-zinc-400 mt-2">
                    <i class="fa-solid fa-cube mr-1"></i>Waiting for block confirmations...
                </p>
            </div>

            <!-- Spinning Reels -->
            <div class="flex justify-center gap-4 mb-5">
                ${n.map((s,r)=>`
                    <div class="text-center">
                        <p class="text-xs text-zinc-500 mb-2">${s.emoji} ${s.name}</p>
                        <div class="w-20 h-24 rounded-2xl bg-gradient-to-br ${s.bgFrom} ${s.bgTo} border-2 ${s.borderColor} flex items-center justify-center overflow-hidden glow-pulse" style="--glow-color: ${s.hex}50">
                            <span class="text-4xl font-black ${s.textColor} slot-spin" id="quick-spin-${r}">?</span>
                        </div>
                    </div>
                `).join("")}
            </div>

            <!-- Locked Picks -->
            <div class="border-t border-violet-500/20 pt-4 mb-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">Your Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((s,r)=>{const i=a[r];return`
                            <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${s.bgFrom} ${s.bgTo} border-2 ${s.borderColor} flex items-center justify-center relative">
                                <span class="text-xl font-black ${s.textColor}">${i}</span>
                                <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-violet-500 flex items-center justify-center">
                                    <i class="fa-solid fa-lock text-[8px] text-white"></i>
                                </div>
                            </div>
                        `}).join("")}
                </div>
            </div>

            <button id="btn-reveal" disabled
                class="w-full py-3 rounded-xl font-bold bg-gradient-to-r from-amber-500 to-yellow-500 text-white opacity-80">
                <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                <span id="reveal-btn-text">Waiting for blockchain...</span>
            </button>
        </div>
    `,n.forEach((s,r)=>{const i=document.getElementById(`quick-spin-${r}`);i&&setInterval(()=>{i.textContent=Math.floor(Math.random()*s.range)+1},80)})}function zd(){const e=document.getElementById("step-2-icon"),t=document.getElementById("step-2-text"),a=document.getElementById("step-3-icon"),n=document.getElementById("step-3-text"),s=document.getElementById("reveal-progress"),r=document.getElementById("reveal-status-text"),i=document.getElementById("reveal-btn-text");e&&(e.innerHTML='<i class="fa-solid fa-check text-white text-xs"></i>'),e&&(e.className="w-7 h-7 rounded-full bg-emerald-500 flex items-center justify-center"),t&&(t.textContent="Confirmed",t.className="text-emerald-400 text-sm font-medium"),a&&(a.innerHTML='<i class="fa-solid fa-spinner fa-spin text-white text-xs"></i>'),a&&(a.className="w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center"),n&&(n.textContent="Revealing...",n.className="text-amber-400 text-sm font-medium"),s&&(s.style.width="80%"),r&&(r.innerHTML='<i class="fa-solid fa-wand-magic-sparkles mr-1"></i>Confirm in MetaMask to see your result!'),i&&(i.textContent="Confirm in MetaMask...")}function Mm(e){var d;const t=ot(v.mode),a=t.isSingle?[v.guess]:v.guesses,n=t.tiers,s=Date.now()-(v.commitment.waitStartTime||Date.now()),i=Pt[Math.min(ye,Pt.length-1)]+2e3,o=Math.max(0,i-s),l=Math.ceil(o/1e3);e.innerHTML=`
        <div class="bg-gradient-to-br from-violet-900/30 to-purple-900/20 border border-violet-500/30 rounded-2xl p-6 waiting-glow">
            <div class="text-center mb-5">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-violet-500/20 to-purple-600/20 border border-violet-500/30 flex items-center justify-center">
                    <i class="fa-solid fa-hourglass-half text-3xl text-violet-400 hourglass-spin"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">Commitment Locked</h2>
                <p class="text-violet-300 text-sm">Waiting for blockchain confirmation...</p>
            </div>

            <!-- Countdown -->
            <div class="bg-zinc-900/50 rounded-xl p-4 mb-4 border border-violet-500/20">
                <div class="text-center">
                    <p class="text-xs text-zinc-500 uppercase mb-2">Time to Reveal</p>
                    <span id="countdown-timer" class="text-4xl font-black text-violet-400 countdown-pulse">~${l}s</span>
                    <div class="mt-3 w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                        <div id="progress-bar" class="h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-1000"
                             style="width: ${Math.min(100,s/i*100)}%"></div>
                    </div>
                </div>
            </div>

            <!-- Block Info -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center border border-zinc-700/50">
                    <p class="text-[10px] text-zinc-500 uppercase mb-1">Commit Block</p>
                    <p class="text-sm font-mono text-white">#${v.commitment.commitBlock||"..."}</p>
                </div>
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center border border-zinc-700/50">
                    <p class="text-[10px] text-zinc-500 uppercase mb-1">Reveal After</p>
                    <p class="text-sm font-mono text-violet-400">#${(v.commitment.commitBlock||0)+v.commitment.revealDelay}</p>
                </div>
            </div>

            <!-- Locked Numbers with spinning reels -->
            <div class="border-t border-violet-500/20 pt-4 mb-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">Your Locked Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((u,p)=>{const m=a[p];return`
                            <div class="text-center">
                                <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${u.bgFrom} ${u.bgTo} border-2 ${u.borderColor} flex items-center justify-center relative">
                                    <span class="text-xl font-black ${u.textColor}">${m}</span>
                                    <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-violet-500 flex items-center justify-center">
                                        <i class="fa-solid fa-lock text-[8px] text-white"></i>
                                    </div>
                                </div>
                            </div>
                        `}).join("")}
                </div>
            </div>

            <!-- Reveal Button -->
            <button id="btn-reveal"
                class="w-full py-3 rounded-xl font-bold transition-all ${v.commitment.canReveal?"bg-gradient-to-r from-emerald-500 to-green-500 text-white hover:shadow-lg hover:shadow-emerald-500/30":"bg-zinc-800 text-zinc-500 cursor-not-allowed"}"
                ${v.commitment.canReveal?"":"disabled"}>
                <i class="fa-solid ${v.commitment.canReveal?"fa-spinner fa-spin":"fa-lock"} mr-2"></i>
                <span id="reveal-btn-text">${v.commitment.canReveal?"Auto-revealing...":"Waiting for blocks..."}</span>
            </button>

            <div class="mt-3 p-2.5 bg-violet-500/10 rounded-lg border border-violet-500/20">
                <p class="text-[10px] text-violet-300 text-center">
                    <i class="fa-solid fa-shield-halved mr-1"></i>
                    Commit-reveal prevents manipulation. Reveal triggers automatically.
                </p>
            </div>

            ${v.commitment.commitTxHash?`
                <div class="text-center mt-3">
                    <a href="${Ur}${v.commitment.commitTxHash}" target="_blank"
                       class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-zinc-400">
                        <i class="fa-solid fa-external-link"></i> View Commit TX
                    </a>
                </div>
            `:""}
        </div>
    `,(d=document.getElementById("btn-reveal"))==null||d.addEventListener("click",()=>Wr()),jr()}function jr(){if(v.phase!=="waiting")return;const e=document.getElementById("countdown-timer"),t=document.getElementById("progress-bar");if(!e)return;const a=Date.now()-(v.commitment.waitStartTime||Date.now()),s=Pt[Math.min(ye,Pt.length-1)]+2e3,r=Math.max(0,s-a),i=Math.ceil(r/1e3);i>0?e.textContent=`~${i}s`:e.textContent="Revealing...",t&&(t.style.width=`${Math.min(100,a/s*100)}%`),v.phase==="waiting"&&setTimeout(jr,1e3)}function Dm(){Re&&clearInterval(Re),setTimeout(jr,100),Re=setInterval(async()=>{if(v.phase!=="waiting"){clearInterval(Re);return}try{const e=await Om();if(e==="expired"){clearInterval(Re),Re=null,console.log("[FortunePool] Game expired, clearing stuck game"),Bd();return}e&&!v.commitment.canReveal&&(v.commitment.canReveal=!0,clearInterval(Re),Re=null,console.log("[FortunePool] canReveal=true, starting auto-reveal..."),Ys())}catch(e){console.warn("Reveal check error:",e)}},km)}async function Om(){if(!c.fortunePoolContractPublic||!v.gameId)return!1;try{const e=await c.fortunePoolContractPublic.getGameStatus(v.gameId),t=Number(e.status);if(t===0||t===3)return"expired";if(!v.commitment.commitBlock)try{const a=await c.fortunePoolContractPublic.getGame(v.gameId),n=Number(a.commitBlock);n>0&&(v.commitment.commitBlock=n)}catch{}return e.canReveal===!0}catch{return Date.now()-(v.commitment.waitStartTime||Date.now())>=1e4}}let ye=0;const Pt=[8e3,15e3,2e4];async function Ys(){if(v.phase!=="waiting")return;const e=document.getElementById("reveal-status-text"),t=document.getElementById("btn-reveal"),a=document.getElementById("reveal-btn-text");t&&(t.disabled=!0,t.classList.remove("bg-zinc-800","text-zinc-500","cursor-not-allowed"),t.classList.add("bg-gradient-to-r","from-amber-500","to-yellow-500","text-white"));const n=Pt[Math.min(ye,Pt.length-1)];console.log(`[FortunePool] Waiting ${n/1e3}s before reveal attempt ${ye+1}...`),e&&(e.innerHTML='<i class="fa-solid fa-rotate mr-1"></i>Retrying automatically...');const s=Date.now(),r=setInterval(()=>{if(v.phase!=="waiting"){clearInterval(r);return}const i=Math.ceil((n-(Date.now()-s))/1e3);i>0&&a&&(a.textContent=`Retrying in ${i}s...`)},500);await new Promise(i=>setTimeout(i,n)),clearInterval(r),v.phase==="waiting"&&(zd(),console.log("[FortunePool] Starting direct reveal (skipping pre-sim for Arbitrum L2)"),Wr())}function kn(){const e=document.getElementById("reveal-status-text"),t=document.getElementById("btn-reveal"),a=document.getElementById("reveal-btn-text"),n=document.getElementById("countdown-timer"),s=document.getElementById("reveal-progress");e&&(e.innerHTML='<i class="fa-solid fa-hand-pointer mr-1"></i>Tap the button to see your result'),n&&(n.textContent="Ready!"),s&&(s.style.width="67%"),t&&(t.disabled=!1,t.classList.remove("bg-zinc-800","text-zinc-500","cursor-not-allowed","from-amber-500","to-yellow-500","opacity-80"),t.classList.add("bg-gradient-to-r","from-emerald-500","to-green-500","text-white")),a&&(a.textContent="Reveal & Get Result!");const r=document.getElementById("step-2-icon"),i=document.getElementById("step-2-text");r&&(r.innerHTML='<i class="fa-solid fa-check text-white text-xs"></i>',r.className="w-7 h-7 rounded-full bg-emerald-500 flex items-center justify-center"),i&&(i.textContent="Confirmed",i.className="text-emerald-400 text-sm font-medium")}function Nd(){let e=0;const t=60;let a=999;const n=async()=>{if(v.phase==="waiting"){e++;try{const s=await c.fortunePoolContractPublic.getGameStatus(v.gameId),r=Number(s.status);if(r===0||r===3){Bd();return}const i=Number(s.blocksUntilReveal),o=s.canReveal===!0,l=document.getElementById("reveal-progress"),d=document.getElementById("reveal-status-text");if(i>0&&d){const m=33+Math.max(0,5-i)/5*34;l&&(l.style.width=`${m}%`),d.innerHTML=`<i class="fa-solid fa-cube mr-1"></i>${i} block${i>1?"s":""} remaining...`,a=i}if(o){console.log(`[FortunePool] canReveal=true after ${e} polls (~${e*2}s)`),zd(),Hm(),Wr();return}}catch(s){console.warn("[FortunePool] canReveal poll error:",s)}e<t?setTimeout(n,2e3):(console.warn("[FortunePool] canReveal poll timeout, enabling manual reveal"),kn())}};setTimeout(n,2e3)}async function Hm(){var e;try{const t=ot(v.mode).isSingle?[v.guess]:v.guesses,a=window.ethers,n=await c.fortunePoolContractPublic.generateCommitHash(t.map(s=>BigInt(s)),v.commitment.userSecret);console.log("[FortunePool] Hash diagnostic:",{computedHash:n,guesses:t.map(s=>Number(s)),secret:((e=v.commitment.userSecret)==null?void 0:e.slice(0,18))+"..."})}catch(t){console.warn("[FortunePool] Hash diagnostic failed:",t)}}async function Wr(){const e=document.getElementById("btn-reveal");try{const t=ot(v.mode).isSingle?[v.guess]:v.guesses;await Ir.revealPlay({gameId:v.gameId,guesses:t,userSecret:v.commitment.userSecret,button:e,onSuccess:(a,n)=>{Re&&clearInterval(Re),ye=0,v.txHash=a.hash,v.result={rolls:(n==null?void 0:n.rolls)||[],prizeWon:(n==null?void 0:n.prizeWon)||0n,matches:(n==null?void 0:n.matches)||[],matchCount:(n==null?void 0:n.matchCount)||0},console.log("[FortunePool] Game revealed:",v.result),v.phase="result",ue(),$n()},onError:a=>{if(a.cancelled){console.log("[FortunePool] User rejected reveal, showing manual button"),b("You can reveal your result when ready","info"),ye=0,kn();return}const n=a.message||"";(a.type==="tx_reverted"||n.includes("revert")||n.includes("failed")||n.includes("0x92555c0e")||n.includes("BlockhashUnavailable")||n.includes("CALL_EXCEPTION"))&&ye<Pt.length-1?(ye++,console.warn(`[FortunePool] Reveal reverted (attempt ${ye}), auto-retrying...`),Ys()):(b("Reveal failed â€” tap the button to try again","error"),ye=0,kn())}})}catch(t){console.error("Reveal error:",t);const a=t.message||"";(a.includes("revert")||a.includes("failed")||a.includes("BlockhashUnavailable"))&&ye<Pt.length-1?(ye++,console.warn(`[FortunePool] Reveal exception (attempt ${ye}), auto-retrying...`),Ys()):(b("Reveal failed: "+(a||"Unknown error"),"error"),ye=0,kn())}}function Um(e){var m,g,x;const t=v.result;if(!t)return ue();const a=ot(v.mode),n=a.isSingle?[v.guess]:v.guesses,s=t.rolls||[],r=a.tiers,i=n.map((h,C)=>{const T=s[C]!==void 0?Number(s[C]):null;return T!==null&&T===h}),o=i.filter(h=>h).length,l=t.prizeWon>0||o>0;let d=0;t.prizeWon&&t.prizeWon>0n?d=O(BigInt(t.prizeWon)):o>0&&i.forEach((h,C)=>{if(h){const T=a.tiers[C]||fe[C];d+=v.wager*T.multiplier}});const u=typeof d=="number"?d.toLocaleString(void 0,{maximumFractionDigits:2}):d.toLocaleString();e.innerHTML=`
        <div class="bg-gradient-to-br ${l?"from-emerald-900/30 to-green-900/10 border-emerald-500/30":"from-zinc-900 to-zinc-800/50 border-zinc-700/50"} border rounded-2xl p-5 relative overflow-hidden" id="result-container">

            <!-- Result Header -->
            <div class="text-center mb-4">
                ${l?`
                    <div class="text-5xl mb-2">ðŸŽ‰</div>
                    <h2 class="text-2xl font-black text-emerald-400 mb-1">YOU WON!</h2>
                    <p class="text-3xl font-black text-white">${u} BKC</p>
                `:`
                    <div class="text-5xl mb-2">ðŸ˜”</div>
                    <h2 class="text-xl font-bold text-zinc-400 mb-1">No Match</h2>
                    <p class="text-zinc-500 text-sm">Better luck next time!</p>
                `}
            </div>

            <!-- Animated Result Grid -->
            <div class="grid ${a.isSingle?"grid-cols-1 max-w-[220px] mx-auto":"grid-cols-3"} gap-3 mb-4">
                ${r.map((h,C)=>{const T=n[C],A=s[C],B=i[C];return`
                        <div class="text-center p-3 rounded-xl ${B?"bg-emerald-500/20 border border-emerald-500/50":"bg-zinc-800/50 border border-zinc-700/50"}" id="result-tier-${C}">
                            <p class="text-[10px] text-zinc-500 mb-1">${h.emoji} ${h.name}</p>
                            <div class="flex items-center justify-center gap-2">
                                <div class="text-center">
                                    <p class="text-[8px] text-zinc-600 mb-0.5">YOU</p>
                                    <div class="w-12 h-12 rounded-lg bg-gradient-to-br ${h.bgFrom} ${h.bgTo} border ${h.borderColor} flex items-center justify-center">
                                        <span class="text-xl font-black ${h.textColor}">${T}</span>
                                    </div>
                                </div>
                                <span class="text-xl" id="match-icon-${C}" style="opacity: 0">
                                    ${B?"=":"â‰ "}
                                </span>
                                <div class="text-center">
                                    <p class="text-[8px] text-zinc-600 mb-0.5">ROLL</p>
                                    <div class="w-12 h-12 rounded-lg ${B?"bg-emerald-500/30 border-emerald-500":"bg-zinc-700/50 border-zinc-600"} border flex items-center justify-center overflow-hidden">
                                        <span class="text-xl font-black ${B?"text-emerald-400":"text-zinc-300"}" id="roll-num-${C}" style="opacity: 0">${A!==void 0?A:"?"}</span>
                                    </div>
                                </div>
                            </div>
                            ${B?`<p class="text-emerald-400 text-xs font-bold mt-1" id="match-label-${C}" style="opacity: 0">+${h.multiplier}x</p>`:""}
                        </div>
                    `}).join("")}
            </div>

            <!-- TX Link -->
            ${v.txHash?`
                <div class="text-center mb-3">
                    <a href="${Ur}${v.txHash}" target="_blank" class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-zinc-400">
                        <i class="fa-solid fa-external-link"></i> View Transaction
                    </a>
                </div>
            `:""}

            <!-- Share -->
            <div class="bg-gradient-to-r ${l?"from-amber-500/10 to-orange-500/10 border-amber-500/30":"from-zinc-800/50 to-zinc-700/30 border-zinc-600/30"} border rounded-xl p-3 mb-3">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-9 h-9 rounded-full ${l?"bg-amber-500/20":"bg-zinc-700/50"} flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-gift ${l?"text-amber-400":"text-zinc-400"}"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">${l?"Share Your Win!":"Share & Try Again!"}</p>
                        <p class="text-amber-400 text-xs font-medium">+${pa} Airdrop Points</p>
                    </div>
                </div>
                <button id="btn-share" class="w-full py-2.5 ${l?"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black":"bg-zinc-700 hover:bg-zinc-600 text-white border border-zinc-600"} font-bold rounded-xl transition-all text-sm">
                    <i class="fa-solid fa-share-nodes mr-2"></i>${l?"Share Now":"Share Anyway"}
                </button>
            </div>

            <button id="btn-new-game" class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black font-bold rounded-xl transition-all">
                <i class="fa-solid fa-paw mr-2"></i>Play Again
            </button>
            <button id="btn-change-game" class="w-full mt-2 py-2 text-zinc-500 hover:text-zinc-300 text-sm transition-colors">
                <i class="fa-solid fa-shuffle mr-1"></i>Change Game Mode
            </button>
        </div>

        <!-- History -->
        <div class="mt-3 bg-zinc-900/50 border border-zinc-800/50 rounded-2xl overflow-hidden">
            <div class="flex items-center justify-between p-3 border-b border-zinc-800/50">
                <span class="text-sm font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-clock-rotate-left text-orange-500 text-xs"></i>
                    Recent Games
                </span>
                <span id="win-rate" class="text-xs text-zinc-500"></span>
            </div>
            <div id="history-list" class="max-h-[200px] overflow-y-auto p-2">
                <div class="p-3 text-center text-zinc-600 text-sm">
                    <i class="fa-solid fa-spinner fa-spin text-zinc-600 mb-1"></i>
                    <p class="text-xs">Loading...</p>
                </div>
            </div>
        </div>
    `,r.forEach((h,C)=>{const T=600+C*800;setTimeout(()=>{const A=document.getElementById(`roll-num-${C}`),B=document.getElementById(`match-icon-${C}`),z=document.getElementById(`match-label-${C}`),S=document.getElementById(`result-tier-${C}`);A&&(A.style.opacity="1",A.classList.add("reel-land")),B&&(B.style.opacity="1",B.className=`text-xl ${i[C]?"text-emerald-400":"text-red-400"}`),setTimeout(()=>{S&&S.classList.add(i[C]?"match-pulse":"miss-shake"),z&&(z.style.opacity="1")},400)},T)});const p=600+r.length*800+500;l&&setTimeout(()=>{jm(),d>v.wager*10&&Wm()},p),(m=document.getElementById("btn-new-game"))==null||m.addEventListener("click",()=>{v.phase="wager",v.result=null,v.txHash=null,v.gameId=null,ue(),$n()}),(g=document.getElementById("btn-change-game"))==null||g.addEventListener("click",()=>{v.phase="tier",v.result=null,v.txHash=null,v.gameId=null,ue(),$n()}),(x=document.getElementById("btn-share"))==null||x.addEventListener("click",()=>{Gm(l,d)})}function jm(){const e=document.createElement("div");e.className="confetti-container",document.body.appendChild(e);const t=["#f59e0b","#10b981","#8b5cf6","#ec4899","#06b6d4"],a=["â—","â– ","â˜…","ðŸ¯","ðŸŽ‰"];for(let n=0;n<60;n++){const s=document.createElement("div");s.className="confetti",s.style.cssText=`
            left: ${Math.random()*100}%;
            color: ${t[n%t.length]};
            font-size: ${8+Math.random()*12}px;
            animation-delay: ${Math.random()*2}s;
            animation-duration: ${2+Math.random()*2}s;
        `,s.textContent=a[n%a.length],e.appendChild(s)}setTimeout(()=>e.remove(),5e3)}function Wm(){const e=["ðŸª™","ðŸ’°","âœ¨","â­","ðŸŽ‰"];for(let t=0;t<30;t++)setTimeout(()=>{const a=document.createElement("div");a.className="coin",a.textContent=e[Math.floor(Math.random()*e.length)],a.style.left=`${Math.random()*100}%`,a.style.animationDelay=`${Math.random()*.5}s`,a.style.animationDuration=`${2+Math.random()*2}s`,document.body.appendChild(a),setTimeout(()=>a.remove(),4e3)},t*100)}function Gm(e,t){var l,d,u,p,m,g;const a=Wi[Sa],n=()=>{const x=Em[Sa];return e?x.win(t):x.lose},s=`
        <div class="text-center">
            <span class="text-4xl block mb-2">ðŸŽ°</span>
            <h3 id="share-modal-title" class="text-lg font-bold text-white">${a.title}</h3>
            <p id="share-modal-subtitle" class="text-amber-400 text-sm font-medium mb-3">${a.subtitle}</p>

            <!-- Language Selector -->
            <div class="flex justify-center gap-2 mb-4">
                ${["pt","en","es"].map(x=>`
                    <button class="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Sa===x?"bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50":"bg-zinc-800 border-zinc-700 hover:border-zinc-500"} border" data-lang="${x}">
                        <img src="${Tm[x]}" class="w-5 h-5 rounded-full object-cover" alt="${x.toUpperCase()}">
                        <span class="${Sa===x?"text-amber-400":"text-zinc-400"}">${x.toUpperCase()}</span>
                    </button>
                `).join("")}
            </div>

            <!-- Share Buttons -->
            <div class="grid grid-cols-5 gap-2 mb-4">
                <button id="share-twitter" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 rounded-xl transition-all">
                    <i class="fa-brands fa-x-twitter text-lg text-white mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Twitter</span>
                </button>
                <button id="share-telegram" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#0088cc]/20 border border-zinc-700 hover:border-[#0088cc]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-telegram text-lg text-[#0088cc] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Telegram</span>
                </button>
                <button id="share-whatsapp" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#25D366]/20 border border-zinc-700 hover:border-[#25D366]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-whatsapp text-lg text-[#25D366] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">WhatsApp</span>
                </button>
                <button id="share-instagram" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#E4405F]/20 border border-zinc-700 hover:border-[#E4405F]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-instagram text-lg text-[#E4405F] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Instagram</span>
                </button>
                <button id="share-copy" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 rounded-xl transition-all">
                    <i class="fa-solid fa-copy text-lg text-zinc-400 mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Copy</span>
                </button>
            </div>

            <button id="btn-close-share" class="text-zinc-500 hover:text-zinc-300 text-xs">${a.later}</button>
        </div>
    `;Tn(s,"max-w-xs");const r=x=>{Sa=x;const h=Wi[x],C=document.getElementById("share-modal-title"),T=document.getElementById("share-modal-subtitle"),A=document.getElementById("btn-close-share");C&&(C.textContent=h.title),T&&(T.textContent=h.subtitle),A&&(A.textContent=h.later),document.querySelectorAll(".lang-btn").forEach(B=>{const z=B.dataset.lang,S=B.querySelector("span");z===x?(B.className="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50 border",S&&(S.className="text-amber-400")):(B.className="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all bg-zinc-800 border-zinc-700 hover:border-zinc-500 border",S&&(S.className="text-zinc-400"))})};document.querySelectorAll(".lang-btn").forEach(x=>{x.addEventListener("click",()=>r(x.dataset.lang))});const i=async x=>{if(!c.userAddress)return!1;try{const C=await(await fetch("https://us-central1-backchain-backand.cloudfunctions.net/trackShare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:c.userAddress,gameId:v.gameId||Date.now(),type:"fortune",platform:x})})).json();return C.success?(b(`+${C.pointsAwarded||pa} Airdrop Points!`,"success"),!0):!1}catch{return b(`+${pa} Airdrop Points!`,"success"),!0}},o=async(x,h)=>{await i(x),window.open(h,"_blank"),Ye()};(l=document.getElementById("share-twitter"))==null||l.addEventListener("click",()=>{o("twitter",`https://twitter.com/intent/tweet?text=${encodeURIComponent(n())}`)}),(d=document.getElementById("share-telegram"))==null||d.addEventListener("click",()=>{o("telegram",`https://t.me/share/url?url=https://backcoin.org&text=${encodeURIComponent(n())}`)}),(u=document.getElementById("share-whatsapp"))==null||u.addEventListener("click",()=>{o("whatsapp",`https://wa.me/?text=${encodeURIComponent(n())}`)}),(p=document.getElementById("share-instagram"))==null||p.addEventListener("click",async()=>{const x=n();try{await navigator.clipboard.writeText(x),await i("instagram"),Ye(),setTimeout(()=>{var C,T;Tn(`
                    <div class="text-center p-2">
                        <i class="fa-brands fa-instagram text-4xl text-[#E4405F] mb-3"></i>
                        <h3 class="text-lg font-bold text-white mb-2">Text Copied!</h3>
                        <p class="text-zinc-400 text-sm mb-4">Now paste it in your Instagram story or post!</p>
                        <button id="btn-open-ig" class="w-full py-3 bg-gradient-to-r from-[#833AB4] via-[#E4405F] to-[#FCAF45] text-white font-bold rounded-xl mb-2">
                            <i class="fa-brands fa-instagram mr-2"></i>Open Instagram
                        </button>
                        <button id="btn-close-ig" class="text-zinc-500 hover:text-zinc-300 text-xs">Close</button>
                    </div>
                `,"max-w-xs"),(C=document.getElementById("btn-open-ig"))==null||C.addEventListener("click",()=>{window.open("https://www.instagram.com/backcoin.bkc/","_blank"),Ye()}),(T=document.getElementById("btn-close-ig"))==null||T.addEventListener("click",Ye)},100)}catch{b("Could not copy text","error"),Ye()}}),(m=document.getElementById("share-copy"))==null||m.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n()),b("Copied!","success"),await i("copy")}catch{b("Copy failed","error")}Ye()}),(g=document.getElementById("btn-close-share"))==null||g.addEventListener("click",Ye)}async function Ym(){const e=c.fortunePoolContract||c.fortunePoolContractPublic;if(!e)return null;try{const[t,a,n]=await Promise.all([e.prizePool().catch(()=>0n),e.gameCounter().catch(()=>0),e.TIER_COUNT().catch(()=>3)]),s=window.ethers;let r=0n,i=0n,o=0n;try{const d=[s.id("FORTUNE_TIER0"),s.id("FORTUNE_TIER1"),s.id("FORTUNE_TIER2")];r=await te(d[0]),i=0n;for(const u of d)i+=await te(u);o=r,console.log(`Service fees: single=${Number(r)/1e18} ETH, all=${Number(i)/1e18} ETH`)}catch(d){console.log("calculateFeeClientSide failed:",d.message)}v.serviceFee=o,v.serviceFee1x=r,v.serviceFee5x=i;try{const d=await e.REVEAL_DELAY();v.commitment.revealDelay=Number(d)||5}catch{}try{const[d,u,p]=await e.getAllTiers();v.tiersData=d.map((m,g)=>({range:Number(m),multiplier:Number(u[g])/1e4,winChance:Number(p[g])/1e4}))}catch{}let l=0n;try{const d=await e.getPoolStats();l=d.maxPayoutNow||d[6]||0n}catch{}return{prizePool:t||0n,gameCounter:Number(a)||0,serviceFee:o,serviceFee1x:r,serviceFee5x:i,tierCount:Number(n)||3,maxPayout:l}}catch(t){return console.error("getFortunePoolStatus error:",t),{prizePool:0n,gameCounter:0,serviceFee:0n,maxPayout:0n}}}async function $n(){try{const e=await Ym();if(e){v.poolData=e;const a=document.getElementById("intro-prize");a&&v.phase==="intro"&&(a.textContent=O(e.prizePool||0n).toFixed(0)+" BKC")}O(c.currentUserBalance||0n)>0&&v.phase==="wager"&&!v._balanceLoaded&&(v._balanceLoaded=!0,ue()),Km()}catch(e){console.error("Pool error:",e)}}async function Km(){var e;try{const t=rt.fortuneGames||"https://getfortunegames-4wvdcuoouq-uc.a.run.app",a=c.userAddress?`${t}?player=${c.userAddress}&limit=15`:`${t}?limit=15`,s=await(await fetch(a)).json();if(((e=s.games)==null?void 0:e.length)>0){Vm(s.games);const r=s.games.filter(o=>o.isWin||o.prizeWon&&BigInt(o.prizeWon)>0n).length,i=document.getElementById("win-rate");i&&(i.textContent=`${r}/${s.games.length} wins`)}else{const r=document.getElementById("history-list");r&&(r.innerHTML=`
                <div class="p-6 text-center">
                    <span class="text-3xl block mb-2 opacity-30">ðŸŽ°</span>
                    <p class="text-zinc-500 text-sm">No games yet</p>
                    <p class="text-zinc-600 text-xs mt-1">Be the first to play!</p>
                </div>
            `)}}catch(t){console.error("loadHistory error:",t)}}function Vm(e){const t=document.getElementById("history-list");t&&(t.innerHTML=e.map(a=>{var x;const n=a.isWin||a.prizeWon&&BigInt(a.prizeWon)>0n,s=a.prizeWon?O(BigInt(a.prizeWon)):0,r=a.wagerAmount?O(BigInt(a.wagerAmount)):0,i=a.isCumulative,o=a.rolls||[],l=a.guesses||[],d=a.txHash||a.transactionHash,u=qm(a.timestamp||a.createdAt),p=a.player?`${a.player.slice(0,6)}...${a.player.slice(-4)}`:"???",m=c.userAddress&&((x=a.player)==null?void 0:x.toLowerCase())===c.userAddress.toLowerCase(),g=d?`${Ur}${d}`:null;return`
            <a href="${g||"#"}" target="${g?"_blank":"_self"}" rel="noopener"
               class="block p-3 rounded-xl mb-2 ${n?"bg-emerald-500/10 border border-emerald-500/30":"bg-zinc-800/30 border border-zinc-700/30"} transition-all hover:scale-[1.01] ${g?"cursor-pointer hover:border-zinc-500":""}"
               ${g?"":'onclick="return false;"'}>
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">${n?"ðŸ†":"ðŸŽ²"}</span>
                        <span class="text-xs ${m?"text-amber-400 font-bold":"text-zinc-500"}">${m?"You":p}</span>
                        <span class="text-[10px] px-2 py-0.5 rounded-full ${i?"bg-violet-500/20 text-violet-400":"bg-emerald-500/20 text-emerald-400"}">${i?"Combo":"Single"}</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <span class="text-[10px] text-zinc-600">${u}</span>
                        ${g?'<i class="fa-solid fa-external-link text-[8px] text-zinc-600"></i>':""}
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-zinc-500">Bet: ${r.toFixed(0)}</span>
                        <span class="text-zinc-700">â†’</span>
                        <span class="text-xs ${n?"text-emerald-400 font-bold":"text-zinc-500"}">
                            ${n?`+${s.toFixed(0)} BKC`:"No win"}
                        </span>
                    </div>
                    <div class="flex gap-1">
                        ${(i?fe:[fe[2]]).map((h,C)=>{const T=l[C],A=o[C];return`
                                <div class="w-6 h-6 rounded text-[10px] font-bold flex items-center justify-center ${T!==void 0&&A!==void 0&&Number(T)===Number(A)?"bg-emerald-500/30 text-emerald-400":"bg-zinc-700/50 text-zinc-500"}">
                                    ${A??"?"}
                                </div>
                            `}).join("")}
                    </div>
                </div>
            </a>
        `}).join(""))}function qm(e){if(!e)return"N/A";try{const t=Date.now();let a;if(typeof e=="number"?a=e>1e12?e:e*1e3:typeof e=="string"?a=new Date(e).getTime():e._seconds?a=e._seconds*1e3:e.seconds?a=e.seconds*1e3:a=new Date(e).getTime(),isNaN(a))return"N/A";const n=t-a;if(n<0)return"Just now";const s=Math.floor(n/6e4),r=Math.floor(n/36e5),i=Math.floor(n/864e5);return s<1?"Just now":s<60?`${s}m ago`:r<24?`${r}h ago`:i<7?`${i}d ago`:new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return"N/A"}}const Xm={render:Pm,cleanup:Bm},Jm=()=>{if(document.getElementById("about-styles-v4"))return;const e=document.createElement("style");e.id="about-styles-v4",e.innerHTML=`
        @keyframes pulse-hub {
            0%, 100% { box-shadow: 0 0 20px rgba(251,191,36,0.3), 0 0 40px rgba(251,191,36,0.1); }
            50% { box-shadow: 0 0 40px rgba(251,191,36,0.5), 0 0 80px rgba(251,191,36,0.2); }
        }
        
        @keyframes flow-down {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        
        @keyframes rotate-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes expand-ring {
            0% { transform: scale(0.8); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .ab-fade-up { animation: fade-in-up 0.6s ease-out forwards; }
        .ab-pulse-hub { animation: pulse-hub 3s ease-in-out infinite; }
        .ab-rotate { animation: rotate-slow 30s linear infinite; }
        
        .ab-section {
            background: linear-gradient(180deg, rgba(24,24,27,0.8) 0%, rgba(9,9,11,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.3);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .ab-card {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .ab-card:hover {
            border-color: rgba(251,191,36,0.4);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .ab-hub {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(251,191,36,0.2) 0%, rgba(9,9,11,1) 70%);
            border: 3px solid #f59e0b;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
        }
        
        .ab-spoke {
            position: relative;
            padding-left: 20px;
        }
        
        .ab-spoke::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 12px;
            height: 2px;
            background: linear-gradient(90deg, #f59e0b, transparent);
        }
        
        .ab-flow-line {
            position: relative;
            height: 40px;
            width: 2px;
            background: rgba(63,63,70,0.5);
            overflow: hidden;
        }
        
        .ab-flow-line::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(180deg, transparent, #f59e0b, transparent);
            animation: flow-down 1.5s linear infinite;
        }
        
        .ab-icon-box {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .ab-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .ab-gradient-text {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .ab-orbit-container {
            position: relative;
            width: 280px;
            height: 280px;
        }
        
        .ab-orbit-ring {
            position: absolute;
            border: 1px dashed rgba(251,191,36,0.3);
            border-radius: 50%;
        }
        
        .ab-orbit-item {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(24,24,27,0.9);
            border: 2px solid;
        }
    `,document.head.appendChild(e)};function Zm(){return`
        <div class="text-center mb-8 ab-fade-up">
            <div class="relative inline-block mb-6">
                <div class="absolute inset-0 bg-amber-500/20 rounded-full blur-2xl"></div>
                <img src="./assets/bkc_logo_3d.png" class="w-24 h-24 relative z-10" alt="Backcoin">
            </div>
            
            <h1 class="text-3xl md:text-4xl font-black text-white mb-3">
                The <span class="ab-gradient-text">Backcoin</span> Ecosystem
            </h1>
            
            <p class="text-zinc-400 text-sm max-w-lg mx-auto leading-relaxed mb-4">
                A decentralized economy built on <span class="text-amber-400 font-medium">perpetual growth</span>, 
                where every action creates value and rewards flow back to the community.
            </p>
            
            <div class="flex items-center justify-center gap-3 flex-wrap">
                <span class="ab-badge bg-amber-500/20 text-amber-400">
                    <i class="fa-solid fa-users mr-1"></i>Community-Owned
                </span>
                <span class="ab-badge bg-emerald-500/20 text-emerald-400">
                    <i class="fa-solid fa-infinity mr-1"></i>Self-Sustaining
                </span>
                <span class="ab-badge bg-purple-500/20 text-purple-400">
                    <i class="fa-solid fa-code mr-1"></i>Open Source
                </span>
            </div>
        </div>
    `}function Qm(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.1s">
            <div class="absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl"></div>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-sitemap text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Hub & Spoke Architecture</h2>
                    <p class="text-zinc-500 text-xs">Modular design for infinite scalability</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <!-- Explanation -->
                <div>
                    <p class="text-zinc-400 text-sm leading-relaxed mb-4">
                        Unlike monolithic systems, Backcoin uses a <strong class="text-white">modular architecture</strong>. 
                        The <span class="text-amber-400 font-medium">Hub</span> is the immutable core that manages 
                        fees, rewards, and economy rules. The <span class="text-emerald-400 font-medium">Spokes</span> 
                        are independent services that plug into the Hub.
                    </p>
                    
                    <div class="ab-card bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/30 mb-4">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-brain text-amber-400"></i>
                            <span class="text-white font-bold text-sm">The Hub (EcosystemManager)</span>
                        </div>
                        <ul class="text-zinc-400 text-xs space-y-1">
                            <li>â€¢ Manages all fee configurations</li>
                            <li>â€¢ Controls reward distribution (70/30)</li>
                            <li>â€¢ Handles booster discounts</li>
                            <li>â€¢ Immutable core rules</li>
                        </ul>
                    </div>
                    
                    <div class="ab-card bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border-emerald-500/30">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-puzzle-piece text-emerald-400"></i>
                            <span class="text-white font-bold text-sm">The Spokes (Services)</span>
                        </div>
                        <ul class="text-zinc-400 text-xs space-y-1">
                            <li>â€¢ Fortune Pool, Notary, NFT Market...</li>
                            <li>â€¢ Each spoke generates fees</li>
                            <li>â€¢ New spokes can be added anytime</li>
                            <li>â€¢ More spokes = More value</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Visual Diagram -->
                <div class="flex justify-center">
                    <div class="ab-orbit-container">
                        <!-- Orbit Rings -->
                        <div class="ab-orbit-ring ab-rotate" style="width: 100%; height: 100%; top: 0; left: 0;"></div>
                        <div class="ab-orbit-ring" style="width: 70%; height: 70%; top: 15%; left: 15%;"></div>
                        
                        <!-- Central Hub -->
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                            <div class="ab-hub ab-pulse-hub">
                                <i class="fa-solid fa-brain text-3xl text-amber-400 mb-1"></i>
                                <span class="text-[10px] font-bold text-white">HUB</span>
                            </div>
                        </div>
                        
                        <!-- Spoke Items -->
                        <div class="ab-orbit-item border-purple-500 bg-purple-500/10" style="top: 5%; left: 50%; transform: translateX(-50%);">
                            <i class="fa-solid fa-clover text-purple-400"></i>
                        </div>
                        <div class="ab-orbit-item border-cyan-500 bg-cyan-500/10" style="top: 50%; right: 5%; transform: translateY(-50%);">
                            <i class="fa-solid fa-stamp text-cyan-400"></i>
                        </div>
                        <div class="ab-orbit-item border-emerald-500 bg-emerald-500/10" style="bottom: 5%; left: 50%; transform: translateX(-50%);">
                            <i class="fa-solid fa-store text-emerald-400"></i>
                        </div>
                        <div class="ab-orbit-item border-blue-500 bg-blue-500/10" style="top: 50%; left: 5%; transform: translateY(-50%);">
                            <i class="fa-solid fa-lock text-blue-400"></i>
                        </div>
                        
                        <!-- Labels -->
                        <span class="absolute text-[9px] text-purple-400 font-medium" style="top: -5px; left: 50%; transform: translateX(-50%);">Fortune</span>
                        <span class="absolute text-[9px] text-cyan-400 font-medium" style="top: 50%; right: -10px; transform: translateY(-50%) rotate(90deg);">Notary</span>
                        <span class="absolute text-[9px] text-emerald-400 font-medium" style="bottom: -5px; left: 50%; transform: translateX(-50%);">Market</span>
                        <span class="absolute text-[9px] text-blue-400 font-medium" style="top: 50%; left: -15px; transform: translateY(-50%) rotate(-90deg);">Staking</span>
                    </div>
                </div>
            </div>
            
            <!-- Growth Promise -->
            <div class="mt-6 p-4 bg-zinc-900/50 rounded-xl border border-zinc-800">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-arrow-trend-up text-emerald-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">Perpetual Growth Model</p>
                        <p class="text-zinc-500 text-xs">
                            Every new spoke added to the ecosystem generates more fees, which means more rewards 
                            for stakers. The more the ecosystem grows, the more valuable your stake becomes.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `}function eg(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.2s">
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl"></div>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-emerald-500/20">
                    <i class="fa-solid fa-hammer text-emerald-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Mining by Purchase</h2>
                    <p class="text-zinc-500 text-xs">Proof-of-Purchase: Using = Mining</p>
                </div>
            </div>
            
            <p class="text-zinc-400 text-sm leading-relaxed mb-6">
                In Backcoin, <strong class="text-white">using the platform IS mining</strong>. When you buy an NFT Booster, 
                new BKC tokens are minted and distributed. This creates a self-sustaining economy where 
                activity generates real value.
            </p>
            
            <!-- Mining Flow -->
            <div class="ab-card mb-6">
                <p class="text-zinc-500 text-[10px] uppercase font-bold mb-4">How Mining Works</p>
                
                <div class="space-y-4">
                    <!-- Step 1 -->
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-blue-400 font-bold">1</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">You Buy an NFT Booster</p>
                            <p class="text-zinc-500 text-xs">From any liquidity pool (Crystal, Diamond, Gold...)</p>
                        </div>
                        <div class="ab-badge bg-blue-500/20 text-blue-400">
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <div class="ab-flow-line"></div>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-emerald-400 font-bold">2</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">New BKC Tokens Are Minted</p>
                            <p class="text-zinc-500 text-xs">Fresh tokens created from your purchase activity</p>
                        </div>
                        <div class="ab-badge bg-emerald-500/20 text-emerald-400">
                            <i class="fa-solid fa-coins"></i>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <div class="ab-flow-line"></div>
                    </div>
                    
                    <!-- Step 3 -->
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-purple-400 font-bold">3</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">Rewards Distributed</p>
                            <p class="text-zinc-500 text-xs">70% to stakers, 30% to treasury for development</p>
                        </div>
                        <div class="ab-badge bg-purple-500/20 text-purple-400">
                            <i class="fa-solid fa-gift"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Distribution Cards -->
            <div class="grid grid-cols-2 gap-4">
                <div class="ab-card text-center bg-gradient-to-br from-purple-500/10 to-violet-500/10 border-purple-500/30">
                    <div class="text-4xl font-black text-purple-400 mb-2">70%</div>
                    <p class="text-white font-bold text-sm">Staker Rewards</p>
                    <p class="text-zinc-500 text-[10px]">Distributed to all delegators based on pStake</p>
                </div>
                <div class="ab-card text-center bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border-blue-500/30">
                    <div class="text-4xl font-black text-blue-400 mb-2">30%</div>
                    <p class="text-white font-bold text-sm">Treasury</p>
                    <p class="text-zinc-500 text-[10px]">Funds development and ecosystem growth</p>
                </div>
            </div>
            
            <!-- Key Insight -->
            <div class="mt-4 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl">
                <div class="flex items-start gap-3">
                    <i class="fa-solid fa-lightbulb text-amber-400 mt-0.5"></i>
                    <div>
                        <p class="text-amber-400 font-bold text-sm">The Flywheel Effect</p>
                        <p class="text-zinc-400 text-xs">
                            More users buying NFTs â†’ More mining â†’ More rewards for stakers â†’ 
                            Higher APY attracts more stakers â†’ More demand for BKC â†’ Cycle repeats!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `}function tg(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.3s">
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-cyan-500/20">
                    <i class="fa-solid fa-arrows-split-up-and-left text-cyan-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Fee Distribution</h2>
                    <p class="text-zinc-500 text-xs">Every fee benefits the community</p>
                </div>
            </div>
            
            <p class="text-zinc-400 text-sm leading-relaxed mb-6">
                All platform fees are split between <span class="text-purple-400 font-medium">stakers</span> and 
                the <span class="text-blue-400 font-medium">treasury</span>. This means using the platform 
                directly rewards those who secure it.
            </p>
            
            <!-- Fee Sources -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-lock text-purple-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">Staking Fees</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Entry, unstake, claim</p>
                </div>
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-store text-emerald-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">NFT Trading</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Buy & sell taxes</p>
                </div>
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-clover text-green-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">Fortune Pool</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Game participation</p>
                </div>
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-stamp text-violet-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">Notarization</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Document fees</p>
                </div>
            </div>
            
            <!-- Flow Diagram -->
            <div class="ab-card bg-zinc-900/50">
                <div class="flex items-center justify-between">
                    <div class="text-center flex-1">
                        <div class="w-12 h-12 mx-auto rounded-full bg-amber-500/20 flex items-center justify-center mb-2">
                            <i class="fa-solid fa-coins text-amber-400"></i>
                        </div>
                        <p class="text-white text-xs font-medium">All Fees</p>
                        <p class="text-zinc-600 text-[10px]">100%</p>
                    </div>
                    
                    <div class="flex-1 flex flex-col items-center">
                        <div class="w-full h-0.5 bg-gradient-to-r from-amber-500 via-zinc-600 to-purple-500"></div>
                        <i class="fa-solid fa-arrow-right text-zinc-600 my-2"></i>
                    </div>
                    
                    <div class="flex-1 space-y-2">
                        <div class="flex items-center gap-2 p-2 bg-purple-500/10 rounded-lg">
                            <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-users text-purple-400 text-xs"></i>
                            </div>
                            <div>
                                <p class="text-purple-400 text-xs font-bold">70%</p>
                                <p class="text-zinc-500 text-[10px]">Stakers</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-blue-500/10 rounded-lg">
                            <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-building-columns text-blue-400 text-xs"></i>
                            </div>
                            <div>
                                <p class="text-blue-400 text-xs font-bold">30%</p>
                                <p class="text-zinc-500 text-[10px]">Treasury</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `}function ag(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.4s">
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-violet-500/20">
                    <i class="fa-solid fa-rocket text-violet-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Infinite Growth Potential</h2>
                    <p class="text-zinc-500 text-xs">The ecosystem expands forever</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Current Spokes -->
                <div class="ab-card">
                    <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3">Current Spokes</p>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">Staking & Delegation</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">NFT Marketplace</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">Fortune Pool (Lottery)</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">Decentralized Notary</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">NFT Rental (AirBNFT)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Future Spokes -->
                <div class="ab-card">
                    <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3">Future Possibilities</p>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">Prediction Markets</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">Lending Protocol</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">DAO Governance</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">Launchpad</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-zinc-700/30 rounded-lg border border-dashed border-zinc-600">
                            <i class="fa-solid fa-plus text-zinc-500"></i>
                            <span class="text-zinc-500 text-xs">Your Idea Here...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Open for Developers -->
            <div class="ab-card bg-gradient-to-r from-violet-500/10 to-purple-500/10 border-violet-500/30">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-12 h-12 rounded-xl bg-violet-500/20 flex items-center justify-center">
                        <i class="fa-solid fa-code text-violet-400 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold">Open for Developers</p>
                        <p class="text-zinc-500 text-xs">Build your own spoke and earn from it</p>
                    </div>
                </div>
                <p class="text-zinc-400 text-xs leading-relaxed">
                    Anyone can propose and build new spokes for the Backcoin ecosystem. 
                    Your spoke generates fees, which benefit both you and all stakers. 
                    The more useful your service, the more the entire ecosystem grows.
                </p>
            </div>
        </div>
    `}function ng(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.5s">
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-star text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Why Backcoin?</h2>
                    <p class="text-zinc-500 text-xs">What makes us different</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="ab-card text-center">
                    <div class="text-4xl mb-3">ðŸ›ï¸</div>
                    <h3 class="text-white font-bold mb-2">No VCs, No Pre-mine</h3>
                    <p class="text-zinc-500 text-xs">
                        35% of TGE goes directly to the community via airdrop. 
                        No investors dumping on you.
                    </p>
                </div>
                
                <div class="ab-card text-center">
                    <div class="text-4xl mb-3">âš¡</div>
                    <h3 class="text-white font-bold mb-2">Real Utility</h3>
                    <p class="text-zinc-500 text-xs">
                        Not just another token. Notarize documents, play games, 
                        rent NFTs - actual use cases.
                    </p>
                </div>
                
                <div class="ab-card text-center">
                    <div class="text-4xl mb-3">â™¾ï¸</div>
                    <h3 class="text-white font-bold mb-2">Sustainable APY</h3>
                    <p class="text-zinc-500 text-xs">
                        Rewards come from real fees, not inflation. 
                        The more the ecosystem is used, the higher the APY.
                    </p>
                </div>
            </div>
        </div>
    `}function sg(){return`
        <div class="ab-section ab-fade-up text-center bg-gradient-to-b from-amber-500/5 to-transparent" style="animation-delay: 0.6s">
            <img src="./assets/bkc_logo_3d.png" class="w-16 h-16 mx-auto mb-4 opacity-80" alt="BKC">
            
            <h2 class="text-2xl font-bold text-white mb-2">Ready to Join?</h2>
            <p class="text-zinc-400 text-sm mb-6 max-w-md mx-auto">
                Start earning airdrop points today. Every action counts towards the upcoming distribution.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <button onclick="window.navigateTo && window.navigateTo('staking')" 
                    class="px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl hover:scale-105 transition-transform">
                    <i class="fa-solid fa-lock mr-2"></i>Start Staking
                </button>
                <button id="openWhitepaperBtn" 
                    class="px-6 py-3 bg-zinc-800 text-white font-bold rounded-xl border border-zinc-700 hover:border-amber-500/50 transition-colors">
                    <i class="fa-solid fa-file-lines mr-2"></i>Read Whitepaper
                </button>
            </div>
        </div>
    `}function rg(){return`
        <div id="whitepaperModal" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
            <div class="ab-card bg-zinc-900 border-zinc-700 w-full max-w-md transform scale-95 transition-transform duration-300">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white">Documentation</h3>
                    <button id="closeWhitepaperBtn" class="text-zinc-500 hover:text-white transition-colors">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <a href="./assets/Backchain ($BKC) en V2.pdf" target="_blank" 
                        class="flex items-center gap-4 p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-amber-500/50 transition-all group">
                        <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-coins text-amber-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm group-hover:text-amber-400 transition-colors">Tokenomics Paper</p>
                            <p class="text-zinc-500 text-xs">Distribution & Economics</p>
                        </div>
                        <i class="fa-solid fa-download text-zinc-600 group-hover:text-white"></i>
                    </a>
                    
                    <a href="./assets/whitepaper_bkc_ecosystem_english.pdf" target="_blank" 
                        class="flex items-center gap-4 p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-cyan-500/50 transition-all group">
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-network-wired text-cyan-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm group-hover:text-cyan-400 transition-colors">Technical Whitepaper</p>
                            <p class="text-zinc-500 text-xs">Architecture & Smart Contracts</p>
                        </div>
                        <i class="fa-solid fa-download text-zinc-600 group-hover:text-white"></i>
                    </a>
                </div>
            </div>
        </div>
    `}function Ks(){const e=document.getElementById("openWhitepaperBtn"),t=document.getElementById("closeWhitepaperBtn"),a=document.getElementById("whitepaperModal");if(!a)return;const n=()=>{a.classList.remove("hidden"),setTimeout(()=>{a.classList.remove("opacity-0"),a.querySelector(".ab-card").classList.remove("scale-95"),a.querySelector(".ab-card").classList.add("scale-100")},10)},s=()=>{a.classList.add("opacity-0"),a.querySelector(".ab-card").classList.remove("scale-100"),a.querySelector(".ab-card").classList.add("scale-95"),setTimeout(()=>a.classList.add("hidden"),300)};e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",s),a==null||a.addEventListener("click",r=>{r.target===a&&s()})}function ig(){const e=document.getElementById("about");e&&(Jm(),e.innerHTML=`
        <div class="max-w-3xl mx-auto px-4 py-8 pb-24">
            ${Zm()}
            ${Qm()}
            ${eg()}
            ${tg()}
            ${ag()}
            ${ng()}
            ${sg()}
            ${rg()}
            
            <!-- Footer -->
            <div class="text-center py-6 text-zinc-600 text-xs">
                <p>Built by the community, for the community</p>
                <p class="mt-1">BACKCOIN Â© 2024-2025</p>
            </div>
        </div>
    `,Ks(),e.scrollIntoView({behavior:"smooth",block:"start"}))}const og={render:ig,init:Ks,update:Ks},Vs="#BKC #Backcoin #Airdrop",$d=2,Ld={faucet:{icon:"ðŸš°",label:"Claim Faucet",points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{icon:"ðŸ“Š",label:"Delegate BKC",points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{icon:"ðŸŽ°",label:"Play Fortune",points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{icon:"ðŸ›’",label:"Buy NFT",points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{icon:"ðŸ’°",label:"Sell NFT",points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{icon:"ðŸ·ï¸",label:"List for Rent",points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{icon:"â°",label:"Rent NFT",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{icon:"ðŸ“œ",label:"Notarize Doc",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{icon:"ðŸ’¸",label:"Claim Rewards",points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{icon:"â†©ï¸",label:"Unstake",points:500,maxCount:10,cooldownHours:0,enabled:!0}},lg={faucet:"faucet",delegation:"tokenomics",fortune:"fortune",buyNFT:"marketplace",sellNFT:"marketplace",listRental:"rentals",rentNFT:"rentals",notarize:"notary",claimReward:"tokenomics",unstake:"tokenomics"},Ke=[{name:"Diamond",icon:"ðŸ’Ž",ranks:"#1 â€“ #5",count:5,color:"cyan",burn:"0%",receive:"100%",gradient:"from-cyan-500/20 to-cyan-900/10",border:"border-cyan-500/30",text:"text-cyan-300",postsNeeded:0},{name:"Gold",icon:"ðŸ¥‡",ranks:"#6 â€“ #25",count:20,color:"yellow",burn:"10%",receive:"90%",gradient:"from-yellow-500/20 to-yellow-900/10",border:"border-yellow-500/30",text:"text-yellow-400",postsNeeded:0},{name:"Silver",icon:"ðŸ¥ˆ",ranks:"#26 â€“ #75",count:50,color:"gray",burn:"25%",receive:"75%",gradient:"from-gray-400/20 to-gray-800/10",border:"border-gray-400/30",text:"text-gray-300",postsNeeded:0},{name:"Bronze",icon:"ðŸ¥‰",ranks:"#76 â€“ #200",count:125,color:"amber",burn:"40%",receive:"60%",gradient:"from-amber-600/20 to-amber-900/10",border:"border-amber-600/30",text:"text-amber-500",postsNeeded:0}],Gr=200;function cg(e){if(!e||e<=0)return"Ready";const t=Math.floor(e/(1e3*60*60)),a=Math.floor(e%(1e3*60*60)/(1e3*60));return t>0?`${t}h ${a}m`:`${a}m`}function dg(e){return e>=100?10:e>=90?9:e>=80?8:e>=70?7:e>=60?6:e>=50?5:e>=40?4:e>=30?3:e>=20?2:1}let $={isConnected:!1,systemConfig:null,platformUsageConfig:null,basePoints:null,leaderboards:null,user:null,dailyTasks:[],userSubmissions:[],platformUsage:{},isBanned:!1,activeTab:"earn",activeRanking:"posts",historyExpanded:!1};function ug(){if(document.getElementById("airdrop-custom-styles"))return;const e=document.createElement("style");e.id="airdrop-custom-styles",e.textContent=`
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }

        @keyframes float-slow {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.02); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.2); }
            50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.4); }
        }

        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes fade-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-12px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes count-up {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes glow-pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .airdrop-float { animation: float 4s ease-in-out infinite; }
        .airdrop-float-slow { animation: float-slow 3s ease-in-out infinite; }
        .airdrop-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .airdrop-bounce { animation: bounce-gentle 2s ease-in-out infinite; }
        .airdrop-spin { animation: spin-slow 20s linear infinite; }
        .airdrop-fade-up { animation: fade-up 0.5s ease-out forwards; }
        .airdrop-pulse-ring { animation: pulse-ring 2s infinite; }
        .airdrop-slide-in { animation: slide-in 0.4s ease-out forwards; }
        .airdrop-glow { animation: glow-pulse 2s ease-in-out infinite; }

        .airdrop-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
            background-size: 200% 100%;
            animation: shimmer 2.5s infinite;
        }

        .airdrop-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .airdrop-card:hover {
            transform: translateY(-3px);
        }

        .airdrop-tab-active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-weight: 700;
        }

        .airdrop-gradient-text {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .social-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .social-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .social-btn:active {
            transform: scale(0.95);
        }

        .cta-mega {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cta-mega:hover {
            box-shadow: 0 12px 40px rgba(245, 158, 11, 0.35);
            transform: translateY(-2px);
        }

        .platform-action-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .platform-action-card:hover:not(.completed) { transform: translateY(-3px); border-color: #f59e0b; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .platform-action-card.completed { opacity: 0.5; cursor: default; }

        .progress-bar-bg { background: rgba(63, 63, 70, 0.5); }
        .progress-bar-fill {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .scroll-area::-webkit-scrollbar { width: 4px; }
        .scroll-area::-webkit-scrollbar-track { background: transparent; }
        .scroll-area::-webkit-scrollbar-thumb { background: rgba(113, 113, 122, 0.5); border-radius: 2px; }

        .tier-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .tier-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.03) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .tier-card:hover::before { opacity: 1; }
        .tier-card:hover { transform: translateY(-2px) scale(1.01); }

        .stat-value {
            animation: count-up 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .rank-badge {
            position: relative;
            overflow: hidden;
        }
        .rank-badge::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent);
            animation: spin-slow 8s linear infinite;
        }

        /* V6.0: Accordion */
        .accordion-chevron {
            transition: transform 0.3s ease;
        }
        .accordion-chevron.expanded {
            transform: rotate(180deg);
        }
        .accordion-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .accordion-body.expanded {
            max-height: 2000px;
        }

        /* V6.0: Notification badge */
        .notif-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            background: #ef4444;
            color: white;
            padding: 0 4px;
            animation: pulse-ring 2s infinite;
        }
    `,document.head.appendChild(e)}async function Pa(){var e;$.isConnected=c.isConnected,$.user=null,$.userSubmissions=[],$.platformUsage={},$.isBanned=!1;try{const t=await rr();if($.systemConfig=t.config,$.leaderboards=t.leaderboards,$.dailyTasks=t.dailyTasks||[],$.platformUsageConfig=t.platformUsageConfig||Ld,$.isConnected&&c.userAddress){const[a,n]=await Promise.all([Na(c.userAddress),xp()]);if($.user=a,$.userSubmissions=n,a&&a.isBanned){$.isBanned=!0;return}try{typeof Ti=="function"&&($.platformUsage=await Ti()||{})}catch(s){console.warn("Could not load platform usage:",s),$.platformUsage={}}$.dailyTasks.length>0&&($.dailyTasks=await Promise.all($.dailyTasks.map(async s=>{try{if(!s.id)return{...s,eligible:!1,timeLeftMs:0};const r=await qo(s.id,s.cooldownHours);return{...s,eligible:r.eligible,timeLeftMs:r.timeLeft}}catch{return{...s,eligible:!1,timeLeftMs:0}}})))}}catch(t){if(console.error("Airdrop Data Load Error:",t),t.code==="permission-denied"||(e=t.message)!=null&&e.includes("permission")){console.warn("Firebase permissions issue - user may need to connect wallet or sign in"),$.systemConfig=$.systemConfig||{},$.leaderboards=$.leaderboards||{top100ByPoints:[],top100ByPosts:[]},$.dailyTasks=$.dailyTasks||[];return}b("Error loading data. Please refresh.","error")}}function Yr(e){if(!$.user||!e||e.length===0)return null;const t=e.findIndex(a=>{var n,s;return((n=a.walletAddress)==null?void 0:n.toLowerCase())===((s=$.user.walletAddress)==null?void 0:s.toLowerCase())});return t>=0?t+1:null}function Kr(e){return e?e<=5?Ke[0]:e<=25?Ke[1]:e<=75?Ke[2]:e<=200?Ke[3]:null:null}function Rd(e){return e?e<=5?null:e<=25?{nextTier:Ke[0],postsNeeded:e-5}:e<=75?{nextTier:Ke[1],postsNeeded:e-25}:e<=200?{nextTier:Ke[2],postsNeeded:e-75}:{nextTier:Ke[3],postsNeeded:e-200}:{nextTier:Ke[3],postsNeeded:1}}function us(){const e=Date.now(),t=$d*60*60*1e3;return $.userSubmissions.filter(a=>["pending","auditing"].includes(a.status)&&a.submittedAt&&e-a.submittedAt.getTime()>=t)}function _d(){var l;const{user:e}=$,t=(e==null?void 0:e.totalPoints)||0,a=(e==null?void 0:e.approvedSubmissionsCount)||0,n=dg(a),s=((l=$.leaderboards)==null?void 0:l.top100ByPosts)||[],r=Yr(s),i=Kr(r),o=us().length;return`
        <div class="px-4 pt-4 md:pt-6 pb-2">
            <!-- Title Row -->
            <div class="flex items-center justify-between mb-3">
                <div>
                    <h1 class="text-lg md:text-2xl font-black text-white">Airdrop <span class="airdrop-gradient-text hidden md:inline">Campaign</span></h1>
                    <span class="text-[9px] md:text-xs text-zinc-500">${Gr} NFTs â€¢ 4 Tiers</span>
                </div>
                <a href="https://t.me/BackCoinorg" target="_blank"
                   class="flex items-center gap-1.5 bg-sky-500/10 hover:bg-sky-500/20 border border-sky-500/30 text-sky-400 px-3 py-1.5 rounded-full transition-all hover:scale-105 text-xs md:text-sm">
                    <i class="fa-brands fa-telegram"></i>
                    <span class="hidden md:inline font-bold">Community</span>
                </a>
            </div>

            ${$.isConnected?`
            <!-- Stats Row -->
            <div class="grid grid-cols-4 gap-2 md:gap-3 mb-3">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2 md:p-3 text-center">
                    <span class="text-sm md:text-xl font-bold text-amber-400 stat-value">${t.toLocaleString()}</span>
                    <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase tracking-wider">Points</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2 md:p-3 text-center">
                    <span class="text-sm md:text-xl font-bold text-green-400 stat-value">${a}</span>
                    <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase tracking-wider">Posts</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2 md:p-3 text-center">
                    <span class="text-sm md:text-xl font-bold text-purple-400 stat-value">${n.toFixed(1)}x</span>
                    <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase tracking-wider">Boost</p>
                </div>
                <div class="bg-zinc-900/80 border ${i?i.border:"border-zinc-800"} rounded-xl p-2 md:p-3 text-center relative overflow-hidden">
                    ${i?`
                        <div class="absolute inset-0 bg-gradient-to-br ${i.gradient} opacity-30"></div>
                        <span class="text-sm md:text-xl font-bold ${i.text} relative z-10">${i.icon} #${r}</span>
                        <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase relative z-10">${i.name}</p>
                    `:`
                        <span class="text-sm md:text-xl font-bold text-zinc-600">â€”</span>
                        <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase">Rank</p>
                    `}
                </div>
            </div>
            `:""}

            <!-- Navigation â€” 2 Tabs -->
            <div class="flex justify-center">
                <div class="bg-zinc-900/80 p-1 md:p-1.5 rounded-full border border-zinc-800 inline-flex gap-1 w-full md:w-auto">
                    <button data-target="earn"
                            class="nav-pill-btn flex-1 md:flex-none md:px-6 py-2.5 rounded-full text-xs md:text-sm font-bold transition-all flex items-center justify-center gap-1.5 relative
                                   ${$.activeTab==="earn"?"airdrop-tab-active shadow-lg shadow-amber-500/20":"text-zinc-400 hover:text-white hover:bg-zinc-800"}">
                        <i class="fa-solid fa-coins"></i> Earn
                        ${o>0?`<span class="notif-badge">${o}</span>`:""}
                    </button>
                    <button data-target="ranking"
                            class="nav-pill-btn flex-1 md:flex-none md:px-6 py-2.5 rounded-full text-xs md:text-sm font-bold transition-all flex items-center justify-center gap-1.5
                                   ${$.activeTab==="ranking"?"airdrop-tab-active shadow-lg shadow-amber-500/20":"text-zinc-400 hover:text-white hover:bg-zinc-800"}">
                        <i class="fa-solid fa-trophy"></i> Ranking
                    </button>
                </div>
            </div>
        </div>
    `}function Ki(){return $.isConnected?`
        <div class="px-4 space-y-4 airdrop-fade-up pb-24">
            ${pg()}
            ${fg()}
            ${mg()}
            ${gg()}
            ${bg()}
            ${xg()}
        </div>
    `:`
            <div class="text-center px-4 py-12 airdrop-fade-up">
                <div class="w-24 h-24 mx-auto mb-6 airdrop-float">
                    <img src="./assets/airdrop.png" alt="Connect" class="w-full h-full object-contain opacity-50">
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Connect Your Wallet</h3>
                <p class="text-zinc-500 text-sm max-w-xs mx-auto mb-4">Connect to start earning points and win NFT rewards.</p>

                <div class="max-w-xs mx-auto bg-zinc-900/60 border border-zinc-800 rounded-xl p-3">
                    <p class="text-zinc-500 text-[10px] uppercase tracking-wider mb-2">Win 1 of ${Gr} NFT Boosters</p>
                    <div class="flex justify-center gap-3 text-lg">
                        ${Ke.map(e=>`<span title="${e.name}">${e.icon}</span>`).join("")}
                    </div>
                </div>
            </div>
        `}function pg(){const e=us();return e.length===0?"":`
        <div class="bg-gradient-to-r from-green-900/30 to-zinc-900/80 border border-green-500/40 rounded-xl p-3 relative overflow-hidden">
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-green-500"></div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-bell text-green-400 airdrop-bounce"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">${e.length} post${e.length>1?"s":""} ready to verify!</p>
                        <p class="text-green-400/70 text-[10px]">Confirm to earn points</p>
                    </div>
                </div>
                <button id="action-required-btn" class="bg-green-600 hover:bg-green-500 text-white font-bold px-4 py-2 rounded-lg text-xs transition-all">
                    Review
                </button>
            </div>
        </div>
    `}function fg(){var r;const e=((r=$.leaderboards)==null?void 0:r.top100ByPosts)||[],t=Yr(e),a=Kr(t),n=Rd(t);if(!t)return`
            <div id="rank-snippet-btn" class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 flex items-center justify-between cursor-pointer hover:border-amber-500/30 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-amber-500/10 flex items-center justify-center">
                        <i class="fa-solid fa-arrow-up text-amber-400 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-zinc-300 text-sm font-medium">Start posting to join the ranking!</p>
                        <p class="text-zinc-500 text-[10px]">Top 200 earn exclusive NFT Boosters</p>
                    </div>
                </div>
                <i class="fa-solid fa-chevron-right text-zinc-600 text-xs"></i>
            </div>
        `;let s="";if(n){const i=t<=25?5:t<=75?25:t<=200?75:200,o=t<=25?25:t<=75?75:200;s=`
            <div class="flex-1 mx-3">
                <div class="progress-bar-bg h-1.5 rounded-full">
                    <div class="progress-bar-fill h-full rounded-full" style="width: ${Math.max(0,Math.min(100,(o-t)/(o-i)*100))}%"></div>
                </div>
                <p class="text-zinc-500 text-[9px] mt-0.5">${n.postsNeeded} more to ${n.nextTier.icon} ${n.nextTier.name}</p>
            </div>
        `}else s=`
            <div class="flex-1 mx-3">
                <div class="progress-bar-bg h-1.5 rounded-full">
                    <div class="progress-bar-fill h-full rounded-full" style="width: 100%"></div>
                </div>
                <p class="text-cyan-400/70 text-[9px] mt-0.5">Top tier reached!</p>
            </div>
        `;return`
        <div id="rank-snippet-btn" class="bg-zinc-900/80 border ${a.border} rounded-xl p-3 flex items-center cursor-pointer hover:border-amber-500/30 transition-colors relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r ${a.gradient} opacity-20"></div>
            <div class="flex items-center gap-2 relative z-10 shrink-0">
                <span class="text-lg">${a.icon}</span>
                <div>
                    <span class="${a.text} font-bold text-sm">#${t}</span>
                    <p class="text-zinc-500 text-[9px]">${a.name}</p>
                </div>
            </div>
            <div class="relative z-10 flex-1">${s}</div>
            <i class="fa-solid fa-chevron-right text-zinc-600 text-xs relative z-10 shrink-0"></i>
        </div>
    `}function mg(){const{user:e}=$,a=`https://backcoin.org/?ref=${(e==null?void 0:e.referralCode)||"CODE"}`;return`
        <div class="bg-zinc-900/80 border border-zinc-800 rounded-2xl overflow-hidden">
            <!-- Section Header -->
            <div class="px-4 pt-4 pb-2">
                <h2 class="text-sm font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-share-nodes text-amber-400"></i> Post & Earn
                </h2>
                <p class="text-zinc-500 text-[10px] mt-0.5">Share on social media to climb the ranking</p>
            </div>

            <!-- Zone A: Share -->
            <div class="px-4 pb-3">
                <div class="bg-black/40 p-2.5 rounded-lg border border-zinc-700/50 mb-2.5">
                    <p class="text-xs font-mono text-amber-400 break-all">${a}</p>
                    <p class="text-xs font-mono text-zinc-600 mt-0.5">${Vs}</p>
                </div>

                <div class="flex gap-2 items-center">
                    <button id="copy-viral-btn" class="cta-mega text-black font-bold py-2 px-4 rounded-xl text-xs flex items-center gap-1.5 shrink-0">
                        <i class="fa-solid fa-copy"></i> Copy
                    </button>
                    <div class="flex gap-1.5 flex-1 justify-end">
                        <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(a+" "+Vs)}" target="_blank"
                           class="social-btn w-9 h-9 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500 flex items-center justify-center">
                            <i class="fa-brands fa-x-twitter text-white text-sm"></i>
                        </a>
                        <a href="https://www.tiktok.com" target="_blank"
                           class="social-btn w-9 h-9 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500 flex items-center justify-center">
                            <i class="fa-brands fa-tiktok text-white text-sm"></i>
                        </a>
                        <a href="https://www.instagram.com" target="_blank"
                           class="social-btn w-9 h-9 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500 flex items-center justify-center">
                            <i class="fa-brands fa-instagram text-pink-400 text-sm"></i>
                        </a>
                        <a href="https://www.youtube.com" target="_blank"
                           class="social-btn w-9 h-9 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500 flex items-center justify-center">
                            <i class="fa-brands fa-youtube text-red-500 text-sm"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Divider -->
            <div class="border-t border-zinc-800 mx-4"></div>

            <!-- Zone B: Submit -->
            <div class="px-4 py-3">
                <p class="text-zinc-400 text-[10px] uppercase tracking-wider mb-2 flex items-center gap-1">
                    <i class="fa-solid fa-link text-[8px]"></i> Submit your post link
                </p>
                <div class="relative">
                    <input type="url" id="content-url-input"
                           placeholder="Paste your post URL here..."
                           class="w-full bg-black/50 border border-zinc-600 rounded-xl pl-3 pr-20 py-2.5 text-white text-sm focus:border-amber-500 focus:ring-1 focus:ring-amber-500 outline-none transition-all placeholder:text-zinc-600">
                    <button id="submit-content-btn"
                            class="absolute right-1.5 top-1.5 bottom-1.5 bg-green-600 hover:bg-green-500 text-white font-bold px-3 rounded-lg transition-all text-sm">
                        Submit
                    </button>
                </div>
                <p class="text-amber-400/60 text-[9px] mt-1.5 flex items-center gap-1">
                    <i class="fa-solid fa-exclamation-circle"></i> Post must be PUBLIC â€¢ 2h audit before earning
                </p>
            </div>
        </div>
    `}function gg(){var i;const e=$.platformUsageConfig||Ld,t=$.platformUsage||{};let a=0,n=0;Object.keys(e).forEach(o=>{var l;e[o].enabled!==!1&&e[o].maxCount&&(a+=e[o].maxCount,n+=Math.min(((l=t[o])==null?void 0:l.count)||0,e[o].maxCount))});const s=a>0?n/a*100:0;return`
        <div>
            <!-- Section Header + Progress -->
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-sm font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-gamepad text-purple-400"></i> Platform Quests
                </h2>
                <span class="text-cyan-400 text-[10px] font-bold">${(((i=$.user)==null?void 0:i.platformUsagePoints)||0).toLocaleString()} pts</span>
            </div>
            <div class="flex items-center gap-2 mb-3">
                <div class="progress-bar-bg h-1.5 rounded-full flex-1">
                    <div class="progress-bar-fill h-full rounded-full" style="width: ${s}%"></div>
                </div>
                <span class="text-amber-400 text-[10px] font-bold shrink-0">${n}/${a}</span>
            </div>

            <!-- Actions Grid -->
            <div class="grid grid-cols-2 gap-2" id="platform-actions-grid">
                ${Object.entries(e).filter(([o,l])=>l.enabled!==!1).map(([o,l])=>{const d=t[o]||{count:0},u=d.count>=l.maxCount,p=Math.max(0,l.maxCount-d.count),m=d.count/l.maxCount*100,g=lg[o]||"";return`
                        <div class="platform-action-card bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 ${u?"completed opacity-60":"cursor-pointer hover:border-amber-500/50 hover:bg-zinc-800/80"} transition-all"
                             data-platform-action="${o}"
                             data-target-page="${g}">
                            <div class="flex items-start justify-between mb-1.5">
                                <span class="text-lg">${l.icon}</span>
                                ${u?'<span class="text-green-400 text-xs"><i class="fa-solid fa-check-circle"></i></span>':`<span class="text-amber-400 text-[10px] font-bold">+${l.points}</span>`}
                            </div>
                            <p class="text-white text-xs font-medium mb-1">${l.label}</p>
                            <div class="flex items-center justify-between mb-1.5">
                                <span class="text-zinc-500 text-[10px]">${d.count}/${l.maxCount}</span>
                                ${!u&&p>0?`<span class="text-zinc-600 text-[10px]">${p} left</span>`:""}
                            </div>
                            <div class="progress-bar-bg h-1 rounded-full">
                                <div class="progress-bar-fill h-full rounded-full" style="width: ${m}%"></div>
                            </div>
                            ${!u&&g?`
                                <div class="mt-2 text-center">
                                    <span class="text-amber-400/70 text-[9px]"><i class="fa-solid fa-arrow-right mr-1"></i>Tap to go</span>
                                </div>
                            `:""}
                        </div>
                    `}).join("")}
            </div>
        </div>
    `}function bg(){const e=$.dailyTasks||[],t=e.filter(n=>n.eligible),a=e.filter(n=>!n.eligible&&n.timeLeftMs>0);return e.length===0?`
            <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-3 text-center">
                <p class="text-zinc-500 text-xs"><i class="fa-solid fa-bolt text-zinc-600 mr-1"></i>No daily bonuses available</p>
            </div>
        `:`
        <div>
            <h2 class="text-sm font-bold text-white flex items-center gap-2 mb-2">
                <i class="fa-solid fa-bolt text-yellow-400"></i> Daily Bonuses
            </h2>
            <div class="space-y-2">
                ${t.map(n=>`
                    <div class="task-card bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 cursor-pointer hover:border-amber-500/50 transition-colors"
                         data-id="${n.id}" data-url="${n.url||""}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-star text-yellow-400 text-xs"></i>
                                </div>
                                <div>
                                    <p class="text-white text-sm font-medium">${n.title}</p>
                                    ${n.description?`<p class="text-zinc-500 text-[10px]">${n.description}</p>`:""}
                                </div>
                            </div>
                            <span class="text-green-400 text-sm font-bold">+${Math.round(n.points)}</span>
                        </div>
                    </div>
                `).join("")}
                ${a.map(n=>`
                    <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-3 opacity-50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-clock text-zinc-500 text-xs"></i>
                                </div>
                                <p class="text-zinc-400 text-sm">${n.title}</p>
                            </div>
                            <span class="text-zinc-600 text-xs">${cg(n.timeLeftMs)}</span>
                        </div>
                    </div>
                `).join("")}
            </div>
        </div>
    `}function xg(){const{userSubmissions:e,user:t}=$,a=(t==null?void 0:t.approvedSubmissionsCount)||0,n=e.filter(o=>["pending","auditing"].includes(o.status)).length,s=e.filter(o=>o.status==="rejected").length,r=e.length;if(r===0)return"";const i=$.historyExpanded;return`
        <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl overflow-hidden">
            <!-- Accordion Header -->
            <button id="history-toggle-btn" class="w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-800/50 transition-colors">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-clock-rotate-left text-zinc-500 text-xs"></i>
                    <span class="text-zinc-300 text-sm font-medium">My Submissions</span>
                    <span class="text-zinc-600 text-[10px]">${r} total</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        ${a>0?`<span class="text-green-400 text-[10px]">${a} approved</span>`:""}
                        ${n>0?`<span class="text-amber-400 text-[10px]">${n} pending</span>`:""}
                        ${s>0?`<span class="text-red-400 text-[10px]">${s} rejected</span>`:""}
                    </div>
                    <i class="fa-solid fa-chevron-down text-zinc-500 text-xs accordion-chevron ${i?"expanded":""}"></i>
                </div>
            </button>

            <!-- Accordion Body -->
            <div class="accordion-body ${i?"expanded":""}">
                <div class="border-t border-zinc-800">
                    ${e.slice(0,10).map((o,l)=>{const d=l===Math.min(e.length,10)-1,u=["pending","auditing"].includes(o.status),p=o.status==="approved",m=o.status==="rejected";let g,x,h;p?(g='<i class="fa-solid fa-check-circle text-green-400"></i>',x="",h=""):m?(g='<i class="fa-solid fa-times-circle text-red-400"></i>',x="",h=""):(g='<i class="fa-solid fa-shield-halved text-amber-400 animate-pulse"></i>',x="bg-amber-900/10",h=`
                                <div class="mt-1.5 flex items-center gap-2 text-amber-400/80">
                                    <i class="fa-solid fa-magnifying-glass text-[10px] animate-pulse"></i>
                                    <span class="text-[10px] font-medium">Under security audit...</span>
                                </div>
                            `);const C=o.pointsAwarded?`+${o.pointsAwarded}`:"-",T=Date.now(),A=$d*60*60*1e3,B=u&&o.submittedAt&&T-o.submittedAt.getTime()>=A;return`
                            <div class="p-3 ${d?"":"border-b border-zinc-800"} ${x}">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3 overflow-hidden">
                                        ${g}
                                        <a href="${o.url}" target="_blank" class="text-zinc-400 text-xs truncate hover:text-blue-400 max-w-[180px] md:max-w-[300px]">${o.url}</a>
                                    </div>
                                    <div class="flex items-center gap-2 shrink-0">
                                        ${B?`
                                            <button data-action="confirm" data-id="${o.submissionId}"
                                                    class="action-btn bg-green-600 hover:bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded transition-colors">
                                                Verify
                                            </button>
                                        `:""}
                                        <span class="font-mono font-bold ${o.pointsAwarded?"text-green-400":"text-zinc-600"} text-sm">${C}</span>
                                    </div>
                                </div>
                                ${h}
                            </div>
                        `}).join("")}
                </div>
            </div>
        </div>
    `}function hg(){var h,C,T,A;const e=((h=$.leaderboards)==null?void 0:h.top100ByPosts)||[],t=((C=$.leaderboards)==null?void 0:C.top100ByPoints)||[],a=$.activeRanking||"posts",n=Yr(e),s=Kr(n),r=Rd(n),i=((T=$.user)==null?void 0:T.approvedSubmissionsCount)||0,o=((A=$.user)==null?void 0:A.totalPoints)||0;function l(B,z,S){var X,W;const I=$.user&&((X=B.walletAddress)==null?void 0:X.toLowerCase())===((W=$.user.walletAddress)==null?void 0:W.toLowerCase()),R=vg(z+1),D=I?S==="posts"?"bg-amber-500/10":"bg-green-500/10":"",q=S==="posts"?"text-amber-400":"text-green-400",H=S==="posts"?"text-white":"text-green-400",re=S==="posts"?"posts":"pts";return`
            <div class="flex items-center justify-between p-3 ${D} ${I?"":"hover:bg-zinc-800/50"} transition-colors ${I?"border-l-2 border-amber-500":""}">
                <div class="flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full ${R.bg} flex items-center justify-center text-xs font-bold shrink-0">${R.icon||z+1}</span>
                    <div class="flex flex-col">
                        <span class="font-mono text-xs ${I?q+" font-bold":"text-zinc-400"}">
                            ${bt(B.walletAddress)}${I?" (You)":""}
                        </span>
                        ${R.tierName?`<span class="text-[9px] ${R.tierTextColor}">${R.tierName}</span>`:""}
                    </div>
                </div>
                <span class="font-bold ${H} text-sm">${(B.value||0).toLocaleString()} <span class="text-zinc-500 text-xs">${re}</span></span>
            </div>
        `}const d=a==="posts"?"bg-gradient-to-r from-amber-500 to-orange-500 text-black shadow-lg shadow-amber-500/20":"bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700",u=a==="points"?"bg-gradient-to-r from-green-500 to-emerald-500 text-black shadow-lg shadow-green-500/20":"bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700",p=a==="posts"?"":"hidden",m=a==="points"?"":"hidden",g=e.length===0?'<p class="p-6 text-center text-zinc-500 text-sm">No data yet - be the first!</p>':e.slice(0,50).map((B,z)=>l(B,z,"posts")).join(""),x=t.length===0?'<p class="p-6 text-center text-zinc-500 text-sm">No data yet - be the first!</p>':t.slice(0,50).map((B,z)=>l(B,z,"points")).join("");return`
        <div class="px-4 airdrop-fade-up pb-24">

            <!-- Your Position Hero Card -->
            ${$.isConnected?`
            <div class="bg-gradient-to-br from-zinc-900 to-zinc-900 border ${s?s.border:"border-zinc-800"} rounded-2xl p-5 mb-5 relative overflow-hidden">
                ${s?`<div class="absolute inset-0 bg-gradient-to-br ${s.gradient} opacity-20"></div>`:""}

                ${s?`
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">${s.icon}</span>
                            <div>
                                <span class="${s.text} font-black text-2xl">#${n}</span>
                                <p class="text-zinc-400 text-xs">${s.name} Tier</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-amber-400 font-bold text-sm">${o.toLocaleString()} pts</p>
                            <p class="text-zinc-500 text-[10px]">${i} posts</p>
                        </div>
                    </div>
                    ${r?`
                    <div class="bg-black/30 rounded-lg p-2.5">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-zinc-400 text-[10px]">Next: ${r.nextTier.icon} ${r.nextTier.name}</span>
                            <span class="text-zinc-500 text-[10px]">${r.postsNeeded} positions away</span>
                        </div>
                        <div class="progress-bar-bg h-1.5 rounded-full">
                            <div class="progress-bar-fill h-full rounded-full" style="width: ${Math.max(10,100-r.postsNeeded*2)}%"></div>
                        </div>
                    </div>
                    `:`
                    <div class="bg-cyan-500/10 rounded-lg p-2.5 text-center">
                        <span class="text-cyan-300 text-xs font-medium">You're at the top! Keep it up!</span>
                    </div>
                    `}
                </div>
                `:`
                <div class="text-center py-4 relative z-10">
                    <div class="w-12 h-12 mx-auto mb-3 opacity-30">
                        <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                    </div>
                    <p class="text-zinc-400 text-sm font-medium">Submit your first post to join the leaderboard</p>
                    <p class="text-zinc-600 text-xs mt-1">Top 200 earn exclusive NFT Boosters</p>
                </div>
                `}
            </div>
            `:""}

            <!-- NFT Tier Legend -->
            <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 mb-5">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs font-bold text-zinc-400 uppercase tracking-wider flex items-center gap-1.5">
                        <i class="fa-solid fa-gem text-amber-500 text-[10px]"></i> NFT Reward Tiers
                    </h3>
                    <span class="text-[10px] text-zinc-600">${Gr} NFTs</span>
                </div>
                <div class="space-y-2">
                    ${Ke.map(B=>`
                        <div class="tier-card flex items-center justify-between p-2.5 rounded-lg bg-gradient-to-r ${B.gradient} border ${B.border}">
                            <div class="flex items-center gap-2.5">
                                <span class="text-lg">${B.icon}</span>
                                <div>
                                    <span class="${B.text} font-bold text-xs">${B.name}</span>
                                    <div class="text-zinc-500 text-[10px]">${B.count} NFTs</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-white font-bold text-xs">${B.ranks}</span>
                                <div class="flex items-center gap-1">
                                    <span class="text-green-400/80 text-[10px]">${B.burn} burn</span>
                                    <span class="text-zinc-600 text-[10px]">â€¢</span>
                                    <span class="text-green-400 text-[10px] font-medium">${B.receive} rewards</span>
                                </div>
                            </div>
                        </div>
                    `).join("")}
                </div>
                <p class="text-amber-400/60 text-[10px] mt-3 flex items-center gap-1">
                    <i class="fa-solid fa-info-circle"></i>
                    NFT Boosters reduce token burn when claiming mining rewards
                </p>
            </div>

            <!-- Ranking Toggle Tabs -->
            <div class="flex gap-2 mb-4">
                <button data-ranking="posts" class="ranking-tab-btn flex-1 py-2.5 px-4 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${d}">
                    <i class="fa-solid fa-share-nodes"></i> By Posts
                </button>
                <button data-ranking="points" class="ranking-tab-btn flex-1 py-2.5 px-4 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${u}">
                    <i class="fa-solid fa-star"></i> By Points
                </button>
            </div>

            <!-- Posts Ranking -->
            <div id="ranking-posts" class="${p}">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                        <h3 class="font-bold text-white text-sm flex items-center gap-2">
                            <i class="fa-solid fa-crown text-yellow-500"></i> Top Content Creators
                        </h3>
                        <span class="text-zinc-500 text-xs">${e.length} creators</span>
                    </div>
                    <div class="divide-y divide-zinc-800/50 max-h-[400px] overflow-y-auto scroll-area">
                        ${g}
                    </div>
                </div>
            </div>

            <!-- Points Ranking -->
            <div id="ranking-points" class="${m}">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                        <h3 class="font-bold text-white text-sm flex items-center gap-2">
                            <i class="fa-solid fa-star text-green-500"></i> Top Points Earners
                        </h3>
                        <span class="text-zinc-500 text-xs">${t.length} earners</span>
                    </div>
                    <div class="divide-y divide-zinc-800/50 max-h-[400px] overflow-y-auto scroll-area">
                        ${x}
                    </div>
                </div>
            </div>
        </div>
    `}function vg(e){return e<=5?{icon:"ðŸ’Ž",bg:"bg-cyan-500/20 text-cyan-300",tierName:"Diamond",tierTextColor:"text-cyan-400/70"}:e<=25?{icon:"ðŸ¥‡",bg:"bg-yellow-500/20 text-yellow-400",tierName:"Gold",tierTextColor:"text-yellow-400/70"}:e<=75?{icon:"ðŸ¥ˆ",bg:"bg-gray-400/20 text-gray-300",tierName:"Silver",tierTextColor:"text-gray-400/70"}:e<=200?{icon:"ðŸ¥‰",bg:"bg-amber-600/20 text-amber-500",tierName:"Bronze",tierTextColor:"text-amber-500/70"}:{icon:null,bg:"bg-zinc-800 text-zinc-400",tierName:null,tierTextColor:""}}function ft(){const e=document.getElementById("main-content"),t=document.getElementById("airdrop-header");if(e){if(t&&(t.innerHTML=_d()),$.isBanned){e.innerHTML=`
            <div class="px-4 py-12 text-center">
                <i class="fa-solid fa-ban text-red-500 text-4xl mb-4"></i>
                <h2 class="text-red-500 font-bold text-xl mb-2">Account Suspended</h2>
                <p class="text-zinc-400 text-sm">Contact support on Telegram.</p>
            </div>
        `;return}switch($.activeTab){case"earn":e.innerHTML=Ki();break;case"ranking":e.innerHTML=hg();break;default:e.innerHTML=Ki()}}}function wg(){var a;const e=((a=$.user)==null?void 0:a.referralCode)||"CODE",t=`${e!=="CODE"?`https://backcoin.org/?ref=${e}`:"https://backcoin.org"} ${Vs}`;navigator.clipboard.writeText(t).then(()=>{b("Copied! Now paste it in your post.","success");const n=document.getElementById("copy-viral-btn");if(n){const s=n.innerHTML;n.innerHTML='<i class="fa-solid fa-check"></i> Copied!',n.classList.remove("cta-mega"),n.classList.add("bg-green-600"),setTimeout(()=>{n.innerHTML=s,n.classList.add("cta-mega"),n.classList.remove("bg-green-600")},2e3)}}).catch(()=>b("Failed to copy.","error"))}function Vi(e){const t=e.target.closest(".nav-pill-btn");t&&($.activeTab=t.dataset.target,ft())}function yg(e){const t=e.target.closest(".ranking-tab-btn");t&&t.dataset.ranking&&($.activeRanking=t.dataset.ranking,ft())}function kg(){$.historyExpanded=!$.historyExpanded;const e=document.querySelector(".accordion-chevron"),t=document.querySelector(".accordion-body");e&&e.classList.toggle("expanded"),t&&t.classList.toggle("expanded")}function Vr(e){var s;const t=`
        <div class="text-center">
            <div class="w-32 h-32 mx-auto mb-4">
                <img src="./assets/caution.png" alt="Caution" class="w-full h-full object-contain">
            </div>

            <h3 class="text-xl font-bold text-red-400 mb-2">FINAL VERIFICATION</h3>

            <div class="bg-red-900/30 border border-red-500/50 rounded-xl p-4 mb-4">
                <p class="text-red-300 text-sm font-bold mb-2">
                    <i class="fa-solid fa-shield-halved mr-1"></i>
                    All posts are AUDITED
                </p>
                <p class="text-zinc-400 text-xs leading-relaxed">
                    Our security team reviews every submission.
                    <span class="text-red-400 font-bold">Fake or fraudulent links will result in PERMANENT BAN</span>
                    from the airdrop campaign.
                </p>
            </div>

            <div class="bg-zinc-800/80 border border-zinc-700 rounded-xl p-3 mb-4">
                <p class="text-zinc-500 text-[10px] uppercase mb-1">Post being verified:</p>
                <a href="${e.url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm truncate block">${e.url}</a>
            </div>

            <label class="flex items-start gap-3 text-left bg-zinc-900/80 border border-zinc-700 rounded-xl p-3 mb-4 cursor-pointer hover:border-amber-500/50 transition-colors">
                <input type="checkbox" id="confirmCheckbox" class="mt-1 w-4 h-4 accent-amber-500">
                <span class="text-xs text-zinc-300">
                    I confirm this is <span class="text-white font-bold">my authentic public post</span> and I understand that
                    <span class="text-red-400 font-bold">submitting fake content will result in permanent ban</span>.
                </span>
            </label>

            <div class="flex gap-3">
                <button id="deletePostBtn" data-submission-id="${e.submissionId}"
                        class="flex-1 bg-red-900/50 hover:bg-red-800 text-red-300 hover:text-white py-3 rounded-xl font-medium text-sm transition-colors border border-red-500/30">
                    <i class="fa-solid fa-trash mr-1"></i> Delete Post
                </button>
                <button id="finalConfirmBtn" data-submission-id="${e.submissionId}"
                        class="flex-1 bg-green-600/50 text-green-200 py-3 rounded-xl font-bold text-sm cursor-not-allowed transition-colors"
                        disabled>
                    <i class="fa-solid fa-lock mr-1"></i> Confirm & Earn
                </button>
            </div>

            <p class="text-zinc-600 text-[10px] mt-4">
                <i class="fa-solid fa-info-circle mr-1"></i>
                By confirming, you agree to our audit process and anti-fraud policies.
            </p>
        </div>
    `;Tn(t,"max-w-md"),(s=document.getElementById("deletePostBtn"))==null||s.addEventListener("click",async r=>{const i=r.currentTarget,o=i.dataset.submissionId;i.disabled=!0,i.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-1"></i> Deleting...';try{await Xo(o),b("Post deleted. No penalty applied.","info"),Ye(),await Pa(),ft()}catch(l){b(l.message,"error"),i.disabled=!1,i.innerHTML='<i class="fa-solid fa-trash mr-1"></i> Delete Post'}});const a=document.getElementById("confirmCheckbox"),n=document.getElementById("finalConfirmBtn");a==null||a.addEventListener("change",()=>{a.checked?(n.disabled=!1,n.className="flex-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold text-sm transition-colors cursor-pointer",n.innerHTML='<i class="fa-solid fa-check mr-1"></i> Confirm & Earn'):(n.disabled=!0,n.className="flex-1 bg-green-600/50 text-green-200 py-3 rounded-xl font-bold text-sm cursor-not-allowed transition-colors",n.innerHTML='<i class="fa-solid fa-lock mr-1"></i> Confirm & Earn')}),n==null||n.addEventListener("click",Eg)}async function Eg(e){const t=e.currentTarget,a=t.dataset.submissionId;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Verifying...';try{await hp(a),b("Success! Points added.","success"),Ye(),await Pa(),ft()}catch{b("Verification failed.","error"),t.disabled=!1,t.innerHTML="Try Again"}}async function Tg(e){const t=e.target.closest(".action-btn");if(!t)return;const a=t.dataset.action,n=t.dataset.id;if(a==="confirm"){const s=$.userSubmissions.find(r=>r.submissionId===n);s&&Vr(s)}else if(a==="delete"){if(!confirm("Remove this submission?"))return;try{await Xo(n),b("Removed.","info"),await Pa(),ft()}catch(s){b(s.message,"error")}}}async function Cg(e){const t=e.target.closest("#submit-content-btn");if(!t)return;const a=document.getElementById("content-url-input"),n=a==null?void 0:a.value.trim();if(!n||!n.startsWith("http"))return b("Enter a valid URL.","warning");const s=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>';try{await bp(n),b("Submitted! Your post is now under security audit.","info"),a.value="",await Pa(),$.historyExpanded=!0,ft(),setTimeout(()=>{var r;(r=document.getElementById("history-toggle-btn"))==null||r.scrollIntoView({behavior:"smooth",block:"center"})},300)}catch(r){b(r.message,"error")}finally{t.disabled=!1,t.innerHTML=s}}async function Ig(e){const t=e.target.closest(".task-card");if(!t)return;const a=t.dataset.id,n=t.dataset.url;n&&window.open(n,"_blank");const s=$.dailyTasks.find(r=>r.id===a);if(!(!s||!s.eligible))try{await mp(s,$.user.pointsMultiplier),b(`Task completed! +${s.points} pts`,"success"),await Pa(),ft()}catch(r){r.message.includes("Cooldown")||b(r.message,"error")}}function Ag(){const e=us();e.length>0&&setTimeout(()=>{Vr(e[0])},500)}function Pg(){const e=us();e.length>0&&Vr(e[0])}const Bg={async render(e){const t=document.getElementById("airdrop");if(t){ug(),(t.innerHTML.trim()===""||e)&&(t.innerHTML=`
                <div id="loading-state" class="fixed inset-0 z-50 bg-gradient-to-b from-zinc-900 via-zinc-900 to-black flex flex-col items-center justify-center px-6">
                    <div class="text-center">
                        <div class="w-20 h-20 mx-auto mb-4 airdrop-float-slow">
                            <img src="./assets/airdrop.png" alt="Airdrop" class="w-full h-full object-contain drop-shadow-2xl">
                        </div>
                        <p class="text-zinc-400 text-sm mb-4">Loading your campaign...</p>
                        <div class="flex items-center justify-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0s;"></div>
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0.1s;"></div>
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0.2s;"></div>
                        </div>
                    </div>
                </div>

                <div id="airdrop-main" class="hidden">
                    <div id="airdrop-header">${_d()}</div>
                    <div id="airdrop-body" class="max-w-2xl mx-auto pb-24">
                        <div id="main-content"></div>
                    </div>
                </div>
            `,this.attachListeners());try{const a=new Promise(i=>setTimeout(i,1500));await Promise.all([Pa(),a]);const n=document.getElementById("loading-state"),s=document.getElementById("airdrop-main"),r=document.getElementById("main-content");n&&(n.style.transition="opacity 0.5s ease-out",n.style.opacity="0",await new Promise(i=>setTimeout(i,500)),n.classList.add("hidden")),s&&s.classList.remove("hidden"),r&&(r.classList.remove("hidden"),ft()),Ag()}catch(a){console.error(a)}}},attachListeners(){const e=document.getElementById("airdrop-body"),t=document.getElementById("airdrop-header");t==null||t.addEventListener("click",Vi),e==null||e.addEventListener("click",a=>{a.target.closest("#submit-content-btn")&&Cg(a),a.target.closest(".task-card")&&Ig(a),a.target.closest(".action-btn")&&Tg(a),a.target.closest("#copy-viral-btn")&&wg(),a.target.closest(".ranking-tab-btn")&&yg(a),a.target.closest(".nav-pill-btn")&&Vi(a),a.target.closest("#history-toggle-btn")&&kg(),a.target.closest("#action-required-btn")&&Pg(),a.target.closest("#rank-snippet-btn")&&($.activeTab="ranking",ft());const n=a.target.closest(".platform-action-card");if(n&&!n.classList.contains("completed")){const s=n.dataset.targetPage;s&&Sg(s)}})},update(e){$.isConnected!==e&&this.render(!0)}};function Sg(e){const t=document.querySelector(`a[data-target="${e}"]`)||document.querySelector(`[data-target="${e}"]`);if(t){t.click();const s=document.getElementById("sidebar");s&&window.innerWidth<768&&s.classList.add("hidden");return}const a=document.querySelectorAll("main > section"),n=document.getElementById(e);if(n){a.forEach(r=>r.classList.add("hidden")),n.classList.remove("hidden"),document.querySelectorAll(".sidebar-link").forEach(r=>{r.classList.remove("active","bg-zinc-700","text-white"),r.classList.add("text-zinc-400")});const s=document.querySelector(`[data-target="${e}"]`);s&&(s.classList.add("active","bg-zinc-700","text-white"),s.classList.remove("text-zinc-400"));return}console.warn("Could not navigate to:",e)}const Fd=window.ethers,Ln="".toLowerCase(),zg="",Md="bkc_admin_auth_v3";window.__ADMIN_WALLET__=Ln;setTimeout(()=>{document.dispatchEvent(new CustomEvent("adminConfigReady")),console.log("âœ… Admin config ready, wallet:",Ln?"configured":"not set")},100);function qi(){return sessionStorage.getItem(Md)==="true"}function Ng(){sessionStorage.setItem(Md,"true")}function $g(){return!c.isConnected||!c.userAddress||!Ln?!1:c.userAddress.toLowerCase()===Ln}const Xi={pending:{text:"Pending Review",color:"text-amber-400",bgColor:"bg-amber-900/50",icon:"fa-clock"},auditing:{text:"Auditing",color:"text-blue-400",bgColor:"bg-blue-900/50",icon:"fa-magnifying-glass"},approved:{text:"Approved",color:"text-green-400",bgColor:"bg-green-900/50",icon:"fa-check-circle"},rejected:{text:"Rejected",color:"text-red-400",bgColor:"bg-red-900/50",icon:"fa-times-circle"},flagged_suspicious:{text:"Flagged",color:"text-red-300",bgColor:"bg-red-800/60",icon:"fa-flag"}},ps={faucet:{icon:"ðŸš°",label:"Claim Faucet",points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{icon:"ðŸ“Š",label:"Delegate BKC",points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{icon:"ðŸŽ°",label:"Play Fortune",points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{icon:"ðŸ›’",label:"Buy NFT",points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{icon:"ðŸ’°",label:"Sell NFT",points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{icon:"ðŸ·ï¸",label:"List for Rent",points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{icon:"â°",label:"Rent NFT",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{icon:"ðŸ“œ",label:"Notarize Doc",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{icon:"ðŸ’¸",label:"Claim Rewards",points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{icon:"â†©ï¸",label:"Unstake",points:500,maxCount:10,cooldownHours:0,enabled:!0}};let P={allSubmissions:[],dailyTasks:[],ugcBasePoints:null,platformUsageConfig:null,editingTask:null,activeTab:"review-submissions",allUsers:[],selectedUserSubmissions:[],isSubmissionsModalOpen:!1,selectedWallet:null,usersFilter:"all",usersSearch:"",usersPage:1,usersPerPage:100,submissionsPage:1,submissionsPerPage:100,tasksPage:1,tasksPerPage:100};const _a=async()=>{var t;const e=document.getElementById("admin-content-wrapper");if(e){const a=document.createElement("div");e.innerHTML=a.innerHTML}try{c.userAddress&&(await Vo(c.userAddress),console.log("âœ… Firebase Auth: Admin authenticated"));const[a,n,s,r]=await Promise.all([Ep(),wp(),rr(),Tp()]);P.allSubmissions=a,P.dailyTasks=n,P.allUsers=r,P.ugcBasePoints=((t=s.config)==null?void 0:t.ugcBasePoints)||{YouTube:5e3,"YouTube Shorts":2500,Instagram:3e3,"X/Twitter":1500,Facebook:2e3,Telegram:1e3,TikTok:3500,Reddit:1800,LinkedIn:2200,Other:1e3},P.platformUsageConfig=s.platformUsageConfig||ps,P.editingTask&&(P.editingTask=n.find(i=>i.id===P.editingTask.id)||null),t0()}catch(a){if(console.error("Error loading admin data:",a),e){const n=document.createElement("div");jp(n,`Failed to load admin data: ${a.message}`),e.innerHTML=n.innerHTML}else b("Failed to load admin data.","error")}},qr=async()=>{const e=document.getElementById("presale-balance-amount");if(e){e.innerHTML='<span class="loader !w-5 !h-5 inline-block"></span>';try{if(!c.signer||!c.signer.provider)throw new Error("Admin provider not found.");if(!y.publicSale)throw new Error("PublicSale address not configured.");const t=await c.signer.provider.getBalance(y.publicSale),a=Fd.formatEther(t);e.textContent=`${parseFloat(a).toFixed(6)} ETH/BNB`}catch(t){console.error("Error loading presale balance:",t),e.textContent="Error"}}},Lg=async e=>{if(!c.signer){b("Por favor, conecte a carteira do Owner primeiro.","error");return}if(!window.confirm("Are you sure you want to withdraw ALL funds from the Presale contract to the Treasury wallet?"))return;const t=["function withdrawFunds() external"],a=y.publicSale,n=new Fd.Contract(a,t,c.signer),s=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-2"></i> Withdrawing...';try{console.log(`Calling withdrawFunds() on ${a}...`);const r=await n.withdrawFunds();b("Transaction sent. Awaiting confirmation...","info");const i=await r.wait();console.log("Funds withdrawn successfully!",i.hash),b("Funds withdrawn successfully!","success",i.hash),qr()}catch(r){console.error("Error withdrawing funds:",r);const i=r.reason||r.message||"Transaction failed.";b(`Error: ${i}`,"error")}finally{e.disabled=!1,e.innerHTML=s}},Rg=async e=>{const t=e.target.closest("button[data-action]");if(!t||t.disabled)return;const a=t.dataset.action,n=t.dataset.submissionId,s=t.dataset.userId;if(!a||!n||!s){console.warn("Missing data attributes for admin action:",t.dataset);return}const r=t.closest("tr"),i=t.closest("td").querySelectorAll("button");r?(r.style.opacity="0.5",r.style.pointerEvents="none"):i.forEach(o=>o.disabled=!0);try{(a==="approved"||a==="rejected")&&(await Jo(s,n,a),b(`Submission ${a==="approved"?"APPROVED":"REJECTED"}!`,"success"),P.allSubmissions=P.allSubmissions.filter(o=>o.submissionId!==n),Rn())}catch(o){b(`Failed to ${a} submission: ${o.message}`,"error"),console.error(o),r&&(r.style.opacity="1",r.style.pointerEvents="auto")}},_g=async e=>{const t=e.target.closest(".ban-user-btn");if(!t||t.disabled)return;const a=t.dataset.userId,n=t.dataset.action==="ban";if(!a)return;const s=n?`Are you sure you want to PERMANENTLY BAN this user?
(This is reversible)`:`Are you sure you want to UNBAN this user?
(This will reset their rejection count to 0)`;if(!window.confirm(s))return;const r=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>';try{await Zo(a,n),b(`User ${n?"BANNED":"UNBANNED"}.`,"success");const i=P.allUsers.findIndex(o=>o.id===a);i>-1&&(P.allUsers[i].isBanned=n,P.allUsers[i].hasPendingAppeal=!1,n===!1&&(P.allUsers[i].rejectedCount=0)),Bt()}catch(i){b(`Failed: ${i.message}`,"error"),t.disabled=!1,t.innerHTML=r}},Fg=async e=>{const t=e.target.closest(".resolve-appeal-btn");if(!t||t.disabled)return;const a=t.dataset.userId,s=t.dataset.action==="approve";if(!a)return;const r=s?"Are you sure you want to APPROVE this appeal and UNBAN the user?":"Are you sure you want to DENY this appeal? The user will remain banned.";if(!window.confirm(r))return;const i=t.closest("td").querySelectorAll("button"),o=new Map;i.forEach(l=>{o.set(l,l.innerHTML),l.disabled=!0,l.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>'});try{s&&await Zo(a,!1),b(`Appeal ${s?"APPROVED":"DENIED"}.`,"success");const l=P.allUsers.findIndex(d=>d.id===a);l>-1&&(P.allUsers[l].hasPendingAppeal=!1,s&&(P.allUsers[l].isBanned=!1,P.allUsers[l].rejectedCount=0)),Bt()}catch(l){b(`Failed: ${l.message}`,"error"),i.forEach(d=>{d.disabled=!1,d.innerHTML=o.get(d)})}},Mg=async e=>{const t=e.target.closest(".re-approve-btn");if(!t||t.disabled)return;const a=t.dataset.submissionId,n=t.dataset.userId;if(!a||!n)return;const s=t.closest("tr");s&&(s.style.opacity="0.5"),t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>';try{await Jo(n,a,"approved"),b("Submission re-approved!","success"),P.selectedUserSubmissions=P.selectedUserSubmissions.filter(i=>i.submissionId!==a),s&&s.remove();const r=P.allUsers.findIndex(i=>i.id===n);if(r>-1){const i=P.allUsers[r];i.rejectedCount=Math.max(0,(i.rejectedCount||0)-1),Bt()}if(P.selectedUserSubmissions.length===0){const i=document.querySelector("#admin-user-modal .p-6");i&&(i.innerHTML='<p class="text-zinc-400 text-center p-8">This user has no rejected submissions.</p>')}}catch(r){b(`Failed to re-approve: ${r.message}`,"error"),s&&(s.style.opacity="1"),t.disabled=!1,t.innerHTML='<i class="fa-solid fa-check"></i> Re-Approve'}},Dg=async e=>{const t=e.target.closest(".view-rejected-btn");if(!t||t.disabled)return;const a=t.dataset.userId,n=t.dataset.wallet;if(a){P.selectedWallet=n,P.isSubmissionsModalOpen=!0,As(!0,[]);try{const s=await Cp(a,"rejected");P.selectedUserSubmissions=s,As(!1,s)}catch(s){b(`Error fetching user submissions: ${s.message}`,"error"),As(!1,[],!0)}}},Og=()=>{P.isSubmissionsModalOpen=!1,P.selectedUserSubmissions=[],P.selectedWallet=null;const e=document.getElementById("admin-user-modal");e&&e.remove(),document.body.style.overflow="auto"},Hg=e=>{const t=e.target.closest(".user-profile-link");if(!t)return;e.preventDefault();const a=t.dataset.userId;if(!a)return;const n=P.allUsers.find(s=>s.id===a);if(!n){b("Error: Could not find user data.","error");return}Kg(n)},Ug=()=>{const e=document.getElementById("admin-user-profile-modal");e&&e.remove(),document.body.style.overflow="auto"},jg=async e=>{e.preventDefault();const t=e.target;let a,n;try{if(a=new Date(t.startDate.value+"T00:00:00Z"),n=new Date(t.endDate.value+"T23:59:59Z"),isNaN(a.getTime())||isNaN(n.getTime()))throw new Error("Invalid date format.");if(a>=n)throw new Error("Start Date must be before End Date.")}catch(l){b(l.message,"error");return}const s={title:t.title.value.trim(),url:t.url.value.trim(),description:t.description.value.trim(),points:parseInt(t.points.value,10),cooldownHours:parseInt(t.cooldown.value,10),startDate:a,endDate:n};if(!s.title||!s.description){b("Please fill in Title and Description.","error");return}if(s.points<=0||s.cooldownHours<=0){b("Points and Cooldown must be positive numbers.","error");return}if(s.url&&!s.url.startsWith("http")){b("URL must start with http:// or https://","error");return}P.editingTask&&P.editingTask.id&&(s.id=P.editingTask.id);const r=t.querySelector('button[type="submit"]'),i=r.innerHTML;r.disabled=!0;const o=document.createElement("span");o.classList.add("inline-block"),r.innerHTML="",r.appendChild(o);try{await yp(s),b(`Task ${s.id?"updated":"created"} successfully!`,"success"),t.reset(),P.editingTask=null,_a()}catch(l){b(`Failed to save task: ${l.message}`,"error"),console.error(l),r.disabled=!1,r.innerHTML=i}},Wg=async e=>{e.preventDefault();const t=e.target,a={YouTube:parseInt(t.youtubePoints.value,10),"YouTube Shorts":parseInt(t.youtubeShortsPoints.value,10),Instagram:parseInt(t.instagramPoints.value,10),"X/Twitter":parseInt(t.xTwitterPoints.value,10),Facebook:parseInt(t.facebookPoints.value,10),Telegram:parseInt(t.telegramPoints.value,10),TikTok:parseInt(t.tiktokPoints.value,10),Reddit:parseInt(t.redditPoints.value,10),LinkedIn:parseInt(t.linkedinPoints.value,10),Other:parseInt(t.otherPoints.value,10)};if(Object.values(a).some(i=>isNaN(i)||i<0)){b("All points must be positive numbers (or 0).","error");return}const n=t.querySelector('button[type="submit"]'),s=n.innerHTML;n.disabled=!0;const r=document.createElement("span");r.classList.add("inline-block"),n.innerHTML="",n.appendChild(r);try{await vp(a),b("UGC Base Points updated successfully!","success"),P.ugcBasePoints=a}catch(i){b(`Failed to update points: ${i.message}`,"error"),console.error(i)}finally{document.body.contains(n)&&(n.disabled=!1,n.innerHTML=s)}},Gg=e=>{const t=P.dailyTasks.find(a=>a.id===e);t&&(P.editingTask=t,ja())},Yg=async e=>{if(window.confirm("Are you sure you want to delete this task permanently?"))try{await kp(e),b("Task deleted.","success"),P.editingTask=null,_a()}catch(t){b(`Failed to delete task: ${t.message}`,"error"),console.error(t)}};function As(e,t,a=!1){var i,o;const n=document.getElementById("admin-user-modal");n&&n.remove(),document.body.style.overflow="hidden";let s="";e?s='<div class="p-8"></div>':a?s='<p class="text-red-400 text-center p-8">Failed to load submissions.</p>':t.length===0?s='<p class="text-zinc-400 text-center p-8">This user has no rejected submissions.</p>':s=`
             <table class="w-full text-left min-w-[600px]">
                 <thead>
                     <tr class="border-b border-border-color text-xs text-zinc-400 uppercase">
                         <th class="p-3">Link</th>
                         <th class="p-3">Resolved</th>
                         <th class="p-3 text-right">Actions</th>
                     </tr>
                 </thead>
                 <tbody id="modal-submissions-tbody">
                     ${t.map(l=>`
                         <tr class="border-b border-border-color hover:bg-zinc-800/50">
                             <td class="p-3 text-sm max-w-xs truncate" title="${l.url}">
                                 <a href="${l.url}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">${l.url}</a>
                             </td>
                             <td class="p-3 text-xs">${l.resolvedAt?l.resolvedAt.toLocaleString("en-US"):"N/A"}</td>
                             <td class="p-3 text-right">
                                 <button data-user-id="${l.userId}" 
                                         data-submission-id="${l.submissionId}" 
                                         class="re-approve-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                                     <i class="fa-solid fa-check"></i> Re-Approve
                                 </button>
                             </td>
                         </tr>
                     `).join("")}
                 </tbody>
             </table>
         `;const r=`
         <div id="admin-user-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" style="backdrop-filter: blur(5px);">
             <div class="bg-sidebar border border-border-color rounded-xl shadow-lg w-full max-w-3xl max-h-[90vh] flex flex-col">
                 <div class="p-5 border-b border-border-color flex justify-between items-center">
                     <h2 class="text-xl font-bold text-white">Rejected Posts for ${bt(P.selectedWallet)}</h2>
                     <button id="close-admin-modal-btn" class="text-zinc-400 hover:text-white text-2xl">&times;</button>
                 </div>
                 <div class="p-6 overflow-y-auto">
                     ${s}
                 </div>
             </div>
         </div>
     `;document.body.insertAdjacentHTML("beforeend",r),e&&document.getElementById("admin-user-modal").querySelector(".p-8"),(i=document.getElementById("close-admin-modal-btn"))==null||i.addEventListener("click",Og),(o=document.getElementById("modal-submissions-tbody"))==null||o.addEventListener("click",Mg)}function Kg(e){var s;const t=document.getElementById("admin-user-profile-modal");t&&t.remove(),document.body.style.overflow="hidden";const a=e.isBanned?'<span class="text-xs font-bold py-1 px-3 rounded-full bg-red-600 text-white">BANNED</span>':e.hasPendingAppeal?'<span class="text-xs font-bold py-1 px-3 rounded-full bg-yellow-600 text-white">APPEALING</span>':'<span class="text-xs font-bold py-1 px-3 rounded-full bg-green-600 text-white">ACTIVE</span>',n=`
         <div id="admin-user-profile-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" style="backdrop-filter: blur(5px);">
             <div class="bg-sidebar border border-border-color rounded-xl shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col">
                 <div class="p-5 border-b border-border-color flex justify-between items-center">
                     <h2 class="text-xl font-bold text-white">User Profile</h2>
                     <button id="close-admin-profile-modal-btn" class="text-zinc-400 hover:text-white text-2xl">&times;</button>
                 </div>
                 
                 <div class="p-6 overflow-y-auto space-y-4">
                    
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-zinc-100">${bt(e.walletAddress)}</h3>
                        ${a}
                    </div>

                    <div class="bg-main p-4 rounded-lg border border-border-color space-y-3">
                        <div class="flex flex-wrap justify-between gap-2">
                            <span class="text-sm text-zinc-400">Full Wallet:</span>
                            <span class="text-sm text-zinc-200 font-mono break-all">${e.walletAddress||"N/A"}</span>
                        </div>
                        <div class="flex flex-wrap justify-between gap-2">
                            <span class="text-sm text-zinc-400">User ID:</span>
                            <span class="text-sm text-zinc-200 font-mono break-all">${e.id||"N/A"}</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Total Points</span>
                            <span class="block text-2xl font-bold text-yellow-400">${(e.totalPoints||0).toLocaleString("en-US")}</span>
                        </div>
                        <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Approved</span>
                            <span class="block text-2xl font-bold text-green-400">${(e.approvedSubmissionsCount||0).toLocaleString("en-US")}</span>
                        </div>
                         <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Rejected</span>
                            <span class="block text-2xl font-bold text-red-400">${(e.rejectedCount||0).toLocaleString("en-US")}</span>
                        </div>
                    </div>

                    <div class="border-t border-border-color pt-4 text-right">
                        <p class="text-sm text-zinc-500 italic text-left">User actions (Ban, Unban, View Rejected) are available in the main table.</p>
                    </div>

                 </div>
             </div>
         </div>
     `;document.body.insertAdjacentHTML("beforeend",n),(s=document.getElementById("close-admin-profile-modal-btn"))==null||s.addEventListener("click",Ug)}const Vg=e=>{const t=e.target.closest(".user-filter-btn");!t||t.classList.contains("active")||(P.usersFilter=t.dataset.filter||"all",P.usersPage=1,Bt())},qg=e=>{P.usersSearch=e.target.value,P.usersPage=1,Bt()},Xg=e=>{P.usersPage=e,Bt()},Jg=e=>{P.submissionsPage=e,Rn()},Zg=e=>{P.tasksPage=e,ja()},Bt=()=>{var z,S;const e=document.getElementById("manage-users-content");if(!e)return;const t=P.allUsers;if(!t)return;const n=(P.usersSearch||"").toLowerCase().trim().replace(/[^a-z0-9x]/g,""),s=P.usersFilter;let r=t;n&&(r=r.filter(I=>{var R,D;return((R=I.walletAddress)==null?void 0:R.toLowerCase().includes(n))||((D=I.id)==null?void 0:D.toLowerCase().includes(n))})),s==="banned"?r=r.filter(I=>I.isBanned):s==="appealing"&&(r=r.filter(I=>I.hasPendingAppeal===!0));const i=t.length,o=t.filter(I=>I.isBanned).length,l=t.filter(I=>I.hasPendingAppeal===!0).length,d=r.sort((I,R)=>I.hasPendingAppeal!==R.hasPendingAppeal?I.hasPendingAppeal?-1:1:I.isBanned!==R.isBanned?I.isBanned?-1:1:(R.totalPoints||0)-(I.totalPoints||0)),u=P.usersPage,p=P.usersPerPage,m=d.length,g=Math.ceil(m/p),x=(u-1)*p,h=u*p,C=d.slice(x,h),T=C.length>0?C.map(I=>{let R="border-b border-border-color hover:bg-zinc-800/50",D="";return I.hasPendingAppeal?(R+=" bg-yellow-900/40",D='<span class="ml-2 text-xs font-bold text-yellow-300">[APPEALING]</span>'):I.isBanned&&(R+=" bg-red-900/30 opacity-70",D='<span class="ml-2 text-xs font-bold text-red-400">[BANNED]</span>'),`
        <tr class="${R}">
            <td class="p-3 text-xs text-zinc-300 font-mono" title="User ID: ${I.id}">
                <a href="#" class="user-profile-link font-bold text-blue-400 hover:underline" 
                   data-user-id="${I.id}" 
                   title="Click to view profile. Full Wallet: ${I.walletAddress||"N/A"}">
                    ${bt(I.walletAddress)}
                </a>
                ${D}
            </td>
            <td class="p-3 text-sm font-bold text-yellow-400">${(I.totalPoints||0).toLocaleString("en-US")}</td>
            <td class="p-3 text-sm font-bold ${I.rejectedCount>0?"text-red-400":"text-zinc-400"}">${I.rejectedCount||0}</td>
            <td class="p-3 text-right">
                <div class="flex items-center justify-end gap-2">
                    ${I.hasPendingAppeal?`<button data-user-id="${I.id}" data-action="approve" 
                                   class="resolve-appeal-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-check"></i> Approve
                           </button>
                           <button data-user-id="${I.id}" data-action="deny" 
                                   class="resolve-appeal-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-times"></i> Deny
                           </button>`:`<button data-user-id="${I.id}" data-wallet="${I.walletAddress}" 
                                   class="view-rejected-btn bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-eye"></i> View Rejected
                           </button>
                           ${I.isBanned?`<button data-user-id="${I.id}" data-action="unban" 
                                            class="ban-user-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                                       <i class="fa-solid fa-check"></i> Unban
                                   </button>`:`<button data-user-id="${I.id}" data-action="ban" 
                                            class="ban-user-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">
                                       <i class="fa-solid fa-ban"></i> Ban
                                   </button>`}`}
                </div>
            </td>
        </tr>
    `}).join(""):`
        <tr>
            <td colspan="4" class="p-8 text-center text-zinc-400">
                ${i===0?"No users found in Airdrop.":"No users match the current filters."}
            </td>
        </tr>
    `;e.innerHTML=`
        <h2 class="text-2xl font-bold mb-4">Manage Users (${i})</h2>
        
        <div class="mb-4 p-4 bg-zinc-800 rounded-xl border border-border-color flex flex-wrap gap-4 justify-between items-center">
            <div id="user-filters-nav" class="flex items-center gap-2">
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${s==="all"?"bg-blue-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="all">
                    All (${i})
                </button>
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${s==="banned"?"bg-red-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="banned">
                    Banned (${o})
                </button>
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${s==="appealing"?"bg-yellow-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="appealing">
                    Appealing (${l})
                </button>
            </div>
            <div class="relative flex-grow max-w-xs">
                <input type="text" id="user-search-input" class="form-input pl-10" placeholder="Search Wallet or User ID..." value="${P.usersSearch}">
                <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"></i>
            </div>
        </div>

        <div class="bg-zinc-800 rounded-xl border border-border-color overflow-x-auto">
            <table class="w-full text-left min-w-[700px]">
                <thead>
                    <tr class="bg-main border-b border-border-color text-xs text-zinc-400 uppercase">
                        <th class="p-3">Wallet / User ID</th>
                        <th class="p-3">Total Points</th>
                        <th class="p-3">Rejections</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-users-tbody">${T}</tbody>
            </table>
        </div>
        
        <div id="admin-users-pagination" class="mt-6"></div>
    `;const A=document.getElementById("admin-users-pagination");A&&g>1&&lr(A,P.usersPage,g,Xg),(z=document.getElementById("admin-users-tbody"))==null||z.addEventListener("click",I=>{I.target.closest(".user-profile-link")&&Hg(I),I.target.closest(".ban-user-btn")&&_g(I),I.target.closest(".view-rejected-btn")&&Dg(I),I.target.closest(".resolve-appeal-btn")&&Fg(I)}),(S=document.getElementById("user-filters-nav"))==null||S.addEventListener("click",Vg);const B=document.getElementById("user-search-input");if(B){let I;B.addEventListener("keyup",R=>{clearTimeout(I),I=setTimeout(()=>qg(R),300)})}},Ji=()=>{var n;const e=document.getElementById("manage-ugc-points-content");if(!e)return;const t=P.ugcBasePoints;if(!t)return;const a={YouTube:5e3,"YouTube Shorts":2500,Instagram:3e3,"X/Twitter":1500,Facebook:2e3,Telegram:1e3,TikTok:3500,Reddit:1800,LinkedIn:2200,Other:1e3};e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">Manage UGC Base Points</h2>
        <p class="text-sm text-zinc-400 mb-6 max-w-2xl mx-auto">
            Defina os pontos base concedidos para cada plataforma de divulgaÃ§Ã£o (UGC). 
            Este valor serÃ¡ "exportado" para a pÃ¡gina do airdrop e Ã© o valor usado 
            <strong>antes</strong> do multiplicador do usuÃ¡rio ser aplicado.
        </p>
        <form id="ugcPointsForm" class="bg-zinc-800 p-6 rounded-xl space-y-4 border border-border-color max-w-lg mx-auto">
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">YouTube:</label>
                    <input type="number" name="youtubePoints" class="form-input" value="${t.YouTube!==void 0?t.YouTube:a.YouTube}" required>
                </div>
                 <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">YouTube Shorts:</label>
                    <input type="number" name="youtubeShortsPoints" class="form-input" value="${t["YouTube Shorts"]!==void 0?t["YouTube Shorts"]:a["YouTube Shorts"]}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Instagram:</label>
                    <input type="number" name="instagramPoints" class="form-input" value="${t.Instagram!==void 0?t.Instagram:a.Instagram}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">TikTok:</label>
                    <input type="number" name="tiktokPoints" class="form-input" value="${t.TikTok!==void 0?t.TikTok:a.TikTok}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">X/Twitter:</label>
                    <input type="number" name="xTwitterPoints" class="form-input" value="${t["X/Twitter"]!==void 0?t["X/Twitter"]:a["X/Twitter"]}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Facebook:</label>
                    <input type="number" name="facebookPoints" class="form-input" value="${t.Facebook!==void 0?t.Facebook:a.Facebook}" required>
                </div>
            </div>

             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Reddit:</label>
                    <input type="number" name="redditPoints" class="form-input" value="${t.Reddit!==void 0?t.Reddit:a.Reddit}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">LinkedIn:</label>
                    <input type="number" name="linkedinPoints" class="form-input" value="${t.LinkedIn!==void 0?t.LinkedIn:a.LinkedIn}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                 <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Telegram:</label>
                    <input type="number" name="telegramPoints" class="form-input" value="${t.Telegram!==void 0?t.Telegram:a.Telegram}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Other Platform:</label>
                    <input type="number" name="otherPoints" class="form-input" value="${t.Other!==void 0?t.Other:a.Other}" required>
                </div>
            </div>
            
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-md transition-colors shadow-md mt-6">
                <i class="fa-solid fa-save mr-2"></i>Save Base Points
            </button>
        </form>
    `,(n=document.getElementById("ugcPointsForm"))==null||n.addEventListener("submit",Wg)},ja=()=>{var x,h,C;const e=document.getElementById("manage-tasks-content");if(!e)return;const t=P.editingTask,a=!!t,n=T=>{if(!T)return"";try{return(T.toDate?T.toDate():T instanceof Date?T:new Date(T)).toISOString().split("T")[0]}catch{return""}},s=P.tasksPage,r=P.tasksPerPage,i=[...P.dailyTasks].sort((T,A)=>{var S,I;const B=(S=T.startDate)!=null&&S.toDate?T.startDate.toDate():new Date(T.startDate||0);return((I=A.startDate)!=null&&I.toDate?A.startDate.toDate():new Date(A.startDate||0)).getTime()-B.getTime()}),o=i.length,l=Math.ceil(o/r),d=(s-1)*r,u=s*r,p=i.slice(d,u),m=p.length>0?p.map(T=>{var I,R;const A=new Date,B=(I=T.startDate)!=null&&I.toDate?T.startDate.toDate():T.startDate?new Date(T.startDate):null,z=(R=T.endDate)!=null&&R.toDate?T.endDate.toDate():T.endDate?new Date(T.endDate):null;let S="text-zinc-500";return B&&z&&(A>=B&&A<=z?S="text-green-400":A<B&&(S="text-blue-400")),`
        <div class="bg-zinc-800 p-4 rounded-lg border border-border-color flex justify-between items-center flex-wrap gap-3">
            <div class="flex-1 min-w-[250px]">
                <p class="font-semibold text-white">${T.title||"No Title"}</p>
                 <p class="text-xs text-zinc-400 mt-0.5">${T.description||"No Description"}</p>
                <p class="text-xs ${S} mt-1">
                   <span class="font-medium text-amber-400">${T.points||0} Pts</span> |
                   <span class="text-blue-400">${T.cooldownHours||0}h CD</span> |
                   Active: ${n(T.startDate)} to ${n(T.endDate)}
                </p>
                ${T.url?`<a href="${T.url}" target="_blank" rel="noopener noreferrer" class="text-xs text-blue-400 hover:underline break-all block mt-1">${T.url}</a>`:""}
            </div>
            <div class="flex gap-2 shrink-0">
                <button data-id="${T.id}" data-action="edit" class="edit-task-btn bg-amber-600 hover:bg-amber-700 text-black text-xs font-bold py-1 px-3 rounded-md transition-colors"><i class="fa-solid fa-pencil mr-1"></i>Edit</button>
                <button data-id="${T.id}" data-action="delete" class="delete-task-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-3 rounded-md transition-colors"><i class="fa-solid fa-trash mr-1"></i>Delete</button>
            </div>
        </div>
    `}).join(""):document.createElement("div").innerHTML;e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">${a?"Edit Daily Task":"Create New Daily Task"}</h2>

        <form id="taskForm" class="bg-zinc-800 p-6 rounded-xl space-y-4 border border-border-color">
            <input type="hidden" name="id" value="${(t==null?void 0:t.id)||""}">
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Task Title:</label><input type="text" name="title" class="form-input" value="${(t==null?void 0:t.title)||""}" required></div>
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Description:</label><input type="text" name="description" class="form-input" value="${(t==null?void 0:t.description)||""}" required></div>
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Link URL (Optional):</label><input type="url" name="url" class="form-input" value="${(t==null?void 0:t.url)||""}" placeholder="https://..."></div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Points (Base):</label><input type="number" name="points" class="form-input" value="${(t==null?void 0:t.points)||10}" min="1" required></div>
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Cooldown (Hours):</label><input type="number" name="cooldown" class="form-input" value="${(t==null?void 0:t.cooldownHours)||24}" min="1" required></div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Start Date (UTC):</label><input type="date" name="startDate" class="form-input" value="${n(t==null?void 0:t.startDate)}" required></div>
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">End Date (UTC):</label><input type="date" name="endDate" class="form-input" value="${n(t==null?void 0:t.endDate)}" required></div>
            </div>

            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-md transition-colors shadow-md">
                ${a?'<i class="fa-solid fa-save mr-2"></i>Save Changes':'<i class="fa-solid fa-plus mr-2"></i>Create Task'}
            </button>
            ${a?'<button type="button" id="cancelEditBtn" class="w-full mt-2 bg-zinc-600 hover:bg-zinc-700 text-white font-bold py-2 rounded-md transition-colors">Cancel Edit</button>':""}
        </form>

        <h3 class="text-xl font-bold mt-10 mb-4 border-t border-border-color pt-6">Existing Tasks (${o})</h3>
        <div id="existing-tasks-list" class="space-y-3">
            ${m}
        </div>
        <div id="admin-tasks-pagination" class="mt-6"></div>
    `;const g=document.getElementById("admin-tasks-pagination");g&&l>1&&lr(g,P.tasksPage,l,Zg),(x=document.getElementById("taskForm"))==null||x.addEventListener("submit",jg),(h=document.getElementById("cancelEditBtn"))==null||h.addEventListener("click",()=>{P.editingTask=null,ja()}),(C=document.getElementById("existing-tasks-list"))==null||C.addEventListener("click",T=>{const A=T.target.closest("button[data-id]");if(!A)return;const B=A.dataset.id;A.dataset.action==="edit"&&Gg(B),A.dataset.action==="delete"&&Yg(B)})},Rn=()=>{var p;const e=document.getElementById("submissions-content");if(!e)return;if(!P.allSubmissions||P.allSubmissions.length===0){const m=document.createElement("div");e.innerHTML=m.innerHTML;return}const t=P.submissionsPage,a=P.submissionsPerPage,n=[...P.allSubmissions].sort((m,g)=>{var x,h;return(((x=g.submittedAt)==null?void 0:x.getTime())||0)-(((h=m.submittedAt)==null?void 0:h.getTime())||0)}),s=n.length,r=Math.ceil(s/a),i=(t-1)*a,o=t*a,d=n.slice(i,o).map(m=>{var g,x;return`
        <tr class="border-b border-border-color hover:bg-zinc-800/50">
            <td class="p-3 text-xs text-zinc-400 font-mono" title="${m.userId}">${bt(m.walletAddress)}</td>
            <td class="p-3 text-sm max-w-xs truncate" title="${m.normalizedUrl}">
                <a href="${m.normalizedUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">${m.normalizedUrl}</a>
                <span class="block text-xs text-zinc-500">${m.platform||"N/A"} - ${m.basePoints||0} base pts</span>
            </td>
            <td class="p-3 text-xs text-zinc-400">${m.submittedAt?m.submittedAt.toLocaleString("en-US"):"N/A"}</td>
            <td class="p-3 text-xs font-semibold ${((g=Xi[m.status])==null?void 0:g.color)||"text-gray-500"}">${((x=Xi[m.status])==null?void 0:x.text)||m.status}</td>
            <td class="p-3 text-right">
                <div class="flex items-center justify-end gap-2">
                    
                    <button data-user-id="${m.userId}" data-submission-id="${m.submissionId}" data-action="approved" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded transition-colors"><i class="fa-solid fa-check"></i></button>
                    <button data-user-id="${m.userId}" data-submission-id="${m.submissionId}" data-action="rejected" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded transition-colors ml-1"><i class="fa-solid fa-times"></i></button>
                    </div>
            </td>
        </tr>
    `}).join("");e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">Review Pending Submissions (${n.length})</h2>
        <div class="bg-zinc-800 rounded-xl border border-border-color overflow-x-auto">
            <table class="w-full text-left min-w-[700px]">
                <thead>
                    <tr class="bg-main border-b border-border-color text-xs text-zinc-400 uppercase">
                        <th class="p-3 font-semibold">Wallet</th>
                        <th class="p-3 font-semibold">Link & Platform</th>
                        <th class="p-3 font-semibold">Submitted</th>
                        <th class="p-3 font-semibold">Status</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-submissions-tbody">${d}</tbody>
            </table>
        </div>
        <div id="admin-submissions-pagination" class="mt-6"></div>
    `;const u=document.getElementById("admin-submissions-pagination");u&&r>1&&lr(u,P.submissionsPage,r,Jg),(p=document.getElementById("admin-submissions-tbody"))==null||p.addEventListener("click",Rg)},_n=()=>{var r,i;const e=document.getElementById("platform-usage-content");if(!e)return;const t=P.platformUsageConfig||ps;let a=0;Object.values(t).forEach(o=>{o.enabled!==!1&&(a+=(o.points||0)*(o.maxCount||1))});const n=Object.entries(t).map(([o,l])=>`
        <tr class="border-b border-zinc-700/50 hover:bg-zinc-800/50" data-action-key="${o}">
            <td class="p-3">
                <div class="flex items-center gap-2">
                    <span class="text-xl">${l.icon||"âš¡"}</span>
                    <span class="text-white font-medium">${l.label||o}</span>
                </div>
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-20 text-amber-400 font-bold text-center" 
                       data-field="points" value="${l.points||0}" min="0" step="100">
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-16 text-white text-center" 
                       data-field="maxCount" value="${l.maxCount||1}" min="1" max="100">
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-16 text-white text-center" 
                       data-field="cooldownHours" value="${l.cooldownHours||0}" min="0" max="168">
            </td>
            <td class="p-3 text-center">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer platform-toggle" data-field="enabled" ${l.enabled!==!1?"checked":""}>
                    <div class="w-9 h-5 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600"></div>
                </label>
            </td>
            <td class="p-3 text-right text-xs text-zinc-400">
                ${((l.points||0)*(l.maxCount||1)).toLocaleString()}
            </td>
        </tr>
    `).join("");e.innerHTML=`
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-2">Platform Usage Points Configuration</h2>
            <p class="text-zinc-400 text-sm">Configure points awarded for using platform features. Changes are saved immediately.</p>
        </div>

        <!-- Stats Summary -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-amber-400">${Object.keys(t).length}</span>
                <p class="text-xs text-zinc-500 mt-1">Total Actions</p>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-green-400">${Object.values(t).filter(o=>o.enabled!==!1).length}</span>
                <p class="text-xs text-zinc-500 mt-1">Enabled</p>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-purple-400">${a.toLocaleString()}</span>
                <p class="text-xs text-zinc-500 mt-1">Max Points Possible</p>
            </div>
        </div>

        <!-- Actions Table -->
        <div class="bg-zinc-800 rounded-xl border border-zinc-700 overflow-hidden">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-zinc-900 border-b border-zinc-700 text-xs text-zinc-400 uppercase">
                        <th class="p-3 font-semibold">Action</th>
                        <th class="p-3 font-semibold">Points</th>
                        <th class="p-3 font-semibold">Max Count</th>
                        <th class="p-3 font-semibold">Cooldown (h)</th>
                        <th class="p-3 font-semibold text-center">Enabled</th>
                        <th class="p-3 font-semibold text-right">Max Total</th>
                    </tr>
                </thead>
                <tbody id="platform-usage-tbody">
                    ${n}
                </tbody>
            </table>
        </div>

        <!-- Save Button -->
        <div class="mt-6 flex justify-end gap-3">
            <button id="reset-platform-config-btn" class="px-4 py-2 bg-zinc-700 hover:bg-zinc-600 text-white rounded-lg transition-colors">
                <i class="fa-solid fa-rotate-left mr-2"></i>Reset to Default
            </button>
            <button id="save-platform-config-btn" class="px-6 py-2 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-lg transition-colors">
                <i class="fa-solid fa-save mr-2"></i>Save Configuration
            </button>
        </div>

        <!-- Info Box -->
        <div class="mt-6 p-4 bg-blue-900/20 border border-blue-500/30 rounded-xl">
            <h4 class="text-blue-400 font-bold mb-2"><i class="fa-solid fa-info-circle mr-2"></i>How It Works</h4>
            <ul class="text-zinc-400 text-sm space-y-1">
                <li>â€¢ <strong>Points:</strong> Amount awarded per action</li>
                <li>â€¢ <strong>Max Count:</strong> Maximum times a user can earn points for this action</li>
                <li>â€¢ <strong>Cooldown:</strong> Hours between earning points (0 = no cooldown)</li>
                <li>â€¢ <strong>Enabled:</strong> Toggle to enable/disable this action</li>
                <li>â€¢ Points are tracked with transaction hashes to prevent fraud</li>
            </ul>
        </div>
    `;const s=document.getElementById("platform-usage-tbody");s==null||s.addEventListener("input",Zi),s==null||s.addEventListener("change",Zi),(r=document.getElementById("save-platform-config-btn"))==null||r.addEventListener("click",Qg),(i=document.getElementById("reset-platform-config-btn"))==null||i.addEventListener("click",e0)},Zi=e=>{const t=e.target;if(!t.classList.contains("platform-input")&&!t.classList.contains("platform-toggle"))return;const a=t.closest("tr"),n=a==null?void 0:a.dataset.actionKey,s=t.dataset.field;if(!n||!s)return;P.platformUsageConfig[n]||(P.platformUsageConfig[n]={...ps[n]}),s==="enabled"?P.platformUsageConfig[n].enabled=t.checked:P.platformUsageConfig[n][s]=parseInt(t.value)||0;const r=P.platformUsageConfig[n],i=a.querySelector("td:last-child");i&&(i.textContent=((r.points||0)*(r.maxCount||1)).toLocaleString())},Qg=async e=>{const t=e.target.closest("button");if(!t)return;const a=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-2"></i>Saving...';try{await Qo(P.platformUsageConfig),b("âœ… Platform Usage config saved!","success"),_n()}catch(n){console.error("Error saving platform config:",n),b("Failed to save config: "+n.message,"error")}finally{t.disabled=!1,t.innerHTML=a}},e0=async()=>{if(confirm("Are you sure you want to reset to default values? This will save immediately."))try{P.platformUsageConfig={...ps},await Qo(P.platformUsageConfig),b("âœ… Config reset to defaults!","success"),_n()}catch(e){console.error("Error resetting platform config:",e),b("Failed to reset config: "+e.message,"error")}},t0=()=>{var a;const e=document.getElementById("admin-content-wrapper");if(!e)return;e.innerHTML=`
        <div id="presale-withdraw-panel" class="mb-8 p-6 bg-zinc-800 rounded-xl border border-border-color flex flex-col md:flex-row gap-4 justify-between items-center">
            <div>
                <h3 class="text-xl font-bold text-white">Presale Contract Funds</h3>
                <p class="text-sm text-zinc-400">Total accumulated in the PublicSale contract available for withdrawal.</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <span class="block text-2xl font-bold text-amber-400" id="presale-balance-amount">
                        <span class="loader !w-5 !h-5 inline-block"></span>
                    </span>
                    <span class="text-xs text-zinc-500">ETH/BNB Balance</span>
                </div>
                <button id="withdraw-presale-funds-btn" class="btn-primary py-3 px-5 whitespace-nowrap">
                    <i class="fa-solid fa-download mr-2"></i> Withdraw Funds
                </button>
            </div>
        </div>

        <h1 class="text-3xl font-bold mb-8">Airdrop Admin Panel</h1>
    
    
        <div class="border-b border-border-color mb-6">
            <nav id="admin-tabs" class="-mb-px flex flex-wrap gap-x-6 gap-y-2">
                <button class="tab-btn ${P.activeTab==="review-submissions"?"active":""}" data-target="review-submissions">Review Submissions</button>
                <button class="tab-btn ${P.activeTab==="manage-users"?"active":""}" data-target="manage-users">Manage Users</button>
                <button class="tab-btn ${P.activeTab==="manage-ugc-points"?"active":""}" data-target="manage-ugc-points">Manage UGC Points</button>
                <button class="tab-btn ${P.activeTab==="manage-tasks"?"active":""}" data-target="manage-tasks">Manage Daily Tasks</button>
                <button class="tab-btn ${P.activeTab==="platform-usage"?"active":""}" data-target="platform-usage">Platform Usage</button>
            </nav>
        </div>

        <div id="review_submissions_tab" class="tab-content ${P.activeTab==="review-submissions"?"active":""}">
            <div id="submissions-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="manage_users_tab" class="tab-content ${P.activeTab==="manage-users"?"active":""}">
            <div id="manage-users-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="manage_ugc_points_tab" class="tab-content ${P.activeTab==="manage-ugc-points"?"active":""}">
            <div id="manage-ugc-points-content" class="max-w-4xl mx-auto"></div>
        </div>

        <div id="manage_tasks_tab" class="tab-content ${P.activeTab==="manage-tasks"?"active":""}">
            <div id="manage-tasks-content" class="max-w-4xl mx-auto"></div>
        </div>

        <div id="platform_usage_tab" class="tab-content ${P.activeTab==="platform-usage"?"active":""}">
            <div id="platform-usage-content" class="max-w-4xl mx-auto"></div>
        </div>
    `,(a=document.getElementById("withdraw-presale-funds-btn"))==null||a.addEventListener("click",n=>Lg(n.target)),qr(),P.activeTab==="manage-ugc-points"?Ji():P.activeTab==="manage-tasks"?ja():P.activeTab==="review-submissions"?Rn():P.activeTab==="manage-users"?Bt():P.activeTab==="platform-usage"&&_n();const t=document.getElementById("admin-tabs");t&&!t._listenerAttached&&(t.addEventListener("click",n=>{const s=n.target.closest(".tab-btn");if(!s||s.classList.contains("active"))return;const r=s.dataset.target;P.activeTab=r,r!=="manage-users"&&(P.usersPage=1,P.usersFilter="all",P.usersSearch=""),r!=="review-submissions"&&(P.submissionsPage=1),r!=="manage-tasks"&&(P.tasksPage=1),document.querySelectorAll("#admin-tabs .tab-btn").forEach(o=>o.classList.remove("active")),s.classList.add("active"),e.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active"));const i=document.getElementById(r.replace(/-/g,"_")+"_tab");i?(i.classList.add("active"),r==="manage-ugc-points"&&Ji(),r==="manage-tasks"&&ja(),r==="review-submissions"&&Rn(),r==="manage-users"&&Bt(),r==="platform-usage"&&_n()):console.warn(`Tab content container not found for target: ${r}`)}),t._listenerAttached=!0)},a0={render(){const e=document.getElementById("admin");if(e){if(!$g()){e.innerHTML='<div class="text-center text-red-400 p-8 bg-sidebar border border-red-500/50 rounded-lg">Access Denied. This page is restricted to administrators.</div>';return}if(qi()){e.innerHTML='<div id="admin-content-wrapper"></div>',_a();return}e.innerHTML=`
            <div class="flex items-center justify-center min-h-[60vh]">
                <div class="bg-sidebar border border-yellow-500/30 rounded-2xl p-8 max-w-md w-full shadow-xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-shield-halved text-3xl text-yellow-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Admin Access</h2>
                        <p class="text-zinc-400 text-sm">Enter the admin key to continue</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-zinc-400 text-sm mb-2">Admin Key</label>
                            <input type="password" id="admin-key-input" 
                                   class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-yellow-500 focus:outline-none"
                                   placeholder="Enter admin key"
                                   onkeypress="if(event.key === 'Enter') document.getElementById('admin-login-btn').click()">
                        </div>
                        
                        <button id="admin-login-btn"
                                class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-4 rounded-xl transition-colors">
                            <i class="fa-solid fa-unlock mr-2"></i>Access Admin Panel
                        </button>
                        
                        <p id="admin-login-error" class="text-red-400 text-sm text-center hidden">
                            <i class="fa-solid fa-exclamation-circle mr-1"></i>Incorrect key
                        </p>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-zinc-800">
                        <p class="text-zinc-500 text-xs text-center">
                            <i class="fa-solid fa-wallet mr-1"></i>Connected: ${bt(c.userAddress)}
                        </p>
                    </div>
                </div>
            </div>
        `,document.getElementById("admin-login-btn").addEventListener("click",()=>{const t=document.getElementById("admin-key-input"),a=document.getElementById("admin-login-error");t.value===zg?(Ng(),b("âœ… Admin access granted!","success"),e.innerHTML='<div id="admin-content-wrapper"></div>',_a()):(a.classList.remove("hidden"),t.value="",t.focus(),setTimeout(()=>a.classList.add("hidden"),3e3))}),setTimeout(()=>{var t;(t=document.getElementById("admin-key-input"))==null||t.focus()},100)}},refreshData(){const e=document.getElementById("admin");e&&!e.classList.contains("hidden")&&qi()&&(console.log("Refreshing Admin Page data..."),_a(),qr())}},Ps=2e8,n0=4e7,s0=14e6,r0=26e6,Bs={burn:5,stakers:75,treasury:20},i0=()=>{if(document.getElementById("tokenomics-styles-v9"))return;const e=document.createElement("style");e.id="tokenomics-styles-v9",e.innerHTML=`
        @keyframes tk-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        @keyframes tk-glow { 0%, 100% { box-shadow: 0 0 20px rgba(245,158,11,0.2); } 50% { box-shadow: 0 0 40px rgba(245,158,11,0.4); } }
        @keyframes tk-fade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes tk-flow { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .tk-float { animation: tk-float 4s ease-in-out infinite; }
        .tk-glow { animation: tk-glow 2s ease-in-out infinite; }
        .tk-fade { animation: tk-fade 0.6s ease-out forwards; }
        .tk-section { background: linear-gradient(180deg, rgba(24,24,27,0.8), rgba(9,9,11,0.9)); border: 1px solid rgba(63,63,70,0.3); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; }
        .tk-card { background: rgba(39,39,42,0.4); border: 1px solid rgba(63,63,70,0.5); border-radius: 0.75rem; padding: 1rem; transition: all 0.3s ease; }
        .tk-card:hover { border-color: rgba(245,158,11,0.3); transform: translateY(-2px); }
        .tk-badge { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 10px; font-weight: 600; }
        .tk-flow-line { position: relative; height: 2px; background: rgba(63,63,70,0.5); overflow: hidden; }
        .tk-flow-line::after { content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, #f59e0b, transparent); animation: tk-flow 2s linear infinite; }
        .tk-pie-ring { width: 160px; height: 160px; border-radius: 50%; position: relative; }
        .tk-pie-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; background: #09090b; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #27272a; }
        .tk-bar { height: 8px; background: rgba(63,63,70,0.5); border-radius: 999px; overflow: hidden; }
        .tk-bar-fill { height: 100%; border-radius: 999px; transition: width 1s ease-out; }
        .tk-icon-box { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    `,document.head.appendChild(e)},ca=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(0)+"K":e.toLocaleString();function o0(){return`
        <div class="text-center mb-6 tk-fade">
            <div class="relative inline-block mb-4">
                <img src="./assets/bkc_logo_3d.png" class="w-20 h-20 tk-float tk-glow rounded-full" alt="BKC">
            </div>
            <h1 class="text-2xl font-black text-white mb-2">
                <span class="bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">BACKCHAIN</span>
                <span class="text-zinc-400 font-normal">Tokenomics</span>
            </h1>
            <p class="text-zinc-500 text-sm max-w-md mx-auto">
                15 immutable contracts. <span class="text-amber-400">Real yield</span> from protocol fees.
                <span class="text-emerald-400">Deflationary</span> by design.
                No admin keys. No pause. <span class="text-purple-400">Unstoppable.</span>
            </p>
        </div>`}function l0(){const e=c.totalSupply?O(c.totalSupply):n0,t=(e/Ps*100).toFixed(1),a=Ps-e;return`
        <div class="tk-section tk-fade" style="animation-delay:0.1s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(245,158,11,0.2)"><i class="fa-solid fa-coins text-amber-400"></i></div>
                <div><h2 class="text-white font-bold">Token Supply</h2><p class="text-zinc-500 text-xs">BKC â€” ERC-20 on Arbitrum</p></div>
            </div>
            <div class="grid grid-cols-3 gap-3 mb-4">
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Max Supply</p>
                    <p class="text-xl font-black text-white">${ca(Ps)}</p>
                </div>
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Circulating</p>
                    <p class="text-xl font-black text-emerald-400">${ca(e)}</p>
                </div>
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">To Mine</p>
                    <p class="text-xl font-black text-amber-400">${ca(a)}</p>
                </div>
            </div>
            <div class="tk-bar mb-2"><div class="tk-bar-fill bg-gradient-to-r from-amber-500 to-emerald-500" style="width:${t}%"></div></div>
            <p class="text-center text-zinc-600 text-[10px]"><i class="fa-solid fa-hammer mr-1"></i>${t}% minted â€” remaining ${ca(a)} BKC mined via BuybackMiner</p>
        </div>`}function c0(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.15s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(168,85,247,0.2)"><i class="fa-solid fa-rocket text-purple-400"></i></div>
                <div><h2 class="text-white font-bold">TGE â€” Token Launch</h2><p class="text-zinc-500 text-xs">40M BKC minted at genesis</p></div>
            </div>
            <div class="flex items-center justify-center gap-6 mb-4">
                <div class="tk-pie-ring" style="background: conic-gradient(#f59e0b 0% 35%, #10b981 35% 100%);">
                    <div class="tk-pie-center">
                        <p class="text-2xl font-black text-white">40M</p>
                        <p class="text-[10px] text-zinc-500">BKC</p>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                        <div>
                            <p class="text-white font-bold text-sm">35% Airdrop</p>
                            <p class="text-zinc-500 text-[10px]">${ca(s0)} BKC to community</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                        <div>
                            <p class="text-white font-bold text-sm">65% Liquidity</p>
                            <p class="text-zinc-500 text-[10px]">${ca(r0)} BKC to LiquidityPool</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tk-card" style="background:linear-gradient(135deg,rgba(245,158,11,0.08),rgba(234,88,12,0.08));border-color:rgba(245,158,11,0.3)">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-lg"><i class="fa-solid fa-parachute-box text-amber-400"></i></span>
                    <p class="text-amber-400 font-bold text-sm">Airdrop â€” Phase 1 Active</p>
                </div>
                <p class="text-zinc-400 text-xs">Earn points by using the protocol: staking, notarizing, playing Fortune, posting on Agora, donating to Charity. Share your referral link to earn 10% ETH on all fees + 5% BKC on staking rewards â€” forever.</p>
                <div class="flex gap-2 mt-3">
                    <a href="#airdrop" class="inline-flex items-center gap-1.5 text-xs font-bold text-amber-400 hover:text-amber-300 transition-colors">
                        <i class="fa-solid fa-arrow-right"></i> Join Airdrop
                    </a>
                    <a href="#referral" class="inline-flex items-center gap-1.5 text-xs font-bold text-cyan-400 hover:text-cyan-300 transition-colors ml-4">
                        <i class="fa-solid fa-user-plus"></i> Invite Friends
                    </a>
                </div>
            </div>
        </div>`}function d0(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.2s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(6,182,212,0.2)"><i class="fa-solid fa-arrows-split-up-and-left text-cyan-400"></i></div>
                <div><h2 class="text-white font-bold">Fee Flow</h2><p class="text-zinc-500 text-xs">How protocol revenue is distributed</p></div>
            </div>

            <div class="tk-card mb-3">
                <p class="text-white font-bold text-sm mb-2"><i class="fa-solid fa-layer-group text-blue-400 mr-2"></i>Tier 1 â€” ETH Fees</p>
                <p class="text-zinc-500 text-xs mb-3">Every on-chain action pays an ETH fee split among:</p>
                <div class="grid grid-cols-3 gap-2 text-center text-[10px]">
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-emerald-400 font-bold text-base">Buyback</p><p class="text-zinc-500">ETH accumulates</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-blue-400 font-bold text-base">Treasury</p><p class="text-zinc-500">Protocol fund</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-amber-400 font-bold text-base">Operator</p><p class="text-zinc-500">Frontend builder</p></div>
                </div>
            </div>

            <div class="tk-flow-line my-3"></div>

            <div class="tk-card mb-3">
                <p class="text-white font-bold text-sm mb-2"><i class="fa-solid fa-layer-group text-purple-400 mr-2"></i>Tier 2 â€” BKC Fees</p>
                <p class="text-zinc-500 text-xs mb-3">Staking claims and Fortune wagers pay BKC fees:</p>
                <div class="grid grid-cols-3 gap-2 text-center text-[10px]">
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-red-400 font-bold text-base">${Bs.burn}%</p><p class="text-zinc-500">Burn</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-purple-400 font-bold text-base">${Bs.stakers}%</p><p class="text-zinc-500">Stakers</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-blue-400 font-bold text-base">${Bs.treasury}%</p><p class="text-zinc-500">Treasury</p></div>
                </div>
            </div>

            <div class="tk-flow-line my-3"></div>

            <div class="tk-card" style="background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(6,182,212,0.08));border-color:rgba(16,185,129,0.3)">
                <p class="text-white font-bold text-sm mb-2"><i class="fa-solid fa-recycle text-emerald-400 mr-2"></i>BuybackMiner â€” The Engine</p>
                <p class="text-zinc-500 text-xs mb-2">When ETH fees accumulate, anyone can trigger a buyback:</p>
                <div class="space-y-1 text-[10px] text-zinc-400">
                    <p><span class="text-emerald-400">1.</span> Withdraw ETH from Ecosystem</p>
                    <p><span class="text-emerald-400">2.</span> 1% to caller incentive (permissionless MEV)</p>
                    <p><span class="text-emerald-400">3.</span> 99% swaps ETH to BKC via LiquidityPool</p>
                    <p><span class="text-emerald-400">4.</span> Mint new BKC (scarcity curve decreases over time)</p>
                    <p><span class="text-emerald-400">5.</span> 5% burned + 95% to StakingPool rewards</p>
                </div>
            </div>
        </div>`}function u0(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.3s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(245,158,11,0.2)"><i class="fa-solid fa-receipt text-amber-400"></i></div>
                <div><h2 class="text-white font-bold">Fixed Pricing</h2><p class="text-zinc-500 text-xs">Minimum fees ensure ecosystem sustainability</p></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(139,92,246,0.2)">
                        <i class="fa-solid fa-stamp text-violet-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Notary â€” Certify</p>
                        <p class="text-violet-400 text-[10px] font-bold">0.0005 ETH</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(34,197,94,0.2)">
                        <i class="fa-solid fa-dice-one text-green-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Fortune â€” Tier 0 (2x)</p>
                        <p class="text-green-400 text-[10px] font-bold">0.0003 ETH</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(16,185,129,0.2)">
                        <i class="fa-solid fa-dice-three text-emerald-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Fortune â€” Tier 1 (10x)</p>
                        <p class="text-emerald-400 text-[10px] font-bold">0.0005 ETH</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(20,184,166,0.2)">
                        <i class="fa-solid fa-dice-six text-teal-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Fortune â€” Tier 2 (100x)</p>
                        <p class="text-teal-400 text-[10px] font-bold">0.001 ETH</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(59,130,246,0.2)">
                        <i class="fa-solid fa-circle-check text-blue-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Verified Badge</p>
                        <p class="text-blue-400 text-[10px] font-bold">0.02 ETH/yr</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(245,158,11,0.2)">
                        <i class="fa-solid fa-circle-check text-amber-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Premium Badge</p>
                        <p class="text-amber-400 text-[10px] font-bold">0.1 ETH/yr</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(168,85,247,0.2)">
                        <i class="fa-solid fa-gem text-purple-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Elite Badge</p>
                        <p class="text-purple-400 text-[10px] font-bold">0.25 ETH/yr</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(6,182,212,0.2)">
                        <i class="fa-solid fa-rocket text-cyan-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Post Boost</p>
                        <p class="text-cyan-400 text-[10px] font-bold">0.002 ETH/day</p>
                    </div>
                </div>
            </div>
            <div class="mt-3 p-3 rounded-lg text-center" style="background:rgba(39,39,42,0.5);border:1px solid rgba(63,63,70,0.5)">
                <p class="text-zinc-500 text-[10px]"><i class="fa-solid fa-users mr-1"></i>Operators earn 10-20% commission on every action â€” <a href="#operator" class="text-emerald-400 hover:underline">become an operator</a></p>
            </div>
        </div>`}function p0(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.35s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(139,92,246,0.2)"><i class="fa-solid fa-gem text-violet-400"></i></div>
                <div><h2 class="text-white font-bold">NFT Boosters</h2><p class="text-zinc-500 text-xs">Reduce burn rate on staking claim rewards</p></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(6,182,212,0.2)">
                            <i class="fa-solid fa-gem text-cyan-400 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Diamond</p>
                            <p class="text-cyan-400 text-[10px]">+50% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 0%</span>
                        <span class="text-zinc-500">Keep: 100%</span>
                    </div>
                </div>
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(234,179,8,0.2)">
                            <i class="fa-solid fa-gem text-yellow-400 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Gold</p>
                            <p class="text-yellow-400 text-[10px]">+40% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 10%</span>
                        <span class="text-zinc-500">Keep: 90%</span>
                    </div>
                </div>
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(161,161,170,0.2)">
                            <i class="fa-solid fa-gem text-zinc-400 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Silver</p>
                            <p class="text-zinc-400 text-[10px]">+25% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 25%</span>
                        <span class="text-zinc-500">Keep: 75%</span>
                    </div>
                </div>
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(245,158,11,0.2)">
                            <i class="fa-solid fa-gem text-amber-500 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Bronze</p>
                            <p class="text-amber-500 text-[10px]">+10% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 40%</span>
                        <span class="text-zinc-500">Keep: 60%</span>
                    </div>
                </div>
            </div>
            <p class="text-center text-zinc-600 text-[10px] mt-3">
                <i class="fa-solid fa-info-circle mr-1"></i>Without NFT: 50% of claimed rewards are burned. Diamond holders keep 100%.
            </p>
        </div>`}function f0(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.4s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(245,158,11,0.2)"><i class="fa-solid fa-sack-dollar text-amber-400"></i></div>
                <div><h2 class="text-white font-bold">How to Earn</h2><p class="text-zinc-500 text-xs">6 ways to generate income</p></div>
            </div>
            <div class="space-y-2">
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(168,85,247,0.2)">
                            <i class="fa-solid fa-lock text-purple-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Stake BKC</p><span class="tk-badge" style="background:rgba(168,85,247,0.2);color:#c084fc">Real Yield</span></div>
                            <p class="text-zinc-500 text-xs">Delegate to earn share of BuybackMiner output + Tier 2 fees. Longer locks = higher pStake = bigger share.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(6,182,212,0.2)">
                            <i class="fa-solid fa-landmark text-cyan-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Agora Social</p><span class="tk-badge" style="background:rgba(6,182,212,0.2);color:#22d3ee">ETH Tips</span></div>
                            <p class="text-zinc-500 text-xs">Earn from followers, replies, SuperLikes, and tips. Build an audience and monetize your content.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(20,184,166,0.2)">
                            <i class="fa-solid fa-house text-teal-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Rent NFTs</p><span class="tk-badge" style="background:rgba(20,184,166,0.2);color:#2dd4bf">Passive</span></div>
                            <p class="text-zinc-500 text-xs">List your Booster NFT for rent. Other stakers pay per-hour for temporary boost access.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(34,197,94,0.2)">
                            <i class="fa-solid fa-clover text-green-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Fortune Pool</p><span class="tk-badge" style="background:rgba(34,197,94,0.2);color:#4ade80">Up to 100x</span></div>
                            <p class="text-zinc-500 text-xs">Commit-reveal game with 3 tiers: 2x, 10x, or 100x. Provably fair on-chain randomness.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(245,158,11,0.2)">
                            <i class="fa-solid fa-code text-amber-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Operate a Frontend</p><span class="tk-badge" style="background:rgba(245,158,11,0.2);color:#fbbf24">10-20%</span></div>
                            <p class="text-zinc-500 text-xs">Build a UI for any module and earn operator commissions on all user activity. <a href="#operator" class="text-emerald-400 hover:underline">Learn more</a></p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(234,179,8,0.2)">
                            <i class="fa-solid fa-bolt text-yellow-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Trigger Buybacks</p><span class="tk-badge" style="background:rgba(234,179,8,0.2);color:#facc15">1% Reward</span></div>
                            <p class="text-zinc-500 text-xs">Call executeBuyback() when ETH accumulates. Earn 1% caller incentive. Permissionless MEV.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>`}function m0(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.5s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(161,161,170,0.2)"><i class="fa-solid fa-file-contract text-zinc-400"></i></div>
                <div><h2 class="text-white font-bold">15 Smart Contracts</h2><p class="text-zinc-500 text-xs">All immutable â€” no admin, no pause, no blacklist</p></div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-[10px]">
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-coins text-amber-400"></i><span class="text-zinc-400">BKCToken</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-network-wired text-blue-400"></i><span class="text-zinc-400">BackchainEcosystem</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-water text-indigo-400"></i><span class="text-zinc-400">LiquidityPool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-lock text-purple-400"></i><span class="text-zinc-400">StakingPool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-hammer text-emerald-400"></i><span class="text-zinc-400">BuybackMiner</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-gem text-violet-400"></i><span class="text-zinc-400">RewardBooster</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-store text-pink-400"></i><span class="text-zinc-400">NFTPool (x4)</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-clover text-green-400"></i><span class="text-zinc-400">FortunePool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-landmark text-cyan-400"></i><span class="text-zinc-400">Agora</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-stamp text-slate-400"></i><span class="text-zinc-400">Notary</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-heart text-red-400"></i><span class="text-zinc-400">CharityPool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-rocket text-teal-400"></i><span class="text-zinc-400">RentalManager</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-scale-balanced text-amber-400"></i><span class="text-zinc-400">Governance</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-faucet-drip text-sky-400"></i><span class="text-zinc-400">SimpleBKCFaucet</span></div>
            </div>
            <div class="mt-3 p-3 rounded-lg" style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3)">
                <p class="text-emerald-400 text-xs font-medium text-center"><i class="fa-solid fa-shield-halved mr-1"></i>Progressive decentralization: Admin â†’ Multisig â†’ Timelock â†’ DAO</p>
            </div>
            <div class="mt-3 text-center">
                <a href="https://sepolia.arbiscan.io" target="_blank" class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-amber-400 transition-colors">
                    <i class="fa-solid fa-external-link"></i> View all contracts on Arbiscan
                </a>
            </div>
        </div>`}function g0(){const e=document.getElementById("tokenomics");e&&(i0(),e.innerHTML=`
        <div class="max-w-2xl mx-auto px-4 py-6 pb-24">
            ${o0()}
            ${l0()}
            ${c0()}
            ${d0()}
            ${u0()}
            ${p0()}
            ${f0()}
            ${m0()}
            <div class="text-center py-6 text-zinc-600 text-xs">
                <p>Unstoppable, permissionless DeFi infrastructure</p>
                <p class="mt-1">BACKCHAIN &copy; 2024-2026</p>
            </div>
        </div>`,e.scrollIntoView({behavior:"smooth",block:"start"}))}const b0={render:g0,init:()=>{},update:()=>{}},me=window.ethers,x0=5*1024*1024,Dd="https://sepolia.arbiscan.io",h0=`${Dd}/tx/`,Xr=`${Dd}/address/`,Od=["event Certified(uint256 indexed certId, address indexed owner, bytes32 documentHash, uint8 docType, address operator)"],ct={image:{icon:"fa-regular fa-image",color:"#34d399",bg:"rgba(52,211,153,0.12)",label:"Image"},pdf:{icon:"fa-regular fa-file-pdf",color:"#f87171",bg:"rgba(248,113,113,0.12)",label:"PDF"},audio:{icon:"fa-solid fa-music",color:"#a78bfa",bg:"rgba(167,139,250,0.12)",label:"Audio"},video:{icon:"fa-regular fa-file-video",color:"#60a5fa",bg:"rgba(96,165,250,0.12)",label:"Video"},document:{icon:"fa-regular fa-file-word",color:"#60a5fa",bg:"rgba(96,165,250,0.12)",label:"Document"},spreadsheet:{icon:"fa-regular fa-file-excel",color:"#4ade80",bg:"rgba(74,222,128,0.12)",label:"Spreadsheet"},code:{icon:"fa-solid fa-code",color:"#22d3ee",bg:"rgba(34,211,238,0.12)",label:"Code"},archive:{icon:"fa-regular fa-file-zipper",color:"#facc15",bg:"rgba(250,204,21,0.12)",label:"Archive"},default:{icon:"fa-regular fa-file",color:"#fbbf24",bg:"rgba(251,191,36,0.12)",label:"File"}},E={view:"documents",activeTab:"documents",viewHistory:[],wizStep:1,wizFile:null,wizFileHash:null,wizDescription:"",wizDuplicateCheck:null,wizIsHashing:!1,wizIpfsCid:null,wizUploadDate:null,bkcFee:0n,ethFee:0n,feesLoaded:!1,certificates:[],certsLoading:!1,selectedCert:null,verifyFile:null,verifyHash:null,verifyResult:null,verifyIsChecking:!1,stats:null,totalSupply:0,recentNotarizations:[],statsLoading:!1,isProcessing:!1,processStep:"",isLoading:!1,contractAvailable:!0};function Za(e="",t=""){const a=e.toLowerCase(),n=t.toLowerCase();return a.includes("image")||/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico)$/.test(n)?ct.image:a.includes("pdf")||n.endsWith(".pdf")?ct.pdf:a.includes("audio")||/\.(mp3|wav|ogg|flac|aac|m4a)$/.test(n)?ct.audio:a.includes("video")||/\.(mp4|avi|mov|mkv|webm|wmv)$/.test(n)?ct.video:a.includes("word")||a.includes("document")||/\.(doc|docx|odt|rtf)$/.test(n)?ct.document:a.includes("sheet")||a.includes("excel")||/\.(xls|xlsx|csv|ods)$/.test(n)?ct.spreadsheet:/\.(js|ts|py|java|cpp|c|h|html|css|json|xml|sol|rs|go|php|rb)$/.test(n)?ct.code:a.includes("zip")||a.includes("archive")||/\.(zip|rar|7z|tar|gz)$/.test(n)?ct.archive:ct.default}function Hd(e){if(!e)return"";let t;if(typeof e=="number")t=new Date(e>1e12?e:e*1e3);else if(typeof e=="string")t=new Date(e);else if(e!=null&&e.toDate)t=e.toDate();else if(e!=null&&e.seconds)t=new Date(e.seconds*1e3);else return"";if(isNaN(t.getTime()))return"";const a=new Date,n=a-t,s=Math.floor(n/6e4),r=Math.floor(n/36e5),i=Math.floor(n/864e5);return s<1?"Just now":s<60?`${s}m`:r<24?`${r}h`:i<7?`${i}d`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==a.getFullYear()?"numeric":void 0})}function Jr(e){if(!e)return"";const t=typeof e=="number"?new Date(e>1e12?e:e*1e3):new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function Zr(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function Ud(e){return e?e.startsWith("https://")?e:e.startsWith("ipfs://")?`${Cn[0]}${e.replace("ipfs://","")}`:`${Cn[0]}${e}`:""}function Qr(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(2)} MB`}function v0(e,t){E.viewHistory.push({view:E.view,data:E.selectedCert}),E.view=e,t&&(E.selectedCert=t),be(),Ba()}function jd(){const e=E.viewHistory.pop();e?(E.view=e.view,E.activeTab=e.view==="cert-detail"?"documents":e.view,E.selectedCert=e.data):(E.view="documents",E.activeTab="documents"),be(),Ba()}function w0(e){E.activeTab===e&&E.view===e||(E.viewHistory=[],E.view=e,E.activeTab=e,be(),Ba())}function y0(){if(document.getElementById("notary-styles-v10"))return;const e=document.createElement("style");e.id="notary-styles-v10",e.textContent=`
        :root {
            --nt-bg:       #0c0c0e;
            --nt-bg2:      #141417;
            --nt-bg3:      #1c1c21;
            --nt-surface:  #222228;
            --nt-border:   rgba(255,255,255,0.06);
            --nt-border-h: rgba(255,255,255,0.1);
            --nt-text:     #f0f0f2;
            --nt-text-2:   #a0a0ab;
            --nt-text-3:   #5c5c68;
            --nt-accent:   #f59e0b;
            --nt-accent-2: #d97706;
            --nt-accent-glow: rgba(245,158,11,0.15);
            --nt-red:      #ef4444;
            --nt-green:    #22c55e;
            --nt-blue:     #3b82f6;
            --nt-radius:   14px;
            --nt-radius-sm: 10px;
            --nt-radius-lg: 20px;
            --nt-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes nt-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
        @keyframes nt-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: none; } }
        @keyframes nt-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes nt-stamp { 0% { transform: scale(1) rotate(0); } 25% { transform: scale(1.2) rotate(-5deg); } 50% { transform: scale(0.9) rotate(5deg); } 100% { transform: scale(1) rotate(0); } }
        @keyframes nt-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes nt-scan { 0% { top: 0; opacity: 1; } 50% { opacity: 0.5; } 100% { top: 100%; opacity: 1; } }
        @keyframes nt-pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); } 100% { box-shadow: 0 0 0 15px rgba(245,158,11,0); } }

        .nt-shell {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 16px 32px;
            min-height: 100vh;
            background: var(--nt-bg);
        }
        .nt-header {
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 12px 0 0;
            background: var(--nt-bg);
        }
        .nt-header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }
        .nt-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nt-brand-icon {
            width: 44px; height: 44px;
            border-radius: var(--nt-radius);
            background: var(--nt-accent-glow);
            border: 1px solid rgba(245,158,11,0.2);
            display: flex; align-items: center; justify-content: center;
            color: var(--nt-accent);
            font-size: 20px;
            animation: nt-float 4s ease-in-out infinite;
        }
        .nt-brand-name {
            font-size: 18px;
            font-weight: 800;
            color: var(--nt-text);
            letter-spacing: -0.02em;
        }
        .nt-brand-sub {
            font-size: 11px;
            color: var(--nt-text-3);
        }

        /* Navigation */
        .nt-nav {
            display: flex;
            gap: 2px;
            padding: 4px;
            background: var(--nt-bg2);
            border-radius: var(--nt-radius);
            border: 1px solid var(--nt-border);
            margin-top: 8px;
        }
        .nt-nav-item {
            flex: 1;
            padding: 10px 6px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--nt-text-3);
            border-radius: var(--nt-radius-sm);
            cursor: pointer;
            transition: all var(--nt-transition);
            border: none;
            background: none;
        }
        .nt-nav-item:hover { color: var(--nt-text-2); background: var(--nt-bg3); }
        .nt-nav-item.active {
            color: var(--nt-text);
            background: var(--nt-surface);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .nt-nav-item i { margin-right: 6px; }

        /* Back header */
        .nt-back-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
        }
        .nt-back-btn {
            width: 36px; height: 36px;
            border-radius: var(--nt-radius-sm);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            color: var(--nt-text-2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-back-btn:hover { background: var(--nt-surface); color: var(--nt-text); }

        /* Card */
        .nt-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            padding: 20px;
            animation: nt-fadeIn 0.3s ease;
        }

        /* Certificate grid */
        .nt-cert-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        @media (max-width: 640px) {
            .nt-cert-grid { grid-template-columns: 1fr; }
        }
        .nt-cert-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-cert-card:hover {
            border-color: var(--nt-border-h);
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.3);
        }
        .nt-cert-thumb {
            height: 120px;
            background: var(--nt-bg3);
            display: flex; align-items: center; justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .nt-cert-thumb img {
            width: 100%; height: 100%; object-fit: cover; opacity: 0.8;
        }
        .nt-cert-info {
            padding: 14px;
        }

        /* Dropzone */
        .nt-dropzone {
            border: 2px dashed var(--nt-border-h);
            border-radius: var(--nt-radius-lg);
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.15);
        }
        .nt-dropzone:hover {
            border-color: rgba(245,158,11,0.4);
            background: var(--nt-accent-glow);
        }
        .nt-dropzone.drag-over {
            border-color: var(--nt-accent);
            background: var(--nt-accent-glow);
            transform: scale(1.01);
        }

        /* Wizard steps */
        .nt-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            margin-bottom: 28px;
        }
        .nt-step-dot {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .nt-step-dot.pending {
            background: var(--nt-bg3);
            color: var(--nt-text-3);
            border: 2px solid var(--nt-border);
        }
        .nt-step-dot.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            box-shadow: 0 0 20px rgba(245,158,11,0.3);
        }
        .nt-step-dot.done {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
        }
        .nt-step-line {
            width: 60px; height: 3px;
            background: var(--nt-border);
            border-radius: 2px;
            transition: all 0.4s ease;
        }
        .nt-step-line.done { background: var(--nt-green); }
        .nt-step-line.active { background: linear-gradient(90deg, var(--nt-green), var(--nt-accent)); }

        /* Fee box */
        .nt-fee-box {
            background: rgba(245,158,11,0.06);
            border: 1px solid rgba(245,158,11,0.15);
            border-radius: var(--nt-radius);
            padding: 16px;
        }
        .nt-fee-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .nt-fee-row + .nt-fee-row {
            border-top: 1px solid var(--nt-border);
        }

        /* Verify */
        .nt-verified {
            background: rgba(34,197,94,0.08);
            border: 1px solid rgba(34,197,94,0.2);
            border-radius: var(--nt-radius);
            padding: 20px;
        }
        .nt-not-found {
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: var(--nt-radius);
            padding: 20px;
        }

        /* Stats */
        .nt-stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        @media (min-width: 640px) {
            .nt-stat-grid { grid-template-columns: repeat(4, 1fr); }
        }
        .nt-stat-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            padding: 16px;
            text-align: center;
            animation: nt-fadeIn 0.3s ease;
        }
        .nt-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--nt-text);
            font-family: monospace;
        }
        .nt-recent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--nt-border);
            transition: background var(--nt-transition);
        }
        .nt-recent-item:hover { background: var(--nt-bg3); }
        .nt-recent-item:last-child { border-bottom: none; }

        /* Detail */
        .nt-detail { animation: nt-fadeIn 0.3s ease; }
        .nt-detail-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        @media (max-width: 640px) {
            .nt-detail-meta { grid-template-columns: 1fr; }
        }
        .nt-hash-display {
            font-family: monospace;
            font-size: 11px;
            color: var(--nt-text-2);
            background: var(--nt-bg3);
            padding: 12px;
            border-radius: var(--nt-radius-sm);
            word-break: break-all;
            cursor: pointer;
            border: 1px solid var(--nt-border);
            transition: border-color var(--nt-transition);
        }
        .nt-hash-display:hover { border-color: var(--nt-accent); }

        /* Buttons */
        .nt-btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-weight: 700;
            border: none;
            border-radius: var(--nt-radius-sm);
            padding: 12px 24px;
            cursor: pointer;
            transition: all var(--nt-transition);
            font-size: 14px;
        }
        .nt-btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(245,158,11,0.3);
        }
        .nt-btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
        .nt-btn-secondary {
            background: var(--nt-bg3);
            color: var(--nt-text-2);
            font-weight: 600;
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius-sm);
            padding: 10px 20px;
            cursor: pointer;
            transition: all var(--nt-transition);
            font-size: 13px;
        }
        .nt-btn-secondary:hover { background: var(--nt-surface); color: var(--nt-text); }
        .nt-btn-icon {
            width: 36px; height: 36px;
            border-radius: var(--nt-radius-sm);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            color: var(--nt-text-2);
            display: inline-flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-btn-icon:hover { background: var(--nt-surface); color: var(--nt-text); }

        /* Overlay */
        .nt-overlay {
            position: fixed; inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.92);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center; justify-content: center;
        }
        .nt-overlay.active { display: flex; }

        /* Shimmer loading */
        .nt-shimmer {
            background: linear-gradient(90deg, var(--nt-bg3) 25%, var(--nt-surface) 50%, var(--nt-bg3) 75%);
            background-size: 200% 100%;
            animation: nt-shimmer 1.5s ease infinite;
            border-radius: var(--nt-radius-sm);
        }

        /* Duplicate warning */
        .nt-duplicate-warn {
            background: rgba(251,191,36,0.08);
            border: 1px solid rgba(251,191,36,0.25);
            border-radius: var(--nt-radius);
            padding: 16px;
        }
    `,document.head.appendChild(e);const t=document.getElementById("notary-styles-v6");t&&t.remove()}function k0(e){const t=document.getElementById("notary");t&&(y0(),t.innerHTML=`
        <div class="nt-shell">
            <div class="nt-header" id="nt-header"></div>
            <div id="nt-content"></div>
            <div id="nt-overlay" class="nt-overlay"></div>
        </div>
    `,Ba(),be(),Promise.all([L0(),ei(),_0()]).catch(()=>{}))}function Ba(){var t;const e=document.getElementById("nt-header");if(e){if(E.view==="cert-detail"){e.innerHTML=`
            <div class="nt-back-header">
                <button class="nt-back-btn" onclick="NotaryPage.goBack()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div>
                    <div style="font-size:15px;font-weight:700;color:var(--nt-text)">Certificate #${((t=E.selectedCert)==null?void 0:t.id)||""}</div>
                    <div style="font-size:11px;color:var(--nt-text-3)">Document details</div>
                </div>
            </div>
        `;return}e.innerHTML=`
        <div class="nt-header-bar">
            <div class="nt-brand">
                <div class="nt-brand-icon"><i class="fa-solid fa-stamp"></i></div>
                <div>
                    <div class="nt-brand-name">Decentralized Notary</div>
                    <div class="nt-brand-sub">Permanent blockchain certification</div>
                </div>
            </div>
        </div>
        <nav class="nt-nav">
            <button class="nt-nav-item ${E.activeTab==="documents"?"active":""}" onclick="NotaryPage.setTab('documents')">
                <i class="fa-solid fa-certificate"></i><span>Documents</span>
            </button>
            <button class="nt-nav-item ${E.activeTab==="notarize"?"active":""}" onclick="NotaryPage.setTab('notarize')">
                <i class="fa-solid fa-stamp"></i><span>Notarize</span>
            </button>
            <button class="nt-nav-item ${E.activeTab==="verify"?"active":""}" onclick="NotaryPage.setTab('verify')">
                <i class="fa-solid fa-shield-check"></i><span>Verify</span>
            </button>
            <button class="nt-nav-item ${E.activeTab==="stats"?"active":""}" onclick="NotaryPage.setTab('stats')">
                <i class="fa-solid fa-chart-simple"></i><span>Stats</span>
            </button>
        </nav>
    `}}function be(){const e=document.getElementById("nt-content");if(e)switch(E.view){case"documents":Qi(e);break;case"notarize":T0(e);break;case"verify":S0(e);break;case"stats":N0(e);break;case"cert-detail":$0(e);break;default:Qi(e)}}function Qi(e){if(!c.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to view your certificates</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}if(E.certsLoading){e.innerHTML=`
            <div class="nt-cert-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>`
                    <div class="nt-cert-card">
                        <div class="nt-shimmer" style="height:120px"></div>
                        <div style="padding:14px">
                            <div class="nt-shimmer" style="height:16px;width:70%;margin-bottom:8px"></div>
                            <div class="nt-shimmer" style="height:12px;width:50%"></div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `;return}if(!E.certificates.length){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-stamp" style="font-size:24px;color:var(--nt-accent);opacity:0.5"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">No Certificates</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Notarize a document to create your first certificate</div>
                <button class="nt-btn-primary" onclick="NotaryPage.setTab('notarize')">
                    <i class="fa-solid fa-plus" style="margin-right:8px"></i>Notarize Document
                </button>
            </div>
        `;return}e.innerHTML=`
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:4px">
            <div style="font-size:13px;color:var(--nt-text-2)">${E.certificates.length} certificate${E.certificates.length>1?"s":""}</div>
            <button class="nt-btn-icon" onclick="NotaryPage.refreshHistory()" title="Refresh">
                <i class="fa-solid fa-rotate-right" style="font-size:12px"></i>
            </button>
        </div>
        <div class="nt-cert-grid">
            ${E.certificates.map(t=>E0(t)).join("")}
        </div>
    `}function E0(e){var r,i;const t=Ud(e.ipfs),a=Za(e.mimeType||"",e.description||e.fileName||""),n=Hd(e.timestamp),s=((r=e.description)==null?void 0:r.split("---")[0].trim().split(`
`)[0].trim())||"Notarized Document";return`
        <div class="nt-cert-card" onclick="NotaryPage.viewCert(${e.id})">
            <div class="nt-cert-thumb">
                ${t?`
                    <img src="${t}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="">
                    <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;inset:0;background:var(--nt-bg3)">
                        <i class="${a.icon}" style="font-size:28px;color:${a.color}"></i>
                    </div>
                `:`
                    <i class="${a.icon}" style="font-size:28px;color:${a.color}"></i>
                `}
                <span style="position:absolute;top:8px;right:8px;font-size:10px;font-family:monospace;color:var(--nt-accent);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px;font-weight:700">#${e.id}</span>
                ${n?`<span style="position:absolute;top:8px;left:8px;font-size:10px;color:var(--nt-text-3);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px"><i class="fa-regular fa-clock" style="margin-right:4px"></i>${n}</span>`:""}
            </div>
            <div class="nt-cert-info">
                <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px">${s}</div>
                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">SHA-256: ${((i=e.hash)==null?void 0:i.slice(0,18))||"..."}...</div>
            </div>
        </div>
    `}function T0(e){if(!c.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to notarize documents on the blockchain</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}e.innerHTML=`
        <div class="nt-card" style="margin-top:16px">
            ${C0()}
            <div id="nt-wiz-panel"></div>
        </div>
    `;const t=document.getElementById("nt-wiz-panel");if(t)switch(E.wizStep){case 1:I0(t);break;case 2:Wd(t);break;case 3:P0(t);break}}function C0(){const e=E.wizStep;return`
        <div class="nt-steps">
            <div class="nt-step-dot ${e>1?"done":e===1?"active":"pending"}">${e>1?'<i class="fa-solid fa-check" style="font-size:12px"></i>':"1"}</div>
            <div class="nt-step-line ${e>1?"done":""}"></div>
            <div class="nt-step-dot ${e>2?"done":e===2?"active":"pending"}">${e>2?'<i class="fa-solid fa-check" style="font-size:12px"></i>':"2"}</div>
            <div class="nt-step-line ${e>2?"done":e===2?"active":""}"></div>
            <div class="nt-step-dot ${e===3?"active":"pending"}">3</div>
        </div>
    `}function I0(e){if(E.wizFile&&E.wizFileHash){const t=E.wizFile,a=Za(t.type,t.name),n=E.wizDuplicateCheck;e.innerHTML=`
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">File Selected</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">SHA-256 hash computed in your browser</div>
            </div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:14px">
                    <div style="width:48px;height:48px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="${a.icon}" style="font-size:20px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t.name}</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">${Qr(t.size)} &bull; ${a.label}</div>
                    </div>
                    <button class="nt-btn-icon" onclick="NotaryPage.wizRemoveFile()" title="Remove">
                        <i class="fa-solid fa-xmark" style="color:var(--nt-red)"></i>
                    </button>
                </div>
            </div>

            <div style="margin-bottom:16px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">
                    <i class="fa-solid fa-fingerprint" style="margin-right:4px;color:var(--nt-accent)"></i>SHA-256 Hash
                </div>
                <div class="nt-hash-display" onclick="NotaryPage.copyHash('${E.wizFileHash}')" title="Click to copy">
                    ${E.wizFileHash}
                    <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                </div>
            </div>

            ${n===null?`
                <div style="text-align:center;padding:12px;color:var(--nt-text-3);font-size:12px">
                    <i class="fa-solid fa-spinner fa-spin" style="margin-right:6px;color:var(--nt-accent)"></i>Checking for duplicates...
                </div>
            `:n!=null&&n.exists?`
                <div class="nt-duplicate-warn" style="margin-bottom:16px">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <i class="fa-solid fa-triangle-exclamation" style="color:#fbbf24;font-size:16px"></i>
                        <span style="font-size:13px;font-weight:700;color:#fbbf24">Document already notarized!</span>
                    </div>
                    <div style="font-size:12px;color:var(--nt-text-2);line-height:1.5">
                        This hash already exists on the blockchain.<br>
                        Token ID: <strong style="color:var(--nt-accent)">#${n.tokenId}</strong><br>
                        Owner: <span style="font-family:monospace;font-size:11px">${Zr(n.owner)}</span><br>
                        Date: ${Jr(n.timestamp)}
                    </div>
                </div>
            `:`
                <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:var(--nt-radius);padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:8px">
                    <i class="fa-solid fa-circle-check" style="color:var(--nt-green)"></i>
                    <span style="font-size:12px;color:var(--nt-green);font-weight:600">Hash unico â€” pronto para notarizar</span>
                </div>
            `}

            <div style="display:flex;gap:10px;margin-top:8px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizRemoveFile()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Change File
                </button>
                <button class="nt-btn-primary" style="flex:2" ${n!=null&&n.exists?"disabled":""} onclick="NotaryPage.wizNext()">
                    Continue<i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        `;return}if(E.wizIsHashing){e.innerHTML=`
            <div style="text-align:center;padding:40px 20px">
                <div style="width:56px;height:56px;border-radius:50%;background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-fingerprint fa-spin" style="font-size:24px;color:var(--nt-accent)"></i>
                </div>
                <div style="font-size:14px;font-weight:600;color:var(--nt-text)">Computing SHA-256...</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:6px">Hash being computed locally in your browser</div>
            </div>
        `;return}e.innerHTML=`
        <div style="text-align:center;margin-bottom:20px">
            <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Upload Document</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">Select a file to certify permanently on the blockchain</div>
        </div>

        <div class="nt-dropzone" id="nt-wiz-dropzone">
            <input type="file" id="nt-wiz-file-input" style="display:none">
            <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:14px">
                <i class="fa-solid fa-cloud-arrow-up" style="font-size:24px;color:var(--nt-accent)"></i>
            </div>
            <div style="font-size:14px;font-weight:600;color:var(--nt-text);margin-bottom:4px">Click or drag file here</div>
            <div style="font-size:11px;color:var(--nt-text-3)">Max 5MB &bull; Any format</div>
        </div>

        <div style="display:flex;align-items:center;justify-content:center;gap:20px;margin-top:16px;font-size:11px;color:var(--nt-text-3)">
            <span><i class="fa-solid fa-shield-halved" style="color:var(--nt-green);margin-right:4px"></i>Local hash</span>
            <span><i class="fa-solid fa-database" style="color:var(--nt-blue);margin-right:4px"></i>IPFS</span>
            <span><i class="fa-solid fa-infinity" style="color:var(--nt-accent);margin-right:4px"></i>Permanent</span>
        </div>
    `,A0()}function A0(){const e=document.getElementById("nt-wiz-dropzone"),t=document.getElementById("nt-wiz-file-input");!e||!t||(e.onclick=()=>t.click(),["dragenter","dragover","dragleave","drop"].forEach(a=>{e.addEventListener(a,n=>{n.preventDefault(),n.stopPropagation()})}),e.addEventListener("dragenter",()=>e.classList.add("drag-over")),e.addEventListener("dragover",()=>e.classList.add("drag-over")),e.addEventListener("dragleave",()=>e.classList.remove("drag-over")),e.addEventListener("drop",a=>{var n,s;e.classList.remove("drag-over"),eo((s=(n=a.dataTransfer)==null?void 0:n.files)==null?void 0:s[0])}),t.addEventListener("change",a=>{var n;return eo((n=a.target.files)==null?void 0:n[0])}))}async function eo(e){if(e){if(e.size>x0){b("File too large (max 5MB)","error");return}E.wizFile=e,E.wizFileHash=null,E.wizDuplicateCheck=null,E.wizIsHashing=!0,be();try{const t=await pt.calculateFileHash(e);E.wizFileHash=t,E.wizIsHashing=!1,be(),E.wizDuplicateCheck=null,be();const a=await pt.verifyByHash(t);E.wizDuplicateCheck=a,be()}catch(t){console.error("[NotaryPage] Hash error:",t),E.wizIsHashing=!1,E.wizFile=null,b("Error computing file hash","error"),be()}}}function Wd(e){const t=E.wizFile,a=Za((t==null?void 0:t.type)||"",(t==null?void 0:t.name)||""),n=E.feesLoaded?me?me.formatEther(E.bkcFee):"1":"...",s=E.feesLoaded?me?me.formatEther(E.ethFee):"0.0001":"...",r=c.currentUserBalance||0n,i=c.currentUserNativeBalance||0n,o=E.feesLoaded?r>=E.bkcFee:!0,l=E.feesLoaded?i>=E.ethFee+((me==null?void 0:me.parseEther("0.001"))||0n):!0,d=o&&l;e.innerHTML=`
        <div style="max-width:420px;margin:0 auto">
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Details & Fees</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">Describe your document and review the fees</div>
            </div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:12px">
                <div style="width:40px;height:40px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                    <i class="${a.icon}" style="font-size:16px;color:${a.color}"></i>
                </div>
                <div style="flex:1;min-width:0">
                    <div style="font-size:12px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${(t==null?void 0:t.name)||"File"}</div>
                    <div style="font-size:10px;color:var(--nt-text-3)">${Qr((t==null?void 0:t.size)||0)}</div>
                </div>
            </div>

            <div style="margin-bottom:16px">
                <label style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;display:block;margin-bottom:6px">
                    Description <span style="font-weight:400;text-transform:none">(optional)</span>
                </label>
                <textarea id="nt-wiz-desc" rows="3"
                    style="width:100%;background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius-sm);padding:12px;font-size:13px;color:var(--nt-text);resize:none;outline:none;font-family:inherit;transition:border-color var(--nt-transition)"
                    onfocus="this.style.borderColor='rgba(245,158,11,0.4)'"
                    onblur="this.style.borderColor='var(--nt-border)'"
                    placeholder="E.g., Property deed signed Jan 2025...">${E.wizDescription}</textarea>
            </div>

            <div class="nt-fee-box" style="margin-bottom:16px">
                <div style="font-size:11px;font-weight:700;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">
                    <i class="fa-solid fa-coins" style="color:var(--nt-accent);margin-right:4px"></i>Service Fees
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">BKC Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-accent);font-family:monospace">${n} BKC</span>
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">ETH Fee (gas fee)</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-blue);font-family:monospace">${s} ETH</span>
                </div>
                ${o?"":`<div style="font-size:11px;color:var(--nt-red);margin-top:8px"><i class="fa-solid fa-circle-xmark" style="margin-right:4px"></i>Insufficient BKC balance (${O(r)} BKC)</div>`}
                ${l?"":'<div style="font-size:11px;color:var(--nt-red);margin-top:4px"><i class="fa-solid fa-circle-xmark" style="margin-right:4px"></i>Insufficient ETH for fee + gas</div>'}
            </div>

            <div style="display:flex;gap:10px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2" ${d?"":"disabled"} onclick="NotaryPage.wizToStep3()">
                    Review<i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        </div>
    `}function P0(e){const t=E.wizFile,a=Za((t==null?void 0:t.type)||"",(t==null?void 0:t.name)||""),n=E.wizDescription||"No description",s=me?me.formatEther(E.bkcFee):"1",r=me?me.formatEther(E.ethFee):"0.0001";e.innerHTML=`
        <div style="max-width:420px;margin:0 auto;text-align:center">
            <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:4px">Confirm & Mint</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-bottom:20px">Review and sign to create your NFT certificate</div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;text-align:left;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:12px;padding-bottom:12px;border-bottom:1px solid var(--nt-border);margin-bottom:12px">
                    <div style="width:44px;height:44px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="${a.icon}" style="font-size:18px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t==null?void 0:t.name}</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">${Qr((t==null?void 0:t.size)||0)}</div>
                    </div>
                </div>
                <div style="font-size:12px;color:var(--nt-text-2);font-style:italic">"${n}"</div>
                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);margin-top:8px;word-break:break-all">
                    <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>${E.wizFileHash}
                </div>
            </div>

            <div class="nt-fee-box" style="margin-bottom:20px">
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">BKC Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-accent);font-family:monospace">${s} BKC</span>
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">ETH Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-blue);font-family:monospace">${r} ETH</span>
                </div>
            </div>

            <div style="display:flex;gap:10px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2" id="nt-btn-mint" onclick="NotaryPage.handleMint()">
                    <i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint
                </button>
            </div>
        </div>
    `}async function B0(){if(E.isProcessing)return;E.isProcessing=!0,E.processStep="SIGNING";const e=document.getElementById("nt-btn-mint");e&&(e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Signing...'),document.getElementById("nt-overlay"),gn("signing");try{const n=await(await c.provider.getSigner()).signMessage("I am signing to authenticate my file for notarization on Backchain.");E.processStep="UPLOADING",gn("uploading");const s=new FormData;s.append("file",E.wizFile),s.append("signature",n),s.append("address",c.userAddress),s.append("description",E.wizDescription||"No description");const r=rt.uploadFileToIPFS||"/api/upload",i=await fetch(r,{method:"POST",body:s,signal:AbortSignal.timeout(18e4)});if(!i.ok)throw i.status===413?new Error("File too large (max 5MB)"):i.status===401?new Error("Signature verification failed"):new Error(`Upload failed (${i.status})`);const o=await i.json(),l=o.ipfsUri||o.metadataUri,d=o.contentHash||E.wizFileHash;if(!l)throw new Error("No IPFS URI returned");if(!d)throw new Error("No content hash returned");E.processStep="MINTING",gn("minting"),await pt.notarize({ipfsCid:l,contentHash:d,description:E.wizDescription||"No description",operator:Z(),button:e,onSuccess:(u,p,m)=>{E.processStep="SUCCESS",gn("success",p),setTimeout(()=>{Ss(),E.wizFile=null,E.wizFileHash=null,E.wizDescription="",E.wizDuplicateCheck=null,E.wizStep=1,E.isProcessing=!1,E.view="documents",E.activeTab="documents",Ba(),be(),ei(),b("Document notarized successfully!","success")},3e3)},onError:u=>{if(u.cancelled||u.type==="user_rejected"){E.isProcessing=!1,Ss(),e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint');return}throw u}})}catch(t){console.error("[NotaryPage] Mint error:",t),Ss(),E.isProcessing=!1,e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint'),t.code!==4001&&t.code!=="ACTION_REJECTED"&&b(t.message||"Notarization failed","error")}}function gn(e,t){const a=document.getElementById("nt-overlay");if(!a)return;a.classList.add("active");const n={signing:{icon:"fa-solid fa-signature",text:"Signing message...",sub:"Confirm in MetaMask",pct:10},uploading:{icon:"fa-solid fa-cloud-arrow-up",text:"Uploading to IPFS...",sub:"Decentralized storage",pct:35},minting:{icon:"fa-solid fa-stamp",text:"Minting on Blockchain...",sub:"Waiting for confirmation",pct:65,animate:!0},success:{icon:"fa-solid fa-check",text:"Notarized!",sub:t?`Token ID #${t}`:"Certificate created",pct:100,success:!0}},s=n[e]||n.signing;if(a.innerHTML=`
        <div style="text-align:center;padding:24px;max-width:360px">
            <div style="width:100px;height:100px;margin:0 auto 24px;position:relative">
                ${s.success?"":`
                    <div style="position:absolute;inset:-4px;border-radius:50%;border:3px solid transparent;border-top-color:var(--nt-accent);border-right-color:rgba(245,158,11,0.3);animation:nt-spin 1s linear infinite"></div>
                `}
                <div style="width:100%;height:100%;border-radius:50%;background:${s.success?"rgba(34,197,94,0.15)":"var(--nt-bg3)"};display:flex;align-items:center;justify-content:center;border:2px solid ${s.success?"var(--nt-green)":"rgba(245,158,11,0.2)"}">
                    <i class="${s.icon}" style="font-size:36px;color:${s.success?"var(--nt-green)":"var(--nt-accent)"};${s.animate?"animation:nt-stamp 0.6s ease":""}"></i>
                </div>
            </div>
            <div style="font-size:18px;font-weight:700;color:var(--nt-text);margin-bottom:6px">${s.text}</div>
            <div style="font-size:12px;color:${s.success?"var(--nt-green)":"var(--nt-accent)"};font-family:monospace;margin-bottom:16px">${s.sub}</div>
            <div style="width:100%;height:4px;background:var(--nt-bg3);border-radius:2px;overflow:hidden">
                <div style="height:100%;width:${s.pct}%;background:linear-gradient(90deg,var(--nt-accent),${s.success?"var(--nt-green)":"#fbbf24"});border-radius:2px;transition:width 0.5s ease"></div>
            </div>
            ${s.success?"":'<div style="font-size:10px;color:var(--nt-text-3);margin-top:12px">Do not close this window</div>'}
        </div>
    `,!document.getElementById("nt-spin-kf")){const r=document.createElement("style");r.id="nt-spin-kf",r.textContent="@keyframes nt-spin { to { transform: rotate(360deg); } }",document.head.appendChild(r)}}function Ss(){const e=document.getElementById("nt-overlay");e&&e.classList.remove("active")}function S0(e){e.innerHTML=`
        <div class="nt-card" style="margin-top:16px">
            <div style="text-align:center;margin-bottom:20px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-shield-check" style="font-size:22px;color:var(--nt-green)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Public Verification</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px;max-width:380px;margin-left:auto;margin-right:auto">
                    Verify if a document was notarized on the blockchain. <strong style="color:var(--nt-green)">No wallet needed.</strong>
                </div>
            </div>

            <div class="nt-dropzone" id="nt-verify-dropzone" style="margin-bottom:16px">
                <input type="file" id="nt-verify-file-input" style="display:none">
                <div style="width:48px;height:48px;border-radius:var(--nt-radius);background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-magnifying-glass" style="font-size:20px;color:var(--nt-green)"></i>
                </div>
                <div style="font-size:14px;font-weight:600;color:var(--nt-text);margin-bottom:4px">Drag a file to verify</div>
                <div style="font-size:11px;color:var(--nt-text-3)">The SHA-256 hash will be computed locally</div>
            </div>

            <div id="nt-verify-result"></div>
        </div>
    `,z0(),E.verifyResult&&Gd()}function z0(){const e=document.getElementById("nt-verify-dropzone"),t=document.getElementById("nt-verify-file-input");!e||!t||(e.onclick=()=>t.click(),["dragenter","dragover","dragleave","drop"].forEach(a=>{e.addEventListener(a,n=>{n.preventDefault(),n.stopPropagation()})}),e.addEventListener("dragenter",()=>e.classList.add("drag-over")),e.addEventListener("dragover",()=>e.classList.add("drag-over")),e.addEventListener("dragleave",()=>e.classList.remove("drag-over")),e.addEventListener("drop",a=>{var n,s;e.classList.remove("drag-over"),to((s=(n=a.dataTransfer)==null?void 0:n.files)==null?void 0:s[0])}),t.addEventListener("change",a=>{var n;return to((n=a.target.files)==null?void 0:n[0])}))}async function to(e){if(!e)return;E.verifyFile=e,E.verifyHash=null,E.verifyResult=null,E.verifyIsChecking=!0;const t=document.getElementById("nt-verify-result");t&&(t.innerHTML=`
            <div style="text-align:center;padding:20px;color:var(--nt-text-3);font-size:13px">
                <i class="fa-solid fa-spinner fa-spin" style="margin-right:6px;color:var(--nt-accent)"></i>Computing hash and verifying...
            </div>
        `);try{const a=await pt.calculateFileHash(e);E.verifyHash=a;const n=await pt.verifyByHash(a);E.verifyResult=n,E.verifyIsChecking=!1,Gd()}catch(a){console.error("[NotaryPage] Verify error:",a),E.verifyIsChecking=!1,t&&(t.innerHTML=`
                <div class="nt-not-found" style="text-align:center">
                    <i class="fa-solid fa-circle-xmark" style="font-size:20px;color:var(--nt-red);margin-bottom:8px"></i>
                    <div style="font-size:13px;color:var(--nt-red)">Verification error: ${a.message}</div>
                </div>
            `)}}function Gd(){const e=document.getElementById("nt-verify-result");if(!e||!E.verifyResult)return;const t=E.verifyResult,a=E.verifyFile;t.exists?e.innerHTML=`
            <div class="nt-verified">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
                    <div style="width:40px;height:40px;border-radius:50%;background:rgba(34,197,94,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="fa-solid fa-shield-check" style="font-size:18px;color:var(--nt-green)"></i>
                    </div>
                    <div>
                        <div style="font-size:15px;font-weight:700;color:var(--nt-green)">Document Verified!</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">This document was notarized on the blockchain</div>
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Token ID</div>
                        <div style="font-size:16px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.tokenId}</div>
                    </div>
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Data</div>
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${Jr(t.timestamp)}</div>
                    </div>
                </div>

                <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px;margin-bottom:12px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Owner</div>
                    <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${t.owner}</div>
                </div>

                ${E.verifyHash?`
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">SHA-256 Hash</div>
                        <div style="font-size:10px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${E.verifyHash}</div>
                    </div>
                `:""}

                <div style="margin-top:12px;display:flex;gap:8px">
                    <a href="${Xr}${y==null?void 0:y.notary}?a=${t.tokenId}" target="_blank" class="nt-btn-secondary" style="font-size:12px;padding:8px 14px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i>View on Arbiscan
                    </a>
                </div>
            </div>
        `:e.innerHTML=`
            <div class="nt-not-found">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
                    <div style="width:40px;height:40px;border-radius:50%;background:rgba(239,68,68,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="fa-solid fa-circle-xmark" style="font-size:18px;color:var(--nt-red)"></i>
                    </div>
                    <div>
                        <div style="font-size:15px;font-weight:700;color:var(--nt-red)">Not Found</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">This document was not notarized on the blockchain</div>
                    </div>
                </div>

                ${a?`<div style="font-size:12px;color:var(--nt-text-3);margin-bottom:8px">File: <strong style="color:var(--nt-text-2)">${a.name}</strong></div>`:""}
                ${E.verifyHash?`
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">SHA-256 Hash</div>
                        <div style="font-size:10px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${E.verifyHash}</div>
                    </div>
                `:""}
            </div>
        `}function N0(e){if(E.statsLoading&&!E.stats){e.innerHTML=`
            <div class="nt-stat-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>'<div class="nt-stat-card"><div class="nt-shimmer" style="height:32px;width:60%;margin:0 auto 8px"></div><div class="nt-shimmer" style="height:12px;width:40%;margin:0 auto"></div></div>').join("")}
            </div>
        `;return}const t=E.stats,a=E.totalSupply;e.innerHTML=`
        <div style="margin-top:16px">
            <div class="nt-stat-grid">
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-stamp" style="font-size:16px;color:var(--nt-accent)"></i>
                    </div>
                    <div class="nt-stat-value">${(t==null?void 0:t.totalNotarizations)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Notarizations</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-certificate" style="font-size:16px;color:var(--nt-green)"></i>
                    </div>
                    <div class="nt-stat-value">${a??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Certificates</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(251,191,36,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-coins" style="font-size:16px;color:#fbbf24"></i>
                    </div>
                    <div class="nt-stat-value" style="font-size:18px">${(t==null?void 0:t.totalBKCFormatted)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">BKC Collected</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(96,165,250,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-brands fa-ethereum" style="font-size:16px;color:var(--nt-blue)"></i>
                    </div>
                    <div class="nt-stat-value" style="font-size:18px">${(t==null?void 0:t.totalETHFormatted)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">ETH Collected</div>
                </div>
            </div>

            <!-- Recent notarizations -->
            <div class="nt-card" style="margin-top:16px;padding:0;overflow:hidden">
                <div style="padding:16px 20px;border-bottom:1px solid var(--nt-border)">
                    <div style="font-size:13px;font-weight:700;color:var(--nt-text)">
                        <i class="fa-solid fa-clock-rotate-left" style="color:var(--nt-accent);margin-right:6px"></i>Recent Notarizations
                    </div>
                </div>
                <div id="nt-recent-feed">
                    ${E.recentNotarizations.length===0?`
                        <div style="text-align:center;padding:32px 20px;color:var(--nt-text-3);font-size:13px">
                            ${E.statsLoading?'<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Loading...':"No recent notarizations found"}
                        </div>
                    `:E.recentNotarizations.map(n=>`
                        <div class="nt-recent-item">
                            <div style="width:36px;height:36px;border-radius:50%;background:var(--nt-accent-glow);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                                <i class="fa-solid fa-stamp" style="font-size:14px;color:var(--nt-accent)"></i>
                            </div>
                            <div style="flex:1;min-width:0">
                                <div style="font-size:12px;font-weight:600;color:var(--nt-text)">Certificate #${n.tokenId}</div>
                                <div style="font-size:11px;color:var(--nt-text-3)">${Zr(n.owner)}</div>
                            </div>
                            <div style="text-align:right;flex-shrink:0">
                                <div style="font-size:11px;color:var(--nt-text-3)">${Hd(n.timestamp)}</div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>

            <div style="text-align:center;margin-top:16px">
                <a href="${Xr}${y==null?void 0:y.notary}" target="_blank" class="nt-btn-secondary" style="font-size:12px;padding:10px 20px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>View Contract on Arbiscan
                </a>
            </div>
        </div>
    `}function $0(e){var s;const t=E.selectedCert;if(!t){jd();return}const a=Ud(t.ipfs),n=Za(t.mimeType||"",t.description||"");(t.mimeType||"").includes("image")||/\.(jpg|jpeg|png|gif|webp|svg|bmp)$/i.test(t.fileName||t.description||""),e.innerHTML=`
        <div class="nt-detail" style="margin-top:8px">
            <!-- Image Preview (large, clickable) -->
            ${a?`
                <a href="${a}" target="_blank" style="display:block;text-decoration:none;margin-bottom:16px">
                    <div style="min-height:240px;max-height:400px;background:var(--nt-bg3);border-radius:var(--nt-radius);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid var(--nt-border);cursor:pointer;transition:border-color var(--nt-transition)" onmouseover="this.style.borderColor='rgba(245,158,11,0.3)'" onmouseout="this.style.borderColor='var(--nt-border)'">
                        <img src="${a}" style="width:100%;height:100%;object-fit:contain;max-height:400px" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="Certificate #${t.id}">
                        <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:240px;position:absolute;inset:0;background:var(--nt-bg3)">
                            <i class="${n.icon}" style="font-size:48px;color:${n.color};margin-bottom:8px"></i>
                            <span style="font-size:12px;color:var(--nt-text-3)">${n.label} file</span>
                        </div>
                        <div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.id}</div>
                        <div style="position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,0.75);padding:4px 10px;border-radius:8px;font-size:10px;color:var(--nt-text-2)">
                            <i class="fa-solid fa-expand" style="margin-right:4px"></i>Click to view full size
                        </div>
                    </div>
                </a>
            `:`
                <div style="height:200px;background:var(--nt-bg3);border-radius:var(--nt-radius);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;margin-bottom:16px;border:1px solid var(--nt-border)">
                    <div style="text-align:center">
                        <i class="${n.icon}" style="font-size:48px;color:${n.color};margin-bottom:8px"></i>
                        <div style="font-size:12px;color:var(--nt-text-3)">${n.label} file</div>
                    </div>
                    <div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.id}</div>
                </div>
            `}

            <!-- Add to Wallet â€” Primary Action -->
            <button class="nt-btn-primary" style="width:100%;padding:14px;font-size:15px;margin-bottom:16px;display:flex;align-items:center;justify-content:center;gap:8px" onclick="NotaryPage.addToWallet('${t.id}', '${a}')">
                <i class="fa-solid fa-wallet"></i>Add Certificate to Wallet
            </button>

            <!-- Description -->
            <div class="nt-card" style="margin-bottom:12px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">Description</div>
                <div style="font-size:14px;color:var(--nt-text);line-height:1.5">${((s=t.description)==null?void 0:s.split("---")[0].trim())||"Notarized Document"}</div>
            </div>

            <!-- Content Hash -->
            <div class="nt-card" style="margin-bottom:12px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">
                    <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>Content Hash (SHA-256)
                </div>
                <div class="nt-hash-display" onclick="NotaryPage.copyHash('${t.hash}')" title="Click to copy">
                    ${t.hash||"N/A"}
                    <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                </div>
            </div>

            <!-- Metadata grid -->
            <div class="nt-detail-meta" style="margin-bottom:12px">
                <div class="nt-card" style="padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Date</div>
                    <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${Jr(t.timestamp)||"N/A"}</div>
                </div>
                <div class="nt-card" style="padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Owner</div>
                    <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2)">${Zr(t.owner||c.userAddress)}</div>
                </div>
            </div>

            ${t.ipfs?`
                <div class="nt-card" style="margin-bottom:12px;padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">IPFS CID</div>
                    <div style="font-size:11px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${t.ipfs}</div>
                </div>
            `:""}

            <!-- Secondary Actions -->
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                ${a?`
                    <a href="${a}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-download"></i>Download from IPFS
                    </a>
                `:""}
                <a href="${Xr}${y==null?void 0:y.notary}?a=${t.id}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>View on Arbiscan
                </a>
                ${t.txHash?`
                    <a href="${h0}${t.txHash}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-receipt"></i>Transaction
                    </a>
                `:""}
            </div>
        </div>
    `}async function L0(){try{const e=await pt.getFee();E.bkcFee=e.bkcFee,E.ethFee=e.ethFee,E.feesLoaded=!0}catch{E.bkcFee=(me==null?void 0:me.parseEther("1"))||0n,E.ethFee=(me==null?void 0:me.parseEther("0.0001"))||0n,E.feesLoaded=!0}}async function ei(){if(!c.isConnected||!c.userAddress)return;E.certsLoading=!0,be();let e=!1;try{const t=rt.getNotaryHistory;console.log("[NotaryPage] Loading certificates from API:",`${t}/${c.userAddress}`);const a=await fetch(`${t}/${c.userAddress}`);if(!a.ok)throw new Error(`API ${a.status}`);const n=await a.json();console.log("[NotaryPage] API response:",typeof n,Array.isArray(n)?`array(${n.length})`:JSON.stringify(n).substring(0,200));const s=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.documents)?n.documents:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.history)?n.history:null;s&&s.length>0&&(E.certificates=s.map(r=>({id:r.tokenId||r.id||"?",ipfs:r.ipfsCid||r.ipfsUri||"",description:r.description||"",hash:r.contentHash||"",timestamp:r.createdAt||r.timestamp||"",txHash:r.txHash||r.transactionHash||"",owner:r.owner||c.userAddress,mimeType:r.mimeType||"",fileName:r.fileName||""})).sort((r,i)=>parseInt(i.id)-parseInt(r.id)),e=!0,console.log("[NotaryPage] Loaded",E.certificates.length,"certificates from API"))}catch(t){console.warn("[NotaryPage] API failed:",t.message)}if(!e){console.log("[NotaryPage] Trying on-chain event fallback...");try{const t=await R0();E.certificates=t,console.log("[NotaryPage] Loaded",t.length,"certificates from chain events")}catch(t){console.error("[NotaryPage] Chain fallback also failed:",t),E.certificates=[]}}E.certsLoading=!1,be()}async function R0(){if(!me||!(y!=null&&y.notary))return console.warn("[NotaryPage] Chain fallback: missing ethers or contract address"),[];const{NetworkManager:e}=await Y(async()=>{const{NetworkManager:o}=await Promise.resolve().then(()=>ae);return{NetworkManager:o}},void 0),t=e.getProvider();if(!t)return console.warn("[NotaryPage] Chain fallback: no provider available"),[];console.log("[NotaryPage] Querying Certified events for:",c.userAddress);const a=new me.Contract(y.notary,Od,t),n=a.filters.Certified(null,c.userAddress),s=await t.getBlockNumber(),r=Math.max(0,s-5e4);console.log("[NotaryPage] Block range:",r,"->",s);const i=await a.queryFilter(n,r,s);return console.log("[NotaryPage] Found",i.length,"events"),i.map(o=>({id:Number(o.args.certId),hash:o.args.documentHash||"",docType:Number(o.args.docType||0),timestamp:null,txHash:o.transactionHash,owner:o.args.owner})).sort((o,l)=>l.id-o.id)}async function _0(){E.statsLoading=!0;try{const[e,t]=await Promise.all([pt.getStats(),pt.getTotalDocuments()]);E.stats=e,E.totalSupply=t}catch(e){console.warn("[NotaryPage] Stats load error:",e)}try{await F0()}catch{}E.statsLoading=!1,E.view==="stats"&&be()}async function F0(){if(!me||!(y!=null&&y.notary))return;const{NetworkManager:e}=await Y(async()=>{const{NetworkManager:l}=await Promise.resolve().then(()=>ae);return{NetworkManager:l}},void 0),t=e.getProvider();if(!t)return;const a=new me.Contract(y.notary,Od,t),n=a.filters.Certified(),s=await t.getBlockNumber(),r=Math.max(0,s-5e3),o=(await a.queryFilter(n,r,s)).slice(-20).reverse();E.recentNotarizations=o.map(l=>({tokenId:Number(l.args.certId),owner:l.args.owner,hash:l.args.documentHash,docType:Number(l.args.docType||0),timestamp:null,blockNumber:l.blockNumber}));try{const l=[...new Set(o.map(u=>u.blockNumber))],d={};await Promise.all(l.slice(0,10).map(async u=>{const p=await t.getBlock(u);p&&(d[u]=p.timestamp)})),E.recentNotarizations.forEach(u=>{d[u.blockNumber]&&(u.timestamp=d[u.blockNumber])})}catch{}}async function M0(e,t){var a,n;try{const s=l=>{var u;if(!l)return"";if(l.startsWith("https://")&&!l.includes("/ipfs/"))return l;const d=l.startsWith("ipfs://")?l.replace("ipfs://",""):l.includes("/ipfs/")?(u=l.split("/ipfs/")[1])==null?void 0:u.split("?")[0]:"";return d?`${Cn[0]}${d}`:l};let r=s(t||"");if(c.notaryContract)try{const l=await c.notaryContract.tokenURI(e);if(l!=null&&l.startsWith("data:application/json;base64,")){const d=JSON.parse(atob(l.replace("data:application/json;base64,","")));d.image&&(r=s(d.image))}}catch{}const i=(y==null?void 0:y.notary)||((a=c.notaryContract)==null?void 0:a.target)||((n=c.notaryContract)!=null&&n.getAddress?await c.notaryContract.getAddress():null);if(!i){b("Contract address not found","error");return}b(`Adding NFT #${e} to wallet...`,"info"),await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:i,tokenId:String(e),image:r}}})&&b(`NFT #${e} added to wallet!`,"success")}catch(s){if(s.code===4001)return;b("Could not add NFT","error")}}function D0(e){e&&navigator.clipboard.writeText(e).then(()=>{b("Hash copied!","success")}).catch(()=>{b("Failed to copy","error")})}function O0(){var e;E.wizStep===1&&E.wizFileHash&&!((e=E.wizDuplicateCheck)!=null&&e.exists)?E.wizStep=2:E.wizStep===2&&(E.wizStep=3),be()}function H0(){E.wizStep>1&&(E.wizStep--,be())}function U0(){const e=document.getElementById("nt-wiz-desc");e&&(E.wizDescription=e.value||""),E.wizStep=3,be()}function j0(){E.wizFile=null,E.wizFileHash=null,E.wizDuplicateCheck=null,E.wizStep=1,be()}function W0(e){const t=E.certificates.find(a=>String(a.id)===String(e));t&&v0("cert-detail",t)}const Yd={async render(e){e&&k0()},reset(){E.wizFile=null,E.wizFileHash=null,E.wizDescription="",E.wizDuplicateCheck=null,E.wizStep=1,E.view="documents",E.activeTab="documents",E.viewHistory=[],be(),Ba()},update(){if(!E.isProcessing&&E.view==="notarize"){const e=document.getElementById("nt-wiz-panel");e&&E.wizStep===2&&Wd(e)}},refreshHistory(){ei()},setTab:w0,goBack:jd,viewCert:W0,handleMint:B0,addToWallet:M0,copyHash:D0,wizNext:O0,wizBack:H0,wizToStep3:U0,wizRemoveFile:j0};window.NotaryPage=Yd;const ti=window.ethers,qs={Diamond:{emoji:"ðŸ’Ž",color:"#22d3ee",bg:"rgba(34,211,238,0.15)",border:"rgba(34,211,238,0.3)",keepRate:100,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq"},Gold:{emoji:"ðŸ¥‡",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",border:"rgba(251,191,36,0.3)",keepRate:90,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44"},Silver:{emoji:"ðŸ¥ˆ",color:"#9ca3af",bg:"rgba(156,163,175,0.15)",border:"rgba(156,163,175,0.3)",keepRate:75,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4"},Bronze:{emoji:"ðŸ¥‰",color:"#fb923c",bg:"rgba(251,146,60,0.15)",border:"rgba(251,146,60,0.3)",keepRate:60,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m"}},L={activeTab:"marketplace",filterTier:"ALL",sortBy:"boost-high",selectedListing:null,isLoading:!1,isTransactionPending:!1,countdownIntervals:[],pendingEarningsAmount:0n,marketStats:null},mt=e=>e==null?"":String(e),G0=(e,t)=>mt(e)===mt(t),Wa=(e,t)=>e&&t&&e.toLowerCase()===t.toLowerCase();function Qa(e){return Te.find(t=>t.boostBips===Number(e))||{name:"Unknown",boostBips:0}}function fs(e){return qs[e]||{emoji:"ðŸ’Ž",color:"#71717a",bg:"rgba(113,113,122,0.15)",border:"rgba(113,113,122,0.3)",keepRate:50}}function tt(e){if(!e)return"0";const t=parseFloat(ti.formatEther(BigInt(e)));return t===0?"0":t<1e-4?"<0.0001":t<.01?t.toFixed(4):t<1?t.toFixed(3):t.toFixed(2)}function Kd(e){const t=e-Math.floor(Date.now()/1e3);if(t<=0)return{text:"Expired",expired:!0,seconds:0};const a=Math.floor(t/3600),n=Math.floor(t%3600/60),s=t%60;return a>0?{text:`${a}h ${n}m`,expired:!1,seconds:t}:n>0?{text:`${n}m ${s}s`,expired:!1,seconds:t}:{text:`${s}s`,expired:!1,seconds:t}}function Y0(){if(document.getElementById("boost-market-styles"))return;const e=document.createElement("style");e.id="boost-market-styles",e.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V9.0 Boost Market Styles
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        @keyframes bm-float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }
        @keyframes bm-card-in {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes bm-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .bm-float { animation: bm-float 4s ease-in-out infinite; }

        /* Main Cards */
        .bm-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        /* NFT Cards */
        .bm-nft-card {
            background: linear-gradient(165deg, rgba(24,24,27,0.98) 0%, rgba(15,15,17,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 20px;
            overflow: hidden;
            animation: bm-card-in 0.5s ease-out forwards;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bm-nft-card:hover {
            transform: translateY(-6px);
            border-color: rgba(34,197,94,0.4);
            box-shadow: 0 25px 50px -15px rgba(0,0,0,0.5), 0 0 30px -10px rgba(34,197,94,0.15);
        }
        .bm-nft-card.owned { border-color: rgba(59,130,246,0.3); }
        .bm-nft-card.rented-out { opacity: 0.7; }
        .bm-nft-card.rented-out:hover { transform: none; }

        /* Tier Badge */
        .bm-tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tabs */
        .bm-tab {
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.25s;
            cursor: pointer;
            color: #71717a;
            white-space: nowrap;
            border: none;
            background: transparent;
        }
        .bm-tab:hover:not(.active) {
            color: #a1a1aa;
            background: rgba(63,63,70,0.3);
        }
        .bm-tab.active {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #000;
            box-shadow: 0 4px 20px rgba(34,197,94,0.35);
        }
        .bm-tab .tab-count {
            display: inline-flex;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            margin-left: 6px;
            font-size: 10px;
            font-weight: 700;
            border-radius: 9px;
            background: rgba(0,0,0,0.25);
            align-items: center;
            justify-content: center;
        }

        /* Filter Chips */
        .bm-filter {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.25s;
            cursor: pointer;
            border: 1px solid transparent;
            background: rgba(39,39,42,0.7);
            color: #71717a;
        }
        .bm-filter:hover:not(.active) {
            color: #fff;
            background: rgba(63,63,70,0.7);
        }
        .bm-filter.active {
            background: rgba(34,197,94,0.15);
            color: #22c55e;
            border-color: rgba(34,197,94,0.3);
        }

        /* Buttons */
        .bm-btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34,197,94,0.4);
        }
        .bm-btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .bm-btn-secondary {
            background: rgba(63,63,70,0.8);
            color: #a1a1aa;
            font-weight: 600;
            border: 1px solid rgba(63,63,70,0.8);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-secondary:hover {
            background: rgba(63,63,70,1);
            color: #fff;
        }

        .bm-btn-danger {
            background: rgba(239,68,68,0.15);
            color: #f87171;
            font-weight: 600;
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-danger:hover {
            background: rgba(239,68,68,0.25);
        }

        .bm-btn-amber {
            background: rgba(251,191,36,0.15);
            color: #fbbf24;
            font-weight: 600;
            border: 1px solid rgba(251,191,36,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-amber:hover {
            background: rgba(251,191,36,0.25);
        }

        /* Timer */
        .bm-timer {
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 8px;
        }
        .bm-timer.active {
            background: rgba(34,197,94,0.15);
            color: #22c55e;
            border: 1px solid rgba(34,197,94,0.25);
        }
        .bm-timer.warning {
            background: rgba(245,158,11,0.15);
            color: #f59e0b;
            border: 1px solid rgba(245,158,11,0.25);
        }
        .bm-timer.critical {
            background: rgba(239,68,68,0.15);
            color: #ef4444;
            border: 1px solid rgba(239,68,68,0.25);
            animation: bm-pulse 1s infinite;
        }

        /* Modal */
        .bm-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .bm-modal.active { display: flex; }
        .bm-modal-content {
            background: linear-gradient(145deg, rgba(39,39,42,0.98) 0%, rgba(24,24,27,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Empty State */
        .bm-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        /* How It Works Steps */
        .bm-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        .bm-step-num {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            flex-shrink: 0;
        }

        /* Rented overlay */
        .bm-rented-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            border-radius: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .bm-stats-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .bm-nft-grid { grid-template-columns: 1fr !important; }
            .bm-how-grid { grid-template-columns: 1fr !important; }
        }
    `,document.head.appendChild(e)}function Xs(){const e=document.getElementById("rental");if(!e)return;Y0();const t=c.rentalListings||[],a=t.filter(i=>c.isConnected&&Wa(i.owner,c.userAddress)),n=Math.floor(Date.now()/1e3),s=(c.myRentals||[]).filter(i=>Wa(i.tenant,c.userAddress)&&Number(i.endTime)>n),r=L.marketStats;e.innerHTML=`
        <div class="max-w-6xl mx-auto px-4 py-6">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-green-600/20 border border-emerald-500/30 flex items-center justify-center bm-float">
                        <i class="fa-solid fa-rocket text-2xl text-emerald-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Boost Market</h1>
                        <p class="text-sm text-zinc-500">Rent NFT Boosters. Keep more rewards.</p>
                    </div>
                </div>
                <div id="bm-header-actions">
                    ${c.isConnected?`
                        <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            <span class="text-emerald-400 text-sm font-medium">Connected</span>
                        </div>
                    `:`
                        <button onclick="window.openConnectModal && window.openConnectModal()"
                            class="bm-btn-primary px-6 py-2.5 text-sm">
                            <i class="fa-solid fa-wallet mr-2"></i>Connect
                        </button>
                    `}
                </div>
            </div>

            <!-- How It Works -->
            <div class="bm-card p-5 mb-6" style="border-color: rgba(34,197,94,0.15);">
                <div class="flex items-center gap-2 mb-4">
                    <i class="fa-solid fa-circle-info text-emerald-400 text-sm"></i>
                    <h3 class="text-sm font-bold text-white">How It Works</h3>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 bm-how-grid">
                    <div class="bm-step">
                        <div class="bm-step-num bg-emerald-500/15 text-emerald-400 border border-emerald-500/25">1</div>
                        <div>
                            <p class="text-sm font-bold text-white">List</p>
                            <p class="text-xs text-zinc-500">Owners list NFTs and set ETH price per hour</p>
                        </div>
                    </div>
                    <div class="bm-step">
                        <div class="bm-step-num bg-blue-500/15 text-blue-400 border border-blue-500/25">2</div>
                        <div>
                            <p class="text-sm font-bold text-white">Rent</p>
                            <p class="text-xs text-zinc-500">Tenants rent to reduce burn rate on staking claims</p>
                        </div>
                    </div>
                    <div class="bm-step">
                        <div class="bm-step-num bg-amber-500/15 text-amber-400 border border-amber-500/25">3</div>
                        <div>
                            <p class="text-sm font-bold text-white">Earn</p>
                            <p class="text-xs text-zinc-500">Owners withdraw accumulated ETH earnings anytime</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6 bm-stats-grid">
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-emerald-400 font-mono">${t.length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Listed</p>
                </div>
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-blue-400 font-mono">${t.filter(i=>i.isRented||i.currentlyRented).length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Rented</p>
                </div>
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-amber-400 font-mono">${r?r.totalRentals:"â€”"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Total Rentals</p>
                </div>
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-purple-400 font-mono"><i class="fa-brands fa-ethereum text-lg mr-1"></i>${r?tt(r.totalVolume):"â€”"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Volume (ETH)</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex flex-wrap items-center gap-2 mb-6 pb-4 border-b border-zinc-800/50">
                <button class="bm-tab ${L.activeTab==="marketplace"?"active":""}" data-tab="marketplace">
                    <i class="fa-solid fa-store mr-2"></i>Marketplace
                </button>
                <button class="bm-tab ${L.activeTab==="my-listings"?"active":""}" data-tab="my-listings">
                    <i class="fa-solid fa-tags mr-2"></i>My Listings
                    <span class="tab-count">${a.length}</span>
                </button>
                <button class="bm-tab ${L.activeTab==="my-rentals"?"active":""}" data-tab="my-rentals">
                    <i class="fa-solid fa-clock-rotate-left mr-2"></i>My Rentals
                    <span class="tab-count">${s.length}</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div id="bm-tab-content"></div>
        </div>

        <!-- Modals -->
        ${J0()}
        ${Z0()}
    `,Q0(),Fa()}function Fa(){const e=document.getElementById("bm-tab-content");if(e){switch(L.activeTab){case"marketplace":e.innerHTML=K0();break;case"my-listings":e.innerHTML=V0();break;case"my-rentals":e.innerHTML=q0();break}L.activeTab==="my-rentals"&&ob()}}function K0(){const e=c.rentalListings||[],t=Math.floor(Date.now()/1e3);let a=e.filter(n=>!(n.isRented||n.currentlyRented||n.rentalEndTime&&Number(n.rentalEndTime)>t||L.filterTier!=="ALL"&&Qa(n.boostBips).name!==L.filterTier));return a.sort((n,s)=>{const r=BigInt(n.pricePerHour||0),i=BigInt(s.pricePerHour||0);return L.sortBy==="price-low"?r<i?-1:r>i?1:0:L.sortBy==="price-high"?r>i?-1:r<i?1:0:(s.boostBips||0)-(n.boostBips||0)}),`
        <div>
            <!-- Filters & Sort -->
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="bm-filter ${L.filterTier==="ALL"?"active":""}" data-filter="ALL">All Tiers</button>
                    ${Object.keys(qs).map(n=>`
                        <button class="bm-filter ${L.filterTier===n?"active":""}" data-filter="${n}">
                            ${qs[n].emoji} ${n}
                        </button>
                    `).join("")}
                </div>
                <div class="flex items-center gap-3">
                    <select id="bm-sort" class="bg-zinc-800/80 border border-zinc-700 rounded-xl px-4 py-2.5 text-sm text-white outline-none cursor-pointer">
                        <option value="boost-high" ${L.sortBy==="boost-high"?"selected":""}>Best Boost First</option>
                        <option value="price-low" ${L.sortBy==="price-low"?"selected":""}>Price: Low to High</option>
                        <option value="price-high" ${L.sortBy==="price-high"?"selected":""}>Price: High to Low</option>
                    </select>
                    ${c.isConnected?`
                        <button id="bm-open-list" class="bm-btn-primary px-5 py-2.5 text-sm">
                            <i class="fa-solid fa-plus mr-2"></i>List NFT
                        </button>
                    `:""}
                </div>
            </div>

            <!-- NFT Grid -->
            ${a.length===0?ai("No NFTs Available","Be the first to list your NFT booster!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 bm-nft-grid">
                    ${a.map((n,s)=>Vd(n,s,!1)).join("")}
                </div>
            `}
        </div>
    `}function Vd(e,t,a=!1){const n=Qa(e.boostBips),s=fs(n.name),r=tt(e.pricePerHour),i=mt(e.tokenId),o=c.isConnected&&Wa(e.owner,c.userAddress),l=e.isRented||e.currentlyRented,d=ut(e.boostBips||0);return`
        <div class="bm-nft-card ${o?"owned":""} ${l?"rented-out":""}"
             style="animation-delay:${t*60}ms">

            <!-- Header -->
            <div class="flex items-center justify-between p-4 pb-0">
                <div class="bm-tier-badge" style="background:${s.bg};color:${s.color};border:1px solid ${s.border}">
                    ${s.emoji} ${n.name}
                </div>
                <span class="text-sm font-bold font-mono" style="color:${s.color}">
                    Keep ${d}%
                </span>
            </div>

            <!-- NFT Display -->
            <div class="relative aspect-square flex items-center justify-center p-6">
                <div class="absolute inset-0 rounded-2xl opacity-50"
                     style="background: radial-gradient(circle at center, ${s.color}15 0%, transparent 70%);"></div>
                <img src="${s.image}" alt="${n.name} Booster"
                     class="w-4/5 h-4/5 object-contain bm-float rounded-xl"
                     onerror="this.outerHTML='<div class=\\'text-7xl bm-float\\'>${s.emoji}</div>'">

                ${o?`
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-full bg-blue-500/20 border border-blue-500/30 text-blue-400 text-[10px] font-bold">
                        <i class="fa-solid fa-user mr-1"></i>YOURS
                    </div>
                `:""}

                ${l&&!o?`
                    <div class="bm-rented-overlay">
                        <i class="fa-solid fa-lock text-3xl text-zinc-400 mb-2"></i>
                        <span class="text-xs text-zinc-300 font-semibold">Currently Rented</span>
                    </div>
                `:""}
            </div>

            <!-- Info -->
            <div class="p-4 pt-0">
                <div class="flex items-baseline justify-between mb-2">
                    <h3 class="text-base font-bold text-white">${n.name} Booster</h3>
                    <span class="text-xs font-mono" style="color:${s.color}">#${i}</span>
                </div>

                <p class="text-xs ${d===100?"text-emerald-400":"text-zinc-500"} mb-4">
                    ${d===100?"Keep 100% of your staking rewards!":`Save ${d-50}% on claim burns`}
                </p>

                <div class="h-px bg-gradient-to-r from-transparent via-zinc-700 to-transparent mb-4"></div>

                <!-- Price & Actions -->
                <div class="flex items-end justify-between">
                    <div>
                        <span class="text-[10px] text-zinc-500 uppercase block mb-1">Price/Hour</span>
                        <div class="flex items-baseline gap-1.5">
                            <i class="fa-brands fa-ethereum text-blue-400 text-sm"></i>
                            <span class="text-xl font-bold text-white">${r}</span>
                            <span class="text-xs text-zinc-500">ETH</span>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        ${o?`
                            <button class="bm-share-btn bm-btn-secondary px-3 py-2 text-xs" data-id="${i}" title="Share listing">
                                <i class="fa-solid fa-share-nodes"></i>
                            </button>
                            <button class="bm-withdraw-btn bm-btn-danger px-4 py-2 text-xs" data-id="${i}" ${l?"disabled":""}>
                                <i class="fa-solid fa-arrow-right-from-bracket mr-1"></i>Withdraw
                            </button>
                        `:`
                            <button class="bm-rent-btn bm-btn-primary px-5 py-2.5 text-sm" data-id="${i}" ${l?"disabled":""}>
                                <i class="fa-solid fa-bolt mr-1"></i>Rent
                            </button>
                        `}
                    </div>
                </div>
            </div>
        </div>
    `}function V0(){if(!c.isConnected)return qd("View your listings");const e=c.rentalListings||[],t=e.filter(r=>Wa(r.owner,c.userAddress)),a=new Set(e.map(r=>mt(r.tokenId))),n=(c.myBoosters||[]).filter(r=>!a.has(mt(r.tokenId))),s=t.reduce((r,i)=>r+BigInt(i.totalEarnings||0),0n);return`
        <div>
            <!-- Earnings Card -->
            <div class="bm-card p-6 mb-6" style="border-color: rgba(34,197,94,0.2);">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
                    <div class="flex items-center gap-5">
                        <div class="w-16 h-16 rounded-2xl bg-emerald-500/15 flex items-center justify-center border border-emerald-500/25">
                            <i class="fa-solid fa-sack-dollar text-emerald-400 text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-zinc-400">Total Lifetime Earnings</p>
                            <p class="text-3xl font-bold text-white">
                                <i class="fa-brands fa-ethereum text-blue-400 text-2xl mr-1"></i>${tt(s)} <span class="text-lg text-zinc-500">ETH</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-3 items-center">
                        <!-- Pending Earnings -->
                        <div class="bm-card p-4 text-center min-w-[120px]" style="border-color: rgba(251,191,36,0.2);">
                            <p class="text-xl font-bold text-amber-400 font-mono" id="bm-pending-amount">
                                ${L.pendingEarningsAmount>0n?tt(L.pendingEarningsAmount):"0"}
                            </p>
                            <p class="text-[10px] text-zinc-500 uppercase">Pending ETH</p>
                        </div>
                        <button id="bm-withdraw-earnings" class="bm-btn-amber px-5 py-3 text-sm"
                                ${L.pendingEarningsAmount===0n?'disabled style="opacity:0.4;cursor:not-allowed"':""}>
                            <i class="fa-solid fa-coins mr-2"></i>Withdraw Earnings
                        </button>
                        <div class="bm-card p-4 text-center min-w-[80px]">
                            <p class="text-xl font-bold text-white">${t.length}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">Listed</p>
                        </div>
                        <div class="bm-card p-4 text-center min-w-[80px]">
                            <p class="text-xl font-bold text-white">${n.length}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">Available</p>
                        </div>
                        <button id="bm-open-list" class="bm-btn-primary px-6 py-3" ${n.length===0?"disabled":""}>
                            <i class="fa-solid fa-plus mr-2"></i>List
                        </button>
                    </div>
                </div>
            </div>

            <!-- My Listed NFTs -->
            ${t.length===0?ai("No Listings Yet","List your first NFT to start earning ETH!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 bm-nft-grid">
                    ${t.map((r,i)=>Vd(r,i,!0)).join("")}
                </div>
            `}
        </div>
    `}function q0(){if(!c.isConnected)return qd("View your active rentals");const e=Math.floor(Date.now()/1e3),t=(c.myRentals||[]).filter(a=>Wa(a.tenant,c.userAddress)&&Number(a.endTime)>e);return`
        <div>
            <!-- Tier Info -->
            <div class="bm-card p-5 mb-6" style="border-color: rgba(34,197,94,0.15);">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/15 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-shield-halved text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white mb-1">Boost Tiers</h3>
                        <p class="text-xs text-zinc-400">
                            Diamond = Keep 100% | Gold = 90% | Silver = 75% | Bronze = 60% â€” Without NFT: 50% burned.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Active Rentals -->
            ${t.length===0?ai("No Active Rentals","Rent an NFT booster to keep more staking rewards!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
                    ${t.map((a,n)=>X0(a,n)).join("")}
                </div>
            `}
        </div>
    `}function X0(e,t){const a=Qa(e.boostBips),n=fs(a.name),s=Kd(Number(e.endTime)),r=ut(e.boostBips||0);let i="active";return s.seconds<3600?i="critical":s.seconds<7200&&(i="warning"),`
        <div class="bm-card p-5" style="animation: bm-card-in 0.5s ease-out ${t*60}ms forwards; opacity: 0;">
            <div class="flex items-center justify-between mb-4">
                <div class="bm-tier-badge" style="background:${n.bg};color:${n.color};border:1px solid ${n.border}">
                    ${n.emoji} ${a.name}
                </div>
                <div class="bm-timer ${i}" data-end="${e.endTime}">
                    <i class="fa-solid fa-clock mr-1"></i>${s.text}
                </div>
            </div>

            <div class="flex items-center gap-4 mb-4">
                <div class="w-16 h-16 rounded-xl flex items-center justify-center overflow-hidden"
                     style="background:${n.bg}">
                    <img src="${n.image}" alt="${a.name}" class="w-full h-full object-contain"
                         onerror="this.outerHTML='<span class=\\'text-4xl\\'>${n.emoji}</span>'">
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white">${a.name} Booster</h3>
                    <p class="text-xs text-zinc-500">Token #${mt(e.tokenId)}</p>
                </div>
            </div>

            <div class="p-3 rounded-xl ${r===100?"bg-emerald-500/10 border border-emerald-500/20":"bg-zinc-800/50"}">
                <p class="text-sm ${r===100?"text-emerald-400":"text-zinc-300"}">
                    <i class="fa-solid fa-shield-halved mr-2"></i>
                    ${r===100?"Keep 100% of rewards!":`Keep ${r}% of rewards on claims`}
                </p>
            </div>
        </div>
    `}function J0(){const e=c.rentalListings||[],t=new Set(e.map(n=>mt(n.tokenId)));return`
        <div class="bm-modal" id="bm-modal-list">
            <div class="bm-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-tag text-emerald-400"></i>List NFT for Rent
                    </h3>
                    <button class="bm-close-list text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="p-5 space-y-5">
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Select NFT</label>
                        <select id="bm-list-select" class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none">
                            <option value="">-- Select an NFT --</option>
                            ${(c.myBoosters||[]).filter(n=>!t.has(mt(n.tokenId))).map(n=>{const s=Qa(n.boostBips),r=fs(s.name);return`<option value="${n.tokenId}">${r.emoji} ${s.name} Booster #${n.tokenId}</option>`}).join("")}
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Price per Hour (ETH)</label>
                        <input type="number" id="bm-list-price" min="0.0001" step="0.0001" placeholder="0.001"
                            class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none text-lg font-mono">
                        <p class="text-[10px] text-zinc-600 mt-2">Recommended: 0.0005-0.01 ETH/hour depending on tier</p>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Min Hours</label>
                            <input type="number" id="bm-list-min" min="1" max="168" value="1"
                                class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none font-mono">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Max Hours</label>
                            <input type="number" id="bm-list-max" min="1" max="168" value="168"
                                class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none font-mono">
                        </div>
                    </div>
                </div>
                <div class="flex gap-3 p-5 pt-0">
                    <button class="bm-close-list bm-btn-secondary flex-1 py-3">Cancel</button>
                    <button id="bm-confirm-list" class="bm-btn-primary flex-1 py-3">
                        <i class="fa-solid fa-check mr-2"></i>List NFT
                    </button>
                </div>
            </div>
        </div>
    `}function Z0(){return`
        <div class="bm-modal" id="bm-modal-rent">
            <div class="bm-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-bolt text-emerald-400"></i>Rent Booster
                    </h3>
                    <button class="bm-close-rent text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div id="bm-rent-modal-body" class="p-5">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>
    `}function ai(e,t){return`
        <div class="bm-empty">
            <div class="w-20 h-20 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-rocket text-3xl text-zinc-600"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">${e}</h3>
            <p class="text-sm text-zinc-500">${t}</p>
        </div>
    `}function qd(e){return`
        <div class="bm-empty">
            <div class="w-20 h-20 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-wallet text-3xl text-zinc-500"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">Connect Wallet</h3>
            <p class="text-sm text-zinc-500 mb-4">${e}</p>
            <button onclick="window.openConnectModal && window.openConnectModal()" class="bm-btn-primary px-8 py-3">
                <i class="fa-solid fa-wallet mr-2"></i>Connect Wallet
            </button>
        </div>
    `}let jt=null,Wt=null;function Q0(){jt&&document.removeEventListener("click",jt),Wt&&document.removeEventListener("change",Wt),jt=e=>{const t=e.target,a=t.closest(".bm-tab");if(a){L.activeTab=a.dataset.tab,document.querySelectorAll(".bm-tab").forEach(o=>o.classList.remove("active")),a.classList.add("active"),Fa();return}const n=t.closest(".bm-filter");if(n){L.filterTier=n.dataset.filter,Fa();return}if(t.closest("#bm-open-list")){eb();return}if(t.closest(".bm-close-list")){Xd();return}if(t.closest(".bm-close-rent")){Jd();return}if(t.closest("#bm-confirm-list")){nb();return}if(t.closest("#bm-confirm-rent")){ab();return}const s=t.closest(".bm-rent-btn");if(s&&!s.disabled){tb(s.dataset.id);return}const r=t.closest(".bm-withdraw-btn");if(r&&!r.disabled){sb(r);return}const i=t.closest(".bm-share-btn");if(i){ib(i.dataset.id);return}if(t.closest("#bm-withdraw-earnings")){rb();return}if(t.classList.contains("bm-modal")){t.classList.remove("active"),L.selectedListing=null;return}},Wt=e=>{e.target.id==="bm-sort"&&(L.sortBy=e.target.value,Fa())},document.addEventListener("click",jt),document.addEventListener("change",Wt)}function eb(){const e=document.getElementById("bm-modal-list");e&&e.classList.add("active")}function Xd(){const e=document.getElementById("bm-modal-list");e&&e.classList.remove("active")}function tb(e){const t=(c.rentalListings||[]).find(m=>G0(m.tokenId,e));if(!t)return;L.selectedListing=t;const a=Qa(t.boostBips),n=fs(a.name),s=tt(t.pricePerHour),r=ut(t.boostBips||0),i=document.getElementById("bm-rent-modal-body");if(!i)return;i.innerHTML=`
        <div class="flex items-center gap-4 mb-5 p-4 rounded-xl" style="background:${n.bg}">
            <img src="${n.image}" alt="${a.name}" class="w-16 h-16 object-contain rounded-lg"
                 onerror="this.outerHTML='<div class=\\'text-5xl\\'>${n.emoji}</div>'">
            <div>
                <h3 class="text-lg font-bold text-white">${a.name} Booster #${e}</h3>
                <p class="text-sm" style="color:${n.color}">Keep ${r}% of rewards</p>
            </div>
        </div>

        <div class="space-y-4 mb-5">
            <div class="flex justify-between text-sm">
                <span class="text-zinc-500">Base Price per hour</span>
                <span class="text-white font-bold"><i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${s} ETH</span>
            </div>
            <div class="flex justify-between text-sm">
                <span class="text-zinc-500">Duration range</span>
                <span class="text-white font-bold">${t.minHours||1}h â€” ${t.maxHours||168}h</span>
            </div>
            <div>
                <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Rental Duration (hours)</label>
                <input type="number" id="bm-rent-hours"
                       min="${t.minHours||1}" max="${t.maxHours||168}" value="${t.minHours||1}"
                       class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none text-lg font-mono">
            </div>
            <div id="bm-rent-cost" class="p-4 rounded-xl bg-zinc-800/50 space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-500">Rental Cost</span>
                    <span class="text-white font-mono" id="bm-cost-rental"><i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>Calculating...</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-500">Ecosystem Fee</span>
                    <span class="text-zinc-400 font-mono" id="bm-cost-fee">â€”</span>
                </div>
                <div class="h-px bg-zinc-700 my-1"></div>
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-400 font-bold">Total</span>
                    <span class="text-xl font-bold text-emerald-400 font-mono" id="bm-cost-total">â€”</span>
                </div>
            </div>
            <!-- Balance warning (hidden by default) -->
            <div id="bm-balance-warn" class="hidden p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-center">
                <p class="text-xs text-red-400" id="bm-balance-warn-text"></p>
            </div>
        </div>

        <div class="flex gap-3">
            <button class="bm-close-rent bm-btn-secondary flex-1 py-3">Cancel</button>
            <button id="bm-confirm-rent" class="bm-btn-primary flex-1 py-3">
                <i class="fa-solid fa-bolt mr-2"></i>Rent Now
            </button>
        </div>
    `;const o=document.getElementById("bm-rent-hours"),l=document.getElementById("bm-confirm-rent"),d=document.getElementById("bm-balance-warn"),u=document.getElementById("bm-balance-warn-text"),p=async()=>{const m=parseInt(o.value)||1;let g=0n;try{const x=await zt.getRentalCost(e,m);g=x.totalCost,document.getElementById("bm-cost-rental").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${x.rentalCostFormatted} ETH`,document.getElementById("bm-cost-fee").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${x.ethFeeFormatted} ETH`,document.getElementById("bm-cost-total").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${x.totalCostFormatted} ETH`}catch{const h=BigInt(t.pricePerHour||0)*BigInt(m);g=h,document.getElementById("bm-cost-rental").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${tt(h)} ETH`,document.getElementById("bm-cost-fee").textContent="~fee",document.getElementById("bm-cost-total").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>~${tt(h)} ETH`}if(c.isConnected&&g>0n)try{const{NetworkManager:x}=await Y(async()=>{const{NetworkManager:T}=await Promise.resolve().then(()=>ae);return{NetworkManager:T}},void 0),h=await x.getProvider().getBalance(c.userAddress),C=g+ti.parseEther("0.001");if(h<C){const T=tt(C-h);l.disabled=!0,l.className="flex-1 py-3 rounded-xl font-bold text-sm border border-red-500/30 bg-red-500/10 text-red-400 cursor-not-allowed",l.innerHTML=`<i class="fa-brands fa-ethereum mr-1"></i>Need ${tt(C)} ETH`,d.classList.remove("hidden"),u.textContent=`Your balance: ${tt(h)} ETH â€” need ${T} more ETH`}else l.disabled=!1,l.className="bm-btn-primary flex-1 py-3",l.innerHTML='<i class="fa-solid fa-bolt mr-2"></i>Rent Now',d.classList.add("hidden")}catch{l.disabled=!1,l.className="bm-btn-primary flex-1 py-3",l.innerHTML='<i class="fa-solid fa-bolt mr-2"></i>Rent Now',d.classList.add("hidden")}};p(),o.addEventListener("input",p),document.getElementById("bm-modal-rent").classList.add("active")}function Jd(){const e=document.getElementById("bm-modal-rent");e&&e.classList.remove("active"),L.selectedListing=null}async function ab(){if(L.isTransactionPending||!L.selectedListing)return;const e=parseInt(document.getElementById("bm-rent-hours").value)||1,t=mt(L.selectedListing.tokenId),a=document.getElementById("bm-confirm-rent");L.isTransactionPending=!0;try{await zt.rent({tokenId:t,hours:e,button:a,onSuccess:async()=>{L.isTransactionPending=!1,Jd(),b("NFT Rented Successfully!","success"),await wa()},onError:n=>{L.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&b("Failed: "+(n.message||"Error"),"error")}})}catch(n){L.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&b("Failed: "+(n.message||"Error"),"error")}}async function nb(){if(L.isTransactionPending)return;const e=document.getElementById("bm-list-select").value,t=document.getElementById("bm-list-price").value,a=parseInt(document.getElementById("bm-list-min").value)||1,n=parseInt(document.getElementById("bm-list-max").value)||168;if(!e){b("Select an NFT","error");return}if(!t||parseFloat(t)<=0){b("Enter valid price","error");return}if(a>n){b("Min hours must be <= max hours","error");return}const s=document.getElementById("bm-confirm-list");L.isTransactionPending=!0;try{await zt.list({tokenId:e,pricePerHour:ti.parseEther(t),minHours:a,maxHours:n,button:s,onSuccess:async()=>{L.isTransactionPending=!1,Xd(),b("NFT Listed Successfully!","success"),await wa()},onError:r=>{L.isTransactionPending=!1,!r.cancelled&&r.type!=="user_rejected"&&b("Failed: "+(r.message||"Error"),"error")}})}catch(r){L.isTransactionPending=!1,!r.cancelled&&r.type!=="user_rejected"&&b("Failed: "+(r.message||"Error"),"error")}}async function sb(e){if(L.isTransactionPending)return;const t=e.dataset.id;if(confirm("Withdraw this NFT from the marketplace?")){L.isTransactionPending=!0;try{await zt.withdraw({tokenId:t,button:e,onSuccess:async()=>{L.isTransactionPending=!1,b("NFT Withdrawn Successfully!","success"),await wa()},onError:a=>{L.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&b("Failed: "+(a.message||"Error"),"error")}})}catch(a){L.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&b("Failed: "+(a.message||"Error"),"error")}}}async function rb(){if(L.isTransactionPending||L.pendingEarningsAmount===0n)return;const e=document.getElementById("bm-withdraw-earnings");L.isTransactionPending=!0;try{await zt.withdrawEarnings({button:e,onSuccess:async()=>{L.isTransactionPending=!1,L.pendingEarningsAmount=0n,b("Earnings Withdrawn!","success"),await wa()},onError:t=>{L.isTransactionPending=!1,!t.cancelled&&t.type!=="user_rejected"&&b("Failed: "+(t.message||"Error"),"error")}})}catch(t){L.isTransactionPending=!1,!t.cancelled&&t.type!=="user_rejected"&&b("Failed: "+(t.message||"Error"),"error")}}function ib(e){const t="https://backcoin.org/#rental",a=`Rent NFT Boosters on Backchain Boost Market!

Keep up to 100% of your staking rewards by renting an NFT booster.

${t}

#Backchain #DeFi #Arbitrum #Web3`;navigator.share?navigator.share({title:"Backchain Boost Market",text:a,url:t}).catch(()=>{}):navigator.clipboard.writeText(a).then(()=>{b("Link copied to clipboard!","success")}).catch(()=>{b("Could not copy link","error")})}function ob(){L.countdownIntervals.forEach(clearInterval),L.countdownIntervals=[],document.querySelectorAll(".bm-timer[data-end]").forEach(e=>{const t=Number(e.dataset.end),a=setInterval(()=>{const n=Kd(t);e.innerHTML=`<i class="fa-solid fa-clock mr-1"></i>${n.text}`,n.expired?(clearInterval(a),Fa()):n.seconds<3600?e.className="bm-timer critical":n.seconds<7200&&(e.className="bm-timer warning")},1e3);L.countdownIntervals.push(a)})}async function wa(){L.isLoading=!0;try{const e=[Wo()];c.isConnected&&(e.push(op()),e.push(Ot()),e.push(lb())),e.push(cb()),await Promise.all(e)}catch(e){console.warn("[BoostMarket] Refresh error:",e)}L.isLoading=!1,Xs()}async function lb(){if(c.userAddress)try{const e=await zt.getPendingEarnings(c.userAddress);L.pendingEarningsAmount=e.amount}catch{L.pendingEarningsAmount=0n}}async function cb(){try{L.marketStats=await zt.getMarketplaceStats()}catch{L.marketStats=null}}function ao(){L.countdownIntervals.forEach(clearInterval),L.countdownIntervals=[],jt&&(document.removeEventListener("click",jt),jt=null),Wt&&(document.removeEventListener("change",Wt),Wt=null)}const Zd={async render(e){if(!e){ao();return}Xs(),await wa()},update(){Xs()},refresh:wa,cleanup:ao};window.RentalPage=Zd;const db={render:async e=>{const t=document.getElementById("socials");if(!t||!e&&t.innerHTML.trim()!=="")return;const a=`
            <style>
                @keyframes telegram-pulse {
                    0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); transform: scale(1); }
                    70% { box-shadow: 0 0 0 15px rgba(56, 189, 248, 0); transform: scale(1.02); }
                    100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); transform: scale(1); }
                }
                .telegram-glow {
                    animation: telegram-pulse 2s infinite;
                }
            </style>
        `;t.innerHTML=`
            ${a}
            <div class="max-w-5xl mx-auto py-8">
                
                <div class="text-center mb-10">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-yellow-200 mb-4">
                        Join the Backcoin Community
                    </h1>
                    <p class="text-zinc-400 text-lg max-w-2xl mx-auto">
                        Connect with thousands of holders, stay updated on the Mainnet launch, and participate in exclusive airdrops.
                    </p>
                </div>

                <div class="mb-12 flex justify-center">
                    <a href="https://t.me/BackCoinorg" target="_blank" 
                       class="telegram-glow relative group w-full max-w-2xl bg-gradient-to-br from-sky-600 to-blue-700 hover:from-sky-500 hover:to-blue-600 border border-sky-400/50 rounded-2xl p-8 flex flex-col md:flex-row items-center justify-between gap-6 transition-all duration-300 shadow-2xl">
                        
                        <div class="flex items-center gap-6">
                            <div class="bg-white/20 p-4 rounded-full backdrop-blur-sm">
                                <i class="fa-brands fa-telegram text-5xl text-white"></i>
                            </div>
                            <div class="text-center md:text-left">
                                <h2 class="text-2xl font-bold text-white mb-1">Official Telegram Group</h2>
                                <p class="text-sky-100 text-sm font-medium">Chat with the team & community â€¢ 24/7 Support</p>
                            </div>
                        </div>

                        <div class="bg-white text-blue-600 font-extrabold py-3 px-8 rounded-full shadow-lg group-hover:scale-105 transition-transform flex items-center gap-2 whitespace-nowrap">
                            JOIN NOW <i class="fa-solid fa-arrow-right"></i>
                        </div>
                    </a>
                </div>

                <div class="border-t border-zinc-800 my-10"></div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
                    
                    <a href="https://x.com/backcoin" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-zinc-500 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-x-twitter text-3xl text-white"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">X (Twitter)</h3>
                        <p class="text-zinc-400 text-sm">Latest news & announcements</p>
                    </a>

                    <a href="https://www.youtube.com/@Backcoin" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-red-500/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-youtube text-3xl text-red-500"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">YouTube</h3>
                        <p class="text-zinc-400 text-sm">Video tutorials & AMAs</p>
                    </a>

                    <a href="https://www.instagram.com/backcoin.bkc/" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-pink-500/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-instagram text-3xl text-pink-500"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Instagram</h3>
                        <p class="text-zinc-400 text-sm">Visual updates & stories</p>
                    </a>

                    <a href="https://www.tiktok.com/@backcoin.org" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-cyan-400/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-tiktok text-3xl text-cyan-400"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">TikTok</h3>
                        <p class="text-zinc-400 text-sm">Short clips & viral content</p>
                    </a>

                    <a href="https://www.facebook.com/profile.php?id=61584248964781" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-blue-600/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-facebook text-3xl text-blue-600"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Facebook</h3>
                        <p class="text-zinc-400 text-sm">Community discussions</p>
                    </a>

                </div>

                <div class="mt-12 text-center text-zinc-500 text-sm">
                    <p>Always verify links. Official admins will never DM you first asking for funds.</p>
                </div>
            </div>
        `},cleanup:()=>{}},J="https://www.youtube.com/@Backcoin",zs={gettingStarted:[{id:"v1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:42",tag:"beginner",en:{title:"MetaMask Setup (PC & Mobile)",description:"Your passport to the Backcoin universe. Learn how to install and configure MetaMask for Web3.",url:J},pt:{title:"Configurando MetaMask (PC & Mobile)",description:"Seu passaporte para o universo Backcoin. Aprenda a instalar e configurar a MetaMask para Web3.",url:J}},{id:"v2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:53",tag:"beginner",en:{title:"Connect & Claim Starter Pack",description:"Fill your tank! Connect your wallet and claim free BKC tokens plus ETH for gas fees.",url:J},pt:{title:"Conectar e Receber Starter Pack",description:"Encha o tanque! Conecte sua carteira e receba BKC grÃ¡tis mais ETH para taxas de gÃ¡s.",url:J}},{id:"v10",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:40",tag:"beginner",en:{title:"Airdrop Ambassador Campaign",description:"35% of TGE for the community! Learn how to earn points by promoting Backcoin.",url:J},pt:{title:"Campanha de Airdrop - Embaixador",description:"35% do TGE para a comunidade! Aprenda a ganhar pontos promovendo o Backcoin.",url:J}}],ecosystem:[{id:"v4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:48",tag:"intermediate",en:{title:"Staking Pool - Passive Income",description:"Lock your tokens and earn a share of all protocol fees. Up to 10x multiplier for loyalty!",url:J},pt:{title:"Staking Pool - Renda Passiva",description:"Trave seus tokens e ganhe parte das taxas do protocolo. AtÃ© 10x multiplicador por lealdade!",url:J}},{id:"v5",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:50",tag:"intermediate",en:{title:"NFT Market - Boost Your Account",description:"Buy NFT Boosters to reduce fees and increase mining efficiency. Prices set by math, not sellers.",url:J},pt:{title:"NFT Market - Turbine sua Conta",description:"Compre NFT Boosters para reduzir taxas e aumentar eficiÃªncia. PreÃ§os definidos por matemÃ¡tica.",url:J}},{id:"v6",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:53",tag:"intermediate",en:{title:"AirBNFT - Rent NFT Power",description:"Need a boost but don't want to buy? Rent NFT power from other players for a fraction of the cost.",url:J},pt:{title:"AirBNFT - Aluguel de Poder",description:"Precisa de boost mas nÃ£o quer comprar? Alugue poder de NFT de outros jogadores.",url:J}},{id:"v7a",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:05",tag:"intermediate",en:{title:"List Your NFT for Rent",description:"Turn your idle NFTs into passive income. List on AirBNFT and earn while you sleep.",url:J},pt:{title:"Liste seu NFT para Aluguel",description:"Transforme NFTs parados em renda passiva. Liste no AirBNFT e ganhe dormindo.",url:J}},{id:"v7b",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:31",tag:"intermediate",en:{title:"Decentralized Notary",description:"Register documents on the blockchain forever. Immutable proof of ownership for just 1 BKC.",url:J},pt:{title:"CartÃ³rio Descentralizado",description:"Registre documentos na blockchain para sempre. Prova imutÃ¡vel de autoria por apenas 1 BKC.",url:J}},{id:"v8",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:34",tag:"intermediate",en:{title:"Fortune Pool - The Big Jackpot",description:"Test your luck with decentralized oracle results. Up to 100x multipliers!",url:J},pt:{title:"Fortune Pool - O Grande Jackpot",description:"Teste sua sorte com resultados de orÃ¡culo descentralizado. Multiplicadores atÃ© 100x!",url:J}},{id:"v9",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:20",tag:"beginner",en:{title:"The Backcoin Manifesto (Promo)",description:"Economy, Games, Passive Income, Utility. This is not just a token - it's a new digital economy.",url:J},pt:{title:"O Manifesto Backcoin (Promo)",description:"Economia, Jogos, Renda Passiva, Utilidade. NÃ£o Ã© apenas um token - Ã© uma nova economia digital.",url:J}}],advanced:[{id:"v11",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:25",tag:"advanced",en:{title:"Hub & Spoke Architecture",description:"Deep dive into Backcoin's technical architecture. How the ecosystem manager connects all services.",url:J},pt:{title:"Arquitetura Hub & Spoke",description:"Mergulho tÃ©cnico na arquitetura do Backcoin. Como o gerenciador conecta todos os serviÃ§os.",url:J}},{id:"v12",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:25",tag:"advanced",en:{title:"Mining Evolution: PoW vs PoS vs Backcoin",description:"From Proof of Work to Proof of Stake to Proof of Purchase. The third generation of crypto mining.",url:J},pt:{title:"EvoluÃ§Ã£o da MineraÃ§Ã£o: PoW vs PoS vs Backcoin",description:"Do Proof of Work ao Proof of Stake ao Proof of Purchase. A terceira geraÃ§Ã£o de mineraÃ§Ã£o.",url:J}},{id:"v13",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:25",tag:"advanced",en:{title:"The Infinite Future (Roadmap)",description:"Credit cards, insurance, DEX, lending... What's coming next in the Backcoin Super App.",url:J},pt:{title:"O Futuro Infinito (Roadmap)",description:"CartÃµes de crÃ©dito, seguros, DEX, emprÃ©stimos... O que vem no Super App Backcoin.",url:J}},{id:"v14",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:35",tag:"advanced",en:{title:"The New Wave of Millionaires",description:"Mathematical scarcity, revenue sharing, early adopter advantage. The wealth transfer is happening.",url:J},pt:{title:"A Nova Leva de MilionÃ¡rios",description:"Escassez matemÃ¡tica, dividendos, vantagem do early adopter. A transferÃªncia de riqueza estÃ¡ acontecendo.",url:J}}]},ni={en:{heroTitle:"Master the Backcoin Ecosystem",heroSubtitle:"Complete video tutorials to help you navigate staking, NFTs, Fortune Pool and more",videos:"Videos",languages:"2 Languages",catGettingStarted:"Getting Started",catGettingStartedDesc:"3 videos â€¢ Setup & First Steps",catEcosystem:"Ecosystem Features",catEcosystemDesc:"7 videos â€¢ Core Features & Tools",catAdvanced:"Advanced & Vision",catAdvancedDesc:"4 videos â€¢ Deep Dives & Future",tagBeginner:"Beginner",tagIntermediate:"Intermediate",tagAdvanced:"Advanced"},pt:{heroTitle:"Domine o Ecossistema Backcoin",heroSubtitle:"Tutoriais completos em vÃ­deo para ajudÃ¡-lo a navegar staking, NFTs, Fortune Pool e mais",videos:"VÃ­deos",languages:"2 Idiomas",catGettingStarted:"Primeiros Passos",catGettingStartedDesc:"3 vÃ­deos â€¢ ConfiguraÃ§Ã£o Inicial",catEcosystem:"Recursos do Ecossistema",catEcosystemDesc:"7 vÃ­deos â€¢ Ferramentas Principais",catAdvanced:"AvanÃ§ado & VisÃ£o",catAdvancedDesc:"4 vÃ­deos â€¢ Aprofundamento & Futuro",tagBeginner:"Iniciante",tagIntermediate:"IntermediÃ¡rio",tagAdvanced:"AvanÃ§ado"}};let Jt=localStorage.getItem("backcoin-tutorials-lang")||"en";function ub(e,t){const a=e[Jt],n=e.tag==="beginner"?"bg-emerald-500/20 text-emerald-400":e.tag==="intermediate"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400",s=ni[Jt][`tag${e.tag.charAt(0).toUpperCase()+e.tag.slice(1)}`];return`
        <a href="${a.url}" target="_blank" rel="noopener noreferrer" 
           class="group block bg-zinc-800/50 border border-zinc-700 rounded-xl overflow-hidden transition-all duration-300 hover:border-amber-500/50 hover:shadow-lg hover:shadow-amber-500/10 hover:-translate-y-1">
            <div class="relative aspect-video overflow-hidden bg-zinc-900">
                <img src="${e.thumbnail}" alt="${a.title}" 
                     class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                     onerror="this.src='./assets/bkc_logo_3d.png'; this.style.objectFit='contain'; this.style.padding='40px';">
                <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    <div class="w-14 h-14 bg-amber-500 rounded-full flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-play text-zinc-900 text-xl ml-1"></i>
                    </div>
                </div>
                <span class="absolute top-2 left-2 bg-black/70 backdrop-blur px-2 py-1 rounded text-xs font-bold text-amber-400">#${t+1}</span>
                <span class="absolute bottom-2 right-2 bg-black/80 px-2 py-1 rounded text-xs font-semibold text-white">${e.duration}</span>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-white text-sm mb-1 line-clamp-2">${a.title}</h3>
                <p class="text-zinc-400 text-xs line-clamp-2 mb-3">${a.description}</p>
                <span class="inline-block text-[10px] font-bold uppercase px-2 py-1 rounded ${n}">${s}</span>
            </div>
        </a>
    `}function Ns(e,t,a,n,s,r,i){const o=ni[Jt];let l=`
        <div class="mb-10">
            <div class="flex items-center gap-3 mb-6 pb-3 border-b border-zinc-700">
                <div class="w-10 h-10 rounded-lg bg-${a}-500/20 flex items-center justify-center">
                    <i class="fa-solid fa-${t} text-${a}-400"></i>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-white">${o[s]}</h2>
                    <p class="text-xs text-zinc-500">${o[r]}</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    `,d=i;return n.forEach(u=>{l+=ub(u,d++)}),l+="</div></div>",{html:l,nextIndex:d}}function pb(e){var t,a,n,s,r,i,o,l;Jt=e,localStorage.setItem("backcoin-tutorials-lang",e),(t=document.getElementById("tutorials-btn-en"))==null||t.classList.toggle("bg-amber-500",e==="en"),(a=document.getElementById("tutorials-btn-en"))==null||a.classList.toggle("text-zinc-900",e==="en"),(n=document.getElementById("tutorials-btn-en"))==null||n.classList.toggle("bg-zinc-700",e!=="en"),(s=document.getElementById("tutorials-btn-en"))==null||s.classList.toggle("text-zinc-300",e!=="en"),(r=document.getElementById("tutorials-btn-pt"))==null||r.classList.toggle("bg-amber-500",e==="pt"),(i=document.getElementById("tutorials-btn-pt"))==null||i.classList.toggle("text-zinc-900",e==="pt"),(o=document.getElementById("tutorials-btn-pt"))==null||o.classList.toggle("bg-zinc-700",e!=="pt"),(l=document.getElementById("tutorials-btn-pt"))==null||l.classList.toggle("text-zinc-300",e!=="pt"),Qd()}function Qd(){const e=document.getElementById("tutorials-content");if(!e)return;const t=ni[Jt];let a=`
        <!-- Hero -->
        <div class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold mb-3">
                <span class="bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-400 bg-clip-text text-transparent">
                    ${t.heroTitle}
                </span>
            </h1>
            <p class="text-zinc-400 max-w-2xl mx-auto">${t.heroSubtitle}</p>
            <div class="flex items-center justify-center gap-4 mt-4">
                <div class="flex items-center gap-2 text-sm text-zinc-500">
                    <i class="fa-solid fa-video text-amber-400"></i>
                    <span>14 ${t.videos}</span>
                </div>
                <div class="w-1 h-1 bg-zinc-600 rounded-full"></div>
                <div class="flex items-center gap-2 text-sm text-zinc-500">
                    <i class="fa-solid fa-language text-emerald-400"></i>
                    <span>${t.languages}</span>
                </div>
            </div>
        </div>
    `,n=Ns("getting-started","rocket","emerald",zs.gettingStarted,"catGettingStarted","catGettingStartedDesc",0);a+=n.html,n=Ns("ecosystem","cubes","amber",zs.ecosystem,"catEcosystem","catEcosystemDesc",n.nextIndex),a+=n.html,n=Ns("advanced","graduation-cap","cyan",zs.advanced,"catAdvanced","catAdvancedDesc",n.nextIndex),a+=n.html,e.innerHTML=a}const eu={render:function(e=!1){const t=document.getElementById("tutorials");t&&(e||t.innerHTML.trim()==="")&&(t.innerHTML=`
                <div class="max-w-6xl mx-auto">
                    <!-- Header with Language Switcher -->
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-play-circle text-cyan-400 text-xl"></i>
                            </div>
                            <div>
                                <h1 class="text-xl font-bold text-white">Video Tutorials</h1>
                                <p class="text-xs text-zinc-500">Learn how to use Backcoin</p>
                            </div>
                        </div>
                        
                        <!-- Language Switcher -->
                        <div class="flex items-center gap-1 bg-zinc-800 p-1 rounded-lg border border-zinc-700">
                            <button id="tutorials-btn-en" onclick="TutorialsPage.setLang('en')" 
                                    class="flex items-center gap-2 px-3 py-2 rounded-md text-xs font-bold transition-all ${Jt==="en"?"bg-amber-500 text-zinc-900":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}">
                                <img src="./assets/en.png" alt="EN" class="w-5 h-5 rounded-full">
                                <span class="hidden sm:inline">EN</span>
                            </button>
                            <button id="tutorials-btn-pt" onclick="TutorialsPage.setLang('pt')" 
                                    class="flex items-center gap-2 px-3 py-2 rounded-md text-xs font-bold transition-all ${Jt==="pt"?"bg-amber-500 text-zinc-900":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}">
                                <img src="./assets/pt.png" alt="PT" class="w-5 h-5 rounded-full">
                                <span class="hidden sm:inline">PT</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Content Container -->
                    <div id="tutorials-content"></div>
                </div>
            `,Qd())},update:function(e){},cleanup:function(){},setLang:pb};window.TutorialsPage=eu;const si=window.ethers,En={ACTIVE:0,CLOSED:1},no={0:{label:"Active",color:"#10b981",icon:"fa-circle-play",bg:"bg-emerald-500/15"},1:{label:"Closed",color:"#3b82f6",icon:"fa-circle-check",bg:"bg-blue-500/15"},2:{label:"Withdrawn",color:"#8b5cf6",icon:"fa-circle-dollar-to-slot",bg:"bg-purple-500/15"}},ms={getCampaigns:"https://getcharitycampaigns-4wvdcuoouq-uc.a.run.app",saveCampaign:"https://savecharitycampaign-4wvdcuoouq-uc.a.run.app",uploadImage:"/api/upload-image"},tu="https://sepolia.arbiscan.io/address/",Fn={animal:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=800&q=80",humanitarian:"https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=800&q=80",default:"https://images.unsplash.com/photo-1532629345422-7515f3d16bb6?w=800&q=80"},xe={animal:{name:"Animal Welfare",emoji:"ðŸ¾",color:"#10b981",gradient:"from-emerald-500/20 to-green-600/20"},humanitarian:{name:"Humanitarian Aid",emoji:"ðŸ’—",color:"#ec4899",gradient:"from-pink-500/20 to-rose-600/20"}},au=5*1024*1024,nu=["image/jpeg","image/png","image/gif","image/webp"],k={campaigns:[],stats:null,currentView:"main",currentCampaign:null,selectedCategory:null,isLoading:!1,pendingImage:null,pendingImageFile:null,editingCampaign:null,createStep:1,createCategory:null,createTitle:"",createDesc:"",createGoal:"",createDuration:"",createImageFile:null,createImageUrl:"",createImagePreview:null};function fb(){if(document.getElementById("charity-styles-v9"))return;const e=document.createElement("style");e.id="charity-styles-v9",e.textContent=`
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        @keyframes pulse-border {
            0%, 100% { border-color: rgba(245,158,11,0.3); }
            50% { border-color: rgba(245,158,11,0.6); }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .float-animation { animation: float 3s ease-in-out infinite; }

        .charity-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
            min-height: 400px;
        }

        /* Cards */
        .cp-card-base {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .cp-card-base:hover {
            border-color: rgba(245,158,11,0.3);
            transform: translateY(-2px);
        }

        /* Stats Cards */
        .cp-stat-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.7) 0%, rgba(24,24,27,0.8) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        /* Category Cards */
        .cp-category-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .cp-category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .cp-category-card.animal:hover { border-color: #10b981; }
        .cp-category-card.humanitarian:hover { border-color: #ec4899; }
        .cp-category-card.selected { animation: pulse-border 2s ease-in-out infinite; }

        /* Campaign Cards */
        .cp-campaign-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .cp-campaign-card:hover {
            transform: translateY(-4px);
            border-color: rgba(245,158,11,0.4);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .cp-campaign-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: rgba(63,63,70,0.5);
        }

        /* Progress Bar */
        .cp-progress {
            height: 8px;
            background: rgba(63,63,70,0.5);
            border-radius: 4px;
            overflow: hidden;
        }
        .cp-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s ease;
        }
        .cp-progress-fill.animal { background: linear-gradient(90deg, #10b981, #059669); }
        .cp-progress-fill.humanitarian { background: linear-gradient(90deg, #ec4899, #db2777); }

        /* Badges */
        .cp-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Buttons */
        .cp-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .cp-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .cp-btn-primary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
        }
        .cp-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245,158,11,0.3);
        }

        .cp-btn-secondary {
            background: rgba(63,63,70,0.8);
            color: #fafafa;
            border: 1px solid rgba(63,63,70,0.8);
        }
        .cp-btn-secondary:hover:not(:disabled) {
            background: rgba(63,63,70,1);
        }

        .cp-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
        }
        .cp-btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16,185,129,0.3);
        }

        .cp-btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
        }
        .cp-btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239,68,68,0.3);
        }

        /* Modal */
        .cp-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .cp-modal.active { display: flex; }
        .cp-modal-content {
            background: linear-gradient(145deg, rgba(39,39,42,0.98) 0%, rgba(24,24,27,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 20px;
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .cp-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid rgba(63,63,70,0.5);
        }
        .cp-modal-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #fafafa;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        .cp-modal-close {
            background: none;
            border: none;
            color: #a1a1aa;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s;
        }
        .cp-modal-close:hover { color: #fafafa; }
        .cp-modal-body { padding: 1.25rem; }
        .cp-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 1rem 1.25rem;
            border-top: 1px solid rgba(63,63,70,0.5);
        }

        /* Form Elements */
        .cp-form-group { margin-bottom: 1rem; }
        .cp-form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #fafafa;
            margin-bottom: 6px;
        }
        .cp-form-label span { color: #a1a1aa; font-weight: 400; }
        .cp-form-input {
            width: 100%;
            padding: 12px 14px;
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 10px;
            color: #fafafa;
            font-size: 14px;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        .cp-form-input:focus {
            outline: none;
            border-color: rgba(245,158,11,0.6);
        }
        .cp-form-textarea { min-height: 100px; resize: vertical; }
        .cp-form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        /* Category Selector */
        .cp-cat-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .cp-cat-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cp-cat-option:hover { border-color: rgba(245,158,11,0.4); }
        .cp-cat-option.selected {
            border-color: #f59e0b;
            background: rgba(245,158,11,0.1);
        }
        .cp-cat-option input { display: none; }
        .cp-cat-option-icon { font-size: 1.5rem; margin-bottom: 6px; }
        .cp-cat-option-name { font-size: 12px; font-weight: 600; color: #fafafa; }

        /* Donate Input */
        .cp-donate-input-wrap { position: relative; }
        .cp-donate-input {
            width: 100%;
            padding: 1rem;
            padding-right: 4rem;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            color: #fafafa;
            box-sizing: border-box;
        }
        .cp-donate-input:focus { outline: none; border-color: rgba(16,185,129,0.6); }
        .cp-donate-currency {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #a1a1aa;
            font-weight: 600;
        }
        .cp-donate-presets { display: flex; gap: 8px; margin: 10px 0; }
        .cp-preset {
            flex: 1;
            padding: 8px;
            background: rgba(63,63,70,0.5);
            border: 1px solid rgba(63,63,70,0.8);
            border-radius: 8px;
            color: #fafafa;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cp-preset:hover { background: rgba(63,63,70,0.8); }

        /* Image Upload */
        .cp-image-upload {
            border: 2px dashed rgba(63,63,70,0.8);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(0,0,0,0.2);
        }
        .cp-image-upload:hover {
            border-color: rgba(245,158,11,0.5);
            background: rgba(245,158,11,0.05);
        }
        .cp-image-upload input { display: none; }
        .cp-image-upload-icon { font-size: 2rem; color: #a1a1aa; margin-bottom: 8px; }
        .cp-image-upload-text { font-size: 13px; color: #a1a1aa; }
        .cp-image-upload-text span { color: #f59e0b; font-weight: 600; }
        .cp-image-preview { width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 8px; }
        .cp-image-remove { background: #ef4444; color: #fff; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; }

        /* Tabs */
        .cp-tabs { display: flex; gap: 8px; margin-bottom: 1rem; }
        .cp-tab {
            flex: 1;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 8px;
            color: #a1a1aa;
            font-size: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .cp-tab.active {
            background: rgba(245,158,11,0.2);
            border-color: rgba(245,158,11,0.5);
            color: #f59e0b;
            font-weight: 600;
        }

        /* Detail Page */
        .cp-detail { max-width: 900px; margin: 0 auto; }
        .cp-detail-img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            background: rgba(63,63,70,0.5);
        }
        .cp-detail-content {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 1.5rem;
        }
        .cp-detail-sidebar { display: flex; flex-direction: column; gap: 1rem; }

        /* Share Box */
        .cp-share-box {
            background: rgba(63,63,70,0.3);
            border-radius: 12px;
            padding: 1rem;
        }
        .cp-share-title { font-size: 12px; color: #a1a1aa; margin-bottom: 10px; text-align: center; }
        .cp-share-btns { display: flex; justify-content: center; gap: 8px; }
        .cp-share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .cp-share-btn:hover { transform: scale(1.1); }
        .cp-share-btn.twitter { background: #000; color: #fff; }
        .cp-share-btn.telegram { background: #0088cc; color: #fff; }
        .cp-share-btn.whatsapp { background: #25d366; color: #fff; }
        .cp-share-btn.copy { background: rgba(63,63,70,0.8); color: #fafafa; }

        /* Empty & Loading */
        .cp-empty { text-align: center; padding: 3rem 1rem; color: #a1a1aa; }
        .cp-empty i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
        .cp-empty h3 { color: #fafafa; margin: 0 0 8px; }
        .cp-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; gap: 1rem; }
        .cp-spinner { width: 40px; height: 40px; border: 3px solid rgba(63,63,70,0.5); border-top-color: #f59e0b; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Scrollbar */
        .cp-scrollbar::-webkit-scrollbar { width: 5px; }
        .cp-scrollbar::-webkit-scrollbar-track { background: rgba(39,39,42,0.5); border-radius: 3px; }
        .cp-scrollbar::-webkit-scrollbar-thumb { background: rgba(113,113,122,0.5); border-radius: 3px; }

        /* Step Wizard */
        .cp-step-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            padding: 0 1rem;
        }
        .cp-step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
        }
        .cp-step-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        .cp-step-dot.pending {
            background: rgba(39,39,42,0.8);
            color: #71717a;
            border: 2px solid rgba(63,63,70,0.8);
        }
        .cp-step-dot.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
            box-shadow: 0 0 20px rgba(245,158,11,0.4);
        }
        .cp-step-dot.done {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
        }
        .cp-step-line {
            position: absolute;
            top: 20px;
            height: 3px;
            background: rgba(63,63,70,0.5);
            transition: all 0.5s ease;
        }
        .cp-step-line.ln-1 { left: 14%; width: 22%; }
        .cp-step-line.ln-2 { left: 39%; width: 22%; }
        .cp-step-line.ln-3 { left: 64%; width: 22%; }
        .cp-step-line.active { background: linear-gradient(90deg, #10b981, #f59e0b); }
        .cp-step-line.done { background: #10b981; }

        /* Wizard Cards */
        .cp-wiz-cat-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .cp-wiz-cat-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .cp-wiz-cat-card.animal:hover, .cp-wiz-cat-card.animal.selected { border-color: #10b981; }
        .cp-wiz-cat-card.humanitarian:hover, .cp-wiz-cat-card.humanitarian.selected { border-color: #ec4899; }
        .cp-wiz-cat-card.selected { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.3); }

        .cp-wiz-char-count {
            text-align: right;
            font-size: 11px;
            color: #71717a;
            margin-top: 4px;
        }
        .cp-wiz-char-count.warn { color: #f59e0b; }
        .cp-wiz-char-count.danger { color: #ef4444; }

        .cp-wiz-summary {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            padding: 1rem;
        }
        .cp-wiz-summary-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 13px;
        }
        .cp-wiz-summary-row + .cp-wiz-summary-row { border-top: 1px solid rgba(63,63,70,0.3); }

        /* Boosted badge */
        .cp-boosted-badge {
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(251,191,36,0.2));
            color: #fbbf24;
            border: 1px solid rgba(245,158,11,0.3);
            animation: pulse-border 2s ease-in-out infinite;
        }

        /* Responsive */
        @media(max-width:768px) {
            .cp-stats-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .cp-cats-grid { grid-template-columns: 1fr !important; }
            .cp-detail-content { grid-template-columns: 1fr; }
            .cp-detail-sidebar { order: -1; }
            .cp-form-row { grid-template-columns: 1fr; }
            .cp-wiz-cats-grid { grid-template-columns: 1fr !important; }
        }
    `,document.head.appendChild(e)}const ze=e=>{try{const t=Number(e)/1e18;return t<1e-4?"0":t<1?t.toFixed(4):t<1e3?t.toFixed(2):t.toLocaleString("en-US",{maximumFractionDigits:2})}catch{return"0"}},su=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",en=(e,t)=>{const a=typeof e=="bigint"?e:BigInt(e||0),n=typeof t=="bigint"?t:BigInt(t||1);return n===0n?0:Math.min(100,Number(a*100n/n))},ru=e=>{const t=Math.floor(Date.now()/1e3),a=Number(e)-t;if(a<=0)return{text:"Ended",color:"#ef4444"};const n=Math.floor(a/86400);return n>0?{text:`${n}d left`,color:"#10b981"}:{text:`${Math.floor(a/3600)}h left`,color:"#f59e0b"}},gs=e=>(e==null?void 0:e.imageUrl)||Fn[e==null?void 0:e.category]||Fn.default,iu=e=>`${window.location.origin}${window.location.pathname}#charity/${e}`,ou=()=>{const t=window.location.hash.match(/#charity\/(\d+)/);return t?t[1]:null},mb=e=>{window.location.hash=`charity/${e}`},gb=()=>{window.location.hash.startsWith("#charity/")&&(window.location.hash="charity")},ri=e=>Number(e.status)===En.ACTIVE&&Number(e.deadline)>Math.floor(Date.now()/1e3),lu=e=>{const t=Number(e.status),a=Number(e.deadline)<=Math.floor(Date.now()/1e3);return(t===En.ACTIVE||t===En.CLOSED)&&(a||t===En.CLOSED)&&BigInt(e.raisedAmount||e.raised||0)>0n},cu="charity-meta-";function du(e,t){try{localStorage.setItem(`${cu}${e}`,JSON.stringify(t))}catch{}}function uu(e){try{return JSON.parse(localStorage.getItem(`${cu}${e}`)||"null")}catch{return null}}async function Nt(){k.isLoading=!0;try{const[e,t]=await Promise.all([fetch(ms.getCampaigns).then(s=>s.json()).catch(()=>({campaigns:[]})),bb()]),a=(e==null?void 0:e.campaigns)||[];let n=0;try{n=await Xe.getCampaignCount()}catch(s){console.error("[CharityPage] getCampaignCount failed:",s)}if(n>0){const s=await Promise.all(Array.from({length:n},(r,i)=>i+1).map(async r=>{try{const i=await Xe.getCampaign(r),o=a.find(d=>String(d.id)===String(r)),l=uu(r);return{id:String(r),creator:i.creator,title:(o==null?void 0:o.title)||i.title||`Campaign #${r}`,description:(o==null?void 0:o.description)||(l==null?void 0:l.description)||i.metadataUri||"",metadataUri:i.metadataUri,goalAmount:i.goalAmount,raisedAmount:i.raisedAmount,raised:i.raisedAmount,donationCount:i.donationCount,deadline:i.deadline,status:i.status,isBoosted:i.isBoosted,isActive:i.isActive,progress:i.progress,category:(o==null?void 0:o.category)||(l==null?void 0:l.category)||"humanitarian",imageUrl:(o==null?void 0:o.imageUrl)||(l==null?void 0:l.imageUrl)||null}}catch(i){return console.warn(`[CharityPage] getCampaign(${r}) failed:`,i.message),null}}));k.campaigns=s.filter(Boolean)}else k.campaigns=[];k.stats=t}catch(e){console.error("[CharityPage] loadData error:",e)}finally{k.isLoading=!1}}async function bb(){try{const e=await Xe.getStats();return{raised:e.totalDonated,fees:e.totalEthFees,created:e.totalCampaigns,withdrawn:e.totalWithdrawn}}catch(e){return console.error("[CharityPage] loadStats error:",e),null}}function xb(e,t="create"){var s;const a=(s=e.target.files)==null?void 0:s[0];if(!a)return;if(!nu.includes(a.type)){b("Please select a valid image (JPG, PNG, GIF, WebP)","error");return}if(a.size>au){b("Image must be less than 5MB","error");return}k.pendingImageFile=a;const n=new FileReader;n.onload=r=>{const i=t==="edit"?"edit-image-preview":"create-image-preview",o=document.getElementById(t==="edit"?"edit-image-upload":"create-image-upload"),l=document.getElementById(i);l&&(l.innerHTML=`
                <img src="${r.target.result}" class="cp-image-preview">
                <button type="button" class="cp-image-remove" onclick="CharityPage.removeImage('${t}')">
                    <i class="fa-solid fa-xmark"></i> Remove
                </button>
            `),o&&o.classList.add("has-image")},n.readAsDataURL(a)}function hb(e="create"){k.pendingImageFile=null,k.pendingImage=null;const t=e==="edit"?"edit-image-preview":"create-image-preview",a=document.getElementById(e==="edit"?"edit-image-upload":"create-image-upload"),n=document.getElementById(t);n&&(n.innerHTML=""),a&&a.classList.remove("has-image");const s=document.getElementById(e==="edit"?"edit-image-file":"create-image-file");s&&(s.value="")}function vb(e,t="create"){document.querySelectorAll(`#${t}-image-tabs .cp-tab`).forEach(r=>r.classList.toggle("active",r.dataset.tab===e));const n=document.getElementById(`${t}-image-upload`),s=document.getElementById(`${t}-image-url-wrap`);n&&(n.style.display=e==="upload"?"block":"none"),s&&(s.style.display=e==="url"?"block":"none")}async function pu(e){const t=new FormData;t.append("image",e);const a=await fetch(ms.uploadImage,{method:"POST",body:t,signal:AbortSignal.timeout(6e4)});if(!a.ok){const s=await a.json().catch(()=>({}));throw new Error(s.error||`Upload failed (${a.status})`)}return(await a.json()).imageUrl}const fu=e=>{const t=no[Number(e)]||no[0];return`<span class="cp-badge" style="background:${t.color}20;color:${t.color}"><i class="fa-solid ${t.icon}"></i> ${t.label}</span>`},mu=()=>'<span class="cp-badge cp-boosted-badge"><i class="fa-solid fa-rocket"></i> Boosted</span>',wb=()=>'<div class="cp-loading"><div class="cp-spinner"></div><span class="text-zinc-500">Loading campaigns...</span></div>',gu=e=>`<div class="cp-empty"><i class="fa-solid fa-inbox"></i><h3>${e}</h3><p class="text-zinc-600 text-sm">Be the first to create a campaign!</p></div>`,bu=e=>{var s,r,i,o;const t=en(e.raisedAmount,e.goalAmount),a=ru(e.deadline),n=e.category||"humanitarian";return`
        <div class="cp-campaign-card" onclick="CharityPage.viewCampaign('${e.id}')">
            <img src="${gs(e)}" alt="${e.title}" onerror="this.src='${Fn.default}'">
            <div class="p-4">
                <div class="flex flex-wrap gap-1.5 mb-2">
                    ${fu(e.status)}
                    <span class="cp-badge" style="background:${(s=xe[n])==null?void 0:s.color}20;color:${(r=xe[n])==null?void 0:r.color}">
                        ${(i=xe[n])==null?void 0:i.emoji} ${(o=xe[n])==null?void 0:o.name}
                    </span>
                    ${e.isBoosted?mu():""}
                </div>
                <h3 class="text-white font-bold text-sm mb-1 line-clamp-2">${e.title}</h3>
                <p class="text-zinc-500 text-xs mb-3">by <a href="${tu}${e.creator}" target="_blank" class="text-amber-500 hover:text-amber-400">${su(e.creator)}</a></p>
                <div class="cp-progress mb-2">
                    <div class="cp-progress-fill ${n}" style="width:${t}%"></div>
                </div>
                <div class="flex justify-between text-xs mb-3">
                    <span class="text-white font-semibold"><i class="fa-brands fa-ethereum text-zinc-500 mr-1"></i>${ze(e.raisedAmount)} ETH</span>
                    <span class="text-zinc-500">${t}% of ${ze(e.goalAmount)}</span>
                </div>
                <div class="flex justify-between text-xs text-zinc-500 pt-2 border-t border-zinc-800">
                    <span><i class="fa-solid fa-heart mr-1"></i>${e.donationCount||0}</span>
                    <span style="color:${a.color}">${a.text}</span>
                </div>
            </div>
        </div>
    `},so=()=>{var n,s,r;const e=k.campaigns.filter(i=>ri(i)),t=e.filter(i=>i.category==="animal"),a=e.filter(i=>i.category==="humanitarian");return`
        <div class="charity-page">
            ${yb()}
            ${xu()}
            ${ii()}

            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center float-animation">
                        <i class="fa-solid fa-hand-holding-heart text-2xl text-amber-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Charity Pool</h1>
                        <p class="text-sm text-zinc-500">Support causes with ETH &bull; 95% goes directly to campaigns</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button class="cp-btn cp-btn-secondary" onclick="CharityPage.openMyCampaigns()">
                        <i class="fa-solid fa-folder-open"></i> My Campaigns
                    </button>
                    <button class="cp-btn cp-btn-primary" onclick="CharityPage.openCreate()">
                        <i class="fa-solid fa-plus"></i> Create
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6 cp-stats-grid">
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-emerald-400 font-mono">
                        <i class="fa-brands fa-ethereum text-lg mr-1"></i>${k.stats?ze(k.stats.raised):"--"}
                    </p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Total Donated</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-blue-400 font-mono">
                        <i class="fa-brands fa-ethereum text-lg mr-1"></i>${k.stats?ze(k.stats.fees):"--"}
                    </p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">ETH Fees</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-amber-400 font-mono">${((n=k.stats)==null?void 0:n.created)??"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Campaigns</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-purple-400 font-mono">
                        <i class="fa-brands fa-ethereum text-lg mr-1"></i>${k.stats?ze(k.stats.withdrawn):"--"}
                    </p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Withdrawn</p>
                </div>
            </div>

            <!-- Categories -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8 cp-cats-grid">
                <div class="cp-category-card animal ${k.selectedCategory==="animal"?"selected":""}" onclick="CharityPage.selectCat('animal')">
                    <div class="w-16 h-16 rounded-full bg-emerald-500/15 flex items-center justify-center mx-auto mb-3">
                        <span class="text-3xl">${xe.animal.emoji}</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Animal Welfare</h3>
                    <div class="flex justify-center gap-6 text-sm text-zinc-400 mb-3">
                        <span><strong class="text-white">${t.length}</strong> active</span>
                        <span><i class="fa-brands fa-ethereum"></i> <strong class="text-white">${ze(t.reduce((i,o)=>i+BigInt(o.raisedAmount||0),0n))}</strong></span>
                    </div>
                    <button class="cp-btn cp-btn-success text-xs py-2 px-4" onclick="event.stopPropagation();CharityPage.openCreate('animal')">
                        <i class="fa-solid fa-plus"></i> Create Campaign
                    </button>
                </div>

                <div class="cp-category-card humanitarian ${k.selectedCategory==="humanitarian"?"selected":""}" onclick="CharityPage.selectCat('humanitarian')">
                    <div class="w-16 h-16 rounded-full bg-pink-500/15 flex items-center justify-center mx-auto mb-3">
                        <span class="text-3xl">${xe.humanitarian.emoji}</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Humanitarian Aid</h3>
                    <div class="flex justify-center gap-6 text-sm text-zinc-400 mb-3">
                        <span><strong class="text-white">${a.length}</strong> active</span>
                        <span><i class="fa-brands fa-ethereum"></i> <strong class="text-white">${ze(a.reduce((i,o)=>i+BigInt(o.raisedAmount||0),0n))}</strong></span>
                    </div>
                    <button class="cp-btn cp-btn-success text-xs py-2 px-4" onclick="event.stopPropagation();CharityPage.openCreate('humanitarian')">
                        <i class="fa-solid fa-plus"></i> Create Campaign
                    </button>
                </div>
            </div>

            <!-- Campaigns Grid -->
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-white flex items-center gap-2">
                    ${k.selectedCategory?`
                        <button onclick="CharityPage.clearCat()" class="text-zinc-500 hover:text-white transition-colors">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        ${(s=xe[k.selectedCategory])==null?void 0:s.emoji} ${(r=xe[k.selectedCategory])==null?void 0:r.name}
                    `:`
                        <i class="fa-solid fa-fire text-amber-500"></i> Active Campaigns
                    `}
                </h2>
                <span class="text-xs text-zinc-500">${e.filter(i=>!k.selectedCategory||i.category===k.selectedCategory).length} campaigns</span>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="cp-grid">
                ${e.length?e.filter(i=>!k.selectedCategory||i.category===k.selectedCategory).sort((i,o)=>Number(o.deadline||0)-Number(i.deadline||0)).map(i=>bu(i)).join(""):gu("No active campaigns")}
            </div>
        </div>
    `},ro=e=>{var o,l,d,u,p,m;if(!e)return`
        <div class="charity-page">
            <button class="cp-btn cp-btn-secondary mb-6" onclick="CharityPage.goBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <div class="cp-empty">
                <i class="fa-solid fa-circle-question"></i>
                <h3>Campaign not found</h3>
            </div>
        </div>
    `;const t=en(e.raisedAmount,e.goalAmount),a=ru(e.deadline),n=e.category||"humanitarian",s=ri(e),r=((o=e.creator)==null?void 0:o.toLowerCase())===((l=c==null?void 0:c.userAddress)==null?void 0:l.toLowerCase()),i=lu(e);return`
        <div class="charity-page">
            ${ii()}
            ${xu()}

            <div class="cp-detail">
                <!-- Header -->
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <button class="cp-btn cp-btn-secondary" onclick="CharityPage.goBack()">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                    ${fu(e.status)}
                    <span class="cp-badge" style="background:${(d=xe[n])==null?void 0:d.color}20;color:${(u=xe[n])==null?void 0:u.color}">
                        ${(p=xe[n])==null?void 0:p.emoji} ${(m=xe[n])==null?void 0:m.name}
                    </span>
                    ${e.isBoosted?mu():""}
                    ${r?'<span class="cp-badge" style="background:rgba(245,158,11,0.2);color:#f59e0b"><i class="fa-solid fa-user"></i> Your Campaign</span>':""}
                    ${r?`
                        <button class="cp-btn cp-btn-secondary text-xs py-2 ml-auto" onclick="CharityPage.openEdit('${e.id}')">
                            <i class="fa-solid fa-pen"></i> Edit
                        </button>
                    `:""}
                </div>

                <img src="${gs(e)}" class="cp-detail-img" onerror="this.src='${Fn.default}'">

                <div class="cp-detail-content">
                    <!-- Main Content -->
                    <div class="cp-card-base p-6">
                        <h1 class="text-2xl font-bold text-white mb-2">${e.title}</h1>
                        <p class="text-sm text-zinc-500 mb-4">
                            Created by <a href="${tu}${e.creator}" target="_blank" class="text-amber-500 hover:text-amber-400">${su(e.creator)}</a>
                        </p>
                        <p class="text-zinc-400 leading-relaxed whitespace-pre-wrap">${e.description||e.metadataUri||"No description provided."}</p>
                    </div>

                    <!-- Sidebar -->
                    <div class="cp-detail-sidebar">
                        <!-- Progress Card -->
                        <div class="cp-card-base p-5">
                            <div class="cp-progress h-3 mb-3">
                                <div class="cp-progress-fill ${n}" style="width:${t}%"></div>
                            </div>
                            <p class="text-3xl font-bold text-white mb-1">
                                <i class="fa-brands fa-ethereum text-zinc-500"></i> ${ze(e.raisedAmount)} ETH
                            </p>
                            <p class="text-sm text-zinc-500 mb-4">raised of ${ze(e.goalAmount)} ETH goal (${t}%)</p>

                            <div class="grid grid-cols-2 gap-3">
                                <div class="text-center p-3 bg-zinc-800/50 rounded-xl">
                                    <p class="text-lg font-bold text-white">${e.donationCount||0}</p>
                                    <p class="text-[10px] text-zinc-500 uppercase">Donors</p>
                                </div>
                                <div class="text-center p-3 bg-zinc-800/50 rounded-xl">
                                    <p class="text-lg font-bold" style="color:${a.color}">${a.text}</p>
                                    <p class="text-[10px] text-zinc-500 uppercase">${s?"Remaining":"Status"}</p>
                                </div>
                            </div>
                        </div>

                        ${s?`
                        <!-- Donate Card -->
                        <div class="cp-card-base p-5">
                            <h4 class="text-sm font-bold text-white mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-heart text-emerald-500"></i> Make a Donation
                            </h4>
                            <input type="number" id="detail-amount" placeholder="Amount in ETH" min="0.001" step="0.001"
                                   class="cp-form-input text-center text-lg font-bold mb-2">
                            <div class="cp-donate-presets mb-3">
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.01)">0.01</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.05)">0.05</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.1)">0.1</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.5)">0.5</button>
                            </div>
                            <button id="btn-donate-detail" class="cp-btn cp-btn-success w-full" onclick="CharityPage.donateDetail('${e.id}')">
                                <i class="fa-solid fa-heart"></i> Donate Now
                            </button>
                            <p class="text-center text-[10px] text-zinc-500 mt-2">
                                <strong>5%</strong> platform fee &bull; <strong>95%</strong> to campaign
                            </p>
                        </div>
                        `:""}

                        ${r&&s?`
                        <button id="btn-close-campaign" class="cp-btn cp-btn-danger w-full" onclick="CharityPage.closeCampaign('${e.id}')">
                            <i class="fa-solid fa-xmark"></i> Close Campaign
                        </button>
                        `:""}

                        ${r&&i?`
                        <button id="btn-withdraw" class="cp-btn cp-btn-primary w-full" onclick="CharityPage.withdraw('${e.id}')">
                            <i class="fa-solid fa-wallet"></i> Withdraw Funds
                        </button>
                        `:""}

                        ${s&&!r?`
                        <button class="cp-btn cp-btn-secondary w-full" onclick="CharityPage.boostCampaign('${e.id}')">
                            <i class="fa-solid fa-rocket"></i> Boost Campaign
                        </button>
                        `:""}

                        <!-- Share -->
                        <div class="cp-share-box">
                            <p class="cp-share-title">Share this campaign</p>
                            <div class="cp-share-btns">
                                <button class="cp-share-btn twitter" onclick="CharityPage.share('twitter')">
                                    <i class="fa-brands fa-x-twitter"></i>
                                </button>
                                <button class="cp-share-btn telegram" onclick="CharityPage.share('telegram')">
                                    <i class="fa-brands fa-telegram"></i>
                                </button>
                                <button class="cp-share-btn whatsapp" onclick="CharityPage.share('whatsapp')">
                                    <i class="fa-brands fa-whatsapp"></i>
                                </button>
                                <button class="cp-share-btn copy" onclick="CharityPage.copyLink()">
                                    <i class="fa-solid fa-link"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `},ii=()=>`
    <div class="cp-modal" id="modal-donate">
        <div class="cp-modal-content">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-heart text-emerald-500"></i> Donate</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('donate')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body">
                <div id="donate-campaign-info"></div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Amount (ETH)</label>
                    <div class="cp-donate-input-wrap">
                        <input type="number" id="donate-amount" class="cp-donate-input" placeholder="0.1" min="0.001" step="0.001">
                        <span class="cp-donate-currency">ETH</span>
                    </div>
                    <div class="cp-donate-presets">
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.01)">0.01</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.05)">0.05</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.1)">0.1</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.5)">0.5</button>
                    </div>
                </div>
                <div class="text-center text-xs text-zinc-500 p-3 bg-zinc-800/50 rounded-xl">
                    <strong>5%</strong> platform fee &bull; <strong>95%</strong> goes to campaign
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.closeModal('donate')">Cancel</button>
                <button id="btn-donate" class="cp-btn cp-btn-success" onclick="CharityPage.donate()"><i class="fa-solid fa-heart"></i> Donate</button>
            </div>
        </div>
    </div>
`,yb=()=>`
    <div class="cp-modal" id="modal-my">
        <div class="cp-modal-content" style="max-width:600px">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-folder-open text-amber-500"></i> My Campaigns</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('my')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body cp-scrollbar" style="max-height:60vh;overflow-y:auto">
                <div id="my-campaigns-list"></div>
            </div>
        </div>
    </div>
`,xu=()=>`
    <div class="cp-modal" id="modal-edit">
        <div class="cp-modal-content">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-pen text-amber-500"></i> Edit Campaign</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('edit')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body cp-scrollbar" style="max-height:60vh;overflow-y:auto">
                <input type="hidden" id="edit-campaign-id">
                <div class="cp-form-group">
                    <label class="cp-form-label">Category</label>
                    <div class="cp-cat-selector">
                        <label class="cp-cat-option" id="edit-opt-animal" onclick="CharityPage.selCatOpt('animal','edit')">
                            <input type="radio" name="edit-category" value="animal">
                            <div class="cp-cat-option-icon">${xe.animal.emoji}</div>
                            <div class="cp-cat-option-name">Animal</div>
                        </label>
                        <label class="cp-cat-option" id="edit-opt-humanitarian" onclick="CharityPage.selCatOpt('humanitarian','edit')">
                            <input type="radio" name="edit-category" value="humanitarian">
                            <div class="cp-cat-option-icon">${xe.humanitarian.emoji}</div>
                            <div class="cp-cat-option-name">Humanitarian</div>
                        </label>
                    </div>
                </div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Image</label>
                    <div class="cp-tabs" id="edit-image-tabs">
                        <button type="button" class="cp-tab active" data-tab="upload" onclick="CharityPage.switchImageTab('upload','edit')">Upload</button>
                        <button type="button" class="cp-tab" data-tab="url" onclick="CharityPage.switchImageTab('url','edit')">URL</button>
                    </div>
                    <div class="cp-image-upload" id="edit-image-upload" onclick="document.getElementById('edit-image-file').click()">
                        <input type="file" id="edit-image-file" accept="image/*" onchange="CharityPage.handleImageSelect(event,'edit')">
                        <div class="cp-image-upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                        <div class="cp-image-upload-text"><span>Click to upload</span> new image</div>
                        <div id="edit-image-preview"></div>
                    </div>
                    <div id="edit-image-url-wrap" style="display:none">
                        <input type="url" id="edit-image-url" class="cp-form-input" placeholder="https://example.com/image.jpg">
                    </div>
                </div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Title</label>
                    <input type="text" id="edit-title" class="cp-form-input" maxlength="100">
                </div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Description</label>
                    <textarea id="edit-desc" class="cp-form-input cp-form-textarea" maxlength="2000"></textarea>
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.closeModal('edit')">Cancel</button>
                <button id="btn-save-edit" class="cp-btn cp-btn-primary" onclick="CharityPage.saveEdit()"><i class="fa-solid fa-check"></i> Save</button>
            </div>
        </div>
    </div>
`,kb=()=>`
    <div class="charity-page">
        ${ii()}
        <!-- Header -->
        <div class="flex items-center gap-4 mb-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.cancelCreate()">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <div>
                <h1 class="text-xl font-bold text-white">Create Campaign</h1>
                <p class="text-sm text-zinc-500">Step ${k.createStep} of 4</p>
            </div>
        </div>

        <!-- Step Indicator -->
        <div class="cp-card-base p-5 mb-6">
            <div class="cp-step-container">
                <div class="cp-step-line ln-1" id="cp-ln-1"></div>
                <div class="cp-step-line ln-2" id="cp-ln-2"></div>
                <div class="cp-step-line ln-3" id="cp-ln-3"></div>
                <div class="cp-step-item">
                    <div class="cp-step-dot active" id="cp-step-1">1</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Category</span>
                </div>
                <div class="cp-step-item">
                    <div class="cp-step-dot pending" id="cp-step-2">2</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Details</span>
                </div>
                <div class="cp-step-item">
                    <div class="cp-step-dot pending" id="cp-step-3">3</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Image</span>
                </div>
                <div class="cp-step-item">
                    <div class="cp-step-dot pending" id="cp-step-4">4</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Confirm</span>
                </div>
            </div>
        </div>

        <!-- Step Content -->
        <div class="cp-card-base p-6" id="cp-wiz-panel"></div>
    </div>
`;function Eb(){[1,2,3,4].forEach(t=>{const a=document.getElementById(`cp-step-${t}`);a&&(t<k.createStep?(a.className="cp-step-dot done",a.innerHTML='<i class="fa-solid fa-check text-sm"></i>'):t===k.createStep?(a.className="cp-step-dot active",a.textContent=t):(a.className="cp-step-dot pending",a.textContent=t))}),[1,2,3].forEach(t=>{const a=document.getElementById(`cp-ln-${t}`);a&&(a.className=`cp-step-line ln-${t} ${k.createStep>t?"done":k.createStep===t?"active":""}`)});const e=document.querySelector(".charity-page .text-sm.text-zinc-500");e&&(e.textContent=`Step ${k.createStep} of 4`)}function tn(){const e=document.getElementById("cp-wiz-panel");if(e)switch(Eb(),k.createStep){case 1:Tb(e);break;case 2:Cb(e);break;case 3:Ib(e);break;case 4:Ab(e);break}}function Tb(e){e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Choose a Category</h2>
        <p class="text-sm text-zinc-500 mb-6">Select what type of cause your campaign supports</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 cp-wiz-cats-grid">
            <div class="cp-wiz-cat-card animal ${k.createCategory==="animal"?"selected":""}" onclick="CharityPage.wizardSelectCategory('animal')">
                <div class="w-16 h-16 rounded-full bg-emerald-500/15 flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">${xe.animal.emoji}</span>
                </div>
                <h3 class="text-lg font-bold text-white mb-1">Animal Welfare</h3>
                <p class="text-xs text-zinc-500">Rescue, shelter, and protection of animals</p>
            </div>
            <div class="cp-wiz-cat-card humanitarian ${k.createCategory==="humanitarian"?"selected":""}" onclick="CharityPage.wizardSelectCategory('humanitarian')">
                <div class="w-16 h-16 rounded-full bg-pink-500/15 flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">${xe.humanitarian.emoji}</span>
                </div>
                <h3 class="text-lg font-bold text-white mb-1">Humanitarian Aid</h3>
                <p class="text-xs text-zinc-500">Help communities and people in need</p>
            </div>
        </div>
        <div class="flex justify-end mt-6">
            <button class="cp-btn cp-btn-primary ${k.createCategory?"":"opacity-50 cursor-not-allowed"}"
                    onclick="CharityPage.wizardNext()" ${k.createCategory?"":"disabled"}>
                Next <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    `}function Cb(e){const t=k.createTitle.length,a=k.createDesc.length;e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Campaign Details</h2>
        <p class="text-sm text-zinc-500 mb-6">Tell your story &mdash; what is this campaign about?</p>
        <div class="cp-form-group">
            <label class="cp-form-label">Title *</label>
            <input type="text" id="wiz-title" class="cp-form-input" placeholder="Give your campaign a clear title" maxlength="100"
                   value="${k.createTitle.replace(/"/g,"&quot;")}" oninput="CharityPage.wizardUpdateCharCount('title', this)">
            <div class="cp-wiz-char-count ${t>80?t>95?"danger":"warn":""}" id="wiz-title-count">${t}/100</div>
        </div>
        <div class="cp-form-group">
            <label class="cp-form-label">Description *</label>
            <textarea id="wiz-desc" class="cp-form-input cp-form-textarea" placeholder="Describe the cause, how funds will be used, and why it matters..."
                      maxlength="2000" style="min-height:140px" oninput="CharityPage.wizardUpdateCharCount('desc', this)">${k.createDesc}</textarea>
            <div class="cp-wiz-char-count ${a>1800?a>1950?"danger":"warn":""}" id="wiz-desc-count">${a}/2000</div>
        </div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <button class="cp-btn cp-btn-primary" onclick="CharityPage.wizardNext()">
                Next <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    `}function Ib(e){e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Campaign Image</h2>
        <p class="text-sm text-zinc-500 mb-6">Add a cover image to attract more donors <span class="text-zinc-600">(optional)</span></p>
        <div class="cp-tabs mb-4" id="wiz-image-tabs">
            <button type="button" class="cp-tab active" data-tab="upload" onclick="CharityPage.switchImageTab('upload','wiz')">
                <i class="fa-solid fa-cloud-arrow-up mr-1"></i> Upload
            </button>
            <button type="button" class="cp-tab" data-tab="url" onclick="CharityPage.switchImageTab('url','wiz')">
                <i class="fa-solid fa-link mr-1"></i> URL
            </button>
        </div>
        <div id="wiz-image-upload" class="cp-image-upload" onclick="document.getElementById('wiz-image-file').click()">
            <input type="file" id="wiz-image-file" accept="image/*" onchange="CharityPage.handleWizardImageSelect(event)">
            <div id="wiz-image-preview">
                ${k.createImagePreview?`
                    <img src="${k.createImagePreview}" class="cp-image-preview">
                    <button type="button" class="cp-image-remove" onclick="event.stopPropagation();CharityPage.removeWizardImage()">
                        <i class="fa-solid fa-xmark"></i> Remove
                    </button>
                `:`
                    <div class="cp-image-upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                    <div class="cp-image-upload-text"><span>Click to upload</span> or drag and drop<br><small>PNG, JPG, GIF, WebP &mdash; max 5MB</small></div>
                `}
            </div>
        </div>
        <div id="wiz-image-url-wrap" style="display:none">
            <input type="url" id="wiz-image-url" class="cp-form-input" placeholder="https://example.com/image.jpg"
                   value="${k.createImageUrl.replace(/"/g,"&quot;")}">
        </div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <div class="flex gap-2">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardSkipImage()">
                    Skip <i class="fa-solid fa-forward"></i>
                </button>
                <button class="cp-btn cp-btn-primary" onclick="CharityPage.wizardNext()">
                    Next <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>
    `}function Ab(e){const t=xe[k.createCategory]||xe.humanitarian;e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Confirm & Launch</h2>
        <p class="text-sm text-zinc-500 mb-6">Set your goal, duration and review before launching</p>
        <div class="cp-form-row mb-4">
            <div class="cp-form-group">
                <label class="cp-form-label">Goal (ETH) *</label>
                <input type="number" id="wiz-goal" class="cp-form-input" placeholder="1.0" min="0.01" step="0.01"
                       value="${k.createGoal}">
            </div>
            <div class="cp-form-group">
                <label class="cp-form-label">Duration (Days) * <span>1-365</span></label>
                <input type="number" id="wiz-duration" class="cp-form-input" placeholder="30" min="1" max="365"
                       value="${k.createDuration}">
            </div>
        </div>

        <!-- Summary -->
        <div class="cp-wiz-summary mb-4">
            <h4 class="text-sm font-bold text-white mb-3"><i class="fa-solid fa-clipboard-list text-amber-500 mr-2"></i>Summary</h4>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Category</span>
                <span class="text-white">${t.emoji} ${t.name}</span>
            </div>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Title</span>
                <span class="text-white truncate ml-4" style="max-width:200px">${k.createTitle||"â€”"}</span>
            </div>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Description</span>
                <span class="text-white">${k.createDesc?`${k.createDesc.length} chars`:"â€”"}</span>
            </div>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Image</span>
                <span class="text-white">${k.createImagePreview||k.createImageUrl?'<i class="fa-solid fa-check text-emerald-400"></i> Added':'<span class="text-zinc-600">None</span>'}</span>
            </div>
        </div>

        <!-- Cost Info (V9: ETH fee, not BKC) -->
        <div class="text-center text-xs text-zinc-500 p-3 bg-zinc-800/50 rounded-xl mb-4">
            <i class="fa-brands fa-ethereum text-amber-400 mr-1"></i>
            Campaign creation requires a small <strong class="text-amber-400">ETH fee</strong> (gas + ecosystem fee)
        </div>

        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <button id="btn-wizard-launch" class="cp-btn cp-btn-primary" onclick="CharityPage.wizardLaunch()">
                <i class="fa-solid fa-rocket"></i> Launch Campaign
            </button>
        </div>
    `}function Pb(e){k.createCategory=e,tn()}function Bb(){var e,t,a,n,s,r;switch(k.createStep){case 1:if(!k.createCategory)return b("Select a category","error");break;case 2:{const i=((t=(e=document.getElementById("wiz-title"))==null?void 0:e.value)==null?void 0:t.trim())||"",o=((n=(a=document.getElementById("wiz-desc"))==null?void 0:a.value)==null?void 0:n.trim())||"";if(k.createTitle=i,k.createDesc=o,!i)return b("Enter a title","error");if(!o)return b("Enter a description","error");break}case 3:{const i=((r=(s=document.getElementById("wiz-image-url"))==null?void 0:s.value)==null?void 0:r.trim())||"";i&&(k.createImageUrl=i);break}}k.createStep=Math.min(4,k.createStep+1),tn()}function Sb(){Nb(),k.createStep=Math.max(1,k.createStep-1),tn()}function zb(){k.createImageFile=null,k.createImageUrl="",k.createImagePreview=null,k.pendingImageFile=null,k.createStep=4,tn()}function hu(){k.currentView="main",k.createStep=1,k.createCategory=null,k.createTitle="",k.createDesc="",k.createGoal="",k.createDuration="",k.createImageFile=null,k.createImageUrl="",k.createImagePreview=null,k.pendingImageFile=null,Ze()}function Nb(){switch(k.createStep){case 2:{const e=document.getElementById("wiz-title"),t=document.getElementById("wiz-desc");e&&(k.createTitle=e.value),t&&(k.createDesc=t.value);break}case 3:{const e=document.getElementById("wiz-image-url");e&&(k.createImageUrl=e.value.trim());break}case 4:{const e=document.getElementById("wiz-goal"),t=document.getElementById("wiz-duration");e&&(k.createGoal=e.value),t&&(k.createDuration=t.value);break}}}function $b(e,t){const a=t.value.length,n=e==="title"?100:2e3,s=e==="title"?80:1800,r=e==="title"?95:1950,i=document.getElementById(`wiz-${e}-count`);i&&(i.textContent=`${a}/${n}`,i.className=`cp-wiz-char-count ${a>r?"danger":a>s?"warn":""}`)}function Lb(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(!t)return;if(!nu.includes(t.type)){b("Please select a valid image (JPG, PNG, GIF, WebP)","error");return}if(t.size>au){b("Image must be less than 5MB","error");return}k.createImageFile=t,k.pendingImageFile=t;const a=new FileReader;a.onload=s=>{k.createImagePreview=s.target.result;const r=document.getElementById("wiz-image-preview");r&&(r.innerHTML=`
                <img src="${s.target.result}" class="cp-image-preview">
                <button type="button" class="cp-image-remove" onclick="event.stopPropagation();CharityPage.removeWizardImage()">
                    <i class="fa-solid fa-xmark"></i> Remove
                </button>
            `)},a.readAsDataURL(t)}function Rb(){k.createImageFile=null,k.createImagePreview=null,k.createImageUrl="",k.pendingImageFile=null;const e=document.getElementById("wiz-image-preview");e&&(e.innerHTML=`
            <div class="cp-image-upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
            <div class="cp-image-upload-text"><span>Click to upload</span> or drag and drop<br><small>PNG, JPG, GIF, WebP &mdash; max 5MB</small></div>
        `);const t=document.getElementById("wiz-image-file");t&&(t.value="")}async function _b(){var l,d;if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");const e=(l=document.getElementById("wiz-goal"))==null?void 0:l.value,t=(d=document.getElementById("wiz-duration"))==null?void 0:d.value;if(k.createGoal=e||"",k.createDuration=t||"",!k.createCategory)return b("Select a category","error");if(!k.createTitle)return b("Enter a title","error");if(!k.createDesc)return b("Enter a description","error");if(!e||parseFloat(e)<.01)return b("Goal must be at least 0.01 ETH","error");if(!t||parseInt(t)<1||parseInt(t)>365)return b("Duration must be 1-365 days","error");let a=k.createImageUrl||"";if(k.createImageFile)try{b("Uploading image to IPFS...","info"),a=await pu(k.createImageFile),b("Image uploaded!","success")}catch(u){console.error("Image upload failed:",u),b("Image upload failed - campaign will be created without image","warning")}const n=k.createTitle,s=k.createDesc,r=k.createCategory,i=si.parseEther(e),o=parseInt(t);await Xe.createCampaign({title:n,metadataUri:s,goalAmount:i,durationDays:o,button:document.getElementById("btn-wizard-launch"),onSuccess:async(u,p)=>{if(p){du(p,{imageUrl:a,category:r,title:n,description:s});try{await fetch(ms.saveCampaign,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:p,title:n,description:s,category:r,imageUrl:a,creator:c.userAddress})})}catch{}}b("Campaign created!","success"),hu(),await Nt(),Ze()},onError:u=>{var p;!u.cancelled&&u.type!=="user_rejected"&&b(((p=u.message)==null?void 0:p.slice(0,80))||"Failed","error")}})}function bs(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.add("active")}function Kt(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.remove("active")}function Fb(e=null){k.createStep=e?2:1,k.createCategory=e,k.createTitle="",k.createDesc="",k.createGoal="",k.createDuration="",k.createImageFile=null,k.createImageUrl="",k.createImagePreview=null,k.pendingImageFile=null,k.currentView="create",Ze()}function Mb(e){const t=k.campaigns.find(s=>s.id===e||s.id===String(e));if(!t)return;const a=document.getElementById("donate-campaign-info");a&&(a.innerHTML=`
            <div class="flex items-center gap-3 p-3 bg-zinc-800/50 rounded-xl mb-4">
                <img src="${gs(t)}" class="w-12 h-12 rounded-lg object-cover">
                <div class="flex-1 min-w-0">
                    <p class="text-white font-semibold text-sm truncate">${t.title}</p>
                    <p class="text-zinc-500 text-xs">${en(t.raisedAmount,t.goalAmount)}% funded</p>
                </div>
            </div>
        `);const n=document.getElementById("donate-amount");n&&(n.value=""),k.currentCampaign=t,bs("donate")}function Db(){var n;const e=(n=c==null?void 0:c.userAddress)==null?void 0:n.toLowerCase(),t=k.campaigns.filter(s=>{var r;return((r=s.creator)==null?void 0:r.toLowerCase())===e}),a=document.getElementById("my-campaigns-list");a&&(t.length===0?a.innerHTML=`
            <div class="cp-empty">
                <i class="fa-solid fa-folder-open"></i>
                <h3>No campaigns yet</h3>
                <p class="text-zinc-600 text-sm mb-4">Create your first campaign to start raising funds</p>
                <button class="cp-btn cp-btn-primary" onclick="CharityPage.closeModal('my');CharityPage.openCreate()">
                    <i class="fa-solid fa-plus"></i> Create Campaign
                </button>
            </div>
        `:a.innerHTML=t.map(s=>{const r=en(s.raisedAmount,s.goalAmount),i=lu(s);return`
                <div class="flex items-center gap-3 p-3 bg-zinc-800/30 rounded-xl mb-2 hover:bg-zinc-800/50 transition-colors">
                    <img src="${gs(s)}" class="w-14 h-14 rounded-lg object-cover cursor-pointer" onclick="CharityPage.viewCampaign('${s.id}')">
                    <div class="flex-1 min-w-0">
                        <p class="text-white font-semibold text-sm truncate cursor-pointer hover:text-amber-400" onclick="CharityPage.viewCampaign('${s.id}')">${s.title}</p>
                        <p class="text-zinc-500 text-xs"><i class="fa-brands fa-ethereum"></i> ${ze(s.raisedAmount)} / ${ze(s.goalAmount)} ETH (${r}%)</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="cp-btn cp-btn-secondary text-xs py-1.5 px-3" onclick="CharityPage.openEdit('${s.id}')">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                        ${i?`
                            <button id="btn-withdraw-${s.id}" class="cp-btn cp-btn-primary text-xs py-1.5 px-3" onclick="CharityPage.withdraw('${s.id}')">
                                <i class="fa-solid fa-wallet"></i>
                            </button>
                        `:""}
                    </div>
                </div>
            `}).join(""),bs("my"))}function Ob(e){var n,s,r;const t=k.campaigns.find(i=>i.id===e||i.id===String(e));if(!t)return;if(((n=t.creator)==null?void 0:n.toLowerCase())!==((s=c==null?void 0:c.userAddress)==null?void 0:s.toLowerCase())){b("Not your campaign","error");return}k.editingCampaign=t,k.pendingImageFile=null,document.getElementById("edit-campaign-id").value=t.id,document.getElementById("edit-title").value=t.title||"",document.getElementById("edit-desc").value=t.description||"",document.getElementById("edit-image-url").value=t.imageUrl||"",document.querySelectorAll("#modal-edit .cp-cat-option").forEach(i=>i.classList.remove("selected")),(r=document.getElementById(`edit-opt-${t.category||"humanitarian"}`))==null||r.classList.add("selected");const a=document.getElementById("edit-image-preview");a&&t.imageUrl?a.innerHTML=`<img src="${t.imageUrl}" class="cp-image-preview">`:a&&(a.innerHTML=""),bs("edit")}function Hb(e,t="create"){var s;const a=t==="edit"?"edit-opt-":"opt-",n=t==="edit"?"#modal-edit":"#modal-create";document.querySelectorAll(`${n} .cp-cat-option`).forEach(r=>r.classList.remove("selected")),(s=document.getElementById(`${a}${e}`))==null||s.classList.add("selected")}function Ub(e){const t=document.getElementById("donate-amount")||document.getElementById("detail-amount");t&&(t.value=e)}async function jb(){var n;if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");const e=k.currentCampaign;if(!e)return;const t=(n=document.getElementById("donate-amount"))==null?void 0:n.value;if(!t||parseFloat(t)<.001)return b("Minimum 0.001 ETH","error");const a=si.parseEther(t);await Xe.donate({campaignId:e.id,amount:a,button:document.getElementById("btn-donate"),onSuccess:async()=>{b("Thank you for your donation!","success"),Kt("donate"),await Nt(),Ze()},onError:s=>{var r;!s.cancelled&&s.type!=="user_rejected"&&b(((r=s.message)==null?void 0:r.slice(0,80))||"Failed","error")}})}async function Wb(e){var n;if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");const t=(n=document.getElementById("detail-amount"))==null?void 0:n.value;if(!t||parseFloat(t)<.001)return b("Minimum 0.001 ETH","error");const a=si.parseEther(t);await Xe.donate({campaignId:e,amount:a,button:document.getElementById("btn-donate-detail"),onSuccess:async()=>{b("Thank you for your donation!","success"),await Nt(),await $t(e)},onError:s=>{var r;!s.cancelled&&s.type!=="user_rejected"&&b(((r=s.message)==null?void 0:r.slice(0,80))||"Failed","error")}})}async function io(e){if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");confirm("Close this campaign? You can still withdraw raised funds.")&&await Xe.closeCampaign({campaignId:e,button:document.getElementById("btn-close-campaign"),onSuccess:async()=>{b("Campaign closed","success"),await Nt(),Ze()},onError:t=>{var a;!t.cancelled&&t.type!=="user_rejected"&&b(((a=t.message)==null?void 0:a.slice(0,80))||"Failed","error")}})}async function Gb(e){if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");const t=k.campaigns.find(s=>s.id===e||s.id===String(e));if(!t)return;const a=en(t.raisedAmount,t.goalAmount);let n=`Withdraw ${ze(t.raisedAmount)} ETH?`;a<100&&(n+=`
Goal not reached - partial withdrawal.`),confirm(n)&&await Xe.withdraw({campaignId:e,button:document.getElementById(`btn-withdraw-${e}`)||document.getElementById("btn-withdraw"),onSuccess:async()=>{var s;b("Funds withdrawn successfully!","success"),Kt("my"),await Nt(),Ze(),((s=k.currentCampaign)==null?void 0:s.id)===e&&await $t(e)},onError:s=>{var r;!s.cancelled&&s.type!=="user_rejected"&&b(((r=s.message)==null?void 0:r.slice(0,80))||"Failed","error")}})}async function Yb(e){if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");confirm("Boost this campaign for visibility? A small ETH fee applies.")&&await Xe.boostCampaign({campaignId:e,onSuccess:async()=>{var t;b("Campaign boosted!","success"),await Nt(),((t=k.currentCampaign)==null?void 0:t.id)===String(e)?await $t(e):Ze()},onError:t=>{var a;!t.cancelled&&t.type!=="user_rejected"&&b(((a=t.message)==null?void 0:a.slice(0,80))||"Failed","error")}})}async function Kb(){var o,l,d,u,p,m,g,x;if(!(c!=null&&c.isConnected))return b("Connect wallet","warning");const e=(o=document.getElementById("edit-campaign-id"))==null?void 0:o.value,t=(d=(l=document.getElementById("edit-title"))==null?void 0:l.value)==null?void 0:d.trim(),a=(p=(u=document.getElementById("edit-desc"))==null?void 0:u.value)==null?void 0:p.trim();let n=(g=(m=document.getElementById("edit-image-url"))==null?void 0:m.value)==null?void 0:g.trim();const s=document.querySelector("#modal-edit .cp-cat-option.selected input"),r=(s==null?void 0:s.value)||"humanitarian";if(!t)return b("Enter title","error");if(k.pendingImageFile)try{b("Uploading image...","info"),n=await pu(k.pendingImageFile)}catch(h){console.error("Image upload failed:",h)}const i=document.getElementById("btn-save-edit");i&&(i.disabled=!0,i.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Saving...');try{du(e,{imageUrl:n,category:r,title:t,description:a}),await fetch(ms.saveCampaign,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,title:t,description:a,category:r,imageUrl:n,creator:c.userAddress})}),b("Campaign updated!","success"),Kt("edit"),k.pendingImageFile=null,await Nt(),((x=k.currentCampaign)==null?void 0:x.id)===e?await $t(e):Ze()}catch{b("Failed to save","error")}finally{i&&(i.disabled=!1,i.innerHTML='<i class="fa-solid fa-check"></i> Save')}}function Vb(e){const t=k.currentCampaign;if(!t)return;const a=iu(t.id),n=`Support "${t.title}" on Backcoin Charity!

${ze(t.raisedAmount)} raised of ${ze(t.goalAmount)} goal.

`;let s;e==="twitter"?s=`https://twitter.com/intent/tweet?text=${encodeURIComponent(n)}&url=${encodeURIComponent(a)}`:e==="telegram"?s=`https://t.me/share/url?url=${encodeURIComponent(a)}&text=${encodeURIComponent(n)}`:e==="whatsapp"&&(s=`https://wa.me/?text=${encodeURIComponent(n+a)}`),s&&window.open(s,"_blank","width=600,height=400")}function qb(){const e=k.currentCampaign;e&&navigator.clipboard.writeText(iu(e.id)).then(()=>b("Link copied!","success")).catch(()=>b("Copy failed","error"))}function vu(){gb(),k.currentCampaign=null,k.currentView="main",Ze()}function Xb(e){Kt("my"),Kt("donate"),Kt("edit"),mb(e),$t(e)}function Jb(e){k.selectedCategory=k.selectedCategory===e?null:e,oi()}function Zb(){k.selectedCategory=null,oi()}function oi(){const e=document.getElementById("cp-grid");if(!e)return;let t=k.campaigns.filter(a=>ri(a));k.selectedCategory&&(t=t.filter(a=>a.category===k.selectedCategory)),t.sort((a,n)=>Number(n.deadline||0)-Number(a.deadline||0)),e.innerHTML=t.length?t.map(a=>bu(a)).join(""):gu("No campaigns")}async function $t(e){k.currentView="detail",k.isLoading=!0;const t=Js();t&&(t.innerHTML=wb());try{let a=k.campaigns.find(n=>n.id===e||n.id===String(e));if(!a)try{const n=await Xe.getCampaign(e),s=uu(e);a={id:String(e),creator:n.creator,title:n.title||`Campaign #${e}`,description:(s==null?void 0:s.description)||n.metadataUri||"",metadataUri:n.metadataUri,goalAmount:n.goalAmount,raisedAmount:n.raisedAmount,raised:n.raisedAmount,donationCount:n.donationCount,deadline:n.deadline,status:n.status,isBoosted:n.isBoosted,isActive:n.isActive,progress:n.progress,category:(s==null?void 0:s.category)||"humanitarian",imageUrl:(s==null?void 0:s.imageUrl)||null}}catch(n){console.error(`[CharityPage] loadDetail(${e}) failed:`,n)}k.currentCampaign=a,t&&(t.innerHTML=ro(a))}catch{t&&(t.innerHTML=ro(null))}finally{k.isLoading=!1}}function Js(){let e=document.getElementById("charity-container");if(e)return e;const t=document.getElementById("charity");return t?(e=document.createElement("div"),e.id="charity-container",t.innerHTML="",t.appendChild(e),e):null}function Ze(){fb();const e=Js();if(!e)return;if(k.currentView==="create"){e.innerHTML=kb(),tn();return}const t=ou();t?$t(t):(k.currentView="main",k.currentCampaign=null,e.innerHTML=so(),Nt().then(()=>{if(k.currentView==="main"){const a=Js();a&&(a.innerHTML=so())}}))}async function Qb(){k.campaigns=[],k.stats=null,k.currentView==="detail"&&k.currentCampaign?await $t(k.currentCampaign.id):Ze()}window.addEventListener("hashchange",()=>{var e;if(window.location.hash.startsWith("#charity")){const t=ou();t?((e=k.currentCampaign)==null?void 0:e.id)!==t&&$t(t):k.currentView!=="main"&&vu()}});const ex={render(e){e&&Ze()},update(){k.currentView==="main"&&oi()},refresh:Qb,openModal:bs,closeModal:Kt,openCreate:Fb,openDonate:Mb,openMyCampaigns:Db,openEdit:Ob,donate:jb,donateDetail:Wb,closeCampaign:io,cancel:io,withdraw:Gb,boostCampaign:Yb,saveEdit:Kb,selCatOpt:Hb,setAmt:Ub,goBack:vu,viewCampaign:Xb,selectCat:Jb,clearCat:Zb,share:Vb,copyLink:qb,handleImageSelect:xb,removeImage:hb,switchImageTab:vb,wizardSelectCategory:Pb,wizardNext:Bb,wizardBack:Sb,wizardSkipImage:zb,cancelCreate:hu,wizardUpdateCharCount:$b,handleWizardImageSelect:Lb,removeWizardImage:Rb,wizardLaunch:_b},oo=15,lo=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}];class Mn{constructor(){this.roomId=null,this.localStream=null,this.peerConnections=new Map,this.unsubscribers=[],this.isStreamer=!1,this.remoteStream=null,this.onViewerCountChange=null,this.onStreamEnd=null,this.onRemoteStream=null,this.onError=null}async startStream(t,a){this.localStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!0}),this.isStreamer=!0,this.roomId=`live_${t}_${Date.now()}`;const n=se(U,"agora_live_rooms",this.roomId);await Ya(n,{streamerAddress:a.toLowerCase(),postId:String(t),status:"live",viewerCount:0,createdAt:Be()});const s=Ee(U,"agora_live_rooms",this.roomId,"signals"),r=na(Pe(s,Ie("type","==","join-request")),l=>{l.docChanges().forEach(d=>{d.type==="added"&&this._handleJoinRequest(d.doc.data()).catch(u=>console.warn("[WebRTC] Join request error:",u))})});this.unsubscribers.push(r);const i=na(Pe(s,Ie("type","==","answer-complete")),l=>{l.docChanges().forEach(d=>{d.type==="added"&&this._handleAnswerComplete(d.doc.data()).catch(u=>console.warn("[WebRTC] Answer complete error:",u))})});this.unsubscribers.push(i);const o=na(Pe(s,Ie("type","==","ice-from-viewer")),l=>{l.docChanges().forEach(d=>{d.type==="added"&&this._handleRemoteICE(d.doc.data()).catch(u=>console.warn("[WebRTC] ICE error:",u))})});return this.unsubscribers.push(o),console.log(`[WebRTC] Stream started: ${this.roomId}`),{roomId:this.roomId,stream:this.localStream}}async _handleJoinRequest(t){const a=t.from;if(!a)return;if(this.peerConnections.size>=oo){console.warn(`[WebRTC] Max viewers (${oo}) reached, rejecting ${a}`);return}this.peerConnections.has(a)&&(this.peerConnections.get(a).close(),this.peerConnections.delete(a));const n=new RTCPeerConnection({iceServers:lo});this.peerConnections.set(a,n),this.localStream.getTracks().forEach(o=>{n.addTrack(o,this.localStream)}),n.onicecandidate=async o=>{if(o.candidate)try{const l=Ee(U,"agora_live_rooms",this.roomId,"signals");await ia(l,{type:"ice-from-streamer",to:a,data:JSON.stringify(o.candidate.toJSON()),createdAt:Be()})}catch(l){console.warn("[WebRTC] Failed to send ICE:",l)}},n.onconnectionstatechange=()=>{(n.connectionState==="disconnected"||n.connectionState==="failed")&&this._removeViewer(a)};const s=await n.createOffer();await n.setLocalDescription(s);const r=Ee(U,"agora_live_rooms",this.roomId,"signals");await ia(r,{type:"offer-for-viewer",to:a,data:JSON.stringify(n.localDescription.toJSON()),createdAt:Be()});const i=se(U,"agora_live_rooms",this.roomId);await ma(i,{viewerCount:Ge(1)}),this.onViewerCountChange&&this.onViewerCountChange(this.peerConnections.size),console.log(`[WebRTC] Offer sent to viewer: ${a.slice(0,8)}...`)}async _handleAnswerComplete(t){const a=t.from,n=this.peerConnections.get(a);if(n)try{const s=JSON.parse(t.data);await n.setRemoteDescription(new RTCSessionDescription(s)),console.log(`[WebRTC] Connection established with viewer: ${a.slice(0,8)}...`)}catch(s){console.warn("[WebRTC] Failed to set remote description:",s)}}async _handleRemoteICE(t){const a=this.peerConnections.get(t.from);if(a)try{const n=JSON.parse(t.data);await a.addIceCandidate(new RTCIceCandidate(n))}catch(n){console.warn("[WebRTC] Failed to add ICE candidate:",n)}}_removeViewer(t){const a=this.peerConnections.get(t);a&&(a.close(),this.peerConnections.delete(t),this.onViewerCountChange&&this.onViewerCountChange(this.peerConnections.size))}async endStream(){var t;if((t=this.localStream)==null||t.getTracks().forEach(a=>a.stop()),this.peerConnections.forEach(a=>a.close()),this.peerConnections.clear(),this.unsubscribers.forEach(a=>a()),this.unsubscribers=[],this.roomId)try{const a=se(U,"agora_live_rooms",this.roomId);await ma(a,{status:"ended"})}catch(a){console.warn("[WebRTC] Failed to update room status:",a)}console.log(`[WebRTC] Stream ended: ${this.roomId}`),this.localStream=null,this.roomId=null,this.isStreamer=!1}async joinStream(t,a){this.roomId=t,this.isStreamer=!1;const n=a.toLowerCase(),s=new RTCPeerConnection({iceServers:lo});this.peerConnections.set("streamer",s),s.ontrack=u=>{this.remoteStream=u.streams[0],this.onRemoteStream&&this.onRemoteStream(this.remoteStream)},s.onicecandidate=async u=>{if(u.candidate)try{const p=Ee(U,"agora_live_rooms",this.roomId,"signals");await ia(p,{type:"ice-from-viewer",from:n,data:JSON.stringify(u.candidate.toJSON()),createdAt:Be()})}catch(p){console.warn("[WebRTC] Failed to send ICE:",p)}},s.onconnectionstatechange=()=>{s.connectionState==="failed"&&(this.onError&&this.onError("Connection failed"),this.leaveStream())};const r=Ee(U,"agora_live_rooms",this.roomId,"signals");await ia(r,{type:"join-request",from:n,createdAt:Be()});const i=na(Pe(r,Ie("type","==","offer-for-viewer"),Ie("to","==",n)),u=>{u.docChanges().forEach(async p=>{if(p.type==="added")try{const m=JSON.parse(p.doc.data().data);await s.setRemoteDescription(new RTCSessionDescription(m));const g=await s.createAnswer();await s.setLocalDescription(g),await ia(r,{type:"answer-complete",from:n,data:JSON.stringify(s.localDescription.toJSON()),createdAt:Be()}),console.log("[WebRTC] Answer sent to streamer")}catch(m){console.warn("[WebRTC] Offer handling error:",m)}})});this.unsubscribers.push(i);const o=na(Pe(r,Ie("type","==","ice-from-streamer"),Ie("to","==",n)),u=>{u.docChanges().forEach(async p=>{if(p.type==="added")try{const m=JSON.parse(p.doc.data().data);await s.addIceCandidate(new RTCIceCandidate(m))}catch(m){console.warn("[WebRTC] ICE add failed:",m)}})});this.unsubscribers.push(o);const l=se(U,"agora_live_rooms",this.roomId),d=na(l,u=>{u.exists()&&u.data().status==="ended"&&(this.leaveStream(),this.onStreamEnd&&this.onStreamEnd())});this.unsubscribers.push(d),console.log(`[WebRTC] Joined stream: ${t}`)}leaveStream(){this.peerConnections.forEach(t=>t.close()),this.peerConnections.clear(),this.unsubscribers.forEach(t=>t()),this.unsubscribers=[],this.remoteStream=null,this.roomId=null}static async getActiveRooms(){try{const t=Ee(U,"agora_live_rooms"),a=Pe(t,Ie("status","==","live"));return(await st(a)).docs.map(s=>({id:s.id,...s.data()}))}catch(t){return console.warn("[WebRTC] Failed to get active rooms:",t),[]}}static async getRoomByPostId(t){try{const a=Ee(U,"agora_live_rooms"),n=Pe(a,Ie("postId","==",String(t)),Ie("status","==","live")),s=await st(n);if(s.empty)return null;const r=s.docs[0];return{id:r.id,...r.data()}}catch(a){return console.warn("[WebRTC] Failed to get room by postId:",a),null}}}const Ce=window.ethers,wu="https://sepolia.arbiscan.io/address/",tx=Bo,It=500,ya=[{id:0,name:"General",icon:"fa-globe",color:"#8b8b9e"},{id:1,name:"News",icon:"fa-newspaper",color:"#f59e0b"},{id:2,name:"Politics",icon:"fa-landmark-dome",color:"#6366f1"},{id:3,name:"Comedy",icon:"fa-face-laugh-squint",color:"#facc15"},{id:4,name:"Sports",icon:"fa-futbol",color:"#fb923c"},{id:5,name:"Crypto",icon:"fa-bitcoin-sign",color:"#f7931a"},{id:6,name:"Tech",icon:"fa-microchip",color:"#3b82f6"},{id:7,name:"Art",icon:"fa-palette",color:"#f472b6"},{id:8,name:"Music",icon:"fa-music",color:"#a78bfa"},{id:9,name:"Gaming",icon:"fa-gamepad",color:"#ec4899"},{id:10,name:"Business",icon:"fa-briefcase",color:"#10b981"},{id:11,name:"Education",icon:"fa-graduation-cap",color:"#14b8a6"},{id:12,name:"Lifestyle",icon:"fa-heart",color:"#e879f9"},{id:13,name:"Adult",icon:"fa-fire",color:"#ef4444"},{id:14,name:"Random",icon:"fa-shuffle",color:"#6b7280"}];function co(e){if(!e||e===0)return"";const t=Math.floor(Date.now()/1e3),a=e-t;if(a<=0)return"(expired)";const n=Math.floor(a/86400);return n>0?`(${n}d left)`:`(${Math.floor(a/3600)}h left)`}function ax(){const e=Math.floor(Date.now()/1e3);let t="";if(f.isBoosted&&f.boostExpiry>0){const a=Math.floor((f.boostExpiry-e)/86400);a<=7&&a>0&&(t+=`<div style="padding:8px 16px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.15);border-radius:8px;margin-top:8px;font-size:12px;color:var(--bc-accent);display:flex;align-items:center;gap:6px;">
                <i class="fa-solid fa-clock"></i> Boost expires in ${a} day${a!==1?"s":""} â€”
                <button class="bc-btn bc-btn-primary" style="padding:4px 12px;font-size:11px;" onclick="BackchatPage.openBoost()">Renew</button>
            </div>`)}if(f.hasBadge&&f.badgeExpiry>0){const a=Math.floor((f.badgeExpiry-e)/86400);a<=30&&a>0&&(t+=`<div style="padding:8px 16px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.15);border-radius:8px;margin-top:8px;font-size:12px;color:var(--bc-accent);display:flex;align-items:center;gap:6px;">
                <i class="fa-solid fa-clock"></i> Badge expires in ${a} day${a!==1?"s":""} â€”
                <button class="bc-btn bc-btn-primary" style="padding:4px 12px;font-size:11px;" onclick="BackchatPage.openBadge()">Renew</button>
            </div>`)}return t}function yu(){return y.agora||y.backchat||y.Backchat||null}function Fe(){return y.operator||y.treasury||null}const f={view:"feed",activeTab:"feed",viewHistory:[],posts:[],trendingPosts:[],allItems:[],replies:new Map,likesMap:new Map,replyCountMap:new Map,repostCountMap:new Map,postsById:new Map,userProfile:null,profiles:new Map,hasProfile:null,following:new Set,followers:new Set,followCounts:new Map,pendingImage:null,pendingImagePreview:null,isUploadingImage:!1,selectedPost:null,selectedProfile:null,wizStep:1,wizUsername:"",wizDisplayName:"",wizBio:"",wizUsernameOk:null,wizFee:null,wizChecking:!1,fees:{post:0n,reply:0n,like:0n,follow:0n,repost:0n,superLikeMin:0n,downvoteMin:0n,boostMin:0n,badge:0n},hasBadge:!1,badgeTier:0,isBoosted:!1,boostExpiry:0,badgeExpiry:0,blockedAuthors:new Set,selectedTag:-1,composeTag:0,globalStats:null,isLoading:!1,isPosting:!1,contractAvailable:!0,error:null,liveStream:null,isLive:!1,liveViewerCount:0,activeRooms:new Map,watchingStreamId:null};function nx(){if(document.getElementById("agora-styles-v11"))return;const e=document.getElementById("backchat-styles-v70");e&&e.remove();const t=document.createElement("style");t.id="agora-styles-v11",t.textContent=`
        :root {
            --bc-bg: #0a0a0c; --bc-bg2: #111115; --bc-bg3: #1a1a20;
            --bc-surface: #212128; --bc-border: rgba(255,255,255,0.06);
            --bc-border-h: rgba(255,255,255,0.1); --bc-text: #ededf0;
            --bc-text-2: #9898a8; --bc-text-3: #58586a;
            --bc-accent: #f59e0b; --bc-accent-2: #d97706;
            --bc-accent-glow: rgba(245,158,11,0.12);
            --bc-red: #ef4444; --bc-green: #22c55e; --bc-blue: #3b82f6;
            --bc-purple: #8b5cf6; --bc-cyan: #06b6d4;
            --bc-radius: 14px; --bc-radius-sm: 10px; --bc-radius-lg: 20px;
            --bc-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes bc-fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        @keyframes bc-scaleIn { from { opacity:0; transform:scale(0.95); } to { opacity:1; transform:scale(1); } }
        @keyframes bc-spin { to { transform:rotate(360deg); } }
        @keyframes bc-like-pop { 0% { transform:scale(1); } 40% { transform:scale(1.35); } 100% { transform:scale(1); } }
        @keyframes bc-pulse-ring { 0% { box-shadow:0 0 0 0 rgba(245,158,11,0.4); } 70% { box-shadow:0 0 0 8px rgba(245,158,11,0); } 100% { box-shadow:0 0 0 0 rgba(245,158,11,0); } }

        .bc-shell { max-width:640px; margin:0 auto; min-height:100vh; background:var(--bc-bg); position:relative; }

        /* Header */
        .bc-header { position:sticky; top:0; z-index:200; background:rgba(10,10,12,0.85); backdrop-filter:blur(20px) saturate(1.4); -webkit-backdrop-filter:blur(20px) saturate(1.4); border-bottom:1px solid var(--bc-border); }
        .bc-header-bar { display:flex; align-items:center; justify-content:space-between; padding:14px 20px; }
        .bc-brand { display:flex; align-items:center; gap:10px; }
        .bc-brand-icon { width:34px; height:34px; border-radius:10px; object-fit:contain; }
        .bc-brand-name { font-size:20px; font-weight:800; letter-spacing:-0.3px; background:linear-gradient(135deg,#fbbf24,#f59e0b,#d97706); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .bc-header-right { display:flex; align-items:center; gap:6px; }
        .bc-icon-btn { width:36px; height:36px; border-radius:50%; background:transparent; border:1px solid var(--bc-border); color:var(--bc-text-2); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-icon-btn:hover { background:var(--bc-bg3); border-color:var(--bc-border-h); color:var(--bc-text); }

        /* Tabs */
        .bc-nav { display:flex; padding:0 20px; }
        .bc-nav-item { flex:1; padding:12px 0; background:none; border:none; border-bottom:2px solid transparent; color:var(--bc-text-3); font-size:13px; font-weight:600; letter-spacing:0.02em; cursor:pointer; transition:all var(--bc-transition); display:flex; align-items:center; justify-content:center; gap:7px; }
        .bc-nav-item:hover { color:var(--bc-text-2); }
        .bc-nav-item.active { color:var(--bc-accent); border-bottom-color:var(--bc-accent); }
        .bc-nav-item i { font-size:14px; }

        /* Tag Bar */
        .bc-tag-bar { display:flex; gap:6px; padding:10px 20px; overflow-x:auto; scrollbar-width:none; border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-tag-bar::-webkit-scrollbar { display:none; }
        .bc-tag-pill { flex-shrink:0; padding:5px 12px; border-radius:20px; border:1px solid var(--bc-border); background:transparent; color:var(--bc-text-3); font-size:12px; font-weight:600; cursor:pointer; transition:all var(--bc-transition); display:flex; align-items:center; gap:5px; white-space:nowrap; }
        .bc-tag-pill:hover { border-color:var(--bc-border-h); color:var(--bc-text-2); }
        .bc-tag-pill.active { background:var(--bc-accent); border-color:var(--bc-accent); color:#000; }
        .bc-tag-pill i { font-size:11px; }

        /* Compose */
        .bc-compose { padding:20px; border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-compose-row { display:flex; gap:14px; }
        .bc-compose-avatar { width:42px; height:42px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-weight:700; color:#000; font-size:15px; flex-shrink:0; }
        .bc-compose-body { flex:1; min-width:0; }
        .bc-compose-textarea { width:100%; min-height:72px; max-height:240px; background:transparent; border:none; color:var(--bc-text); font-size:16px; line-height:1.5; resize:none; outline:none; font-family:inherit; }
        .bc-compose-textarea::placeholder { color:var(--bc-text-3); }
        .bc-compose-divider { height:1px; background:var(--bc-border); margin:12px 0; }
        .bc-compose-tags { display:flex; gap:4px; flex-wrap:wrap; margin-bottom:10px; }
        .bc-compose-tag { padding:3px 10px; border-radius:16px; border:1px solid var(--bc-border); background:transparent; color:var(--bc-text-3); font-size:11px; font-weight:600; cursor:pointer; transition:all var(--bc-transition); }
        .bc-compose-tag:hover { border-color:var(--bc-border-h); }
        .bc-compose-tag.active { border-color:var(--bc-accent); color:var(--bc-accent); background:var(--bc-accent-glow); }
        .bc-compose-bottom { display:flex; align-items:center; justify-content:space-between; }
        .bc-compose-tools { display:flex; gap:4px; }
        .bc-compose-tool { width:34px; height:34px; border-radius:50%; background:none; border:none; color:var(--bc-accent); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:15px; transition:background var(--bc-transition); }
        .bc-compose-tool:hover:not(:disabled) { background:var(--bc-accent-glow); }
        .bc-compose-tool:disabled { color:var(--bc-text-3); cursor:not-allowed; }
        .bc-compose-right { display:flex; align-items:center; gap:14px; }
        .bc-char-count { font-size:12px; color:var(--bc-text-3); font-variant-numeric:tabular-nums; }
        .bc-char-count.warn { color:var(--bc-accent); }
        .bc-char-count.danger { color:var(--bc-red); }
        .bc-compose-fee { font-size:11px; color:var(--bc-text-3); background:var(--bc-bg3); padding:4px 10px; border-radius:20px; }
        .bc-post-btn { padding:9px 22px; background:linear-gradient(135deg,#f59e0b,#d97706); border:none; border-radius:24px; color:#000; font-weight:700; font-size:14px; cursor:pointer; transition:all var(--bc-transition); }
        .bc-post-btn:hover:not(:disabled) { box-shadow:0 4px 20px rgba(245,158,11,0.35); transform:translateY(-1px); }
        .bc-post-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }

        /* Post Card */
        .bc-post { padding:18px 20px; border-bottom:1px solid var(--bc-border); transition:background var(--bc-transition); animation:bc-fadeIn 0.35s ease-out both; cursor:pointer; }
        .bc-post:hover { background:rgba(255,255,255,0.015); }
        .bc-post-top { display:flex; gap:12px; }
        .bc-avatar { width:44px; height:44px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-weight:700; color:#000; font-size:15px; flex-shrink:0; cursor:pointer; transition:transform var(--bc-transition); }
        .bc-avatar:hover { transform:scale(1.06); }
        .bc-avatar.boosted { box-shadow:0 0 0 2.5px var(--bc-bg), 0 0 0 4.5px var(--bc-accent); animation:bc-pulse-ring 2s infinite; }
        .bc-post-head { flex:1; min-width:0; }
        .bc-post-author-row { display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
        .bc-author-name { font-weight:700; color:var(--bc-text); font-size:15px; cursor:pointer; transition:color var(--bc-transition); }
        .bc-author-name:hover { color:var(--bc-accent); }
        .bc-verified-icon { color:var(--bc-accent); font-size:13px; }
        .bc-post-time { color:var(--bc-text-3); font-size:13px; }
        .bc-post-context { color:var(--bc-text-3); font-size:13px; margin-top:1px; }
        .bc-tag-badge { display:inline-flex; align-items:center; gap:3px; padding:1px 7px; border-radius:12px; font-size:10px; font-weight:700; letter-spacing:0.02em; border:1px solid; opacity:0.8; }
        .bc-trending-tag { display:inline-flex; align-items:center; gap:4px; padding:2px 9px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:11px; font-weight:700; }
        .bc-trending-tag i { font-size:9px; }
        .bc-post-body { margin-top:10px; margin-left:56px; color:var(--bc-text); font-size:15px; line-height:1.6; white-space:pre-wrap; word-break:break-word; }
        .bc-post-media { margin-top:14px; margin-left:56px; border-radius:var(--bc-radius); overflow:hidden; border:1px solid var(--bc-border); }
        .bc-post-media img { width:100%; max-height:420px; object-fit:cover; display:block; }
        .bc-post-deleted { margin-top:10px; margin-left:56px; color:var(--bc-text-3); font-size:14px; font-style:italic; }
        .bc-pinned-banner { display:flex; align-items:center; gap:6px; padding:8px 20px 0 68px; font-size:12px; color:var(--bc-accent); font-weight:600; }
        .bc-pinned-banner i { font-size:11px; }
        .bc-repost-banner { display:flex; align-items:center; gap:6px; padding:8px 20px 0 68px; font-size:13px; color:var(--bc-green); font-weight:600; }
        .bc-repost-banner i { font-size:12px; }

        /* Post Menu */
        .bc-post-menu-wrap { position:relative; margin-left:auto; }
        .bc-post-menu-btn { width:30px; height:30px; border-radius:50%; background:transparent; border:none; color:var(--bc-text-3); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-post-menu-btn:hover { background:var(--bc-bg3); color:var(--bc-text-2); }
        .bc-post-dropdown { position:absolute; top:100%; right:0; z-index:100; min-width:160px; background:var(--bc-bg2); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); padding:6px 0; box-shadow:0 8px 30px rgba(0,0,0,0.5); animation:bc-scaleIn 0.15s ease-out; }
        .bc-post-dropdown-item { display:flex; align-items:center; gap:8px; width:100%; padding:10px 16px; background:none; border:none; color:var(--bc-text-2); font-size:13px; cursor:pointer; transition:all var(--bc-transition); text-align:left; }
        .bc-post-dropdown-item:hover { background:var(--bc-bg3); color:var(--bc-text); }
        .bc-post-dropdown-item.danger { color:var(--bc-red); }
        .bc-post-dropdown-item.danger:hover { background:rgba(239,68,68,0.08); }
        .bc-post-dropdown-item i { width:16px; text-align:center; font-size:13px; }

        /* Engagement Bar */
        .bc-actions { display:flex; gap:2px; margin-top:12px; margin-left:56px; max-width:480px; justify-content:space-between; }
        .bc-action { display:flex; align-items:center; gap:5px; padding:6px 10px; background:none; border:none; border-radius:20px; color:var(--bc-text-3); font-size:13px; cursor:pointer; transition:all var(--bc-transition); }
        .bc-action i { font-size:15px; transition:transform 0.2s; }
        .bc-action .count { font-variant-numeric:tabular-nums; }
        .bc-action.act-reply:hover { color:var(--bc-blue); background:rgba(59,130,246,0.08); }
        .bc-action.act-repost:hover { color:var(--bc-green); background:rgba(34,197,94,0.08); }
        .bc-action.act-like:hover { color:var(--bc-red); background:rgba(239,68,68,0.08); }
        .bc-action.act-like:hover i { transform:scale(1.2); }
        .bc-action.act-like.liked { color:var(--bc-red); }
        .bc-action.act-like.liked i { animation:bc-like-pop 0.3s ease-out; }
        .bc-action.act-down:hover { color:var(--bc-purple); background:rgba(139,92,246,0.08); }
        .bc-action.act-super:hover { color:var(--bc-accent); background:var(--bc-accent-glow); }
        .bc-action.act-super:hover i { transform:scale(1.2) rotate(15deg); }

        /* Profile */
        .bc-profile-section { animation:bc-fadeIn 0.4s ease-out; }
        .bc-profile-banner { height:120px; background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(217,119,6,0.08),rgba(10,10,12,0)); position:relative; }
        .bc-profile-main { padding:0 20px 20px; margin-top:-40px; position:relative; }
        .bc-profile-top-row { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:16px; }
        .bc-profile-pic { width:80px; height:80px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:800; color:#000; border:4px solid var(--bc-bg); }
        .bc-profile-pic.boosted { box-shadow:0 0 0 3px var(--bc-bg), 0 0 0 5px var(--bc-accent); }
        .bc-profile-actions { display:flex; gap:8px; padding-bottom:6px; }
        .bc-profile-name-row { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
        .bc-profile-name { font-size:22px; font-weight:800; color:var(--bc-text); letter-spacing:-0.3px; }
        .bc-profile-badge { color:var(--bc-accent); font-size:16px; }
        .bc-boosted-tag { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:11px; font-weight:700; }
        .bc-profile-handle { margin-top:4px; }
        .bc-profile-handle a { color:var(--bc-text-3); text-decoration:none; font-size:13px; transition:color var(--bc-transition); }
        .bc-profile-handle a:hover { color:var(--bc-accent); }
        .bc-profile-handle a i { font-size:10px; margin-left:4px; }
        .bc-profile-bio { margin-top:8px; font-size:14px; color:var(--bc-text-2); line-height:1.5; }
        .bc-profile-username { color:var(--bc-text-3); font-size:14px; margin-top:2px; }
        .bc-profile-stats { display:grid; grid-template-columns:repeat(3, 1fr); gap:1px; margin-top:20px; background:var(--bc-border); border-radius:var(--bc-radius); overflow:hidden; }
        .bc-stat-cell { background:var(--bc-bg2); padding:16px 12px; text-align:center; }
        .bc-stat-cell:first-child { border-radius:var(--bc-radius) 0 0 var(--bc-radius); }
        .bc-stat-cell:last-child { border-radius:0 var(--bc-radius) var(--bc-radius) 0; }
        .bc-stat-value { font-size:20px; font-weight:800; color:var(--bc-text); }
        .bc-stat-label { font-size:12px; color:var(--bc-text-3); margin-top:2px; font-weight:500; }

        /* Section Header */
        .bc-section-head { padding:16px 20px; border-bottom:1px solid var(--bc-border); display:flex; align-items:center; justify-content:space-between; }
        .bc-section-title { font-size:15px; font-weight:700; color:var(--bc-text); display:flex; align-items:center; gap:8px; }
        .bc-section-title i { color:var(--bc-accent); font-size:14px; }
        .bc-section-subtitle { font-size:13px; color:var(--bc-text-3); }

        /* Trending/Discover Header */
        .bc-discover-header { padding:24px 20px; border-bottom:1px solid var(--bc-border); background:linear-gradient(180deg,rgba(245,158,11,0.06),transparent); }
        .bc-discover-header h2 { font-size:18px; font-weight:800; color:var(--bc-text); display:flex; align-items:center; gap:8px; margin:0; }
        .bc-discover-header h2 i { color:var(--bc-accent); }
        .bc-discover-header p { margin:4px 0 0; font-size:13px; color:var(--bc-text-3); }
        .bc-stats-row { display:flex; gap:16px; margin-top:16px; }
        .bc-mini-stat { display:flex; align-items:center; gap:6px; font-size:13px; color:var(--bc-text-2); }
        .bc-mini-stat strong { color:var(--bc-text); font-weight:700; }

        /* Buttons */
        .bc-btn { padding:9px 18px; border-radius:24px; font-weight:700; font-size:13px; cursor:pointer; transition:all var(--bc-transition); border:none; display:inline-flex; align-items:center; gap:6px; letter-spacing:0.01em; }
        .bc-btn-primary { background:linear-gradient(135deg,#f59e0b,#d97706); color:#000; }
        .bc-btn-primary:hover { box-shadow:0 4px 16px rgba(245,158,11,0.3); transform:translateY(-1px); }
        .bc-btn-primary:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }
        .bc-btn-outline { background:transparent; border:1px solid var(--bc-border-h); color:var(--bc-text); }
        .bc-btn-outline:hover { background:var(--bc-bg3); border-color:rgba(255,255,255,0.15); }
        .bc-btn-follow { background:var(--bc-text); color:var(--bc-bg); }
        .bc-btn-follow:hover { opacity:0.9; }
        .bc-follow-toggle { padding:8px 20px; border-radius:24px; font-weight:700; font-size:13px; cursor:pointer; transition:all var(--bc-transition); border:none; }
        .bc-follow-toggle.do-follow { background:var(--bc-text); color:var(--bc-bg); }
        .bc-follow-toggle.do-follow:hover { opacity:0.9; }
        .bc-follow-toggle.do-unfollow { background:transparent; border:1px solid var(--bc-border-h); color:var(--bc-text); }
        .bc-follow-toggle.do-unfollow:hover { border-color:var(--bc-red); color:var(--bc-red); background:rgba(239,68,68,0.08); }

        /* Empty State */
        .bc-empty { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:72px 24px; text-align:center; animation:bc-fadeIn 0.5s ease-out; }
        .bc-empty-glyph { width:72px; height:72px; border-radius:50%; background:var(--bc-bg3); display:flex; align-items:center; justify-content:center; margin-bottom:20px; }
        .bc-empty-glyph i { font-size:28px; color:var(--bc-text-3); }
        .bc-empty-glyph.accent { background:var(--bc-accent-glow); }
        .bc-empty-glyph.accent i { color:var(--bc-accent); }
        .bc-empty-title { font-size:18px; font-weight:700; color:var(--bc-text); margin-bottom:8px; }
        .bc-empty-text { color:var(--bc-text-3); font-size:14px; max-width:280px; line-height:1.5; }

        /* Loading */
        .bc-loading { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:56px; gap:16px; }
        .bc-spinner { width:36px; height:36px; border:3px solid var(--bc-bg3); border-top-color:var(--bc-accent); border-radius:50%; animation:bc-spin 0.8s linear infinite; }
        .bc-loading-text { font-size:13px; color:var(--bc-text-3); }

        /* Modal */
        .bc-modal-overlay { display:none; position:fixed; inset:0; z-index:9999; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px); align-items:center; justify-content:center; padding:20px; }
        .bc-modal-overlay.active { display:flex; }
        .bc-modal-box { background:var(--bc-bg2); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-lg); width:100%; max-width:440px; max-height:90vh; overflow-y:auto; animation:bc-scaleIn 0.25s ease-out; }
        .bc-modal-top { display:flex; align-items:center; justify-content:space-between; padding:18px 20px; border-bottom:1px solid var(--bc-border); }
        .bc-modal-title { font-size:17px; font-weight:700; color:var(--bc-text); display:flex; align-items:center; gap:8px; }
        .bc-modal-x { width:32px; height:32px; border-radius:50%; background:var(--bc-bg3); border:none; color:var(--bc-text-2); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-modal-x:hover { background:var(--bc-surface); color:var(--bc-text); }
        .bc-modal-inner { padding:20px; }
        .bc-modal-desc { color:var(--bc-text-2); font-size:14px; line-height:1.5; margin-bottom:20px; }

        /* Form */
        .bc-field { margin-bottom:18px; }
        .bc-label { display:block; margin-bottom:8px; color:var(--bc-text-2); font-size:13px; font-weight:600; }
        .bc-input { width:100%; padding:12px 16px; background:var(--bc-bg3); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); color:var(--bc-text); font-size:15px; outline:none; transition:border-color var(--bc-transition); font-family:inherit; box-sizing:border-box; }
        .bc-input:focus { border-color:rgba(245,158,11,0.5); }
        .bc-fee-row { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.15); border-radius:var(--bc-radius-sm); }
        .bc-fee-label { font-size:13px; color:var(--bc-accent); font-weight:500; }
        .bc-fee-val { font-size:14px; font-weight:700; color:var(--bc-text); }

        /* Back Header */
        .bc-back-header { display:flex; align-items:center; gap:12px; padding:14px 20px; }
        .bc-back-btn { width:34px; height:34px; border-radius:50%; background:transparent; border:1px solid var(--bc-border); color:var(--bc-text); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-back-btn:hover { background:var(--bc-bg3); border-color:var(--bc-border-h); }
        .bc-back-title { font-size:17px; font-weight:700; color:var(--bc-text); }

        /* Wizard */
        .bc-wizard { padding:24px 20px; animation:bc-fadeIn 0.4s ease-out; }
        .bc-wizard-title { font-size:22px; font-weight:800; color:var(--bc-text); margin-bottom:6px; }
        .bc-wizard-desc { font-size:14px; color:var(--bc-text-3); margin-bottom:24px; line-height:1.5; }
        .bc-wizard-dots { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:28px; }
        .bc-wizard-dot { width:10px; height:10px; border-radius:50%; background:var(--bc-bg3); transition:all var(--bc-transition); }
        .bc-wizard-dot.active { background:var(--bc-accent); width:28px; border-radius:10px; }
        .bc-wizard-dot.done { background:var(--bc-green); }
        .bc-wizard-card { background:var(--bc-bg2); border:1px solid var(--bc-border); border-radius:var(--bc-radius-lg); padding:24px; margin-bottom:20px; }
        .bc-username-row { display:flex; align-items:center; gap:8px; margin-top:8px; min-height:24px; }
        .bc-username-ok { color:var(--bc-green); font-size:13px; display:flex; align-items:center; gap:4px; }
        .bc-username-taken { color:var(--bc-red); font-size:13px; display:flex; align-items:center; gap:4px; }
        .bc-username-checking { color:var(--bc-text-3); font-size:13px; }
        .bc-username-fee { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.15); border-radius:20px; color:var(--bc-accent); font-size:12px; font-weight:600; margin-left:8px; }
        .bc-wizard-nav { display:flex; gap:12px; margin-top:20px; }
        .bc-wizard-nav .bc-btn { flex:1; justify-content:center; }

        /* Thread */
        .bc-thread-parent { border-bottom:1px solid var(--bc-border); }
        .bc-thread-divider { padding:12px 20px; font-size:13px; font-weight:700; color:var(--bc-text-2); border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-thread-reply { position:relative; padding-left:36px; }
        .bc-thread-reply::before { content:''; position:absolute; left:40px; top:0; bottom:0; width:2px; background:var(--bc-border); }
        .bc-thread-reply:last-child::before { bottom:50%; }
        .bc-reply-compose { padding:16px 20px; border-top:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-reply-label { font-size:13px; color:var(--bc-text-3); margin-bottom:8px; }
        .bc-reply-row { display:flex; gap:12px; align-items:flex-start; }
        .bc-reply-input { flex:1; min-height:48px; max-height:160px; background:var(--bc-bg3); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); color:var(--bc-text); font-size:14px; padding:10px 14px; resize:none; outline:none; font-family:inherit; }
        .bc-reply-input:focus { border-color:rgba(245,158,11,0.5); }
        .bc-reply-send { padding:10px 18px; }

        /* Image Upload */
        .bc-image-preview { position:relative; margin-top:12px; border-radius:var(--bc-radius); overflow:hidden; border:1px solid var(--bc-border); max-height:200px; }
        .bc-image-preview img { width:100%; max-height:200px; object-fit:cover; display:block; }
        .bc-image-remove { position:absolute; top:8px; right:8px; width:28px; height:28px; border-radius:50%; background:rgba(0,0,0,0.7); border:none; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; }
        .bc-image-remove:hover { background:var(--bc-red); }
        .bc-uploading-badge { display:inline-flex; align-items:center; gap:6px; padding:4px 12px; background:rgba(245,158,11,0.1); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:12px; margin-top:8px; }

        /* Profile Create Banner */
        .bc-profile-create-banner { margin:16px 20px; padding:16px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:var(--bc-radius); text-align:center; animation:bc-fadeIn 0.4s ease-out; }
        .bc-profile-create-banner p { font-size:13px; color:var(--bc-text-2); margin-bottom:12px; }

        /* Live Streaming */
        .bc-live-bar { padding:16px 20px; background:linear-gradient(135deg, rgba(239,68,68,0.08), rgba(0,0,0,0.4)); border-bottom:1px solid rgba(239,68,68,0.2); }
        .bc-live-bar-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
        .bc-live-indicator { display:flex; align-items:center; gap:8px; }
        .bc-live-dot { width:10px; height:10px; border-radius:50%; background:#ef4444; animation:bc-pulse-ring 1.5s infinite; }
        .bc-live-label { font-weight:700; color:#ef4444; font-size:14px; }
        .bc-live-viewers { font-size:12px; color:var(--bc-text-3); }
        .bc-live-video { width:100%; border-radius:var(--bc-radius); background:#000; max-height:400px; object-fit:cover; }
        .bc-live-badge { display:inline-flex; align-items:center; gap:3px; padding:2px 8px; background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.3); border-radius:12px; color:#ef4444; font-size:10px; font-weight:700; margin-left:6px; }
        .bc-live-badge-dot { width:6px; height:6px; border-radius:50%; background:#ef4444; animation:bc-pulse-ring 1.5s infinite; }
        .bc-live-join { padding:16px 20px; background:rgba(239,68,68,0.05); border-bottom:1px solid rgba(239,68,68,0.2); text-align:center; }
        .bc-go-live-btn { background:linear-gradient(135deg, #ef4444, #dc2626); color:#fff; border:none; padding:8px 16px; border-radius:var(--bc-radius-sm); cursor:pointer; font-size:13px; font-weight:600; display:inline-flex; align-items:center; gap:6px; transition:all 0.15s; }
        .bc-go-live-btn:hover { filter:brightness(1.1); transform:scale(1.02); }
        .bc-go-live-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

        /* Responsive */
        @media (max-width: 640px) {
            .bc-shell { max-width:100%; }
            .bc-actions { margin-left:0; margin-top:14px; }
            .bc-post-body { margin-left:0; margin-top:12px; }
            .bc-post-media { margin-left:0; }
            .bc-compose-avatar { display:none; }
        }
    `,document.head.appendChild(t)}function Dn(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function sx(e){const a=Date.now()/1e3-e;return a<60?"now":a<3600?`${Math.floor(a/60)}m`:a<86400?`${Math.floor(a/3600)}h`:a<604800?`${Math.floor(a/86400)}d`:new Date(e*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function xs(e){if(!e||e===0n)return"0";const t=parseFloat(Ce.formatEther(e));return t<1e-4?"<0.0001":t<.01?t.toFixed(4):t<1?t.toFixed(3):t.toFixed(2)}function li(e){return e?e.startsWith("ipfs://")?`https://gateway.lighthouse.storage/ipfs/${e.slice(7)}`:e.startsWith("Qm")||e.startsWith("bafy")?`https://gateway.lighthouse.storage/ipfs/${e}`:e:""}function Ga(e){return e?e.slice(2,4).toUpperCase():"?"}function qe(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function uo(e){if(!e)return{displayName:"",bio:"",avatar:""};try{const t=JSON.parse(e);return{displayName:t.displayName||"",bio:t.bio||"",avatar:t.avatar||""}}catch{return{displayName:"",bio:"",avatar:""}}}function ku(e){if(!e)return"";const t=f.profiles.get(e.toLowerCase());return t!=null&&t.avatar?li(t.avatar):""}function rx(e,t=""){const a=ku(e),n=Eu(e),s=n?n.charAt(0).toUpperCase():Ga(e);return a?`<img src="${a}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" onerror="this.outerHTML='${s}'">`:s}function Ma(e){if(!e)return"?";const t=f.profiles.get(e.toLowerCase());return t!=null&&t.displayName?t.displayName:t!=null&&t.username?`@${t.username}`:Dn(e)}function Eu(e){var t;return e&&((t=f.profiles.get(e.toLowerCase()))==null?void 0:t.username)||null}function ix(e){var t;return(e==null?void 0:e.toLowerCase())===((t=c.userAddress)==null?void 0:t.toLowerCase())?f.isBoosted:!1}function ox(e){var t;return(e==null?void 0:e.toLowerCase())===((t=c.userAddress)==null?void 0:t.toLowerCase())?f.hasBadge:!1}function po(e){if(!e)return{text:"",mediaCID:""};const t=e.indexOf(`
[img]`);return t!==-1?{text:e.slice(0,t),mediaCID:e.slice(t+6).trim()}:{text:e,mediaCID:""}}function lx(e){return ya[e]||ya[0]}function bn(e,t){f.viewHistory.push({view:f.view,activeTab:f.activeTab,selectedPost:f.selectedPost,selectedProfile:f.selectedProfile}),f.view=e,t!=null&&t.post&&(f.selectedPost=t.post),t!=null&&t.profile&&(f.selectedProfile=t.profile),Vt()}function cx(){if(f.viewHistory.length>0){const e=f.viewHistory.pop();f.view=e.view,f.activeTab=e.activeTab||f.view,f.selectedPost=e.selectedPost,f.selectedProfile=e.selectedProfile}else f.view="feed",f.activeTab="feed";Vt()}function an(){if(c.agoraContract)return c.agoraContract;if(c.agoraContractPublic)return c.agoraContractPublic;const e=yu();return e&&c.publicProvider?new Ce.Contract(e,ea,c.publicProvider):null}async function fo(){try{const e=an();if(!e)return;let t=100000000n;try{t=await e.VOTE_PRICE()}catch{}const a=Ce.parseEther("0.0001");let n=a,s=a,r=a,i=a,o=a;try{[n,s,o,r,i]=await Promise.all([te(Ce.id("AGORA_POST"),0n),te(Ce.id("AGORA_REPLY"),0n),te(Ce.id("AGORA_REPOST"),0n),te(Ce.id("AGORA_LIKE"),0n),te(Ce.id("AGORA_FOLLOW"),0n)])}catch(l){console.warn("[Agora] Fee calc fallback to default:",l.message)}f.fees={post:n,reply:s,like:r,follow:i,repost:o,superLikeMin:t,downvoteMin:t,boostMin:Ce.parseEther("0.0005"),badge:Ce.parseEther("0.001")}}catch(e){console.warn("[Agora] Failed to load fees:",e.message)}}async function mo(){if(!(!c.isConnected||!c.userAddress))try{const e=an();if(!e)return;const[t,a,n]=await Promise.all([e.getUserProfile(c.userAddress).catch(()=>null),e.hasTrustBadge(c.userAddress).catch(()=>!1),e.isProfileBoosted(c.userAddress).catch(()=>!1)]);f.hasBadge=a,f.isBoosted=n,f.boostExpiry=t?Number(t.boostExp||t[5]||0):0,f.badgeExpiry=t?Number(t.badgeExp||t[6]||0):0,f.badgeTier=t?Number(t.badgeTier||t[7]||0):0}catch(e){console.warn("[Agora] Failed to load user status:",e.message)}}async function go(){try{const e=await le.getGlobalStats();f.globalStats=e}catch(e){console.warn("[Agora] Failed to load global stats:",e.message)}}async function bo(){try{const e=an();if(!e){f.hasProfile=!1;return}const t=await e.queryFilter(e.filters.ProfileCreated(),-5e4).catch(()=>[]);for(const a of t){const n=a.args.user.toLowerCase(),s=uo(a.args.metadataURI);f.profiles.set(n,{username:a.args.username,metadataURI:a.args.metadataURI||"",displayName:s.displayName,bio:s.bio,avatar:s.avatar})}if(c.isConnected&&c.userAddress){const a=c.userAddress.toLowerCase();let n=f.profiles.get(a);if(!n)try{const s=await e.getUserProfile(c.userAddress);if(s&&s.usernameHash&&s.usernameHash!==Ce.ZeroHash){const r=uo(s.metadataURI||s[1]||"");n={username:null,metadataURI:s.metadataURI||s[1]||"",displayName:r.displayName,bio:r.bio,avatar:r.avatar},f.profiles.set(a,n)}}catch{}n?(f.userProfile={...n,address:c.userAddress},f.hasProfile=!0):(f.hasProfile=!1,f.userProfile=null)}else f.hasProfile=!1;console.log("[Agora] Profiles loaded:",f.profiles.size,"| hasProfile:",f.hasProfile)}catch(e){console.warn("[Agora] Failed to load profiles:",e.message),f.hasProfile=!1}V()}async function xo(){f.following=new Set,f.followers=new Set,f.followCounts=new Map}async function ho(){var e;if(!(!c.isConnected||!c.userAddress))try{const t=an();if(!t)return;const a=await t.queryFilter(t.filters.PostReported(),-5e4).catch(()=>[]),n=c.userAddress.toLowerCase();for(const s of a)if(((e=s.args.reporter)==null?void 0:e.toLowerCase())===n){const r=s.args.postId.toString(),i=f.postsById.get(r);i!=null&&i.author&&f.blockedAuthors.add(i.author.toLowerCase())}console.log(`[Agora] Blocked authors: ${f.blockedAuthors.size}`)}catch(t){console.warn("[Agora] Failed to load blocked authors:",t.message)}}async function Je(){var e,t;f.isLoading=!0,V();try{if(!yu()){f.contractAvailable=!1,f.error="Agora contract not deployed yet.";return}const n=an();if(!n){f.contractAvailable=!1,f.error="Could not connect to Agora contract";return}f.contractAvailable=!0;const[s,r,i]=await Promise.all([n.queryFilter(n.filters.PostCreated(),-5e4).catch(p=>(console.warn("[Agora] PostCreated query failed:",p.message),[])),n.queryFilter(n.filters.ReplyCreated(),-5e4).catch(p=>(console.warn("[Agora] ReplyCreated query failed:",p.message),[])),n.queryFilter(n.filters.RepostCreated(),-5e4).catch(p=>(console.warn("[Agora] RepostCreated query failed:",p.message),[]))]);console.log(`[Agora] Events found: ${s.length} posts, ${r.length} replies, ${i.length} reposts`);const o=[];for(const p of s.slice(-80))o.push({ev:p,type:"post"});for(const p of r.slice(-60))o.push({ev:p,type:"reply"});for(const p of i.slice(-30))o.push({ev:p,type:"repost"});const l=[],d=[];f.postsById=new Map,f.replies=new Map,f.replyCountMap=new Map,f.repostCountMap=new Map,f.likesMap=new Map;for(let p=0;p<o.length;p+=10){const m=o.slice(p,p+10),g=await Promise.all(m.map(({ev:x})=>{const h=x.args.postId||x.args.newPostId;return n.getPost(h).catch(()=>null)}));for(let x=0;x<m.length;x++){const{ev:h,type:C}=m[x],T=g[x],A=(h.args.postId||h.args.newPostId).toString();if(T&&T.deleted)continue;const B=T?Number(T.createdAt||T[4]||0):0,z=T?Number(T.likes||T[7]||0):0,S=T?BigInt(T.superLikes||T[8]||0):0n,I=T?Number(T.downvotes||T[9]||0):0,R=T?Number(T.replies||T[10]||0):0,D=T?Number(T.reposts||T[11]||0):0,q=T?Number(T.tag||T[1]||0):0;if(C==="post"){const{text:H,mediaCID:re}=po(h.args.contentHash||h.args.content||""),X={id:A,type:"post",author:h.args.author,content:H,mediaCID:re,tag:h.args.tag!=null?Number(h.args.tag):q,timestamp:B,superLikes:S,likesCount:z,downvotesCount:I,repliesCount:R,repostsCount:D,txHash:h.transactionHash};l.push(X),d.push(X),f.postsById.set(A,X)}else if(C==="reply"){const H=h.args.parentId.toString(),{text:re,mediaCID:X}=po(h.args.contentHash||h.args.content||""),W={id:A,type:"reply",parentId:H,author:h.args.author,content:re,mediaCID:X,tag:h.args.tag!=null?Number(h.args.tag):q,timestamp:B,superLikes:S,likesCount:z,downvotesCount:I,txHash:h.transactionHash};l.push(W),f.postsById.set(A,W),f.replies.has(H)||f.replies.set(H,[]),f.replies.get(H).push(W),f.replyCountMap.set(H,(f.replyCountMap.get(H)||0)+1)}else if(C==="repost"){const H=((e=h.args.originalId)==null?void 0:e.toString())||((t=h.args.originalPostId)==null?void 0:t.toString())||"0",re={id:A,type:"repost",originalPostId:H,author:h.args.author||h.args.reposter,timestamp:B,superLikes:0n,txHash:h.transactionHash};l.push(re),d.push(re),f.postsById.set(A,re),f.repostCountMap.set(H,(f.repostCountMap.get(H)||0)+1)}}}if(c.isConnected&&c.userAddress){const p=l.filter(m=>m.type!=="repost").map(m=>m.id);for(let m=0;m<p.length;m+=10){const g=p.slice(m,m+10),x=await Promise.all(g.map(h=>n.hasLiked(h,c.userAddress).catch(()=>!1)));for(let h=0;h<g.length;h++)x[h]&&(f.likesMap.has(g[h])||f.likesMap.set(g[h],new Set),f.likesMap.get(g[h]).add(c.userAddress.toLowerCase()))}}d.sort((p,m)=>m.timestamp-p.timestamp);const u=p=>f.blockedAuthors.size===0?p:p.filter(m=>{var g;return!f.blockedAuthors.has((g=m.author)==null?void 0:g.toLowerCase())});f.posts=u(d),f.allItems=l,f.trendingPosts=u([...l].filter(p=>p.type!=="repost"&&p.superLikes>0n)).sort((p,m)=>{const g=BigInt(p.superLikes||0),x=BigInt(m.superLikes||0);return x>g?1:x<g?-1:0}),console.log(`[Agora] Loaded: ${f.posts.length} feed posts, ${f.allItems.length} total items, ${f.trendingPosts.length} trending`)}catch(a){console.error("[Agora] Failed to load posts:",a),f.error=a.message}finally{f.isLoading=!1,V()}}async function dx(){var r;const e=document.getElementById("bc-compose-input"),t=(r=e==null?void 0:e.value)==null?void 0:r.trim();if(!t){b("Please write something","error");return}if(t.length>It){b(`Post too long (max ${It} chars)`,"error");return}f.isPosting=!0,V();let a=t,n=0;if(f.pendingImage)try{f.isUploadingImage=!0,V();const o=(await Fx(f.pendingImage)).ipfsHash||"";o&&(a=t+`
[img]`+o,n=1)}catch(i){b("Image upload failed: "+i.message,"error"),f.isPosting=!1,f.isUploadingImage=!1,V();return}finally{f.isUploadingImage=!1}const s=document.getElementById("bc-post-btn");await le.createPost({content:a,tag:f.composeTag,contentType:n,operator:Fe(),button:s,onSuccess:async()=>{e&&(e.value=""),f.pendingImage=null,f.pendingImagePreview=null,f.composeTag=0,f.isPosting=!1,b("Post created!","success"),await Je()},onError:()=>{f.isPosting=!1,V()}}),f.isPosting=!1,V()}async function ux(e){var s;const t=document.getElementById("bc-reply-input"),a=(s=t==null?void 0:t.value)==null?void 0:s.trim();if(!a){b("Please write a reply","error");return}const n=document.getElementById("bc-reply-btn");await le.createReply({parentId:e,content:a,contentType:0,operator:Fe(),button:n,onSuccess:async()=>{t&&(t.value=""),b("Reply posted!","success"),await Je(),V()}})}async function px(e){const t=document.getElementById("bc-repost-confirm-btn");await le.createRepost({originalPostId:e,operator:Fe(),button:t,onSuccess:async()=>{Ue("repost"),b("Reposted!","success"),await Je()}})}async function fx(e){var a;const t=(a=c.userAddress)==null?void 0:a.toLowerCase();t&&(f.likesMap.has(e)||f.likesMap.set(e,new Set),f.likesMap.get(e).add(t),V()),await le.like({postId:e,operator:Fe(),onSuccess:()=>b("Liked!","success"),onError:n=>{var s;console.error("[Agora] Like failed:",n),b("Like failed â€” check console for details","error"),(s=f.likesMap.get(e))==null||s.delete(t),V()}})}async function mx(e,t){const a=Ce.parseEther(t);await le.superLike({postId:e,ethAmount:a,operator:Fe(),onSuccess:async()=>{b("Super Liked!","success"),await Je()}})}async function gx(e,t){const a=Ce.parseEther(t);await le.downvote({postId:e,ethAmount:a,operator:Fe(),onSuccess:async()=>{b("Downvoted","success"),await Je()}})}async function bx(e){await le.deletePost({postId:e,onSuccess:async()=>{b("Post deleted","success"),await Je()}})}async function xx(e){await le.pinPost({postId:e,onSuccess:async()=>{b("Post pinned!","success"),await Je()}})}let Zs=null,On=null;function hx(e){var a;Zs=e,On=null,document.querySelectorAll('[id^="change-tag-opt-"]').forEach(n=>n.classList.remove("active"));const t=document.getElementById("bc-change-tag-btn");t&&(t.disabled=!0),(a=document.getElementById("modal-change-tag"))==null||a.classList.add("active")}function vx(e){var a;On=e,document.querySelectorAll('[id^="change-tag-opt-"]').forEach(n=>n.classList.remove("active")),(a=document.getElementById(`change-tag-opt-${e}`))==null||a.classList.add("active");const t=document.getElementById("bc-change-tag-btn");t&&(t.disabled=!1)}async function wx(){On===null||!Zs||(Ue("change-tag"),await le.changeTag({postId:Zs,newTag:On,onSuccess:async()=>{b("Tag changed!","success"),await Je()}}))}async function yx(e){await le.follow({toFollow:e,operator:Fe(),onSuccess:()=>{f.following.add(e.toLowerCase()),b("Followed!","success"),V()}})}async function kx(e){await le.unfollow({toUnfollow:e,onSuccess:()=>{f.following.delete(e.toLowerCase()),b("Unfollowed","success"),V()}})}async function Ex(){const e=JSON.stringify({displayName:f.wizDisplayName,bio:f.wizBio}),t=document.getElementById("bc-wizard-confirm-btn");await le.createProfile({username:f.wizUsername,metadataURI:e,operator:Fe(),button:t,onSuccess:async()=>{b("Profile created!","success"),f.hasProfile=!0,f.userProfile={username:f.wizUsername,displayName:f.wizDisplayName,bio:f.wizBio,address:c.userAddress},f.profiles.set(c.userAddress.toLowerCase(),{username:f.wizUsername,displayName:f.wizDisplayName,bio:f.wizBio}),f.wizStep=1,f.wizUsername="",f.wizDisplayName="",f.wizBio="",f.view="profile",f.activeTab="profile",Vt()}})}async function Tx(){var i,o,l,d,u,p,m;const e=((o=(i=document.getElementById("edit-displayname"))==null?void 0:i.value)==null?void 0:o.trim())||"",t=((d=(l=document.getElementById("edit-bio"))==null?void 0:l.value)==null?void 0:d.trim())||"",a=document.getElementById("bc-edit-profile-btn");let n=((u=f.userProfile)==null?void 0:u.avatar)||"";const s=(m=(p=document.getElementById("edit-avatar-file"))==null?void 0:p.files)==null?void 0:m[0];if(s)try{a&&(a.disabled=!0),a&&(a.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Uploading avatar...');const g=new FormData;g.append("image",s);const h=await(await fetch("/api/upload-image",{method:"POST",body:g})).json();if(h.success&&h.ipfsHash)n=`ipfs://${h.ipfsHash}`;else{b("Avatar upload failed","error"),a&&(a.disabled=!1),a&&(a.innerHTML='<i class="fa-solid fa-check"></i> Save Changes');return}}catch(g){b("Avatar upload error: "+g.message,"error"),a&&(a.disabled=!1),a&&(a.innerHTML='<i class="fa-solid fa-check"></i> Save Changes');return}const r=JSON.stringify({displayName:e,bio:t,avatar:n});await le.updateProfile({metadataURI:r,button:a,onSuccess:()=>{f.userProfile.displayName=e,f.userProfile.bio=t,f.userProfile.avatar=n,f.profiles.set(c.userAddress.toLowerCase(),{...f.profiles.get(c.userAddress.toLowerCase()),displayName:e,bio:t,avatar:n}),Ue("edit-profile"),b("Profile updated!","success"),V()}})}async function Cx(e=0){await le.obtainBadge({tier:e,operator:Fe(),onSuccess:()=>{f.hasBadge=!0,f.badgeTier=Math.max(f.badgeTier,e),Ue("badge"),b(`${["Verified","Premium","Elite"][e]} badge obtained!`,"success"),V()}})}async function Ix(e,t=0){await le.reportPost({postId:e,category:t,onSuccess:()=>{const a=f.postsById.get(Number(e));a&&f.blockedAuthors.add(a.author.toLowerCase()),Ue("report"),b("Post reported. Author blocked from your feed.","success"),V()},onError:a=>{b((a==null?void 0:a.shortMessage)||(a==null?void 0:a.message)||"Report failed","error")}})}async function Ax(e,t=0){var s;const a=((s=document.getElementById("boost-post-amount"))==null?void 0:s.value)||"0.001",n=window.ethers;await le.boostPost({postId:e,tier:t,ethAmount:n.parseEther(a),operator:Fe(),onSuccess:()=>{Ue("boost-post"),b(`Post boosted (${["Standard","Featured"][t]})!`,"success"),V()},onError:r=>{b((r==null?void 0:r.shortMessage)||(r==null?void 0:r.message)||"Boost failed","error")}})}async function Px(e){var n;const t=((n=document.getElementById("tip-amount"))==null?void 0:n.value)||"0.001",a=window.ethers;await le.tipPost({postId:e,ethAmount:a.parseEther(t),operator:Fe(),onSuccess:()=>{Ue("tip"),b(`Tipped ${t} ETH!`,"success"),V()},onError:s=>{b((s==null?void 0:s.shortMessage)||(s==null?void 0:s.message)||"Tip failed","error")}})}async function Bx(e){const t=Ce.parseEther(e);await le.boostProfile({ethAmount:t,operator:Fe(),onSuccess:()=>{f.isBoosted=!0,Ue("boost"),b("Profile boosted!","success"),V()}})}async function Sx(){if(f.isLive){b("You are already live!","info");return}if(!c.isConnected){b("Connect your wallet to go live","error");return}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){b("Your browser does not support live streaming (HTTPS required)","error");return}try{b("Requesting camera access...","info"),(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach(a=>a.stop()),b("Creating live post on-chain...","info"),await le.createPost({content:"LIVE NOW",tag:f.composeTag,contentType:2,operator:Fe(),onSuccess:async a=>{var n;try{let s=null;if(a!=null&&a.logs)for(const l of a.logs)try{const u=new Ce.Interface(ea).parseLog({topics:l.topics,data:l.data});if((u==null?void 0:u.name)==="PostCreated"&&((n=u.args)==null?void 0:n.postId)!=null){s=String(u.args.postId);break}}catch{}if(!s)try{const l=await le.getPostCount();s=String(l)}catch{s=String(Date.now())}console.log("[Agora] Starting live stream for post:",s);const r=new Mn,{roomId:i,stream:o}=await r.startStream(s,c.userAddress);f.liveStream=r,f.isLive=!0,f.liveViewerCount=0,Lx(o),r.onViewerCountChange=l=>{f.liveViewerCount=l;const d=document.querySelector("[data-live-viewers]");d&&(d.textContent=`${l} viewer${l!==1?"s":""}`)},b("You are now LIVE!","success"),V(),setTimeout(()=>{const l=document.getElementById("bc-local-video");l&&(l.srcObject=o)},150)}catch(s){console.error("[Agora] LiveStream start error:",s),b("Failed to start stream: "+s.message,"error")}},onError:a=>{b("Failed to create live post: "+((a==null?void 0:a.message)||"Transaction rejected"),"error")}})}catch(e){console.error("[Agora] goLive error:",e),e.name==="NotAllowedError"||e.name==="PermissionDeniedError"?b("Camera/mic permission denied. Please allow access and try again.","error"):e.name==="NotFoundError"?b("No camera or microphone found on this device","error"):e.name==="NotReadableError"?b("Camera is in use by another application","error"):b("Failed to go live: "+e.message,"error")}}async function zx(){if(!f.liveStream)return;Rx(),await f.liveStream.endStream(),f.liveStream=null,f.isLive=!1,f.liveViewerCount=0,b("Stream ended. Saving recording...","success"),V();const e=await _x();e&&(console.log("[Agora] VOD saved with CID:",e),await Je())}async function Nx(e){if(!c.isConnected)return;const t=await Mn.getRoomByPostId(e);if(!t){b("Stream has ended","info");return}const a=new Mn;a.onRemoteStream=n=>{const s=document.getElementById("bc-remote-video");s&&(s.srcObject=n)},a.onStreamEnd=()=>{b("Stream ended","info"),f.liveStream=null,f.watchingStreamId=null,V()},a.onError=n=>{b("Stream error: "+n,"error")},await a.joinStream(t.id,c.userAddress),f.liveStream=a,f.watchingStreamId=String(e),V(),setTimeout(()=>{if(a.remoteStream){const n=document.getElementById("bc-remote-video");n&&(n.srcObject=a.remoteStream)}},200)}function $x(){f.liveStream&&!f.isLive&&f.liveStream.leaveStream(),f.liveStream=null,f.watchingStreamId=null,V()}let Tt=null,fa=[];function Lx(e){if(!(!MediaRecorder||!e)){fa=[];try{const t=MediaRecorder.isTypeSupported("video/webm;codecs=vp9,opus")?"video/webm;codecs=vp9,opus":MediaRecorder.isTypeSupported("video/webm;codecs=vp8,opus")?"video/webm;codecs=vp8,opus":"video/webm";Tt=new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:15e5}),Tt.ondataavailable=a=>{a.data&&a.data.size>0&&fa.push(a.data)},Tt.onstop=()=>{console.log(`[Agora] Recording stopped: ${fa.length} chunks`)},Tt.start(5e3),console.log("[Agora] Recording started:",t)}catch(t){console.warn("[Agora] MediaRecorder not available:",t.message)}}}function Rx(){Tt&&Tt.state!=="inactive"&&Tt.stop()}async function _x(){if(fa.length===0)return console.log("[Agora] No recorded data to upload"),null;const e=new Blob(fa,{type:"video/webm"}),t=(e.size/(1024*1024)).toFixed(1);if(console.log(`[Agora] VOD size: ${t} MB`),e.size>50*1024*1024)return b(`Recording too large (${t}MB). Max 50MB.`,"error"),null;b(`Saving recording (${t}MB)...`,"info");try{const a=new FormData;a.append("file",e,`agora-live-${Date.now()}.webm`);const n=await fetch("/api/upload-media",{method:"POST",body:a});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.error||`Upload failed (${n.status})`)}const s=await n.json();return b("Live recording saved!","success"),console.log("[Agora] VOD uploaded:",s.ipfsHash),s.ipfsHash}catch(a){return console.error("[Agora] VOD upload failed:",a),b("Failed to save recording: "+a.message,"error"),null}finally{fa=[],Tt=null}}async function vo(){try{const e=await Mn.getActiveRooms();f.activeRooms=new Map,e.forEach(t=>f.activeRooms.set(String(t.postId),t))}catch(e){console.warn("[Agora] Failed to load live rooms:",e)}}async function Fx(e){const t=new FormData;t.append("image",e);const a=new AbortController,n=setTimeout(()=>a.abort(),6e4);try{const s=await fetch("/api/upload-image",{method:"POST",body:t,signal:a.signal});if(clearTimeout(n),!s.ok){const r=await s.json().catch(()=>({}));throw new Error(r.error||`Upload failed (${s.status})`)}return await s.json()}catch(s){throw clearTimeout(n),s}}function Mx(e){var n,s;const t=(s=(n=e.target)==null?void 0:n.files)==null?void 0:s[0];if(!t)return;if(t.size>5*1024*1024){b("Image too large. Maximum 5MB.","error");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type)){b("Invalid image type.","error");return}f.pendingImage=t;const a=new FileReader;a.onload=r=>{f.pendingImagePreview=r.target.result,V()},a.readAsDataURL(t)}function Dx(){f.pendingImage=null,f.pendingImagePreview=null;const e=document.getElementById("bc-image-input");e&&(e.value=""),V()}let wo=null;function Ox(e){f.wizUsername=e.toLowerCase().replace(/[^a-z0-9_]/g,""),f.wizUsernameOk=null,f.wizFee=null,clearTimeout(wo);const t=document.getElementById("wiz-username-input");t&&(t.value=f.wizUsername),f.wizUsername.length>=1&&f.wizUsername.length<=15?(f.wizChecking=!0,$s(),wo=setTimeout(async()=>{try{const[a,n]=await Promise.all([le.isUsernameAvailable(f.wizUsername),le.getUsernamePrice(f.wizUsername.length)]);f.wizUsernameOk=a,f.wizFee=n.formatted}catch(a){console.warn("Username check failed:",a)}f.wizChecking=!1,$s()},600)):(f.wizChecking=!1,$s())}function $s(){const e=document.getElementById("wiz-username-status");e&&(f.wizChecking?e.innerHTML='<span class="bc-username-checking"><i class="fa-solid fa-spinner fa-spin"></i> Checking...</span>':f.wizUsernameOk===!0?e.innerHTML=`<span class="bc-username-ok"><i class="fa-solid fa-check"></i> Available</span>
                ${f.wizFee&&f.wizFee!=="0.0"?`<span class="bc-username-fee">${f.wizFee} ETH</span>`:'<span class="bc-username-fee">FREE</span>'}`:f.wizUsernameOk===!1?e.innerHTML='<span class="bc-username-taken"><i class="fa-solid fa-xmark"></i> Taken</span>':e.innerHTML="");const t=document.querySelector(".bc-wizard-nav .bc-btn-primary");t&&f.wizStep===1&&(t.disabled=!f.wizUsernameOk)}function Hx(){if(["post-detail","user-profile","profile-setup"].includes(f.view)){let t="Post";return f.view==="user-profile"&&(t=Ma(f.selectedProfile)),f.view==="profile-setup"&&(t="Create Profile"),`
            <div class="bc-header">
                <div class="bc-back-header">
                    <button class="bc-back-btn" onclick="BackchatPage.goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                    <span class="bc-back-title">${t}</span>
                </div>
            </div>`}return`
        <div class="bc-header">
            <div class="bc-header-bar">
                <div class="bc-brand">
                    <img src="assets/Agora.png" alt="Agora" class="bc-brand-icon" onerror="this.style.display='none'">
                    <span class="bc-brand-name">Agora</span>
                </div>
                <div class="bc-header-right">
                    <button class="bc-icon-btn" onclick="BackchatPage.refresh()" title="Refresh"><i class="fa-solid fa-arrows-rotate"></i></button>
                </div>
            </div>
            <div class="bc-nav">
                <button class="bc-nav-item ${f.activeTab==="feed"?"active":""}" onclick="BackchatPage.setTab('feed')">
                    <i class="fa-solid fa-house"></i> Feed
                </button>
                <button class="bc-nav-item ${f.activeTab==="discover"?"active":""}" onclick="BackchatPage.setTab('discover')">
                    <i class="fa-solid fa-fire"></i> Discover
                </button>
                <button class="bc-nav-item ${f.activeTab==="profile"?"active":""}" onclick="BackchatPage.setTab('profile')">
                    <i class="fa-solid fa-user"></i> Profile
                </button>
            </div>
        </div>`}function yo(){let t=`<div class="bc-tag-bar">
        <button class="bc-tag-pill ${f.selectedTag===-1?"active":""}" onclick="BackchatPage.filterTag(-1)"><i class="fa-solid fa-layer-group"></i> All</button>`;for(const a of ya){const n=f.selectedTag===a.id?"active":"";t+=`<button class="bc-tag-pill ${n}" onclick="BackchatPage.filterTag(${a.id})" style="${n?"":`color:${a.color}`}"><i class="fa-solid ${a.icon}"></i> ${a.name}</button>`}return t+="</div>",t}function Ux(){let e='<div class="bc-compose-tags">';for(const t of ya){const a=f.composeTag===t.id?"active":"";e+=`<button class="bc-compose-tag ${a}" onclick="BackchatPage.setComposeTag(${t.id})">${t.name}</button>`}return e+="</div>",e}function ko(){var a;if(!c.isConnected)return"";const e=xs(f.fees.post);return`
        ${!f.hasProfile&&c.isConnected?`
        <div class="bc-profile-create-banner">
            <p>Create your profile to get a username and start posting</p>
            <button class="bc-btn bc-btn-primary" onclick="BackchatPage.openProfileSetup()">
                <i class="fa-solid fa-user-plus"></i> Create Profile
            </button>
        </div>`:""}
        <div class="bc-compose">
            <div class="bc-compose-row">
                <div class="bc-compose-avatar">
                    ${(a=f.userProfile)!=null&&a.username?f.userProfile.username.charAt(0).toUpperCase():Ga(c.userAddress)}
                </div>
                <div class="bc-compose-body">
                    <textarea id="bc-compose-input" class="bc-compose-textarea" placeholder="What's happening on-chain?" maxlength="${It}" oninput="BackchatPage._updateCharCount(this)"></textarea>
                    ${f.pendingImagePreview?`
                        <div class="bc-image-preview">
                            <img src="${f.pendingImagePreview}" alt="Preview">
                            <button class="bc-image-remove" onclick="BackchatPage.removeImage()"><i class="fa-solid fa-xmark"></i></button>
                        </div>`:""}
                    ${f.isUploadingImage?'<div class="bc-uploading-badge"><i class="fa-solid fa-spinner fa-spin"></i> Uploading image...</div>':""}
                    ${Ux()}
                </div>
            </div>
            <div class="bc-compose-divider"></div>
            <div class="bc-compose-bottom">
                <div class="bc-compose-tools">
                    <button class="bc-compose-tool" title="Add image" onclick="document.getElementById('bc-image-input').click()"><i class="fa-solid fa-image"></i></button>
                    <input type="file" id="bc-image-input" hidden accept="image/jpeg,image/png,image/gif,image/webp" onchange="BackchatPage.handleImageSelect(event)">
                    <button class="bc-go-live-btn" title="Go Live" onclick="BackchatPage.goLive()" ${f.isLive?"disabled":""}>
                        <i class="fa-solid fa-video"></i> ${f.isLive?"LIVE":"Go Live"}
                    </button>
                </div>
                <div class="bc-compose-right">
                    <span class="bc-char-count" id="bc-char-counter">0/${It}</span>
                    <span class="bc-compose-fee">${e} ETH</span>
                    <button id="bc-post-btn" class="bc-post-btn" onclick="BackchatPage.createPost()" ${f.isPosting?"disabled":""}>
                        ${f.isPosting?'<i class="fa-solid fa-spinner fa-spin"></i> Posting':"Post"}
                    </button>
                </div>
            </div>
        </div>`}function jx(e){var a,n;if(!c.isConnected)return"";const t=((a=e.author)==null?void 0:a.toLowerCase())===((n=c.userAddress)==null?void 0:n.toLowerCase());return`
        <div class="bc-post-menu-wrap">
            <button class="bc-post-menu-btn" onclick="event.stopPropagation(); BackchatPage.togglePostMenu('${e.id}')" title="Options">
                <i class="fa-solid fa-ellipsis"></i>
            </button>
            <div class="bc-post-dropdown" id="post-menu-${e.id}" style="display:none;">
                ${t?`
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); BackchatPage.pinPost('${e.id}')">
                    <i class="fa-solid fa-thumbtack"></i> Pin to profile
                </button>
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); BackchatPage.openChangeTag('${e.id}')">
                    <i class="fa-solid fa-tag"></i> Change Tag
                </button>`:`
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); BackchatPage.openTip('${e.id}')">
                    <i class="fa-solid fa-hand-holding-dollar"></i> Tip Author
                </button>
                <button class="bc-post-dropdown-item danger" onclick="event.stopPropagation(); BackchatPage.openReport('${e.id}')">
                    <i class="fa-solid fa-flag"></i> Report
                </button>`}
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); BackchatPage.openBoostPost('${e.id}')">
                    <i class="fa-solid fa-rocket"></i> Boost Post
                </button>
                ${t?`
                <button class="bc-post-dropdown-item danger" onclick="event.stopPropagation(); BackchatPage.deletePost('${e.id}')">
                    <i class="fa-solid fa-trash"></i> Delete
                </button>`:""}
            </div>
        </div>`}function Zt(e,t=0,a={}){var h,C,T,A;if(e.type==="repost"&&!a.isRepostContent){const B=f.postsById.get(e.originalPostId);return`
            <div class="bc-post" data-post-id="${e.id}" style="animation-delay:${Math.min(t*.04,.4)}s">
                <div class="bc-repost-banner"><i class="fa-solid fa-retweet"></i> <span>${Ma(e.author)} reposted</span></div>
                ${B?Zt(B,t,{isRepostContent:!0,noAnimation:!0}):'<div class="bc-post-body" style="padding:16px 20px;color:var(--bc-text-3);">Original post not found</div>'}
            </div>`}const n=Ma(e.author),s=Eu(e.author),r=ix(e.author),i=ox(e.author),o=xs(e.superLikes),l=e.repliesCount||f.replyCountMap.get(e.id)||0,d=e.repostsCount||f.repostCountMap.get(e.id)||0,u=e.likesCount||((h=f.likesMap.get(e.id))==null?void 0:h.size)||0,p=e.downvotesCount||0,m=((T=f.likesMap.get(e.id))==null?void 0:T.has((C=c.userAddress)==null?void 0:C.toLowerCase()))||!1,g=a.noAnimation?"":`style="animation-delay:${Math.min(t*.04,.4)}s"`,x=lx(e.tag||0);return`
        <div class="bc-post" data-post-id="${e.id}" ${g} onclick="BackchatPage.viewPost('${e.id}')">
            <div class="bc-post-top">
                <div class="bc-avatar ${r?"boosted":""}" onclick="event.stopPropagation(); BackchatPage.viewProfile('${e.author}')">
                    ${rx(e.author)}
                </div>
                <div class="bc-post-head">
                    <div class="bc-post-author-row">
                        <span class="bc-author-name" onclick="event.stopPropagation(); BackchatPage.viewProfile('${e.author}')">${n}</span>
                        ${i?`<i class="fa-solid fa-circle-check bc-verified-icon" title="${["Verified","Premium","Elite"][f.badgeTier]||"Verified"}" style="${f.badgeTier===2?"color:#a855f7":f.badgeTier===1?"color:#f59e0b":""}"></i>`:""}
                        ${s?`<span class="bc-post-time">@${s}</span>`:""}
                        <span class="bc-post-time">&middot; ${sx(e.timestamp)}</span>
                        ${e.tag>0?`<span class="bc-tag-badge" style="color:${x.color};border-color:${x.color}30"><i class="fa-solid ${x.icon}"></i> ${x.name}</span>`:""}
                        ${e.superLikes>0n?`<span class="bc-trending-tag"><i class="fa-solid fa-bolt"></i> ${o}</span>`:""}
                        ${f.activeRooms.has(String(e.id))?'<span class="bc-live-badge"><span class="bc-live-badge-dot"></span> LIVE</span>':""}
                    </div>
                    ${e.type==="reply"?`<div class="bc-post-context">Replying to ${Ma((A=f.postsById.get(e.parentId))==null?void 0:A.author)}</div>`:""}
                </div>
                ${jx(e)}
            </div>
            ${e.content?`<div class="bc-post-body">${qe(e.content)}</div>`:""}
            ${e.mediaCID?`<div class="bc-post-media"><img src="${tx}${e.mediaCID}" alt="Media" loading="lazy" onerror="this.style.display='none'"></div>`:""}
            <div class="bc-actions" onclick="event.stopPropagation()">
                <button class="bc-action act-reply" onclick="BackchatPage.openReply('${e.id}')" title="Reply">
                    <i class="fa-regular fa-comment"></i>${l>0?`<span class="count">${l}</span>`:""}
                </button>
                <button class="bc-action act-repost" onclick="BackchatPage.openRepostConfirm('${e.id}')" title="Repost">
                    <i class="fa-solid fa-retweet"></i>${d>0?`<span class="count">${d}</span>`:""}
                </button>
                <button class="bc-action act-like ${m?"liked":""}" onclick="BackchatPage.like('${e.id}')" title="Like">
                    <i class="${m?"fa-solid":"fa-regular"} fa-heart"></i>${u>0?`<span class="count">${u}</span>`:""}
                </button>
                <button class="bc-action act-down" onclick="BackchatPage.openDownvote('${e.id}')" title="Downvote">
                    <i class="fa-solid fa-arrow-down"></i>${p>0?`<span class="count">${p}</span>`:""}
                </button>
                <button class="bc-action act-super" onclick="BackchatPage.openSuperLike('${e.id}')" title="Super Like">
                    <i class="fa-solid fa-star"></i>
                </button>
            </div>
        </div>`}function Wx(){return f.isLive?`
        <div class="bc-live-bar">
            <div class="bc-live-bar-header">
                <div class="bc-live-indicator">
                    <span class="bc-live-dot"></span>
                    <span class="bc-live-label">LIVE</span>
                    <span class="bc-live-viewers" data-live-viewers>${f.liveViewerCount} viewer${f.liveViewerCount!==1?"s":""}</span>
                </div>
                <button class="bc-btn bc-btn-outline" style="border-color:#ef4444;color:#ef4444;padding:6px 14px;font-size:12px;" onclick="BackchatPage.endLive()">
                    <i class="fa-solid fa-stop"></i> End Stream
                </button>
            </div>
            <video id="bc-local-video" class="bc-live-video" autoplay muted playsinline></video>
        </div>`:""}function Gx(){return f.watchingStreamId?`
        <div class="bc-live-bar">
            <video id="bc-remote-video" class="bc-live-video" autoplay playsinline style="max-height:400px;object-fit:contain;"></video>
            <div style="display:flex;align-items:center;justify-content:space-between;margin-top:12px;">
                <div class="bc-live-indicator">
                    <span class="bc-live-dot"></span>
                    <span class="bc-live-label">LIVE</span>
                </div>
                <button class="bc-btn bc-btn-outline" onclick="BackchatPage.leaveLive()">
                    <i class="fa-solid fa-xmark"></i> Leave
                </button>
            </div>
        </div>`:""}function Eo(){var t;if(!f.contractAvailable)return`<div class="bc-empty">
            <div class="bc-empty-glyph accent"><i class="fa-solid fa-rocket"></i></div>
            <div class="bc-empty-title">Coming Soon!</div>
            <div class="bc-empty-text">${f.error||"Agora is being deployed. The unstoppable social network will be live soon!"}</div>
            <button class="bc-btn bc-btn-outline" style="margin-top:24px;" onclick="BackchatPage.refresh()"><i class="fa-solid fa-arrows-rotate"></i> Retry</button>
        </div>`;if(f.isLoading)return'<div class="bc-loading"><div class="bc-spinner"></div><span class="bc-loading-text">Loading feed...</span></div>';let e=f.posts;if(f.selectedTag>=0&&(e=f.posts.filter(a=>{if(a.type==="repost"){const n=f.postsById.get(a.originalPostId);return n&&n.tag===f.selectedTag}return a.tag===f.selectedTag})),e.length===0){const a=f.selectedTag>=0&&((t=ya[f.selectedTag])==null?void 0:t.name)||"";return`<div class="bc-empty">
            <div class="bc-empty-glyph"><i class="fa-regular fa-comment-dots"></i></div>
            <div class="bc-empty-title">${f.selectedTag>=0?`No ${a} posts`:"No posts yet"}</div>
            <div class="bc-empty-text">${f.selectedTag>=0?"Try a different tag or be the first to post!":"Be the first to post on the unstoppable social network!"}</div>
        </div>`}return e.map((a,n)=>Zt(a,n)).join("")}function Yx(){const e=f.globalStats,t=e?`
        <div class="bc-stats-row">
            <div class="bc-mini-stat"><i class="fa-solid fa-pen-to-square" style="color:var(--bc-accent)"></i> <strong>${e.totalPosts}</strong> posts</div>
            <div class="bc-mini-stat"><i class="fa-solid fa-users" style="color:var(--bc-blue)"></i> <strong>${e.totalProfiles}</strong> profiles</div>
        </div>`:"";return f.trendingPosts.length===0?`
            <div class="bc-discover-header">
                <h2><i class="fa-solid fa-fire"></i> Discover</h2>
                <p>Ranked by Super Like value â€” pure organic discovery</p>
                ${t}
            </div>
            <div class="bc-empty">
                <div class="bc-empty-glyph accent"><i class="fa-solid fa-fire"></i></div>
                <div class="bc-empty-title">No trending posts</div>
                <div class="bc-empty-text">Super Like posts to make them trend! Ranking is 100% organic, based on ETH spent.</div>
            </div>`:`
        <div class="bc-discover-header">
            <h2><i class="fa-solid fa-fire"></i> Discover</h2>
            <p>Ranked by Super Like value â€” pure organic discovery</p>
            ${t}
        </div>
        ${f.trendingPosts.map((a,n)=>Zt(a,n)).join("")}`}function Kx(){var i,o,l,d,u,p,m,g;if(!c.isConnected)return`<div class="bc-empty">
            <div class="bc-empty-glyph"><i class="fa-solid fa-wallet"></i></div>
            <div class="bc-empty-title">Connect Wallet</div>
            <div class="bc-empty-text">Connect your wallet to view your profile.</div>
            <button class="bc-btn bc-btn-primary" style="margin-top:24px;" onclick="window.openConnectModal && window.openConnectModal()"><i class="fa-solid fa-wallet"></i> Connect Wallet</button>
        </div>`;const e=(i=c.userAddress)==null?void 0:i.toLowerCase(),t=f.allItems.filter(x=>{var h;return((h=x.author)==null?void 0:h.toLowerCase())===e&&x.type!=="repost"}),a=f.followers.size,n=f.following.size,s=((o=f.userProfile)==null?void 0:o.displayName)||((l=f.userProfile)==null?void 0:l.username)||Dn(c.userAddress),r=(d=f.userProfile)!=null&&d.avatar?li(f.userProfile.avatar):"";return`
        <div class="bc-profile-section">
            <div class="bc-profile-banner"></div>
            <div class="bc-profile-main">
                <div class="bc-profile-top-row">
                    <div class="bc-profile-pic ${f.isBoosted?"boosted":""}">${r?`<img src="${r}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" onerror="this.outerHTML='${(u=f.userProfile)!=null&&u.username?f.userProfile.username.charAt(0).toUpperCase():Ga(c.userAddress)}'">`:(p=f.userProfile)!=null&&p.username?f.userProfile.username.charAt(0).toUpperCase():Ga(c.userAddress)}</div>
                    <div class="bc-profile-actions">
                        ${f.hasProfile?'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.openEditProfile()"><i class="fa-solid fa-pen"></i> Edit</button>':'<button class="bc-btn bc-btn-primary" onclick="BackchatPage.openProfileSetup()"><i class="fa-solid fa-user-plus"></i> Create Profile</button>'}
                        ${f.hasBadge?"":'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.openBadge()"><i class="fa-solid fa-circle-check"></i> Badge</button>'}
                        ${f.isBoosted?"":'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.openBoost()"><i class="fa-solid fa-rocket"></i> Boost</button>'}
                    </div>
                </div>
                <div class="bc-profile-name-row">
                    <span class="bc-profile-name">${qe(s)}</span>
                    ${f.hasBadge?`<i class="fa-solid fa-circle-check bc-profile-badge"></i> <span style="font-size:11px;color:var(--bc-text-3);">${co(f.badgeExpiry)}</span>`:""}
                    ${f.isBoosted?`<span class="bc-boosted-tag"><i class="fa-solid fa-rocket"></i> Boosted ${co(f.boostExpiry)}</span>`:""}
                </div>
                ${(m=f.userProfile)!=null&&m.username?`<div class="bc-profile-username">@${f.userProfile.username}</div>`:""}
                ${(g=f.userProfile)!=null&&g.bio?`<div class="bc-profile-bio">${qe(f.userProfile.bio)}</div>`:""}
                <div class="bc-profile-handle">
                    <a href="${wu}${c.userAddress}" target="_blank" rel="noopener">View on Explorer <i class="fa-solid fa-arrow-up-right-from-square"></i></a>
                </div>
                <div class="bc-profile-stats">
                    <div class="bc-stat-cell"><div class="bc-stat-value">${t.length}</div><div class="bc-stat-label">Posts</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${a}</div><div class="bc-stat-label">Followers</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${n}</div><div class="bc-stat-label">Following</div></div>
                </div>
                ${ax()}
            </div>
            <div class="bc-section-head">
                <span class="bc-section-title"><i class="fa-solid fa-clock-rotate-left"></i> Your Posts</span>
                <span class="bc-section-subtitle">${t.length} total</span>
            </div>
            ${t.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No posts yet â€” share your first thought!</div></div>':t.sort((x,h)=>h.timestamp-x.timestamp).map((x,h)=>Zt(x,h)).join("")}
        </div>`}function V(){const e=document.getElementById("backchat-content");if(!e)return;let t="";switch(f.view){case"feed":t=Wx()+ko()+yo()+Eo();break;case"discover":t=Yx();break;case"profile":t=!f.hasProfile&&c.isConnected?To():Kx();break;case"post-detail":t=Vx();break;case"user-profile":t=qx();break;case"profile-setup":t=To();break;default:t=ko()+yo()+Eo()}e.innerHTML=t}function Vx(){const e=f.selectedPost?f.postsById.get(f.selectedPost):null;if(!e)return'<div class="bc-empty"><div class="bc-empty-title">Post not found</div></div>';const t=f.replies.get(e.id)||[];t.sort((r,i)=>r.timestamp-i.timestamp);const a=Ma(e.author),n=f.activeRooms.has(String(e.id)),s=f.watchingStreamId===String(e.id);return`
        ${s?Gx():""}
        ${n&&!s?`
            <div class="bc-live-join">
                <button class="bc-go-live-btn" onclick="BackchatPage.watchLive('${e.id}')">
                    <i class="fa-solid fa-play"></i> Join Live Stream
                </button>
            </div>`:""}
        <div class="bc-thread-parent">${Zt(e,0,{noAnimation:!0})}</div>
        <div class="bc-thread-divider">Replies ${t.length>0?`(${t.length})`:""}</div>
        ${t.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No replies yet. Be the first!</div></div>':t.map((r,i)=>`<div class="bc-thread-reply">${Zt(r,i,{noAnimation:!0})}</div>`).join("")}
        ${c.isConnected?`
            <div class="bc-reply-compose">
                <div class="bc-reply-label">Replying to ${a}</div>
                <div class="bc-reply-row">
                    <textarea id="bc-reply-input" class="bc-reply-input" placeholder="Write a reply..." maxlength="${It}"></textarea>
                    <button id="bc-reply-btn" class="bc-btn bc-btn-primary bc-reply-send" onclick="BackchatPage.submitReply('${e.id}')">Reply</button>
                </div>
                <div style="font-size:11px;color:var(--bc-text-3);margin-top:6px;">Fee: ${xs(f.fees.reply)} ETH</div>
            </div>`:""}`}function qx(){var m;const e=f.selectedProfile;if(!e)return'<div class="bc-empty"><div class="bc-empty-title">User not found</div></div>';const t=e.toLowerCase(),a=f.profiles.get(t),n=(a==null?void 0:a.displayName)||(a==null?void 0:a.username)||Dn(e),s=a==null?void 0:a.username,r=a==null?void 0:a.bio,i=ku(e),o=s?s.charAt(0).toUpperCase():Ga(e),l=t===((m=c.userAddress)==null?void 0:m.toLowerCase()),d=f.following.has(t),u=f.followCounts.get(t)||{followers:0,following:0},p=f.allItems.filter(g=>{var x;return((x=g.author)==null?void 0:x.toLowerCase())===t&&g.type!=="repost"});return`
        <div class="bc-profile-section">
            <div class="bc-profile-banner"></div>
            <div class="bc-profile-main">
                <div class="bc-profile-top-row">
                    <div class="bc-profile-pic">${i?`<img src="${i}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" onerror="this.outerHTML='${o}'">`:o}</div>
                    <div class="bc-profile-actions">
                        ${!l&&c.isConnected?`
                            <button class="bc-follow-toggle ${d?"do-unfollow":"do-follow"}"
                                onclick="BackchatPage.${d?"unfollow":"follow"}('${e}')">
                                ${d?"Following":"Follow"}
                            </button>`:""}
                    </div>
                </div>
                <div class="bc-profile-name-row"><span class="bc-profile-name">${qe(n)}</span></div>
                ${s?`<div class="bc-profile-username">@${s}</div>`:""}
                ${r?`<div class="bc-profile-bio">${qe(r)}</div>`:""}
                <div class="bc-profile-handle">
                    <a href="${wu}${e}" target="_blank" rel="noopener">${Dn(e)} <i class="fa-solid fa-arrow-up-right-from-square"></i></a>
                </div>
                <div class="bc-profile-stats">
                    <div class="bc-stat-cell"><div class="bc-stat-value">${p.length}</div><div class="bc-stat-label">Posts</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${u.followers}</div><div class="bc-stat-label">Followers</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${u.following}</div><div class="bc-stat-label">Following</div></div>
                </div>
            </div>
            <div class="bc-section-head"><span class="bc-section-title"><i class="fa-solid fa-clock-rotate-left"></i> Posts</span><span class="bc-section-subtitle">${p.length}</span></div>
            ${p.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No posts yet</div></div>':p.sort((g,x)=>x.timestamp-g.timestamp).map((g,x)=>Zt(g,x)).join("")}
        </div>`}function To(){if(!c.isConnected)return`<div class="bc-empty">
            <div class="bc-empty-glyph"><i class="fa-solid fa-wallet"></i></div>
            <div class="bc-empty-title">Connect Wallet</div>
            <div class="bc-empty-text">Connect your wallet to create your profile.</div>
        </div>`;const e=f.wizStep;return`
        <div class="bc-wizard">
            <div class="bc-wizard-title">Create Your Profile</div>
            <div class="bc-wizard-desc">Set up your on-chain identity on Agora</div>
            <div class="bc-wizard-dots">
                <div class="bc-wizard-dot ${e===1?"active":e>1?"done":""}"></div>
                <div class="bc-wizard-dot ${e===2?"active":e>2?"done":""}"></div>
                <div class="bc-wizard-dot ${e===3?"active":""}"></div>
            </div>
            <div class="bc-wizard-card">
                ${e===1?`
                    <div class="bc-field">
                        <label class="bc-label">Choose a Username</label>
                        <input type="text" id="wiz-username-input" class="bc-input" placeholder="e.g. satoshi"
                            value="${f.wizUsername}" maxlength="15" oninput="BackchatPage.onWizUsernameInput(this.value)">
                        <div id="wiz-username-status" class="bc-username-row"></div>
                        <div style="font-size:12px;color:var(--bc-text-3);margin-top:8px;">1-15 chars: lowercase letters, numbers, underscores. Shorter usernames cost more ETH.</div>
                    </div>
                `:e===2?`
                    <div class="bc-field">
                        <label class="bc-label">Display Name</label>
                        <input type="text" id="wiz-displayname-input" class="bc-input" placeholder="Your public name" value="${qe(f.wizDisplayName)}" maxlength="30">
                    </div>
                    <div class="bc-field">
                        <label class="bc-label">Bio</label>
                        <textarea id="wiz-bio-input" class="bc-input" placeholder="Tell the world about yourself..." maxlength="160" rows="3" style="resize:none;">${qe(f.wizBio)}</textarea>
                    </div>
                    <div style="font-size:12px;color:var(--bc-text-3);">Display name and bio are stored as metadata and can be updated anytime for free.</div>
                `:`
                    <div style="text-align:center;">
                        <div style="font-size:48px; margin-bottom:16px;">${f.wizUsername.charAt(0).toUpperCase()}</div>
                        <div style="font-size:18px; font-weight:700; color:var(--bc-text);">@${f.wizUsername}</div>
                        ${f.wizDisplayName?`<div style="font-size:14px; color:var(--bc-text-2); margin-top:4px;">${qe(f.wizDisplayName)}</div>`:""}
                        ${f.wizBio?`<div style="font-size:13px; color:var(--bc-text-3); margin-top:8px;">${qe(f.wizBio)}</div>`:""}
                        <div class="bc-fee-row" style="margin-top:20px;">
                            <span class="bc-fee-label">Username Fee</span>
                            <span class="bc-fee-val">${f.wizFee||"0"} ETH</span>
                        </div>
                    </div>
                `}
            </div>
            <div class="bc-wizard-nav">
                ${e>1?'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.wizBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>':""}
                ${e<3?`
                    <button class="bc-btn bc-btn-primary" onclick="BackchatPage.wizNext()" ${e===1&&!f.wizUsernameOk?"disabled":""}>
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                `:`
                    <button id="bc-wizard-confirm-btn" class="bc-btn bc-btn-primary" onclick="BackchatPage.wizConfirm()">
                        <i class="fa-solid fa-check"></i> Create Profile
                    </button>
                `}
            </div>
        </div>`}function Xx(){var e,t,a,n;return`
        <!-- Super Like Modal -->
        <div class="bc-modal-overlay" id="modal-superlike">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-star" style="color:var(--bc-accent)"></i> Super Like</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('superlike')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Super Likes boost posts to trending. The more ETH you contribute, the higher it ranks.</p>
                    <div class="bc-field"><label class="bc-label">Amount (ETH)</label><input type="number" id="superlike-amount" class="bc-input" value="0.001" min="0.0001" step="0.0001"></div>
                    <div class="bc-fee-row"><span class="bc-fee-label">Minimum</span><span class="bc-fee-val">0.0001 ETH</span></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="BackchatPage.confirmSuperLike()"><i class="fa-solid fa-star"></i> Super Like</button>
                </div>
            </div>
        </div>

        <!-- Downvote Modal -->
        <div class="bc-modal-overlay" id="modal-downvote">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-arrow-down" style="color:var(--bc-purple)"></i> Downvote</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('downvote')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Downvote posts you disagree with. Each 100 gwei = 1 downvote. Unlimited.</p>
                    <div class="bc-field"><label class="bc-label">Amount (ETH)</label><input type="number" id="downvote-amount" class="bc-input" value="0.001" min="0.0001" step="0.0001"></div>
                    <div class="bc-fee-row"><span class="bc-fee-label">Minimum</span><span class="bc-fee-val">0.0001 ETH (100 gwei)</span></div>
                    <button class="bc-btn bc-btn-outline" style="width:100%;margin-top:20px;justify-content:center;border-color:var(--bc-purple);color:var(--bc-purple);" onclick="BackchatPage.confirmDownvote()"><i class="fa-solid fa-arrow-down"></i> Downvote</button>
                </div>
            </div>
        </div>

        <!-- Badge Modal (V2: Tiers) -->
        <div class="bc-modal-overlay" id="modal-badge">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-circle-check" style="color:var(--bc-accent)"></i> Trust Badge</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('badge')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Get a verified badge for 1 year. Higher tiers = more prestige.</p>
                    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px;">
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:space-between;padding:12px 16px;" onclick="BackchatPage.confirmBadge(0)">
                            <span><i class="fa-solid fa-circle-check" style="color:#3b82f6"></i> Verified</span><span style="color:var(--bc-text-3)">0.02 ETH/year</span>
                        </button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:space-between;padding:12px 16px;border-color:#eab308;" onclick="BackchatPage.confirmBadge(1)">
                            <span><i class="fa-solid fa-circle-check" style="color:#eab308"></i> Premium</span><span style="color:var(--bc-text-3)">0.1 ETH/year</span>
                        </button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:space-between;padding:12px 16px;border-color:#a855f7;" onclick="BackchatPage.confirmBadge(2)">
                            <span><i class="fa-solid fa-gem" style="color:#a855f7"></i> Elite</span><span style="color:var(--bc-text-3)">0.25 ETH/year</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boost Modal -->
        <div class="bc-modal-overlay" id="modal-boost">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-rocket" style="color:var(--bc-accent)"></i> Profile Boost</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('boost')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Boost your profile visibility. Each 0.0005 ETH gives 1 day of boost.</p>
                    <div class="bc-field"><label class="bc-label">Amount (ETH)</label><input type="number" id="boost-amount" class="bc-input" value="0.001" min="0.0005" step="0.0005"></div>
                    <div class="bc-fee-row"><span class="bc-fee-label">Minimum</span><span class="bc-fee-val">0.0005 ETH (1 day)</span></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="BackchatPage.confirmBoost()"><i class="fa-solid fa-rocket"></i> Boost Profile</button>
                </div>
            </div>
        </div>

        <!-- Repost Modal -->
        <div class="bc-modal-overlay" id="modal-repost">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-retweet" style="color:var(--bc-green)"></i> Repost</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('repost')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Repost this to your followers? Fee: ${xs(f.fees.repost)} ETH</p>
                    <button id="bc-repost-confirm-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="BackchatPage.confirmRepost()"><i class="fa-solid fa-retweet"></i> Repost</button>
                </div>
            </div>
        </div>

        <!-- Change Tag Modal -->
        <div class="bc-modal-overlay" id="modal-change-tag">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-tag" style="color:var(--bc-accent)"></i> Change Tag</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('change-tag')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Select a new category for your post. Only gas fee applies.</p>
                    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px;">
                        ${ya.map(s=>`<button class="bc-compose-tag" onclick="BackchatPage.selectNewTag(${s.id})" id="change-tag-opt-${s.id}" style="color:${s.color}"><i class="fa-solid ${s.icon}"></i> ${s.name}</button>`).join("")}
                    </div>
                    <button id="bc-change-tag-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="BackchatPage.confirmChangeTag()" disabled><i class="fa-solid fa-check"></i> Change Tag</button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div class="bc-modal-overlay" id="modal-edit-profile">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-pen" style="color:var(--bc-accent)"></i> Edit Profile</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('edit-profile')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <div class="bc-field">
                        <label class="bc-label">Profile Picture</label>
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                            <div class="bc-avatar" style="width:56px;height:56px;font-size:20px;" id="edit-avatar-preview">
                                ${(e=f.userProfile)!=null&&e.avatar?`<img src="${li(f.userProfile.avatar)}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`:(t=f.userProfile)!=null&&t.username?f.userProfile.username.charAt(0).toUpperCase():"?"}
                            </div>
                            <label class="bc-btn bc-btn-outline" style="cursor:pointer;font-size:13px;">
                                <i class="fa-solid fa-camera"></i> Change Photo
                                <input type="file" id="edit-avatar-file" accept="image/jpeg,image/png,image/gif,image/webp" style="display:none;" onchange="BackchatPage.previewAvatar(this)">
                            </label>
                        </div>
                    </div>
                    <div class="bc-field"><label class="bc-label">Display Name</label><input type="text" id="edit-displayname" class="bc-input" value="${qe(((a=f.userProfile)==null?void 0:a.displayName)||"")}" maxlength="30" placeholder="Your display name"></div>
                    <div class="bc-field"><label class="bc-label">Bio</label><textarea id="edit-bio" class="bc-input" maxlength="160" rows="3" placeholder="About you..." style="resize:none;">${qe(((n=f.userProfile)==null?void 0:n.bio)||"")}</textarea></div>
                    <p style="font-size:12px;color:var(--bc-text-3);margin-bottom:16px;">Username cannot be changed. Only gas fee applies.</p>
                    <button id="bc-edit-profile-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="BackchatPage.confirmEditProfile()"><i class="fa-solid fa-check"></i> Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Report Modal (V2) -->
        <div class="bc-modal-overlay" id="modal-report">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-flag" style="color:#ef4444"></i> Report Post</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('report')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Report this post and block the author from your feed. Cost: 0.0001 ETH</p>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="BackchatPage.confirmReport(0)"><i class="fa-solid fa-robot"></i> Spam</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="BackchatPage.confirmReport(1)"><i class="fa-solid fa-hand"></i> Harassment</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;border-color:#ef4444;color:#ef4444;" onclick="BackchatPage.confirmReport(2)"><i class="fa-solid fa-gavel"></i> Illegal Content</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="BackchatPage.confirmReport(3)"><i class="fa-solid fa-mask"></i> Scam</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="BackchatPage.confirmReport(4)"><i class="fa-solid fa-circle-exclamation"></i> Other</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boost Post Modal (V2) -->
        <div class="bc-modal-overlay" id="modal-boost-post">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-rocket" style="color:var(--bc-accent)"></i> Boost Post</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('boost-post')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Boost this post for more visibility.</p>
                    <div class="bc-field"><label class="bc-label">Amount (ETH)</label><input type="number" id="boost-post-amount" class="bc-input" value="0.01" min="0.002" step="0.001"></div>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px;">
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:space-between;" onclick="BackchatPage.confirmBoostPost(0)">
                            <span><i class="fa-solid fa-rocket"></i> Standard</span><span style="color:var(--bc-text-3)">0.002 ETH/day</span>
                        </button>
                        <button class="bc-btn bc-btn-primary" style="width:100%;justify-content:space-between;" onclick="BackchatPage.confirmBoostPost(1)">
                            <span><i class="fa-solid fa-star"></i> Featured</span><span>0.01 ETH/day</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tip Modal (V2) -->
        <div class="bc-modal-overlay" id="modal-tip">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-hand-holding-dollar" style="color:var(--bc-green)"></i> Tip Author</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('tip')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Send ETH directly to the post author as a tip.</p>
                    <div class="bc-field"><label class="bc-label">Amount (ETH)</label><input type="number" id="tip-amount" class="bc-input" value="0.001" min="0.0001" step="0.0001"></div>
                    <div class="bc-fee-row"><span class="bc-fee-label">Minimum</span><span class="bc-fee-val">0.0001 ETH</span></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:16px;justify-content:center;background:var(--bc-green);" onclick="BackchatPage.confirmTip()"><i class="fa-solid fa-hand-holding-dollar"></i> Send Tip</button>
                </div>
            </div>
        </div>`}function Vt(){nx();const e=document.getElementById("backchat");e&&(e.innerHTML=`
        <div class="bc-shell">
            ${Hx()}
            <div id="backchat-content"></div>
        </div>
        ${Xx()}`,V())}let He=null;function Jx(e){var t;He=e,(t=document.getElementById("modal-superlike"))==null||t.classList.add("active")}async function Zx(){var t;const e=((t=document.getElementById("superlike-amount"))==null?void 0:t.value)||"0.001";Ue("superlike"),await mx(He,e)}function Qx(e){var t;He=e,(t=document.getElementById("modal-downvote"))==null||t.classList.add("active")}async function eh(){var t;const e=((t=document.getElementById("downvote-amount"))==null?void 0:t.value)||"0.001";Ue("downvote"),await gx(He,e)}function th(){var e;(e=document.getElementById("modal-badge"))==null||e.classList.add("active")}async function ah(e=0){await Cx(e)}function nh(){var e;(e=document.getElementById("modal-boost"))==null||e.classList.add("active")}async function sh(){var t;const e=((t=document.getElementById("boost-amount"))==null?void 0:t.value)||"0.001";Ue("boost"),await Bx(e)}function rh(e){var t;He=e,(t=document.getElementById("modal-report"))==null||t.classList.add("active")}async function ih(e){await Ix(He,e)}function oh(e){var t;He=e,(t=document.getElementById("modal-boost-post"))==null||t.classList.add("active")}async function lh(e){await Ax(He,e)}function ch(e){var t;He=e,(t=document.getElementById("modal-tip"))==null||t.classList.add("active")}async function dh(){await Px(He)}function uh(e){var n;const t=(n=e==null?void 0:e.files)==null?void 0:n[0];if(!t)return;if(t.size>5*1024*1024){b("Image too large. Maximum 5MB.","error");return}const a=new FileReader;a.onload=s=>{const r=document.getElementById("edit-avatar-preview");r&&(r.innerHTML=`<img src="${s.target.result}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`)},a.readAsDataURL(t)}function ph(e){var t;He=e,(t=document.getElementById("modal-repost"))==null||t.classList.add("active")}async function fh(){await px(He)}function mh(){var e;Vt(),(e=document.getElementById("modal-edit-profile"))==null||e.classList.add("active")}async function gh(){await Tx()}function Ue(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.remove("active")}function bh(e){const t=document.getElementById(`post-menu-${e}`);if(!t)return;const a=t.style.display!=="none";document.querySelectorAll(".bc-post-dropdown").forEach(n=>n.style.display="none"),t.style.display=a?"none":"block"}function xh(e){const t=document.getElementById("bc-char-counter");if(!t)return;const a=e.value.length;t.textContent=`${a}/${It}`,t.className="bc-char-count",a>It-50?t.classList.add("danger"):a>It-150&&t.classList.add("warn")}document.addEventListener("click",()=>{document.querySelectorAll(".bc-post-dropdown").forEach(e=>e.style.display="none")});const Tu={async render(e){e&&(Vt(),await Promise.all([fo(),mo(),go(),bo(),Je(),xo(),vo()]),await ho())},async refresh(){await Promise.all([fo(),mo(),go(),bo(),Je(),xo(),vo()]),await ho()},setTab(e){f.activeTab=e,f.view=e,f.selectedTag=-1,Vt()},filterTag(e){f.selectedTag=e,V()},setComposeTag(e){f.composeTag=e,V()},goBack:cx,viewPost(e){bn("post-detail",{post:e})},viewProfile(e){var t;(e==null?void 0:e.toLowerCase())===((t=c.userAddress)==null?void 0:t.toLowerCase())?(f.activeTab="profile",f.view="profile",Vt()):bn("user-profile",{profile:e})},openReply(e){bn("post-detail",{post:e})},openProfileSetup(){f.wizStep=1,f.wizUsername="",f.wizDisplayName="",f.wizBio="",f.wizUsernameOk=null,f.wizFee=null,bn("profile-setup")},createPost:dx,submitReply:ux,like:fx,follow:yx,unfollow:kx,deletePost:bx,pinPost:xx,openSuperLike:Jx,confirmSuperLike:Zx,openDownvote:Qx,confirmDownvote:eh,openRepostConfirm:ph,confirmRepost:fh,openChangeTag:hx,selectNewTag:vx,confirmChangeTag:wx,openBadge:th,confirmBadge:ah,openBoost:nh,confirmBoost:sh,openEditProfile:mh,confirmEditProfile:gh,closeModal:Ue,togglePostMenu:bh,openReport:rh,confirmReport:ih,openBoostPost:oh,confirmBoostPost:lh,openTip:ch,confirmTip:dh,previewAvatar:uh,goLive:Sx,endLive:zx,watchLive:Nx,leaveLive:$x,handleImageSelect:Mx,removeImage:Dx,onWizUsernameInput:Ox,wizNext(){var e,t,a,n;f.wizStep===1&&!f.wizUsernameOk||(f.wizStep===1?f.wizStep=2:f.wizStep===2&&(f.wizDisplayName=((t=(e=document.getElementById("wiz-displayname-input"))==null?void 0:e.value)==null?void 0:t.trim())||"",f.wizBio=((n=(a=document.getElementById("wiz-bio-input"))==null?void 0:a.value)==null?void 0:n.trim())||"",f.wizStep=3),V())},wizBack(){var e,t,a,n;f.wizStep>1&&(f.wizStep===2&&(f.wizDisplayName=((t=(e=document.getElementById("wiz-displayname-input"))==null?void 0:e.value)==null?void 0:t.trim())||"",f.wizBio=((n=(a=document.getElementById("wiz-bio-input"))==null?void 0:a.value)==null?void 0:n.trim())||""),f.wizStep--,V())},wizConfirm:Ex,_updateCharCount:xh};window.BackchatPage=Tu;const Qs=window.ethers,ve={referralCount:0,referrer:null,referralLink:"",isLoading:!1};function hh(){if(document.getElementById("referral-styles"))return;const e=document.createElement("style");e.id="referral-styles",e.textContent=`
        .ref-hero-badge {
            animation: ref-pulse 2s ease-in-out infinite;
        }
        @keyframes ref-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(245, 158, 11, 0); }
        }
        .ref-share-btn {
            transition: all 0.2s ease;
        }
        .ref-share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .ref-stat-card {
            background: linear-gradient(135deg, rgba(39,39,42,0.8), rgba(24,24,27,0.9));
            border: 1px solid rgba(63,63,70,0.5);
        }
        .ref-link-box {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(63,63,70,0.5);
        }
        .ref-copy-feedback {
            animation: ref-check 0.3s ease;
        }
        @keyframes ref-check {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .ref-step-num {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 14px;
        }
        .ref-flow-arrow {
            color: rgba(113,113,122,0.4);
        }
    `,document.head.appendChild(e)}async function Cu(){if(!(!c.isConnected||!c.userAddress)){ve.isLoading=!0;try{const e=ee.getProvider(),t=new Qs.Contract(y.backchainEcosystem,Qt,e),[a,n]=await Promise.all([t.referralCount(c.userAddress),t.referredBy(c.userAddress)]);ve.referralCount=Number(a),ve.referrer=n!==Qs.ZeroAddress?n:null,ve.referralLink=`${window.location.origin}/#dashboard?ref=${c.userAddress}`}catch(e){console.warn("[Referral] Load failed:",e.message)}ve.isLoading=!1}}function vh(e){hh();const t=document.getElementById("referral");if(!t)return;const a=c.isConnected&&c.userAddress;t.innerHTML=`
        <!-- Hero -->
        <div class="text-center py-8 sm:py-12">
            <div class="ref-hero-badge inline-flex items-center gap-2 bg-amber-500/10 border border-amber-500/30 rounded-full px-5 py-2 mb-5">
                <i class="fa-solid fa-bolt text-amber-400 text-sm"></i>
                <span class="text-amber-400 text-sm font-bold">100% Gasless Referral System</span>
            </div>
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white mb-4 leading-tight">
                Invite Friends,<br class="sm:hidden"> <span class="text-amber-400">Earn Dual Rewards</span>
            </h1>
            <p class="text-zinc-400 text-base sm:text-lg max-w-xl mx-auto leading-relaxed">
                Share your link. When your friends connect, they're <strong class="text-white">automatically onboarded</strong> â€”
                zero gas, zero popups. You earn <strong class="text-white">10% ETH on all fees</strong> + <strong class="text-white">5% BKC on staking rewards</strong>.
            </p>
        </div>

        <!-- Share Card -->
        <div class="max-w-2xl mx-auto mb-8">
            <div class="bg-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5 sm:p-6">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-link text-amber-400"></i> Your Referral Link
                </h2>
                ${a?`
                    <div class="ref-link-box flex items-center gap-2 rounded-xl px-4 py-3 mb-4">
                        <span id="ref-link-text" class="flex-1 text-sm text-zinc-300 truncate font-mono">${ve.referralLink||`${window.location.origin}/#dashboard?ref=${c.userAddress}`}</span>
                        <button id="ref-copy-btn" class="shrink-0 text-amber-400 hover:text-amber-300 transition-colors p-1" title="Copy">
                            <i class="fa-solid fa-copy text-lg"></i>
                        </button>
                    </div>
                    <!-- Social Share Buttons -->
                    <div class="flex flex-wrap justify-center gap-3">
                        <button id="ref-share-twitter" class="ref-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-[#1DA1F2]/20 border border-zinc-600/50 hover:border-[#1DA1F2]/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-[#1DA1F2]">
                            <i class="fa-brands fa-x-twitter"></i> Twitter
                        </button>
                        <button id="ref-share-telegram" class="ref-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-[#0088cc]/20 border border-zinc-600/50 hover:border-[#0088cc]/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-[#0088cc]">
                            <i class="fa-brands fa-telegram"></i> Telegram
                        </button>
                        <button id="ref-share-whatsapp" class="ref-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-[#25D366]/20 border border-zinc-600/50 hover:border-[#25D366]/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-[#25D366]">
                            <i class="fa-brands fa-whatsapp"></i> WhatsApp
                        </button>
                        <button id="ref-share-native" class="ref-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-amber-500/20 border border-zinc-600/50 hover:border-amber-500/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-amber-400">
                            <i class="fa-solid fa-share-nodes"></i> Share
                        </button>
                    </div>
                `:`
                    <div class="text-center py-6">
                        <i class="fa-solid fa-wallet text-4xl text-zinc-600 mb-3"></i>
                        <p class="text-zinc-400">Connect your wallet to get your referral link</p>
                    </div>
                `}
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-3xl mx-auto mb-10">
            <div class="ref-stat-card rounded-2xl p-5 text-center">
                <div class="text-3xl font-extrabold text-amber-400 mb-1" id="ref-count">${ve.referralCount}</div>
                <div class="text-sm text-zinc-400">Friends Referred</div>
            </div>
            <div class="ref-stat-card rounded-2xl p-5 text-center">
                <div class="text-lg font-bold text-white mb-1 truncate" id="ref-referrer">${ve.referrer?bt(ve.referrer):"None yet"}</div>
                <div class="text-sm text-zinc-400">Your Referrer</div>
            </div>
            <div class="ref-stat-card rounded-2xl p-5 text-center">
                <div class="text-lg font-bold mb-1 ${ve.referrer?"text-green-400":"text-zinc-500"}">${ve.referrer?"Active":"No Referrer"}</div>
                <div class="text-sm text-zinc-400">Referral Status</div>
            </div>
        </div>

        <!-- Influencer Dashboard: Your Referral Network -->
        ${a&&ve.referralCount>0?`
        <div class="max-w-3xl mx-auto mb-10">
            <div class="rounded-2xl p-5 sm:p-6" style="background:rgba(39,39,42,0.5);border:1px solid rgba(63,63,70,0.5);">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-chart-line" style="color:#f59e0b;"></i> Your Referral Network
                </h3>
                <div id="ref-referred-list" class="space-y-2">
                    <div class="text-center text-zinc-500 text-sm py-4">
                        <div class="loader mx-auto mb-2"></div>
                        Loading referred addresses...
                    </div>
                </div>
            </div>
        </div>
        `:""}

        <!-- How It Works -->
        <div class="max-w-3xl mx-auto mb-10">
            <h2 class="text-xl font-bold text-white mb-6 text-center">How It Works</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <div class="text-center relative">
                    <div class="w-16 h-16 rounded-2xl bg-amber-500/10 border border-amber-500/30 flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-share-nodes text-2xl text-amber-400"></i>
                    </div>
                    <h3 class="text-white font-bold mb-2">1. Share Your Link</h3>
                    <p class="text-zinc-400 text-sm">Send your unique referral link via social media, DMs, or anywhere</p>
                </div>
                <div class="text-center relative">
                    <div class="w-16 h-16 rounded-2xl bg-purple-500/10 border border-purple-500/30 flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-wand-magic-sparkles text-2xl text-purple-400"></i>
                    </div>
                    <h3 class="text-white font-bold mb-2">2. Auto-Onboarding</h3>
                    <p class="text-zinc-400 text-sm">Friend clicks your link, connects wallet â€” referral is set automatically + they receive free BKC. Zero gas!</p>
                </div>
                <div class="text-center">
                    <div class="w-16 h-16 rounded-2xl bg-green-500/10 border border-green-500/30 flex items-center justify-center mx-auto mb-4">
                        <i class="fa-solid fa-coins text-2xl text-green-400"></i>
                    </div>
                    <h3 class="text-white font-bold mb-2">3. Earn Dual Rewards</h3>
                    <p class="text-zinc-400 text-sm">Earn 10% ETH on every fee they pay + 5% BKC on staking claims â€” for life</p>
                </div>
            </div>
        </div>

        <!-- Referrer Status (only if no referrer yet) -->
        ${a&&!ve.referrer?`
        <div class="max-w-2xl mx-auto mb-10">
            <div class="bg-zinc-800/30 border border-zinc-700/30 border-dashed rounded-2xl p-5 sm:p-6 text-center">
                <i class="fa-solid fa-user-plus text-3xl text-zinc-600 mb-3"></i>
                <h3 class="text-white font-semibold mb-2">No Referrer Set Yet</h3>
                <p class="text-zinc-400 text-sm max-w-md mx-auto">
                    Ask a friend for their referral link and visit it while connected.
                    Your referrer is set <strong class="text-white">automatically</strong> â€” no forms, no gas, no popups.
                </p>
            </div>
        </div>
        `:""}

        <!-- FAQ -->
        <div class="max-w-3xl mx-auto mb-10">
            <h2 class="text-xl font-bold text-white mb-6 text-center">Frequently Asked Questions</h2>
            <div class="space-y-3">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold mb-1">How much can I earn?</h4>
                    <p class="text-zinc-400 text-sm">You earn 10% ETH on every fee your referrals pay (posts, certifications, badges, etc.) plus 5% BKC on staking reward claims. No limit â€” the more active referrals, the more you earn.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold mb-1">How do I get referred?</h4>
                    <p class="text-zinc-400 text-sm">Just click a friend's referral link and connect your wallet. Everything is automatic â€” the system sets your referrer and sends you free BKC tokens as a welcome bonus. No manual input needed.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold mb-1">Is this on-chain?</h4>
                    <p class="text-zinc-400 text-sm">Yes. Referral relationships are stored permanently on the Arbitrum blockchain. The 10% ETH cut is enforced by the Ecosystem contract and the 5% BKC by the StakingPool â€” no one can revoke it.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold mb-1">Can I change my referrer?</h4>
                    <p class="text-zinc-400 text-sm">No. Once set, your referrer is permanent and enforced by the smart contract. Choose wisely. If no referrer is set, the 5% goes to the project treasury.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold mb-1">Does my friend need ETH for gas?</h4>
                    <p class="text-zinc-400 text-sm">No! The referral system is 100% gasless. A server-side relayer pays all gas fees. Your friend just clicks, connects, and receives free BKC â€” zero cost.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold mb-1">What if no one uses my link?</h4>
                    <p class="text-zinc-400 text-sm">Your link stays active forever. Even if someone uses it months from now, you'll start earning from their staking rewards.</p>
                </div>
            </div>
        </div>

        <!-- CTA -->
        <div class="text-center py-6">
            <p class="text-zinc-500 text-xs">Powered by Backchain Protocol on Arbitrum</p>
        </div>
    `,wh(),a&&Cu().then(Iu)}function Iu(){const e=document.getElementById("ref-count"),t=document.getElementById("ref-referrer");e&&(e.textContent=ve.referralCount),t&&(t.textContent=ve.referrer?bt(ve.referrer):"None yet")}function wh(){const e=document.getElementById("referral");e&&e.addEventListener("click",t=>{const a=t.target;if(a.closest("#ref-copy-btn")){Au();return}if(a.closest("#ref-share-twitter")){yh();return}if(a.closest("#ref-share-telegram")){kh();return}if(a.closest("#ref-share-whatsapp")){Eh();return}if(a.closest("#ref-share-native")){Th();return}})}function nn(){return c.userAddress?`${window.location.origin}/#dashboard?ref=${c.userAddress}`:""}function hs(){return"Join Backchain and earn passive income! Stake BKC tokens and get rewards. Use my referral link:"}function Au(){const e=nn();e&&navigator.clipboard.writeText(e).then(()=>{b("Referral link copied!","success");const t=document.getElementById("ref-copy-btn");t&&(t.innerHTML='<i class="fa-solid fa-check text-lg ref-copy-feedback"></i>',setTimeout(()=>{t.innerHTML='<i class="fa-solid fa-copy text-lg"></i>'},2e3))}).catch(()=>b("Failed to copy","error"))}function yh(){const e=nn();if(!e)return;const t=encodeURIComponent(`${hs()} ${e}

#Backchain #BKC #DeFi #Arbitrum`);window.open(`https://x.com/intent/tweet?text=${t}`,"_blank")}function kh(){const e=nn();if(!e)return;const t=encodeURIComponent(hs()),a=encodeURIComponent(e);window.open(`https://t.me/share/url?url=${a}&text=${t}`,"_blank")}function Eh(){const e=nn();if(!e)return;const t=encodeURIComponent(`${hs()} ${e}`);window.open(`https://wa.me/?text=${t}`,"_blank")}function Th(){const e=nn();e&&(navigator.share?navigator.share({title:"Join Backchain",text:hs(),url:e}).catch(()=>{}):Au())}async function Ch(){if(!(!c.isConnected||ve.referralCount===0))try{const e=ee.getProvider(),t=new Qs.Contract(y.backchainEcosystem,Qt,e),a=t.filters.ReferrerSet(null,c.userAddress),n=await t.queryFilter(a,0,"latest"),s=document.getElementById("ref-referred-list");if(!s)return;if(n.length===0){s.innerHTML='<p class="text-zinc-500 text-sm text-center py-2">No referrals yet</p>';return}s.innerHTML=n.map((r,i)=>`
            <div class="flex items-center justify-between rounded-xl px-4 py-3" style="background:rgba(24,24,27,0.5);">
                <div class="flex items-center gap-3">
                    <span class="font-bold text-sm" style="color:#f59e0b;">#${i+1}</span>
                    <span class="text-zinc-300 font-mono text-sm">${bt(r.args[0])}</span>
                </div>
                <a href="https://sepolia.arbiscan.io/address/${r.args[0]}" target="_blank" rel="noopener" class="text-zinc-500 hover:text-zinc-300 text-xs">
                    <i class="fa-solid fa-external-link"></i>
                </a>
            </div>
        `).join("")}catch(e){console.warn("[Referral] Failed to load referred list:",e.message)}}function Ih(e){e&&Cu().then(()=>{Iu(),Ch()})}function Ah(){}const Ph={render:vh,update:Ih,cleanup:Ah},ci=window.ethers,de={pendingEth:0n,modules:[],currentOperator:null,isLoading:!1,isWithdrawing:!1};let xn=null;function Bh(){if(xn)return xn;const e=window.ethers;return xn={[e.id("STAKING")]:{name:"Staking",icon:"fa-layer-group",color:"text-purple-400",bg:"bg-purple-500/10"},[e.id("NFT_POOL")]:{name:"NFT Market",icon:"fa-store",color:"text-pink-400",bg:"bg-pink-500/10"},[e.id("FORTUNE")]:{name:"Fortune Pool",icon:"fa-dice",color:"text-green-400",bg:"bg-green-500/10"},[e.id("AGORA")]:{name:"Agora",icon:"fa-landmark",color:"text-cyan-400",bg:"bg-cyan-500/10"},[e.id("NOTARY")]:{name:"Notary",icon:"fa-stamp",color:"text-slate-400",bg:"bg-slate-500/10"},[e.id("CHARITY")]:{name:"Charity",icon:"fa-hand-holding-heart",color:"text-red-400",bg:"bg-red-500/10"},[e.id("RENTAL")]:{name:"Rental Market",icon:"fa-rocket",color:"text-teal-400",bg:"bg-teal-500/10"}},xn}function Sh(){if(document.getElementById("operator-styles"))return;const e=document.createElement("style");e.id="operator-styles",e.textContent=`
        .op-hero-badge {
            animation: op-glow 2s ease-in-out infinite;
        }
        @keyframes op-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(16, 185, 129, 0); }
        }
        .op-earnings-card {
            background: linear-gradient(135deg, rgba(16,185,129,0.08), rgba(6,78,59,0.15));
            border: 1px solid rgba(16,185,129,0.2);
        }
        .op-module-row {
            transition: background-color 0.15s ease;
        }
        .op-module-row:hover {
            background-color: rgba(255,255,255,0.03);
        }
        .op-code-block {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(63,63,70,0.5);
            font-family: 'Fira Code', 'Cascadia Code', monospace;
        }
        .op-code-block code {
            color: #a78bfa;
        }
        .op-code-block .op-string { color: #4ade80; }
        .op-code-block .op-comment { color: #71717a; }
    `,document.head.appendChild(e)}async function Pu(){de.isLoading=!0;try{const e=ee.getProvider(),t=new ci.Contract(y.backchainEcosystem,Qt,e);c.isConnected&&c.userAddress&&(de.pendingEth=await t.pendingEth(c.userAddress));const a=Bh(),n=Object.keys(a),s=await Promise.all(n.map(r=>t.getModuleConfig(r)));de.modules=n.map((r,i)=>({...a[r],moduleId:r,operatorBps:Number(s[i].operatorBps),treasuryBps:Number(s[i].treasuryBps),buybackBps:Number(s[i].buybackBps),customBps:Number(s[i].customBps),active:s[i].active})).filter(r=>r.active),de.currentOperator=Ka()}catch(e){console.warn("[Operator] Load failed:",e.message)}de.isLoading=!1}function zh(e){Sh();const t=document.getElementById("operator");if(!t)return;const a=c.isConnected&&c.userAddress,n=de.pendingEth>0n?ci.formatEther(de.pendingEth):"0.0",s=Ka();t.innerHTML=`
        <!-- Hero -->
        <div class="text-center py-8 sm:py-12">
            <div class="op-hero-badge inline-flex items-center gap-2 bg-emerald-500/10 border border-emerald-500/30 rounded-full px-5 py-2 mb-5">
                <i class="fa-solid fa-code text-emerald-400 text-sm"></i>
                <span class="text-emerald-400 text-sm font-bold">10-20% Commission</span>
            </div>
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white mb-4 leading-tight">
                Build on Backchain,<br class="sm:hidden"> <span class="text-emerald-400">Earn Forever</span>
            </h1>
            <p class="text-zinc-400 text-base sm:text-lg max-w-xl mx-auto leading-relaxed">
                Create your own frontend, bot, or integration. Earn <strong class="text-white">10-20% of every fee</strong> generated through your app â€” perpetually.
            </p>
        </div>

        <!-- Earnings Dashboard -->
        ${a?`
        <div class="op-earnings-card rounded-2xl p-6 max-w-2xl mx-auto mb-8">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-center sm:text-left">
                    <p class="text-emerald-400/80 text-sm font-medium mb-1">Your Pending Earnings</p>
                    <p class="text-3xl sm:text-4xl font-extrabold text-white" id="op-pending">${n} <span class="text-lg text-zinc-400">ETH</span></p>
                </div>
                <button id="op-withdraw-btn"
                    class="bg-emerald-600 hover:bg-emerald-500 disabled:bg-zinc-700 disabled:text-zinc-500 text-white font-bold rounded-xl px-6 py-3 text-sm transition-colors flex items-center gap-2"
                    ${de.pendingEth===0n?"disabled":""}>
                    <i class="fa-solid fa-wallet"></i> Withdraw ETH
                </button>
            </div>
        </div>
        `:`
        <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-6 max-w-2xl mx-auto mb-8 text-center">
            <i class="fa-solid fa-wallet text-4xl text-zinc-600 mb-3"></i>
            <p class="text-zinc-400">Connect your wallet to see your operator earnings</p>
        </div>
        `}

        <!-- How It Works -->
        <div class="max-w-3xl mx-auto mb-10">
            <h2 class="text-xl font-bold text-white mb-6 text-center">How Operators Earn</h2>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="w-14 h-14 rounded-2xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center mx-auto mb-3">
                        <i class="fa-solid fa-code text-xl text-emerald-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">1. Build</h3>
                    <p class="text-zinc-500 text-xs">Create a frontend or bot</p>
                </div>
                <div class="text-center">
                    <div class="w-14 h-14 rounded-2xl bg-blue-500/10 border border-blue-500/30 flex items-center justify-center mx-auto mb-3">
                        <i class="fa-solid fa-users text-xl text-blue-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">2. Users</h3>
                    <p class="text-zinc-500 text-xs">Users interact via your app</p>
                </div>
                <div class="text-center">
                    <div class="w-14 h-14 rounded-2xl bg-amber-500/10 border border-amber-500/30 flex items-center justify-center mx-auto mb-3">
                        <i class="fa-solid fa-receipt text-xl text-amber-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">3. Fees</h3>
                    <p class="text-zinc-500 text-xs">Protocol fees are generated</p>
                </div>
                <div class="text-center">
                    <div class="w-14 h-14 rounded-2xl bg-green-500/10 border border-green-500/30 flex items-center justify-center mx-auto mb-3">
                        <i class="fa-solid fa-coins text-xl text-green-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">4. Earn %</h3>
                    <p class="text-zinc-500 text-xs">You get your commission cut</p>
                </div>
            </div>
        </div>

        <!-- Commission Rates -->
        <div class="max-w-3xl mx-auto mb-10">
            <h2 class="text-xl font-bold text-white mb-4 text-center">Commission Rates</h2>
            <p class="text-zinc-400 text-sm text-center mb-6">Each module distributes fees differently. Your operator share is guaranteed by smart contract.</p>
            <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl overflow-hidden">
                <div class="grid grid-cols-3 gap-2 px-4 py-3 border-b border-zinc-700/30 text-xs text-zinc-500 font-bold uppercase tracking-wider">
                    <span>Module</span>
                    <span class="text-center">Operator %</span>
                    <span class="text-right">Fee Split</span>
                </div>
                <div id="op-modules-list">
                    ${de.modules.length>0?de.modules.map(r=>`
                        <div class="op-module-row grid grid-cols-3 gap-2 px-4 py-3 border-b border-zinc-700/20 items-center">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 ${r.bg} rounded-lg flex items-center justify-center shrink-0">
                                    <i class="fa-solid ${r.icon} ${r.color} text-sm"></i>
                                </div>
                                <span class="text-white text-sm font-medium">${r.name}</span>
                            </div>
                            <div class="text-center">
                                <span class="text-emerald-400 font-bold text-lg">${(r.operatorBps/100).toFixed(0)}%</span>
                            </div>
                            <div class="text-right text-xs text-zinc-500 space-y-0.5">
                                <div>Custom ${(r.customBps/100).toFixed(0)}%</div>
                                <div>Treasury ${(r.treasuryBps/100).toFixed(0)}%</div>
                                <div>Buyback ${(r.buybackBps/100).toFixed(0)}%</div>
                            </div>
                        </div>
                    `).join(""):`
                        <div class="px-4 py-8 text-center text-zinc-500">
                            <i class="fa-solid fa-spinner fa-spin mr-2"></i> Loading module data...
                        </div>
                    `}
                </div>
            </div>
        </div>

        <!-- Quick Start -->
        <div class="max-w-3xl mx-auto mb-10">
            <h2 class="text-xl font-bold text-white mb-4 text-center">Quick Start for Developers</h2>
            <div class="space-y-4">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5">
                    <h3 class="text-white font-semibold mb-2 text-sm flex items-center gap-2"><i class="fa-solid fa-1 text-emerald-400"></i> Set your operator address</h3>
                    <p class="text-zinc-400 text-xs mb-3">Add this to your frontend before any Backchain imports:</p>
                    <div class="op-code-block rounded-xl px-4 py-3 text-sm overflow-x-auto">
                        <code><span class="op-comment">// Set your wallet as the operator</span>
window.BACKCHAIN_OPERATOR = <span class="op-string">"0xYOUR_WALLET_ADDRESS"</span>;</code>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5">
                    <h3 class="text-white font-semibold mb-2 text-sm flex items-center gap-2"><i class="fa-solid fa-2 text-emerald-400"></i> Or via localStorage</h3>
                    <p class="text-zinc-400 text-xs mb-3">For runtime configuration:</p>
                    <div class="op-code-block rounded-xl px-4 py-3 text-sm overflow-x-auto">
                        <code>localStorage.setItem(<span class="op-string">'bkc_operator'</span>, <span class="op-string">'0xYOUR_WALLET_ADDRESS'</span>);</code>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5">
                    <h3 class="text-white font-semibold mb-2 text-sm flex items-center gap-2"><i class="fa-solid fa-3 text-emerald-400"></i> That's it!</h3>
                    <p class="text-zinc-400 text-sm">Every transaction made through your frontend will include your operator address. Fees accumulate on-chain and you can withdraw anytime.</p>
                </div>
            </div>
        </div>

        <!-- Set Operator (for testing) -->
        <div class="max-w-2xl mx-auto mb-10">
            <div class="bg-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5 sm:p-6">
                <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                    <i class="fa-solid fa-flask text-emerald-400"></i> Test as Operator
                </h3>
                <p class="text-zinc-400 text-sm mb-4">Set your wallet as the operator for this browser session. All transactions you make will credit fees to this address.</p>
                <div class="flex flex-col sm:flex-row gap-3 mb-3">
                    <input id="op-address-input" type="text" placeholder="0x..." value="${s.isSet?s.address:""}"
                        class="flex-1 bg-zinc-900/50 border border-zinc-700 rounded-xl px-4 py-3 text-white text-sm placeholder-zinc-600 focus:outline-none focus:border-emerald-500/50 font-mono" />
                    <div class="flex gap-2">
                        <button id="op-set-btn"
                            class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl px-5 py-3 text-sm transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-check"></i> Set
                        </button>
                        <button id="op-clear-btn"
                            class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold rounded-xl px-5 py-3 text-sm transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-xmark"></i> Clear
                        </button>
                    </div>
                </div>
                <div class="text-sm" id="op-current-display">
                    ${s.isSet?`<span class="text-emerald-400"><i class="fa-solid fa-circle-check mr-1"></i> Active: ${Va(s.address)}</span> <span class="text-zinc-600">(source: ${s.source})</span>`:'<span class="text-zinc-500"><i class="fa-solid fa-circle-xmark mr-1"></i> No operator set</span>'}
                </div>
            </div>
        </div>

        <!-- CTA -->
        <div class="text-center py-6">
            <p class="text-zinc-500 text-xs">Operator system is permissionless. No registration required. No admin approval.</p>
        </div>
    `,Nh(),de.modules.length===0&&Pu().then(()=>{Bu(),di()})}function Bu(){const e=document.getElementById("op-modules-list");!e||de.modules.length===0||(e.innerHTML=de.modules.map(t=>`
        <div class="op-module-row grid grid-cols-3 gap-2 px-4 py-3 border-b border-zinc-700/20 items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 ${t.bg} rounded-lg flex items-center justify-center shrink-0">
                    <i class="fa-solid ${t.icon} ${t.color} text-sm"></i>
                </div>
                <span class="text-white text-sm font-medium">${t.name}</span>
            </div>
            <div class="text-center">
                <span class="text-emerald-400 font-bold text-lg">${(t.operatorBps/100).toFixed(0)}%</span>
            </div>
            <div class="text-right text-xs text-zinc-500 space-y-0.5">
                <div>Custom ${(t.customBps/100).toFixed(0)}%</div>
                <div>Treasury ${(t.treasuryBps/100).toFixed(0)}%</div>
                <div>Buyback ${(t.buybackBps/100).toFixed(0)}%</div>
            </div>
        </div>
    `).join(""))}function di(){const e=document.getElementById("op-pending");if(e){const a=de.pendingEth>0n?ci.formatEther(de.pendingEth):"0.0";e.innerHTML=`${a} <span class="text-lg text-zinc-400">ETH</span>`}const t=document.getElementById("op-withdraw-btn");t&&(t.disabled=de.pendingEth===0n)}function Su(){const e=document.getElementById("op-current-display");if(!e)return;const t=Ka();e.innerHTML=t.isSet?`<span class="text-emerald-400"><i class="fa-solid fa-circle-check mr-1"></i> Active: ${Va(t.address)}</span> <span class="text-zinc-600">(source: ${t.source})</span>`:'<span class="text-zinc-500"><i class="fa-solid fa-circle-xmark mr-1"></i> No operator set</span>'}function Nh(){const e=document.getElementById("operator");e&&e.addEventListener("click",t=>{const a=t.target;if(a.closest("#op-withdraw-btn")){$h();return}if(a.closest("#op-set-btn")){Lh();return}if(a.closest("#op-clear-btn")){Rh();return}})}async function $h(){if(de.isWithdrawing||de.pendingEth===0n)return;const e=document.getElementById("op-withdraw-btn");de.isWithdrawing=!0,await j.execute({contract:c.ecosystemManagerContract,method:"withdrawEth",args:()=>[],description:"Withdraw Operator Earnings",skipSimulation:!0,fixedGasLimit:80000n,button:e,onSuccess:()=>{de.isWithdrawing=!1,de.pendingEth=0n,di(),b("ETH withdrawn successfully!","success")},onError:t=>{de.isWithdrawing=!1,console.error("[Operator] Withdraw failed:",t)}})}function Lh(){const e=document.getElementById("op-address-input");if(!e)return;const t=e.value.trim();if(!t){b("Enter an address","error");return}ur(t)?(b(`Operator set to ${Va(t)}`,"success"),Su()):b("Invalid address","error")}function Rh(){as();const e=document.getElementById("op-address-input");e&&(e.value=""),b("Operator cleared","info"),Su()}function _h(e){e&&Pu().then(()=>{Bu(),di()})}function Fh(){}const Mh={render:zh,update:_h,cleanup:Fh},Dh=window.inject||(()=>{console.warn("Dev Mode: Analytics disabled.")});if(window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1")try{Dh()}catch(e){console.error("Analytics Error:",e)}const ui="".toLowerCase();window.__ADMIN_WALLET__=ui;ui&&console.log("âœ… Admin access granted");let Gt=null,za=null,Ls=!1;const ke={dashboard:yd,mine:js,store:mm,rewards:js,actions:Xm,charity:ex,backchat:Tu,notary:Yd,airdrop:Bg,tokenomics:b0,about:og,admin:a0,rental:Zd,socials:db,tutorials:eu,referral:Ph,operator:Mh};function zu(e){return!e||e.length<42?"...":`${e.slice(0,6)}...${e.slice(-4)}`}function Oh(e){if(!e)return"0.00";const t=O(e);return t>=1e9?(t/1e9).toFixed(2)+"B":t>=1e6?(t/1e6).toFixed(2)+"M":t>=1e4?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function At(e,t=!1){const a=document.querySelector("main > div.container"),n=document.querySelectorAll(".sidebar-link");if(!a){console.error("âŒ Page container not found");return}e==="rewards"&&(e="mine",window.location.hash="mine");const s=window.location.hash.includes("/");if(!(Gt!==e||t||s)){ke[e]&&typeof ke[e].update=="function"&&ke[e].update(c.isConnected);return}console.log(`ðŸ“ Navigating: ${Gt} â†’ ${e} (force: ${t})`),za&&typeof za=="function"&&(za(),za=null),Array.from(a.children).forEach(l=>{l.tagName==="SECTION"&&(l.classList.add("hidden"),l.classList.remove("active"))});const i=document.getElementById("charity-container");i&&e!=="charity"&&(i.innerHTML=""),n.forEach(l=>{l.classList.remove("active")});const o=document.getElementById(e);if(o&&ke[e]){o.classList.remove("hidden"),o.classList.add("active");const l=Gt!==e;Gt=e;const d=document.querySelector(`.sidebar-link[data-target="${e}"]`);d&&(d.classList.remove("text-zinc-400","hover:text-white","hover:bg-zinc-700"),d.classList.add("active")),document.querySelectorAll(".bottom-tab").forEach(p=>p.classList.remove("active"));const u=document.querySelector(`.bottom-tab[data-target="${e}"]`);u&&u.classList.add("active"),ke[e]&&typeof ke[e].render=="function"&&ke[e].render(l||t),typeof ke[e].cleanup=="function"&&(za=ke[e].cleanup),l&&window.scrollTo(0,0)}else e!=="dashboard"&&e!=="faucet"&&(console.warn(`Route '${e}' not found, redirecting to dashboard.`),At("dashboard",!0))}window.navigateTo=At;const Co="wallet-btn text-xs font-mono text-center max-w-fit whitespace-nowrap relative font-bold py-2 px-4 rounded-md transition-colors";function vs(e=!1){Ls||(Ls=!0,requestAnimationFrame(()=>{Hh(e),Ls=!1}))}function Hh(e){const t=document.getElementById("admin-link-container"),a=document.getElementById("statUserBalance"),n=document.getElementById("connectButtonDesktop"),s=document.getElementById("connectButtonMobile"),r=document.getElementById("mobileAppDisplay");let i=c.userAddress;const o=[n,s];if(c.isConnected&&i){const d=Oh(c.currentUserBalance),p=`
            <div class="status-dot"></div>
            <span>${zu(i)}</span>
            <div class="balance-pill">
                ${d} BKC
            </div>
        `;if(o.forEach(m=>{m&&(m.innerHTML=p,m.className=Co+" wallet-btn-connected")}),r&&(r.textContent="Backcoin.org",r.classList.add("text-white"),r.classList.remove("text-amber-400")),t){const m=i.toLowerCase()===ui;t.style.display=m?"block":"none"}a&&(a.textContent=d)}else{const d='<i class="fa-solid fa-plug"></i> Connect Wallet';o.forEach(u=>{u&&(u.innerHTML=d,u.className=Co+" wallet-btn-disconnected")}),r&&(r.textContent="Backcoin.org",r.classList.add("text-amber-400"),r.classList.remove("text-white")),t&&(t.style.display="none"),a&&(a.textContent="--")}const l=Gt||"dashboard";e||!Gt?At(l,!0):ke[l]&&typeof ke[l].update=="function"&&ke[l].update(c.isConnected)}function Uh(e){const{isConnected:t,address:a,isNewConnection:n,wasConnected:s}=e,r=n||t!==s;c.isConnected=t,a&&(c.userAddress=a),vs(r),t&&n?(b(`Connected: ${zu(a)}`,"success"),localStorage.getItem("backchain_referrer")&&Yh()):!t&&s&&b("Wallet disconnected.","info")}function jh(){const e=document.getElementById("testnet-banner"),t=document.getElementById("close-testnet-banner");if(!(!e||!t)){if(localStorage.getItem("hideTestnetBanner")==="true"){e.remove();return}e.style.transform="translateY(0)",t.addEventListener("click",()=>{e.style.transform="translateY(100%)",setTimeout(()=>e.remove(),500),localStorage.setItem("hideTestnetBanner","true")})}}function Wh(){const e=document.querySelectorAll(".sidebar-link"),t=document.getElementById("menu-btn"),a=document.getElementById("sidebar"),n=document.getElementById("sidebar-backdrop"),s=document.getElementById("connectButtonDesktop"),r=document.getElementById("connectButtonMobile"),i=document.getElementById("shareProjectBtn");jh(),e.length>0&&e.forEach(g=>{g.addEventListener("click",async x=>{x.preventDefault();const h=g.dataset.target;if(h==="faucet"){b("Accessing Testnet Faucet...","info"),await dr(null)&&vs(!0);return}h&&(window.location.hash=h,At(h,!0),a&&a.classList.contains("translate-x-0")&&(a.classList.remove("translate-x-0"),a.classList.add("-translate-x-full"),n&&n.classList.add("hidden")))})});const o=()=>{or()};s&&s.addEventListener("click",o),r&&r.addEventListener("click",o),i&&i.addEventListener("click",()=>Vu(c.userAddress)),t&&a&&n&&(t.addEventListener("click",()=>{a.classList.contains("translate-x-0")?(a.classList.add("-translate-x-full"),a.classList.remove("translate-x-0"),n.classList.add("hidden")):(a.classList.remove("-translate-x-full"),a.classList.add("translate-x-0"),n.classList.remove("hidden"))}),n.addEventListener("click",()=>{a.classList.add("-translate-x-full"),a.classList.remove("translate-x-0"),n.classList.add("hidden")})),document.querySelectorAll(".bottom-tab[data-target]").forEach(g=>{g.addEventListener("click",()=>{const x=g.dataset.target;window.location.hash=x,At(x,!0)})});const d=document.getElementById("more-tab-btn"),u=document.getElementById("more-drawer"),p=document.getElementById("more-drawer-backdrop");d&&u&&p&&(d.addEventListener("click",()=>{!u.classList.contains("translate-y-full")?(u.classList.add("translate-y-full"),p.classList.add("hidden")):(u.classList.remove("translate-y-full"),p.classList.remove("hidden"))}),p.addEventListener("click",()=>{u.classList.add("translate-y-full"),p.classList.add("hidden")})),document.querySelectorAll(".more-drawer-item[data-target]").forEach(g=>{g.addEventListener("click",()=>{const x=g.dataset.target;window.location.hash=x,At(x,!0),u&&u.classList.add("translate-y-full"),p&&p.classList.add("hidden")})})}function Nu(){const e=window.location.hash.replace("#","");if(!e)return"dashboard";const t=e.split(/[/?]/)[0];return ke[t]?t:"dashboard"}function $u(){try{const e=window.location.hash,t=e.indexOf("?");if(t===-1)return;const n=new URLSearchParams(e.substring(t)).get("ref");n&&/^0x[a-fA-F0-9]{40}$/.test(n)&&(localStorage.getItem("backchain_referrer")||(localStorage.setItem("backchain_referrer",n),console.log("[Referral] Captured referrer from URL:",n)))}catch(e){console.warn("[Referral] Failed to parse referral param:",e.message)}}function Gh(e){var r,i;const t=`${e.slice(0,6)}...${e.slice(-4)}`;if(!document.getElementById("splash-styles")){const o=document.createElement("style");o.id="splash-styles",o.textContent=`
            @keyframes splash-in { 0% { opacity:0; transform:scale(0.92) translateY(12px); } 100% { opacity:1; transform:scale(1) translateY(0); } }
            @keyframes splash-out { 0% { opacity:1; transform:scale(1); } 100% { opacity:0; transform:scale(0.95) translateY(-8px); } }
            @keyframes quote-line { 0% { width:0; } 100% { width:100%; } }
            @keyframes letter-in { 0% { opacity:0; transform:translateY(6px); } 100% { opacity:1; transform:translateY(0); } }
            .splash-enter { animation: splash-in 0.6s cubic-bezier(0.16,1,0.3,1) forwards; }
            .splash-exit  { animation: splash-out 0.4s ease-in forwards; }
            .quote-line   { animation: quote-line 2s ease-out 0.4s both; }
            .letter-stagger span { display:inline-block; opacity:0; animation: letter-in 0.3s ease-out both; }
        `,document.head.appendChild(o)}const n=[..."Backchain"].map((o,l)=>`<span style="animation-delay:${.6+l*.05}s">${o}</span>`).join(""),s=document.createElement("div");s.id="welcome-splash",s.className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm",s.style.opacity="0",s.style.transition="opacity 0.3s ease",s.innerHTML=`
        <div class="splash-enter text-center px-8 max-w-sm">
            <img src="/assets/bkc_logo_3d.png" alt="" class="h-16 w-16 mx-auto rounded-full mb-5 ring-1 ring-amber-500/30 shadow-lg shadow-amber-500/20">

            <p class="text-3xl font-black text-white tracking-wide letter-stagger mb-1">${n}</p>
            <p class="text-zinc-500 text-[11px] uppercase tracking-[0.25em] mb-5">Unstoppable DeFi</p>

            <div class="relative mb-5">
                <div class="h-px bg-gradient-to-r from-transparent via-amber-500/40 to-transparent quote-line"></div>
                <p class="text-zinc-400 text-sm italic mt-3 leading-relaxed">
                    "I may not agree with what you say, but I will defend to the death your right to say it."
                </p>
                <p class="text-amber-500/70 text-xs font-semibold mt-1.5">â€” Voltaire</p>
                <div class="h-px bg-gradient-to-r from-transparent via-amber-500/40 to-transparent mt-3 quote-line"></div>
            </div>

            <!-- Referral info -->
            <div class="mb-4">
                <p class="text-zinc-500 text-xs mb-1.5">Invited by</p>
                <span class="inline-flex items-center gap-1.5 bg-zinc-800/80 border border-zinc-700/50 rounded-full px-3 py-1">
                    <i class="fa-solid fa-user-plus text-amber-400 text-[10px]"></i>
                    <span class="font-mono text-sm text-amber-400">${t}</span>
                </span>
            </div>

            <div id="referral-overlay-state">
                <button id="referral-overlay-connect" class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl text-base hover:shadow-lg hover:shadow-amber-500/30 transition-all">
                    <i class="fa-solid fa-wallet mr-2"></i>Get Started
                </button>
            </div>

            <button id="referral-overlay-skip" class="mt-3 text-zinc-600 hover:text-zinc-400 text-xs transition-colors">
                Skip for now
            </button>
        </div>
    `,document.body.appendChild(s),requestAnimationFrame(()=>{s.style.opacity="1"}),(r=document.getElementById("referral-overlay-connect"))==null||r.addEventListener("click",()=>{or()}),(i=document.getElementById("referral-overlay-skip"))==null||i.addEventListener("click",()=>{da()})}async function Yh(){var a;const e=localStorage.getItem("backchain_referrer");if(!e||!c.isConnected||!c.userAddress)return;if(e.toLowerCase()===c.userAddress.toLowerCase()){localStorage.removeItem("backchain_referrer");return}const t=document.getElementById("referral-overlay-state");if(t){t.innerHTML=`
            <div class="flex flex-col items-center gap-2 py-2">
                <i class="fa-solid fa-spinner fa-spin text-amber-400 text-xl"></i>
                <p class="text-zinc-400 text-xs">Setting up your account...</p>
            </div>
        `;const n=document.getElementById("referral-overlay-skip");n&&(n.style.display="none")}try{const s=await(await fetch("/api/referral",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAddress:c.userAddress,referrerAddress:e})})).json();if(s.success){if(localStorage.removeItem("backchain_referrer"),t){let r="";s.faucetClaimed&&s.bonusBkc!=="0"&&(r=`<p class="text-amber-400 font-bold mb-1">You received ${s.bonusBkc} BKC!</p>`),r+=s.referrerSet?'<p class="text-zinc-500 text-xs">Referrer set on-chain</p>':'<p class="text-zinc-500 text-xs">Welcome to Backchain!</p>',t.innerHTML=`
                    <div class="flex flex-col items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-check text-emerald-400 text-lg"></i>
                        </div>
                        ${r}
                        <button id="referral-overlay-done" class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl transition-all">
                            Start Exploring
                        </button>
                    </div>
                `,(a=document.getElementById("referral-overlay-done"))==null||a.addEventListener("click",()=>{da(),vs(!0)})}s.faucetClaimed&&b(`Welcome bonus: ${s.bonusBkc} BKC sent to your wallet!`,"success")}else localStorage.removeItem("backchain_referrer"),da(),s.error&&b(s.error,"warning")}catch(n){console.warn("[Referral] API call failed:",n.message),da(),b("Referral setup failed. You can set it manually on the Invite page.","warning")}}window.addEventListener("load",async()=>{console.log("ðŸš€ App Initializing..."),Oe.earn||(Oe.earn=document.getElementById("mine"));try{if(!await So())throw new Error("Failed to load contract addresses")}catch(n){console.error("âŒ Critical Initialization Error:",n),b("Initialization failed. Please refresh.","error");return}Wh(),await Dp(),Op(Uh),$u();const e=localStorage.getItem("backchain_referrer");e&&!c.isConnected?Gh(e):Ju();const t=document.getElementById("initial-loader-container");t&&t.remove();const a=Nu();console.log("ðŸ“ Initial page from URL:",a,"Hash:",window.location.hash),At(a,!0),console.log("âœ… App Ready.")});window.addEventListener("hashchange",()=>{$u();const e=Nu(),t=window.location.hash;console.log("ðŸ”„ Hash changed to:",e,"Full hash:",t),e!==Gt?At(e,!0):e==="charity"&&ke[e]&&typeof ke[e].render=="function"&&ke[e].render(!0)});window.StakingPage=js;window.openConnectModal=or;window.disconnectWallet=Hp;window.updateUIState=vs;
