const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DxBdDQU9.js","assets/index-CYq2X7MJ.js","assets/index-CJlgJZca.css"])))=>i.map(i=>d[i]);
import{t as p,r as E,m as P,_ as b,o as T,p as _}from"./index-CYq2X7MJ.js";import"https://esm.sh/@web3modal/ethers@5.1.11?bundle";import"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";function k(){var r,n,a,s,c,l;const t=((r=T)==null?void 0:r.backchat)||((n=_)==null?void 0:n.backchat)||((a=window.contractAddresses)==null?void 0:a.backchat),e=((s=T)==null?void 0:s.bkcToken)||((c=_)==null?void 0:c.bkcToken)||((l=window.contractAddresses)==null?void 0:l.bkcToken);if(!t)throw new Error("Backchat contract address not loaded");return{BACKCHAT:t,BKC_TOKEN:e}}const B=P;function w(t){return new window.ethers.Contract(k().BACKCHAT,B,t)}async function g(){const{NetworkManager:t}=await b(async()=>{const{NetworkManager:e}=await import("./index-DxBdDQU9.js");return{NetworkManager:e}},__vite__mapDeps([0,1,2]));return new window.ethers.Contract(k().BACKCHAT,B,t.getProvider())}async function O({username:t,displayName:e,bio:r,operator:n,button:a=null,onSuccess:s=null,onError:c=null}){const l=window.ethers;let u=n,o=0n;return await p.execute({name:"CreateProfile",button:a,getContract:async i=>w(i),method:"createProfile",args:()=>[t,e||"",r||"",E(u)],get value(){return o},validate:async(i,h)=>{const f=w(i);if(!await f.isUsernameAvailable(t))throw new Error("Username is already taken");if(!t||t.length<1||t.length>15)throw new Error("Username must be 1-15 characters");if(!/^[a-z0-9_]+$/.test(t))throw new Error("Username can only contain lowercase letters, numbers, and underscores");o=await f.getUsernameFee(t.length),console.log("[Backchat] Username fee:",l.formatEther(o),"ETH");const{NetworkManager:m}=await b(async()=>{const{NetworkManager:C}=await import("./index-DxBdDQU9.js");return{NetworkManager:C}},__vite__mapDeps([0,1,2]));if(await m.getProvider().getBalance(h)<o+l.parseEther("0.001"))throw new Error(`Insufficient ETH. Need ~${l.formatEther(o+l.parseEther("0.001"))} ETH`)},onSuccess:s,onError:c})}async function L({displayName:t,bio:e,button:r=null,onSuccess:n=null,onError:a=null}){return await p.execute({name:"UpdateProfile",button:r,getContract:async s=>w(s),method:"updateProfile",args:[t||"",e||""],validate:async()=>{if(t&&t.length>30)throw new Error("Display name max 30 chars");if(e&&e.length>160)throw new Error("Bio max 160 chars")},onSuccess:n,onError:a})}async function K({content:t,mediaCID:e,operator:r,button:n=null,onSuccess:a=null,onError:s=null}){const c=window.ethers;let l=r,u=0n;return await p.execute({name:"CreatePost",button:n,getContract:async o=>w(o),method:"createPost",args:()=>[t,e||"",E(l)],get value(){return u},validate:async(o,i)=>{if(!t||t.length===0)throw new Error("Content is required");if(t.length>500)throw new Error("Content max 500 chars");u=(await w(o).getCurrentFees()).postFee;const{NetworkManager:d}=await b(async()=>{const{NetworkManager:y}=await import("./index-DxBdDQU9.js");return{NetworkManager:y}},__vite__mapDeps([0,1,2]));if(await d.getProvider().getBalance(i)<u+c.parseEther("0.001"))throw new Error("Insufficient ETH")},onSuccess:async o=>{let i=null;try{const h=new c.Interface(B);for(const f of o.logs)try{const d=h.parseLog(f);if((d==null?void 0:d.name)==="PostCreated"){i=Number(d.args.postId);break}}catch{}}catch{}a&&a(o,i)},onError:s})}async function M({parentId:t,content:e,mediaCID:r,tipBkc:n,operator:a,button:s=null,onSuccess:c=null,onError:l=null}){const u=window.ethers,o=k();let i=a,h=0n;const f=n?BigInt(n):0n;return await p.execute({name:"CreateReply",button:s,getContract:async d=>w(d),method:"createReply",args:()=>[t,e,r||"",E(i),f],get value(){return h},get approval(){return f>0n?{token:o.BKC_TOKEN,spender:o.BACKCHAT,amount:f}:null},validate:async(d,m)=>{if(!e)throw new Error("Content is required");if(e.length>500)throw new Error("Content max 500 chars");const y=w(d);if(await y.postAuthor(t)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");h=(await y.getCurrentFees()).replyFee;const{NetworkManager:x}=await b(async()=>{const{NetworkManager:A}=await import("./index-DxBdDQU9.js");return{NetworkManager:A}},__vite__mapDeps([0,1,2])),v=x.getProvider();if(await v.getBalance(m)<h+u.parseEther("0.001"))throw new Error("Insufficient ETH");if(f>0n&&await new u.Contract(o.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],v).balanceOf(m)<f)throw new Error("Insufficient BKC for tip")},onSuccess:async d=>{let m=null;try{const y=new u.Interface(B);for(const C of d.logs)try{const F=y.parseLog(C);if((F==null?void 0:F.name)==="ReplyCreated"){m=Number(F.args.postId);break}}catch{}}catch{}c&&c(d,m)},onError:l})}async function N({originalPostId:t,tipBkc:e,operator:r,button:n=null,onSuccess:a=null,onError:s=null}){const c=k();let l=r,u=0n;const o=e?BigInt(e):0n;return await p.execute({name:"CreateRepost",button:n,getContract:async i=>w(i),method:"createRepost",args:()=>[t,E(l),o],get value(){return u},get approval(){return o>0n?{token:c.BKC_TOKEN,spender:c.BACKCHAT,amount:o}:null},validate:async(i,h)=>{const f=w(i);if(await f.postAuthor(t)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");u=(await f.getCurrentFees()).repostFee},onSuccess:a,onError:s})}async function R({postId:t,tipBkc:e,operator:r,button:n=null,onSuccess:a=null,onError:s=null}){const c=k();let l=r,u=0n;const o=e?BigInt(e):0n;return await p.execute({name:"Like",button:n,getContract:async i=>w(i),method:"like",args:()=>[t,E(l),o],get value(){return u},get approval(){return o>0n?{token:c.BKC_TOKEN,spender:c.BACKCHAT,amount:o}:null},validate:async(i,h)=>{const f=w(i);if(await f.postAuthor(t)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");if(await f.hasUserLiked(t,h))throw new Error("Already liked this post");u=(await f.getCurrentFees()).likeFee},onSuccess:a,onError:s})}async function I({postId:t,ethAmount:e,tipBkc:r,operator:n,button:a=null,onSuccess:s=null,onError:c=null}){const l=window.ethers,u=k();let o=n;const i=BigInt(e),h=r?BigInt(r):0n;return await p.execute({name:"SuperLike",button:a,getContract:async f=>w(f),method:"superLike",args:()=>[t,E(o),h],value:i,get approval(){return h>0n?{token:u.BKC_TOKEN,spender:u.BACKCHAT,amount:h}:null},validate:async(f,d)=>{const m=w(f);if(await m.postAuthor(t)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");const C=await m.getCurrentFees();if(i<C.superLikeMin)throw new Error(`Minimum super like is ${l.formatEther(C.superLikeMin)} ETH`)},onSuccess:s,onError:c})}async function H({toFollow:t,tipBkc:e,operator:r,button:n=null,onSuccess:a=null,onError:s=null}){const c=k();let l=r,u=0n;const o=e?BigInt(e):0n;return await p.execute({name:"Follow",button:n,getContract:async i=>w(i),method:"follow",args:()=>[t,E(l),o],get value(){return u},get approval(){return o>0n?{token:c.BKC_TOKEN,spender:c.BACKCHAT,amount:o}:null},validate:async(i,h)=>{if(!t||t==="0x0000000000000000000000000000000000000000")throw new Error("Invalid address");if(t.toLowerCase()===h.toLowerCase())throw new Error("Cannot follow yourself");u=(await w(i).getCurrentFees()).followFee},onSuccess:a,onError:s})}async function U({toUnfollow:t,button:e=null,onSuccess:r=null,onError:n=null}){return await p.execute({name:"Unfollow",button:e,getContract:async a=>w(a),method:"unfollow",args:[t],onSuccess:r,onError:n})}async function D({ethAmount:t,operator:e,button:r=null,onSuccess:n=null,onError:a=null}){const s=window.ethers;let c=e;const l=BigInt(t);return await p.execute({name:"BoostProfile",button:r,getContract:async u=>w(u),method:"boostProfile",args:()=>[E(c)],value:l,validate:async u=>{const i=await w(u).getCurrentFees();if(l<i.boostMin)throw new Error(`Minimum boost is ${s.formatEther(i.boostMin)} ETH`)},onSuccess:n,onError:a})}async function V({operator:t,button:e=null,onSuccess:r=null,onError:n=null}){let a=t,s=0n;return await p.execute({name:"ObtainBadge",button:e,getContract:async c=>w(c),method:"obtainBadge",args:()=>[E(a)],get value(){return s},validate:async c=>{s=(await w(c).getCurrentFees()).badgeFee_},onSuccess:r,onError:n})}async function S({button:t=null,onSuccess:e=null,onError:r=null}){const n=window.ethers;return await p.execute({name:"Withdraw",button:t,getContract:async a=>w(a),method:"withdraw",args:[],validate:async(a,s)=>{const l=await w(a).getPendingBalance(s);if(l===0n)throw new Error("Nothing to withdraw");console.log("[Backchat] Withdrawing:",n.formatEther(l),"ETH")},onSuccess:e,onError:r})}async function $({referrer:t,button:e=null,onSuccess:r=null,onError:n=null}){return await p.execute({name:"SetReferrer",button:e,getContract:async a=>w(a),method:"setReferrer",args:[t],validate:async(a,s)=>{if(!t||t==="0x0000000000000000000000000000000000000000")throw new Error("Invalid referrer address");if(t.toLowerCase()===s.toLowerCase())throw new Error("Cannot refer yourself");if(await w(a).referredBy(s)!=="0x0000000000000000000000000000000000000000")throw new Error("Referrer already set (immutable)")},onSuccess:r,onError:n})}async function q(t){const e=window.ethers,n=await(await g()).getReferralStats(t);return{totalReferred:Number(n.totalReferred),totalEarned:n.totalEarned,totalEarnedFormatted:e.formatEther(n.totalEarned)}}async function W(t){return await(await g()).referredBy(t)}async function z(){const t=window.ethers,r=await(await g()).getCurrentFees();return{postFee:r.postFee,postFeeFormatted:t.formatEther(r.postFee),replyFee:r.replyFee,replyFeeFormatted:t.formatEther(r.replyFee),likeFee:r.likeFee,likeFeeFormatted:t.formatEther(r.likeFee),followFee:r.followFee,followFeeFormatted:t.formatEther(r.followFee),repostFee:r.repostFee,repostFeeFormatted:t.formatEther(r.repostFee),superLikeMin:r.superLikeMin,superLikeMinFormatted:t.formatEther(r.superLikeMin),boostMin:r.boostMin,boostMinFormatted:t.formatEther(r.boostMin),badgeFee:r.badgeFee_,badgeFeeFormatted:t.formatEther(r.badgeFee_)}}async function j(t){const e=window.ethers,n=await(await g()).getUsernameFee(t);return{fee:n,formatted:e.formatEther(n)}}async function G(t){return await(await g()).postAuthor(t)}async function J(){const t=await g();return Number(await t.postCounter())}async function Q(t){const e=window.ethers,n=await(await g()).getPendingBalance(t);return{balance:n,formatted:e.formatEther(n)}}async function X(t){return await(await g()).isUsernameAvailable(t)}async function Y(t){return await(await g()).getUsernameOwner(t)}async function Z(t,e){return await(await g()).hasUserLiked(t,e)}async function tt(t){return await(await g()).isProfileBoosted(t)}async function et(t){return await(await g()).hasTrustBadge(t)}async function rt(t){const e=await g();return Number(await e.boostExpiry(t))}async function nt(t){const e=await g();return Number(await e.badgeExpiry(t))}async function at(){return await(await g()).version()}const ft={createProfile:O,updateProfile:L,createPost:K,createReply:M,createRepost:N,like:R,superLike:I,follow:H,unfollow:U,boostProfile:D,obtainBadge:V,withdraw:S,setReferrer:$,getReferralStats:q,getReferredBy:W,getCurrentFees:z,getUsernameFee:j,getPostAuthor:G,getPostCount:J,getPendingBalance:Q,isUsernameAvailable:X,getUsernameOwner:Y,hasUserLiked:Z,isProfileBoosted:tt,hasTrustBadge:et,getBoostExpiry:rt,getBadgeExpiry:nt,getVersion:at};export{ft as BackchatTx,D as boostProfile,K as createPost,O as createProfile,M as createReply,N as createRepost,ft as default,H as follow,nt as getBadgeExpiry,rt as getBoostExpiry,z as getCurrentFees,Q as getPendingBalance,G as getPostAuthor,J as getPostCount,q as getReferralStats,W as getReferredBy,j as getUsernameFee,Y as getUsernameOwner,at as getVersion,et as hasTrustBadge,Z as hasUserLiked,tt as isProfileBoosted,X as isUsernameAvailable,R as like,V as obtainBadge,$ as setReferrer,I as superLike,U as unfollow,L as updateProfile,S as withdraw};
