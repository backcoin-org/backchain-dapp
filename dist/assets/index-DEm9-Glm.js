import{defaultConfig as Wm,createWeb3Modal as Gm}from"https://esm.sh/@web3modal/ethers@5.1.11?bundle";import{initializeApp as Km}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getAuth as Vm,onAuthStateChanged as Ym,signInAnonymously as qm}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import{getFirestore as Xm,doc as Z,getDoc as we,updateDoc as Sa,serverTimestamp as Be,setDoc as Bn,increment as Ne,collection as Ie,query as Fe,orderBy as Oa,limit as Jm,getDocs as xt,where as Le,writeBatch as An,Timestamp as El,addDoc as ha,deleteDoc as Vc,onSnapshot as xa}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();const ht={sidebar:document.getElementById("sidebar"),sidebarBackdrop:document.getElementById("sidebar-backdrop"),menuBtn:document.getElementById("menu-btn"),navLinks:document.getElementById("nav-links"),mainContentSections:document.querySelectorAll("main section"),connectButtonDesktop:document.getElementById("connectButtonDesktop"),connectButtonMobile:document.getElementById("connectButtonMobile"),mobileAppDisplay:document.getElementById("mobileAppDisplay"),desktopDisconnected:document.getElementById("desktopDisconnected"),desktopConnectedInfo:document.getElementById("desktopConnectedInfo"),desktopUserAddress:document.getElementById("desktopUserAddress"),desktopUserBalance:document.getElementById("desktopUserBalance"),modalContainer:document.getElementById("modal-container"),toastContainer:document.getElementById("toast-container"),dashboard:document.getElementById("dashboard"),earn:document.getElementById("staking"),store:document.getElementById("store"),rental:document.getElementById("rental"),rewards:document.getElementById("rewards"),actions:document.getElementById("fortune"),presale:document.getElementById("presale"),faucet:document.getElementById("faucet"),airdrop:document.getElementById("airdrop"),dao:document.getElementById("dao"),about:document.getElementById("about"),admin:document.getElementById("admin"),tokenomics:document.getElementById("tokenomics"),notary:document.getElementById("notary"),statTotalSupply:document.getElementById("statTotalSupply"),statValidators:document.getElementById("statValidators"),statTotalPStake:document.getElementById("statTotalPStake"),statScarcity:document.getElementById("statScarcity"),statLockedPercentage:document.getElementById("statLockedPercentage"),statUserBalance:document.getElementById("statUserBalance"),statUserPStake:document.getElementById("statUserPStake"),statUserRewards:document.getElementById("statUserRewards")},Zm={provider:null,publicProvider:null,web3Provider:null,signer:null,userAddress:null,isConnected:!1,bkcTokenContract:null,ecosystemManagerContract:null,stakingPoolContract:null,buybackMinerContract:null,rewardBoosterContract:null,fortunePoolContract:null,agoraContract:null,notaryContract:null,charityPoolContract:null,rentalManagerContract:null,faucetContract:null,liquidityPoolContract:null,governanceContract:null,bkcTokenContractPublic:null,ecosystemManagerContractPublic:null,stakingPoolContractPublic:null,buybackMinerContractPublic:null,fortunePoolContractPublic:null,agoraContractPublic:null,notaryContractPublic:null,charityPoolContractPublic:null,rentalManagerContractPublic:null,faucetContractPublic:null,currentUserBalance:0n,currentUserNativeBalance:0n,userTotalPStake:0n,userDelegations:[],myBoosters:[],activityHistory:[],totalNetworkPStake:0n,allValidatorsData:[],systemFees:{},systemPStakes:{},boosterDiscounts:{},notaryFee:void 0,notaryMinPStake:void 0},Qm={set(e,t,a){const n=e[t];if(e[t]=a,["currentUserBalance","isConnected","userTotalPStake","totalNetworkPStake"].includes(t)){if(n===a)return!0;window.updateUIState&&window.updateUIState()}return!0}},u=new Proxy(Zm,Qm),eb="modulepreload",tb=function(e){return"/"+e},Tl={},U=function(t,a,n){let o=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(a.map(l=>{if(l=tb(l),l in Tl)return;Tl[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":eb,c||(f.as="script"),f.crossOrigin="",f.href=l,r&&f.setAttribute("nonce",r),document.head.appendChild(f),c)return new Promise((g,m)=>{f.addEventListener("load",g),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(i){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=i,window.dispatchEvent(r),!r.defaultPrevented)throw i}return o.then(i=>{for(const r of i||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})},x=(e,t="info",a=null)=>{if(!ht.toastContainer)return;const n={success:{icon:"fa-check-circle",color:"bg-green-600",border:"border-green-400"},error:{icon:"fa-exclamation-triangle",color:"bg-red-600",border:"border-red-400"},info:{icon:"fa-info-circle",color:"bg-blue-600",border:"border-blue-400"},warning:{icon:"fa-exclamation-circle",color:"bg-yellow-600",border:"border-yellow-400"}},o=n[t]||n.info,s=document.createElement("div");s.className=`flex items-center w-full max-w-xs p-4 text-white rounded-lg shadow-lg transition-all duration-500 ease-out 
                       transform translate-x-full opacity-0 
                       ${o.color} border-l-4 ${o.border} mb-3`;let i=`
        <div class="flex items-center flex-1">
            <i class="fa-solid ${o.icon} text-xl mr-3"></i>
            <div class="text-sm font-medium leading-tight">${e}</div>
        </div>
    `;if(a){const r=`https://sepolia.etherscan.io/tx/${a}`;i+=`<a href="${r}" target="_blank" title="View on Explorer" class="ml-3 flex-shrink-0 text-white/80 hover:text-white transition-colors">
                        <i class="fa-solid fa-arrow-up-right-from-square text-sm"></i>
                      </a>`}i+=`<button class="ml-3 text-white/80 hover:text-white transition-colors focus:outline-none" onclick="this.closest('.shadow-lg').remove()">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>`,s.innerHTML=i,ht.toastContainer.appendChild(s),requestAnimationFrame(()=>{s.classList.remove("translate-x-full","opacity-0"),s.classList.add("translate-x-0","opacity-100")}),setTimeout(()=>{s.classList.remove("translate-x-0","opacity-100"),s.classList.add("translate-x-full","opacity-0"),setTimeout(()=>s.remove(),500)},5e3)},yt=()=>{if(!ht.modalContainer)return;const e=document.getElementById("modal-backdrop");if(e){const t=document.getElementById("modal-content");t&&(t.classList.remove("animate-fade-in-up"),t.classList.add("animate-fade-out-down")),e.classList.remove("opacity-100"),e.classList.add("opacity-0"),setTimeout(()=>{ht.modalContainer.innerHTML=""},300)}},Vo=(e,t="max-w-md",a=!0)=>{var s,i;if(!ht.modalContainer)return;const o=`
        <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 transition-opacity duration-300 opacity-0">
            <div id="modal-content" class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 w-full ${t} shadow-2xl animate-fade-in-up max-h-[90vh] overflow-y-auto relative">
                <button class="closeModalBtn absolute top-4 right-4 text-zinc-500 hover:text-white text-xl transition-colors focus:outline-none"><i class="fa-solid fa-xmark"></i></button>
                ${e}
            </div>
        </div>
        <style>@keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }@keyframes fade-out-down { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }.animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }.animate-fade-out-down { animation: fade-out-down 0.3s ease-in forwards; }.pulse-gold { animation: pulse-gold 2s infinite; }@keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); } 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); } }@keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }.animate-glow { animation: glow 2s ease-in-out infinite; }@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }.animate-float { animation: float 3s ease-in-out infinite; }@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }.animate-shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }</style>
    `;ht.modalContainer.innerHTML=o,requestAnimationFrame(()=>{const r=document.getElementById("modal-backdrop");r&&r.classList.remove("opacity-0"),r&&r.classList.add("opacity-100")}),(s=document.getElementById("modal-backdrop"))==null||s.addEventListener("click",r=>{a&&r.target.id==="modal-backdrop"&&yt()}),(i=document.getElementById("modal-content"))==null||i.querySelectorAll(".closeModalBtn").forEach(r=>{r.addEventListener("click",yt)})};async function Yc(e,t){if(!window.ethereum){x("MetaMask not detected","error");return}try{const{addresses:a}=await U(async()=>{const{addresses:s}=await Promise.resolve().then(()=>ld);return{addresses:s}},void 0),n=(a==null?void 0:a.rewardBooster)||"0x5507F70c71b8e1C694841E214fe8F9Dd7c899448";await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:n,tokenId:e.toString()}}})?x(`${t} NFT #${e} added to wallet!`,"success"):x("NFT not added to wallet","info")}catch(a){console.error("Error adding NFT to wallet:",a),x("Failed to add NFT to wallet","error")}}function ab(e){const t=window.location.origin,a=!!e,n=a?`${t}/#dashboard?ref=${e}`:t,o=a?`${e.slice(0,6)}...${e.slice(-4)}`:"",s=encodeURIComponent(a?"Join Backchain â€” I'll be your tutor! Stake BKC, earn rewards, and I'll earn too. Use my invite link:":"Check out Backchain â€” Unstoppable DeFi on opBNB. Stake, trade NFTs, play Fortune Pool & more!"),i=`
        <div class="text-center py-2">
            <div class="mb-4">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-full mb-3">
                    <i class="fa-solid fa-graduation-cap text-3xl text-amber-400"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">${a?"Invite & Earn":"Share Backchain"}</h2>
                <p class="text-zinc-400 text-sm">${a?'Share your tutor link â€” earn <strong class="text-amber-400">10% ETH</strong> + <strong class="text-amber-400">5% BKC</strong> from every friend':"Connect your wallet to get a personal tutor link and earn commissions!"}</p>
            </div>

            ${a?`
            <!-- Tutor Reward Badges -->
            <div class="flex justify-center gap-2 mb-4">
                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-[10px] font-bold bg-amber-500/15 text-amber-400 border border-amber-500/30">
                    <i class="fa-solid fa-coins"></i> 10% ETH Fees
                </span>
                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-[10px] font-bold bg-purple-500/15 text-purple-400 border border-purple-500/30">
                    <i class="fa-solid fa-gem"></i> 5% BKC Claims
                </span>
                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-[10px] font-bold bg-emerald-500/15 text-emerald-400 border border-emerald-500/30">
                    <i class="fa-solid fa-infinity"></i> Forever
                </span>
            </div>
            `:`
            <div class="mb-4 p-3 bg-amber-500/10 border border-amber-500/20 rounded-xl">
                <p class="text-amber-400 text-xs"><i class="fa-solid fa-lightbulb mr-1"></i> Connect your wallet to generate a personal invite link with your tutor referral built in!</p>
            </div>
            `}

            <!-- Social Share Grid -->
            <div class="grid grid-cols-4 gap-3 mb-5">
                <a href="https://twitter.com/intent/tweet?text=${s}&url=${encodeURIComponent(n)}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-sky-600 border border-zinc-700 hover:border-sky-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-x-twitter text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">Twitter</span>
                </a>
                <a href="https://t.me/share/url?url=${encodeURIComponent(n)}&text=${s}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-blue-600 border border-zinc-700 hover:border-blue-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-telegram text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">Telegram</span>
                </a>
                <a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(n)}&title=Backchain%20Protocol&summary=${s}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-blue-700 border border-zinc-700 hover:border-blue-600 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-linkedin-in text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">LinkedIn</span>
                </a>
                <a href="https://wa.me/?text=${s}%20${encodeURIComponent(n)}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-green-600 border border-zinc-700 hover:border-green-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-whatsapp text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">WhatsApp</span>
                </a>
            </div>

            <!-- Copy Link Section -->
            <div class="flex items-center gap-2 bg-zinc-800/70 border border-zinc-700 rounded-xl p-2">
                <div class="flex-1 px-3 py-2 bg-black/30 rounded-lg overflow-hidden">
                    <p id="share-url-text" class="text-xs font-mono text-zinc-400 truncate">${n}</p>
                </div>
                <button id="copy-link-btn" onclick="navigator.clipboard.writeText('${n}').then(() => {
                            document.getElementById('copy-link-btn').innerHTML = '<i class=\\'fa-solid fa-check\\'></i>';
                            document.getElementById('copy-link-btn').classList.add('bg-green-600', 'border-green-500');
                            document.getElementById('copy-link-btn').classList.remove('bg-amber-600', 'border-amber-500', 'hover:bg-amber-500');
                            setTimeout(() => {
                                document.getElementById('copy-link-btn').innerHTML = '<i class=\\'fa-solid fa-copy\\'></i>';
                                document.getElementById('copy-link-btn').classList.remove('bg-green-600', 'border-green-500');
                                document.getElementById('copy-link-btn').classList.add('bg-amber-600', 'border-amber-500', 'hover:bg-amber-500');
                            }, 2000);
                        })"
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-amber-600 hover:bg-amber-500 border border-amber-500 rounded-lg text-white transition-all duration-300">
                    <i class="fa-solid fa-copy"></i>
                </button>
            </div>

            ${a?`
            <p class="mt-3 text-[11px] text-zinc-500">
                <i class="fa-solid fa-link text-amber-400/60 mr-1"></i>
                Your tutor address <span class="font-mono text-zinc-400">${o}</span> is embedded in this link
            </p>
            `:""}

            <!-- Footer -->
            <p class="mt-3 text-[11px] text-zinc-600">
                <i class="fa-solid fa-circle-info mr-1"></i>
                ${a?"Friends who join via your link automatically set you as their tutor":"Share now â€” every new user strengthens the ecosystem"}
            </p>
        </div>
    `;Vo(i,"max-w-md")}function Cl(e="welcome-splash"){const t=document.getElementById(e);if(!t||t._dismissed)return;t._dismissed=!0;const a=t.querySelector(".splash-enter,.splash-content");a&&(a.classList.remove("splash-enter"),a.classList.add("splash-exit")),t.style.opacity="0",setTimeout(()=>t.remove(),500)}const nb=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";console.log(`Environment: ${nb?"DEVELOPMENT":"PRODUCTION"}`);const Ke={chainId:"0xaa36a7",chainIdDecimal:11155111,chainName:"Sepolia",nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io"],rpcUrls:["https://ethereum-sepolia-rpc.publicnode.com","https://rpc.sepolia.org"]},ea=[{name:"PublicNode",url:"https://ethereum-sepolia-rpc.publicnode.com",priority:1,isPublic:!0,corsCompatible:!0},{name:"Sepolia Official",url:"https://rpc.sepolia.org",priority:2,isPublic:!0,corsCompatible:!0}],Yi="https://ethereum-sepolia-rpc.publicnode.com";let Ct=0,ao=new Map;function yn(){var e;return((e=ea[Ct])==null?void 0:e.url)||Yi}function qi(){const e=Ct;do{Ct=(Ct+1)%ea.length;const a=ea[Ct];if(!a.corsCompatible){console.warn(`â­ï¸ Skipping ${a.name} (CORS incompatible)`);continue}if(Ct===e)return console.warn("âš ï¸ All RPCs have been tried. Resetting to primary."),Ct=0,ea[0].url}while(ao.get(ea[Ct].url)==="unhealthy");const t=ea[Ct];return console.log(`ðŸ”„ Switched to RPC: ${t.name}`),t.url}function qc(e){ao.set(e,"unhealthy"),console.warn(`âŒ RPC marked unhealthy: ${e}`),setTimeout(()=>{ao.delete(e),console.log(`â™»ï¸ RPC health reset: ${e}`)},6e4)}function Xc(e){ao.set(e,"healthy")}function Jc(){Ct=0,ao.clear(),console.log(`âœ… Reset to primary RPC: ${ea[0].name}`)}const E={},R={bkcToken:null,backchainEcosystem:null,stakingPool:null,buybackMiner:null,rewardBooster:null,nftPoolFactory:null,fortunePool:null,agora:null,notary:null,charityPool:null,rentalManager:null,liquidityPool:null,faucet:null,backchainGovernance:null,treasuryWallet:null};async function Zc(){try{const e=await fetch(`./deployment-addresses.json?t=${Date.now()}`);if(!e.ok)throw new Error(`Failed to fetch deployment-addresses.json: ${e.status}`);const t=await e.json(),a=["bkcToken","backchainEcosystem","stakingPool","buybackMiner"];if(!a.every(o=>t[o]||t[Bl(o)])){const o=a.filter(s=>!t[s]&&!t[Bl(s)]);throw new Error(`Missing required addresses: ${o.join(", ")}`)}return E.bkcToken=t.bkcToken,E.backchainEcosystem=t.backchainEcosystem||t.ecosystemManager,E.stakingPool=t.stakingPool||t.delegationManager,E.buybackMiner=t.buybackMiner||t.miningManager,E.rewardBooster=t.rewardBooster||t.rewardBoosterNFT,E.nftPoolFactory=t.nftPoolFactory||t.nftLiquidityPoolFactory,E.fortunePool=t.fortunePool||t.fortunePoolV2,E.agora=t.agora||t.backchat,E.notary=t.notary||t.decentralizedNotary,E.charityPool=t.charityPool,E.rentalManager=t.rentalManager,E.liquidityPool=t.liquidityPool,E.faucet=t.faucet||t.simpleBkcFaucet,E.backchainGovernance=t.backchainGovernance,E.nftFusion=t.nftFusion,E.airdropClaim=t.airdropClaim,E.treasuryWallet=t.treasuryWallet,E.pool_bronze=t.pool_bronze,Object.assign(R,E),console.log("âœ… V9 contract addresses loaded"),console.log("   Ecosystem:",E.backchainEcosystem),console.log("   StakingPool:",E.stakingPool),console.log("   Agora:",E.agora),console.log("   FortunePool:",E.fortunePool),!0}catch(e){return console.error("âŒ Failed to load contract addresses:",e),!1}}function Bl(e){return{backchainEcosystem:"ecosystemManager",stakingPool:"delegationManager",buybackMiner:"miningManager",rewardBooster:"rewardBoosterNFT",nftPoolFactory:"nftLiquidityPoolFactory",agora:"backchat",notary:"decentralizedNotary"}[e]||e}const st=[{name:"Diamond",boostBips:5e3,recycleRate:0,keepRate:100,color:"text-cyan-400",emoji:"ðŸ’Ž",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq",borderColor:"border-cyan-400/50",glowColor:"bg-cyan-500/10",bgGradient:"from-cyan-500/20 to-blue-500/20"},{name:"Gold",boostBips:4e3,recycleRate:10,keepRate:90,color:"text-amber-400",emoji:"ðŸ¥‡",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44",borderColor:"border-amber-400/50",glowColor:"bg-amber-500/10",bgGradient:"from-amber-500/20 to-yellow-500/20"},{name:"Silver",boostBips:2500,recycleRate:20,keepRate:80,color:"text-gray-300",emoji:"ðŸ¥ˆ",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4",borderColor:"border-gray-400/50",glowColor:"bg-gray-500/10",bgGradient:"from-gray-400/20 to-zinc-500/20"},{name:"Bronze",boostBips:1e3,recycleRate:30,keepRate:70,color:"text-yellow-600",emoji:"ðŸ¥‰",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m",borderColor:"border-yellow-600/50",glowColor:"bg-yellow-600/10",bgGradient:"from-yellow-600/20 to-orange-600/20"}];function Qc(e){const t=[...st].sort((a,n)=>n.boostBips-a.boostBips);for(const a of t)if(e>=a.boostBips)return a;return null}function ed(e){return e>=5e3?0:e>=4e3?10:e>=2500?20:e>=1e3?30:50}function po(e){return 100-ed(e)}const cs=["function name() view returns (string)","function symbol() view returns (string)","function decimals() view returns (uint8)","function totalSupply() view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function transferFrom(address from, address to, uint256 amount) returns (bool)","function MAX_SUPPLY() view returns (uint256)","function TGE_SUPPLY() view returns (uint256)","function totalBurned() view returns (uint256)","function mintableRemaining() view returns (uint256)","function totalMinted() view returns (uint256)","event Transfer(address indexed from, address indexed to, uint256 value)","event Approval(address indexed owner, address indexed spender, uint256 value)"],ds=["function totalPStake() view returns (uint256)","function totalBkcDelegated() view returns (uint256)","function userTotalPStake(address _user) view returns (uint256)","function pendingRewards(address _user) view returns (uint256)","function savedRewards(address _user) view returns (uint256)","function MIN_LOCK_DAYS() view returns (uint256)","function MAX_LOCK_DAYS() view returns (uint256)","function TUTOR_BPS() view returns (uint256)","function NO_TUTOR_BURN_BPS() view returns (uint256)","function TUTOR_PENALTY_BPS() view returns (uint256)","function NO_TUTOR_BURN_PENALTY_BPS() view returns (uint256)","function forceUnstakeEthFee() view returns (uint256)","function getDelegationsOf(address _user) view returns (tuple(uint128 amount, uint128 pStake, uint64 lockEnd, uint64 lockDays, uint256 rewardDebt)[])","function getDelegation(address _user, uint256 _index) view returns (uint256 amount, uint256 pStake, uint256 lockEnd, uint256 lockDays, uint256 pendingReward)","function delegationCount(address _user) view returns (uint256)","function delegate(uint256 _amount, uint256 _lockDays, address _operator) external payable","function unstake(uint256 _index) external","function forceUnstake(uint256 _index, address _operator) external payable","function claimRewards(address _operator) external payable","function claimRewards() external","function getUserBestBoost(address _user) view returns (uint256)","function getRecycleRateForBoost(uint256 _boostBps) pure returns (uint256)","function getTierName(uint256 _boostBps) pure returns (string)","function previewClaim(address _user) view returns (uint256 totalRewards, uint256 recycleAmount, uint256 burnAmount, uint256 tutorCut, uint256 userReceives, uint256 recycleRateBps, uint256 nftBoost)","function previewForceUnstake(address _user, uint256 _index) view returns (uint256 stakedAmount, uint256 totalPenalty, uint256 recycleAmount, uint256 burnAmount, uint256 tutorCut, uint256 userReceives, uint256 penaltyRateBps, uint256 nftBoost, uint256 ethFeeRequired)","function getStakingStats() view returns (uint256 totalPStake, uint256 totalBkcDelegated, uint256 totalRewardsDistributed, uint256 totalBurnedOnClaim, uint256 totalRecycledOnClaim, uint256 totalForceUnstakePenalties, uint256 totalTutorPayments, uint256 totalEthFeesCollected, uint256 accRewardPerShare)","function getUserSummary(address _user) view returns (uint256 userTotalPStake, uint256 delegationCount, uint256 savedRewards, uint256 totalPending, uint256 nftBoost, uint256 recycleRateBps)","event Delegated(address indexed user, uint256 indexed delegationIndex, uint256 amount, uint256 pStake, uint256 lockDays, address operator)","event Unstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned)","event ForceUnstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned, uint256 totalPenalty, uint256 recycledAmount, uint256 burnedAmount, uint256 tutorAmount, address tutor, address operator)","event RewardsClaimed(address indexed user, uint256 totalRewards, uint256 recycledAmount, uint256 burnedAmount, uint256 tutorAmount, uint256 userReceived, uint256 nftBoostUsed, address tutor, address operator)"],In=["function listNFT(uint256 tokenId, uint96 pricePerDay) external","function updateListing(uint256 tokenId, uint96 pricePerDay) external","function withdrawNFT(uint256 tokenId) external","function rentNFT(uint256 tokenId, address operator) external payable","function withdrawEarnings() external","function boostListing(uint256 tokenId, uint256 days_, address operator) external payable","function getListing(uint256 tokenId) view returns (address owner, uint96 pricePerDay, uint96 totalEarnings, uint32 rentalCount, bool currentlyRented, uint48 rentalEndTime, bool isBoosted, uint32 boostExpiry)","function getRental(uint256 tokenId) view returns (address tenant, uint48 endTime, bool isActive)","function isRented(uint256 tokenId) view returns (bool)","function getRemainingTime(uint256 tokenId) view returns (uint256)","function hasActiveRental(address user) view returns (bool)","function getUserBestBoost(address user) view returns (uint256)","function pendingEarnings(address owner) view returns (uint256)","function userActiveRental(address user) view returns (uint256)","function isAvailable(uint256 tokenId) view returns (bool)","function getAllListedTokenIds() view returns (uint256[])","function getListingCount() view returns (uint256)","function getAvailableListings() view returns (uint256[] tokenIds, bool[] boosted)","function getRentalCost(uint256 tokenId) view returns (uint256 rentalCost, uint256 ethFee, uint256 totalCost)","function getStats() view returns (uint256 activeListings, uint256 volume, uint256 rentals, uint256 ethFees, uint256 earningsWithdrawn, uint256 boostRevenue)","event NFTListed(uint256 indexed tokenId, address indexed owner, uint96 pricePerDay)","event ListingUpdated(uint256 indexed tokenId, uint96 pricePerDay)","event NFTRented(uint256 indexed tokenId, address indexed tenant, address indexed owner, uint256 rentalCost, uint256 ethFee, uint48 endTime, address operator)","event ListingBoosted(uint256 indexed tokenId, address indexed owner, uint256 days_, uint256 boostCost, uint32 newBoostExpiry)","event NFTWithdrawn(uint256 indexed tokenId, address indexed owner)","event EarningsWithdrawn(address indexed owner, uint256 amount)"],td=["function buyNFT(uint256 maxBkcPrice, address operator) external payable returns (uint256 tokenId)","function buySpecificNFT(uint256 tokenId, uint256 maxBkcPrice, address operator) external payable","function sellNFT(uint256 tokenId, uint256 minPayout, address operator) external payable","function getBuyPrice() view returns (uint256)","function getSellPrice() view returns (uint256)","function getTotalBuyCost() view returns (uint256 bkcCost, uint256 ethCost)","function getTotalSellInfo() view returns (uint256 bkcPayout, uint256 ethCost)","function getEthFees() view returns (uint256 buyFee, uint256 sellFee)","function getSpread() view returns (uint256 spread, uint256 spreadBips)","function getPoolInfo() view returns (uint256 bkcBalance, uint256 nftCount, uint256 effectiveNftCount, uint256 virtualReserves, uint256 mintableReserves, uint256 k, bool initialized, uint8 tier)","function getAvailableNFTs() view returns (uint256[])","function isNFTInPool(uint256 tokenId) view returns (bool)","function bkcBalance() view returns (uint256)","function nftCount() view returns (uint256)","function mintableReserves() view returns (uint256)","function tier() view returns (uint8)","function initialized() view returns (bool)","function getTierName() view returns (string)","function getStats() view returns (uint256 volume, uint256 buys, uint256 sells, uint256 ethFees)","function totalVolume() view returns (uint256)","function totalBuys() view returns (uint256)","function totalSells() view returns (uint256)","function totalEthFees() view returns (uint256)","event NFTPurchased(address indexed buyer, uint256 indexed tokenId, uint256 price, uint256 ethFee, uint256 newNftCount, address operator)","event NFTSold(address indexed seller, uint256 indexed tokenId, uint256 payout, uint256 ethFee, uint256 newNftCount, address operator)"],us=["function commitPlay(bytes32 _commitHash, uint256 _wagerAmount, uint8 _tierMask, address _operator) external payable returns (uint256 gameId)","function revealPlay(uint256 _gameId, uint256[] calldata _guesses, bytes32 _userSecret) external returns (uint256 prizeWon)","function claimExpired(uint256 _gameId) external","function fundPrizePool(uint256 _amount) external","function generateCommitHash(uint256[] calldata _guesses, bytes32 _userSecret) pure returns (bytes32)","function TIER_COUNT() view returns (uint8)","function BKC_FEE_BPS() view returns (uint256)","function MAX_PAYOUT_BPS() view returns (uint256)","function revealDelay() view returns (uint256)","function REVEAL_WINDOW() view returns (uint256)","function POOL_CAP() view returns (uint256)","function getTierInfo(uint8 _tier) pure returns (uint256 range, uint256 multiplier, uint256 winChanceBps)","function getAllTiers() pure returns (uint256[3] ranges, uint256[3] multipliers, uint256[3] winChances)","function getGame(uint256 _gameId) view returns (address player, uint48 commitBlock, uint8 tierMask, uint8 status, address operator, uint96 wagerAmount)","function getGameResult(uint256 _gameId) view returns (address player, uint128 grossWager, uint128 prizeWon, uint8 tierMask, uint8 matchCount, uint48 revealBlock)","function getGameStatus(uint256 _gameId) view returns (uint8 status, bool canReveal, uint256 blocksUntilReveal, uint256 blocksUntilExpiry)","function activeGame(address _player) view returns (uint256)","function getRequiredFee(uint8 _tierMask) view returns (uint256 fee)","function calculatePotentialWinnings(uint256 _wagerAmount, uint8 _tierMask) view returns (uint256 netToPool, uint256 bkcFee, uint256 maxPrize, uint256 maxPrizeAfterCap)","function gameCounter() view returns (uint256)","function prizePool() view returns (uint256)","function getPoolStats() view returns (uint256 prizePool, uint256 totalGamesPlayed, uint256 totalBkcWagered, uint256 totalBkcWon, uint256 totalBkcForfeited, uint256 totalBkcBurned, uint256 maxPayoutNow)","event GameCommitted(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint8 tierMask, address operator)","event GameRevealed(uint256 indexed gameId, address indexed player, uint256 grossWager, uint256 prizeWon, uint8 tierMask, uint8 matchCount, address operator)","event GameDetails(uint256 indexed gameId, uint8 tierMask, uint256[] guesses, uint256[] rolls, bool[] matches)","event GameExpired(uint256 indexed gameId, address indexed player, uint256 forfeitedAmount)","event PrizePoolFunded(address indexed funder, uint256 amount)","event PoolExcessBurned(uint256 amount, uint256 newTotalBurned)"],ad=["function balanceOf(address _owner) view returns (uint256)","function ownerOf(uint256 _tokenId) view returns (address)","function approve(address _to, uint256 _tokenId) external","function setApprovalForAll(address _operator, bool _approved) external","function transferFrom(address _from, address _to, uint256 _tokenId) external","function safeTransferFrom(address _from, address _to, uint256 _tokenId) external","function totalSupply() view returns (uint256)","function getUserBestBoost(address _user) view returns (uint256)","function getTokenInfo(uint256 _tokenId) view returns (address owner, uint8 tier, uint256 boostBips)","function getUserTokens(address _user) view returns (uint256[] tokenIds, uint8[] tiers)","function getTierBoost(uint8 _tier) pure returns (uint256)","function getTierName(uint8 _tier) pure returns (string)","event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)","event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId)"],ps=["function certify(bytes32 _documentHash, string _meta, uint8 _docType, address _operator) external payable returns (uint256 certId)","function batchCertify(bytes32[] _documentHashes, string[] _metas, uint8[] _docTypes, address _operator) external payable returns (uint256 startId)","function transferCertificate(bytes32 _documentHash, address _newOwner) external","function verify(bytes32 _documentHash) view returns (bool exists, address owner, uint48 timestamp, uint8 docType, string meta)","function getCertificate(uint256 _certId) view returns (bytes32 documentHash, address owner, uint48 timestamp, uint8 docType, string meta)","function getFee() view returns (uint256)","function getStats() view returns (uint256 certCount, uint256 totalEthCollected)","function certCount() view returns (uint256)","function totalEthCollected() view returns (uint256)","function MAX_BATCH_SIZE() view returns (uint8)","event Certified(uint256 indexed certId, address indexed owner, bytes32 indexed documentHash, uint8 docType, address operator)","event BatchCertified(address indexed owner, uint256 startId, uint256 count, address operator)","event CertificateTransferred(bytes32 indexed documentHash, address indexed from, address indexed to)"],fs=["function claim() external","function setPaused(bool _paused) external","function canClaim(address user) view returns (bool)","function getCooldownRemaining(address user) view returns (uint256)","function getUserInfo(address user) view returns (uint256 lastClaim, uint256 claims, bool eligible, uint256 cooldownLeft)","function getFaucetStatus() view returns (uint256 ethBalance, uint256 tokenBalance, uint256 ethPerDrip, uint256 tokensPerDrip, uint256 estimatedEthClaims, uint256 estimatedTokenClaims)","function getStats() view returns (uint256 tokens, uint256 eth, uint256 claims, uint256 users)","function cooldown() view returns (uint256)","function tokensPerClaim() view returns (uint256)","function ethPerClaim() view returns (uint256)","function paused() view returns (bool)","event Claimed(address indexed recipient, uint256 tokens, uint256 eth, address indexed via)"],Yt=["function calculateFee(bytes32 _actionId, uint256 _txValue) view returns (uint256)","function bkcToken() view returns (address)","function treasury() view returns (address)","function buybackAccumulated() view returns (uint256)","function tutorOf(address _user) view returns (address)","function tutorCount(address _tutor) view returns (uint256)","function setTutor(address _tutor) external payable","function setTutorFor(address _user, address _tutor) external","function tutorRelayer() view returns (address)","function tutorBps() view returns (uint16)","function tutorFee() view returns (uint256)","function changeTutorFee() view returns (uint256)","event TutorSet(address indexed user, address indexed tutor)","event TutorChanged(address indexed user, address indexed oldTutor, address indexed newTutor)","event TutorRelayerUpdated(address indexed oldRelayer, address indexed newRelayer)","event TutorBpsUpdated(uint16 newBps)","function totalEthCollected() view returns (uint256)","function totalBkcCollected() view returns (uint256)","function totalFeeEvents() view returns (uint256)","function getStats() view returns (uint256 ethCollected, uint256 bkcCollected, uint256 feeEvents, uint256 buybackEth, uint256 moduleCount)","function isAuthorized(address _contract) view returns (bool)","function moduleCount() view returns (uint256)","function pendingEth(address account) view returns (uint256)","function withdrawEth() external","function getModuleConfig(bytes32 _moduleId) view returns (bool active, uint16 customBps, uint16 operatorBps, uint16 treasuryBps, uint16 buybackBps)","event FeeCollected(bytes32 indexed moduleId, address indexed user, address operator, address customRecipient, uint256 ethAmount, uint256 bkcAmount)","event EthDistributed(bytes32 indexed moduleId, uint256 toReferrer, uint256 toCustom, uint256 toOperator, uint256 toTreasury, uint256 toBuyback)","event EthWithdrawn(address indexed recipient, uint256 amount)"],Ua=["function executeBuyback() external payable","function executeBuybackWithSlippage(uint256 _minTotalBkcOut) external payable","function MAX_SUPPLY() view returns (uint256)","function MAX_MINTABLE() view returns (uint256)","function CALLER_BPS() view returns (uint256)","function BURN_BPS() view returns (uint256)","function liquidityPool() view returns (address)","function owner() view returns (address)","function executionFee() view returns (uint256)","function currentMiningRate() view returns (uint256 rateBps)","function pendingBuybackETH() view returns (uint256)","function getSupplyInfo() view returns (uint256 currentSupply, uint256 maxSupply, uint256 totalMintedViaMining, uint256 remainingMintable, uint256 miningRateBps, uint256 totalBurnedLifetime)","function previewBuyback() view returns (uint256 ethAvailable, uint256 estimatedBkcPurchased, uint256 estimatedBkcMined, uint256 estimatedBurn, uint256 estimatedToStakers, uint256 estimatedCallerReward, uint256 currentMiningRateBps, bool isReady)","function previewMiningAtSupply(uint256 _supplyLevel, uint256 _purchaseAmount) pure returns (uint256 miningAmount, uint256 rateBps)","function getBuybackStats() view returns (uint256 totalBuybacks, uint256 totalEthSpent, uint256 totalBkcPurchased, uint256 totalBkcMined, uint256 totalBkcBurned, uint256 totalBkcToStakers, uint256 totalCallerRewards, uint256 avgEthPerBuyback, uint256 avgBkcPerBuyback)","function getLastBuyback() view returns (uint256 timestamp, uint256 blockNumber, address caller, uint256 ethSpent, uint256 bkcTotal, uint256 timeSinceLast)","function totalBuybacks() view returns (uint256)","function totalEthSpent() view returns (uint256)","function totalBkcPurchased() view returns (uint256)","function totalBkcMined() view returns (uint256)","function totalBkcBurned() view returns (uint256)","function totalBkcToStakers() view returns (uint256)","function totalCallerRewards() view returns (uint256)","event BuybackExecuted(address indexed caller, uint256 indexed buybackNumber, uint256 callerReward, uint256 ethSpent, uint256 bkcPurchased, uint256 bkcMined, uint256 bkcBurned, uint256 bkcToStakers, uint256 miningRateBps)"],gs=["function createCampaign(string title, string metadataUri, uint96 goal, uint256 durationDays, address operator) external payable returns (uint256)","function donate(uint256 campaignId, address operator) external payable","function boostCampaign(uint256 campaignId, address operator) external payable","function closeCampaign(uint256 campaignId) external","function withdraw(uint256 campaignId) external","function getCampaign(uint256 campaignId) view returns (address owner, uint48 deadline, uint8 status, uint96 raised, uint96 goal, uint32 donorCount, bool isBoosted, string title, string metadataUri)","function canWithdraw(uint256 campaignId) view returns (bool)","function titles(uint256 campaignId) view returns (string)","function metadataUris(uint256 campaignId) view returns (string)","function campaignCount() view returns (uint256)","function previewDonation(uint256 amount) view returns (uint256 fee, uint256 netToCampaign)","function getStats() view returns (uint256 campaignCount, uint256 totalDonated, uint256 totalWithdrawn, uint256 totalEthFees)","event CampaignCreated(uint256 indexed campaignId, address indexed owner, uint96 goal, uint48 deadline, address operator)","event DonationMade(uint256 indexed campaignId, address indexed donor, uint256 grossAmount, uint256 netAmount, address operator)","event CampaignBoosted(uint256 indexed campaignId, address indexed booster, uint48 boostExpiry, address operator)","event CampaignClosed(uint256 indexed campaignId, address indexed owner, uint96 raised)","event FundsWithdrawn(uint256 indexed campaignId, address indexed owner, uint96 amount)"],la=["function createPost(string contentHash, uint8 tag, uint8 contentType, address operator) external payable","function createReply(uint256 parentId, string contentHash, uint8 contentType, address operator) external payable","function createRepost(uint256 originalId, string contentHash, address operator) external payable","function editPost(uint256 postId, string newContentHash) external","function deletePost(uint256 postId) external","function changeTag(uint256 postId, uint8 newTag) external","function like(uint256 postId, address operator) external payable","function superLike(uint256 postId, address operator) external payable","function downvote(uint256 postId, address operator) external payable","function follow(address user, address operator) external payable","function unfollow(address user) external","function blockUser(address user) external","function unblockUser(address user) external","function batchActions(tuple(uint8 actionType, uint256 targetId)[] actions, address operator) external payable","function reportPost(uint256 postId, uint8 category, address operator) external payable","function hasReported(uint256 postId, address user) view returns (bool)","function reportCount(uint256 postId) view returns (uint256)","function boostPost(uint256 postId, uint8 tier, address operator) external payable","function tipPost(uint256 postId, address operator) external payable","function createProfile(string username, string metadataURI, address operator) external payable","function updateProfile(string metadataURI) external","function pinPost(uint256 postId) external","function boostProfile(address operator) external payable","function obtainBadge(uint8 tier, address operator) external payable","function TAG_COUNT() view returns (uint8)","function EDIT_WINDOW() view returns (uint256)","function BOOST_TIER_COUNT() view returns (uint8)","function BADGE_TIER_COUNT() view returns (uint8)","function postCounter() view returns (uint256)","function totalProfiles() view returns (uint256)","function getPost(uint256 postId) view returns (tuple(address author, uint8 tag, uint8 contentType, bool deleted, uint32 createdAt, uint32 editedAt_, uint256 replyTo_, uint256 repostOf_, uint256 likes, uint256 superLikes, uint256 superLikeETH, uint256 downvotes, uint256 replies, uint256 reposts, uint256 reports, uint256 tips, uint8 boostTier, uint64 boostExpiry))","function getPostsBatch(uint256[] postIds) view returns (tuple(address author, uint8 tag, uint8 contentType, bool deleted, uint32 createdAt, uint32 editedAt_, uint256 replyTo_, uint256 repostOf_, uint256 likes, uint256 superLikes, uint256 superLikeETH, uint256 downvotes, uint256 replies, uint256 reposts, uint256 reports, uint256 tips, uint8 boostTier, uint64 boostExpiry)[])","function getUserProfile(address user) view returns (bytes32 usernameHash, string metadataURI, uint256 pinned, bool boosted, bool hasBadge, uint8 _badgeTier, uint64 boostExp, uint64 badgeExp, uint256 followers, uint256 following)","function checkFollowing(address a, address b) view returns (bool)","function checkBlocked(address a, address b) view returns (bool)","function isFollowing(address, address) view returns (bool)","function followerCount(address) view returns (uint256)","function followingCount(address) view returns (uint256)","function hasBlocked(address, address) view returns (bool)","function hasLiked(uint256 postId, address user) view returns (bool)","function hasDownvoted(uint256 postId, address user) view returns (bool)","function superLikeTotal(uint256 postId) view returns (uint256)","function isProfileBoosted(address user) view returns (bool)","function hasTrustBadge(address user) view returns (bool)","function isPostBoosted(uint256 postId) view returns (bool)","function isUsernameAvailable(string username) view returns (bool)","function getUsernamePrice(uint256 length) view returns (uint256)","function getBoostPrice(uint8 tier) view returns (uint256)","function getBadgePrice(uint8 tier) view returns (uint256)","function getOperatorStats(address operator) view returns (uint256 posts_, uint256 engagement)","function getGlobalStats() view returns (uint256 totalPosts, uint256 totalProfiles, uint256[15] tagCounts)","function version() pure returns (string)","event PostCreated(uint256 indexed postId, address indexed author, uint8 tag, uint8 contentType, string contentHash, address operator)","event ReplyCreated(uint256 indexed postId, uint256 indexed parentId, address indexed author, uint8 tag, uint8 contentType, string contentHash, address operator)","event RepostCreated(uint256 indexed postId, uint256 indexed originalId, address indexed author, uint8 tag, string contentHash, address operator)","event PostEdited(uint256 indexed postId, address indexed author, string newContentHash)","event PostDeleted(uint256 indexed postId, address indexed author)","event TagChanged(uint256 indexed postId, uint8 oldTag, uint8 newTag)","event Liked(uint256 indexed postId, address indexed liker, address indexed author, address operator)","event SuperLiked(uint256 indexed postId, address indexed voter, address indexed author, uint256 amount, address operator)","event Downvoted(uint256 indexed postId, address indexed voter, address indexed author, address operator)","event Followed(address indexed follower, address indexed followed, address operator)","event Unfollowed(address indexed follower, address indexed followed)","event UserBlocked(address indexed blocker, address indexed blocked)","event UserUnblocked(address indexed blocker, address indexed unblocked)","event PostReported(uint256 indexed postId, address indexed reporter, address indexed author, uint8 category, uint256 totalReports)","event PostBoosted(uint256 indexed postId, address indexed booster, uint8 tier, uint256 amount, uint64 newExpiry, address operator)","event PostTipped(uint256 indexed postId, address indexed tipper, address indexed author, uint256 amount, address operator)","event ProfileCreated(address indexed user, string username, string metadataURI, address operator)","event ProfileUpdated(address indexed user, string metadataURI)","event PostPinned(address indexed user, uint256 indexed postId)","event ProfileBoosted(address indexed user, uint256 daysAdded, uint64 expiresAt, address operator)","event BadgeObtained(address indexed user, uint8 tier, uint64 expiresAt, address operator)","event BatchExecuted(address indexed user, uint256 attempted, uint256 succeeded, address operator)"],nd=["function claim(uint256 amount, bytes32[] merkleProof, address operator) external payable","function hasClaimed(address user) view returns (bool)","function getClaimInfo(address user) view returns (bool claimed, uint256 claimFee, uint256 lockDays, uint256 phase)","function verifyProof(address user, uint256 amount, bytes32[] merkleProof) view returns (bool)","function availableBalance() view returns (uint256)","function currentPhase() view returns (uint256)","function totalClaimed() view returns (uint256)","function totalClaimCount() view returns (uint256)","function merkleRoot() view returns (bytes32)","function claimFee() view returns (uint256)","function lockDays() view returns (uint256)","function claimDeadline() view returns (uint256)","event Claimed(address indexed user, uint256 indexed phase, uint256 amount, uint256 feePaid, address operator)","event PhaseStarted(uint256 indexed phase, bytes32 merkleRoot, uint256 claimDeadline)"];let Al=0;const ob=5e3;async function od(){try{return window.ethereum?await window.ethereum.request({method:"eth_chainId"})===Ke.chainId:!1}catch(e){return console.warn("Network check failed:",e.message),!1}}async function wn(){if(!window.ethereum)return console.warn("MetaMask not detected"),!1;try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:Ke.chainId,chainName:Ke.chainName,nativeCurrency:Ke.nativeCurrency,rpcUrls:Ke.rpcUrls,blockExplorerUrls:Ke.blockExplorerUrls}]}),console.log("âœ… MetaMask network config updated"),!0}catch(e){return e.code===4001?(console.log("User rejected network update"),!1):(console.warn("Could not update MetaMask network:",e.message),!1)}}async function sd(){if(!window.ethereum)return console.warn("MetaMask not detected"),!1;try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:Ke.chainId}]}),console.log("âœ… Switched to Sepolia"),!0}catch(e){return e.code===4902?(console.log("ðŸ”„ Sepolia not found, adding..."),await wn()):e.code===4001?(console.log("User rejected network switch"),!1):(console.error("Network switch error:",e),!1)}}async function no(){var e;if(!window.ethereum)return{healthy:!1,reason:"no_provider"};try{const t=new window.ethers.BrowserProvider(window.ethereum),a=new Promise((o,s)=>setTimeout(()=>s(new Error("timeout")),5e3)),n=t.getBlockNumber();return await Promise.race([n,a]),{healthy:!0}}catch(t){const a=((e=t==null?void 0:t.message)==null?void 0:e.toLowerCase())||"";return a.includes("timeout")?{healthy:!1,reason:"timeout"}:a.includes("too many")||a.includes("rate limit")||a.includes("-32002")?{healthy:!1,reason:"rate_limited"}:a.includes("failed to fetch")||a.includes("network")?{healthy:!1,reason:"network_error"}:{healthy:!1,reason:"unknown",error:a}}}async function id(){const e=Date.now();if(e-Al<ob)return{success:!0,skipped:!0};if(Al=e,!window.ethereum)return{success:!1,error:"MetaMask not detected"};try{if(!await od()&&(console.log("ðŸ”„ Wrong network detected, switching..."),!await sd()))return{success:!1,error:"Please switch to Sepolia network"};const a=await no();if(!a.healthy&&(console.log(`âš ï¸ RPC unhealthy (${a.reason}), updating MetaMask config...`),await wn())){await new Promise(s=>setTimeout(s,1e3));const o=await no();return o.healthy?{success:!0,fixed:!0}:{success:!1,error:"Network is congested. Please try again in a moment.",rpcReason:o.reason}}return{success:!0}}catch(t){return console.error("Network config error:",t),{success:!1,error:t.message}}}function rd(e){window.ethereum&&window.ethereum.on("chainChanged",async t=>{console.log("ðŸ”„ Network changed to:",t);const a=t===Ke.chainId;e&&e({chainId:t,isCorrectNetwork:a,needsSwitch:!a})})}const ld=Object.freeze(Object.defineProperty({__proto__:null,METAMASK_NETWORK_CONFIG:Ke,RPC_ENDPOINTS:ea,addresses:E,agoraABI:la,airdropClaimABI:nd,bkcTokenABI:cs,boosterTiers:st,buybackMinerABI:Ua,charityPoolABI:gs,checkRpcHealth:no,contractAddresses:R,ecosystemManagerABI:Yt,ensureCorrectNetworkConfig:id,faucetABI:fs,fortunePoolABI:us,getCurrentRpcUrl:yn,getKeepRateFromBoost:po,getRecycleRateFromBoost:ed,getTierByBoost:Qc,isCorrectNetwork:od,loadAddresses:Zc,markRpcHealthy:Xc,markRpcUnhealthy:qc,nftPoolABI:td,notaryABI:ps,rentalManagerABI:In,resetToPrimaryRpc:Jc,rewardBoosterABI:ad,sepoliaRpcUrl:Yi,setupNetworkChangeListener:rd,stakingPoolABI:ds,switchToCorrectNetwork:sd,switchToNextRpc:qi,updateMetaMaskNetwork:wn},Symbol.toStringTag,{value:"Module"})),cd=window.ethers,sb=5e3,ib=6e4,rb=3e4,lb=3e4,cb=6e4;let ii=null,Il=0;const Pl=new Map,ri=new Map,Nl=new Map,zl=e=>new Promise(t=>setTimeout(t,e));async function ms(e,t){const a=new AbortController,n=setTimeout(()=>a.abort(),t);try{const o=await fetch(e,{signal:a.signal});return clearTimeout(n),o}catch(o){throw clearTimeout(n),o.name==="AbortError"?new Error("API request timed out."):o}}const ca={getHistory:"https://gethistory-4wvdcuoouq-uc.a.run.app",getBoosters:"https://getboosters-4wvdcuoouq-uc.a.run.app",getSystemData:"https://getsystemdata-4wvdcuoouq-uc.a.run.app",getNotaryHistory:"https://getnotaryhistory-4wvdcuoouq-uc.a.run.app",getRentalListings:"https://getrentallistings-4wvdcuoouq-uc.a.run.app",getUserRentals:"https://getuserrentals-4wvdcuoouq-uc.a.run.app",fortuneGames:"https://getfortunegames-4wvdcuoouq-uc.a.run.app",uploadFileToIPFS:"/api/upload",claimAirdrop:"https://us-central1-airdropbackchainnew.cloudfunctions.net/claimAirdrop"};function dd(e){var t;return((t=e==null?void 0:e.error)==null?void 0:t.code)===429||(e==null?void 0:e.code)===429||e.message&&(e.message.includes("429")||e.message.includes("Too Many Requests")||e.message.includes("rate limit"))}function ud(e){var a,n;const t=((a=e==null?void 0:e.error)==null?void 0:a.code)||(e==null?void 0:e.code);return t===-32603||t===-32e3||((n=e.message)==null?void 0:n.includes("Internal JSON-RPC"))}function bs(e,t,a){if(a)return a;if(!e||!u.publicProvider)return null;try{return new cd.Contract(e,t,u.publicProvider)}catch{return null}}const ie=async(e,t,a=[],n=0n,o=2,s=!1)=>{if(!e)return n;const i=e.target||e.address,r=JSON.stringify(a,(f,g)=>typeof g=="bigint"?g.toString():g),l=`${i}-${t}-${r}`,c=Date.now(),d=["getPoolInfo","getBuyPrice","getSellPrice","getAvailableTokenIds","getAllListedTokenIds","tokenURI","tokenTier","getTokenInfo","getListing","balanceOf","totalSupply","totalPStake","MAX_SUPPLY","TGE_SUPPLY","userTotalPStake","pendingRewards","isRented","getRental","ownerOf","getDelegationsOf","allowance","getPoolStats","getAllTiers","getUserSummary","getUserBestBoost"];if(!s&&d.includes(t)){const f=Pl.get(l);if(f&&c-f.timestamp<rb)return f.value}for(let f=0;f<=o;f++)try{const g=await e[t](...a);return d.includes(t)&&Pl.set(l,{value:g,timestamp:c}),g}catch(g){if(dd(g)&&f<o){const m=Math.floor(Math.random()*1e3),h=1e3*Math.pow(2,f)+m;await zl(h);continue}if(ud(g)&&f<o){await zl(500);continue}break}return n},db=async(e,t,a=!1)=>{const n=`balance-${(e==null?void 0:e.target)||(e==null?void 0:e.address)}-${t}`,o=Date.now();if(!a){const i=Nl.get(n);if(i&&o-i.timestamp<cb)return i.value}const s=await ie(e,"balanceOf",[t],0n,2,a);return Nl.set(n,{value:s,timestamp:o}),s};async function pd(){u.systemFees||(u.systemFees={}),u.systemPStakes||(u.systemPStakes={}),u.boosterDiscounts||(u.boosterDiscounts={});const e=Date.now();if(ii&&e-Il<ib)return $l(ii),!0;try{const t=await ms(ca.getSystemData,sb);if(!t.ok)throw new Error(`API Status: ${t.status}`);const a=await t.json();return $l(a),ii=a,Il=e,!0}catch{return u.systemFees.NOTARY_SERVICE||(u.systemFees.NOTARY_SERVICE=100n),u.systemFees.CLAIM_REWARD_FEE_BIPS||(u.systemFees.CLAIM_REWARD_FEE_BIPS=500n),!1}}function $l(e){if(e.fees)for(const t in e.fees)try{u.systemFees[t]=BigInt(e.fees[t])}catch{u.systemFees[t]=0n}if(e.pStakeRequirements)for(const t in e.pStakeRequirements)try{u.systemPStakes[t]=BigInt(e.pStakeRequirements[t])}catch{u.systemPStakes[t]=0n}if(e.discounts)for(const t in e.discounts)try{u.boosterDiscounts[t]=BigInt(e.discounts[t])}catch{u.boosterDiscounts[t]=0n}if(e.oracleFeeInWei){u.systemData=u.systemData||{};try{u.systemData.oracleFeeInWei=BigInt(e.oracleFeeInWei)}catch{u.systemData.oracleFeeInWei=0n}}}async function fd(){!u.publicProvider||!u.bkcTokenContractPublic||await Promise.allSettled([ie(u.bkcTokenContractPublic,"totalSupply",[],0n),pd()])}async function Pn(e=!1){var t,a,n,o,s;if(!(!u.isConnected||!u.userAddress))try{const i=(a=(t=u.bkcTokenContractPublic)==null?void 0:t.runner)==null?void 0:a.provider,[r,l]=await Promise.allSettled([db(u.bkcTokenContractPublic||u.bkcTokenContract,u.userAddress,e),(n=i||u.provider)==null?void 0:n.getBalance(u.userAddress)]);r.status==="fulfilled"?u.currentUserBalance=r.value:console.warn("[Data] BKC balance read failed:",(o=r.reason)==null?void 0:o.message),l.status==="fulfilled"?u.currentUserNativeBalance=l.value:console.warn("[Data] ETH balance read failed:",(s=l.reason)==null?void 0:s.message),await Nn(e);const c=u.stakingPoolContractPublic||u.stakingPoolContract;if(c){const d=await ie(c,"userTotalPStake",[u.userAddress],0n,2,e);u.userTotalPStake=d}}catch(i){console.error("Error loading user data:",i)}}async function ub(e=!1){const t=u.stakingPoolContractPublic||u.stakingPoolContract;if(!u.isConnected||!t)return[];try{const a=await ie(t,"getDelegationsOf",[u.userAddress],[],2,e);return u.userDelegations=a.map((n,o)=>({amount:n.amount||n[0]||0n,pStake:n.pStake||n[1]||0n,lockEnd:Number(n.lockEnd||n[2]||0),lockDays:Number(n.lockDays||n[3]||0),rewardDebt:n.rewardDebt||n[4]||0n,unlockTime:BigInt(n.lockEnd||n[2]||0),lockDuration:BigInt(n.lockDays||n[3]||0)*86400n,index:o})),u.userDelegations}catch(a){return console.error("Error loading delegations:",a),[]}}async function Xi(e=!1){let t=[];try{const n=await ms(ca.getRentalListings,4e3);n.ok&&(t=await n.json())}catch{}if(t&&t.length>0){const n=t.map(o=>{var i,r,l,c,d,f;const s=st.find(g=>g.boostBips===Number(o.boostBips||0));return{...o,tokenId:((i=o.tokenId)==null?void 0:i.toString())||((r=o.id)==null?void 0:r.toString()),pricePerDay:((l=o.pricePerDay)==null?void 0:l.toString())||((c=o.pricePerHour)==null?void 0:c.toString())||((d=o.price)==null?void 0:d.toString())||"0",totalEarnings:((f=o.totalEarnings)==null?void 0:f.toString())||"0",rentalCount:Number(o.rentalCount||0),img:(s==null?void 0:s.img)||"./assets/nft.png",name:(s==null?void 0:s.name)||"Booster NFT"}});return u.rentalListings=n,n}const a=bs(E.rentalManager,In,u.rentalManagerContractPublic);if(!a)return u.rentalListings=[],[];try{const n=await ie(a,"getAllListedTokenIds",[],[],2,!0);if(!n||n.length===0)return u.rentalListings=[],[];const s=n.slice(0,30).map(async l=>{var c,d,f;try{const g=await ie(a,"getListing",[l],null,1,!0);if(g&&g.owner!==cd.ZeroAddress){const m=await ie(a,"getRental",[l],null,1,!0),h=await bd(l),w=Math.floor(Date.now()/1e3),y=m&&BigInt(m.endTime||0)>BigInt(w),k=Math.floor(Date.now()/1e3),v=Number(g.boostExpiry||0);return{tokenId:l.toString(),owner:g.owner,pricePerDay:((c=g.pricePerDay)==null?void 0:c.toString())||"0",totalEarnings:((d=g.totalEarnings)==null?void 0:d.toString())||"0",rentalCount:Number(g.rentalCount||0),boostBips:h.boostBips,img:h.img||"./assets/nft.png",name:h.name,isRented:y,currentTenant:y?m.tenant:null,rentalEndTime:y?(f=m.endTime)==null?void 0:f.toString():null,isBoosted:g.isBoosted||v>k,boostExpiry:v}}}catch{}return null}),r=(await Promise.all(s)).filter(l=>l!==null);return u.rentalListings=r,r}catch{return u.rentalListings=[],[]}}async function gd(e=!1){var a,n;if(!u.userAddress)return u.myRentals=[],[];try{const o=await ms(`${ca.getUserRentals}/${u.userAddress}`,4e3);if(o.ok){const i=(await o.json()).map(r=>{const l=st.find(c=>c.boostBips===Number(r.boostBips||0));return{...r,img:(l==null?void 0:l.img)||"./assets/nft.png",name:(l==null?void 0:l.name)||"Booster NFT"}});return u.myRentals=i,i}}catch{}const t=bs(E.rentalManager,In,u.rentalManagerContractPublic);if(!t)return u.myRentals=[],[];try{const o=await ie(t,"getAllListedTokenIds",[],[],2,e),s=[],i=Math.floor(Date.now()/1e3);for(const r of o.slice(0,30))try{const l=await ie(t,"getRental",[r],null,1,e);if(l&&((a=l.tenant)==null?void 0:a.toLowerCase())===u.userAddress.toLowerCase()&&(l.isActive||BigInt(l.endTime||0)>BigInt(i))){const c=await bd(r);s.push({tokenId:r.toString(),tenant:l.tenant,endTime:((n=l.endTime)==null?void 0:n.toString())||"0",isActive:l.isActive,boostBips:c.boostBips,img:c.img,name:c.name})}}catch{}return u.myRentals=s,s}catch{return u.myRentals=[],[]}}let ko=null,Sl=0;const pb=3e4;async function md(e=!1){const t=Date.now();if(!e&&ko&&t-Sl<pb)return ko;await Promise.all([Nn(e),gd(e)]);let a=0,n=null,o="none";if(u.myBoosters&&u.myBoosters.length>0){const l=u.myBoosters.reduce((c,d)=>d.boostBips>c.boostBips?d:c,u.myBoosters[0]);l.boostBips>a&&(a=l.boostBips,n=l.tokenId,o="owned")}if(u.myRentals&&u.myRentals.length>0){const l=u.myRentals.reduce((c,d)=>d.boostBips>c.boostBips?d:c,u.myRentals[0]);l.boostBips>a&&(a=l.boostBips,n=l.tokenId,o="rented")}const s=st.find(l=>l.boostBips===a),i=(s==null?void 0:s.image)||(s==null?void 0:s.realImg)||(s==null?void 0:s.img)||"assets/bkc_logo_3d.png",r=s!=null&&s.name?`${s.name} Booster`:o!=="none"?"Booster NFT":"None";return ko={highestBoost:a,boostName:r,imageUrl:i,tokenId:n?n.toString():null,source:o},Sl=Date.now(),ko}async function bd(e){const t=["function getTokenInfo(uint256) view returns (address owner, uint8 tier, uint256 boostBips)","function tokenTier(uint256) view returns (uint8)"],a=bs(E.rewardBooster,t,u.rewardBoosterContractPublic);if(!a)return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"};try{const n=await ie(a,"getTokenInfo",[e],null);if(n){const o=Number(n.boostBips||n[2]||0),s=st.find(i=>i.boostBips===o);return{boostBips:o,img:(s==null?void 0:s.image)||(s==null?void 0:s.img)||"./assets/nft.png",name:(s==null?void 0:s.name)||`Booster #${e}`}}return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"}}catch{return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"}}}async function Ji(){const e=u.stakingPoolContractPublic||u.stakingPoolContract;if(!u.isConnected||!e)return{stakingRewards:0n,minerRewards:0n,totalRewards:0n};try{const t=await ie(e,"pendingRewards",[u.userAddress],0n);return{stakingRewards:t,minerRewards:0n,totalRewards:t}}catch{return{stakingRewards:0n,minerRewards:0n,totalRewards:0n}}}async function fb(){const e=u.stakingPoolContractPublic||u.stakingPoolContract;if(!e||!u.userAddress)return{netClaimAmount:0n,feeAmount:0n,discountPercent:0,totalRewards:0n,recycleRateBps:0,nftBoost:0};const{totalRewards:t}=await Ji();if(t===0n)return{netClaimAmount:0n,feeAmount:0n,discountPercent:0,totalRewards:0n,recycleRateBps:0,nftBoost:0};try{const a=await ie(e,"previewClaim",[u.userAddress],null);if(a){const n=a.totalRewards||a[0]||0n,o=a.recycleAmount||a[1]||0n,s=a.burnAmount||a[2]||0n,i=a.tutorCut||a[3]||0n,r=a.userReceives||a[4]||0n,l=Number(a.recycleRateBps||a[5]||0),c=Number(a.nftBoost||a[6]||0),d=o+s+i;return console.log("[Data] V10 Claim preview:",{totalRewards:Number(n)/1e18,recycleAmount:Number(o)/1e18,burnAmount:Number(s)/1e18,tutorCut:Number(i)/1e18,userReceives:Number(r)/1e18,recycleRateBps:l,nftBoost:c}),{netClaimAmount:r,feeAmount:d,recycleAmount:o,burnAmount:s,tutorCut:i,discountPercent:c/100,totalRewards:n,recycleRateBps:l,nftBoost:c,baseFeeBips:6e3,finalFeeBips:l}}}catch(a){console.error("[Data] previewClaim error:",a)}return{netClaimAmount:t,feeAmount:0n,discountPercent:0,totalRewards:t,recycleRateBps:0,nftBoost:0}}let li=!1,ci=0,Eo=0;const gb=3e4,mb=3,bb=12e4;async function Nn(e=!1){if(!u.userAddress)return[];const t=Date.now();if(li)return u.myBoosters||[];if(!e&&t-ci<gb)return u.myBoosters||[];if(Eo>=mb){if(t-ci<bb)return u.myBoosters||[];Eo=0}li=!0,ci=t;try{const a=await ms(`${ca.getBoosters}/${u.userAddress}`,5e3);if(!a.ok)throw new Error(`API Error: ${a.status}`);let n=await a.json();const o=["function ownerOf(uint256) view returns (address)","function getTokenInfo(uint256) view returns (address owner, uint8 tier, uint256 boostBips)"],s=bs(E.rewardBooster,o,u.rewardBoosterContractPublic);if(s&&n.length>0){const i=await Promise.all(n.slice(0,50).map(async r=>{const l=BigInt(r.tokenId),c=`ownerOf-${l}`,d=Date.now();let f=Number(r.boostBips||r.boost||0);if(f===0)try{const g=await s.getTokenInfo(l);f=Number(g.boostBips||g[2]||0)}catch{}if(!e&&ri.has(c)){const g=ri.get(c);if(d-g.timestamp<lb)return g.owner.toLowerCase()===u.userAddress.toLowerCase()?{tokenId:l,boostBips:f,imageUrl:r.imageUrl||r.image||null}:null}try{const g=await s.ownerOf(l);return ri.set(c,{owner:g,timestamp:d}),g.toLowerCase()===u.userAddress.toLowerCase()?{tokenId:l,boostBips:f,imageUrl:r.imageUrl||r.image||null}:null}catch(g){return dd(g)||ud(g)?{tokenId:l,boostBips:f,imageUrl:r.imageUrl||r.image||null}:null}}));u.myBoosters=i.filter(r=>r!==null)}else u.myBoosters=n.map(i=>({tokenId:BigInt(i.tokenId),boostBips:Number(i.boostBips||i.boost||0),imageUrl:i.imageUrl||i.image||null}));return Eo=0,u.myBoosters}catch{return Eo++,u.myBoosters||(u.myBoosters=[]),u.myBoosters}finally{li=!1}}const xb={apiKey:"AIzaSyDKhF2_--fKtot96YPS8twuD0UoCpS-3T4",authDomain:"airdropbackchainnew.firebaseapp.com",projectId:"airdropbackchainnew",storageBucket:"airdropbackchainnew.appspot.com",messagingSenderId:"108371799661",appId:"1:108371799661:web:d126fcbd0ba56263561964",measurementId:"G-QD9EBZ0Y09"},xd=Km(xb),To=Vm(xd),H=Xm(xd);let Zt=null,Ae=null,Co=null;function hb(e,t=18){if(!e||e==="0")return"0.00";try{const a=BigInt(e),n=BigInt(10)**BigInt(t),o=(a/n).toString();let s=(a%n).toString();const i=t-s.length;return i>0&&(s="0".repeat(i)+s),s=s.replace(/0+$/,""),`${o}.${s||"0"}`}catch(a){return console.error("Erro ao formatar valor BigInt:",a),"0.00"}}async function Zi(e){if(!e)throw new Error("Wallet address is required for Firebase sign-in.");const t=e.toLowerCase();return Ae=t,Zt?(Co=await cn(t),Zt):To.currentUser?(Zt=To.currentUser,Co=await cn(t),Zt):new Promise((a,n)=>{const o=Ym(To,async s=>{if(o(),s){Zt=s;try{Co=await cn(t),a(s)}catch(i){console.error("Error linking airdrop user profile:",i),n(i)}}else qm(To).then(async i=>{Zt=i.user,Co=await cn(t),a(Zt)}).catch(i=>{console.error("Firebase Anonymous sign-in failed:",i),n(i)})},s=>{console.error("Firebase Auth state change error:",s),o(),n(s)})})}function it(){if(!Zt)throw new Error("User not authenticated with Firebase. Please sign-in first.");if(!Ae)throw new Error("Wallet address not set. Please connect wallet first.")}async function xs(){const e=Z(H,"airdrop_public_data","data_v1"),t=await we(e);if(t.exists()){const a=t.data(),n=(a.dailyTasks||[]).map(i=>{var c,d;const r=(c=i.startDate)!=null&&c.toDate?i.startDate.toDate():i.startDate?new Date(i.startDate):null,l=(d=i.endDate)!=null&&d.toDate?i.endDate.toDate():i.endDate?new Date(i.endDate):null;return{...i,id:i.id||null,startDate:r instanceof Date&&!isNaN(r)?r:null,endDate:l instanceof Date&&!isNaN(l)?l:null}}).filter(i=>i.id),o=Date.now(),s=n.filter(i=>{const r=i.startDate?i.startDate.getTime():0,l=i.endDate?i.endDate.getTime():1/0;return r<=o&&o<l});return{config:a.config||{ugcBasePoints:{}},leaderboards:a.leaderboards||{top100ByPoints:[],top100ByPosts:[],lastUpdated:null},dailyTasks:s,platformUsageConfig:a.platformUsageConfig||null}}else return console.warn("Public airdrop data document 'airdrop_public_data/data_v1' not found. Returning defaults."),{config:{isActive:!1,roundName:"Loading...",ugcBasePoints:{}},leaderboards:{top100ByPoints:[],top100ByPosts:[],lastUpdated:null},dailyTasks:[],platformUsageConfig:null}}function Ll(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let a=0;a<6;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function oo(e){return e>=100?10:e>=90?9:e>=80?8:e>=70?7:e>=60?6:e>=50?5:e>=40?4:e>=30?3:e>=20?2:1}async function cn(e){it(),e||(e=Ae);const t=e.toLowerCase(),a=Z(H,"airdrop_users",t),n=await we(a);if(n.exists()){const o=n.data(),s={};if(o.referralCode||(s.referralCode=Ll()),typeof o.approvedSubmissionsCount!="number"&&(s.approvedSubmissionsCount=0),typeof o.rejectedCount!="number"&&(s.rejectedCount=0),typeof o.isBanned!="boolean"&&(s.isBanned=!1),typeof o.totalPoints!="number"&&(s.totalPoints=0),typeof o.pointsMultiplier!="number"&&(s.pointsMultiplier=1),o.walletAddress!==t&&(s.walletAddress=t),Object.keys(s).length>0)try{return await Sa(a,s),{id:n.id,...o,...s}}catch(i){return console.error("Error updating user default fields:",i),{id:n.id,...o}}return{id:n.id,...o}}else{const o=Ll(),s={walletAddress:t,referralCode:o,totalPoints:0,pointsMultiplier:1,approvedSubmissionsCount:0,rejectedCount:0,isBanned:!1,createdAt:Be()};return await Bn(a,s),{id:a.id,...s,createdAt:new Date}}}async function Qi(e,t){if(it(),!e||typeof e!="string"||e.trim()==="")return console.warn(`isTaskEligible called with invalid taskId: ${e}`),{eligible:!1,timeLeft:0};const a=Z(H,"airdrop_users",Ae,"task_claims",e),n=await we(a),o=t*60*60*1e3;if(!n.exists())return{eligible:!0,timeLeft:0};const s=n.data(),i=s==null?void 0:s.timestamp;if(typeof i!="string"||i.trim()==="")return console.warn(`Missing/invalid timestamp for task ${e}. Allowing claim.`),{eligible:!0,timeLeft:0};try{const r=new Date(i);if(isNaN(r.getTime()))return console.warn(`Invalid timestamp format for task ${e}:`,i,". Allowing claim."),{eligible:!0,timeLeft:0};const l=r.getTime(),d=Date.now()-l;return d>=o?{eligible:!0,timeLeft:0}:{eligible:!1,timeLeft:o-d}}catch(r){return console.error(`Error parsing timestamp string for task ${e}:`,i,r),{eligible:!0,timeLeft:0}}}async function hd(e,t){if(it(),!e||!e.id)throw new Error("Invalid task data provided.");if(!(await Qi(e.id,e.cooldownHours)).eligible)throw new Error("Cooldown period is still active for this task.");const n=Z(H,"airdrop_users",Ae),o=Math.round(e.points);if(isNaN(o)||o<0)throw new Error("Invalid points value for the task.");await Sa(n,{totalPoints:Ne(o)});const s=Z(H,"airdrop_users",Ae,"task_claims",e.id);return await Bn(s,{timestamp:new Date().toISOString(),points:o}),o}async function vb(e){var r;const t=e.trim().toLowerCase();let a="Other",n=!0;if(t.includes("youtube.com/shorts/")){a="YouTube Shorts";const l=t.match(/\/shorts\/([a-zA-Z0-9_-]+)/);if(!l||!l[1])throw n=!1,new Error("Invalid YouTube Shorts URL: Video ID not found or incorrect format.")}else if(t.includes("youtube.com/watch?v=")||t.includes("youtu.be/")){a="YouTube";const l=t.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})(?:[?&]|$)/);if(!l||l[1].length!==11)throw n=!1,new Error("Invalid YouTube URL: Video ID not found or incorrect format.")}else{if(t.includes("youtube.com/"))throw a="YouTube",n=!1,new Error("Invalid YouTube URL: Only video links (youtube.com/watch?v=... or youtu.be/...) or Shorts links are accepted.");if(t.includes("instagram.com/p/")||t.includes("instagram.com/reel/")){a="Instagram";const l=t.match(/\/(?:p|reel)\/([a-zA-Z0-9_.-]+)/);(!l||!l[1])&&(n=!1)}else t.includes("twitter.com/")||t.includes("x.com/")?t.match(/(\w+)\/(?:status|statuses)\/(\d+)/)&&(a="X/Twitter"):t.includes("facebook.com/")&&t.includes("/posts/")?a="Facebook":t.includes("t.me/")||t.includes("telegram.org/")?a="Telegram":t.includes("tiktok.com/")?a="TikTok":t.includes("reddit.com/r/")?a="Reddit":t.includes("linkedin.com/posts/")&&(a="LinkedIn")}const s=((r=(await xs()).config)==null?void 0:r.ugcBasePoints)||{},i=s[a]||s.Other||1e3;if(isNaN(i)||i<0)throw new Error(`Invalid base points configured for platform: ${a}. Please contact admin.`);return{platform:a,basePoints:i,isValid:n,normalizedUrl:t}}async function vd(e){var V;it();const t=Z(H,"airdrop_users",Ae),a=Ie(H,"airdrop_users",Ae,"submissions"),n=Ie(H,"all_submissions_log"),o=e.trim();if(!o||!o.toLowerCase().startsWith("http://")&&!o.toLowerCase().startsWith("https://"))throw new Error("The provided URL must start with http:// or https://.");let s;try{s=await vb(o)}catch(X){throw X}const{platform:i,basePoints:r,isValid:l,normalizedUrl:c}=s;if(!l)throw new Error(`The provided URL for ${i} does not appear valid for submission.`);const d=Fe(a,Oa("submittedAt","desc"),Jm(1)),f=await xt(d);if(!f.empty){const re=(V=f.docs[0].data().submittedAt)==null?void 0:V.toDate();if(re){const le=new Date,se=5*60*1e3,ke=le.getTime()-re.getTime();if(ke<se){const G=se-ke,Pe=Math.ceil(G/6e4);throw new Error(`We're building a strong community, and we value quality over quantity. To prevent spam, please wait ${Pe} more minute(s) before submitting another post. We appreciate your thoughtful contribution!`)}}}const g=Fe(n,Le("normalizedUrl","==",c),Le("status","in",["pending","approved","auditing","flagged_suspicious"]));if(!(await xt(g)).empty)throw new Error("This content link has already been submitted. Repeatedly submitting duplicate or fraudulent content may lead to account suspension.");const h=await we(t);if(!h.exists())throw new Error("User profile not found.");const w=h.data(),y=w.approvedSubmissionsCount||0,k=oo(y),v=Math.round(r*k),T=Be(),I={url:o,platform:i,status:"pending",basePoints:r,_pointsCalculated:v,_multiplierApplied:k,pointsAwarded:0,submittedAt:T,resolvedAt:null},N={userId:Ae,walletAddress:w.walletAddress,normalizedUrl:c,platform:i,status:"pending",basePoints:r,submittedAt:T,resolvedAt:null},S=An(H),$=Z(a);S.set($,I);const F=Z(n,$.id);S.set(F,N),await S.commit()}async function yd(){it();const e=Ie(H,"airdrop_users",Ae,"submissions"),t=Fe(e,Oa("submittedAt","desc"));return(await xt(t)).docs.map(n=>{var s,i;const o=n.data();return{submissionId:n.id,...o,submittedAt:(s=o.submittedAt)!=null&&s.toDate?o.submittedAt.toDate():null,resolvedAt:(i=o.resolvedAt)!=null&&i.toDate?o.resolvedAt.toDate():null}})}async function yb(){it();const e=Ie(H,"airdrop_users",Ae,"submissions"),t=Fe(e,Le("status","==","flagged_suspicious"),Oa("submittedAt","desc"));return(await xt(t)).docs.map(n=>{var s;const o=n.data();return{submissionId:n.id,...o,submittedAt:(s=o.submittedAt)!=null&&s.toDate?o.submittedAt.toDate():null}})}async function wb(e,t){it();const a=Z(H,"airdrop_users",Ae),n=Z(H,"airdrop_users",Ae,"submissions",e),o=Z(H,"all_submissions_log",e),s=await we(n);if(!s.exists()||s.data().status!=="flagged_suspicious")throw new Error("Submission not found or not flagged for review.");const i=s.data(),r=An(H);if(t==="not_fraud"){let l=i._pointsCalculated,c=i._multiplierApplied;if(typeof l!="number"||isNaN(l)||l<=0){console.warn(`[ResolveFlagged] Legacy/Invalid submission ${e} missing/invalid _pointsCalculated. Recalculating...`);const d=i.basePoints||0,f=await we(a);if(!f.exists())throw new Error("User profile not found for recalculation.");const m=f.data().approvedSubmissionsCount||0;c=oo(m),l=Math.round(d*c),(isNaN(l)||l<=0)&&(console.warn(`[ResolveFlagged] Recalculation failed (basePoints: ${d}). Using fallback 1000.`),l=Math.round(1e3*c))}r.update(a,{totalPoints:Ne(l),approvedSubmissionsCount:Ne(1)}),r.update(n,{status:"approved",pointsAwarded:l,_pointsCalculated:l,_multiplierApplied:c,resolvedAt:Be()}),await we(o).then(d=>d.exists())&&r.update(o,{status:"approved",resolvedAt:Be()})}else{const l=await we(a);if(!l.exists())throw new Error("User profile not found.");const c=l.data(),d={},f=c.rejectedCount||0;d.rejectedCount=Ne(1),f+1>=3&&(d.isBanned=!0),Object.keys(d).length>0&&r.update(a,d),r.update(n,{status:"rejected",pointsAwarded:0,resolvedAt:Be()}),await we(o).then(g=>g.exists())&&r.update(o,{status:"rejected",resolvedAt:Be()})}await r.commit()}async function wd(e){it();const t=Ae,a=Z(H,"airdrop_users",t),n=Z(H,"airdrop_users",t,"submissions",e),o=Z(H,"all_submissions_log",e),s=await we(n);if(!s.exists())throw new Error("Cannot confirm submission: Document not found or already processed.");const i=s.data(),r=i.status;if(r==="approved"||r==="rejected")throw new Error(`Submission is already in status: ${r}.`);let l=i._pointsCalculated,c=i._multiplierApplied;if(typeof l!="number"||isNaN(l)||l<=0){console.warn(`[ConfirmSubmission] Legacy/Invalid submission ${e} missing/invalid _pointsCalculated. Recalculating...`);const f=i.basePoints||0,g=await we(a);if(!g.exists())throw new Error("User profile not found for recalculation.");const h=g.data().approvedSubmissionsCount||0;c=oo(h),l=Math.round(f*c),(isNaN(l)||l<=0)&&(console.warn(`[ConfirmSubmission] Recalculation failed (basePoints: ${f}). Using fallback 1000.`),l=Math.round(1e3*c))}const d=An(H);d.update(a,{totalPoints:Ne(l),approvedSubmissionsCount:Ne(1)}),d.update(n,{status:"approved",pointsAwarded:l,_pointsCalculated:l,_multiplierApplied:c,resolvedAt:Be()}),await we(o).then(f=>f.exists())&&d.update(o,{status:"approved",resolvedAt:Be()}),await d.commit()}async function er(e){it();const a=Z(H,"airdrop_users",Ae,"submissions",e),n=Z(H,"all_submissions_log",e),o=await we(a);if(!o.exists())return console.warn(`Delete submission skipped: Document ${e} not found.`);const s=o.data().status;if(s==="approved"||s==="rejected")throw new Error(`This submission was already ${s} and cannot be deleted.`);if(s==="flagged_suspicious")throw new Error("Flagged submissions must be resolved, not deleted.");const i=An(H);i.update(a,{status:"deleted_by_user",resolvedAt:Be()}),await we(n).then(r=>r.exists())&&i.update(n,{status:"deleted_by_user",resolvedAt:Be(),pointsAwarded:0}),await i.commit()}async function kd(e){const t=Z(H,"airdrop_public_data","data_v1");await Bn(t,{config:{ugcBasePoints:e}},{merge:!0})}async function Ed(){const e=Ie(H,"daily_tasks"),t=Fe(e,Oa("endDate","asc"));return(await xt(t)).docs.map(n=>{var o,s;return{id:n.id,...n.data(),startDate:(o=n.data().startDate)!=null&&o.toDate?n.data().startDate.toDate():null,endDate:(s=n.data().endDate)!=null&&s.toDate?n.data().endDate.toDate():null}})}async function Td(e){const t={...e};t.startDate instanceof Date&&(t.startDate=El.fromDate(t.startDate)),t.endDate instanceof Date&&(t.endDate=El.fromDate(t.endDate));const a=e.id;if(!a)delete t.id,await ha(Ie(H,"daily_tasks"),t);else{const n=Z(H,"daily_tasks",a);delete t.id,await Bn(n,t,{merge:!0})}}async function Cd(e){if(!e)throw new Error("Task ID is required for deletion.");await Vc(Z(H,"daily_tasks",e))}async function Bd(){const e=Ie(H,"all_submissions_log"),t=Fe(e,Le("status","in",["pending","auditing","flagged_suspicious"]),Oa("submittedAt","desc"));return(await xt(t)).docs.map(n=>{var s,i;const o=n.data();return{userId:o.userId,walletAddress:o.walletAddress,submissionId:n.id,...o,submittedAt:(s=o.submittedAt)!=null&&s.toDate?o.submittedAt.toDate():null,resolvedAt:(i=o.resolvedAt)!=null&&i.toDate?o.resolvedAt.toDate():null}})}async function hs(e,t,a){var k,v,T;if(!e)throw new Error("User ID (walletAddress) is required.");const n=e.toLowerCase(),o=Z(H,"airdrop_users",n),s=Z(H,"airdrop_users",n,"submissions",t),i=Z(H,"all_submissions_log",t),[r,l,c]=await Promise.all([we(o),we(s),we(i)]);if(!l.exists())throw new Error("Submission not found in user collection.");if(!r.exists())throw new Error("User profile not found.");c.exists()||console.warn(`Log entry ${t} not found. Log will not be updated.`);const d=l.data(),f=r.data(),g=d.status;if(g===a){console.warn(`Admin action ignored: Submission ${t} already has status ${a}.`);return}const m=An(H),h={};let w=0,y=d._multiplierApplied||0;if(a==="approved"){let I=d._pointsCalculated;if(typeof I!="number"||isNaN(I)||I<=0){console.warn(`[Admin] Legacy/Invalid submission ${t} missing/invalid _pointsCalculated. Recalculating...`);const N=d.basePoints||0,S=f.approvedSubmissionsCount||0,$=oo(S);if(I=Math.round(N*$),isNaN(I)||I<=0){console.warn(`[Admin] Recalculation failed (basePoints: ${N}). Using fallback 1000.`);const F=oo(S);I=Math.round(1e3*F)}y=$}w=I,h.totalPoints=Ne(I),h.approvedSubmissionsCount=Ne(1),g==="rejected"&&(h.rejectedCount=Ne(-1))}else if(a==="rejected"){if(g!=="rejected"){const I=f.rejectedCount||0;h.rejectedCount=Ne(1),I+1>=3&&(h.isBanned=!0)}else if(g==="approved"){const I=d.pointsAwarded||0;h.totalPoints=Ne(-I),h.approvedSubmissionsCount=Ne(-1);const N=f.rejectedCount||0;h.rejectedCount=Ne(1),N+1>=3&&(h.isBanned=!0)}w=0}if(((k=h.approvedSubmissionsCount)==null?void 0:k.operand)<0&&(f.approvedSubmissionsCount||0)<=0&&(h.approvedSubmissionsCount=0),((v=h.rejectedCount)==null?void 0:v.operand)<0&&(f.rejectedCount||0)<=0&&(h.rejectedCount=0),((T=h.totalPoints)==null?void 0:T.operand)<0){const I=f.totalPoints||0,N=Math.abs(h.totalPoints.operand);I<N&&(h.totalPoints=0)}Object.keys(h).length>0&&m.update(o,h),m.update(s,{status:a,pointsAwarded:w,_pointsCalculated:a==="approved"?w:d._pointsCalculated||0,_multiplierApplied:y,resolvedAt:Be()}),c.exists()&&m.update(i,{status:a,resolvedAt:Be()}),await m.commit()}async function Ad(){const e=Ie(H,"airdrop_users"),t=Fe(e,Oa("totalPoints","desc"));return(await xt(t)).docs.map(n=>({id:n.id,...n.data()}))}async function Id(e,t){if(!e)throw new Error("User ID is required.");const a=e.toLowerCase(),n=Ie(H,"airdrop_users",a,"submissions"),o=Fe(n,Le("status","==",t),Oa("resolvedAt","desc"));return(await xt(o)).docs.map(i=>{var r,l;return{submissionId:i.id,userId:a,...i.data(),submittedAt:(r=i.data().submittedAt)!=null&&r.toDate?i.data().submittedAt.toDate():null,resolvedAt:(l=i.data().resolvedAt)!=null&&l.toDate?i.data().resolvedAt.toDate():null}})}async function tr(e,t){if(!e)throw new Error("User ID is required.");const a=e.toLowerCase(),n=Z(H,"airdrop_users",a),o={isBanned:t};t===!1&&(o.rejectedCount=0),await Sa(n,o)}const _l={faucet:{points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{points:500,maxCount:10,cooldownHours:0,enabled:!0}};async function ar(){try{const e=Z(H,"airdrop_public_data","data_v1"),t=await we(e);return t.exists()&&t.data().platformUsageConfig?t.data().platformUsageConfig:_l}catch(e){return console.error("Error fetching platform usage config:",e),_l}}async function yi(){it();try{const e=Ie(H,"airdrop_users",Ae,"platform_usage"),t=await xt(e),a={};return t.forEach(n=>{a[n.id]=n.data()}),a}catch(e){return console.error("Error fetching platform usage:",e),{}}}async function kb(e,t){var o;it();const n=(await ar())[e];if(!n)return console.error(`Invalid action type: ${e}`),{success:!1,reason:"invalid_action"};if(n.enabled===!1)return{success:!1,reason:"action_disabled"};try{const s=Z(H,"airdrop_users",Ae,"platform_usage",e),i=await we(s),r=i.exists()?i.data():{count:0,totalPoints:0,txHashes:[],lastClaimed:null};if(r.count>=n.maxCount)return console.log(`Max usage reached for ${e}: ${r.count}/${n.maxCount}`),{success:!1,reason:"max_reached"};if(n.cooldownHours>0&&r.lastClaimed){const h=new Date(r.lastClaimed),w=(Date.now()-h.getTime())/(1e3*60*60);if(w<n.cooldownHours){const y=n.cooldownHours-w;return console.log(`Cooldown active for ${e}: ${y.toFixed(1)}h remaining`),{success:!1,reason:"cooldown",hoursLeft:Math.ceil(y)}}}if(t&&((o=r.txHashes)!=null&&o.includes(t)))return console.log(`Duplicate txHash for ${e}: ${t}`),{success:!1,reason:"duplicate_tx"};const l=n.points,c=r.count+1,d=r.totalPoints+l,f=t?[...r.txHashes||[],t].slice(-20):r.txHashes||[],g=An(H);g.set(s,{count:c,totalPoints:d,lastClaimed:new Date().toISOString(),txHashes:f});const m=Z(H,"airdrop_users",Ae);return g.update(m,{platformUsagePoints:Ne(l),totalPoints:Ne(l)}),await g.commit(),console.log(`âœ… Platform usage recorded: ${e} +${l} pts (${c}/${n.maxCount})`),{success:!0,pointsAwarded:l,newCount:c,maxCount:n.maxCount}}catch(s){return console.error(`Error recording platform usage for ${e}:`,s),{success:!1,reason:"error",message:s.message}}}async function Eb(e){it();const a=(await ar())[e];if(!a||a.enabled===!1)return{canDo:!1,count:0,maxCount:0,reason:"disabled"};try{const n=Z(H,"airdrop_users",Ae,"platform_usage",e),o=await we(n),s=o.exists()?o.data():{count:0,lastClaimed:null};if(s.count>=a.maxCount)return{canDo:!1,count:s.count,maxCount:a.maxCount,reason:"max_reached"};if(a.cooldownHours>0&&s.lastClaimed){const i=new Date(s.lastClaimed),r=(Date.now()-i.getTime())/(1e3*60*60);if(r<a.cooldownHours){const l=a.cooldownHours-r;return{canDo:!1,count:s.count,maxCount:a.maxCount,cooldownLeft:Math.ceil(l*60),reason:"cooldown"}}}return{canDo:!0,count:s.count,maxCount:a.maxCount,points:a.points}}catch(n){return console.error(`Error checking platform action ${e}:`,n),{canDo:!1,count:0,maxCount:0,reason:"error"}}}async function nr(e){it();const t=Z(H,"airdrop_public_data","data_v1");await Sa(t,{platformUsageConfig:e}),console.log("âœ… Platform usage config saved:",e)}const Tb=Object.freeze(Object.defineProperty({__proto__:null,addDoc:ha,addOrUpdateDailyTask:Td,addSubmission:vd,canDoPlatformAction:Eb,collection:Ie,confirmSubmission:wd,deleteDailyTask:Cd,deleteDoc:Vc,deleteSubmission:er,doc:Z,firestoreDb:H,formatWeiToBKC:hb,getAirdropUser:cn,getAllAirdropUsers:Ad,getAllSubmissionsForAdmin:Bd,getAllTasksForAdmin:Ed,getDocs:xt,getPlatformUsage:yi,getPlatformUsageConfig:ar,getPublicAirdropData:xs,getUserFlaggedSubmissions:yb,getUserSubmissions:yd,getUserSubmissionsForAdmin:Id,increment:Ne,isTaskEligible:Qi,onSnapshot:xa,query:Fe,recordDailyTaskCompletion:hd,recordPlatformUsage:kb,resolveFlaggedSubmission:wb,savePlatformUsageConfig:nr,serverTimestamp:Be,setBanStatus:tr,setDoc:Bn,signIn:Zi,updateDoc:Sa,updateSubmissionStatus:hs,updateUgcBasePoints:kd,where:Le},Symbol.toStringTag,{value:"Module"})),Y=window.ethers,Yo=11155111,Cb="0xaa36a7";let tt=null,Qt=0;const Rl=3,Bb=6e4;let or=0;const Ab=3;let Pd=null;const Ib="cd4bdedee7a7e909ebd3df8bbc502aed",Fl={chainId:Ke.chainIdDecimal,name:Ke.chainName,currency:Ke.nativeCurrency.symbol,explorerUrl:Ke.blockExplorerUrls[0],rpcUrl:Ke.rpcUrls[0]},Pb={name:"Backcoin Protocol",description:"DeFi Ecosystem",url:window.location.origin,icons:[window.location.origin+"/assets/bkc_logo_3d.png"]},Nb=Wm({metadata:Pb,enableEIP6963:!0,enableInjected:!0,enableCoinbase:!1,rpcUrl:Yi,defaultChainId:Yo,enableEmail:!0,enableEns:!1,auth:{email:!0,showWallets:!0,walletFeatures:!0}}),Ve=Gm({ethersConfig:Nb,chains:[Fl],projectId:Ib,enableAnalytics:!0,themeMode:"dark",themeVariables:{"--w3m-accent":"#f59e0b","--w3m-border-radius-master":"1px","--w3m-z-index":100},defaultChain:Fl,defaultAccountTypes:{eip155:"eoa"},preferredAccountType:"eoa"});var Gc;try{(Gc=Ve.setPreferredAccountType)==null||Gc.call(Ve,"eoa")}catch{}function pn(e){return e?!!(e.isMetaMask||e.isCoinbaseWallet||e.isBraveWallet||e.isRabby||e.isTrust):!1}function zb(e){var n,o;const t=((n=e==null?void 0:e.message)==null?void 0:n.toLowerCase())||"",a=(e==null?void 0:e.code)||((o=e==null?void 0:e.error)==null?void 0:o.code);return a===-32603||a===-32e3||a===429||t.includes("failed to fetch")||t.includes("network error")||t.includes("timeout")||t.includes("rate limit")||t.includes("too many requests")||t.includes("internal json-rpc")||t.includes("unexpected token")||t.includes("<html")}function wi(e){return new Y.JsonRpcProvider(e||yn())}async function Nd(e,t=Ab){var n;let a=null;for(let o=0;o<t;o++)try{const s=await e();return Xc(yn()),or=0,s}catch(s){if(a=s,zb(s)){console.warn(`âš ï¸ RPC error (attempt ${o+1}/${t}):`,(n=s.message)==null?void 0:n.slice(0,80)),qc(yn());const i=qi();console.log(`ðŸ”„ Switching to: ${i}`),await vs(),await new Promise(r=>setTimeout(r,500*(o+1)))}else throw s}throw console.error("âŒ All RPC attempts failed"),a}async function vs(){const e=yn();try{u.publicProvider=wi(e),Pd=u.publicProvider;const t=u.publicProvider;Q(E.bkcToken)&&(u.bkcTokenContractPublic=new Y.Contract(E.bkcToken,cs,t)),Q(E.backchainEcosystem)&&(u.ecosystemManagerContractPublic=new Y.Contract(E.backchainEcosystem,Yt,t)),Q(E.stakingPool)&&(u.stakingPoolContractPublic=new Y.Contract(E.stakingPool,ds,t)),Q(E.buybackMiner)&&(u.buybackMinerContractPublic=new Y.Contract(E.buybackMiner,Ua,t)),Q(E.fortunePool)&&(u.fortunePoolContractPublic=new Y.Contract(E.fortunePool,us,t)),Q(E.agora)&&(u.agoraContractPublic=new Y.Contract(E.agora,la,t)),Q(E.notary)&&(u.notaryContractPublic=new Y.Contract(E.notary,ps,t)),Q(E.charityPool)&&(u.charityPoolContractPublic=new Y.Contract(E.charityPool,gs,t)),Q(E.rentalManager)&&(u.rentalManagerContractPublic=new Y.Contract(E.rentalManager,In,t)),Q(E.faucet)&&(u.faucetContractPublic=new Y.Contract(E.faucet,fs,t)),console.log(`âœ… Public provider recreated with: ${e.slice(0,50)}...`)}catch(t){console.error("Failed to recreate public provider:",t)}}function $b(e){if(!e)return!1;try{return Y.isAddress(e)}catch{return!1}}function Q(e){return e&&e!==Y.ZeroAddress&&!e.startsWith("0x...")}function Sb(e){if(!e)return;const t=localStorage.getItem(`balance_${e.toLowerCase()}`);if(t)try{u.currentUserBalance=BigInt(t),window.updateUIState&&window.updateUIState()}catch{}}function Lb(e){try{const t=e;Q(E.bkcToken)&&(u.bkcTokenContract=new Y.Contract(E.bkcToken,cs,t)),Q(E.backchainEcosystem)&&(u.ecosystemManagerContract=new Y.Contract(E.backchainEcosystem,Yt,t)),Q(E.stakingPool)&&(u.stakingPoolContract=new Y.Contract(E.stakingPool,ds,t)),Q(E.buybackMiner)&&(u.buybackMinerContract=new Y.Contract(E.buybackMiner,Ua,t)),Q(E.rewardBooster)&&(u.rewardBoosterContract=new Y.Contract(E.rewardBooster,ad,t)),Q(E.fortunePool)&&(u.fortunePoolContract=new Y.Contract(E.fortunePool,us,t)),Q(E.agora)&&(u.agoraContract=new Y.Contract(E.agora,la,t)),Q(E.notary)&&(u.notaryContract=new Y.Contract(E.notary,ps,t)),Q(E.charityPool)&&(u.charityPoolContract=new Y.Contract(E.charityPool,gs,t)),Q(E.rentalManager)&&(u.rentalManagerContract=new Y.Contract(E.rentalManager,In,t)),Q(E.faucet)&&(u.faucetContract=new Y.Contract(E.faucet,fs,t))}catch{console.warn("Contract init partial failure")}}let _o=0;const _b=5e3,zd=5;function $d(){if(tt&&(clearInterval(tt),tt=null),!u.bkcTokenContractPublic||!u.userAddress){console.warn("Cannot start balance polling: missing contract or address");return}Qt=0,or=0,_o=0,tt=setInterval(()=>{Dl(),_o++,_o>=zd&&(clearInterval(tt),tt=setInterval(Dl,Bb),console.log("âœ… Balance polling: switched to 60s interval"))},_b),console.log("âœ… Balance polling started (5s fast â†’ 60s normal)")}async function Dl(){var e;if(!document.hidden&&!(!u.isConnected||!u.userAddress)&&u.bkcTokenContractPublic)try{const t=await Nd(async()=>await u.bkcTokenContractPublic.balanceOf(u.userAddress),2);Qt=0;const a=u.currentUserBalance||0n;if(t.toString()!==a.toString()&&(console.log("[Poll] Balance changed:",Y.formatEther(a),"â†’",Y.formatEther(t),"BKC"),u.currentUserBalance=t,localStorage.setItem(`balance_${u.userAddress.toLowerCase()}`,t.toString()),window.updateUIState&&window.updateUIState(!1)),_o<zd&&u.publicProvider)try{const o=await u.publicProvider.getBalance(u.userAddress);o!==u.currentUserNativeBalance&&(u.currentUserNativeBalance=o)}catch{}}catch(t){Qt++,Qt<=3&&console.warn(`âš ï¸ Balance check failed (${Qt}/${Rl}):`,(e=t.message)==null?void 0:e.slice(0,50)),Qt>=Rl&&(console.warn("âŒ Too many balance check errors. Stopping polling temporarily."),tt&&(clearInterval(tt),tt=null),setTimeout(()=>{console.log("ðŸ”„ Attempting to restart balance polling with primary RPC..."),Jc(),vs().then(()=>{Qt=0,$d()})},6e4))}}async function Rb(e){const t=(e==null?void 0:e.provider)||u.web3Provider;if(!pn(t))return!0;try{const a=await e.getNetwork();if(Number(a.chainId)===Yo)return!0;try{return await e.send("wallet_switchEthereumChain",[{chainId:Cb}]),!0}catch{return!0}}catch{return!0}}let Bo=!1,Ao=null;async function Ml(e,t){if(Bo)return Ao=t,console.log("[Wallet] Setup in progress, queued reload for",t==null?void 0:t.slice(0,10)),!0;Bo=!0;try{if(!$b(t))return Bo=!1,!1;const a=(e==null?void 0:e.provider)||u.web3Provider,n=!pn(a);if(n){try{const o=Ve.getChainId();if(o!==Yo){console.log(`[Wallet] Embedded wallet on chain ${o}, switching...`),await Ve.switchNetwork(Yo);try{Ve.close()}catch{}}}catch(o){console.warn("[Wallet] Network switch error:",o.message)}if(t){const o=Ve.getWalletProvider()||u.web3Provider;if(o){if(o.request&&!o._bkcPatched){const s=o.request.bind(o);o.request=async function(i){return(i==null?void 0:i.method)==="eth_requestAccounts"?[t]:s(i)},o._bkcPatched=!0}e=new Y.BrowserProvider(o)}}}else await Rb(e);u.provider=e;try{n&&t?(u.signer=new Y.JsonRpcSigner(e,t),console.log("[Wallet] Embedded signer created for",t.slice(0,10)+"...")):u.signer=await e.getSigner(t)}catch(o){u.signer=e,console.warn("Could not get Signer. Read-only mode.",o.message)}u.userAddress=t,u.isConnected=!0,Sb(t),Lb(u.signer);try{Zi(u.userAddress)}catch{}return await Ol(t,!0),$d(),!0}catch(a){return console.error("Setup warning:",a),!!t}finally{if(Bo=!1,Ao){const a=Ao;Ao=null,Ol(a,!0)}}}async function Ol(e,t=!1){try{await Pn(t),window.updateUIState&&window.updateUIState(!1)}catch(a){console.warn("[Wallet] loadUserData failed:",a.message)}if(!u.currentUserBalance&&u.bkcTokenContractPublic&&e)try{const a=await u.bkcTokenContractPublic.balanceOf(e);a>0n&&(u.currentUserBalance=a,console.log("[Wallet] Direct balance read:",Y.formatEther(a),"BKC"),window.updateUIState&&window.updateUIState(!1))}catch{}}async function Fb(){try{if(window.ethereum&&pn(window.ethereum)){const a=await id();a.fixed?console.log("âœ… MetaMask network config was auto-fixed"):!a.success&&!a.skipped&&console.warn("Initial network config check:",a.error)}const e=yn();console.log(`ðŸŒ Initializing public provider with: ${e.slice(0,50)}...`),u.publicProvider=wi(e),Pd=u.publicProvider;const t=u.publicProvider;Q(E.bkcToken)&&(u.bkcTokenContractPublic=new Y.Contract(E.bkcToken,cs,t)),Q(E.backchainEcosystem)&&(u.ecosystemManagerContractPublic=new Y.Contract(E.backchainEcosystem,Yt,t)),Q(E.stakingPool)&&(u.stakingPoolContractPublic=new Y.Contract(E.stakingPool,ds,t)),Q(E.buybackMiner)&&(u.buybackMinerContractPublic=new Y.Contract(E.buybackMiner,Ua,t)),Q(E.fortunePool)&&(u.fortunePoolContractPublic=new Y.Contract(E.fortunePool,us,t)),Q(E.agora)&&(u.agoraContractPublic=new Y.Contract(E.agora,la,t)),Q(E.notary)&&(u.notaryContractPublic=new Y.Contract(E.notary,ps,t)),Q(E.charityPool)&&(u.charityPoolContractPublic=new Y.Contract(E.charityPool,gs,t)),Q(E.rentalManager)&&(u.rentalManagerContractPublic=new Y.Contract(E.rentalManager,In,t)),Q(E.faucet)&&(u.faucetContractPublic=new Y.Contract(E.faucet,fs,t));try{await Nd(async()=>{await fd()})}catch{console.warn("Initial public data load failed, will retry on user interaction")}window.ethereum&&pn(window.ethereum)&&rd(async a=>{a.isCorrectNetwork?(await no()).healthy||(console.log("âš ï¸ RPC issues after network change, updating..."),await wn(),await vs()):(console.log("âš ï¸ User switched to wrong network"),x("Please switch to Sepolia network","warning"))}),Mb(),window.updateUIState&&window.updateUIState(),console.log("âœ… Public provider initialized")}catch(e){console.error("Public provider error:",e),window.ethereum&&pn(window.ethereum)&&await wn();const t=qi();console.log(`ðŸ”„ Retrying with: ${t}`);try{u.publicProvider=wi(t),console.log("âœ… Public provider initialized with fallback RPC")}catch{console.error("âŒ All RPC endpoints failed")}}}function Db(e){let t=Ve.getAddress();if(Ve.getIsConnected()&&t){const n=Ve.getWalletProvider();if(n){const o=new Y.BrowserProvider(n);u.web3Provider=n,e({isConnected:!0,address:t,isNewConnection:!1}),Ml(o,t)}}const a=async({provider:n,address:o,chainId:s,isConnected:i})=>{try{if(console.log(`[Wallet] subscribeProvider event: connected=${i}, chain=${s}, addr=${(o==null?void 0:o.slice(0,10))||"null"}, hasProvider=${!!n}`),i){let r=o||Ve.getAddress();if(!r&&n)try{const c=await new Y.BrowserProvider(n).send("eth_accounts",[]);r=(c==null?void 0:c[0])||null}catch{try{r=await(await new Y.BrowserProvider(n).getSigner()).getAddress()}catch{}}if(r){const l=new Y.BrowserProvider(n);u.web3Provider=n,e({isConnected:!0,address:r,chainId:s,isNewConnection:!0}),await Ml(l,r)}else tt&&clearInterval(tt),u.isConnected=!1,u.userAddress=null,u.signer=null,e({isConnected:!1})}else tt&&clearInterval(tt),u.isConnected=!1,u.userAddress=null,u.signer=null,e({isConnected:!1})}catch{}};Ve.subscribeProvider(a)}function ys(){Ve.open()}async function Sd(){await Ve.disconnect()}function Mb(){let e=0;document.addEventListener("visibilitychange",async()=>{if(!document.hidden&&u.isConnected){const t=Date.now();if(t-e<3e5)return;(await no()).healthy||(e=t,console.log("âš ï¸ RPC unhealthy on tab focus, fixing..."),window.ethereum&&pn(window.ethereum)&&await wn(),await vs(),Qt=0,or=0)}}),console.log("âœ… RPC health monitoring started (event-driven, no polling)")}const Ld=window.ethers,j=(e,t=18)=>{if(e===null||typeof e>"u")return 0;if(typeof e=="number")return e;if(typeof e=="string")return parseFloat(e);try{const a=BigInt(e);return parseFloat(Ld.formatUnits(a,t))}catch{return 0}},St=e=>!e||typeof e!="string"||!e.startsWith("0x")?"...":`${e.substring(0,6)}...${e.substring(e.length-4)}`,kn=e=>{try{if(e==null)return"0";const t=typeof e=="bigint"?e:BigInt(e);if(t===0n)return"0";const a=parseFloat(Ld.formatEther(t));if(a===0||!isFinite(a))return"0";if(a<1e3)return a<.01?"<0.01":a%1===0?a.toString():a.toFixed(2);const n=["","k","M","B","T"],o=Math.min(Math.floor(Math.log10(a)/3),n.length-1);return(a/Math.pow(1e3,o)).toFixed(2)+n[o]}catch{return"0"}},Ob=(e="An error occurred.")=>`<div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-center text-red-400 text-sm">${e}</div>`;function sr(e,t,a,n){if(!e)return;if(a<=1){e.innerHTML="";return}const o=`
        <div class="flex items-center justify-center gap-3 mt-4">
            <button class="pagination-btn prev-page-btn w-8 h-8 flex items-center justify-center rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed" 
                data-page="${t-1}" ${t===1?"disabled":""}>
                <i class="fa-solid fa-chevron-left text-xs"></i>
            </button>
            <span class="text-xs text-zinc-400 font-mono bg-zinc-900 px-3 py-1 rounded border border-zinc-800">
                ${t} / ${a}
            </span>
            <button class="pagination-btn next-page-btn w-8 h-8 flex items-center justify-center rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed" 
                data-page="${t+1}" ${t===a?"disabled":""}>
                <i class="fa-solid fa-chevron-right text-xs"></i>
            </button>
        </div>
    `;e.innerHTML=o,e.querySelectorAll(".pagination-btn").forEach(s=>{s.addEventListener("click",()=>{s.hasAttribute("disabled")||n(parseInt(s.dataset.page))})})}const _d="/api/faucet";function ws(){var e;return(E==null?void 0:E.faucet)||(R==null?void 0:R.faucet)||((e=window.contractAddresses)==null?void 0:e.faucet)||null}const qo=["function claim() external","function canClaim(address user) view returns (bool)","function getUserInfo(address user) view returns (uint256 lastClaim, uint256 claims, bool eligible, uint256 cooldownLeft)","function getCooldownRemaining(address user) view returns (uint256)","function cooldown() view returns (uint256)","function tokensPerClaim() view returns (uint256)","function ethPerClaim() view returns (uint256)","function paused() view returns (bool)","function getFaucetStatus() view returns (uint256 ethBalance, uint256 tokenBalance, uint256 ethPerDrip, uint256 tokensPerDrip, uint256 estimatedEthClaims, uint256 estimatedTokenClaims)","function getStats() view returns (uint256 tokens, uint256 eth, uint256 claims, uint256 users)","event Claimed(address indexed recipient, uint256 tokens, uint256 eth, address indexed via)"];function Ub(){var e,t;return typeof State<"u"&&(State!=null&&State.userAddress)?State.userAddress:(e=window.State)!=null&&e.userAddress?window.State.userAddress:window.userAddress?window.userAddress:(t=window.ethereum)!=null&&t.selectedAddress?window.ethereum.selectedAddress:null}function wa(e,t="info"){if(typeof window.showToast=="function"){window.showToast(e,t);return}(t==="error"?console.error:console.log)(`[Faucet] ${e}`)}async function Rd(){if(typeof window.loadUserData=="function"){await window.loadUserData();return}if(typeof window.refreshBalances=="function"){await window.refreshBalances();return}}async function ir({button:e=null,address:t=null,onSuccess:a=null,onError:n=null}={}){const o=t||Ub();if(!o){const r="Please connect wallet first";return wa(r,"error"),n&&n(new Error(r)),{success:!1,error:r}}const s=(e==null?void 0:e.innerHTML)||"Claim",i=(e==null?void 0:e.disabled)||!1;e&&(e.innerHTML='<div class="loader inline-block"></div> Claiming...',e.disabled=!0);try{const r=await fetch(`${_d}?address=${o}`,{method:"GET",headers:{Accept:"application/json"}}),l=await r.json();if(r.ok&&l.success){wa("Tokens received!","success"),await Rd();const c={success:!0,txHash:l.txHash,bkcAmount:l.bkcAmount,ethAmount:l.ethAmount};return a&&a(c),c}else{const c=l.error||l.message||"Faucet unavailable";wa(c,"error");const d=new Error(c);return n&&n(d),{success:!1,error:c}}}catch(r){return console.error("Faucet error:",r),wa("Faucet unavailable","error"),n&&n(r),{success:!1,error:r.message}}finally{e&&(e.innerHTML=s,e.disabled=i)}}const rr=async e=>await ir({button:e});async function Fd({button:e=null,onSuccess:t=null,onError:a=null}={}){const n=ws();if(!n){const s="Faucet contract address not configured";return wa(s,"error"),a&&a(new Error(s)),{success:!1,error:s}}const{txEngine:o}=await U(async()=>{const{txEngine:s}=await Promise.resolve().then(()=>q);return{txEngine:s}},void 0);return await o.execute({name:"FaucetClaim",button:e,getContract:async s=>{const i=window.ethers;return new i.Contract(n,qo,s)},method:"claim",args:[],validate:async(s,i)=>{const r=window.ethers,{NetworkManager:l}=await U(async()=>{const{NetworkManager:f}=await Promise.resolve().then(()=>q);return{NetworkManager:f}},void 0),c=l.getProvider(),d=new r.Contract(n,qo,c);try{const f=await d.getUserInfo(i),g=f[2],m=Number(f[3]);if(!g){if(m>0){const h=Math.ceil(m/60);throw new Error(`Aguarde ${h} minutos para claimar novamente`)}throw new Error("Faucet indisponÃ­vel no momento")}}catch(f){if(f.message.includes("Aguarde")||f.message.includes("indisponÃ­vel"))throw f;if(!await d.canClaim(i))throw new Error("Aguarde o cooldown para claimar novamente.")}},onSuccess:async s=>{wa("Tokens received!","success"),await Rd(),t&&t(s)},onError:s=>{wa(s.message||"Claim failed","error"),a&&a(s)}})}async function Dd(e){const t=ws();if(!t)return{canClaim:!1,error:"Faucet not configured"};try{const a=window.ethers,{NetworkManager:n}=await U(async()=>{const{NetworkManager:i}=await Promise.resolve().then(()=>q);return{NetworkManager:i}},void 0),o=n.getProvider(),s=new a.Contract(t,qo,o);try{const i=await s.getUserInfo(e);return{canClaim:i[2],lastClaimTime:Number(i[0]),claimCount:Number(i[1]),cooldownLeft:Number(i[3]),waitSeconds:Number(i[3])}}catch{return{canClaim:await s.canClaim(e),waitSeconds:0}}}catch(a){return console.error("Error checking claim status:",a),{canClaim:!1,error:a.message}}}async function Md(){const e=ws();if(!e)return{error:"Faucet not configured"};try{const t=window.ethers,{NetworkManager:a}=await U(async()=>{const{NetworkManager:s}=await Promise.resolve().then(()=>q);return{NetworkManager:s}},void 0),n=a.getProvider(),o=new t.Contract(e,qo,n);try{const s=await o.getFaucetStatus(),i=s[0],r=s[1],l=s[2],c=s[3];return{bkcAmount:c,ethAmount:l,bkcAmountFormatted:t.formatEther(c),ethAmountFormatted:t.formatEther(l),bkcBalance:r,ethBalance:i,bkcBalanceFormatted:t.formatEther(r),ethBalanceFormatted:t.formatEther(i),estimatedEthClaims:Number(s[4]),estimatedTokenClaims:Number(s[5]),cooldownSeconds:Number(await o.cooldown()),cooldownMinutes:Number(await o.cooldown())/60,isPaused:await o.paused()}}catch{const[s,i,r]=await Promise.all([o.tokensPerClaim(),o.ethPerClaim(),o.cooldown()]);return{bkcAmount:s,ethAmount:i,cooldownSeconds:Number(r),cooldownMinutes:Number(r)/60,bkcAmountFormatted:t.formatEther(s),ethAmountFormatted:t.formatEther(i)}}}catch(t){return console.error("Error getting faucet info:",t),{error:t.message}}}const Hb={claim:ir,claimOnChain:Fd,executeFaucetClaim:rr,canClaim:Dd,getFaucetInfo:Md,getFaucetAddress:ws,FAUCET_API_URL:_d},jb=Object.freeze(Object.defineProperty({__proto__:null,FaucetTx:Hb,canClaim:Dd,claim:ir,claimOnChain:Fd,executeFaucetClaim:rr,getFaucetInfo:Md},Symbol.toStringTag,{value:"Module"})),Ro={BALANCE:1e4,ALLOWANCE:3e4},Je=new Map,Ee={hits:0,misses:0,sets:0,invalidations:0},aa={get(e){const t=Je.get(e);if(!t){Ee.misses++;return}if(Date.now()>t.expiresAt){Je.delete(e),Ee.misses++;return}return Ee.hits++,t.value},set(e,t,a){t!=null&&(Je.set(e,{value:t,expiresAt:Date.now()+a,createdAt:Date.now()}),Ee.sets++)},delete(e){Je.delete(e)},clear(e){if(!e){Je.clear(),Ee.invalidations++;return}for(const t of Je.keys())t.includes(e)&&Je.delete(t);Ee.invalidations++},async getOrFetch(e,t,a){const n=this.get(e);if(n!==void 0)return n;try{const o=await t();return o!=null&&this.set(e,o,a),o}catch(o){throw console.warn(`[Cache] Error fetching ${e}:`,o.message),o}},has(e){return this.get(e)!==void 0},getTTL(e){const t=Je.get(e);if(!t)return 0;const a=t.expiresAt-Date.now();return a>0?a:0},invalidateByTx(e){const a={CreateCampaign:["campaign-","charity-stats","user-campaigns-","campaign-list"],Donate:["campaign-","charity-stats","token-balance-","allowance-"],CancelCampaign:["campaign-","charity-stats","user-campaigns-"],Withdraw:["campaign-","charity-stats","token-balance-"],Delegate:["delegation-","token-balance-","allowance-","user-pstake-","pending-rewards-","network-pstake"],Unstake:["delegation-","token-balance-","user-pstake-","pending-rewards-","network-pstake"],ForceUnstake:["delegation-","token-balance-","user-pstake-","pending-rewards-","network-pstake"],ClaimReward:["pending-rewards-","token-balance-","saved-rewards-"],BuyNFT:["pool-info-","pool-nfts-","token-balance-","allowance-","user-nfts-","buy-price-","sell-price-"],SellNFT:["pool-info-","pool-nfts-","token-balance-","user-nfts-","buy-price-","sell-price-"],PlayGame:["fortune-pool-","fortune-stats-","token-balance-","allowance-","user-fortune-history-"],ListNFT:["rental-listings-","rental-listing-","user-nfts-"],RentNFT:["rental-listing-","rental-active-","token-balance-","allowance-"],WithdrawNFT:["rental-listing-","rental-listings-","user-nfts-"],UpdateListing:["rental-listing-"],Notarize:["notary-","token-balance-","allowance-","user-documents-"],TokenTransfer:["token-balance-","allowance-"],Approval:["allowance-"],CreateProfile:["agora-profile-"],UpdateProfile:["agora-profile-"],CreatePost:["agora-feed-","agora-profile-"],CreateReply:["agora-feed-","agora-post-"],CreateRepost:["agora-feed-"],EditPost:["agora-feed-","agora-post-"],DeletePost:["agora-feed-","agora-post-","agora-profile-"],Like:["agora-post-"],SuperLike:["agora-post-","token-balance-"],Downvote:["agora-post-","token-balance-"],Follow:["agora-profile-","agora-following-"],Unfollow:["agora-profile-","agora-following-"],BlockUser:["agora-profile-"],UnblockUser:["agora-profile-"],PinPost:["agora-profile-"],ChangeTag:["agora-feed-","agora-post-"],BoostProfile:["agora-profile-","token-balance-"],ObtainBadge:["agora-profile-","token-balance-"],ReportPost:["agora-post-"],BoostPost:["agora-post-","token-balance-"],TipPost:["agora-post-","token-balance-"],FuseNFT:["user-nfts-","pool-info-"],SplitNFT:["user-nfts-","pool-info-"],SplitToNFT:["user-nfts-","pool-info-"]}[e];if(!a){console.warn(`[Cache] Unknown transaction type: ${e}`);return}a.forEach(n=>{this.clear(n)}),console.log(`[Cache] Invalidated patterns for ${e}:`,a)},getStats(){const e=Je.size,t=Ee.hits+Ee.misses>0?(Ee.hits/(Ee.hits+Ee.misses)*100).toFixed(1):0;return{entries:e,hits:Ee.hits,misses:Ee.misses,sets:Ee.sets,invalidations:Ee.invalidations,hitRate:`${t}%`}},keys(){return Array.from(Je.keys())},size(){return Je.size},cleanup(){const e=Date.now();let t=0;for(const[a,n]of Je.entries())e>n.expiresAt&&(Je.delete(a),t++);return t>0&&console.log(`[Cache] Cleanup removed ${t} expired entries`),t},resetMetrics(){Ee.hits=0,Ee.misses=0,Ee.sets=0,Ee.invalidations=0}},Fo={tokenBalance:(e,t)=>`token-balance-${e.toLowerCase()}-${t.toLowerCase()}`,ethBalance:e=>`eth-balance-${e.toLowerCase()}`,allowance:(e,t,a)=>`allowance-${e.toLowerCase()}-${t.toLowerCase()}-${a.toLowerCase()}`,campaign:e=>`campaign-${e}`,campaignList:()=>"campaign-list",charityStats:()=>"charity-stats",userCampaigns:e=>`user-campaigns-${e.toLowerCase()}`,delegation:(e,t)=>`delegation-${e.toLowerCase()}-${t}`,delegations:e=>`delegation-list-${e.toLowerCase()}`,userPStake:e=>`user-pstake-${e.toLowerCase()}`,pendingRewards:e=>`pending-rewards-${e.toLowerCase()}`,networkPStake:()=>"network-pstake",poolInfo:e=>`pool-info-${e.toLowerCase()}`,poolNfts:e=>`pool-nfts-${e.toLowerCase()}`,buyPrice:e=>`buy-price-${e.toLowerCase()}`,sellPrice:e=>`sell-price-${e.toLowerCase()}`,userNfts:e=>`user-nfts-${e.toLowerCase()}`,fortunePool:()=>"fortune-pool",fortuneTiers:()=>"fortune-tiers",fortuneStats:()=>"fortune-stats",userFortuneHistory:e=>`user-fortune-history-${e.toLowerCase()}`,rentalListings:()=>"rental-listings",rentalListing:e=>`rental-listing-${e}`,rentalActive:e=>`rental-active-${e}`,notaryDocument:e=>`notary-doc-${e}`,userDocuments:e=>`user-documents-${e.toLowerCase()}`,feeConfig:e=>`fee-config-${e}`,protocolConfig:()=>"protocol-config"},B={WRONG_NETWORK:"wrong_network",RPC_UNHEALTHY:"rpc_unhealthy",RPC_RATE_LIMITED:"rpc_rate_limited",NETWORK_ERROR:"network_error",WALLET_NOT_CONNECTED:"wallet_not_connected",WALLET_LOCKED:"wallet_locked",INSUFFICIENT_ETH:"insufficient_eth",INSUFFICIENT_TOKEN:"insufficient_token",INSUFFICIENT_ALLOWANCE:"insufficient_allowance",SIMULATION_REVERTED:"simulation_reverted",GAS_ESTIMATION_FAILED:"gas_estimation_failed",USER_REJECTED:"user_rejected",TX_REVERTED:"tx_reverted",TX_TIMEOUT:"tx_timeout",TX_REPLACED:"tx_replaced",TX_UNDERPRICED:"tx_underpriced",NONCE_ERROR:"nonce_error",CAMPAIGN_NOT_FOUND:"campaign_not_found",CAMPAIGN_NOT_ACTIVE:"campaign_not_active",CAMPAIGN_STILL_ACTIVE:"campaign_still_active",NOT_CAMPAIGN_CREATOR:"not_campaign_creator",DONATION_TOO_SMALL:"donation_too_small",MAX_CAMPAIGNS_REACHED:"max_campaigns_reached",INSUFFICIENT_ETH_FEE:"insufficient_eth_fee",LOCK_PERIOD_ACTIVE:"lock_period_active",LOCK_PERIOD_EXPIRED:"lock_period_expired",NO_REWARDS:"no_rewards",INVALID_DURATION:"invalid_duration",INVALID_DELEGATION_INDEX:"invalid_delegation_index",NFT_NOT_IN_POOL:"nft_not_in_pool",POOL_NOT_INITIALIZED:"pool_not_initialized",INSUFFICIENT_POOL_LIQUIDITY:"insufficient_pool_liquidity",SLIPPAGE_EXCEEDED:"slippage_exceeded",NFT_BOOST_MISMATCH:"nft_boost_mismatch",NOT_NFT_OWNER:"not_nft_owner",NO_ACTIVE_TIERS:"no_active_tiers",INVALID_GUESS_COUNT:"invalid_guess_count",INVALID_GUESS_RANGE:"invalid_guess_range",INSUFFICIENT_SERVICE_FEE:"insufficient_service_fee",RENTAL_STILL_ACTIVE:"rental_still_active",NFT_NOT_LISTED:"nft_not_listed",NFT_ALREADY_LISTED:"nft_already_listed",NOT_LISTING_OWNER:"not_listing_owner",MARKETPLACE_PAUSED:"marketplace_paused",EMPTY_METADATA:"empty_metadata",CONTRACT_ERROR:"contract_error",UNKNOWN:"unknown"},Do={[B.WRONG_NETWORK]:"Please switch to Sepolia network",[B.RPC_UNHEALTHY]:"Network connection issue. Retrying...",[B.RPC_RATE_LIMITED]:"Network is busy. Please wait a moment...",[B.NETWORK_ERROR]:"Network error. Please check your connection",[B.WALLET_NOT_CONNECTED]:"Please connect your wallet",[B.WALLET_LOCKED]:"Please unlock your wallet",[B.INSUFFICIENT_ETH]:"Insufficient BNB for gas fees",[B.INSUFFICIENT_TOKEN]:"Insufficient BKC balance",[B.INSUFFICIENT_ALLOWANCE]:"Token approval required",[B.SIMULATION_REVERTED]:"Transaction would fail. Please check your inputs",[B.GAS_ESTIMATION_FAILED]:"Could not estimate gas. Transaction may fail",[B.USER_REJECTED]:"Transaction cancelled",[B.TX_REVERTED]:"Transaction failed on blockchain",[B.TX_TIMEOUT]:"Transaction is taking too long. Please check your wallet",[B.TX_REPLACED]:"Transaction was replaced",[B.TX_UNDERPRICED]:"Gas price too low. Please try again",[B.NONCE_ERROR]:"Transaction sequence error. Please refresh and try again",[B.CAMPAIGN_NOT_FOUND]:"Campaign not found",[B.CAMPAIGN_NOT_ACTIVE]:"This campaign is no longer accepting donations",[B.CAMPAIGN_STILL_ACTIVE]:"Campaign is still active. Please wait until the deadline",[B.NOT_CAMPAIGN_CREATOR]:"Only the campaign creator can perform this action",[B.DONATION_TOO_SMALL]:"Donation amount is below the minimum required",[B.MAX_CAMPAIGNS_REACHED]:"You have reached the maximum number of active campaigns",[B.INSUFFICIENT_ETH_FEE]:"Insufficient BNB for withdrawal fee",[B.LOCK_PERIOD_ACTIVE]:"Your tokens are still locked",[B.LOCK_PERIOD_EXPIRED]:"Lock period has expired. Use normal unstake",[B.NO_REWARDS]:"No rewards available to claim",[B.INVALID_DURATION]:"Lock duration must be between 1 day and 10 years",[B.INVALID_DELEGATION_INDEX]:"Delegation not found",[B.NFT_NOT_IN_POOL]:"This NFT is not available in the pool",[B.POOL_NOT_INITIALIZED]:"Pool is not active yet",[B.INSUFFICIENT_POOL_LIQUIDITY]:"Insufficient liquidity in pool",[B.SLIPPAGE_EXCEEDED]:"Price changed too much. Please try again",[B.NFT_BOOST_MISMATCH]:"NFT tier does not match this pool",[B.NOT_NFT_OWNER]:"You do not own this NFT",[B.NO_ACTIVE_TIERS]:"No active prize tiers available",[B.INVALID_GUESS_COUNT]:"Invalid number of guesses provided",[B.INVALID_GUESS_RANGE]:"Your guess is outside the valid range",[B.INSUFFICIENT_SERVICE_FEE]:"Incorrect service fee amount",[B.RENTAL_STILL_ACTIVE]:"This NFT is currently being rented",[B.NFT_NOT_LISTED]:"This NFT is not listed for rent",[B.NFT_ALREADY_LISTED]:"This NFT is already listed",[B.NOT_LISTING_OWNER]:"Only the listing owner can perform this action",[B.MARKETPLACE_PAUSED]:"Marketplace is temporarily paused",[B.EMPTY_METADATA]:"Document metadata cannot be empty",[B.CONTRACT_ERROR]:"Transaction cannot be completed. Please check your inputs and try again",[B.UNKNOWN]:"An unexpected error occurred. Please try again"},ga={[B.WRONG_NETWORK]:{layer:1,retry:!1,action:"switch_network"},[B.RPC_UNHEALTHY]:{layer:1,retry:!0,waitMs:2e3,action:"switch_rpc"},[B.RPC_RATE_LIMITED]:{layer:1,retry:!0,waitMs:"extract",action:"switch_rpc"},[B.NETWORK_ERROR]:{layer:1,retry:!0,waitMs:3e3,action:"switch_rpc"},[B.WALLET_NOT_CONNECTED]:{layer:2,retry:!1,action:"connect_wallet"},[B.WALLET_LOCKED]:{layer:2,retry:!1,action:"unlock_wallet"},[B.INSUFFICIENT_ETH]:{layer:3,retry:!1,action:"show_faucet"},[B.INSUFFICIENT_TOKEN]:{layer:3,retry:!1},[B.INSUFFICIENT_ALLOWANCE]:{layer:3,retry:!1},[B.SIMULATION_REVERTED]:{layer:4,retry:!1},[B.GAS_ESTIMATION_FAILED]:{layer:4,retry:!0,waitMs:2e3},[B.USER_REJECTED]:{layer:5,retry:!1},[B.TX_REVERTED]:{layer:5,retry:!1},[B.TX_TIMEOUT]:{layer:5,retry:!0,waitMs:5e3},[B.TX_REPLACED]:{layer:5,retry:!1},[B.TX_UNDERPRICED]:{layer:5,retry:!0,waitMs:1e3},[B.NONCE_ERROR]:{layer:5,retry:!0,waitMs:2e3},[B.CAMPAIGN_NOT_FOUND]:{layer:4,retry:!1},[B.CAMPAIGN_NOT_ACTIVE]:{layer:4,retry:!1},[B.CAMPAIGN_STILL_ACTIVE]:{layer:4,retry:!1},[B.NOT_CAMPAIGN_CREATOR]:{layer:4,retry:!1},[B.DONATION_TOO_SMALL]:{layer:4,retry:!1},[B.MAX_CAMPAIGNS_REACHED]:{layer:4,retry:!1},[B.INSUFFICIENT_ETH_FEE]:{layer:3,retry:!1},[B.LOCK_PERIOD_ACTIVE]:{layer:4,retry:!1},[B.LOCK_PERIOD_EXPIRED]:{layer:4,retry:!1},[B.NO_REWARDS]:{layer:4,retry:!1},[B.INVALID_DURATION]:{layer:4,retry:!1},[B.INVALID_DELEGATION_INDEX]:{layer:4,retry:!1},[B.NFT_NOT_IN_POOL]:{layer:4,retry:!1},[B.POOL_NOT_INITIALIZED]:{layer:4,retry:!1},[B.INSUFFICIENT_POOL_LIQUIDITY]:{layer:4,retry:!1},[B.SLIPPAGE_EXCEEDED]:{layer:4,retry:!0,waitMs:1e3},[B.NFT_BOOST_MISMATCH]:{layer:4,retry:!1},[B.NOT_NFT_OWNER]:{layer:4,retry:!1},[B.NO_ACTIVE_TIERS]:{layer:4,retry:!1},[B.INVALID_GUESS_COUNT]:{layer:4,retry:!1},[B.INVALID_GUESS_RANGE]:{layer:4,retry:!1},[B.INSUFFICIENT_SERVICE_FEE]:{layer:4,retry:!1},[B.RENTAL_STILL_ACTIVE]:{layer:4,retry:!1},[B.NFT_NOT_LISTED]:{layer:4,retry:!1},[B.NFT_ALREADY_LISTED]:{layer:4,retry:!1},[B.NOT_LISTING_OWNER]:{layer:4,retry:!1},[B.MARKETPLACE_PAUSED]:{layer:4,retry:!1},[B.EMPTY_METADATA]:{layer:4,retry:!1},[B.CONTRACT_ERROR]:{layer:4,retry:!1},[B.UNKNOWN]:{layer:5,retry:!1}},Ul=[{pattern:/user rejected/i,type:B.USER_REJECTED},{pattern:/user denied/i,type:B.USER_REJECTED},{pattern:/user cancel/i,type:B.USER_REJECTED},{pattern:/rejected by user/i,type:B.USER_REJECTED},{pattern:/cancelled/i,type:B.USER_REJECTED},{pattern:/canceled/i,type:B.USER_REJECTED},{pattern:/action_rejected/i,type:B.USER_REJECTED},{pattern:/too many errors/i,type:B.RPC_RATE_LIMITED},{pattern:/rate limit/i,type:B.RPC_RATE_LIMITED},{pattern:/retrying in/i,type:B.RPC_RATE_LIMITED},{pattern:/429/i,type:B.RPC_RATE_LIMITED},{pattern:/internal json-rpc/i,type:B.RPC_UNHEALTHY},{pattern:/-32603/i,type:B.RPC_UNHEALTHY},{pattern:/-32002/i,type:B.RPC_RATE_LIMITED},{pattern:/failed to fetch/i,type:B.NETWORK_ERROR},{pattern:/network error/i,type:B.NETWORK_ERROR},{pattern:/timeout/i,type:B.TX_TIMEOUT},{pattern:/insufficient funds/i,type:B.INSUFFICIENT_ETH},{pattern:/exceeds the balance/i,type:B.INSUFFICIENT_ETH},{pattern:/insufficient balance/i,type:B.INSUFFICIENT_TOKEN},{pattern:/transfer amount exceeds balance/i,type:B.INSUFFICIENT_TOKEN},{pattern:/exceeds balance/i,type:B.INSUFFICIENT_TOKEN},{pattern:/nonce/i,type:B.NONCE_ERROR},{pattern:/replacement.*underpriced/i,type:B.TX_UNDERPRICED},{pattern:/transaction underpriced/i,type:B.TX_UNDERPRICED},{pattern:/gas too low/i,type:B.TX_UNDERPRICED},{pattern:/reverted/i,type:B.TX_REVERTED},{pattern:/revert/i,type:B.TX_REVERTED},{pattern:/campaignnotfound/i,type:B.CAMPAIGN_NOT_FOUND},{pattern:/campaign not found/i,type:B.CAMPAIGN_NOT_FOUND},{pattern:/campaignnotactive/i,type:B.CAMPAIGN_NOT_ACTIVE},{pattern:/campaign.*not.*active/i,type:B.CAMPAIGN_NOT_ACTIVE},{pattern:/campaignstillactive/i,type:B.CAMPAIGN_STILL_ACTIVE},{pattern:/notcampaigncreator/i,type:B.NOT_CAMPAIGN_CREATOR},{pattern:/donationtoosmall/i,type:B.DONATION_TOO_SMALL},{pattern:/maxactivecampaignsreached/i,type:B.MAX_CAMPAIGNS_REACHED},{pattern:/insufficientethfee/i,type:B.INSUFFICIENT_ETH_FEE},{pattern:/lockperiodactive/i,type:B.LOCK_PERIOD_ACTIVE},{pattern:/lock.*period.*active/i,type:B.LOCK_PERIOD_ACTIVE},{pattern:/still.*locked/i,type:B.LOCK_PERIOD_ACTIVE},{pattern:/lockperiodexpired/i,type:B.LOCK_PERIOD_EXPIRED},{pattern:/norewardstoclaim/i,type:B.NO_REWARDS},{pattern:/no.*rewards/i,type:B.NO_REWARDS},{pattern:/invalidduration/i,type:B.INVALID_DURATION},{pattern:/invalidindex/i,type:B.INVALID_DELEGATION_INDEX},{pattern:/nftnotinpool/i,type:B.NFT_NOT_IN_POOL},{pattern:/poolnotinitialized/i,type:B.POOL_NOT_INITIALIZED},{pattern:/insufficientliquidity/i,type:B.INSUFFICIENT_POOL_LIQUIDITY},{pattern:/insufficientnfts/i,type:B.INSUFFICIENT_POOL_LIQUIDITY},{pattern:/slippageexceeded/i,type:B.SLIPPAGE_EXCEEDED},{pattern:/slippage/i,type:B.SLIPPAGE_EXCEEDED},{pattern:/nftboostmismatch/i,type:B.NFT_BOOST_MISMATCH},{pattern:/notnftowner/i,type:B.NOT_NFT_OWNER},{pattern:/noactivetiers/i,type:B.NO_ACTIVE_TIERS},{pattern:/invalidguesscount/i,type:B.INVALID_GUESS_COUNT},{pattern:/invalidguessrange/i,type:B.INVALID_GUESS_RANGE},{pattern:/insufficientservicefee/i,type:B.INSUFFICIENT_SERVICE_FEE},{pattern:/rentalstillactive/i,type:B.RENTAL_STILL_ACTIVE},{pattern:/nftnotlisted/i,type:B.NFT_NOT_LISTED},{pattern:/nftalreadylisted/i,type:B.NFT_ALREADY_LISTED},{pattern:/notlistingowner/i,type:B.NOT_LISTING_OWNER},{pattern:/marketplaceispaused/i,type:B.MARKETPLACE_PAUSED},{pattern:/emptymetadata/i,type:B.EMPTY_METADATA}],ae={classify(e){var n;if(e!=null&&e.errorType&&Object.values(B).includes(e.errorType))return e.errorType;const t=this._extractMessage(e),a=(e==null?void 0:e.code)||((n=e==null?void 0:e.error)==null?void 0:n.code);if(a===4001||a==="ACTION_REJECTED")return B.USER_REJECTED;if(a===-32002)return B.RPC_RATE_LIMITED;if(a===-32603||a==="CALL_EXCEPTION"){if(t.includes("base fee")||t.includes("basefee")||t.includes("max fee per gas")||t.includes("maxfeepergas")||t.includes("underpriced")||t.includes("gas too low"))return B.TX_UNDERPRICED;if(t.includes("revert")||t.includes("require")||t.includes("execution failed")||t.includes("call_exception")||(e==null?void 0:e.code)==="CALL_EXCEPTION"){for(const{pattern:o,type:s}of Ul)if(o.test(t))return s;return B.CONTRACT_ERROR}return B.RPC_UNHEALTHY}for(const{pattern:o,type:s}of Ul)if(o.test(t))return s;return B.UNKNOWN},_extractMessage(e){var a,n,o;return e?typeof e=="string"?e:[e.message,e.reason,(a=e.error)==null?void 0:a.message,(n=e.error)==null?void 0:n.reason,(o=e.data)==null?void 0:o.message,e.shortMessage,this._safeStringify(e)].filter(Boolean).join(" ").toLowerCase():""},_safeStringify(e){try{return JSON.stringify(e,(t,a)=>typeof a=="bigint"?a.toString():a)}catch{return""}},isUserRejection(e){return this.classify(e)===B.USER_REJECTED},isRetryable(e){var a;const t=this.classify(e);return((a=ga[t])==null?void 0:a.retry)||!1},getWaitTime(e){const t=this.classify(e),a=ga[t];return a?a.waitMs==="extract"?this._extractWaitTime(e):a.waitMs||2e3:2e3},_extractWaitTime(e){const t=this._extractMessage(e),a=t.match(/retrying in (\d+[,.]?\d*)\s*minutes?/i);if(a){const o=parseFloat(a[1].replace(",","."));return Math.ceil(o*60*1e3)+5e3}const n=t.match(/wait (\d+)\s*seconds?/i);return n?parseInt(n[1])*1e3+2e3:3e4},getMessage(e){const t=this.classify(e);return Do[t]||Do[B.UNKNOWN]},getConfig(e){const t=this.classify(e);return ga[t]||ga[B.UNKNOWN]},getLayer(e){var a;const t=this.classify(e);return((a=ga[t])==null?void 0:a.layer)||5},handle(e,t="Transaction"){const a=this.classify(e),n=ga[a]||{},o=this.getMessage(e);return console.error(`[${t}] Error:`,{type:a,layer:n.layer,retry:n.retry,message:o,original:e}),{type:a,message:o,retry:n.retry||!1,waitMs:n.retry?this.getWaitTime(e):0,layer:n.layer||5,action:n.action||null,original:e,context:t}},async handleWithRpcSwitch(e,t="Transaction"){const a=this.handle(e,t);if(a.action==="switch_rpc")try{const{NetworkManager:n}=await U(async()=>{const{NetworkManager:s}=await Promise.resolve().then(()=>Yb);return{NetworkManager:s}},void 0);console.log("[ErrorHandler] Switching RPC due to network error...");const o=n.switchToNextRpc();try{await n.updateMetaMaskRpcs(),console.log("[ErrorHandler] MetaMask RPC updated")}catch(s){console.warn("[ErrorHandler] Could not update MetaMask:",s.message)}a.rpcSwitched=!0,a.newRpc=o,a.waitMs=Math.min(a.waitMs,2e3)}catch(n){console.warn("[ErrorHandler] Could not switch RPC:",n.message),a.rpcSwitched=!1}return a},parseSimulationError(e,t){var i;const a=this.classify(e);let n=this.getMessage(e);const s=(i={donate:{[B.CAMPAIGN_NOT_ACTIVE]:"This campaign has ended and is no longer accepting donations",[B.DONATION_TOO_SMALL]:"Minimum donation is 1 BKC"},delegate:{[B.INVALID_DURATION]:"Lock period must be between 1 day and 10 years"},playGame:{[B.INVALID_GUESS_RANGE]:"Your guess must be within the valid range for this tier"},withdraw:{[B.CAMPAIGN_STILL_ACTIVE]:"You can withdraw after the campaign deadline"},unstake:{[B.LOCK_PERIOD_ACTIVE]:"Your tokens are still locked. Use force unstake to withdraw early (penalty applies)"},claimRewards:{[B.CONTRACT_ERROR]:"No rewards available to claim",[B.NO_REWARDS]:"No rewards available to claim"}}[t])==null?void 0:i[a];return s&&(n=s),{type:a,message:n,original:e,method:t,isSimulation:!0}},create(e,t={}){const a=Do[e]||"An error occurred",n=new Error(a);return n.errorType=e,n.extra=t,n},getAction(e){var a;const t=this.classify(e);return((a=ga[t])==null?void 0:a.action)||null}},de={chainId:11155111,chainIdHex:"0xaa36a7",name:"Sepolia",nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},blockExplorer:"https://sepolia.etherscan.io"},Od=[{name:"PublicNode",getUrl:()=>"https://ethereum-sepolia-rpc.publicnode.com",priority:1,isPublic:!0,isPaid:!1},{name:"Sepolia Official",getUrl:()=>"https://rpc.sepolia.org",priority:2,isPublic:!0,isPaid:!1}];let Xt=0,Za=null,ma=null,Io=0,Po=0,Qa=!0;const Wb=3,Gb=3e4,Kb=5e3,Hl=6e4,Vb=2e3;function Jt(){return Od[0].getUrl()}const te={getCurrentRpcUrl(){const e=Jt();if(e&&Qa)return e;const t=this.getAvailableEndpoints();if(t.length===0)throw new Error("No RPC endpoints available");return t[Xt%t.length].getUrl()},getPrimaryRpcUrl(){return Jt()},getAvailableEndpoints(){return Od.filter(e=>e.getUrl()!==null).sort((e,t)=>e.priority-t.priority)},getRpcUrlsForMetaMask(){const e=Jt(),t=this.getAvailableEndpoints().filter(a=>a.isPublic).map(a=>a.getUrl()).filter(Boolean);return e?[e,...t]:t},switchToNextRpc(e=!0){const t=this.getAvailableEndpoints();if(Qa&&Jt()){Qa=!1,Xt=0;const o=t.find(s=>s.isPublic);if(o)return console.log(`[Network] Alchemy temporarily unavailable, using: ${o.name}`),e&&setTimeout(()=>{console.log("[Network] Retrying Alchemy..."),Qa=!0,Xt=0},Vb),o.getUrl()}const a=t.filter(o=>o.isPublic);if(a.length<=1)return console.warn("[Network] No alternative RPCs available"),this.getCurrentRpcUrl();Xt=(Xt+1)%a.length;const n=a[Xt];return console.log(`[Network] Switched to RPC: ${n.name}`),n.getUrl()},resetToAlchemy(){Jt()&&(Qa=!0,Xt=0,console.log("[Network] Reset to Alchemy RPC"))},isRateLimitError(e){var n;const t=((n=e==null?void 0:e.message)==null?void 0:n.toLowerCase())||"",a=e==null?void 0:e.code;return a===-32002||a===-32005||t.includes("rate limit")||t.includes("too many")||t.includes("exceeded")||t.includes("throttled")||t.includes("429")},async handleRateLimit(e){const t=this.getCurrentRpcUrl(),a=Jt();if(a&&t===a)return console.warn("[Network] Alchemy rate limited (check your plan limits)"),await new Promise(i=>setTimeout(i,1e3)),a;console.warn("[Network] Public RPC rate limited, switching...");const o=this.switchToNextRpc(),s=Date.now();if(s-Po>Hl)try{await this.updateMetaMaskRpcs(),Po=s}catch(i){console.warn("[Network] Could not update MetaMask:",i.message)}return o},async getWorkingProvider(){const e=window.ethers,t=Jt();if(t)try{const n=new e.JsonRpcProvider(t);return await Promise.race([n.getBlockNumber(),new Promise((o,s)=>setTimeout(()=>s(new Error("timeout")),3e3))]),Qa=!0,n}catch(n){console.warn("[Network] Alchemy temporarily unavailable:",n.message)}const a=this.getAvailableEndpoints().filter(n=>n.isPublic);for(const n of a)try{const o=n.getUrl(),s=new e.JsonRpcProvider(o);return await Promise.race([s.getBlockNumber(),new Promise((i,r)=>setTimeout(()=>r(new Error("timeout")),3e3))]),console.log(`[Network] Using fallback RPC: ${n.name}`),s}catch{console.warn(`[Network] RPC ${n.name} failed, trying next...`)}if(t)return new e.JsonRpcProvider(t);throw new Error("No working RPC endpoints available")},async isCorrectNetwork(){if(window.ethereum)try{const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)===de.chainId}catch{}if(u.provider)try{const e=await u.provider.getNetwork();return Number(e.chainId)===de.chainId}catch{}return!1},async getCurrentChainId(){if(window.ethereum)try{const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)}catch{}if(u.provider)try{const e=await u.provider.getNetwork();return Number(e.chainId)}catch{}return null},async checkRpcHealth(){const e=Date.now(),t=this.getCurrentRpcUrl();try{const a=new AbortController,n=setTimeout(()=>a.abort(),Kb),o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_blockNumber",params:[],id:1}),signal:a.signal});if(clearTimeout(n),!o.ok)throw new Error(`HTTP ${o.status}`);const s=await o.json();if(s.error)throw new Error(s.error.message||"RPC error");const i=Date.now()-e;return Io=0,ma={healthy:!0,latency:i,blockNumber:parseInt(s.result,16),timestamp:Date.now()},ma}catch(a){Io++;const n={healthy:!1,latency:Date.now()-e,error:a.message,timestamp:Date.now()};return ma=n,Io>=Wb&&(console.warn("[Network] Too many RPC failures, switching..."),this.switchToNextRpc(),Io=0),n}},getLastHealthCheck(){return ma},async isRpcHealthy(e=1e4){return ma&&Date.now()-ma.timestamp<e?ma.healthy:(await this.checkRpcHealth()).healthy},async switchNetwork(){if(!window.ethereum)throw ae.create(B.WALLET_NOT_CONNECTED);try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:de.chainIdHex}]}),console.log("[Network] Switched to",de.name),!0}catch(e){if(e.code===4902)return await this.addNetwork();throw e.code===4001?ae.create(B.USER_REJECTED):e}},async addNetwork(){if(!window.ethereum)throw ae.create(B.WALLET_NOT_CONNECTED);const e=this.getRpcUrlsForMetaMask();try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:de.chainIdHex,chainName:de.name,nativeCurrency:de.nativeCurrency,rpcUrls:e,blockExplorerUrls:[de.blockExplorer]}]}),console.log("[Network] Added network:",de.name),!0}catch(t){throw t.code===4001?ae.create(B.USER_REJECTED):t}},async updateMetaMaskRpcs(){if(!window.ethereum)return!1;const e=Date.now();if(e-Po<Hl)return console.log("[Network] MetaMask update on cooldown, skipping..."),!1;if(!await this.isCorrectNetwork())return console.log("[Network] Not on correct network, skipping RPC update"),!1;const a=this.getRpcUrlsForMetaMask();try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:de.chainIdHex,chainName:de.name,nativeCurrency:de.nativeCurrency,rpcUrls:a,blockExplorerUrls:[de.blockExplorer]}]}),Po=e,console.log("[Network] MetaMask RPCs updated with:",a[0]),!0}catch(n){return console.warn("[Network] Could not update MetaMask RPCs:",n.message),!1}},async forceResetMetaMaskRpc(){if(!window.ethereum)return!1;const e=Jt();if(!e)return console.warn("[Network] Alchemy not configured"),!1;try{try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x1"}]})}catch{}return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:de.chainIdHex,chainName:de.name+" (Alchemy)",nativeCurrency:de.nativeCurrency,rpcUrls:[e],blockExplorerUrls:[de.blockExplorer]}]}),console.log("[Network] MetaMask reset to Alchemy RPC"),!0}catch(t){return console.error("[Network] Failed to reset MetaMask:",t.message),!1}},getProvider(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");return new e.JsonRpcProvider(this.getCurrentRpcUrl())},getBrowserProvider(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");if(!window.ethereum)throw ae.create(B.WALLET_NOT_CONNECTED);return new e.BrowserProvider(window.ethereum)},async getSigner(){var t,a;const e=this.getBrowserProvider();try{return await e.getSigner()}catch(n){if((t=n.message)!=null&&t.includes("ENS")||n.code==="UNSUPPORTED_OPERATION")try{const o=await window.ethereum.request({method:"eth_accounts"});if(o&&o.length>0)return await e.getSigner(o[0])}catch(o){console.warn("Signer fallback failed:",o)}throw n.code===4001||(a=n.message)!=null&&a.includes("user rejected")?ae.create(B.USER_REJECTED):ae.create(B.WALLET_NOT_CONNECTED)}},async getConnectedAddress(){if(window.ethereum)try{const e=await window.ethereum.request({method:"eth_accounts"});if(e[0])return e[0]}catch{}return u.userAddress?u.userAddress:null},async requestConnection(){if(!window.ethereum)throw ae.create(B.WALLET_NOT_CONNECTED);try{const e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e||e.length===0)throw ae.create(B.WALLET_NOT_CONNECTED);return e[0]}catch(e){throw e.code===4001?ae.create(B.USER_REJECTED):e}},startHealthMonitoring(e=Gb){Za&&this.stopHealthMonitoring(),this.checkRpcHealth(),Za=setInterval(()=>{this.checkRpcHealth()},e),console.log("[Network] Health monitoring started")},stopHealthMonitoring(){Za&&(clearInterval(Za),Za=null,console.log("[Network] Health monitoring stopped"))},isMonitoring(){return Za!==null},formatAddress(e,t=4){return e?`${e.slice(0,t+2)}...${e.slice(-t)}`:""},getAddressExplorerUrl(e){return`${de.blockExplorer}/address/${e}`},getTxExplorerUrl(e){return`${de.blockExplorer}/tx/${e}`},isMetaMaskInstalled(){return typeof window.ethereum<"u"&&window.ethereum.isMetaMask},async getStatus(){var n;const[e,t,a]=await Promise.all([this.isCorrectNetwork(),this.getConnectedAddress(),this.checkRpcHealth()]);return{isConnected:!!t,address:t,isCorrectNetwork:e,currentChainId:await this.getCurrentChainId(),targetChainId:de.chainId,rpcHealthy:a.healthy,rpcLatency:a.latency,currentRpc:((n=this.getAvailableEndpoints()[Xt])==null?void 0:n.name)||"Unknown"}}},Yb=Object.freeze(Object.defineProperty({__proto__:null,NETWORK_CONFIG:de,NetworkManager:te},Symbol.toStringTag,{value:"Module"})),Dt={SAFETY_MARGIN_PERCENT:20,MIN_GAS_LIMITS:{transfer:21000n,erc20Transfer:65000n,erc20Approve:50000n,contractCall:100000n,complexCall:300000n},MAX_GAS_LIMIT:15000000n,MIN_GAS_PRICE_GWEI:.01,MAX_GAS_PRICE_GWEI:100,GAS_PRICE_CACHE_TTL:15e3},Ud={async estimateGas(e,t,a=[],n={}){try{return await e[t].estimateGas(...a,n)}catch(o){throw o}},async estimateGasWithMargin(e,t,a=[],n={}){const o=await this.estimateGas(e,t,a,n);return this.addSafetyMargin(o)},addSafetyMargin(e,t=Dt.SAFETY_MARGIN_PERCENT){const a=BigInt(e),n=a*BigInt(t)/100n;let o=a+n;return o>Dt.MAX_GAS_LIMIT&&(console.warn("[Gas] Estimate exceeds max limit, capping"),o=Dt.MAX_GAS_LIMIT),o},getMinGasLimit(e="contractCall"){return Dt.MIN_GAS_LIMITS[e]||Dt.MIN_GAS_LIMITS.contractCall},async getGasPrice(){return await aa.getOrFetch("gas-price-current",async()=>(await te.getProvider().getFeeData()).gasPrice||0n,Dt.GAS_PRICE_CACHE_TTL)},async getFeeData(){return await aa.getOrFetch("gas-fee-data",async()=>{const a=await te.getProvider().getFeeData();return{gasPrice:a.gasPrice||0n,maxFeePerGas:a.maxFeePerGas||0n,maxPriorityFeePerGas:a.maxPriorityFeePerGas||0n}},Dt.GAS_PRICE_CACHE_TTL)},async getGasPriceGwei(){const e=window.ethers,t=await this.getGasPrice();return parseFloat(e.formatUnits(t,"gwei"))},async calculateCost(e,t=null){const a=window.ethers;t||(t=await this.getGasPrice());const n=BigInt(e)*BigInt(t),o=a.formatEther(n);return{wei:n,eth:parseFloat(o),formatted:this.formatEth(o)}},async estimateTransactionCost(e,t,a=[],n={}){const o=await this.estimateGas(e,t,a,n),s=this.addSafetyMargin(o),i=await this.getGasPrice(),r=await this.calculateCost(s,i);return{gasEstimate:o,gasWithMargin:s,gasPrice:i,...r}},async validateGasBalance(e,t,a=null){const n=window.ethers,o=te.getProvider();a||(a=await this.getGasPrice());const s=await o.getBalance(e),i=BigInt(t)*BigInt(a),r=s>=i;return{sufficient:r,balance:s,required:i,shortage:r?0n:i-s,balanceFormatted:n.formatEther(s),requiredFormatted:n.formatEther(i)}},async hasMinimumGas(e,t=null){const a=window.ethers,o=await te.getProvider().getBalance(e),s=t||a.parseEther("0.001");return o>=s},formatEth(e,t=6){const a=parseFloat(e);return a===0?"0 BNB":a<1e-6?"< 0.000001 BNB":`${a.toFixed(t).replace(/\.?0+$/,"")} BNB`},formatGasPrice(e){const t=window.ethers,a=parseFloat(t.formatUnits(e,"gwei"));return a<.01?"< 0.01 gwei":a<1?`${a.toFixed(2)} gwei`:`${a.toFixed(1)} gwei`},formatGasLimit(e){return Number(e).toLocaleString()},formatGasSummary(e){return`~${e.formatted} (${this.formatGasLimit(e.gasWithMargin||0n)} gas)`},compareEstimates(e,t){const a=BigInt(e),n=BigInt(t);if(n===0n)return 0;const o=a>n?a-n:n-a;return Number(o*100n/n)},isGasPriceReasonable(e){const t=window.ethers,a=parseFloat(t.formatUnits(e,"gwei"));return a<Dt.MIN_GAS_PRICE_GWEI?{reasonable:!1,warning:"Gas price unusually low, transaction may be slow"}:a>Dt.MAX_GAS_PRICE_GWEI?{reasonable:!1,warning:"Gas price unusually high, consider waiting"}:{reasonable:!0,warning:null}},async getRecommendedSettings(e){const t=await this.getFeeData();return{gasLimit:this.addSafetyMargin(e),maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas}},async createTxOverrides(e,t={}){return{gasLimit:(await this.getRecommendedSettings(e)).gasLimit,...t}}},jl=500000000000000n,Wl=["function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)"],be={async validateNetwork(){if(!await te.isCorrectNetwork()){const t=await te.getCurrentChainId();throw ae.create(B.WRONG_NETWORK,{currentChainId:t,expectedChainId:de.chainId})}},async validateRpcHealth(){const e=await te.checkRpcHealth();if(!e.healthy&&(te.switchToNextRpc(),!(await te.checkRpcHealth()).healthy))throw ae.create(B.RPC_UNHEALTHY,{error:e.error})},async validateWalletConnected(e=null){if(!window.ethereum)throw ae.create(B.WALLET_NOT_CONNECTED);const t=e||await te.getConnectedAddress();if(!t)throw ae.create(B.WALLET_NOT_CONNECTED);return t},async validatePreTransaction(){return await this.validateNetwork(),await this.validateRpcHealth(),await this.validateWalletConnected()},async validateEthForGas(e,t=jl){const a=window.ethers,n=Fo.ethBalance(e),o=await aa.getOrFetch(n,async()=>await te.getProvider().getBalance(e),Ro.BALANCE);if(o<t)throw ae.create(B.INSUFFICIENT_ETH,{balance:a.formatEther(o),required:a.formatEther(t)});return o},async validateTokenBalance(e,t,a){const n=window.ethers,o=Fo.tokenBalance(e,a),s=await aa.getOrFetch(o,async()=>{const i=te.getProvider();return await new n.Contract(e,Wl,i).balanceOf(a)},Ro.BALANCE);if(s<t)throw ae.create(B.INSUFFICIENT_TOKEN,{balance:n.formatEther(s),required:n.formatEther(t)});return s},async needsApproval(e,t,a,n){const o=window.ethers,s=Fo.allowance(e,n,t);return await aa.getOrFetch(s,async()=>{const r=te.getProvider();return await new o.Contract(e,Wl,r).allowance(n,t)},Ro.ALLOWANCE)<a},async validateAllowance(e,t,a,n){if(await this.needsApproval(e,t,a,n))throw ae.create(B.INSUFFICIENT_ALLOWANCE,{token:e,spender:t,required:a.toString()})},async validateBalances({userAddress:e,tokenAddress:t=null,tokenAmount:a=null,spenderAddress:n=null,ethAmount:o=jl}){await this.validateEthForGas(e,o),t&&a&&await this.validateTokenBalance(t,a,e)},validatePositive(e,t="Amount"){if(BigInt(e)<=0n)throw new Error(`${t} must be greater than zero`)},validateRange(e,t,a,n="Value"){const o=BigInt(e),s=BigInt(t),i=BigInt(a);if(o<s||o>i)throw new Error(`${n} must be between ${t} and ${a}`)},validateNotEmpty(e,t="Field"){if(!e||e.trim().length===0)throw new Error(`${t} cannot be empty`)},validateAddress(e,t="Address"){const a=window.ethers;if(!e||!a.isAddress(e))throw new Error(`Invalid ${t}`)},charity:{validateCreateCampaign({title:e,description:t,goalAmount:a,durationDays:n}){be.validateNotEmpty(e,"Title"),be.validateNotEmpty(t,"Description"),be.validatePositive(a,"Goal amount"),be.validateRange(n,1,180,"Duration")},validateDonate({campaignId:e,amount:t}){if(e==null)throw new Error("Campaign ID is required");be.validatePositive(t,"Donation amount")}},staking:{validateDelegate({amount:e,lockDays:t}){be.validatePositive(e,"Stake amount"),be.validateRange(t,1,3650,"Lock duration")},validateUnstake({delegationIndex:e}){if(e==null||e<0)throw new Error("Invalid delegation index")}},nftPool:{validateBuy({maxPrice:e}){e!=null&&be.validatePositive(e,"Max price")},validateSell({tokenId:e,minPayout:t}){if(e==null)throw new Error("Token ID is required");t!=null&&be.validatePositive(t,"Min payout")}},fortune:{validatePlay({wagerAmount:e,guesses:t,isCumulative:a}){if(be.validatePositive(e,"Wager amount"),!Array.isArray(t)||t.length===0)throw new Error("At least one guess is required");t.forEach((n,o)=>{if(typeof n!="number"||n<1)throw new Error(`Invalid guess at position ${o+1}`)})}},rental:{validateList({tokenId:e,pricePerDay:t}){if(e==null)throw new Error("Token ID is required");be.validatePositive(t,"Price per day")},validateRent({tokenId:e}){if(e==null)throw new Error("Token ID is required")}},notary:{validateNotarize({ipfsCid:e,description:t,contentHash:a}){if(be.validateNotEmpty(e,"IPFS CID"),a&&(a.startsWith("0x")?a.slice(2):a).length!==64)throw new Error("Content hash must be 32 bytes")}}},No={DEFAULT_MAX_RETRIES:2,RETRY_BASE_DELAY:2e3,APPROVAL_MULTIPLIER:10n,APPROVAL_WAIT_TIME:1500,CONFIRMATION_TIMEOUT:6e4,CONFIRMATION_RETRY_DELAY:3e3,GAS_SAFETY_MARGIN:20,DEFAULT_GAS_LIMIT:500000n},Gl=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"];class Hd{constructor(t,a,n=!0){this.button=t,this.txName=a,this.showToasts=n,this.originalContent=null,this.originalDisabled=!1,this.button&&(this.originalContent=this.button.innerHTML,this.originalDisabled=this.button.disabled)}setPhase(t){if(!this.button)return;const n={validating:{text:"Validating...",icon:"ðŸ”"},approving:{text:"Approving...",icon:"âœ…"},simulating:{text:"Simulating...",icon:"ðŸ§ª"},confirming:{text:"Confirm in Wallet",icon:"ðŸ‘›"},waiting:{text:"Processing...",icon:"â³"},success:{text:"Success!",icon:"ðŸŽ‰"},error:{text:"Failed",icon:"âŒ"}}[t]||{text:t,icon:"â³"};this.button.disabled=!0,this.button.innerHTML=`
            <span class="tx-status">
                <span class="tx-icon">${n.icon}</span>
                <span class="tx-text">${n.text}</span>
            </span>
        `}setRetry(t,a){this.button&&(this.button.innerHTML=`
            <span class="tx-status">
                <span class="tx-icon">ðŸ”„</span>
                <span class="tx-text">Retry ${t}/${a}...</span>
            </span>
        `)}cleanup(){this.button&&(this.button.innerHTML=this.originalContent,this.button.disabled=this.originalDisabled)}showSuccess(t=2e3){this.setPhase("success"),setTimeout(()=>this.cleanup(),t)}showError(t=2e3){this.setPhase("error"),setTimeout(()=>this.cleanup(),t)}}class jd{constructor(){this.pendingTxIds=new Set}_resolveArgs(t){return typeof t=="function"?t():t||[]}_resolveApproval(t){return t?typeof t=="object"?{token:t.token,spender:t.spender,amount:t.amount}:t:null}_validateContractMethod(t,a){if(!t)throw new Error("Contract instance is null or undefined");if(typeof t[a]!="function"){const n=Object.keys(t).filter(o=>typeof t[o]=="function").filter(o=>!o.startsWith("_")&&!["on","once","emit","removeListener"].includes(o)).slice(0,15);throw console.error(`[TX] Contract method "${a}" not found!`),console.error("[TX] Available methods:",n),new Error(`Contract method "${a}" not found. This usually means the ABI doesn't match the contract. Available methods: ${n.join(", ")}`)}return typeof t[a].estimateGas!="function"&&console.warn(`[TX] Method ${a} exists but estimateGas is not available`),!0}async execute(t){var T,I;const{name:a,txId:n=null,button:o=null,showToasts:s=!0,getContract:i,method:r,args:l=[],approval:c=null,validate:d=null,onSuccess:f=null,onError:g=null,maxRetries:m=No.DEFAULT_MAX_RETRIES,invalidateCache:h=!0,skipSimulation:w=!1,fixedGasLimit:y=No.DEFAULT_GAS_LIMIT}=t,k=n||`${a}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(this.pendingTxIds.has(k))return console.warn(`[TX] Transaction ${k} already in progress`),{success:!1,reason:"DUPLICATE_TX",message:"Transaction already in progress"};this.pendingTxIds.add(k);const v=new Hd(o,a,s);try{v.setPhase("validating"),console.log(`[TX] Starting: ${a}`),await be.validateNetwork(),await be.validateRpcHealth();const N=await be.validateWalletConnected();console.log(`[TX] User address: ${N}`);const S=await te.getSigner();console.log("[TX] Signer obtained");try{await be.validateEthForGas(N)}catch(ne){console.warn("[TX] ETH gas validation failed, continuing anyway:",ne.message)}const $=this._resolveApproval(c);$&&$.amount>0n&&await be.validateTokenBalance($.token,$.amount,N),d&&(console.log("[TX] Running custom validation..."),await d(S,N));const F=this._resolveApproval(t.approval);F&&F.amount>0n&&await be.needsApproval(F.token,F.spender,F.amount,N)&&(v.setPhase("approving"),console.log("[TX] Requesting token approval..."),await this._executeApproval(F,S,N),aa.clear("allowance-")),console.log("[TX] Getting contract instance...");const V=await i(S);this._validateContractMethod(V,r),console.log(`[TX] Contract method "${r}" validated`);const X=t.value;X&&console.log("[TX] Transaction value (ETH):",X.toString());const re=X?{value:X}:{},le=this._resolveArgs(l);console.log("[TX] Args resolved:",le.map(ne=>typeof ne=="bigint"?ne.toString():typeof ne=="string"&&ne.length>50?ne.substring(0,50)+"...":ne));let se;if(w)console.log(`[TX] Skipping simulation, using fixed gas limit: ${y}`),se=y;else{v.setPhase("simulating"),console.log("[TX] Simulating transaction...");try{const ne=te.getProvider(),dt=await V.getAddress(),si=new ethers.Contract(dt,V.interface,ne);if(!si[r]||typeof si[r].estimateGas!="function")throw new Error(`estimateGas not available for method "${r}"`);se=await si[r].estimateGas(...le,{...re,from:N}),console.log(`[TX] Gas estimate: ${se.toString()}`)}catch(ne){if(console.error("[TX] Simulation failed:",ne.message),(T=ne.message)!=null&&T.includes("not found")||(I=ne.message)!=null&&I.includes("undefined"))throw new Error(`Contract method "${r}" is not callable. Check that the ABI matches the deployed contract.`);const dt=ae.parseSimulationError(ne,r);throw ae.create(dt.type,{message:dt.message,original:ne})}}v.setPhase("confirming"),console.log("[TX] Requesting signature...");const ke=Ud.addSafetyMargin(se),G={...re,gasLimit:ke};try{const dt=await te.getProvider().getFeeData();dt.maxFeePerGas&&(G.maxFeePerGas=dt.maxFeePerGas*120n/100n,G.maxPriorityFeePerGas=dt.maxPriorityFeePerGas||0n)}catch{}const Pe=this._resolveArgs(l),ct=await this._executeWithRetry(()=>V[r](...Pe,G),{maxRetries:m,ui:v,signer:S,name:a});console.log(`[TX] Transaction submitted: ${ct.hash}`),v.setPhase("waiting"),console.log("[TX] Waiting for confirmation...");const je=await this._waitForConfirmation(ct,S.provider);if(console.log(`[TX] Confirmed in block ${je.blockNumber}`),v.showSuccess(),h&&aa.invalidateByTx(a),f)try{await f(je)}catch(ne){console.warn("[TX] onSuccess callback error:",ne)}return{success:!0,receipt:je,txHash:je.hash||ct.hash,blockNumber:je.blockNumber}}catch(N){console.error("[TX] Error:",(N==null?void 0:N.message)||N),o&&(console.log("[TX] Restoring button..."),o.disabled=!1,v.originalContent&&(o.innerHTML=v.originalContent));let S;try{S=await ae.handleWithRpcSwitch(N,a),S.rpcSwitched&&console.log(`[TX] RPC switched to: ${S.newRpc}`)}catch($){console.warn("[TX] Error in handleWithRpcSwitch:",$),S=ae.handle(N,a)}if(S.type!==B.USER_REJECTED&&o&&!g){const $=v.originalContent;o.innerHTML='<span style="display:flex;align-items:center;justify-content:center;gap:8px"><span>âŒ</span><span>Failed</span></span>',setTimeout(()=>{o&&(o.innerHTML=$)},1500)}if(g)try{g(S)}catch($){console.warn("[TX] onError callback error:",$)}return{success:!1,error:S,message:S.message,cancelled:S.type===B.USER_REJECTED}}finally{this.pendingTxIds.delete(k),setTimeout(()=>{o&&o.disabled&&(console.log("[TX] Safety cleanup triggered"),v.cleanup())},5e3)}}async _executeApproval(t,a,n){const o=window.ethers,{token:s,spender:i,amount:r}=t;console.log(`[TX] Approving ${o.formatEther(r)} tokens...`);const l=new o.Contract(s,Gl,a),c=r*No.APPROVAL_MULTIPLIER;try{let d={gasLimit:100000n};try{const k=await te.getProvider().getFeeData();k.maxFeePerGas&&(d.maxFeePerGas=k.maxFeePerGas*120n/100n,d.maxPriorityFeePerGas=k.maxPriorityFeePerGas||0n)}catch{}const f=await l.approve(i,c,d),g=te.getProvider();let m=null;for(let y=0;y<30&&(await new Promise(k=>setTimeout(k,1500)),m=await g.getTransactionReceipt(f.hash),!m);y++);if(m||(m=await f.wait()),m.status===0)throw new Error("Approval transaction reverted");if(console.log("[TX] Approval confirmed"),await new Promise(y=>setTimeout(y,No.APPROVAL_WAIT_TIME)),await new o.Contract(s,Gl,g).allowance(n,i)<r)throw new Error("Approval not reflected on-chain")}catch(d){throw ae.isUserRejection(d)?ae.create(B.USER_REJECTED):d}}async _executeWithRetry(t,{maxRetries:a,ui:n,signer:o,name:s}){let i;for(let r=1;r<=a+1;r++)try{return r>1&&(n.setRetry(r,a+1),console.log(`[TX] Retry ${r}/${a+1}`),(await te.checkRpcHealth()).healthy||(console.log("[TX] RPC unhealthy, switching..."),te.switchToNextRpc(),await new Promise(c=>setTimeout(c,2e3)))),await t()}catch(l){if(i=l,ae.isUserRejection(l)||!ae.isRetryable(l)||r===a+1)throw l;const c=ae.getWaitTime(l);console.log(`[TX] Waiting ${c}ms before retry...`),await new Promise(d=>setTimeout(d,c))}throw i}async _waitForConfirmation(t,a){const n=te.getProvider();for(let o=0;o<30;o++){await new Promise(s=>setTimeout(s,1500));try{const s=await n.getTransactionReceipt(t.hash);if(s&&s.status===1)return console.log("[TX] Confirmed via Alchemy"),s;if(s&&s.status===0)throw new Error("Transaction reverted on-chain")}catch(s){if(s.message==="Transaction reverted on-chain")throw s}}return console.warn("[TX] Could not verify receipt after 45s, assuming success"),{hash:t.hash,status:1,blockNumber:0}}isPending(t){return this.pendingTxIds.has(t)}getPendingCount(){return this.pendingTxIds.size}clearPending(){this.pendingTxIds.clear()}}const M=new jd,ks="bkc_operator",Ha="0x0000000000000000000000000000000000000000";function Es(){var t;const e=window.ethers;try{const a=localStorage.getItem(ks);if(a&&Nt(a))return Ia(a);if(window.BACKCHAIN_OPERATOR&&Nt(window.BACKCHAIN_OPERATOR))return Ia(window.BACKCHAIN_OPERATOR);if((t=window.addresses)!=null&&t.operator&&Nt(window.addresses.operator))return Ia(window.addresses.operator)}catch(a){console.warn("[Operator] Error getting operator:",a)}return(e==null?void 0:e.ZeroAddress)||Ha}function K(e){const t=window.ethers,a=(t==null?void 0:t.ZeroAddress)||Ha;return e===null?a:e&&Nt(e)?Ia(e):Es()}function lr(e){if(!e)return Ts(),!0;if(!Nt(e))return console.warn("[Operator] Invalid address:",e),!1;try{const t=Ia(e);return localStorage.setItem(ks,t),window.BACKCHAIN_OPERATOR=t,window.dispatchEvent(new CustomEvent("operatorChanged",{detail:{address:t}})),console.log("[Operator] Set to:",t),!0}catch(t){return console.error("[Operator] Error setting:",t),!1}}function Ts(){try{localStorage.removeItem(ks),delete window.BACKCHAIN_OPERATOR,window.dispatchEvent(new CustomEvent("operatorChanged",{detail:{address:null}})),console.log("[Operator] Cleared")}catch(e){console.warn("[Operator] Error clearing:",e)}}function Wd(){const e=window.ethers,t=(e==null?void 0:e.ZeroAddress)||Ha,a=Es();return a&&a!==t}function fo(){var n;const e=window.ethers,t=(e==null?void 0:e.ZeroAddress)||Ha,a=localStorage.getItem(ks);return a&&Nt(a)?{address:a,source:"localStorage",isSet:!0}:window.BACKCHAIN_OPERATOR&&Nt(window.BACKCHAIN_OPERATOR)?{address:window.BACKCHAIN_OPERATOR,source:"global",isSet:!0}:(n=window.addresses)!=null&&n.operator&&Nt(window.addresses.operator)?{address:window.addresses.operator,source:"config",isSet:!0}:{address:t,source:"none",isSet:!1}}function Nt(e){const t=window.ethers;return!e||typeof e!="string"||!e.match(/^0x[a-fA-F0-9]{40}$/)?!1:t!=null&&t.isAddress?t.isAddress(e):!0}function Ia(e){const t=window.ethers;if(!e)return(t==null?void 0:t.ZeroAddress)||Ha;try{if(t!=null&&t.getAddress)return t.getAddress(e)}catch{}return e}function go(e){const t=window.ethers,a=(t==null?void 0:t.ZeroAddress)||Ha;return!e||e===a?"None":`${e.slice(0,6)}...${e.slice(-4)}`}const qb={get:Es,set:lr,clear:Ts,has:Wd,resolve:K,info:fo,isValid:Nt,normalize:Ia,short:go,ZERO:Ha};window.Operator=qb;const Hn={maxWidth:1920,maxHeight:1920,quality:.8,skipThreshold:200*1024,outputType:"image/webp"},Xb=50;async function Gd(e,t={}){var r;if(!e||!((r=e.type)!=null&&r.startsWith("image/")))return e;if(e.type==="image/gif")return console.log(`[Optimizer] Skip GIF (preserving animation): ${en(e.size)}`),e;const a=t.skipThreshold??Hn.skipThreshold;if(e.size<a)return console.log(`[Optimizer] Skip small file: ${en(e.size)} < ${en(a)}`),e;const n=t.maxWidth??Hn.maxWidth,o=t.maxHeight??Hn.maxHeight,s=t.quality??Hn.quality,i=Hn.outputType;try{const l=await Jb(e),c=l.naturalWidth,d=l.naturalHeight;let f=c,g=d;f>n&&(g=Math.round(g*(n/f)),f=n),g>o&&(f=Math.round(f*(o/g)),g=o);const m=document.createElement("canvas");m.width=f,m.height=g;const h=m.getContext("2d");h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(l,0,0,f,g);const w=await new Promise((T,I)=>{m.toBlob(N=>N?T(N):I(new Error("Canvas export failed")),i,s)});if(w.size>=e.size)return console.log(`[Optimizer] WebP larger than original, keeping original: ${en(e.size)}`),e;const y=e.name.replace(/\.[^.]+$/,"")||"image",k=new File([w],`${y}.webp`,{type:i}),v=((1-k.size/e.size)*100).toFixed(0);return console.log(`[Optimizer] ${en(e.size)} ${e.type} â†’ ${en(k.size)} WebP (${c}x${d} â†’ ${f}x${g}, -${v}%)`),k}catch(l){return console.warn("[Optimizer] Image optimization failed, using original:",l.message),e}}async function Kd(e,t={}){var o;if(!e||!((o=e.type)!=null&&o.startsWith("video/")))return e;const a=t.maxSizeMB??Xb,n=e.size/(1024*1024);if(n>a)throw new Error(`Video too large: ${n.toFixed(1)}MB (max ${a}MB). Try recording at lower resolution or shorter duration.`);return console.log(`[Optimizer] Video OK: ${n.toFixed(1)}MB ${e.type}`),e}async function Vd(e,t={}){var a,n;return e&&((a=e.type)!=null&&a.startsWith("image/")?Gd(e,t):(n=e.type)!=null&&n.startsWith("video/")?Kd(e,t):e)}function Jb(e){return new Promise((t,a)=>{const n=new Image;n.onload=()=>{URL.revokeObjectURL(n.src),t(n)},n.onerror=()=>{URL.revokeObjectURL(n.src),a(new Error("Failed to load image"))},n.src=URL.createObjectURL(e)})}function en(e){return e<1024?`${e}B`:e<1024*1024?`${(e/1024).toFixed(0)}KB`:`${(e/(1024*1024)).toFixed(1)}MB`}const Mo={gateway:"https://gateway.lighthouse.storage/ipfs",maxFileSize:100*1024*1024};async function ja(e,t={}){if(!e||!e.size)throw new Error("No file provided");if(e.size>Mo.maxFileSize)throw new Error(`File too large: ${(e.size/1024/1024).toFixed(1)}MB (max: ${Mo.maxFileSize/1024/1024}MB)`);const a=t.onProgress||(()=>{});let n=e;t.skipOptimize||(a("optimizing","Optimizing media..."),n=await Vd(e,t.optimize||{})),a("uploading",`Uploading ${Kl(n.size)} to permanent storage...`);const o=new FormData;o.append("file",n);const s=await fetch("/api/upload-media",{method:"POST",body:o});if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.error||`Upload failed: HTTP ${s.status}`)}const i=await s.json();if(!i.success||!i.ipfsHash)throw new Error("Upload returned no hash");const r={id:i.ipfsHash,url:`${Mo.gateway}/${i.ipfsHash}`,size:n.size,type:n.type};return console.log(`[Upload] Permanent (Lighthouse): ${r.url} (${Kl(n.size)})`),a("done",r.url),r}async function Yd(e){return{cost:0n,costFormatted:"Free (permanent storage)"}}const zo=["https://gateway.lighthouse.storage/ipfs/","https://gateway.pinata.cloud/ipfs/","https://dweb.link/ipfs/","https://cloudflare-ipfs.com/ipfs/","https://ipfs.io/ipfs/"];function En(e){if(!e)return null;const t=e.trim();if(t.startsWith("http://")||t.startsWith("https://")){if(t.includes("devnet.irys.xyz/")){const a=t.split("devnet.irys.xyz/")[1];if(a)return`https://gateway.irys.xyz/${a}`}return t}if(t.startsWith("ar://")){const a=t.slice(5);return a.startsWith("Qm")||a.startsWith("bafy")?`${zo[0]}${a}`:`https://gateway.irys.xyz/${a}`}if(t.startsWith("ipfs://")){const a=t.slice(7);return`${zo[0]}${a}`}return/^Qm[1-9A-HJ-NP-Za-km-z]{44}$/.test(t)||t.startsWith("bafy")?`${zo[0]}${t}`:/^[a-zA-Z0-9_-]{43,44}$/.test(t)&&!t.startsWith("Qm")?`https://gateway.irys.xyz/${t}`:t.length>10?`${zo[0]}${t}`:null}function Kl(e){return e<1024?`${e}B`:e<1024*1024?`${(e/1024).toFixed(0)}KB`:`${(e/(1024*1024)).toFixed(1)}MB`}const Zb=["function getFeeConfig(bytes32 _actionId) view returns (uint8 feeType, uint16 bps, uint32 multiplier, uint32 gasEstimate)"],Vl=10000n;async function W(e,t=0n){try{const a=window.ethers,n=te.getProvider(),o=(E==null?void 0:E.backchainEcosystem)||(R==null?void 0:R.backchainEcosystem);if(!o)return console.warn("[FeeCalc] Ecosystem address not available"),0n;const i=await new a.Contract(o,Zb,n).getFeeConfig(e),r=Number(i.feeType),l=BigInt(i.bps);if(r===2){const c=BigInt(i.gasEstimate)*BigInt(i.multiplier);return console.log(`[FeeCalc] Fixed: ${a.formatEther(c)} BNB`),c}if(l===0n)return 0n;if(r===0){const c=await n.getFeeData(),d=c.gasPrice||c.maxFeePerGas||100000000n,f=d*150n/100n,g=BigInt(i.gasEstimate)*f*l*BigInt(i.multiplier)/Vl;return console.log(`[FeeCalc] Gas-based: ${a.formatEther(g)} ETH (gasEst=${i.gasEstimate}, gasPrice=${d}â†’${f} +50%, bps=${l}, mult=${i.multiplier})`),g}else{const c=t*l/Vl;return console.log(`[FeeCalc] Value-based: ${a.formatEther(c)} ETH`),c}}catch(a){return console.error("[FeeCalc] Error:",a.message),0n}}const q=Object.freeze(Object.defineProperty({__proto__:null,CacheKeys:Fo,CacheManager:aa,CacheTTL:Ro,ErrorHandler:ae,ErrorMessages:Do,ErrorTypes:B,GasManager:Ud,NETWORK_CONFIG:de,NetworkManager:te,TransactionEngine:jd,TransactionUI:Hd,UPLOAD_CONFIG:Mo,ValidationLayer:be,calculateFeeClientSide:W,clearOperator:Ts,getOperator:Es,getOperatorInfo:fo,getUploadPrice:Yd,hasOperator:Wd,irysUploadFile:ja,isValidAddress:Nt,normalizeAddress:Ia,optimizeImage:Gd,optimizeMedia:Vd,resolveContentUrl:En,resolveOperator:K,setOperator:lr,shortAddress:go,txEngine:M,validateVideo:Kd},Symbol.toStringTag,{value:"Module"}));function qd(){var t;const e=(E==null?void 0:E.charityPool)||(R==null?void 0:R.charityPool)||((t=window.contractAddresses)==null?void 0:t.charityPool);if(!e)throw console.error("âŒ CharityPool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{CHARITY_POOL:e}}const mo=["function createCampaign(string calldata title, string calldata metadataUri, uint96 goal, uint256 durationDays, address operator) external payable returns (uint256 campaignId)","function donate(uint256 campaignId, address operator) external payable","function boostCampaign(uint256 campaignId, uint256 days_, address operator) external payable","function closeCampaign(uint256 campaignId) external","function withdraw(uint256 campaignId) external","function getCampaign(uint256 campaignId) view returns (address owner, uint48 deadline, uint8 status, uint96 raised, uint96 goal, uint32 donorCount, bool isBoosted, uint48 boostExpiry, string memory title, string memory metadataUri)","function getCampaignsBatch(uint256 start, uint256 count) view returns (address[] owners, uint48[] deadlines, uint8[] statuses, uint96[] raiseds, uint96[] goals, uint32[] donorCounts, bool[] boosteds, uint48[] boostExpiries)","function canWithdraw(uint256 campaignId) view returns (bool)","function previewDonation(uint256 amount) view returns (uint256 fee, uint256 netToCampaign)","function campaignCount() view returns (uint256)","function getStats() view returns (uint256 campaignCount, uint256 totalDonated, uint256 totalWithdrawn, uint256 totalEthFees, uint256 totalBoostRevenue)","function version() view returns (string)","event CampaignCreated(uint256 indexed campaignId, address indexed creator, uint96 goal, uint48 deadline, address operator)","event DonationMade(uint256 indexed campaignId, address indexed donor, uint256 grossAmount, uint256 netDonation, address operator)","event CampaignBoosted(uint256 indexed campaignId, address indexed booster, uint48 boostExpiry, address operator)","event CampaignClosed(uint256 indexed campaignId, address indexed creator, uint96 raised)","event FundsWithdrawn(uint256 indexed campaignId, address indexed creator, uint96 amount)"],Wa={ACTIVE:0,CLOSED:1,WITHDRAWN:2};function bo(e){const t=window.ethers,a=qd();return new t.Contract(a.CHARITY_POOL,mo,e)}async function qt(){const e=window.ethers,{NetworkManager:t}=await U(async()=>{const{NetworkManager:o}=await Promise.resolve().then(()=>q);return{NetworkManager:o}},void 0),a=t.getProvider(),n=qd();return new e.Contract(n.CHARITY_POOL,mo,a)}async function Xd({title:e,metadataUri:t="",description:a,goalAmount:n,durationDays:o,operator:s,button:i=null,onSuccess:r=null,onError:l=null}){const c=window.ethers;if(!e||e.trim().length===0)throw new Error("Title is required");if(e.length>100)throw new Error("Title must be 100 characters or less");if(o<1||o>365)throw new Error("Duration must be between 1 and 365 days");const d=BigInt(n);if(d<=0n)throw new Error("Goal amount must be greater than 0");const f=t||a||"";let g=s,m=0n;return await M.execute({name:"CreateCampaign",button:i,getContract:async h=>bo(h),method:"createCampaign",args:()=>[e,f,d,BigInt(o),K(g)],get value(){return m},validate:async(h,w)=>{try{m=await W(c.id("CHARITY_CREATE"))}catch(T){console.warn("[CharityTx] calculateFeeClientSide failed, using fallback:",T.message),m=c.parseEther("0.0001")}m===0n&&(m=c.parseEther("0.0001"));const{NetworkManager:y}=await U(async()=>{const{NetworkManager:T}=await Promise.resolve().then(()=>q);return{NetworkManager:T}},void 0);if(await y.getProvider().getBalance(w)<m+c.parseEther("0.001"))throw new Error("Insufficient BNB for creation fee + gas")},onSuccess:async h=>{let w=null;try{const y=new c.Interface(mo);for(const k of h.logs)try{const v=y.parseLog(k);if(v.name==="CampaignCreated"){w=Number(v.args.campaignId);break}}catch{}}catch{}r&&r(h,w)},onError:l})}async function Jd({campaignId:e,amount:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers;if(e==null)throw new Error("Campaign ID is required");const r=BigInt(t);if(r<=0n)throw new Error("Donation amount must be greater than 0");let l=e,c=a;return await M.execute({name:"Donate",button:n,getContract:async d=>bo(d),method:"donate",args:()=>[l,K(c)],value:r,validate:async(d,f)=>{const m=await(await qt()).getCampaign(l);if(m.owner===i.ZeroAddress)throw new Error("Campaign not found");if(Number(m.status)!==Wa.ACTIVE)throw new Error("Campaign is not active");const h=Math.floor(Date.now()/1e3);if(Number(m.deadline)<=h)throw new Error("Campaign has ended")},onSuccess:async d=>{let f=null;try{const g=new i.Interface(mo);for(const m of d.logs)try{const h=g.parseLog(m);if(h.name==="DonationMade"){f={grossAmount:h.args.grossAmount,netDonation:h.args.netDonation};break}}catch{}}catch{}o&&o(d,f)},onError:s})}async function cr({campaignId:e,button:t=null,onSuccess:a=null,onError:n=null}){const o=window.ethers;if(e==null)throw new Error("Campaign ID is required");return await M.execute({name:"CloseCampaign",button:t,getContract:async s=>bo(s),method:"closeCampaign",args:[e],validate:async(s,i)=>{const l=await(await qt()).getCampaign(e);if(l.owner===o.ZeroAddress)throw new Error("Campaign not found");if(l.owner.toLowerCase()!==i.toLowerCase())throw new Error("Only the campaign creator can close");if(Number(l.status)!==Wa.ACTIVE)throw new Error("Campaign is not active")},onSuccess:a,onError:n})}const Zd=cr;async function Qd({campaignId:e,button:t=null,onSuccess:a=null,onError:n=null}){const o=window.ethers;if(e==null)throw new Error("Campaign ID is required");return await M.execute({name:"Withdraw",button:t,getContract:async s=>bo(s),method:"withdraw",args:[e],validate:async(s,i)=>{const r=await qt(),l=await r.getCampaign(e);if(l.owner===o.ZeroAddress)throw new Error("Campaign not found");if(l.owner.toLowerCase()!==i.toLowerCase())throw new Error("Only the campaign creator can withdraw");if(Number(l.status)===Wa.WITHDRAWN)throw new Error("Funds already withdrawn");if(!await r.canWithdraw(e))throw new Error("Cannot withdraw yet â€” campaign must be closed or past deadline")},onSuccess:async s=>{let i=null;try{const r=new o.Interface(mo);for(const l of s.logs)try{const c=r.parseLog(l);if(c.name==="FundsWithdrawn"){i={amount:c.args.amount};break}}catch{}}catch{}a&&a(s,i)},onError:n})}async function eu({campaignId:e,days:t=1,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers;if(e==null)throw new Error("Campaign ID is required");if(t<1||t>30)throw new Error("Boost duration must be 1-30 days");let r=a,l=0n;return await M.execute({name:"BoostCampaign",button:n,getContract:async c=>bo(c),method:"boostCampaign",args:()=>[e,t,K(r)],get value(){return l},validate:async(c,d)=>{const g=await(await qt()).getCampaign(e);if(g.owner===i.ZeroAddress)throw new Error("Campaign not found");if(Number(g.status)!==Wa.ACTIVE)throw new Error("Campaign is not active");const m=Math.floor(Date.now()/1e3);if(Number(g.deadline)<=m)throw new Error("Campaign has ended");if(l=await W(i.id("CHARITY_BOOST"))*BigInt(t),l===0n)throw new Error("Could not calculate boost fee");const{NetworkManager:w}=await U(async()=>{const{NetworkManager:v}=await Promise.resolve().then(()=>q);return{NetworkManager:v}},void 0);if(await w.getProvider().getBalance(d)<l+i.parseEther("0.001"))throw new Error(`Insufficient BNB. Need ~${i.formatEther(l)} BNB for ${t}-day boost`)},onSuccess:o,onError:s})}async function tu(e){const a=await(await qt()).getCampaign(e),n=Math.floor(Date.now()/1e3);return{id:e,creator:a.owner,title:a.title,metadataUri:a.metadataUri,goalAmount:a.goal,raisedAmount:a.raised,donationCount:Number(a.donorCount),deadline:Number(a.deadline),status:Number(a.status),statusName:["ACTIVE","CLOSED","WITHDRAWN"][Number(a.status)]||"UNKNOWN",isBoosted:a.isBoosted,boostExpiry:Number(a.boostExpiry),progress:a.goal>0n?Number(a.raised*100n/a.goal):0,isEnded:Number(a.deadline)<n,isActive:Number(a.status)===Wa.ACTIVE&&Number(a.deadline)>n}}async function au(e,t){const a=await qt(),n=Math.floor(Date.now()/1e3),o=await a.getCampaignsBatch(e,t),s=o.owners.length,i=[];for(let r=0;r<s;r++){const l=e+r,c=Number(o.deadlines[r]),d=Number(o.statuses[r]),f=o.goals[r],g=o.raiseds[r];i.push({id:String(l),creator:o.owners[r],deadline:c,status:d,statusName:["ACTIVE","CLOSED","WITHDRAWN"][d]||"UNKNOWN",raisedAmount:g,goalAmount:f,donationCount:Number(o.donorCounts[r]),isBoosted:o.boosteds[r],boostExpiry:Number(o.boostExpiries[r]),progress:f>0n?Number(g*100n/f):0,isEnded:c<n,isActive:d===Wa.ACTIVE&&c>n})}return i}async function nu(){const e=await qt();return Number(await e.campaignCount())}async function ou(e){return await(await qt()).canWithdraw(e)}async function su(e){const t=window.ethers;try{const a=await W(t.id("CHARITY_DONATE"),BigInt(e)),n=BigInt(e)-a;return{fee:a,netToCampaign:n,feeFormatted:t.formatEther(a),netFormatted:t.formatEther(n)}}catch{const a=BigInt(e),n=a*500n/10000n,o=a-n;return{fee:n,netToCampaign:o,feeFormatted:t.formatEther(n),netFormatted:t.formatEther(o)}}}async function iu(e){const t=window.ethers,a=await W(t.id("CHARITY_BOOST")),n=a*BigInt(e);return{feePerDay:a,feePerDayFormatted:t.formatEther(a),totalFee:n,totalFeeFormatted:t.formatEther(n)}}async function ru(){const e=window.ethers;try{const t=await W(e.id("CHARITY_CREATE"));return{fee:t,feeFormatted:e.formatEther(t)}}catch{return{fee:e.parseEther("0.0001"),feeFormatted:"0.0001"}}}async function lu(){const e=window.ethers,a=await(await qt()).getStats();return{totalCampaigns:Number(a[0]),totalDonated:a[1],totalDonatedFormatted:e.formatEther(a[1]),totalWithdrawn:a[2],totalWithdrawnFormatted:e.formatEther(a[2]),totalEthFees:a[3],totalEthFeesFormatted:e.formatEther(a[3]),totalBoostRevenue:a[4],totalBoostRevenueFormatted:e.formatEther(a[4])}}const Ye={createCampaign:Xd,donate:Jd,closeCampaign:cr,cancelCampaign:Zd,withdraw:Qd,boostCampaign:eu,getCampaign:tu,getCampaignsBatch:au,getCampaignCount:nu,canWithdraw:ou,previewDonation:su,getBoostCost:iu,getCreateFee:ru,getStats:lu,CampaignStatus:Wa},Qb=Object.freeze(Object.defineProperty({__proto__:null,CharityTx:Ye,boostCampaign:eu,canWithdraw:ou,cancelCampaign:Zd,closeCampaign:cr,createCampaign:Xd,donate:Jd,getBoostCost:iu,getCampaign:tu,getCampaignCount:nu,getCampaignsBatch:au,getCreateFee:ru,getStats:lu,previewDonation:su,withdraw:Qd},Symbol.toStringTag,{value:"Module"}));function dr(){var a,n;const e=(E==null?void 0:E.stakingPool)||(R==null?void 0:R.stakingPool)||((a=window.contractAddresses)==null?void 0:a.stakingPool),t=(E==null?void 0:E.bkcToken)||(R==null?void 0:R.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw console.error("âŒ StakingPool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");if(!t)throw console.error("âŒ BKC Token address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,STAKING_POOL:e}}const cu=["function delegate(uint256 amount, uint256 lockDays, address operator) external payable","function unstake(uint256 index) external","function forceUnstake(uint256 index, address operator) external payable","function claimRewards(address operator) external payable","function pendingRewards(address user) view returns (uint256)","function previewClaim(address user) view returns (uint256 totalRewards, uint256 recycleAmount, uint256 burnAmount, uint256 tutorCut, uint256 userReceives, uint256 recycleRateBps, uint256 nftBoost)","function previewForceUnstake(address user, uint256 index) view returns (uint256 stakedAmount, uint256 totalPenalty, uint256 recycleAmount, uint256 burnAmount, uint256 tutorCut, uint256 userReceives, uint256 penaltyRateBps, uint256 nftBoost, uint256 ethFeeRequired)","function getDelegationsOf(address user) view returns (tuple(uint128 amount, uint128 pStake, uint64 lockEnd, uint64 lockDays, uint256 rewardDebt)[])","function getDelegation(address user, uint256 index) view returns (uint256 amount, uint256 pStake, uint256 lockEnd, uint256 lockDays, uint256 pendingReward)","function delegationCount(address user) view returns (uint256)","function userTotalPStake(address user) view returns (uint256)","function totalPStake() view returns (uint256)","function MIN_LOCK_DAYS() view returns (uint256)","function MAX_LOCK_DAYS() view returns (uint256)","function forceUnstakeEthFee() view returns (uint256)","function getUserBestBoost(address user) view returns (uint256)","function getRecycleRateForBoost(uint256 boostBps) view returns (uint256)","function getTierName(uint256 boostBps) view returns (string)","function getUserSummary(address user) view returns (uint256 userTotalPStake, uint256 delegationCount, uint256 savedRewards, uint256 totalPending, uint256 nftBoost, uint256 recycleRateBps)","function getStakingStats() view returns (uint256 totalPStake, uint256 totalBkcDelegated, uint256 totalRewardsDistributed, uint256 totalBurnedOnClaim, uint256 totalRecycledOnClaim, uint256 totalForceUnstakePenalties, uint256 totalTutorPayments, uint256 totalEthFeesCollected, uint256 accRewardPerShare)","function compoundRewards(uint256 lockDays, address operator) external payable","event Delegated(address indexed user, uint256 indexed delegationIndex, uint256 amount, uint256 pStake, uint256 lockDays, address operator)","event Unstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned)","event ForceUnstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReturned, uint256 totalPenalty, uint256 recycledAmount, uint256 burnedAmount, uint256 tutorAmount, address tutor, address operator)","event RewardsClaimed(address indexed user, uint256 totalRewards, uint256 recycledAmount, uint256 burnedAmount, uint256 tutorAmount, uint256 userReceived, uint256 nftBoostUsed, address tutor, address operator)","event RewardsCompounded(address indexed user, uint256 netAmount, uint256 lockDays, uint256 recycledAmount, address operator)"];function Kt(e){const t=window.ethers,a=dr();return new t.Contract(a.STAKING_POOL,cu,e)}async function da(){const e=window.ethers,{NetworkManager:t}=await U(async()=>{const{NetworkManager:o}=await Promise.resolve().then(()=>q);return{NetworkManager:o}},void 0),a=t.getProvider(),n=dr();return new e.Contract(n.STAKING_POOL,cu,a)}async function du({amount:e,lockDays:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){if(t==null)throw new Error("lockDays must be provided");const i=Number(t);if(i<1||i>3650)throw new Error("Lock duration must be between 1 and 3650 days");const r=BigInt(e);let l=a;return await M.execute({name:"Delegate",button:n,getContract:async c=>Kt(c),method:"delegate",args:()=>[r,BigInt(i),K(l)],approval:(()=>{const c=dr();return{token:c.BKC_TOKEN,spender:c.STAKING_POOL,amount:r}})(),onSuccess:o,onError:s})}async function uu({delegationIndex:e,button:t=null,onSuccess:a=null,onError:n=null}){be.staking.validateUnstake({delegationIndex:e});let o=e;return await M.execute({name:"Unstake",button:t,getContract:async s=>Kt(s),method:"unstake",args:[o],validate:async(s,i)=>{const l=await Kt(s).getDelegationsOf(i);if(o>=l.length)throw new Error("Delegation not found");const c=l[o],d=Math.floor(Date.now()/1e3);if(Number(c.lockEnd)>d){const f=Math.ceil((Number(c.lockEnd)-d)/86400);throw new Error(`Lock period still active. ${f} day(s) remaining. Use Force Unstake if needed.`)}},onSuccess:a,onError:n})}async function pu({delegationIndex:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){be.staking.validateUnstake({delegationIndex:e});let s=e,i=t,r=0n;return await M.execute({name:"ForceUnstake",button:a,getContract:async l=>Kt(l),method:"forceUnstake",args:()=>[s,K(i)],get value(){return r},validate:async(l,c)=>{const d=Kt(l),f=await d.getDelegationsOf(c);if(s>=f.length)throw new Error("Delegation not found");const g=f[s],m=Math.floor(Date.now()/1e3);if(Number(g.lockEnd)<=m)throw new Error("Lock period has ended. Use normal Unstake to avoid penalty.");r=await d.forceUnstakeEthFee()},onSuccess:n,onError:o})}async function fu({operator:e,button:t=null,onSuccess:a=null,onError:n=null}={}){let o=e;return await M.execute({name:"ClaimRewards",button:t,getContract:async s=>Kt(s),method:"claimRewards",args:()=>[K(o)],validate:async(s,i)=>{if(await Kt(s).pendingRewards(i)<=0n)throw new Error("No rewards available to claim")},onSuccess:a,onError:n})}async function gu({lockDays:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}={}){const s=Number(e);if(s<1||s>3650)throw new Error("Lock duration must be between 1 and 3650 days");let i=t;return await M.execute({name:"CompoundRewards",button:a,getContract:async r=>Kt(r),method:"compoundRewards",args:()=>[BigInt(s),K(i)],validate:async(r,l)=>{if(await Kt(r).pendingRewards(l)<=0n)throw new Error("No rewards available to compound")},onSuccess:n,onError:o})}async function mu(e){const a=await(await da()).getDelegationsOf(e),n=Math.floor(Date.now()/1e3);return a.map((o,s)=>({index:s,amount:o.amount,pStake:o.pStake,lockEnd:Number(o.lockEnd),lockDays:Number(o.lockDays),isUnlocked:Number(o.lockEnd)<=n,daysRemaining:Number(o.lockEnd)>n?Math.ceil((Number(o.lockEnd)-n)/86400):0}))}async function bu(e){return await(await da()).pendingRewards(e)}async function xu(e){return await(await da()).userTotalPStake(e)}async function hu(){return await(await da()).totalPStake()}async function vu(){const e=await da();try{const t=await e.forceUnstakePenaltyBps();return Number(t)/100}catch{return 10}}async function yu(){const e=await da(),[t,a,n]=await Promise.all([e.MIN_LOCK_DAYS(),e.MAX_LOCK_DAYS(),e.forceUnstakePenaltyBps().catch(()=>1000n)]);return{minLockDays:Number(t),maxLockDays:Number(a),penaltyPercent:Number(n)/100,penaltyBips:Number(n)}}async function wu(e){const a=await(await da()).previewClaim(e);return{totalRewards:a.totalRewards,recycleAmount:a.recycleAmount,burnAmount:a.burnAmount,tutorCut:a.tutorCut,userReceives:a.userReceives,recycleRateBps:Number(a.recycleRateBps),nftBoost:Number(a.nftBoost)}}async function ku(e){const a=await(await da()).getUserSummary(e);return{userTotalPStake:a._userTotalPStake||a[0],delegationCount:Number(a._delegationCount||a[1]),savedRewards:a._savedRewards||a[2],totalPending:a._totalPending||a[3],nftBoost:Number(a._nftBoost||a[4]),recycleRateBps:Number(a._recycleRateBps||a[5])}}const La={delegate:du,unstake:uu,forceUnstake:pu,claimRewards:fu,compoundRewards:gu,getUserDelegations:mu,getPendingRewards:bu,getUserPStake:xu,getTotalPStake:hu,getEarlyUnstakePenalty:vu,getStakingConfig:yu,previewClaim:wu,getUserSummary:ku},e0=Object.freeze(Object.defineProperty({__proto__:null,StakingTx:La,claimRewards:fu,compoundRewards:gu,delegate:du,forceUnstake:pu,getEarlyUnstakePenalty:vu,getPendingRewards:bu,getStakingConfig:yu,getTotalPStake:hu,getUserDelegations:mu,getUserPStake:xu,getUserSummary:ku,previewClaim:wu,unstake:uu},Symbol.toStringTag,{value:"Module"})),Eu=["diamond","gold","silver","bronze"];function Cs(e=null){var o,s,i;const t=(E==null?void 0:E.bkcToken)||(R==null?void 0:R.bkcToken)||((o=window.contractAddresses)==null?void 0:o.bkcToken),a=(E==null?void 0:E.rewardBooster)||(R==null?void 0:R.rewardBooster)||((s=window.contractAddresses)==null?void 0:s.rewardBooster);let n=null;if(e){const r=`pool_${e.toLowerCase()}`;n=(E==null?void 0:E[r])||(R==null?void 0:R[r])||((i=window.contractAddresses)==null?void 0:i[r])}if(!t||!a)throw new Error("Contract addresses not loaded");return{BKC_TOKEN:t,NFT_CONTRACT:a,NFT_POOL:n}}function zn(e){var a;const t=`pool_${e.toLowerCase()}`;return(E==null?void 0:E[t])||(R==null?void 0:R[t])||((a=window.contractAddresses)==null?void 0:a[t])||null}function t0(){const e={};for(const t of Eu){const a=zn(t);a&&(e[t]=a)}return e}const ur=["function buyNFT(uint256 maxBkcPrice, address operator) external payable returns (uint256 tokenId)","function buySpecificNFT(uint256 tokenId, uint256 maxBkcPrice, address operator) external payable","function sellNFT(uint256 tokenId, uint256 minPayout, address operator) external payable","function getBuyPrice() view returns (uint256)","function getSellPrice() view returns (uint256)","function getTotalBuyCost() view returns (uint256 bkcCost, uint256 ethCost)","function getTotalSellInfo() view returns (uint256 bkcPayout, uint256 ethCost)","function getEthFees() view returns (uint256 buyFee, uint256 sellFee)","function getSpread() view returns (uint256 spread, uint256 spreadBips)","function getPoolInfo() view returns (uint256 bkcBalance, uint256 nftCount, uint256 effectiveNftCount, uint256 virtualReserves, uint256 mintableReserves, uint256 k, bool initialized, uint8 tier)","function getAvailableNFTs() view returns (uint256[])","function isNFTInPool(uint256 tokenId) view returns (bool)","function tier() view returns (uint8)","function getTierName() view returns (string)","function getStats() view returns (uint256 volume, uint256 buys, uint256 sells, uint256 ethFees)","event NFTPurchased(address indexed buyer, uint256 indexed tokenId, uint256 price, uint256 ethFee, uint256 nftCount, address operator)","event NFTSold(address indexed seller, uint256 indexed tokenId, uint256 payout, uint256 ethFee, uint256 nftCount, address operator)"],Tu=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function ownerOf(uint256 tokenId) view returns (address)","function balanceOf(address owner) view returns (uint256)","function tokenTier(uint256 tokenId) view returns (uint8)"];function pr(e,t){return new window.ethers.Contract(t,ur,e)}async function qe(e){const{NetworkManager:t}=await U(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>q);return{NetworkManager:a}},void 0);return new window.ethers.Contract(e,ur,t.getProvider())}function _a(e,t){const a=window.ethers;return a.keccak256(a.AbiCoder.defaultAbiCoder().encode(["string","uint8"],[e,Number(t)]))}function ki(e){const t=Cs();return new window.ethers.Contract(t.NFT_CONTRACT,Tu,e)}async function a0(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>q);return{NetworkManager:a}},void 0),t=Cs();return new window.ethers.Contract(t.NFT_CONTRACT,Tu,e.getProvider())}async function fr({poolAddress:e,poolTier:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers,r=Cs(),l=e||zn(t);if(!l)throw new Error("Pool address or valid pool tier is required");let c=a,d=0n,f=0n;return await M.execute({name:"BuyNFT",button:n,getContract:async g=>pr(g,l),method:"buyNFT",args:()=>[d,K(c)],get value(){return f},get approval(){return d>0n?{token:r.BKC_TOKEN,spender:l,amount:d}:null},validate:async(g,m)=>{const h=await qe(l),[w]=await h.getTotalBuyCost();d=w;const y=await h.tier();f=await W(_a("NFT_BUY_T",y)),console.log(`[BuyNFT] Price: ${i.formatEther(d)} BKC, Fee: ${i.formatEther(f)} ETH`);const k=await h.getPoolInfo();if(Number(k[2])<=1)throw new Error("No NFTs available in pool");const{NetworkManager:v}=await U(async()=>{const{NetworkManager:$}=await Promise.resolve().then(()=>q);return{NetworkManager:$}},void 0),T=v.getProvider();if(await new i.Contract(r.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],T).balanceOf(m)<d)throw new Error(`Insufficient BKC. Need ${i.formatEther(d)} BKC`);if(await T.getBalance(m)<f+i.parseEther("0.001"))throw new Error("Insufficient BNB for fee + gas")},onSuccess:async g=>{let m=null;try{const h=new i.Interface(ur);for(const w of g.logs)try{const y=h.parseLog(w);if((y==null?void 0:y.name)==="NFTPurchased"){m=Number(y.args.tokenId);break}}catch{}}catch{}o&&o(g,m)},onError:s})}async function Cu({poolAddress:e,poolTier:t,tokenId:a,operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers,l=Cs(),c=e||zn(t);if(!c)throw new Error("Pool address or valid pool tier is required");if(a===void 0)throw new Error("Token ID is required");let d=n,f=0n,g=0n;return await M.execute({name:"BuySpecificNFT",button:o,getContract:async m=>pr(m,c),method:"buySpecificNFT",args:()=>[a,f,K(d)],get value(){return g},get approval(){return f>0n?{token:l.BKC_TOKEN,spender:c,amount:f}:null},validate:async(m,h)=>{const w=await qe(c);if(!await w.isNFTInPool(a))throw new Error("NFT is not in pool");const[y]=await w.getTotalBuyCost();f=y;const k=await w.tier();g=await W(_a("NFT_BUY_T",k));const{NetworkManager:v}=await U(async()=>{const{NetworkManager:N}=await Promise.resolve().then(()=>q);return{NetworkManager:N}},void 0),T=v.getProvider();if(await new r.Contract(l.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],T).balanceOf(h)<f)throw new Error("Insufficient BKC");if(await T.getBalance(h)<g+r.parseEther("0.001"))throw new Error("Insufficient BNB")},onSuccess:s,onError:i})}async function gr({poolAddress:e,poolTier:t,tokenId:a,minPayout:n,operator:o,button:s=null,onSuccess:i=null,onError:r=null}){const l=window.ethers,c=e||zn(t);if(!c)throw new Error("Pool address or valid pool tier is required");if(a===void 0)throw new Error("Token ID is required");let d=o,f=0n,g=0n;return await M.execute({name:"SellNFT",button:s,getContract:async m=>pr(m,c),method:"sellNFT",args:()=>[a,f,K(d)],get value(){return g},validate:async(m,h)=>{const w=await qe(c),y=ki(m);if((await y.ownerOf(a)).toLowerCase()!==h.toLowerCase())throw new Error("You do not own this NFT");const v=await w.tier(),T=await y.tokenTier(a);if(v!==T)throw new Error("NFT tier does not match pool tier");const[I]=await w.getTotalSellInfo();f=n?BigInt(n):I*95n/100n;const N=await w.tier();g=await W(_a("NFT_SELL_T",N));const{NetworkManager:S}=await U(async()=>{const{NetworkManager:F}=await Promise.resolve().then(()=>q);return{NetworkManager:F}},void 0);if(await S.getProvider().getBalance(h)<g+l.parseEther("0.001"))throw new Error("Insufficient BNB");if(!await y.isApprovedForAll(h,c)){const{NetworkManager:F}=await U(async()=>{const{NetworkManager:le}=await Promise.resolve().then(()=>q);return{NetworkManager:le}},void 0),V=await F.getProvider().getFeeData(),X={gasLimit:100000n};V.maxFeePerGas&&(X.maxFeePerGas=V.maxFeePerGas*120n/100n,X.maxPriorityFeePerGas=V.maxPriorityFeePerGas||0n),await(await y.setApprovalForAll(c,!0,X)).wait()}},onSuccess:i,onError:r})}async function Bu({poolAddress:e,poolTier:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=e||zn(t);if(!s)throw new Error("Pool address or valid pool tier is required");return await M.execute({name:"ApproveAllNFTs",button:a,getContract:async i=>ki(i),method:"setApprovalForAll",args:[s,!0],validate:async(i,r)=>{if(await ki(i).isApprovedForAll(r,s))throw new Error("Already approved")},onSuccess:n,onError:o})}async function Au(e){return await(await qe(e)).getBuyPrice()}async function Iu(e){return await(await qe(e)).getSellPrice()}async function Pu(e){const t=window.ethers,a=await qe(e),[n]=await a.getTotalBuyCost(),o=await a.tier(),s=await W(_a("NFT_BUY_T",o));return{bkcCost:n,bkcFormatted:t.formatEther(n),ethCost:s,ethFormatted:t.formatEther(s)}}async function Nu(e){const t=window.ethers,a=await qe(e),[n]=await a.getTotalSellInfo(),o=await a.tier(),s=await W(_a("NFT_SELL_T",o));return{bkcPayout:n,bkcFormatted:t.formatEther(n),ethCost:s,ethFormatted:t.formatEther(s)}}async function zu(e){const t=window.ethers,a=await qe(e),[n,o,s]=await Promise.all([a.getPoolInfo(),a.getBuyPrice().catch(()=>0n),a.getSellPrice().catch(()=>0n)]);return{bkcBalance:n[0],nftCount:Number(n[1]),effectiveNftCount:Number(n[2]),virtualReserves:Number(n[3]),mintableReserves:Number(n[4]),k:n[5],initialized:n[6],tier:Number(n[7]),buyPrice:o,buyPriceFormatted:t.formatEther(o),sellPrice:s,sellPriceFormatted:t.formatEther(s)}}async function $u(e){return(await(await qe(e)).getAvailableNFTs()).map(a=>Number(a))}async function mr(e){const t=window.ethers,n=await(await qe(e)).tier(),o=await W(_a("NFT_BUY_T",n)),s=await W(_a("NFT_SELL_T",n));return{buyFee:o,buyFeeFormatted:t.formatEther(o),sellFee:s,sellFeeFormatted:t.formatEther(s)}}const Su=mr;async function br(e){const t=window.ethers,n=await(await qe(e)).getStats();return{volume:n[0],volumeFormatted:t.formatEther(n[0]),buys:Number(n[1]),sells:Number(n[2]),ethFees:n[3],ethFeesFormatted:t.formatEther(n[3])}}const Lu=br;async function _u(e){return await(await qe(e)).getTierName()}async function Ru(e){const t=window.ethers,a=await qe(e);try{const n=await a.getSpread();return{spread:n.spread,spreadFormatted:t.formatEther(n.spread),spreadBips:Number(n.spreadBips),spreadPercent:Number(n.spreadBips)/100}}catch{const[n,o]=await Promise.all([a.getBuyPrice().catch(()=>0n),a.getSellPrice().catch(()=>0n)]),s=n>o?n-o:0n,i=o>0n?Number(s*10000n/o):0;return{spread:s,spreadFormatted:t.formatEther(s),spreadBips:i,spreadPercent:i/100}}}async function Fu(e,t){return await(await qe(e)).isNFTInPool(t)}async function Du(e,t){return await(await a0()).isApprovedForAll(e,t)}const Mu=fr,Ou=gr,Ei={buyNft:fr,buySpecificNft:Cu,sellNft:gr,approveAllNfts:Bu,buyFromPool:Mu,sellToPool:Ou,getBuyPrice:Au,getSellPrice:Iu,getTotalBuyCost:Pu,getTotalSellInfo:Nu,getEthFees:mr,getEthFeeConfig:Su,getPoolInfo:zu,getAvailableNfts:$u,isNFTInPool:Fu,isApprovedForAll:Du,getStats:br,getTradingStats:Lu,getTierName:_u,getSpread:Ru,getPoolAddress:zn,getAllPools:t0,POOL_TIERS:Eu},n0=Object.freeze(Object.defineProperty({__proto__:null,NftTx:Ei,approveAllNfts:Bu,buyFromPool:Mu,buyNft:fr,buySpecificNft:Cu,getAvailableNfts:$u,getBuyPrice:Au,getEthFeeConfig:Su,getEthFees:mr,getPoolInfo:zu,getSellPrice:Iu,getSpread:Ru,getStats:br,getTierName:_u,getTotalBuyCost:Pu,getTotalSellInfo:Nu,getTradingStats:Lu,isApprovedForAll:Du,isNFTInPool:Fu,sellNft:gr,sellToPool:Ou},Symbol.toStringTag,{value:"Module"}));function xr(){var a,n;const e=(E==null?void 0:E.fortunePool)||(R==null?void 0:R.fortunePool)||((a=window.contractAddresses)==null?void 0:a.fortunePool),t=(E==null?void 0:E.bkcToken)||(R==null?void 0:R.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw console.error("âŒ FortunePool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");if(!t)throw console.error("âŒ BKC Token address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,FORTUNE_POOL:e}}const Bs=["function commitPlay(bytes32 commitHash, uint256 wagerAmount, uint8 tierMask, address operator) external payable returns (uint256 gameId)","function revealPlay(uint256 gameId, uint256[] calldata guesses, bytes32 userSecret) external returns (uint256 prizeWon)","function claimExpired(uint256 gameId) external","function fundPrizePool(uint256 amount) external","function getTierInfo(uint8 tier) view returns (uint256 range, uint256 multiplier, uint256 winChanceBps)","function getAllTiers() view returns (uint256[3] ranges, uint256[3] multipliers, uint256[3] winChances)","function TIER_COUNT() view returns (uint8)","function getGame(uint256 gameId) view returns (address player, uint48 commitBlock, uint8 tierMask, uint8 status, address operator, uint96 wagerAmount)","function getGameResult(uint256 gameId) view returns (address player, uint128 grossWager, uint128 prizeWon, uint8 tierMask, uint8 matchCount, uint48 revealBlock)","function getGameStatus(uint256 gameId) view returns (uint8 status, bool canReveal, uint256 blocksUntilReveal, uint256 blocksUntilExpiry)","function calculatePotentialWinnings(uint256 wagerAmount, uint8 tierMask) view returns (uint256 netToPool, uint256 bkcFee, uint256 maxPrize, uint256 maxPrizeAfterCap)","function getRequiredFee(uint8 tierMask) view returns (uint256 fee)","function generateCommitHash(uint256[] calldata guesses, bytes32 userSecret) pure returns (bytes32)","function gameCounter() view returns (uint256)","function prizePool() view returns (uint256)","function getPoolStats() view returns (uint256 prizePool, uint256 totalGamesPlayed, uint256 totalBkcWagered, uint256 totalBkcWon, uint256 totalBkcForfeited, uint256 totalBkcBurned, uint256 maxPayoutNow)","function REVEAL_DELAY() view returns (uint256)","function REVEAL_WINDOW() view returns (uint256)","function BKC_FEE_BPS() view returns (uint256)","function MAX_PAYOUT_BPS() view returns (uint256)","event GameCommitted(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint8 tierMask, address operator)","event GameRevealed(uint256 indexed gameId, address indexed player, uint256 grossWager, uint256 prizeWon, uint8 tierMask, uint8 matchCount, address operator)","event GameDetails(uint256 indexed gameId, uint8 tierMask, uint256[] guesses, uint256[] rolls, bool[] matches)","event GameExpired(uint256 indexed gameId, address indexed player, uint256 forfeitedAmount)"],hr=[{range:4,multiplierBps:32e3},{range:20,multiplierBps:16e4},{range:100,multiplierBps:8e5}];function Uu(e){const t=window.ethers,a=xr();return new t.Contract(a.FORTUNE_POOL,Bs,e)}async function Ga(){const e=window.ethers,{NetworkManager:t}=await U(async()=>{const{NetworkManager:o}=await Promise.resolve().then(()=>q);return{NetworkManager:o}},void 0),a=t.getProvider(),n=xr();return new e.Contract(n.FORTUNE_POOL,Bs,a)}const vr="fortune_pending_games";function As(){try{return JSON.parse(localStorage.getItem(vr)||"{}")}catch{return{}}}function o0(e,t){const a=As();a[e]={...t,savedAt:Date.now()},localStorage.setItem(vr,JSON.stringify(a))}function s0(e){const t=As();delete t[e],localStorage.setItem(vr,JSON.stringify(t))}function Hu(e,t){const a=window.ethers,o=a.AbiCoder.defaultAbiCoder().encode(["uint256[]","bytes32"],[e.map(s=>BigInt(s)),t]);return a.keccak256(o)}function ju(){const e=window.ethers;return e.hexlify(e.randomBytes(32))}function i0(e){let t=0;for(;e;)t+=e&1,e>>=1;return t}async function yr({commitmentHash:e,wagerAmount:t,tierMask:a,operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers,l=xr(),c=BigInt(t),d=Number(a);if(d<1||d>7)throw new Error("tierMask must be 1-7");let f=n,g=0n;try{const m=[r.id("FORTUNE_TIER0"),r.id("FORTUNE_TIER1"),r.id("FORTUNE_TIER2")];for(let h=0;h<3;h++)d&1<<h&&(g+=await W(m[h]));console.log("[FortuneTx] BNB fee:",r.formatEther(g))}catch(m){throw console.error("[FortuneTx] Could not calculate BNB fee:",m.message),new Error("Could not calculate BNB fee")}return await M.execute({name:"CommitPlay",button:o,getContract:async m=>Uu(m),method:"commitPlay",args:()=>[e,c,d,K(f)],value:g,approval:{token:l.BKC_TOKEN,spender:l.FORTUNE_POOL,amount:c},validate:async(m,h)=>{if(c<=0n)throw new Error("Wager amount must be greater than 0");const{NetworkManager:w}=await U(async()=>{const{NetworkManager:k}=await Promise.resolve().then(()=>q);return{NetworkManager:k}},void 0),y=await w.getProvider().getBalance(h);if(g>0n&&y<g+r.parseEther("0.001"))throw new Error(`Insufficient BNB for fee (${r.formatEther(g)} BNB required)`)},onSuccess:async m=>{let h=null;try{const w=new r.Interface(Bs);for(const y of m.logs)try{const k=w.parseLog(y);if(k.name==="GameCommitted"){h=Number(k.args.gameId);break}}catch{}}catch{}s&&s({gameId:h,txHash:m.hash,commitBlock:m.blockNumber,player:m.from})},onError:i})}async function wr({gameId:e,guesses:t,userSecret:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers,r=t.map(l=>BigInt(l));return await M.execute({name:"RevealPlay",button:n,skipSimulation:!0,fixedGasLimit:500000n,getContract:async l=>Uu(l),method:"revealPlay",args:[e,r,a],validate:async(l,c)=>{const d=await Ga(),f=await d.getGameStatus(e);if(Number(f.status)===3)throw new Error("Game has expired.");if((await d.getGame(e)).player.toLowerCase()!==c.toLowerCase())throw new Error("You are not the owner of this game")},onSuccess:async l=>{let c=null,d=null;try{const f=new i.Interface(Bs);for(const g of l.logs)try{const m=f.parseLog(g);m.name==="GameRevealed"?c={gameId:Number(m.args.gameId),grossWager:m.args.grossWager,prizeWon:m.args.prizeWon,tierMask:Number(m.args.tierMask),matchCount:Number(m.args.matchCount),won:m.args.prizeWon>0n}:m.name==="GameDetails"&&(d={guesses:m.args.guesses.map(h=>Number(h)),rolls:m.args.rolls.map(h=>Number(h)),matches:[...m.args.matches]})}catch{}}catch{}c&&d&&(c.rolls=d.rolls,c.guesses=d.guesses,c.matches=d.matches),s0(e),o&&o(l,c)},onError:s})}async function Wu({wagerAmount:e,guess:t,guesses:a,tierMask:n=1,operator:o,button:s=null,onSuccess:i=null,onError:r=null}){const l=Number(n);if(l<1||l>7)throw new Error("tierMask must be 1-7");const c=i0(l);let d=[];if(a&&Array.isArray(a)&&a.length>0)d=a.map(h=>Number(h));else if(t!==void 0)d=[Number(Array.isArray(t)?t[0]:t)];else throw new Error("Guess(es) required");if(d.length!==c)throw new Error(`tierMask selects ${c} tier(s) but ${d.length} guess(es) provided`);let f=0;for(let h=0;h<3;h++)if(l&1<<h){const w=hr[h].range;if(d[f]<1||d[f]>w)throw new Error(`Tier ${h} guess must be between 1 and ${w}`);f++}const g=ju(),m=Hu(d,g);return await yr({commitmentHash:m,wagerAmount:e,tierMask:l,operator:o,button:s,onSuccess:h=>{o0(h.gameId,{guesses:d,userSecret:g,tierMask:l,wagerAmount:e.toString(),commitmentHash:m,player:h.player,commitTimestamp:Date.now()}),i&&i({...h,guesses:d,userSecret:g,tierMask:l})},onError:r})}async function Gu(){const e=await Ga();try{const t=await e.getAllTiers(),a=[];for(let n=0;n<3;n++)a.push({tierId:n,maxRange:Number(t.ranges[n]),multiplierBps:Number(t.multipliers[n]),multiplier:Number(t.multipliers[n])/1e4,winChanceBps:Number(t.winChances[n]),active:!0});return a}catch{return hr.map((t,a)=>({tierId:a,maxRange:t.range,multiplierBps:t.multiplierBps,multiplier:t.multiplierBps/1e4,active:!0}))}}async function Ku(e){const t=await Ga();try{const a=await t.getTierInfo(e);return{tierId:e,maxRange:Number(a.range),multiplierBps:Number(a.multiplier),multiplier:Number(a.multiplier)/1e4,winChanceBps:Number(a.winChanceBps)}}catch{return null}}async function Vu(e=1){const t=window.ethers,a=Number(e);try{const n=[t.id("FORTUNE_TIER0"),t.id("FORTUNE_TIER1"),t.id("FORTUNE_TIER2")];let o=0n;for(let s=0;s<3;s++)a&1<<s&&(o+=await W(n[s]));return o}catch{return 0n}}async function Yu(){const e=window.ethers,t=await Ga();try{const a=await t.getPoolStats();return{prizePoolBalance:a[0],prizePoolFormatted:e.formatEther(a[0]),gameCounter:Number(a[1]),totalWageredAllTime:a[2],totalWageredFormatted:e.formatEther(a[2]),totalPaidOutAllTime:a[3],totalPaidOutFormatted:e.formatEther(a[3]),totalForfeited:a[4],totalBurned:a[5],maxPayoutNow:a[6],maxPayoutFormatted:e.formatEther(a[6])}}catch{const[a,n]=await Promise.all([t.gameCounter().catch(()=>0n),t.prizePool().catch(()=>0n)]);return{gameCounter:Number(a),prizePoolBalance:n,prizePoolFormatted:e.formatEther(n)}}}async function qu(){return 3}async function Xu(e,t=1){const a=window.ethers,n=await Ga();try{const o=await n.calculatePotentialWinnings(e,Number(t));return{netToPool:o.netToPool||o[0],bkcFee:o.bkcFee||o[1],maxPrize:o.maxPrize||o[2],maxPrizeFormatted:a.formatEther(o.maxPrize||o[2]),maxPrizeAfterCap:o.maxPrizeAfterCap||o[3],maxPrizeAfterCapFormatted:a.formatEther(o.maxPrizeAfterCap||o[3])}}catch{return{netToPool:0n,bkcFee:0n,maxPrize:0n,maxPrizeAfterCap:0n}}}async function Ju(e){const t=await Ga();try{const a=await t.getGameResult(e);return{player:a.player,grossWager:a.grossWager,prizeWon:a.prizeWon,tierMask:Number(a.tierMask),matchCount:Number(a.matchCount),revealBlock:Number(a.revealBlock),won:a.prizeWon>0n}}catch{return null}}async function Zu(e){const t=await Ga();try{const a=await t.getGameStatus(e);return{status:Number(a.status),statusName:["NONE","COMMITTED","REVEALED","EXPIRED"][Number(a.status)]||"UNKNOWN",canReveal:a.canReveal,isExpired:Number(a.status)===3,blocksUntilReveal:Number(a.blocksUntilReveal),blocksUntilExpiry:Number(a.blocksUntilExpiry)}}catch{return null}}function Qu(){return As()}function kr(e){return As()[e]||null}async function ep(e,t={}){const a=kr(e);if(!a)throw new Error(`No pending game found with ID ${e}`);return await wr({gameId:e,guesses:a.guesses,userSecret:a.userSecret,...t})}const Er={commitPlay:yr,revealPlay:wr,playGame:Wu,revealPendingGame:ep,getPendingGamesForReveal:Qu,getPendingGame:kr,generateCommitmentHashLocal:Hu,generateSecret:ju,getActiveTiers:Gu,getTierById:Ku,getServiceFee:Vu,getPoolStats:Yu,getActiveTierCount:qu,calculatePotentialWin:Xu,getGameResult:Ju,getCommitmentStatus:Zu,TIERS:hr},r0=Object.freeze(Object.defineProperty({__proto__:null,FortuneTx:Er,calculatePotentialWin:Xu,commitPlay:yr,getActiveTierCount:qu,getActiveTiers:Gu,getCommitmentStatus:Zu,getGameResult:Ju,getPendingGame:kr,getPendingGamesForReveal:Qu,getPoolStats:Yu,getServiceFee:Vu,getTierById:Ku,playGame:Wu,revealPendingGame:ep,revealPlay:wr},Symbol.toStringTag,{value:"Module"}));function Is(){var a,n;const e=(E==null?void 0:E.rentalManager)||(R==null?void 0:R.rentalManager)||((a=window.contractAddresses)==null?void 0:a.rentalManager),t=(E==null?void 0:E.rewardBooster)||(R==null?void 0:R.rewardBooster)||((n=window.contractAddresses)==null?void 0:n.rewardBooster);if(!e||!t)throw new Error("Contract addresses not loaded. Please refresh the page.");return{RENTAL_MANAGER:e,NFT_CONTRACT:t}}const Ps=["function listNFT(uint256 tokenId, uint96 pricePerDay) external","function updateListing(uint256 tokenId, uint96 pricePerDay) external","function withdrawNFT(uint256 tokenId) external","function rentNFT(uint256 tokenId, address operator) external payable","function withdrawEarnings() external","function boostListing(uint256 tokenId, uint256 days_, address operator) external payable","function getListing(uint256 tokenId) view returns (address owner, uint96 pricePerDay, uint96 totalEarnings, uint32 rentalCount, bool currentlyRented, uint48 rentalEndTime, bool isBoosted, uint32 boostExpiry)","function getAllListedTokenIds() view returns (uint256[])","function getListingCount() view returns (uint256)","function getAvailableListings() view returns (uint256[] tokenIds, bool[] boosted)","function isAvailable(uint256 tokenId) view returns (bool)","function getRental(uint256 tokenId) view returns (address tenant, uint48 endTime, bool isActive)","function isRented(uint256 tokenId) view returns (bool)","function getRemainingTime(uint256 tokenId) view returns (uint256)","function hasActiveRental(address user) view returns (bool)","function getRentalCost(uint256 tokenId) view returns (uint256 rentalCost, uint256 ethFee, uint256 totalCost)","function pendingEarnings(address user) view returns (uint256)","function getStats() view returns (uint256 activeListings, uint256 volume, uint256 rentals, uint256 ethFees, uint256 earningsWithdrawn, uint256 boostRevenue)","event NFTListed(uint256 indexed tokenId, address indexed owner, uint96 pricePerDay)","event NFTRented(uint256 indexed tokenId, address indexed tenant, address indexed owner, uint256 rentalCost, uint256 ethFee, uint48 endTime, address operator)","event ListingBoosted(uint256 indexed tokenId, address indexed owner, uint256 days_, uint256 boostCost, uint32 newBoostExpiry)","event NFTWithdrawn(uint256 indexed tokenId, address indexed owner)","event EarningsWithdrawn(address indexed owner, uint256 amount)"],l0=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function ownerOf(uint256 tokenId) view returns (address)"];function $n(e){const t=Is();return new window.ethers.Contract(t.RENTAL_MANAGER,Ps,e)}async function Oe(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>q);return{NetworkManager:a}},void 0),t=Is();return new window.ethers.Contract(t.RENTAL_MANAGER,Ps,e.getProvider())}function c0(e){const t=Is();return new window.ethers.Contract(t.NFT_CONTRACT,l0,e)}async function Tr({tokenId:e,pricePerDay:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=Is(),i=BigInt(t);return await M.execute({name:"ListNFT",button:a,getContract:async r=>$n(r),method:"listNFT",args:[e,i],validate:async(r,l)=>{const c=c0(r);if((await c.ownerOf(e)).toLowerCase()!==l.toLowerCase())throw new Error("You do not own this NFT");if(!await c.isApprovedForAll(l,s.RENTAL_MANAGER)){const{NetworkManager:g}=await U(async()=>{const{NetworkManager:y}=await Promise.resolve().then(()=>q);return{NetworkManager:y}},void 0),m=await g.getProvider().getFeeData(),h={gasLimit:100000n};m.maxFeePerGas&&(h.maxFeePerGas=m.maxFeePerGas*120n/100n,h.maxPriorityFeePerGas=m.maxPriorityFeePerGas||0n),await(await c.setApprovalForAll(s.RENTAL_MANAGER,!0,h)).wait()}},onSuccess:n,onError:o})}async function Cr({tokenId:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=window.ethers;let i=t,r=0n;return await M.execute({name:"RentNFT",button:a,getContract:async l=>$n(l),method:"rentNFT",args:()=>[e,K(i)],get value(){return r},validate:async(l,c)=>{const d=await Oe(),f=await d.getListing(e);if(f.owner===s.ZeroAddress)throw new Error("NFT is not listed for rent");if(f.currentlyRented)throw new Error("NFT is currently rented");if(await d.hasActiveRental(c))throw new Error("You already have an active rental. Wait for it to expire before renting another.");const m=await d.getRentalCost(e),h=m.rentalCost||m[0],w=await W(s.id("RENTAL_RENT"),h);r=h+w;const{NetworkManager:y}=await U(async()=>{const{NetworkManager:v}=await Promise.resolve().then(()=>q);return{NetworkManager:v}},void 0);if(await y.getProvider().getBalance(c)<r+s.parseEther("0.001"))throw new Error(`Insufficient BNB. Need ${s.formatEther(r)} BNB + gas`)},onSuccess:async l=>{let c=null;try{const d=new s.Interface(Ps);for(const f of l.logs)try{const g=d.parseLog(f);if((g==null?void 0:g.name)==="NFTRented"){c={endTime:Number(g.args.endTime),rentalCost:g.args.rentalCost,ethFee:g.args.ethFee};break}}catch{}}catch{}n&&n(l,c)},onError:o})}async function Br({tokenId:e,button:t=null,onSuccess:a=null,onError:n=null}){const o=window.ethers;return await M.execute({name:"WithdrawNFT",button:t,getContract:async s=>$n(s),method:"withdrawNFT",args:[e],validate:async(s,i)=>{const l=await(await Oe()).getListing(e);if(l.owner===o.ZeroAddress)throw new Error("NFT is not listed");if(l.owner.toLowerCase()!==i.toLowerCase())throw new Error("Only the owner can withdraw");if(l.currentlyRented)throw new Error("Cannot withdraw while NFT is rented")},onSuccess:a,onError:n})}async function tp({button:e=null,onSuccess:t=null,onError:a=null}={}){const n=window.ethers;return await M.execute({name:"WithdrawEarnings",button:e,getContract:async o=>$n(o),method:"withdrawEarnings",args:[],validate:async(o,s)=>{const r=await(await Oe()).pendingEarnings(s);if(r===0n)throw new Error("No earnings to withdraw");console.log("[RentalTx] Withdrawing:",n.formatEther(r),"BNB")},onSuccess:t,onError:a})}async function ap({tokenId:e,pricePerDay:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=BigInt(t);return await M.execute({name:"UpdateListing",button:a,getContract:async i=>$n(i),method:"updateListing",args:[e,s],validate:async(i,r)=>{const c=await(await Oe()).getListing(e);if(c.owner===window.ethers.ZeroAddress)throw new Error("NFT is not listed");if(c.owner.toLowerCase()!==r.toLowerCase())throw new Error("Only the owner can update")},onSuccess:n,onError:o})}async function np({tokenId:e,days:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers;let r=a,l=0n;return await M.execute({name:"BoostListing",button:n,getContract:async c=>$n(c),method:"boostListing",args:()=>[e,t,K(r)],get value(){return l},validate:async(c,d)=>{const g=await(await Oe()).getListing(e);if(g.owner===i.ZeroAddress)throw new Error("NFT is not listed");if(g.owner.toLowerCase()!==d.toLowerCase())throw new Error("Only the listing owner can boost");if(l=await W(i.id("RENTAL_BOOST"))*BigInt(t),l===0n)throw new Error("Could not calculate boost fee");const{NetworkManager:h}=await U(async()=>{const{NetworkManager:y}=await Promise.resolve().then(()=>q);return{NetworkManager:y}},void 0);if(await h.getProvider().getBalance(d)<l+i.parseEther("0.001"))throw new Error(`Insufficient BNB. Need ${i.formatEther(l)} BNB + gas`)},onSuccess:async c=>{let d=null;try{const f=new i.Interface(Ps);for(const g of c.logs)try{const m=f.parseLog(g);if((m==null?void 0:m.name)==="ListingBoosted"){d={days:Number(m.args.days_),boostCost:m.args.boostCost,newBoostExpiry:Number(m.args.newBoostExpiry)};break}}catch{}}catch{}o&&o(c,d)},onError:s})}async function op(e){const t=window.ethers,n=await(await Oe()).getListing(e);return{owner:n.owner,pricePerDay:n.pricePerDay,pricePerDayFormatted:t.formatEther(n.pricePerDay),totalEarnings:n.totalEarnings,totalEarningsFormatted:t.formatEther(n.totalEarnings),rentalCount:Number(n.rentalCount),isActive:n.owner!==t.ZeroAddress,currentlyRented:n.currentlyRented,rentalEndTime:Number(n.rentalEndTime),isBoosted:n.isBoosted,boostExpiry:Number(n.boostExpiry)}}async function sp(e){const a=await(await Oe()).getRental(e),n=Math.floor(Date.now()/1e3),o=Number(a.endTime);return{tenant:a.tenant,endTime:o,isActive:a.isActive,hoursRemaining:a.isActive?Math.max(0,Math.ceil((o-n)/3600)):0}}async function ip(){return(await(await Oe()).getAllListedTokenIds()).map(a=>Number(a))}async function rp(){const e=await Oe();return Number(await e.getListingCount())}async function lp(){const t=await(await Oe()).getAvailableListings(),a=(t.tokenIds||t[0]).map(o=>Number(o)),n=t.boosted||t[1];return a.map((o,s)=>({tokenId:o,isBoosted:n[s]}))}async function cp(e){const t=window.ethers,n=await(await Oe()).getRentalCost(e),o=n.rentalCost||n[0],s=await W(t.id("RENTAL_RENT"),o),i=o+s;return{rentalCost:o,rentalCostFormatted:t.formatEther(o),ethFee:s,ethFeeFormatted:t.formatEther(s),totalCost:i,totalCostFormatted:t.formatEther(i)}}async function dp(e){const t=window.ethers,a=await W(t.id("RENTAL_BOOST")),n=a*BigInt(e);return{feePerDay:a,feePerDayFormatted:t.formatEther(a),totalFee:n,totalFeeFormatted:t.formatEther(n)}}async function up(e){return await(await Oe()).isRented(e)}async function pp(e){const t=await Oe();return Number(await t.getRemainingTime(e))}async function fp(e){const t=await Oe();try{return await t.hasActiveRental(e)}catch{return!1}}async function gp(e){const t=window.ethers,n=await(await Oe()).pendingEarnings(e);return{amount:n,formatted:t.formatEther(n)}}async function mp(){const e=window.ethers,t=await Oe();try{const a=await t.getStats();return{activeListings:Number(a.activeListings||a[0]),totalVolume:a.volume||a[1],totalVolumeFormatted:e.formatEther(a.volume||a[1]),totalRentals:Number(a.rentals||a[2]),totalEthFees:a.ethFees||a[3],totalEthFeesFormatted:e.formatEther(a.ethFees||a[3]),totalEarningsWithdrawn:a.earningsWithdrawn||a[4],totalEarningsWithdrawnFormatted:e.formatEther(a.earningsWithdrawn||a[4]),totalBoostRevenue:a.boostRevenue||a[5],totalBoostRevenueFormatted:e.formatEther(a.boostRevenue||a[5])}}catch{return{activeListings:0,totalVolume:0n,totalVolumeFormatted:"0",totalRentals:0,totalEthFees:0n,totalEthFeesFormatted:"0",totalBoostRevenue:0n,totalBoostRevenueFormatted:"0"}}}const bp=Tr,xp=Cr,hp=Br,_t={listNft:Tr,rentNft:Cr,withdrawNft:Br,withdrawEarnings:tp,updateListing:ap,boostListing:np,getBoostCost:dp,list:bp,rent:xp,withdraw:hp,getListing:op,getAllListedTokenIds:ip,getListingCount:rp,getAvailableListings:lp,getRentalCost:cp,getRental:sp,isRented:up,getRemainingRentalTime:pp,hasActiveRental:fp,getPendingEarnings:gp,getMarketplaceStats:mp},d0=Object.freeze(Object.defineProperty({__proto__:null,RentalTx:_t,boostListing:np,getAllListedTokenIds:ip,getAvailableListings:lp,getBoostCost:dp,getListing:op,getListingCount:rp,getMarketplaceStats:mp,getPendingEarnings:gp,getRemainingRentalTime:pp,getRental:sp,getRentalCost:cp,hasActiveRental:fp,isRented:up,list:bp,listNft:Tr,rent:xp,rentNft:Cr,updateListing:ap,withdraw:hp,withdrawEarnings:tp,withdrawNft:Br},Symbol.toStringTag,{value:"Module"}));function vp(){var t;const e=(E==null?void 0:E.notary)||(R==null?void 0:R.notary)||((t=window.contractAddresses)==null?void 0:t.notary);if(!e)throw console.error("âŒ Notary address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{NOTARY:e}}const xo=["function certify(bytes32 documentHash, string calldata meta, uint8 docType, address operator) external payable returns (uint256 certId)","function batchCertify(bytes32[] calldata documentHashes, string[] calldata metas, uint8[] calldata docTypes, address operator) external payable returns (uint256 startId)","function transferCertificate(bytes32 documentHash, address newOwner, address operator) external payable","function registerAsset(uint8 assetType, string calldata meta, bytes32 documentHash, address operator) external payable returns (uint256 tokenId)","function transferAsset(uint256 tokenId, address newOwner, uint256 declaredValue, string calldata meta, address operator) external payable","function addAnnotation(uint256 tokenId, uint8 annotationType, string calldata meta, address operator) external payable returns (uint256 annotationId)","function setBaseURI(string calldata newBaseURI) external","function approve(address to, uint256 tokenId) external","function setApprovalForAll(address operator, bool approved) external","function transferFrom(address from, address to, uint256 tokenId) external","function safeTransferFrom(address from, address to, uint256 tokenId) external","function verify(bytes32 documentHash) view returns (bool exists, address owner, uint48 timestamp, uint8 docType, string memory meta)","function getCertificate(uint256 certId) view returns (bytes32 documentHash, address owner, uint48 timestamp, uint8 docType, string memory meta)","function getCertificatesBatch(uint256 start, uint256 count) view returns (bytes32[] memory hashes, address[] memory owners, uint48[] memory timestamps, uint8[] memory docTypes)","function getFee() view returns (uint256)","function getAsset(uint256 tokenId) view returns (address owner, uint48 registeredAt, uint8 assetType, uint8 annotationCount, uint32 transferCount, string memory meta, bytes32 documentHash)","function getAnnotation(uint256 tokenId, uint256 index) view returns (address author, uint48 timestamp, uint8 annotationType, string memory meta)","function getAnnotationCount(uint256 tokenId) view returns (uint256)","function isAsset(uint256 tokenId) view returns (bool)","function getStats() view returns (uint256 certCount, uint256 totalTransfers, uint256 assetCount, uint256 annotationTotal)","function certCount() view returns (uint256)","function assetCount() view returns (uint256)","function annotationTotal() view returns (uint256)","function version() view returns (string)","function MAX_BATCH_SIZE() view returns (uint8)","function MAX_ASSET_TYPE() view returns (uint8)","function MAX_ANNOTATION_TYPE() view returns (uint8)","function ownerOf(uint256 tokenId) view returns (address)","function balanceOf(address owner) view returns (uint256)","function tokenURI(uint256 tokenId) view returns (string)","function totalSupply() view returns (uint256)","function name() view returns (string)","function symbol() view returns (string)","function supportsInterface(bytes4 interfaceId) view returns (bool)","event Certified(uint256 indexed certId, address indexed owner, bytes32 indexed documentHash, uint8 docType, address operator)","event BatchCertified(address indexed owner, uint256 startId, uint256 count, address operator)","event CertificateTransferred(bytes32 indexed documentHash, address indexed from, address indexed to)","event AssetRegistered(uint256 indexed tokenId, address indexed owner, uint8 assetType, bytes32 documentHash, address operator)","event AssetTransferred(uint256 indexed tokenId, address indexed from, address indexed to, uint256 declaredValue, uint48 timestamp)","event AnnotationAdded(uint256 indexed tokenId, uint256 indexed annotationId, address indexed author, uint8 annotationType)","event BaseURIUpdated(string newBaseURI)","event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)","event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId)","event ApprovalForAll(address indexed owner, address indexed operator, bool approved)"],u0={GENERAL:0,CONTRACT:1,IDENTITY:2,DIPLOMA:3,PROPERTY:4,FINANCIAL:5,LEGAL:6,MEDICAL:7,IP:8,OTHER:9},yp=["General","Contract","Identity","Diploma","Property","Financial","Legal","Medical","IP","Other"],p0={IMOVEL:0,VEICULO:1,IP:2,OUTROS:3},wp=["ImÃ³vel","VeÃ­culo","Propriedade Intelectual","Outros"],f0={HIPOTECA:0,PENHORA:1,ORDEM_JUDICIAL:2,SEGURO:3,REFORMA:4,OBSERVACAO:5,CANCELAMENTO:6},kp=["Hipoteca","Penhora","Ordem Judicial","Seguro","Reforma","ObservaÃ§Ã£o","Cancelamento"];function ho(e){const t=window.ethers;if(!t)throw new Error("ethers.js not loaded");if(!e)throw new Error("Signer is required for write operations");const a=vp();return new t.Contract(a.NOTARY,xo,e)}async function rt(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");const{NetworkManager:t}=await U(async()=>{const{NetworkManager:o}=await Promise.resolve().then(()=>q);return{NetworkManager:o}},void 0),a=t.getProvider();if(!a)throw new Error("Provider not available");const n=vp();return new e.Contract(n.NOTARY,xo,a)}function g0(e){if(!e)return!1;const t=e.startsWith("0x")?e:`0x${e}`;return/^0x[a-fA-F0-9]{64}$/.test(t)}function Ar(){return window.ethers.id("NOTARY_CERTIFY")}const Xo=400000000000000n;function Ns(e){return e.startsWith("0x")?e:`0x${e}`}async function Ir({documentHash:e,meta:t="",docType:a=0,operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers;if(!e)throw new Error("Document hash is required");const l=Ns(e);if(!g0(l))throw new Error("Invalid document hash format. Must be a valid bytes32 (64 hex characters)");if(a<0||a>9)throw new Error("Document type must be between 0 and 9");let c=n,d=0n;return await M.execute({name:"Certify",button:o,getContract:async f=>ho(f),method:"certify",args:()=>[l,t||"",a,K(c)],get value(){return d},validate:async(f,g)=>{if((await(await rt()).verify(l)).exists)throw new Error("This document hash has already been certified");const w=Ar();d=await W(w),d<Xo&&(d=Xo),console.log("[NotaryTx] Certify fee:",r.formatEther(d),"BNB");const{NetworkManager:y}=await U(async()=>{const{NetworkManager:I}=await Promise.resolve().then(()=>q);return{NetworkManager:I}},void 0),v=await y.getProvider().getBalance(g),T=d+r.parseEther("0.001");if(v<T)throw new Error(`Insufficient BNB. Need ~${r.formatEther(T)} BNB for fee + gas`)},onSuccess:async f=>{let g=null;try{const m=new r.Interface(xo);for(const h of f.logs)try{const w=m.parseLog(h);if(w&&w.name==="Certified"){g=Number(w.args.certId);break}}catch{}}catch{}s&&s(f,g)},onError:f=>{console.error("[NotaryTx] Certification failed:",f),i&&i(f)}})}const Ep=Ir;async function Tp({documentHash:e,newOwner:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers;if(!e)throw new Error("Document hash is required");if(!t||t===i.ZeroAddress)throw new Error("Valid recipient address is required");const r=Ns(e);let l=a,c=0n;return await M.execute({name:"TransferCertificate",button:n,getContract:async d=>ho(d),method:"transferCertificate",args:()=>[r,t,K(l)],get value(){return c},validate:async(d,f)=>{const m=await(await rt()).verify(r);if(!m.exists)throw new Error("Certificate not found");if(m.owner.toLowerCase()!==f.toLowerCase())throw new Error("Only the certificate owner can transfer it");if(t.toLowerCase()===f.toLowerCase())throw new Error("Cannot transfer to yourself");c=await W(i.id("NOTARY_TRANSFER")),console.log("[NotaryTx] Transfer fee:",i.formatEther(c),"BNB");const{NetworkManager:h}=await U(async()=>{const{NetworkManager:v}=await Promise.resolve().then(()=>q);return{NetworkManager:v}},void 0),y=await h.getProvider().getBalance(f),k=c+i.parseEther("0.001");if(y<k)throw new Error(`Insufficient BNB. Need ~${i.formatEther(k)} BNB for transfer + gas`)},onSuccess:o,onError:s})}async function Cp({assetType:e=0,meta:t="",documentHash:a="0x"+"0".repeat(64),operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers;if(e<0||e>3)throw new Error("Asset type must be between 0 and 3");const l=a?Ns(a):"0x"+"0".repeat(64);let c=n,d=0n;return await M.execute({name:"RegisterAsset",button:o,getContract:async f=>ho(f),method:"registerAsset",args:()=>[e,t||"",l,K(c)],get value(){return d},validate:async(f,g)=>{d=await W(r.id("ASSET_REGISTER")),console.log("[NotaryTx] Asset register fee:",r.formatEther(d),"BNB");const{NetworkManager:m}=await U(async()=>{const{NetworkManager:k}=await Promise.resolve().then(()=>q);return{NetworkManager:k}},void 0),w=await m.getProvider().getBalance(g),y=d+r.parseEther("0.001");if(w<y)throw new Error(`Insufficient BNB. Need ~${r.formatEther(y)} BNB for registration + gas`)},onSuccess:async f=>{let g=null;try{const m=new r.Interface(xo);for(const h of f.logs)try{const w=m.parseLog(h);if(w&&w.name==="AssetRegistered"){g=Number(w.args.tokenId);break}}catch{}}catch{}s&&s(f,g)},onError:f=>{console.error("[NotaryTx] Asset registration failed:",f),i&&i(f)}})}async function Bp({tokenId:e,newOwner:t,declaredValue:a=0n,meta:n="",operator:o,button:s=null,onSuccess:i=null,onError:r=null}){const l=window.ethers;if(!e)throw new Error("Token ID is required");if(!t||t===l.ZeroAddress)throw new Error("Valid recipient address is required");let c=o,d=0n;return await M.execute({name:"TransferAsset",button:s,getContract:async f=>ho(f),method:"transferAsset",args:()=>[e,t,a,n||"",K(c)],get value(){return d},validate:async(f,g)=>{const m=await rt(),h=await m.getAsset(e);if(Number(h.registeredAt)===0)throw new Error("Asset not found");const w=await m.ownerOf(e);if(w.toLowerCase()!==g.toLowerCase()){const I=await m.getApproved(e),N=await m.isApprovedForAll(w,g);if(I.toLowerCase()!==g.toLowerCase()&&!N)throw new Error("Only the asset owner or approved operator can transfer it")}if(t.toLowerCase()===g.toLowerCase())throw new Error("Cannot transfer to yourself");d=await W(l.id("ASSET_TRANSFER")),console.log("[NotaryTx] Asset transfer fee:",l.formatEther(d),"BNB");const{NetworkManager:y}=await U(async()=>{const{NetworkManager:I}=await Promise.resolve().then(()=>q);return{NetworkManager:I}},void 0),v=await y.getProvider().getBalance(g),T=d+l.parseEther("0.001");if(v<T)throw new Error(`Insufficient BNB. Need ~${l.formatEther(T)} BNB for transfer + gas`)},onSuccess:i,onError:r})}async function Ap({tokenId:e,annotationType:t=5,meta:a="",operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers;if(!e)throw new Error("Token ID is required");if(t<0||t>6)throw new Error("Annotation type must be between 0 and 6");let l=n,c=0n;return await M.execute({name:"AddAnnotation",button:o,getContract:async d=>ho(d),method:"addAnnotation",args:()=>[e,t,a||"",K(l)],get value(){return c},validate:async(d,f)=>{const g=await rt(),m=await g.getAsset(e);if(Number(m.registeredAt)===0)throw new Error("Asset not found");const h=await g.ownerOf(e);if(h.toLowerCase()!==f.toLowerCase()){const T=await g.getApproved(e),I=await g.isApprovedForAll(h,f);if(T.toLowerCase()!==f.toLowerCase()&&!I)throw new Error("Only the asset owner or approved operator can add annotations")}c=await W(r.id("ASSET_ANNOTATE")),console.log("[NotaryTx] Annotation fee:",r.formatEther(c),"BNB");const{NetworkManager:w}=await U(async()=>{const{NetworkManager:T}=await Promise.resolve().then(()=>q);return{NetworkManager:T}},void 0),k=await w.getProvider().getBalance(f),v=c+r.parseEther("0.001");if(k<v)throw new Error(`Insufficient BNB. Need ~${r.formatEther(v)} BNB for annotation + gas`)},onSuccess:async d=>{let f=null;try{const g=new r.Interface(xo);for(const m of d.logs)try{const h=g.parseLog(m);if(h&&h.name==="AnnotationAdded"){f=Number(h.args.annotationId);break}}catch{}}catch{}s&&s(d,f)},onError:d=>{console.error("[NotaryTx] Annotation failed:",d),i&&i(d)}})}async function zs(e){const t=await rt(),a=Ns(e);try{const n=await t.verify(a);return{exists:n.exists,owner:n.exists?n.owner:null,timestamp:n.exists?Number(n.timestamp):null,date:n.exists?new Date(Number(n.timestamp)*1e3):null,docType:n.exists?Number(n.docType):null,meta:n.exists?n.meta:null}}catch(n){return console.error("[NotaryTx] verify error:",n),{exists:!1,owner:null,timestamp:null,date:null,docType:null,meta:null}}}const Ip=zs;async function Pr(e){const t=await rt();try{const a=await t.getCertificate(e);return a.documentHash==="0x"+"0".repeat(64)?null:{id:e,documentHash:a.documentHash,owner:a.owner,timestamp:Number(a.timestamp),date:new Date(Number(a.timestamp)*1e3),docType:Number(a.docType),meta:a.meta}}catch{return null}}const Pp=Pr;async function Np(e,t){const a=await rt();try{const n=await a.getCertificatesBatch(e,t),o=[];for(let s=0;s<n.hashes.length;s++)n.hashes[s]!=="0x"+"0".repeat(64)&&o.push({id:e+s,documentHash:n.hashes[s],owner:n.owners[s],timestamp:Number(n.timestamps[s]),date:new Date(Number(n.timestamps[s])*1e3),docType:Number(n.docTypes[s])});return o}catch(n){return console.error("[NotaryTx] getCertificatesBatch error:",n),[]}}async function zp(e){const t=await rt();try{const a=await t.getAsset(e);return Number(a.registeredAt)===0?null:{id:e,owner:a.owner,registeredAt:Number(a.registeredAt),date:new Date(Number(a.registeredAt)*1e3),assetType:Number(a.assetType),assetTypeName:wp[Number(a.assetType)]||"Outros",annotationCount:Number(a.annotationCount),transferCount:Number(a.transferCount),meta:a.meta,documentHash:a.documentHash}}catch{return null}}async function Nr(e,t){const a=await rt();try{const n=await a.getAnnotation(e,t);return n.author==="0x"+"0".repeat(40)?null:{tokenId:e,index:t,author:n.author,timestamp:Number(n.timestamp),date:new Date(Number(n.timestamp)*1e3),annotationType:Number(n.annotationType),annotationTypeName:kp[Number(n.annotationType)]||"ObservaÃ§Ã£o",meta:n.meta}}catch{return null}}async function $p(e){const t=await rt();try{const a=Number(await t.getAnnotationCount(e)),n=[];for(let o=0;o<a;o++){const s=await Nr(e,o);s&&n.push(s)}return n}catch{return[]}}async function Sp(e){const t=await rt();try{return await t.isAsset(e)}catch{return!1}}async function zr(e=0){const t=window.ethers,a=Ar();let n=await W(a);return n<Xo&&(n=Xo),{fee:n,formatted:t.formatEther(n)+" BNB",docType:e,typeName:yp[e]||"Unknown"}}async function Lp(){return zr(0)}async function _p(){const e=window.ethers,t=await W(e.id("NOTARY_TRANSFER"));return{fee:t,formatted:e.formatEther(t)+" BNB"}}async function Rp(){const e=window.ethers,t=await W(e.id("ASSET_REGISTER"));return{fee:t,formatted:e.formatEther(t)+" BNB"}}async function Fp(){const e=window.ethers,t=await W(e.id("ASSET_TRANSFER"));return{fee:t,formatted:e.formatEther(t)+" BNB"}}async function Dp(){const e=window.ethers,t=await W(e.id("ASSET_ANNOTATE"));return{fee:t,formatted:e.formatEther(t)+" BNB"}}async function Mp(){const e=await rt();return Number(await e.certCount())}async function Op(){const t=await(await rt()).getStats();return{totalCertifications:Number(t[0]),totalTransfers:Number(t[1]),totalAssets:Number(t[2]),totalAnnotations:Number(t[3])}}async function $s(e){let t;if(e instanceof ArrayBuffer)t=e;else if(e instanceof Blob||e instanceof File)t=await e.arrayBuffer();else throw new Error("Invalid file type. Expected File, Blob, or ArrayBuffer");const a=await crypto.subtle.digest("SHA-256",t);return"0x"+Array.from(new Uint8Array(a)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function Up(e){const t=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",t);return"0x"+Array.from(new Uint8Array(a)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function $r(e,t){const a=await $s(e);return Yl(t)===Yl(a)}function Yl(e){return(e.startsWith("0x")?e:`0x${e}`).toLowerCase()}async function Hp(e,t){const a=t||await $s(e),n=await zs(a);let o=!0;return t&&(o=await $r(e,t)),{contentHash:a,hashMatches:o,existsOnChain:n.exists,owner:n.owner,timestamp:n.timestamp,date:n.date,docType:n.docType,meta:n.meta,isVerified:o&&n.exists}}const ce={certify:Ir,notarize:Ep,transferCertificate:Tp,registerAsset:Cp,transferAsset:Bp,addAnnotation:Ap,verify:zs,verifyByHash:Ip,getCertificate:Pr,getDocument:Pp,getCertificatesBatch:Np,getAsset:zp,getAnnotation:Nr,getAnnotations:$p,isAsset:Sp,getFee:Lp,getCertifyFee:zr,getTransferFee:_p,getAssetRegisterFee:Rp,getAssetTransferFee:Fp,getAnnotateFee:Dp,getTotalDocuments:Mp,getStats:Op,calculateFileHash:$s,calculateTextHash:Up,verifyDocumentHash:$r,verifyDocumentOnChain:Hp,getCertifyActionId:Ar,DOC_TYPES:u0,DOC_TYPE_NAMES:yp,ASSET_TYPES:p0,ASSET_TYPE_NAMES:wp,ANNOTATION_TYPES:f0,ANNOTATION_TYPE_NAMES:kp},m0=Object.freeze(Object.defineProperty({__proto__:null,NotaryTx:ce,addAnnotation:Ap,calculateFileHash:$s,calculateTextHash:Up,certify:Ir,getAnnotateFee:Dp,getAnnotation:Nr,getAnnotations:$p,getAsset:zp,getAssetRegisterFee:Rp,getAssetTransferFee:Fp,getCertificate:Pr,getCertificatesBatch:Np,getCertifyFee:zr,getDocument:Pp,getFee:Lp,getStats:Op,getTotalDocuments:Mp,getTransferFee:_p,isAsset:Sp,notarize:Ep,registerAsset:Cp,transferAsset:Bp,transferCertificate:Tp,verify:zs,verifyByHash:Ip,verifyDocumentHash:$r,verifyDocumentOnChain:Hp},Symbol.toStringTag,{value:"Module"})),$e=["Bronze","Silver","Gold","Diamond"],et={FUSION_BRONZE:null,FUSION_SILVER:null,FUSION_GOLD:null,SPLIT_SILVER:null,SPLIT_GOLD:null,SPLIT_DIAMOND:null};function jp(){if(et.FUSION_BRONZE)return;const e=window.ethers;et.FUSION_BRONZE=e.id("FUSION_BRONZE"),et.FUSION_SILVER=e.id("FUSION_SILVER"),et.FUSION_GOLD=e.id("FUSION_GOLD"),et.SPLIT_SILVER=e.id("SPLIT_SILVER"),et.SPLIT_GOLD=e.id("SPLIT_GOLD"),et.SPLIT_DIAMOND=e.id("SPLIT_DIAMOND")}function Wp(e){return jp(),e===0?et.FUSION_BRONZE:e===1?et.FUSION_SILVER:e===2?et.FUSION_GOLD:null}function Ss(e){return jp(),e===1?et.SPLIT_SILVER:e===2?et.SPLIT_GOLD:e===3?et.SPLIT_DIAMOND:null}function ua(){var e;return(E==null?void 0:E.nftFusion)||(R==null?void 0:R.nftFusion)||((e=window.contractAddresses)==null?void 0:e.nftFusion)||null}function Sn(){var e;return(E==null?void 0:E.rewardBooster)||(R==null?void 0:R.rewardBooster)||((e=window.contractAddresses)==null?void 0:e.rewardBooster)||null}const Ln=["function fuse(uint256 tokenId1, uint256 tokenId2, address operator) external payable returns (uint256 newTokenId)","function split(uint256 tokenId, address operator) external payable returns (uint256[])","function splitTo(uint256 tokenId, uint8 targetTier, address operator) external payable returns (uint256[])","function bulkFuse(uint256[] calldata tokenIds, uint8 targetTier, address operator) external payable returns (uint256[])","function getFusionFee(uint8 sourceTier) view returns (uint256)","function getSplitFee(uint8 sourceTier) view returns (uint256)","function getMultiSplitFee(uint8 sourceTier, uint8 targetTier) view returns (uint256)","function getBulkFuseFee(uint8 fromTier, uint8 toTier, uint256 inputCount) view returns (uint256)","function previewFusion(uint256 tokenId1, uint256 tokenId2) view returns (uint8 sourceTier, uint8 resultTier, uint256 ethFee, bool canFuse)","function previewSplit(uint256 tokenId, uint8 targetTier) view returns (uint8 sourceTier, uint256 mintCount, uint256 ethFee, bool canSplit)","function getStats() view returns (uint256 totalFusions, uint256 totalSplits, uint256 bronzeFusions, uint256 silverFusions, uint256 goldFusions, uint256 silverSplits, uint256 goldSplits, uint256 diamondSplits)","function version() view returns (string)","event Fused(address indexed user, uint256 indexed tokenId1, uint256 indexed tokenId2, uint256 newTokenId, uint8 sourceTier, uint8 resultTier, address operator)","event Split(address indexed user, uint256 indexed burnedTokenId, uint8 sourceTier, uint8 targetTier, uint256 mintCount, uint256[] newTokenIds, address operator)","event BulkFused(address indexed user, uint256 inputCount, uint8 sourceTier, uint256 outputCount, uint8 targetTier, uint256 totalFee, address operator)"],Gp=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function tokenTier(uint256 tokenId) view returns (uint8)","function ownerOf(uint256 tokenId) view returns (address)"];function Ls(e){const t=ua();if(!t)throw new Error("NFTFusion contract address not loaded");return new window.ethers.Contract(t,Ln,e)}async function Sr(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>q);return{NetworkManager:a}},void 0),t=ua();if(!t)throw new Error("NFTFusion contract address not loaded");return new window.ethers.Contract(t,Ln,e.getProvider())}async function _n(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>q);return{NetworkManager:a}},void 0),t=Sn();if(!t)throw new Error("RewardBooster address not loaded");return new window.ethers.Contract(t,Gp,e.getProvider())}async function _s(e,t){const a=window.ethers,n=ua(),o=Sn();if(await(await _n()).isApprovedForAll(t,n))return;console.log("[Fusion] Requesting ERC-721 approval for fusion contract...");const{NetworkManager:r}=await U(async()=>{const{NetworkManager:m}=await Promise.resolve().then(()=>q);return{NetworkManager:m}},void 0),l=r.getProvider(),c=await l.getFeeData(),d={gasLimit:100000n};c.maxFeePerGas&&(d.maxFeePerGas=c.maxFeePerGas*120n/100n,d.maxPriorityFeePerGas=c.maxPriorityFeePerGas||0n);const g=await new a.Contract(o,Gp,e).setApprovalForAll(n,!0,d);for(let m=0;m<30;m++){if(await new Promise(w=>setTimeout(w,1500)),await l.getTransactionReceipt(g.hash)){console.log("[Fusion] ERC-721 approval confirmed");break}m===29&&console.warn("[Fusion] Approval confirmation timeout, proceeding anyway")}await new Promise(m=>setTimeout(m,1500))}async function Kp({tokenId1:e,tokenId2:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers,r=ua(),l=Sn();if(!r||!l)throw new Error("Contract addresses not loaded");let c=0n,d=0;return await M.execute({name:"FuseNFTs",button:n,getContract:async f=>Ls(f),method:"fuse",args:()=>[BigInt(e),BigInt(t),K(a)],get value(){return c},get approval(){return{token:l,spender:r,isERC721:!0}},validate:async(f,g)=>{const m=await _n(),[h,w]=await Promise.all([m.ownerOf(e),m.ownerOf(t)]);if(h.toLowerCase()!==g.toLowerCase())throw new Error(`You don't own NFT #${e}`);if(w.toLowerCase()!==g.toLowerCase())throw new Error(`You don't own NFT #${t}`);const[y,k]=await Promise.all([m.tokenTier(e),m.tokenTier(t)]);if(d=Number(y),Number(k)!==d)throw new Error(`NFTs must be the same tier (got ${$e[d]} and ${$e[Number(k)]})`);if(d>=3)throw new Error("Diamond NFTs cannot be fused (already max tier)");const v=Wp(d);c=await W(v),console.log(`[FuseNFTs] ${$e[d]} â†’ ${$e[d+1]}, Fee: ${i.formatEther(c)} ETH`);const{NetworkManager:T}=await U(async()=>{const{NetworkManager:N}=await Promise.resolve().then(()=>q);return{NetworkManager:N}},void 0);if(await T.getProvider().getBalance(g)<c+i.parseEther("0.001"))throw new Error("Insufficient BNB for fee + gas");await _s(f,g)},onSuccess:async f=>{let g=null;try{const m=new i.Interface(Ln);for(const h of f.logs)try{const w=m.parseLog(h);if((w==null?void 0:w.name)==="Fused"){g=Number(w.args.newTokenId);break}}catch{}}catch{}console.log(`[FuseNFTs] Success! New ${$e[d+1]} NFT #${g}`),o&&o({receipt:f,newTokenId:g,resultTier:d+1})},onError:f=>{s&&s(f)}})}async function Vp({tokenId:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=window.ethers,i=ua(),r=Sn();if(!i||!r)throw new Error("Contract addresses not loaded");let l=0n,c=0;return await M.execute({name:"SplitNFT",button:a,getContract:async d=>Ls(d),method:"split",args:()=>[BigInt(e),K(t)],get value(){return l},get approval(){return{token:r,spender:i,isERC721:!0}},validate:async(d,f)=>{const g=await _n();if((await g.ownerOf(e)).toLowerCase()!==f.toLowerCase())throw new Error(`You don't own NFT #${e}`);const h=await g.tokenTier(e);if(c=Number(h),c===0)throw new Error("Bronze NFTs cannot be split (already lowest tier)");const w=Ss(c);l=await W(w),console.log(`[SplitNFT] ${$e[c]} â†’ 2x ${$e[c-1]}, Fee: ${s.formatEther(l)} ETH`);const{NetworkManager:y}=await U(async()=>{const{NetworkManager:v}=await Promise.resolve().then(()=>q);return{NetworkManager:v}},void 0);if(await y.getProvider().getBalance(f)<l+s.parseEther("0.001"))throw new Error("Insufficient BNB for fee + gas");await _s(d,f)},onSuccess:async d=>{let f=[];try{const g=new s.Interface(Ln);for(const m of d.logs)try{const h=g.parseLog(m);if((h==null?void 0:h.name)==="Split"){f=h.args.newTokenIds.map(Number);break}}catch{}}catch{}console.log(`[SplitNFT] Success! 2x ${$e[c-1]} NFTs: ${f.join(", ")}`),n&&n({receipt:d,newTokenIds:f,targetTier:c-1})},onError:d=>{o&&o(d)}})}async function Yp({tokenId:e,targetTier:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers,r=ua(),l=Sn();if(!r||!l)throw new Error("Contract addresses not loaded");let c=0n,d=0;return await M.execute({name:"SplitNFTTo",button:n,getContract:async f=>Ls(f),method:"splitTo",args:()=>[BigInt(e),Number(t),K(a)],get value(){return c},get approval(){return{token:l,spender:r,isERC721:!0}},validate:async(f,g)=>{const m=await _n();if((await m.ownerOf(e)).toLowerCase()!==g.toLowerCase())throw new Error(`You don't own NFT #${e}`);const w=await m.tokenTier(e);if(d=Number(w),d===0)throw new Error("Bronze NFTs cannot be split");if(t>=d)throw new Error("Target tier must be lower than source tier");c=0n;for(let I=d;I>t;I--){const N=Ss(I);c+=await W(N)}const k=1<<d-t;console.log(`[SplitNFTTo] ${$e[d]} â†’ ${k}x ${$e[t]}, Fee: ${i.formatEther(c)} ETH`);const{NetworkManager:v}=await U(async()=>{const{NetworkManager:I}=await Promise.resolve().then(()=>q);return{NetworkManager:I}},void 0);if(await v.getProvider().getBalance(g)<c+i.parseEther("0.001"))throw new Error("Insufficient BNB for fee + gas");await _s(f,g)},onSuccess:async f=>{let g=[];try{const m=new i.Interface(Ln);for(const h of f.logs)try{const w=m.parseLog(h);if((w==null?void 0:w.name)==="Split"){g=w.args.newTokenIds.map(Number);break}}catch{}}catch{}console.log(`[SplitNFTTo] Success! ${g.length}x ${$e[t]} NFTs`),o&&o({receipt:f,newTokenIds:g,targetTier:t})},onError:f=>{s&&s(f)}})}async function qp({tokenIds:e,targetTier:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers,r=ua(),l=Sn();if(!r||!l)throw new Error("Contract addresses not loaded");let c=0n,d=0;return await M.execute({name:"BulkFuseNFTs",button:n,getContract:async f=>Ls(f),method:"bulkFuse",args:()=>[e.map(f=>BigInt(f)),Number(t),K(a)],get value(){return c},get approval(){return{token:l,spender:r,isERC721:!0}},validate:async(f,g)=>{const m=await _n(),h=await Promise.all(e.map(I=>m.tokenTier(I)));d=Number(h[0]);for(let I=0;I<h.length;I++)if(Number(h[I])!==d)throw new Error("All NFTs must be the same tier");if(t<=d)throw new Error("Target tier must be higher than source tier");if(t>3)throw new Error("Cannot fuse above Diamond");const y=1<<t-d;if(e.length%y!==0)throw new Error(`Need multiples of ${y} NFTs for ${$e[d]} â†’ ${$e[t]}`);c=await(await Sr()).getBulkFuseFee(d,t,e.length),console.log(`[BulkFuse] ${e.length}x ${$e[d]} â†’ ${e.length/y}x ${$e[t]}, Fee: ${i.formatEther(c)} BNB`);const{NetworkManager:v}=await U(async()=>{const{NetworkManager:I}=await Promise.resolve().then(()=>q);return{NetworkManager:I}},void 0);if(await v.getProvider().getBalance(g)<c+i.parseEther("0.001"))throw new Error("Insufficient BNB for fee + gas");await _s(f,g)},onSuccess:async f=>{let g=[];try{const h=new i.Interface(Ln);for(const y of f.logs)try{const k=h.parseLog(y);if((k==null?void 0:k.name)==="BulkFused")break}catch{}const w=new i.Interface(["event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)"]);for(const y of f.logs)try{const k=w.parseLog(y);(k==null?void 0:k.name)==="Transfer"&&k.args.from===i.ZeroAddress&&g.push(Number(k.args.tokenId))}catch{}}catch{}const m=e.length/(1<<t-d);console.log(`[BulkFuse] Success! ${m}x ${$e[t]} NFTs: ${g.join(", ")}`),o&&o({receipt:f,newTokenIds:g,targetTier:t,sourceTier:d,inputCount:e.length})},onError:f=>{s&&s(f)}})}async function Xp(e){const t=Wp(Number(e));return t?await W(t):0n}async function Jp(e){const t=Ss(Number(e));return t?await W(t):0n}async function Zp(e,t){let a=0n;for(let n=Number(e);n>Number(t);n--){const o=Ss(n);a+=await W(o)}return a}async function Qp(e,t,a){return await(await Sr()).getBulkFuseFee(Number(e),Number(t),Number(a))}async function ef(){const t=await(await Sr()).getStats();return{totalFusions:Number(t[0]),totalSplits:Number(t[1]),bronzeFusions:Number(t[2]),silverFusions:Number(t[3]),goldFusions:Number(t[4]),silverSplits:Number(t[5]),goldSplits:Number(t[6]),diamondSplits:Number(t[7])}}async function tf(e){const t=ua();return t?await(await _n()).isApprovedForAll(e,t):!1}const Wt={fuseNfts:Kp,splitNft:Vp,splitNftTo:Yp,bulkFuseNfts:qp,getEstimatedFusionFee:Xp,getEstimatedSplitFee:Jp,getEstimatedMultiSplitFee:Zp,getEstimatedBulkFuseFee:Qp,getFusionStats:ef,isFusionApproved:tf,TIER_NAMES:$e},b0=Object.freeze(Object.defineProperty({__proto__:null,FusionTx:Wt,bulkFuseNfts:qp,fuseNfts:Kp,getEstimatedBulkFuseFee:Qp,getEstimatedFusionFee:Xp,getEstimatedMultiSplitFee:Zp,getEstimatedSplitFee:Jp,getFusionStats:ef,isFusionApproved:tf,splitNft:Vp,splitNftTo:Yp},Symbol.toStringTag,{value:"Module"}));function Lr(){var e;return(E==null?void 0:E.buybackMiner)||(R==null?void 0:R.buybackMiner)||((e=window.contractAddresses)==null?void 0:e.buybackMiner)||null}async function Ka(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:a}=await Promise.resolve().then(()=>q);return{NetworkManager:a}},void 0),t=Lr();if(!t)throw new Error("BuybackMiner contract address not loaded");return new window.ethers.Contract(t,Ua,e.getProvider())}async function af({button:e,onSuccess:t,onError:a}={}){const n=Lr();if(!n)throw new Error("BuybackMiner contract address not loaded");const o=await Rs();return M.execute({getContract:s=>new window.ethers.Contract(n,Ua,s),method:"executeBuyback",args:[],value:o,button:e,txName:"Execute Buyback",onSuccess:s=>{console.log("[BuybackTx] Buyback executed:",s.hash),t==null||t(s)},onError:s=>{console.error("[BuybackTx] Buyback failed:",s.message),a==null||a(s)}})}async function nf({minTotalBkcOut:e,button:t,onSuccess:a,onError:n}={}){const o=Lr();if(!o)throw new Error("BuybackMiner contract address not loaded");const s=await Rs();return M.execute({getContract:i=>new window.ethers.Contract(o,Ua,i),method:"executeBuybackWithSlippage",args:[e],value:s,button:t,txName:"Execute Buyback (Slippage)",onSuccess:i=>{console.log("[BuybackTx] Buyback with slippage executed:",i.hash),a==null||a(i)},onError:i=>{console.error("[BuybackTx] Buyback with slippage failed:",i.message),n==null||n(i)}})}async function Rs(){return(await Ka()).executionFee()}async function of(){const t=await(await Ka()).previewBuyback();return{ethAvailable:t[0],estimatedBkcPurchased:t[1],estimatedBkcMined:t[2],estimatedBurn:t[3],estimatedToStakers:t[4],estimatedCallerReward:t[5],currentMiningRateBps:t[6],isReady:t[7]}}async function sf(){return(await Ka()).pendingBuybackETH()}async function rf(){return(await Ka()).currentMiningRate()}async function lf(){const t=await(await Ka()).getBuybackStats();return{totalBuybacks:t[0],totalEthSpent:t[1],totalBkcPurchased:t[2],totalBkcMined:t[3],totalBkcBurned:t[4],totalBkcToStakers:t[5],totalCallerRewards:t[6],avgEthPerBuyback:t[7],avgBkcPerBuyback:t[8]}}async function cf(){const t=await(await Ka()).getLastBuyback();return{timestamp:t[0],blockNumber:t[1],caller:t[2],ethSpent:t[3],bkcTotal:t[4],timeSinceLast:t[5]}}async function df(){const t=await(await Ka()).getSupplyInfo();return{currentSupply:t[0],maxSupply:t[1],totalMintedViaMining:t[2],remainingMintable:t[3],miningRateBps:t[4],totalBurnedLifetime:t[5]}}const Gt={executeBuyback:af,executeBuybackWithSlippage:nf,getExecutionFee:Rs,getPreviewBuyback:of,getPendingETH:sf,getMiningRate:rf,getBuybackStats:lf,getLastBuyback:cf,getSupplyInfo:df},x0=Object.freeze(Object.defineProperty({__proto__:null,BuybackTx:Gt,executeBuyback:af,executeBuybackWithSlippage:nf,getBuybackStats:lf,getExecutionFee:Rs,getLastBuyback:cf,getMiningRate:rf,getPendingETH:sf,getPreviewBuyback:of,getSupplyInfo:df},Symbol.toStringTag,{value:"Module"}));function uf(){var t;const e=(E==null?void 0:E.agora)||(R==null?void 0:R.agora)||((t=window.contractAddresses)==null?void 0:t.agora);if(!e)throw new Error("Agora contract address not loaded");return{AGORA:e}}const Fs=la;function ge(e){return new window.ethers.Contract(uf().AGORA,Fs,e)}async function me(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:t}=await Promise.resolve().then(()=>q);return{NetworkManager:t}},void 0);return new window.ethers.Contract(uf().AGORA,Fs,e.getProvider())}async function pf({username:e,metadataURI:t="",operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers;let r=a,l=0n;return await M.execute({name:"CreateProfile",button:n,skipSimulation:!0,fixedGasLimit:300000n,getContract:async c=>ge(c),method:"createProfile",args:()=>[e,t||"",K(r)],get value(){return l},validate:async(c,d)=>{const f=await me();if(!e||e.length<1||e.length>15)throw new Error("Username must be 1-15 characters");if(!/^[a-z0-9_]+$/.test(e))throw new Error("Username: lowercase letters, numbers, underscores only");if(!await f.isUsernameAvailable(e))throw new Error("Username is already taken");l=await f.getUsernamePrice(e.length),console.log("[Agora] Username fee:",i.formatEther(l),"BNB");const{NetworkManager:m}=await U(async()=>{const{NetworkManager:w}=await Promise.resolve().then(()=>q);return{NetworkManager:w}},void 0);if(await m.getProvider().getBalance(d)<l+i.parseEther("0.001"))throw new Error(`Insufficient BNB. Need ~${i.formatEther(l+i.parseEther("0.001"))} BNB`)},onSuccess:o,onError:s})}async function ff({metadataURI:e,button:t=null,onSuccess:a=null,onError:n=null}){return await M.execute({name:"UpdateProfile",button:t,skipSimulation:!0,fixedGasLimit:200000n,getContract:async o=>ge(o),method:"updateProfile",args:[e||""],onSuccess:a,onError:n})}async function gf({content:e,tag:t=0,contentType:a=0,operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers;let l=n,c=0n;return await M.execute({name:"CreatePost",button:o,skipSimulation:!0,fixedGasLimit:2000000n,getContract:async d=>ge(d),method:"createPost",args:()=>[e,t,a,K(l)],get value(){return c},validate:async(d,f)=>{if(!e||e.length===0)throw new Error("Content is required");if(t<0||t>14)throw new Error("Tag must be 0-14");if(a===1||a===2||a===4){const m={1:"AGORA_POST_IMAGE",2:"AGORA_POST_VIDEO",4:"AGORA_LIVE"};c=await W(r.id(m[a]),0n),console.log(`[Agora] Post fee (${m[a]}):`,r.formatEther(c),"BNB")}else c=0n,console.log("[Agora] Text/link post: FREE")},onSuccess:async d=>{let f=null;try{const g=new r.Interface(Fs);for(const m of d.logs)try{const h=g.parseLog(m);if((h==null?void 0:h.name)==="PostCreated"){f=Number(h.args[0]);break}}catch{}}catch{}s&&s(d,f)},onError:i})}async function mf({parentId:e,content:t,contentType:a=0,operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers;let l=n,c=0n;return await M.execute({name:"CreateReply",button:o,skipSimulation:!0,fixedGasLimit:2000000n,getContract:async d=>ge(d),method:"createReply",args:()=>[e,t,a,K(l)],get value(){return c},validate:async(d,f)=>{if(!t)throw new Error("Content is required");a===1||a===2||a===4?c=await W(r.id("AGORA_REPLY"),0n):c=0n},onSuccess:async d=>{let f=null;try{const g=new r.Interface(Fs);for(const m of d.logs)try{const h=g.parseLog(m);if((h==null?void 0:h.name)==="ReplyCreated"){f=Number(h.args[0]);break}}catch{}}catch{}s&&s(d,f)},onError:i})}async function bf({originalPostId:e,quote:t="",operator:a,button:n=null,onSuccess:o=null,onError:s=null}){let i=a;return await M.execute({name:"CreateRepost",button:n,skipSimulation:!0,fixedGasLimit:1000000n,getContract:async r=>ge(r),method:"createRepost",args:()=>[e,t||"",K(i)],onSuccess:o,onError:s})}async function xf({postId:e,newContent:t,button:a=null,onSuccess:n=null,onError:o=null}){return await M.execute({name:"EditPost",button:a,skipSimulation:!0,fixedGasLimit:2000000n,getContract:async s=>ge(s),method:"editPost",args:[e,t],validate:async()=>{if(!t||t.length===0)throw new Error("Content is required")},onSuccess:n,onError:o})}async function hf({postId:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=window.ethers;let i=t,r=0n;return await M.execute({name:"Like",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async l=>ge(l),method:"like",args:()=>[e,K(i)],get value(){return r},validate:async(l,c)=>{if(await(await me()).hasLiked(e,c))throw new Error("Already liked this post");r=await W(s.id("AGORA_LIKE"),0n)},onSuccess:n,onError:o})}async function vf({postId:e,ethAmount:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){let i=a;const r=BigInt(t);return await M.execute({name:"SuperLike",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async l=>ge(l),method:"superLike",args:()=>[e,K(i)],value:r,validate:async()=>{if(r<=0n)throw new Error("SuperLike requires BNB > 0")},onSuccess:o,onError:s})}async function yf({postId:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=window.ethers;let i=t,r=0n;return await M.execute({name:"Downvote",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async l=>ge(l),method:"downvote",args:()=>[e,K(i)],get value(){return r},validate:async(l,c)=>{if(await(await me()).hasDownvoted(e,c))throw new Error("Already downvoted this post");r=await W(s.id("AGORA_DOWNVOTE"),0n)},onSuccess:n,onError:o})}async function wf({toFollow:e,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=window.ethers;let i=t,r=0n;return await M.execute({name:"Follow",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async l=>ge(l),method:"follow",args:()=>[e,K(i)],get value(){return r},validate:async(l,c)=>{if(!e||e==="0x0000000000000000000000000000000000000000")throw new Error("Invalid address");if(await(await me()).isFollowing(c,e))throw new Error("Already following this user");r=await W(s.id("AGORA_FOLLOW"),0n)},onSuccess:n,onError:o})}async function kf({toUnfollow:e,button:t=null,onSuccess:a=null,onError:n=null}){return await M.execute({name:"Unfollow",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async o=>ge(o),method:"unfollow",args:[e],onSuccess:a,onError:n})}async function Ef({userAddress:e,button:t=null,onSuccess:a=null,onError:n=null}){return await M.execute({name:"BlockUser",button:t,skipSimulation:!0,fixedGasLimit:100000n,getContract:async o=>ge(o),method:"blockUser",args:[e],onSuccess:a,onError:n})}async function Tf({userAddress:e,button:t=null,onSuccess:a=null,onError:n=null}){return await M.execute({name:"UnblockUser",button:t,skipSimulation:!0,fixedGasLimit:100000n,getContract:async o=>ge(o),method:"unblockUser",args:[e],onSuccess:a,onError:n})}async function Cf({postId:e,button:t=null,onSuccess:a=null,onError:n=null}){return await M.execute({name:"DeletePost",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async o=>ge(o),method:"deletePost",args:[e],onSuccess:a,onError:n})}async function Bf({postId:e,button:t=null,onSuccess:a=null,onError:n=null}){return await M.execute({name:"PinPost",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async o=>ge(o),method:"pinPost",args:[e],onSuccess:a,onError:n})}async function Af({postId:e,newTag:t,button:a=null,onSuccess:n=null,onError:o=null}){return await M.execute({name:"ChangeTag",button:a,skipSimulation:!0,fixedGasLimit:100000n,getContract:async s=>ge(s),method:"changeTag",args:[e,t],onSuccess:n,onError:o})}async function If({days:e=1,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){let s=t;const i=window.ethers.id("AGORA_PROFILE_BOOST"),l=await W(i)*BigInt(e);return await M.execute({name:"BoostProfile",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async c=>ge(c),method:"boostProfile",args:()=>[K(s)],value:l,onSuccess:n,onError:o})}async function Pf({tier:e=0,operator:t,button:a=null,onSuccess:n=null,onError:o=null}){const s=window.ethers;let i=t;const r=["AGORA_BADGE_VERIFIED","AGORA_BADGE_PREMIUM","AGORA_BADGE_ELITE"],l=s.id(r[e]||r[0]),c=await W(l);return await M.execute({name:"ObtainBadge",button:a,skipSimulation:!0,fixedGasLimit:250000n,getContract:async d=>ge(d),method:"obtainBadge",args:()=>[e,K(i)],value:c,onSuccess:n,onError:o})}async function Nf({postId:e,category:t=0,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){const i=window.ethers;let r=a;const l=i.id("AGORA_REPORT"),c=await W(l);return await M.execute({name:"ReportPost",button:n,skipSimulation:!0,fixedGasLimit:200000n,getContract:async d=>ge(d),method:"reportPost",args:()=>[e,t,K(r)],value:c,validate:async(d,f)=>{if(await(await me()).hasReported(e,f))throw new Error("You already reported this post")},onSuccess:o,onError:s})}async function zf({postId:e,tier:t=0,days:a=1,operator:n,button:o=null,onSuccess:s=null,onError:i=null}){const r=window.ethers;let l=n;const c=t===1?"AGORA_BOOST_FEAT":"AGORA_BOOST_STD",f=await W(r.id(c))*BigInt(a);return await M.execute({name:"BoostPost",button:o,skipSimulation:!0,fixedGasLimit:250000n,getContract:async g=>ge(g),method:"boostPost",args:()=>[e,t,K(l)],value:f,validate:async()=>{if(f<=0n)throw new Error("Boost requires at least 1 day")},onSuccess:s,onError:i})}async function $f(e=0,t=1){const a=window.ethers,n=e===1?"AGORA_BOOST_FEAT":"AGORA_BOOST_STD",o=await W(a.id(n)),s=o*BigInt(t);return{pricePerDay:o,total:s,formatted:a.formatEther(s)}}async function Sf({postId:e,ethAmount:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){let i=a;const r=BigInt(t);return await M.execute({name:"TipPost",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async l=>ge(l),method:"tipPost",args:()=>[e,K(i)],value:r,validate:async()=>{if(r<=0n)throw new Error("Tip requires BNB > 0")},onSuccess:o,onError:s})}async function Lf({actions:e,totalFee:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){let i=a;const r={like:1,follow:2,downvote:3},l=e.map(c=>({actionType:r[c.type],targetId:(c.type==="follow",BigInt(c.targetId))}));return await M.execute({name:"BatchActions",button:n,skipSimulation:!0,fixedGasLimit:300000n+150000n*BigInt(e.length),getContract:async c=>ge(c),method:"batchActions",args:()=>[l,K(i)],value:t,validate:async()=>{if(!e||e.length===0)throw new Error("No actions to submit");if(e.length>50)throw new Error("Max 50 actions per batch")},onSuccess:o,onError:s})}async function _r(e){const t=window.ethers,n=await(await me()).getUsernamePrice(e);return{fee:n,formatted:t.formatEther(n)}}const _f=_r;async function Rr(e){const a=await(await me()).getPost(e);return{author:a.author||a[0],tag:Number(a.tag??a[1]),contentType:Number(a.contentType??a[2]),deleted:a.deleted??a[3],createdAt:Number(a.createdAt??a[4]),editedAt:Number(a.editedAt_??a[5]),replyTo:Number(a.replyTo_??a[6]),repostOf:Number(a.repostOf_??a[7]),likes:Number(a.likes??a[8]),superLikes:Number(a.superLikes??a[9]),superLikeETH:a.superLikeETH??a[10]??0n,downvotes:Number(a.downvotes??a[11]),replies:Number(a.replies??a[12]),reposts:Number(a.reposts??a[13]),reports:Number(a.reports??a[14]),tips:a.tips??a[15]??0n,boostTier:Number(a.boostTier??a[16]),boostExpiry:Number(a.boostExpiry??a[17])}}async function Rf(e){return(await(await me()).getPostsBatch(e)).map((n,o)=>({author:n.author||n[0],tag:Number(n.tag??n[1]),contentType:Number(n.contentType??n[2]),deleted:n.deleted??n[3],createdAt:Number(n.createdAt??n[4]),editedAt:Number(n.editedAt_??n[5]),replyTo:Number(n.replyTo_??n[6]),repostOf:Number(n.repostOf_??n[7]),likes:Number(n.likes??n[8]),superLikes:Number(n.superLikes??n[9]),superLikeETH:n.superLikeETH??n[10]??0n,downvotes:Number(n.downvotes??n[11]),replies:Number(n.replies??n[12]),reposts:Number(n.reposts??n[13]),reports:Number(n.reports??n[14]),tips:n.tips??n[15]??0n,boostTier:Number(n.boostTier??n[16]),boostExpiry:Number(n.boostExpiry??n[17])}))}async function Ff(e){const t=await Rr(e);return{reports:t.reports,illegalReports:0,boostTier:t.boostTier,boostExpiry:t.boostExpiry,isBoosted:t.boostExpiry>Math.floor(Date.now()/1e3),boostSpent:0n,tips:t.tips}}async function Df(){const e=await me();return Number(await e.postCounter())}async function Mf(e){const a=await(await me()).getUserProfile(e);return{usernameHash:a.usernameHash||a[0],metadataURI:a.metadataURI||a[1],pinnedPost:Number(a.pinned??a[2]),boosted:a.boosted??a[3],hasBadge:a.hasBadge??a[4],badgeTier:Number(a._badgeTier??a[5]??0),boostExpiry:Number(a.boostExp??a[6]),badgeExpiry:Number(a.badgeExp??a[7]),followers:Number(a.followers??a[8]??0),following:Number(a.following??a[9]??0)}}async function Of(e){return await(await me()).isUsernameAvailable(e)}async function Uf(e,t){return await(await me()).hasLiked(e,t)}async function Hf(e,t){return await(await me()).hasDownvoted(e,t)}async function jf(e,t){return await(await me()).checkFollowing(e,t)}async function Wf(e,t){return await(await me()).checkBlocked(e,t)}async function Gf(e){return await(await me()).isProfileBoosted(e)}async function Kf(e){return await(await me()).hasTrustBadge(e)}async function Vf(e){const a=await(await me()).getUserProfile(e);return Number(a.boostExp??a[6])}async function Yf(e){const a=await(await me()).getUserProfile(e);return Number(a.badgeExp??a[7])}async function qf(){const t=await(await me()).getGlobalStats();return{totalPosts:Number(t._totalPosts||t[0]),totalProfiles:Number(t._totalProfiles||t[1]),tagCounts:(t._tagCounts||t[2]).map(a=>Number(a))}}async function Xf(e){const a=await(await me()).getOperatorStats(e);return{posts:Number(a.posts_||a[0]),engagement:Number(a.engagement||a[1])}}async function Jf(){return await(await me()).version()}const ee={createProfile:pf,updateProfile:ff,createPost:gf,createReply:mf,createRepost:bf,editPost:xf,deletePost:Cf,pinPost:Bf,changeTag:Af,like:hf,superLike:vf,downvote:yf,follow:wf,unfollow:kf,batchActions:Lf,blockUser:Ef,unblockUser:Tf,reportPost:Nf,boostPost:zf,getBoostCost:$f,tipPost:Sf,boostProfile:If,obtainBadge:Pf,getUsernamePrice:_r,getUsernameFee:_f,getPost:Rr,getPostsBatch:Rf,getPostMeta:Ff,getPostCount:Df,getUserProfile:Mf,isUsernameAvailable:Of,hasUserLiked:Uf,hasUserDownvoted:Hf,checkFollowing:jf,checkBlocked:Wf,isProfileBoosted:Gf,hasTrustBadge:Kf,getBoostExpiry:Vf,getBadgeExpiry:Yf,getGlobalStats:qf,getOperatorStats:Xf,getVersion:Jf},h0=Object.freeze(Object.defineProperty({__proto__:null,BackchatTx:ee,batchActions:Lf,blockUser:Ef,boostPost:zf,boostProfile:If,changeTag:Af,checkBlocked:Wf,checkFollowing:jf,createPost:gf,createProfile:pf,createReply:mf,createRepost:bf,deletePost:Cf,downvote:yf,editPost:xf,follow:wf,getBadgeExpiry:Yf,getBoostCost:$f,getBoostExpiry:Vf,getGlobalStats:qf,getOperatorStats:Xf,getPost:Rr,getPostCount:Df,getPostMeta:Ff,getPostsBatch:Rf,getUserProfile:Mf,getUsernameFee:_f,getUsernamePrice:_r,getVersion:Jf,hasTrustBadge:Kf,hasUserDownvoted:Hf,hasUserLiked:Uf,isProfileBoosted:Gf,isUsernameAvailable:Of,like:hf,obtainBadge:Pf,pinPost:Bf,reportPost:Nf,superLike:vf,tipPost:Sf,unblockUser:Tf,unfollow:kf,updateProfile:ff},Symbol.toStringTag,{value:"Module"}));function Rn(){var e;return(E==null?void 0:E.airdropClaim)||(R==null?void 0:R.airdropClaim)||((e=window.contractAddresses)==null?void 0:e.airdropClaim)||null}function fn(e){const t=Rn();if(!t)throw new Error("AirdropClaim contract not configured");return new window.ethers.Contract(t,nd,e)}async function so(){const{NetworkManager:e}=await U(async()=>{const{NetworkManager:t}=await Promise.resolve().then(()=>q);return{NetworkManager:t}},void 0);return e.getProvider()}async function Zf({amount:e,merkleProof:t,operator:a,button:n=null,onSuccess:o=null,onError:s=null}){if(!Rn())throw new Error("AirdropClaim contract not configured");let r=a;return await M.execute({name:"AirdropClaim",button:n,skipSimulation:!0,fixedGasLimit:350000n,getContract:async l=>fn(l),method:"claim",args:()=>[e,t,K(r)],value:async()=>{const l=await so();return await fn(l).claimFee()},validate:async(l,c)=>{const d=await so(),f=fn(d);if(await f.merkleRoot()===window.ethers.ZeroHash)throw new Error("No active airdrop phase");if(await f.hasClaimed(c))throw new Error("Already claimed in this phase");if(!await f.verifyProof(c,e,t))throw new Error("Invalid proof â€” you may not be eligible for this phase")},onSuccess:async l=>{if(typeof window.showToast=="function"){const c=window.ethers.formatEther(e);window.showToast(`Claimed ${c} BKC! Auto-staked for you.`,"success")}o&&o(l)},onError:l=>{typeof window.showToast=="function"&&window.showToast(l.message||"Claim failed","error"),s&&s(l)}})}async function Qf(e){if(!Rn())return null;try{const a=await so(),n=fn(a),[o,s,i,r,l,c]=await Promise.all([n.getClaimInfo(e),n.merkleRoot(),n.availableBalance(),n.currentPhase(),n.totalClaimed(),n.totalClaimCount()]);return{claimed:o[0],claimFee:o[1],lockDays:Number(o[2]),phase:Number(o[3]),merkleRoot:s,isActive:s!==window.ethers.ZeroHash,availableBalance:i,totalClaimed:l,totalClaimCount:Number(c)}}catch(a){return console.warn("[AirdropClaim] getClaimInfo error:",a.message),null}}async function eg(e,t,a){if(!Rn())return!1;try{const o=await so();return await fn(o).verifyProof(e,t,a)}catch(o){return console.warn("[AirdropClaim] verifyProof error:",o.message),!1}}async function tg(){if(!Rn())return null;try{const t=await so(),a=fn(t),[n,o,s,i,r,l,c,d]=await Promise.all([a.availableBalance(),a.totalClaimed(),a.totalClaimCount(),a.currentPhase(),a.merkleRoot(),a.claimFee(),a.lockDays(),a.claimDeadline()]);return{availableBalance:n,totalClaimed:o,totalClaimCount:Number(s),currentPhase:Number(i),isActive:r!==window.ethers.ZeroHash,claimFee:l,lockDays:Number(c),claimDeadline:Number(d)}}catch(t){return console.warn("[AirdropClaim] getAirdropStats error:",t.message),null}}async function ag(e,t){if(!e||!t)return null;const a=e.toLowerCase();try{const n=await U(()=>Promise.resolve().then(()=>Tb),void 0);if(typeof n.getAirdropProof=="function"){const o=await n.getAirdropProof(a,t);if(o&&o.amount&&o.proof)return{amount:BigInt(o.amount),proof:o.proof}}}catch(n){console.warn("[AirdropClaim] Firebase proof fetch failed:",n.message)}try{const n=await fetch(`/airdrop-proofs/${t}.json`);if(n.ok){const o=await n.json(),s=o[a]||o[e];if(s&&s.amount&&s.proof)return{amount:BigInt(s.amount),proof:s.proof}}}catch(n){console.warn("[AirdropClaim] Static proof fetch failed:",n.message)}return null}const Xn={claimAirdrop:Zf,getClaimInfo:Qf,verifyProof:eg,getAirdropStats:tg,getMerkleProof:ag,getAirdropClaimAddress:Rn},v0=Object.freeze(Object.defineProperty({__proto__:null,AirdropClaimTx:Xn,claimAirdrop:Zf,getAirdropStats:tg,getClaimInfo:Qf,getMerkleProof:ag,verifyProof:eg},Symbol.toStringTag,{value:"Module"}));(async()=>(await U(async()=>{const{CharityTx:e}=await Promise.resolve().then(()=>Qb);return{CharityTx:e}},void 0)).CharityTx)(),(async()=>(await U(async()=>{const{StakingTx:e}=await Promise.resolve().then(()=>e0);return{StakingTx:e}},void 0)).StakingTx)(),(async()=>(await U(async()=>{const{NftTx:e}=await Promise.resolve().then(()=>n0);return{NftTx:e}},void 0)).NftTx)(),(async()=>(await U(async()=>{const{FortuneTx:e}=await Promise.resolve().then(()=>r0);return{FortuneTx:e}},void 0)).FortuneTx)(),(async()=>(await U(async()=>{const{RentalTx:e}=await Promise.resolve().then(()=>d0);return{RentalTx:e}},void 0)).RentalTx)(),(async()=>(await U(async()=>{const{NotaryTx:e}=await Promise.resolve().then(()=>m0);return{NotaryTx:e}},void 0)).NotaryTx)(),(async()=>(await U(async()=>{const{FaucetTx:e}=await Promise.resolve().then(()=>jb);return{FaucetTx:e}},void 0)).FaucetTx)(),(async()=>(await U(async()=>{const{FusionTx:e}=await Promise.resolve().then(()=>b0);return{FusionTx:e}},void 0)).FusionTx)(),(async()=>(await U(async()=>{const{BuybackTx:e}=await Promise.resolve().then(()=>x0);return{BuybackTx:e}},void 0)).BuybackTx)(),(async()=>(await U(async()=>{const{BackchatTx:e}=await Promise.resolve().then(()=>h0);return{BackchatTx:e}},void 0)).BackchatTx)(),(async()=>(await U(async()=>{const{AirdropClaimTx:e}=await Promise.resolve().then(()=>v0);return{AirdropClaimTx:e}},void 0)).AirdropClaimTx)();const di=window.ethers,y0=["function currentPrice() external view returns (uint256)","function ethReserve() view returns (uint256)","function bkcReserve() view returns (uint256)"],w0="https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd",k0=6e4;let Bt={bkcEth:0,ethUsd:0,bkcUsd:0,timestamp:0};async function E0(){var e;try{const t=await fetch(w0);if(!t.ok)return Bt.ethUsd||0;const a=await t.json();return((e=a==null?void 0:a.ethereum)==null?void 0:e.usd)||0}catch(t){return console.warn("[PriceService] CoinGecko fetch failed:",t.message),Bt.ethUsd||0}}async function T0(e){try{const t=E==null?void 0:E.liquidityPool;if(!t)return console.warn("[PriceService] LiquidityPool address not loaded"),Bt.bkcEth||0;const a=new di.Contract(t,y0,e),[n,o,s]=await Promise.all([a.currentPrice(),a.ethReserve(),a.bkcReserve()]);if(n===0n||o===0n)return 0;const i=Number(di.formatEther(o)),r=Number(di.formatEther(s));return r===0?0:i/r}catch(t){return console.warn("[PriceService] Pool price fetch failed:",t.message),Bt.bkcEth||0}}async function Fr(e){if(!e)return Bt;const t=Date.now();if(t-Bt.timestamp<k0&&Bt.bkcUsd>0)return Bt;const[a,n]=await Promise.all([T0(e),E0()]),o=a*n;return Bt={bkcEth:a,ethUsd:n,bkcUsd:o,timestamp:t},Bt}function Ds(e){return!e||e===0?"$0.00":e>=1?`$${e.toFixed(2)}`:e>=.01?`$${e.toFixed(4)}`:`$${e.toFixed(8).replace(/0+$/,"")}`}const zt=window.ethers,O={hasRenderedOnce:!1,lastUpdate:0,activities:[],networkActivities:[],filteredActivities:[],userProfile:null,pagination:{currentPage:1,itemsPerPage:8},filters:{type:"ALL",sort:"NEWEST"},metricsCache:{},economicData:null,isLoadingNetworkActivity:!1,networkActivitiesTimestamp:0,faucet:{canClaim:!0,cooldownEnd:null,isLoading:!1,lastCheck:0}},ql="https://sepolia.etherscan.io/tx/",C0="/api/faucet",B0="https://getrecentactivity-4wvdcuoouq-uc.a.run.app",A0="https://getsystemdata-4wvdcuoouq-uc.a.run.app",Dr="0.01",D={STAKING:{icon:"fa-lock",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”’ Staked",emoji:"ðŸ”’"},UNSTAKING:{icon:"fa-unlock",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ”“ Unstaked",emoji:"ðŸ”“"},FORCE_UNSTAKE:{icon:"fa-bolt",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"âš¡ Force Unstaked",emoji:"âš¡"},CLAIM:{icon:"fa-coins",color:"#fbbf24",bg:"rgba(245,158,11,0.15)",label:"ðŸª™ Rewards Claimed",emoji:"ðŸª™"},NFT_BUY:{icon:"fa-cart-plus",color:"#22c55e",bg:"rgba(34,197,94,0.12)",label:"ðŸ›ï¸ Bought NFT",emoji:"ðŸ›ï¸"},NFT_SELL:{icon:"fa-money-bill-transfer",color:"#f59e0b",bg:"rgba(245,158,11,0.12)",label:"ðŸ’° Sold NFT",emoji:"ðŸ’°"},NFT_MINT:{icon:"fa-gem",color:"#fde047",bg:"rgba(234,179,8,0.15)",label:"ðŸ’Ž Minted Booster",emoji:"ðŸ’Ž"},NFT_TRANSFER:{icon:"fa-arrow-right-arrow-left",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"â†”ï¸ Transfer",emoji:"â†”ï¸"},RENTAL_LIST:{icon:"fa-tag",color:"#14b8a6",bg:"rgba(20,184,166,0.12)",label:"ðŸ·ï¸ Listed NFT",emoji:"ðŸ·ï¸"},RENTAL_RENT:{icon:"fa-handshake",color:"#3b82f6",bg:"rgba(59,130,246,0.12)",label:"ðŸ¤ Rented NFT",emoji:"ðŸ¤"},RENTAL_WITHDRAW:{icon:"fa-rotate-left",color:"#6b7280",bg:"rgba(107,114,128,0.12)",label:"â†©ï¸ Withdrawn",emoji:"â†©ï¸"},RENTAL_PROMOTE:{icon:"fa-bullhorn",color:"#fbbf24",bg:"rgba(251,191,36,0.2)",label:"ðŸ“¢ Promoted NFT",emoji:"ðŸ“¢"},FORTUNE_COMMIT:{icon:"fa-lock",color:"#a855f7",bg:"rgba(168,85,247,0.2)",label:"ðŸ” Game Committed",emoji:"ðŸ”"},FORTUNE_REVEAL:{icon:"fa-dice",color:"#f97316",bg:"rgba(249,115,22,0.2)",label:"ðŸŽ² Game Revealed",emoji:"ðŸŽ²"},FORTUNE_BET:{icon:"fa-paw",color:"#f97316",bg:"rgba(249,115,22,0.2)",label:"ðŸ¯ Fortune Bet",emoji:"ðŸ¯"},FORTUNE_COMBO:{icon:"fa-rocket",color:"#a855f7",bg:"rgba(168,85,247,0.2)",label:"ðŸš€ Combo Mode",emoji:"ðŸš€"},FORTUNE_WIN:{icon:"fa-trophy",color:"#facc15",bg:"rgba(234,179,8,0.25)",label:"ðŸ† Winner!",emoji:"ðŸ†"},NOTARY:{icon:"fa-stamp",color:"#818cf8",bg:"rgba(99,102,241,0.15)",label:"ðŸ“œ Notarized",emoji:"ðŸ“œ"},BACKCHAT_POST:{icon:"fa-comment",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ’¬ Posted",emoji:"ðŸ’¬"},BACKCHAT_LIKE:{icon:"fa-heart",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"â¤ï¸ Liked",emoji:"â¤ï¸"},BACKCHAT_REPLY:{icon:"fa-reply",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"â†©ï¸ Replied",emoji:"â†©ï¸"},BACKCHAT_SUPERLIKE:{icon:"fa-star",color:"#fbbf24",bg:"rgba(251,191,36,0.2)",label:"â­ Super Liked",emoji:"â­"},BACKCHAT_REPOST:{icon:"fa-retweet",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”„ Reposted",emoji:"ðŸ”„"},BACKCHAT_FOLLOW:{icon:"fa-user-plus",color:"#a78bfa",bg:"rgba(167,139,250,0.15)",label:"ðŸ‘¥ Followed",emoji:"ðŸ‘¥"},BACKCHAT_PROFILE:{icon:"fa-user",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"ðŸ‘¤ Profile Created",emoji:"ðŸ‘¤"},BACKCHAT_BOOST:{icon:"fa-rocket",color:"#f97316",bg:"rgba(249,115,22,0.15)",label:"ðŸš€ Profile Boosted",emoji:"ðŸš€"},BACKCHAT_BADGE:{icon:"fa-circle-check",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"âœ… Badge Activated",emoji:"âœ…"},BACKCHAT_TIP:{icon:"fa-coins",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"ðŸ’° Tipped BKC",emoji:"ðŸ’°"},BACKCHAT_WITHDRAW:{icon:"fa-wallet",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ’¸ ETH Withdrawn",emoji:"ðŸ’¸"},CHARITY_DONATE:{icon:"fa-heart",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"ðŸ’ Donated",emoji:"ðŸ’"},CHARITY_CREATE:{icon:"fa-hand-holding-heart",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"ðŸŒ± Campaign Created",emoji:"ðŸŒ±"},CHARITY_CANCEL:{icon:"fa-heart-crack",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ’” Campaign Cancelled",emoji:"ðŸ’”"},CHARITY_WITHDRAW:{icon:"fa-hand-holding-dollar",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ’° Funds Withdrawn",emoji:"ðŸ’°"},CHARITY_GOAL_REACHED:{icon:"fa-trophy",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"ðŸ† Goal Reached!",emoji:"ðŸ†"},FAUCET:{icon:"fa-droplet",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ’§ Faucet Claim",emoji:"ðŸ’§"},FEE_COLLECTED:{icon:"fa-receipt",color:"#f59e0b",bg:"rgba(245,158,11,0.15)",label:"ðŸ§¾ Fee Collected",emoji:"ðŸ§¾"},TUTOR_SET:{icon:"fa-graduation-cap",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸŽ“ Tutor Set",emoji:"ðŸŽ“"},TUTOR_CHANGED:{icon:"fa-arrows-rotate",color:"#a78bfa",bg:"rgba(167,139,250,0.15)",label:"ðŸ”„ Tutor Changed",emoji:"ðŸ”„"},TUTOR_EARNED:{icon:"fa-hand-holding-dollar",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"ðŸ’° Tutor Earned",emoji:"ðŸ’°"},REWARD_RECYCLED:{icon:"fa-recycle",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"â™»ï¸ Rewards Recycled",emoji:"â™»ï¸"},NFT_FUSION:{icon:"fa-fire",color:"#f97316",bg:"rgba(249,115,22,0.12)",label:"ðŸ”¥ NFT Fused",emoji:"ðŸ”¥"},NFT_SPLIT:{icon:"fa-scissors",color:"#a78bfa",bg:"rgba(167,139,250,0.12)",label:"âœ‚ï¸ NFT Split",emoji:"âœ‚ï¸"},GOVERNANCE_VOTE:{icon:"fa-check-to-slot",color:"#a78bfa",bg:"rgba(167,139,250,0.15)",label:"ðŸ—³ï¸ Voted",emoji:"ðŸ—³ï¸"},GOVERNANCE_PROPOSE:{icon:"fa-scroll",color:"#818cf8",bg:"rgba(99,102,241,0.15)",label:"ðŸ“œ Proposal Created",emoji:"ðŸ“œ"},BUYBACK:{icon:"fa-hammer",color:"#f97316",bg:"rgba(249,115,22,0.15)",label:"â›ï¸ Buyback",emoji:"â›ï¸"},SWAP:{icon:"fa-arrow-right-arrow-left",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ”„ Swap",emoji:"ðŸ”„"},LIQUIDITY_ADD:{icon:"fa-droplet",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ’§ Liquidity Added",emoji:"ðŸ’§"},LIQUIDITY_REMOVE:{icon:"fa-droplet-slash",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ’§ Liquidity Removed",emoji:"ðŸ’§"},RENTAL_EARNINGS:{icon:"fa-coins",color:"#eab308",bg:"rgba(234,179,8,0.12)",label:"ðŸ’° Earnings Withdrawn",emoji:"ðŸ’°"},FORTUNE_EXPIRED:{icon:"fa-hourglass-end",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"â° Game Expired",emoji:"â°"},CHARITY_BOOST:{icon:"fa-rocket",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"ðŸš€ Campaign Boosted",emoji:"ðŸš€"},CHARITY_CLOSED:{icon:"fa-lock",color:"#71717a",bg:"rgba(39,39,42,0.5)",label:"ðŸ”’ Campaign Closed",emoji:"ðŸ”’"},AGORA_DOWNVOTE:{icon:"fa-thumbs-down",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ‘Ž Downvoted",emoji:"ðŸ‘Ž"},AGORA_UNFOLLOW:{icon:"fa-user-minus",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ‘¤ Unfollowed",emoji:"ðŸ‘¤"},NFT_BULK_FUSED:{icon:"fa-fire-flame-curved",color:"#f97316",bg:"rgba(249,115,22,0.15)",label:"ðŸ”¥ Bulk Fused",emoji:"ðŸ”¥"},COMPOUND_REWARDS:{icon:"fa-arrows-spin",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”„ Rewards Compounded",emoji:"ðŸ”„"},BUYBACK_PAUSED:{icon:"fa-pause",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"â¸ï¸ Buyback Paused",emoji:"â¸ï¸"},BUYBACK_UNPAUSED:{icon:"fa-play",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"â–¶ï¸ Buyback Resumed",emoji:"â–¶ï¸"},DEFAULT:{icon:"fa-circle",color:"#71717a",bg:"rgba(39,39,42,0.5)",label:"Activity",emoji:"ðŸ“‹"}};function I0(e){if(!e)return"Just now";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3,a=new Date(t*1e3),o=new Date-a,s=Math.floor(o/6e4),i=Math.floor(o/36e5),r=Math.floor(o/864e5);return s<1?"Just now":s<60?`${s}m ago`:i<24?`${i}h ago`:r<7?`${r}d ago`:a.toLocaleDateString()}catch{return"Recent"}}function P0(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function $o(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toFixed(0)}function ng(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function N0(e,t={}){const a=(e||"").toUpperCase().trim();return a==="STAKING"||a==="STAKED"||a==="STAKE"||a==="DELEGATED"||a==="DELEGATION"||a.includes("DELEGAT")?D.STAKING:a==="UNSTAKING"||a==="UNSTAKED"||a==="UNSTAKE"||a==="UNDELEGATED"?D.UNSTAKING:a==="FORCE_UNSTAKE"||a==="FORCEUNSTAKE"||a==="FORCE_UNSTAKED"?D.FORCE_UNSTAKE:a==="CLAIM"||a==="CLAIMED"||a==="REWARD"||a==="REWARDS"||a==="REWARD_CLAIMED"||a==="REWARDCLAIMED"||a==="CLAIMREWARD"||a==="CLAIM_REWARD"?D.CLAIM:a==="NFT_BUY"||a==="NFTBUY"||a==="NFTBOUGHT"||a==="BOOSTER_BUY"||a==="BOOSTERBUY"||a==="BOOSTERBOUGHT"||a.includes("BUY")&&(a.includes("NFT")||a.includes("BOOSTER"))||a.includes("BOUGHT")&&a.includes("NFT")?D.NFT_BUY:a==="NFT_SELL"||a==="NFTSELL"||a==="NFTSOLD"||a==="BOOSTER_SELL"||a==="BOOSTERSELL"||a==="BOOSTERSOLD"||a.includes("SELL")&&(a.includes("NFT")||a.includes("BOOSTER"))||a.includes("SOLD")&&a.includes("NFT")?D.NFT_SELL:a==="NFT_MINT"||a==="NFTMINT"||a==="BOOSTER_MINT"||a==="BOOSTERMINT"||a==="MINTED"||a==="BOOSTERMINTED"?D.NFT_MINT:a==="NFT_TRANSFER"||a==="NFTTRANSFER"||a==="BOOSTER_TRANSFER"||a==="BOOSTERTRANSFER"||a==="TRANSFER"?D.NFT_TRANSFER:a==="RENTAL_LIST"||a==="RENTALLISTED"||a==="RENTAL_LISTED"||a==="LISTED"||a.includes("LIST")&&a.includes("RENTAL")?D.RENTAL_LIST:a==="RENTAL_RENT"||a==="RENTALRENTED"||a==="RENTAL_RENTED"||a==="RENTED"||a.includes("RENT")&&!a.includes("LIST")?D.RENTAL_RENT:a==="RENTAL_WITHDRAW"||a==="RENTALWITHDRAWN"||a==="RENTAL_WITHDRAWN"?D.RENTAL_WITHDRAW:a==="RENTAL_PROMOTE"||a==="RENTALPROMOTED"||a==="RENTAL_PROMOTED"||a.includes("PROMOT")||a.includes("ADS")||a.includes("ADVERTIS")?D.RENTAL_PROMOTE:a==="FORTUNE_COMMIT"||a==="FORTUNECOMMIT"||a==="GAMECOMMITTED"||a==="GAME_COMMITTED"||a==="COMMITTED"?D.FORTUNE_COMMIT:a==="FORTUNE_REVEAL"||a==="FORTUNEREVEAL"||a==="GAMEREVEALED"||a==="GAME_REVEALED"||a==="REVEALED"?D.FORTUNE_REVEAL:a==="FORTUNE_EXPIRED"||a==="FORTUNEEXPIRED"||a==="GAMEEXPIRED"||a==="GAME_EXPIRED"||a==="EXPIRED"?D.FORTUNE_EXPIRED:a.includes("GAME")||a.includes("FORTUNE")||a.includes("REQUEST")||a.includes("FULFILLED")||a.includes("RESULT")?(t==null?void 0:t.isWin)||(t==null?void 0:t.prizeWon)&&BigInt(t.prizeWon||0)>0n?D.FORTUNE_WIN:(t==null?void 0:t.isCumulative)?D.FORTUNE_COMBO:D.FORTUNE_BET:a==="POSTCREATED"||a==="POST_CREATED"||a==="POSTED"||a==="BACKCHAT_POST"||a.includes("POST")&&!a.includes("REPOST")?D.BACKCHAT_POST:a==="SUPERLIKED"||a==="SUPER_LIKED"||a.includes("SUPERLIKE")?D.BACKCHAT_SUPERLIKE:a==="LIKED"||a==="POSTLIKED"||a==="POST_LIKED"||a.includes("LIKE")&&!a.includes("SUPER")?D.BACKCHAT_LIKE:a==="REPLYCREATED"||a==="REPLY_CREATED"||a.includes("REPLY")?D.BACKCHAT_REPLY:a==="REPOSTCREATED"||a==="REPOST_CREATED"||a.includes("REPOST")?D.BACKCHAT_REPOST:a==="AGORAUNFOLLOWED"||a==="UNFOLLOWED"||a.includes("UNFOLLOW")?D.AGORA_UNFOLLOW:a==="AGORADOWNVOTED"||a==="DOWNVOTED"||a.includes("DOWNVOT")?D.AGORA_DOWNVOTE:a==="FOLLOWED"||a==="USER_FOLLOWED"||a==="AGORAFOLLOWED"||a.includes("FOLLOW")?D.BACKCHAT_FOLLOW:a==="PROFILECREATED"||a==="PROFILE_CREATED"||a.includes("PROFILE")&&a.includes("CREAT")?D.BACKCHAT_PROFILE:a==="CHARITYCAMPAIGNBOOSTED"||a==="CAMPAIGN_BOOSTED"?D.CHARITY_BOOST:a==="PROFILEBOOSTED"||a==="PROFILE_BOOSTED"||a==="AGORAPROFILEBOOSTED"||a==="BOOSTED"||a.includes("BOOST")&&!a.includes("NFT")&&!a.includes("CAMPAIGN")&&!a.includes("CHARITY")?D.BACKCHAT_BOOST:a==="BADGEACTIVATED"||a==="BADGE_ACTIVATED"||a.includes("BADGE")?D.BACKCHAT_BADGE:a==="TIPPROCESSED"||a==="TIP_PROCESSED"||a==="TIPPED"||a.includes("TIP")?D.BACKCHAT_TIP:a==="ETHWITHDRAWN"||a==="ETH_WITHDRAWN"||a==="BACKCHAT_WITHDRAW"?D.BACKCHAT_WITHDRAW:a==="CHARITYDONATION"||a==="DONATIONMADE"||a==="CHARITY_DONATE"||a==="DONATED"||a==="DONATION"||a.includes("DONATION")?D.CHARITY_DONATE:a==="CHARITYCAMPAIGNCREATED"||a==="CAMPAIGNCREATED"||a==="CHARITY_CREATE"||a==="CAMPAIGN_CREATED"||a.includes("CAMPAIGNCREATED")?D.CHARITY_CREATE:a==="CHARITYCAMPAIGNCANCELLED"||a==="CAMPAIGNCANCELLED"||a==="CHARITY_CANCEL"||a==="CAMPAIGN_CANCELLED"||a.includes("CANCELLED")?D.CHARITY_CANCEL:a==="CHARITYCAMPAIGNCLOSED"||a==="CAMPAIGNCLOSED"||a==="CHARITY_CLOSED"||a==="CAMPAIGN_CLOSED"?D.CHARITY_CLOSED:a==="RENTALEARNINGSWITHDRAWN"||a==="RENTAL_EARNINGS_WITHDRAWN"?D.RENTAL_EARNINGS:a==="CHARITYFUNDSWITHDRAWN"||a==="FUNDSWITHDRAWN"||a==="CHARITY_WITHDRAW"||a==="CAMPAIGN_WITHDRAW"||a.includes("WITHDRAWN")?D.CHARITY_WITHDRAW:a==="CHARITYGOALREACHED"||a==="GOALREACHED"||a==="CHARITY_GOAL"||a==="CAMPAIGN_COMPLETED"?D.CHARITY_GOAL_REACHED:a==="NOTARYREGISTER"||a==="NOTARIZED"||a.includes("NOTARY")||a.includes("DOCUMENT")?D.NOTARY:a==="FAUCETCLAIM"||a.includes("FAUCET")||a.includes("DISTRIBUTED")?D.FAUCET:a==="FEECOLLECTED"||a==="FEE_COLLECTED"?D.FEE_COLLECTED:a==="TUTORSET"||a==="TUTOR_SET"||a==="REFERRERSET"||a==="REFERRER_SET"?D.TUTOR_SET:a==="TUTORCHANGED"||a==="TUTOR_CHANGED"?D.TUTOR_CHANGED:a==="TUTOREARNED"||a==="TUTOR_EARNED"||a==="TUTOR_BONUS"?D.TUTOR_EARNED:a==="REWARDRECYCLED"||a==="REWARD_RECYCLED"||a==="RECYCLED"?D.REWARD_RECYCLED:a==="NFTBULKFUSED"||a==="NFT_BULK_FUSED"||a==="BULKFUSED"||a==="BULK_FUSED"?D.NFT_BULK_FUSED:a==="NFTFUSION"||a==="NFT_FUSION"||a==="FUSED"||a==="FUSION"?D.NFT_FUSION:a==="NFTSPLIT"||a==="NFT_SPLIT"||a==="SPLIT"?D.NFT_SPLIT:a==="COMPOUNDREWARDS"||a==="COMPOUND_REWARDS"||a==="REWARDSCOMPOUNDED"||a==="REWARDS_COMPOUNDED"?D.COMPOUND_REWARDS:a==="GOVERNANCEVOTE"||a==="GOVERNANCE_VOTE"||a==="VOTED"?D.GOVERNANCE_VOTE:a==="GOVERNANCEPROPOSE"||a==="GOVERNANCE_PROPOSE"||a==="PROPOSAL_CREATED"?D.GOVERNANCE_PROPOSE:a==="BUYBACKPAUSED"||a==="BUYBACK_PAUSED"?D.BUYBACK_PAUSED:a==="BUYBACKUNPAUSED"||a==="BUYBACK_UNPAUSED"?D.BUYBACK_UNPAUSED:a==="BUYBACKEXECUTED"||a==="BUYBACK_EXECUTED"||a.includes("BUYBACK")?D.BUYBACK:a==="SWAPETHFORBKC"||a==="SWAPBKCFORETH"||a.includes("SWAP")?D.SWAP:a==="LIQUIDITYADDED"||a==="LIQUIDITY_ADDED"?D.LIQUIDITY_ADD:a==="LIQUIDITYREMOVED"||a==="LIQUIDITY_REMOVED"?D.LIQUIDITY_REMOVE:D.DEFAULT}let ui=null,ba=0n;function og(e){const t=document.getElementById("dash-user-rewards");if(!t||!u.isConnected){ui&&cancelAnimationFrame(ui);return}const a=e-ba;a>-1000000000n&&a<1000000000n?ba=e:ba+=a/8n,ba<0n&&(ba=0n),t.innerHTML=`${j(ba).toFixed(4)} <span class="dash-reward-suffix">BKC</span>`,ba!==e&&(ui=requestAnimationFrame(()=>og(e)))}async function Xl(e){if(!u.isConnected||!u.userAddress)return x("Conecte a wallet primeiro","error");const t=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Enviando...',O.faucet.isLoading=!0;let a=!1;try{console.log("[Faucet] Tentando API relayer...");const n=await fetch(`${C0}?address=${u.userAddress}`,{method:"GET",headers:{Accept:"application/json"}}),o=await n.json();if(console.log("[Faucet] API response:",n.status,o),n.ok&&o.success){a=!0;const s=o.ethAmount||Dr;x(`Faucet: ${s} ETH sent to your wallet!`,"success"),O.faucet.canClaim=!1;try{localStorage.setItem("bkc_faucet_"+u.userAddress.toLowerCase(),"1")}catch{}Jo(),console.log("[Faucet] Claim success, txHash:",o.txHash,"â€” refreshing balance in 3s..."),setTimeout(async()=>{var i;try{await Pn(!0),console.log("[Faucet] Post-claim balance:",(i=u.currentUserBalance)==null?void 0:i.toString()),Mr(),window.updateUIState&&window.updateUIState(!1)}catch(r){console.warn("[Faucet] Post-claim refresh error:",r.message)}},3e3)}else{const s=o.error||o.message||"Faucet unavailable";if(console.warn("[Faucet] API error:",s),a=!0,o.alreadyClaimed||s.toLowerCase().includes("already claimed")||s.toLowerCase().includes("one-time")){x("You already claimed your one-time faucet tokens.","warning"),O.faucet.canClaim=!1;try{localStorage.setItem("bkc_faucet_"+u.userAddress.toLowerCase(),"1")}catch{}Jo()}else x(s,"error")}}catch(n){console.warn("[Faucet] API offline:",n.message)}a||x("Faucet temporarily unavailable. Try again later.","error"),O.faucet.isLoading=!1,e.disabled=!1,e.innerHTML=t}function Jo(){const e=document.getElementById("dashboard-faucet-widget");if(!e)return;const t=document.getElementById("faucet-title"),a=document.getElementById("faucet-desc"),n=document.getElementById("faucet-status"),o=document.getElementById("faucet-action-btn");if(!u.isConnected){e.style.opacity="0.5",t&&(t.innerText="Get Free Testnet Tokens"),a&&(a.innerText="Connect your wallet to claim ETH for gas"),n&&n.classList.add("hidden"),o&&(o.className="dash-btn-secondary",o.innerHTML='<i class="fa-solid fa-wallet"></i> Connect Wallet',o.disabled=!0);return}e.style.opacity="1",O.faucet.canClaim?(t&&(t.innerText="Get Free Testnet Tokens"),a&&(a.innerText="Claim ETH for gas â€” one-time per wallet"),n&&n.classList.add("hidden"),o&&(o.className="dash-btn-primary dash-btn-cyan",o.innerHTML='<i class="fa-solid fa-faucet"></i> Claim Free Tokens',o.disabled=!1)):(t&&(t.innerText="Testnet Tokens Received"),a&&(a.innerText=`Already received ${Dr} ETH for testing on this wallet`),n&&(n.classList.remove("hidden"),n.innerHTML='<i class="fa-solid fa-circle-check" style="margin-right:4px;color:#4ade80"></i>One-time claim used'),o&&(o.className="dash-btn-secondary",o.innerHTML='<i class="fa-solid fa-check"></i> Already Claimed',o.disabled=!0))}function z0(){try{const e=window.location.hash||"",t=e.indexOf("?");if(t===-1)return;const n=new URLSearchParams(e.substring(t)).get("ref");if(n&&zt.isAddress(n)){const o=localStorage.getItem("backchain_tutor");(!o||o.toLowerCase()!==n.toLowerCase())&&(localStorage.setItem("backchain_tutor",n),console.log("[Tutor] Saved tutor from URL:",n))}}catch{}}async function $0(){if(!u.isConnected||!u.userAddress)return{count:0,tutor:null,pendingEth:0n};try{const e=E==null?void 0:E.backchainEcosystem;if(!e)return{count:0,tutor:null,pendingEth:0n};const{ecosystemManagerABI:t}=await U(async()=>{const{ecosystemManagerABI:l}=await Promise.resolve().then(()=>ld);return{ecosystemManagerABI:l}},void 0),{NetworkManager:a}=await U(async()=>{const{NetworkManager:l}=await Promise.resolve().then(()=>q);return{NetworkManager:l}},void 0),n=a.getProvider(),o=new zt.Contract(e,t,n),[s,i,r]=await Promise.all([o.tutorCount(u.userAddress),o.tutorOf(u.userAddress),o.pendingEth(u.userAddress)]);return{count:Number(s),tutor:i!=="0x0000000000000000000000000000000000000000"?i:null,pendingEth:r}}catch(e){return console.warn("[Tutor] Load failed:",e.message),{count:0,tutor:null,pendingEth:0n}}}async function So(){const e=document.getElementById("dashboard-referral-widget");if(!e)return;const t=document.getElementById("referral-title"),a=document.getElementById("referral-desc"),n=document.getElementById("referral-stats"),o=document.getElementById("referral-link-container"),s=document.getElementById("referral-link-text"),i=document.getElementById("referral-share-btn"),r=document.getElementById("referral-count");if(!u.isConnected||!u.userAddress){e.style.opacity="0.5",t&&(t.innerText="Become a Tutor"),a&&(a.innerText="Connect your wallet to get your tutor link"),n&&(n.style.display="none"),o&&(o.style.display="none"),i&&(i.style.display="none");return}e.style.opacity="1";const l=`${window.location.origin}/#dashboard?ref=${u.userAddress}`;s&&(s.textContent=l),o&&(o.style.display="flex"),i&&(i.style.display="");const c=await $0();r&&(r.textContent=c.count),n&&(n.style.display="flex");const d=document.getElementById("tutor-info-area");if(c.tutor?d&&(d.style.display="flex",d.innerHTML=`
                <span class="dash-referral-stat" style="color:#22d3ee">
                    <i class="fa-solid fa-graduation-cap" style="font-size:10px"></i>
                    Tutor: ${ng(c.tutor)}
                </span>
                <a href="#referral" class="dash-referral-stat" style="color:#f59e0b;cursor:pointer;text-decoration:none" title="Change your tutor">
                    <i class="fa-solid fa-pen" style="font-size:9px"></i>
                    Change
                </a>
            `):d&&(d.style.display="flex",d.innerHTML=`
            <span class="dash-referral-stat" style="color:var(--dash-text-3)">
                <i class="fa-solid fa-graduation-cap" style="font-size:10px"></i>
                No tutor yet
            </span>
        `),c.count>0)if(t&&(t.innerText=`${c.count} Student${c.count>1?"s":""} Earning for You`),c.pendingEth>0n){const f=Number(zt.formatEther(c.pendingEth)).toFixed(6);a&&(a.innerHTML=`Tutor earnings: <strong style="color:#f59e0b">${f} ETH</strong> available â€” <a href="#referral" style="color:#22d3ee;text-decoration:underline">withdraw</a>`)}else a&&(a.innerText="You earn 10% ETH on all fees + 5% BKC on staking rewards. Keep sharing!");else t&&(t.innerText="Be Someone's Tutor"),a&&(a.innerText="Share your link. Earn 10% of all fees + 5% BKC from your students â€” forever.")}function S0(){if(!u.userAddress)return;const e=`${window.location.origin}/#dashboard?ref=${u.userAddress}`;navigator.clipboard.writeText(e).then(()=>{x("Tutor link copied!","success");const t=document.getElementById("referral-copy-btn");t&&(t.innerHTML='<i class="fa-solid fa-check"></i>',setTimeout(()=>{t.innerHTML='<i class="fa-solid fa-copy"></i>'},2e3))}).catch(()=>x("Failed to copy","error"))}function L0(){if(!u.userAddress)return;const e=`${window.location.origin}/#dashboard?ref=${u.userAddress}`,t=`Join Backchain and earn crypto!

Stake BKC and earn daily rewards
Be a tutor â€” earn 10% ETH + 5% BKC FOREVER

${e}

#Backchain #DeFi #opBNB #BNBChain #Web3`;navigator.share?navigator.share({title:"Backchain â€” Become a Tutor",text:t,url:e}).catch(()=>{}):navigator.clipboard.writeText(t).then(()=>x("Share text copied!","success")).catch(()=>{})}async function _0(){try{if(await u.provider.getBalance(u.userAddress)<zt.parseEther("0.002")){const t=document.getElementById("no-gas-modal-dash");return t&&(t.classList.remove("hidden"),t.classList.add("flex")),!1}return!0}catch{return!0}}function R0(){if(document.getElementById("dash-styles-v69"))return;const e=document.createElement("style");e.id="dash-styles-v69",e.textContent=`
        /* â”€â”€ CSS Variables â”€â”€ */
        .dash-shell {
            --dash-bg: #0c0c0e;
            --dash-surface: #141417;
            --dash-surface-2: #1c1c21;
            --dash-surface-3: #222228;
            --dash-border: rgba(255,255,255,0.06);
            --dash-border-h: rgba(255,255,255,0.12);
            --dash-text: #f0f0f2;
            --dash-text-2: #a0a0ab;
            --dash-text-3: #5c5c68;
            --dash-accent: #f59e0b;
            --dash-green: #4ade80;
            --dash-purple: #a78bfa;
            --dash-cyan: #22d3ee;
            --dash-radius: 16px;
            --dash-radius-sm: 10px;
            --dash-tr: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* â”€â”€ Animations â”€â”€ */
        @keyframes dash-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes dash-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes dash-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes dash-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
        @keyframes dash-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes dash-pulse-ring { 0% { transform: scale(0.9); opacity: 0.6; } 100% { transform: scale(1.4); opacity: 0; } }

        /* â”€â”€ Shell â”€â”€ */
        .dash-shell { max-width: 1200px; margin: 0 auto; padding: 0 16px 40px; animation: dash-fadeIn 0.4s ease-out; }

        /* â”€â”€ Hero Section â”€â”€ */
        .dash-hero {
            position: relative;
            background: linear-gradient(135deg, rgba(20,20,23,0.95), rgba(12,12,14,0.98));
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius);
            padding: 28px 24px;
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out;
        }
        .dash-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(245,158,11,0.06) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 4s ease-in-out infinite;
        }
        .dash-hero-inner { display: flex; gap: 24px; position: relative; z-index: 1; }
        .dash-hero-left { flex: 1.2; min-width: 0; }
        .dash-hero-right { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
        .dash-hero-label { font-size: 11px; color: var(--dash-text-3); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 4px; }
        .dash-reward-value {
            font-size: clamp(28px, 5vw, 40px);
            font-weight: 800;
            color: var(--dash-green);
            font-variant-numeric: tabular-nums;
            line-height: 1.1;
            text-shadow: 0 0 30px rgba(74,222,128,0.2);
        }
        .dash-reward-suffix { font-size: 14px; color: rgba(74,222,128,0.6); font-weight: 600; }
        .dash-hero-pstake { display: flex; align-items: center; gap: 12px; margin-top: 16px; padding-top: 14px; border-top: 1px solid var(--dash-border); }
        .dash-hero-pstake-label { font-size: 10px; color: var(--dash-text-3); text-transform: uppercase; }
        .dash-hero-pstake-value { font-size: 18px; font-weight: 700; color: var(--dash-purple); font-family: 'SF Mono', monospace; }
        .dash-hero-ghost {
            position: absolute;
            top: 12px;
            right: 16px;
            width: 64px;
            height: 64px;
            opacity: 0.06;
            animation: dash-float 6s ease-in-out infinite;
            pointer-events: none;
        }

        /* â”€â”€ Claim Button â”€â”€ */
        .dash-claim-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding: 10px 24px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
            font-weight: 700;
            font-size: 14px;
            border-radius: var(--dash-radius-sm);
            border: none;
            cursor: pointer;
            transition: all var(--dash-tr);
            box-shadow: 0 4px 20px rgba(34,197,94,0.25);
        }
        .dash-claim-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(34,197,94,0.35); }
        .dash-claim-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
        .dash-stake-link {
            font-size: 12px; color: var(--dash-purple); font-weight: 600; cursor: pointer;
            transition: color var(--dash-tr); margin-left: auto;
        }
        .dash-stake-link:hover { color: var(--dash-text); }

        /* â”€â”€ Gain Upsell â”€â”€ */
        .dash-gain-area {
            display: none;
            margin-top: 10px;
            padding: 6px 10px;
            background: linear-gradient(90deg, rgba(245,158,11,0.08), rgba(74,222,128,0.08));
            border: 1px solid rgba(245,158,11,0.2);
            border-radius: 8px;
            font-size: 10px;
            color: var(--dash-accent);
            font-weight: 700;
        }
        .dash-gain-area.visible { display: inline-block; }

        /* â”€â”€ Faucet Section â”€â”€ */
        .dash-faucet-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 22px;
            background: linear-gradient(135deg, rgba(6,182,212,0.06), rgba(34,197,94,0.04));
            border: 1px solid rgba(6,182,212,0.15);
            border-radius: var(--dash-radius);
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out 0.1s both;
            transition: opacity var(--dash-tr);
        }
        .dash-faucet-section::before {
            content: '';
            position: absolute;
            top: -60%; left: -15%;
            width: 280px; height: 280px;
            background: radial-gradient(circle, rgba(6,182,212,0.05) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 5s ease-in-out infinite;
        }
        .dash-faucet-icon {
            width: 48px; height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(6,182,212,0.15), rgba(34,197,94,0.1));
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: #22d3ee;
            flex-shrink: 0;
            animation: dash-float 4s ease-in-out infinite;
            position: relative; z-index: 1;
        }
        .dash-faucet-info { flex: 1; min-width: 0; position: relative; z-index: 1; }
        .dash-faucet-info h3 { font-size: 14px; font-weight: 800; color: var(--dash-text); margin: 0 0 2px; }
        .dash-faucet-info p { font-size: 11px; color: var(--dash-text-2); margin: 0; }
        .dash-faucet-amounts { display: flex; gap: 10px; margin-top: 8px; }
        .dash-faucet-badge {
            font-size: 11px; font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--dash-border);
            display: inline-flex; align-items: center; gap: 4px;
        }
        .dash-faucet-info .faucet-status-text { font-size: 12px; color: var(--dash-accent); font-family: 'SF Mono', monospace; margin-top: 6px; }
        .dash-faucet-actions { position: relative; z-index: 1; flex-shrink: 0; }

        /* â”€â”€ Referral Section â”€â”€ */
        .dash-referral-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 22px;
            background: linear-gradient(135deg, rgba(167,139,250,0.06), rgba(139,92,246,0.04));
            border: 1px solid rgba(167,139,250,0.15);
            border-radius: var(--dash-radius);
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out 0.15s both;
            transition: opacity var(--dash-tr);
        }
        .dash-referral-section::before {
            content: '';
            position: absolute;
            top: -60%; right: -15%;
            width: 280px; height: 280px;
            background: radial-gradient(circle, rgba(167,139,250,0.05) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 5s ease-in-out infinite 1s;
        }
        .dash-referral-icon {
            width: 48px; height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(167,139,250,0.15), rgba(139,92,246,0.1));
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: #a78bfa;
            flex-shrink: 0;
            animation: dash-float 4s ease-in-out infinite 0.5s;
            position: relative; z-index: 1;
        }
        .dash-referral-info { flex: 1; min-width: 0; position: relative; z-index: 1; }
        .dash-referral-info h3 { font-size: 14px; font-weight: 800; color: var(--dash-text); margin: 0 0 2px; }
        .dash-referral-info p { font-size: 11px; color: var(--dash-text-2); margin: 0; }
        .dash-referral-stats {
            display: flex; gap: 12px; margin-top: 8px;
        }
        .dash-referral-stat {
            font-size: 11px; font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--dash-border);
            display: inline-flex; align-items: center; gap: 4px;
        }
        .dash-referral-link-box {
            display: flex; align-items: center; gap: 6px;
            margin-top: 8px;
            padding: 6px 10px;
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            border-radius: 8px;
            font-size: 11px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            color: var(--dash-text-3);
            max-width: 380px;
        }
        .dash-referral-link-box span { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .dash-referral-link-box button {
            background: none; border: none; color: #a78bfa; cursor: pointer;
            padding: 2px 6px; font-size: 12px; border-radius: 4px;
            transition: background var(--dash-tr);
        }
        .dash-referral-link-box button:hover { background: rgba(167,139,250,0.1); }
        .dash-referral-actions { position: relative; z-index: 1; flex-shrink: 0; display: flex; gap: 8px; }
        .dash-btn-purple {
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
            color: #fff;
            box-shadow: 0 4px 20px rgba(139,92,246,0.25);
        }
        .dash-btn-purple:hover { box-shadow: 0 4px 28px rgba(139,92,246,0.4); transform: translateY(-1px); }
        @media (max-width: 640px) {
            .dash-referral-section { flex-direction: column; text-align: center; padding: 16px; }
            .dash-referral-actions { width: 100%; justify-content: center; }
            .dash-referral-link-box { max-width: 100%; }
            .dash-referral-stats { justify-content: center; }
        }

        /* â”€â”€ Buyback Banner â”€â”€ */
        .dash-buyback-section {
            position: relative;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 22px;
            background: linear-gradient(135deg, rgba(249,115,22,0.06), rgba(234,88,12,0.03));
            border: 1px solid rgba(249,115,22,0.15);
            border-radius: var(--dash-radius);
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out 0.12s both;
            transition: opacity var(--dash-tr);
        }
        .dash-buyback-section::before {
            content: '';
            position: absolute;
            top: -60%; right: -10%;
            width: 250px; height: 250px;
            background: radial-gradient(circle, rgba(249,115,22,0.05) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 5s ease-in-out infinite 0.5s;
        }
        .dash-buyback-icon {
            width: 48px; height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, rgba(249,115,22,0.15), rgba(234,88,12,0.1));
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: #f97316;
            flex-shrink: 0;
            animation: dash-float 4s ease-in-out infinite 0.3s;
            position: relative; z-index: 1;
        }
        .dash-buyback-info { flex: 1; min-width: 0; position: relative; z-index: 1; }
        .dash-buyback-info h3 { font-size: 14px; font-weight: 800; color: var(--dash-text); margin: 0 0 2px; }
        .dash-buyback-info p { font-size: 11px; color: var(--dash-text-2); margin: 0; }
        .dash-buyback-amounts { display: flex; gap: 10px; margin-top: 8px; }
        .dash-buyback-badge {
            font-size: 11px; font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            background: rgba(255,255,255,0.04);
            border: 1px solid var(--dash-border);
            display: inline-flex; align-items: center; gap: 4px;
        }
        .dash-buyback-actions { position: relative; z-index: 1; flex-shrink: 0; }
        .dash-btn-orange {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #fff;
            box-shadow: 0 4px 20px rgba(249,115,22,0.25);
        }
        .dash-btn-orange:hover { box-shadow: 0 4px 28px rgba(249,115,22,0.4); transform: translateY(-1px); }
        @media (max-width: 640px) {
            .dash-buyback-section { flex-direction: column; text-align: center; padding: 16px; }
            .dash-buyback-actions { width: 100%; justify-content: center; }
            .dash-buyback-amounts { justify-content: center; }
        }

        /* â”€â”€ Quick Actions Grid â”€â”€ */
        .dash-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .dash-action-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            cursor: pointer;
            transition: all var(--dash-tr);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        .dash-action-card::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity var(--dash-tr);
            pointer-events: none;
        }
        .dash-action-card:hover { border-color: var(--dash-border-h); transform: translateY(-2px); }
        .dash-action-card:hover::before { opacity: 1; }
        .dash-action-icon {
            width: 38px; height: 38px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .dash-action-text h4 { font-size: 13px; font-weight: 700; color: var(--dash-text); margin: 0; }
        .dash-action-text p { font-size: 10px; color: var(--dash-text-3); margin: 2px 0 0; }
        .dash-action-arrow { font-size: 10px; color: var(--dash-text-3); margin-left: auto; transition: transform var(--dash-tr); }
        .dash-action-card:hover .dash-action-arrow { transform: translateX(3px); color: var(--dash-text-2); }

        /* Action card themes */
        .dash-action-card.backchat::before { background: linear-gradient(135deg, rgba(6,182,212,0.06), transparent); }
        .dash-action-card.backchat:hover { border-color: rgba(6,182,212,0.3); }
        .dash-action-card.stake::before { background: linear-gradient(135deg, rgba(167,139,250,0.06), transparent); }
        .dash-action-card.stake:hover { border-color: rgba(167,139,250,0.3); }
        .dash-action-card.fortune::before { background: linear-gradient(135deg, rgba(249,115,22,0.06), transparent); }
        .dash-action-card.fortune:hover { border-color: rgba(249,115,22,0.3); }
        .dash-action-card.notary::before { background: linear-gradient(135deg, rgba(129,140,248,0.06), transparent); }
        .dash-action-card.notary:hover { border-color: rgba(129,140,248,0.3); }
        .dash-action-card.charity::before { background: linear-gradient(135deg, rgba(236,72,153,0.06), transparent); }
        .dash-action-card.charity:hover { border-color: rgba(236,72,153,0.3); }
        .dash-action-card.nft::before { background: linear-gradient(135deg, rgba(245,158,11,0.06), transparent); }
        .dash-action-card.nft:hover { border-color: rgba(245,158,11,0.3); }

        /* â”€â”€ Metrics Bar â”€â”€ */
        .dash-metrics-bar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        .dash-metric-pill {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 10px 12px;
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            transition: border-color var(--dash-tr);
        }
        .dash-metric-pill:hover { border-color: var(--dash-border-h); }
        .dash-metric-pill-label { font-size: 9px; color: var(--dash-text-3); text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .dash-metric-pill-label i { font-size: 9px; }
        .dash-metric-pill-value { font-size: 14px; font-weight: 700; color: var(--dash-text); font-variant-numeric: tabular-nums; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* â”€â”€ Activity Panel â”€â”€ */
        .dash-activity-panel {
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius);
            padding: 16px;
            animation: dash-fadeIn 0.5s ease-out 0.1s both;
        }
        .dash-activity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .dash-activity-title { font-size: 13px; font-weight: 700; color: var(--dash-text); display: flex; align-items: center; gap: 8px; }
        .dash-activity-title i { color: var(--dash-text-3); font-size: 12px; }
        .dash-sort-btn {
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            color: var(--dash-text-3);
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--dash-tr);
        }
        .dash-sort-btn:hover { color: var(--dash-text); border-color: var(--dash-border-h); }

        /* â”€â”€ Filter Chips â”€â”€ */
        .dash-filter-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .dash-chip {
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            color: var(--dash-text-3);
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            border-radius: 20px;
            cursor: pointer;
            transition: all var(--dash-tr);
            white-space: nowrap;
        }
        .dash-chip:hover { color: var(--dash-text-2); border-color: var(--dash-border-h); }
        .dash-chip.active { color: var(--dash-accent); background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.3); }
        .dash-chip i { opacity: 0.5; transition: opacity var(--dash-tr); }
        .dash-chip.active i { opacity: 1; }

        /* â”€â”€ Activity List â”€â”€ */
        .dash-activity-list { display: flex; flex-direction: column; gap: 6px; min-height: 150px; max-height: 520px; overflow-y: auto; }
        .dash-activity-list::-webkit-scrollbar { width: 4px; }
        .dash-activity-list::-webkit-scrollbar-track { background: transparent; }
        .dash-activity-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }

        .dash-activity-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--dash-surface-2);
            border: 1px solid transparent;
            border-radius: 8px;
            transition: all var(--dash-tr);
            text-decoration: none;
            gap: 10px;
        }
        .dash-activity-item:hover { background: var(--dash-surface-3); border-color: var(--dash-border-h); }
        .dash-activity-item-icon {
            width: 32px; height: 32px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
            font-size: 12px;
        }
        .dash-activity-item-info { flex: 1; min-width: 0; }
        .dash-activity-item-label { font-size: 12px; font-weight: 600; color: var(--dash-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dash-activity-item-meta { font-size: 10px; color: var(--dash-text-3); margin-top: 1px; }
        .dash-activity-item-amount { font-size: 12px; font-weight: 600; color: var(--dash-text); font-family: 'SF Mono', monospace; text-align: right; white-space: nowrap; }
        .dash-activity-item-amount .unit { font-size: 10px; color: var(--dash-text-3); }
        .dash-activity-item-link { font-size: 9px; color: var(--dash-text-3); transition: color var(--dash-tr); }
        .dash-activity-item:hover .dash-activity-item-link { color: #60a5fa; }

        /* Fortune special item */
        .dash-fortune-item {
            display: block;
            padding: 10px 12px;
            background: var(--dash-surface-2);
            border: 1px solid transparent;
            border-radius: 8px;
            text-decoration: none;
            transition: all var(--dash-tr);
        }
        .dash-fortune-item:hover { background: var(--dash-surface-3); border-color: var(--dash-border-h); }

        /* â”€â”€ Pagination â”€â”€ */
        .dash-pagination { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--dash-border); }
        .dash-page-btn {
            font-size: 11px; color: var(--dash-text-3); background: none; border: none; cursor: pointer;
            transition: color var(--dash-tr); padding: 4px 0;
        }
        .dash-page-btn:hover:not(:disabled) { color: var(--dash-text); }
        .dash-page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .dash-page-indicator { font-size: 10px; color: var(--dash-text-3); font-family: monospace; }

        /* â”€â”€ (sidebar removed in V69.1) â”€â”€ */

        /* â”€â”€ Buttons â”€â”€ */
        .dash-btn-primary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; font-size: 12px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--dash-tr); color: white;
        }
        .dash-btn-primary:disabled { opacity: 0.35; cursor: not-allowed; }
        .dash-btn-green { background: linear-gradient(135deg, #22c55e, #10b981); }
        .dash-btn-green:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .dash-btn-cyan:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .dash-btn-purple:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-secondary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; font-size: 12px; font-weight: 600;
            background: var(--dash-surface-2); color: var(--dash-text-2);
            border: 1px solid var(--dash-border); border-radius: 8px;
            cursor: pointer; transition: all var(--dash-tr);
        }
        .dash-btn-secondary:hover:not(:disabled) { color: var(--dash-text); border-color: var(--dash-border-h); }
        .dash-btn-secondary:disabled { opacity: 0.35; cursor: not-allowed; }
        .dash-modal-action-btn {
            width: 100%; padding: 9px; font-size: 12px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--dash-tr); color: white; text-align: center;
        }
        .dash-modal-action-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }

        /* â”€â”€ Modals â”€â”€ */
        .dash-modal-overlay {
            position: fixed; inset: 0; z-index: 50;
            display: none; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            padding: 16px; opacity: 0; transition: opacity 0.3s;
        }
        .dash-modal-overlay.visible { display: flex; opacity: 1; }
        .dash-modal {
            background: var(--dash-surface); border: 1px solid var(--dash-border-h);
            border-radius: var(--dash-radius); max-width: 360px; width: 100%;
            padding: 20px; position: relative;
            transform: scale(0.95); transition: transform 0.3s;
        }
        .dash-modal-overlay.visible .dash-modal { transform: scale(1); }

        /* â”€â”€ Loading / Empty â”€â”€ */
        .dash-loading {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 32px 16px; gap: 12px;
        }
        .dash-loading-logo { width: 40px; height: 40px; opacity: 0.4; animation: dash-float 2s ease-in-out infinite; }
        .dash-loading-text { font-size: 11px; color: var(--dash-text-3); }
        .dash-empty-text { font-size: 12px; color: var(--dash-text-3); text-align: center; padding: 24px 16px; }

        /* â”€â”€ Hero gradient border â”€â”€ */
        .dash-hero::after {
            content: '';
            position: absolute; inset: 0;
            border-radius: var(--dash-radius);
            padding: 1px;
            background: linear-gradient(135deg, rgba(245,158,11,0.25), rgba(74,222,128,0.15), rgba(167,139,250,0.15));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            -webkit-mask-composite: xor;
            pointer-events: none;
            opacity: 0.6;
        }

        /* â”€â”€ Claim button shimmer when active â”€â”€ */
        .dash-claim-btn:not(:disabled) {
            background-size: 200% 100%;
            background-image: linear-gradient(90deg, #22c55e 0%, #34d399 25%, #22c55e 50%, #10b981 100%);
            animation: dash-shimmer 3s linear infinite;
        }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 900px) {
            .dash-metrics-bar { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 640px) {
            .dash-shell { padding: 0 10px 30px; }
            .dash-hero { padding: 20px 16px; }
            .dash-hero-inner { flex-direction: column; gap: 16px; }
            .dash-hero-right { border-top: 1px solid var(--dash-border); padding-top: 16px; }
            .dash-actions-grid { grid-template-columns: repeat(2, 1fr); }
            .dash-metrics-bar { grid-template-columns: repeat(2, 1fr); }
            .dash-reward-value { font-size: 28px; }

            /* Faucet stacks vertically */
            .dash-faucet-section { flex-direction: column; text-align: center; padding: 16px; }
            .dash-faucet-actions { width: 100%; }
            .dash-faucet-actions button { width: 100%; justify-content: center; }
            .dash-faucet-amounts { justify-content: center; }

            /* Filter chips horizontal scroll */
            .dash-filter-chips {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                padding-bottom: 4px;
            }
            .dash-filter-chips::-webkit-scrollbar { display: none; }

            /* Tighter activity items */
            .dash-activity-item { padding: 8px; gap: 8px; }
        }
        @media (max-width: 380px) {
            .dash-actions-grid { grid-template-columns: 1fr; }
        }
    `,document.head.appendChild(e)}function F0(){ht.dashboard&&(R0(),ht.dashboard.innerHTML=`
        <div class="dash-shell">

            <!-- HERO SECTION -->
            <div class="dash-hero" style="margin-bottom: 14px;">
                <img src="./assets/bkc_logo_3d.png" class="dash-hero-ghost" alt="">
                <div class="dash-hero-inner">
                    <div class="dash-hero-left">
                        <div class="dash-hero-label">You Will Receive</div>
                        <div id="dash-user-rewards" class="dash-reward-value">--</div>

                        <div id="dash-user-gain-area" class="dash-gain-area">
                            <i class="fa-solid fa-rocket" style="margin-right:4px"></i>
                            Earn +<span id="dash-user-potential-gain">0</span> BKC more with NFT!
                        </div>

                        <button id="dashboardClaimBtn" class="dash-claim-btn" disabled>
                            <i class="fa-solid fa-coins"></i> Claim Rewards
                        </button>

                        <div class="dash-hero-pstake">
                            <div>
                                <div class="dash-hero-pstake-label">Your pStake</div>
                                <div id="dash-user-pstake" class="dash-hero-pstake-value">--</div>
                            </div>
                            <span class="dash-stake-link delegate-link"><i class="fa-solid fa-plus" style="margin-right:3px"></i> Stake More</span>
                        </div>
                    </div>

                    <div class="dash-hero-right">
                        <div id="dash-booster-area" style="min-height: 120px; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align:center;">
                                <img src="./assets/bkc_logo_3d.png" style="width:32px;height:32px;opacity:0.3;animation:dash-float 2s infinite" alt="">
                                <p style="font-size:11px;color:var(--dash-text-3);margin-top:8px">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAUCET SECTION â€” Always Visible -->
            <div id="dashboard-faucet-widget" class="dash-faucet-section" style="margin-bottom: 14px;">
                <div class="dash-faucet-icon">
                    <i class="fa-solid fa-droplet"></i>
                </div>
                <div class="dash-faucet-info">
                    <h3 id="faucet-title">Get Free Testnet Tokens</h3>
                    <p id="faucet-desc">Claim ETH for gas â€” one-time per wallet</p>
                    <div class="dash-faucet-amounts">
                        <span class="dash-faucet-badge" style="color:#4ade80">
                            <i class="fa-brands fa-ethereum" style="font-size:10px"></i>${Dr} ETH
                        </span>
                    </div>
                    <p id="faucet-status" class="faucet-status-text hidden"></p>
                </div>
                <div class="dash-faucet-actions">
                    <button id="faucet-action-btn" class="dash-btn-primary dash-btn-cyan">
                        <i class="fa-solid fa-faucet"></i> Claim Free Tokens
                    </button>
                </div>
            </div>

            <!-- BUYBACK BANNER â€” Only visible when pending ETH > 0 -->
            <div id="dash-buyback-widget" class="dash-buyback-section" style="margin-bottom: 14px; display: none;">
                <div class="dash-buyback-icon">
                    <i class="fa-solid fa-hammer"></i>
                </div>
                <div class="dash-buyback-info">
                    <h3 id="dash-buyback-title">Buyback Ready</h3>
                    <p id="dash-buyback-desc">Execute buyback to earn 5% of pending ETH as staker rewards</p>
                    <div class="dash-buyback-amounts">
                        <span class="dash-buyback-badge" style="color:#f97316">
                            <i class="fa-brands fa-ethereum" style="font-size:10px"></i>
                            <span id="dash-buyback-pending">0</span> ETH pending
                        </span>
                        <span class="dash-buyback-badge" style="color:#4ade80">
                            <i class="fa-solid fa-gift" style="font-size:10px"></i>
                            Earn <span id="dash-buyback-reward">0</span> ETH
                        </span>
                    </div>
                </div>
                <div class="dash-buyback-actions">
                    <button id="dash-buyback-btn" class="dash-btn-primary dash-btn-orange">
                        <i class="fa-solid fa-hammer"></i> Execute
                    </button>
                </div>
            </div>

            <!-- TUTOR SECTION -->
            <div id="dashboard-referral-widget" class="dash-referral-section" style="margin-bottom: 14px;">
                <div class="dash-referral-icon">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div class="dash-referral-info">
                    <h3 id="referral-title">Be Someone's Tutor</h3>
                    <p id="referral-desc">Share your link. Earn 10% of all fees + 5% BKC from your students â€” forever.</p>
                    <div id="referral-stats" class="dash-referral-stats" style="display:none">
                        <span class="dash-referral-stat" style="color:#a78bfa">
                            <i class="fa-solid fa-users" style="font-size:10px"></i>
                            <span id="referral-count">0</span> students
                        </span>
                        <span class="dash-referral-stat" style="color:#4ade80">
                            <i class="fa-solid fa-coins" style="font-size:10px"></i>
                            10% ETH + 5% BKC
                        </span>
                    </div>
                    <div id="tutor-info-area" class="dash-referral-stats" style="display:none"></div>
                    <div id="referral-link-container" class="dash-referral-link-box" style="display:none">
                        <span id="referral-link-text"></span>
                        <button id="referral-copy-btn" title="Copy link"><i class="fa-solid fa-copy"></i></button>
                    </div>
                </div>
                <div class="dash-referral-actions">
                    <button id="referral-share-btn" class="dash-btn-primary dash-btn-purple" style="display:none">
                        <i class="fa-solid fa-share-nodes"></i> Share
                    </button>
                </div>
            </div>

            <!-- QUICK ACTIONS GRID -->
            <div class="dash-actions-grid" style="margin-bottom: 14px;">
                <div class="dash-action-card backchat go-to-backchat">
                    <div class="dash-action-icon" style="background:rgba(6,182,212,0.12); color:#22d3ee;">
                        <i class="fa-solid fa-comment-dots"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Agora</h4>
                        <p>Post & discuss on-chain</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card stake delegate-link">
                    <div class="dash-action-icon" style="background:rgba(167,139,250,0.12); color:#a78bfa;">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Stake BKC</h4>
                        <p>Earn while you sleep</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card fortune go-to-fortune">
                    <div class="dash-action-icon" style="background:rgba(249,115,22,0.12); color:#f97316;">
                        <i class="fa-solid fa-paw"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Fortune Pool</h4>
                        <p id="dash-fortune-prize-text">Win up to 100x</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card notary go-to-notary">
                    <div class="dash-action-icon" style="background:rgba(129,140,248,0.12); color:#818cf8;">
                        <i class="fa-solid fa-stamp"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Notarize</h4>
                        <p id="dash-notary-count-text">Certify on blockchain</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card charity go-to-charity">
                    <div class="dash-action-icon" style="background:rgba(236,72,153,0.12); color:#ec4899;">
                        <i class="fa-solid fa-heart"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Charity Pool</h4>
                        <p>Donate & burn tokens</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card nft go-to-store">
                    <div class="dash-action-icon" style="background:rgba(245,158,11,0.12); color:#f59e0b;">
                        <i class="fa-solid fa-gem"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>NFT Market</h4>
                        <p>2x your rewards</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card trade go-to-trade">
                    <div class="dash-action-icon" style="background:rgba(255,0,122,0.12); color:#ff007a;">
                        <i class="fa-solid fa-arrow-right-arrow-left"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Trade BKC</h4>
                        <p>Swap on Uniswap V3</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>
            </div>

            <!-- METRICS BAR -->
            <div class="dash-metrics-bar" style="margin-bottom: 16px;">
                <div class="dash-metric-pill" title="Total BKC tokens in circulation">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-coins" style="color:#f59e0b"></i> Supply</div>
                    <div id="dash-metric-supply" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Total staking power on network">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-layer-group" style="color:#a78bfa"></i> pStake</div>
                    <div id="dash-metric-pstake" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="BKC permanently removed from supply">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-fire" style="color:#ef4444"></i> Burned</div>
                    <div id="dash-metric-burned" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Total ETH fees collected by ecosystem">
                    <div class="dash-metric-pill-label"><i class="fa-brands fa-ethereum" style="color:#fb923c"></i> Fees</div>
                    <div id="dash-metric-fees" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="BKC locked in protocol contracts (staking, pools, etc)">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-vault" style="color:#60a5fa"></i> Locked</div>
                    <div id="dash-metric-locked" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="BKC market price (via Uniswap V3 + CoinGecko)" style="border-color: rgba(34,197,94,0.2);">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-chart-line" style="color:#22c55e"></i> BKC Price</div>
                    <div id="dash-metric-bkcprice" class="dash-metric-pill-value" style="color:#22c55e">--</div>
                </div>
                <div class="dash-metric-pill" title="Your BKC balance" style="border-color: rgba(245,158,11,0.2);">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-wallet" style="color:#f59e0b"></i> Balance</div>
                    <div id="dash-metric-balance" class="dash-metric-pill-value" style="color:#f59e0b">--</div>
                    <div id="dash-metric-balance-usd" style="font-size:10px;color:var(--dash-text-3);margin-top:-1px"></div>
                </div>
            </div>

            <!-- ACTIVITY FEED -->
            <div class="dash-activity-panel">
                <div class="dash-activity-header">
                    <div class="dash-activity-title">
                        <i class="fa-solid fa-bolt" style="color:var(--dash-accent)"></i>
                        <span id="activity-title">Activity</span>
                        <span id="activity-count" style="font-size:9px;color:var(--dash-text-3);background:var(--dash-surface-2);padding:2px 6px;border-radius:10px;font-weight:600;display:none">0</span>
                    </div>
                    <div style="display:flex; gap:6px; align-items:center;">
                        <button id="manual-refresh-btn" class="dash-sort-btn" title="Refresh activity">
                            <i class="fa-solid fa-rotate"></i>
                        </button>
                        <button id="activity-sort-toggle" class="dash-sort-btn" title="Toggle sort order">
                            <i class="fa-solid fa-arrow-down-wide-short"></i>
                        </button>
                    </div>
                </div>

                <div class="dash-filter-chips">
                    <button class="dash-chip active" data-filter="ALL"><i class="fa-solid fa-layer-group" style="margin-right:3px;font-size:9px"></i>All</button>
                    <button class="dash-chip" data-filter="STAKE"><i class="fa-solid fa-lock" style="margin-right:3px;font-size:9px"></i>Staking</button>
                    <button class="dash-chip" data-filter="CLAIM"><i class="fa-solid fa-coins" style="margin-right:3px;font-size:9px"></i>Claims</button>
                    <button class="dash-chip" data-filter="NFT"><i class="fa-solid fa-gem" style="margin-right:3px;font-size:9px"></i>NFT</button>
                    <button class="dash-chip" data-filter="GAME"><i class="fa-solid fa-dice" style="margin-right:3px;font-size:9px"></i>Fortune</button>
                    <button class="dash-chip" data-filter="CHARITY"><i class="fa-solid fa-heart" style="margin-right:3px;font-size:9px"></i>Charity</button>
                    <button class="dash-chip" data-filter="NOTARY"><i class="fa-solid fa-stamp" style="margin-right:3px;font-size:9px"></i>Notary</button>
                    <button class="dash-chip" data-filter="BACKCHAT"><i class="fa-solid fa-comments" style="margin-right:3px;font-size:9px"></i>Agora</button>
                    <button class="dash-chip" data-filter="FAUCET"><i class="fa-solid fa-droplet" style="margin-right:3px;font-size:9px"></i>Faucet</button>
                </div>

                <div id="dash-activity-list" class="dash-activity-list">
                    <div class="dash-loading">
                        <img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt="">
                        <span class="dash-loading-text">Loading activity...</span>
                    </div>
                </div>

                <div id="dash-pagination-controls" class="dash-pagination" style="display:none">
                    <button class="dash-page-btn" id="page-prev"><i class="fa-solid fa-chevron-left" style="margin-right:4px"></i>Prev</button>
                    <span class="dash-page-indicator" id="page-indicator">1/1</span>
                    <button class="dash-page-btn" id="page-next">Next<i class="fa-solid fa-chevron-right" style="margin-left:4px"></i></button>
                </div>
            </div>
        </div>

        ${D0()}
        ${M0()}
    `,K0())}function D0(){return`
        <div id="booster-info-modal" class="dash-modal-overlay">
            <div class="dash-modal">
                <button id="close-booster-modal" style="position:absolute;top:12px;right:12px;background:none;border:none;color:var(--dash-text-3);cursor:pointer;font-size:16px"><i class="fa-solid fa-xmark"></i></button>
                <div style="text-align:center; margin-bottom:16px">
                    <div style="display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;background:rgba(245,158,11,0.15);border-radius:50%;margin-bottom:8px">
                        <i class="fa-solid fa-rocket" style="font-size:22px;color:var(--dash-accent)"></i>
                    </div>
                    <h3 style="font-size:18px;font-weight:700;color:var(--dash-text);margin:0">Boost Efficiency</h3>
                    <p style="font-size:11px;color:var(--dash-text-2);margin-top:4px">NFT holders earn up to 2x more</p>
                </div>
                <div style="background:var(--dash-surface-2);border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:6px">
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-text-2)">No NFT:</span><span style="color:var(--dash-text-3);font-weight:700">50%</span></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-text-2)">Bronze:</span><span style="color:#fde047;font-weight:700">80%</span></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-accent)">Diamond:</span><span style="color:var(--dash-green);font-weight:700">100%</span></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px">
                    <button class="dash-modal-action-btn go-to-store" style="background:linear-gradient(135deg,#d97706,#b45309)">Buy NFT</button>
                    <button class="dash-modal-action-btn go-to-rental" style="background:linear-gradient(135deg,#06b6d4,#0891b2)">Rent NFT</button>
                </div>
            </div>
        </div>
    `}function M0(){return`
        <div id="no-gas-modal-dash" class="dash-modal-overlay">
            <div class="dash-modal" style="text-align:center;max-width:300px">
                <div style="width:48px;height:48px;background:rgba(239,68,68,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;border:1px solid rgba(239,68,68,0.2)">
                    <i class="fa-solid fa-gas-pump" style="font-size:18px;color:#ef4444"></i>
                </div>
                <h3 style="font-size:16px;font-weight:700;color:var(--dash-text);margin:0 0 4px">No Gas</h3>
                <p style="font-size:11px;color:var(--dash-text-2);margin-bottom:14px">You need ETH for gas</p>
                <button id="emergency-faucet-btn" class="dash-btn-primary dash-btn-green" style="width:100%;justify-content:center;margin-bottom:10px">
                    <i class="fa-solid fa-hand-holding-medical"></i> Get Free Gas + BKC
                </button>
                <button id="close-gas-modal-dash" style="background:none;border:none;color:var(--dash-text-3);cursor:pointer;font-size:11px">Close</button>
            </div>
        </div>
    `}async function O0(){try{const e=await fetch(A0);if(e.ok){const t=await e.json();return O.economicData=t,t}}catch{}return null}async function Ti(){var e,t,a,n,o,s,i;try{const r=await O0();let l=0n,c=0n,d=0n,f=0n,g=0n,m=0,h=0n;if(r&&((e=r.token)!=null&&e.totalSupply&&(l=BigInt(r.token.totalSupply)),(t=r.token)!=null&&t.totalBurned&&(f=BigInt(r.token.totalBurned)),(a=r.staking)!=null&&a.totalPStake&&(c=BigInt(r.staking.totalPStake)),(n=r.ecosystem)!=null&&n.totalEthCollected&&(g=BigInt(r.ecosystem.totalEthCollected)),(o=r.fortunePool)!=null&&o.prizePool&&(h=BigInt(r.fortunePool.prizePool)),(s=r.notary)!=null&&s.certCount&&(m=r.notary.certCount),(i=r.stats)!=null&&i.notarizedDocuments&&(m=Math.max(m,r.stats.notarizedDocuments))),u.bkcTokenContractPublic){l===0n&&(l=await ie(u.bkcTokenContractPublic,"totalSupply",[],0n)),f===0n&&(f=await ie(u.bkcTokenContractPublic,"totalBurned",[],0n)),c===0n&&(u.stakingPoolContractPublic||u.stakingPoolContract)&&(c=await ie(u.stakingPoolContractPublic||u.stakingPoolContract,"totalPStake",[],0n));const F=[E.stakingPool,E.fortunePool,E.rentalManager,E.buybackMiner,E.liquidityPool,E.pool_bronze].filter(X=>X&&X!==zt.ZeroAddress),V=await Promise.all(F.map(X=>ie(u.bkcTokenContractPublic,"balanceOf",[X],0n)));if(V.forEach(X=>{d+=X}),E.fortunePool&&h===0n){const X=F.indexOf(E.fortunePool);X>=0&&(h=V[X])}}u.totalSupply=l,u.totalBurned=f;const w=j(l),y=j(f),k=j(g),v=j(h),T=F=>F.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),I=j(d),N=(F,V)=>{const X=document.getElementById(F);X&&(X.innerHTML=V)};N("dash-metric-supply",`${T(w)} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`),N("dash-metric-pstake",kn(c)),N("dash-metric-burned",y>0?`<span style="color:#ef4444">${$o(y)}</span> <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`:'<span style="color:var(--dash-text-3)">0 BKC</span>'),N("dash-metric-fees",k>0?`${k<1e3?k.toFixed(3):$o(k)} <span style="font-size:10px;color:var(--dash-text-3)">ETH</span>`:'<span style="color:var(--dash-text-3)">0.000 ETH</span>'),N("dash-metric-locked",I>0?`<span style="color:#60a5fa">${$o(I)}</span> <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`:'<span style="color:var(--dash-text-3)">0 BKC</span>'),Mr(),H0();const S=document.getElementById("dash-fortune-prize-text");S&&(S.innerText=v>0?`Prize: ${$o(v)} BKC`:"Play to win");const $=document.getElementById("dash-notary-count-text");$&&($.innerText=m>0?`${m} docs certified`:"Certify documents"),O.metricsCache={supply:w,burned:y,fees:k,timestamp:Date.now()},sg()}catch(r){console.error("Metrics Error",r)}}async function sg(){try{const[e,t]=await Promise.all([Gt.getPreviewBuyback(),Gt.getExecutionFee().catch(()=>0n)]),a=document.getElementById("dash-buyback-widget");if(!a)return;const n=e.ethAvailable||0n,o=e.estimatedCallerReward||0n;if(!e.isReady||n===0n){a.style.display="none";return}a.style.display="";const i=Number(zt.formatEther(n)).toFixed(6),r=Number(zt.formatEther(o)).toFixed(6),l=t>0n?Number(zt.formatEther(t)).toFixed(4):"0",c=document.getElementById("dash-buyback-pending"),d=document.getElementById("dash-buyback-reward"),f=document.getElementById("dash-buyback-title"),g=document.getElementById("dash-buyback-desc");c&&(c.textContent=i),d&&(d.textContent=r),f&&(f.textContent=`Buyback Ready â€” ${i} ETH`),g&&(g.textContent=t>0n?`Pay ${l} ETH fee, earn ${r} ETH (5%). Fee amplifies buyback.`:"Execute buyback to earn 5% of pending ETH as staker rewards")}catch(e){console.error("Dashboard buyback load error:",e)}}async function U0(e){e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Executing...';try{await Gt.executeBuyback({button:e,onSuccess:async()=>{x("Buyback executed! You earned 5% ETH reward","success"),sg()},onError:t=>{t.cancelled||x("Buyback failed: "+(t.reason||t.message||"Unknown error"),"error"),e.disabled=!1,e.innerHTML='<i class="fa-solid fa-hammer"></i> Execute'}})}catch(t){x("Buyback failed: "+(t.reason||t.message||"Unknown error"),"error"),e.disabled=!1,e.innerHTML='<i class="fa-solid fa-hammer"></i> Execute'}}async function H0(){const e=u.publicProvider||u.provider;if(e)try{const t=await Fr(e),a=document.getElementById("dash-metric-bkcprice");if(a)if(t.bkcUsd>0)a.innerHTML=`${Ds(t.bkcUsd)}`;else if(t.bkcEth>0){const n=t.bkcEth<.001?t.bkcEth.toFixed(8).replace(/0+$/,""):t.bkcEth.toFixed(6);a.innerHTML=`${n} <span style="font-size:10px;color:var(--dash-text-3)">ETH</span>`}else a.innerHTML='<span style="color:var(--dash-text-3)">--</span>';j0(t)}catch(t){console.warn("[Dashboard] Price update failed:",t.message)}}function j0(e){const t=document.getElementById("dash-metric-balance-usd");if(!t||!u.isConnected){t&&(t.textContent="");return}const a=u.currentUserBalance||u.bkcBalance||0n;if(a>0n&&(e==null?void 0:e.bkcUsd)>0){const o=j(a)*e.bkcUsd;t.textContent=`â‰ˆ ${Ds(o)}`}else t.textContent=""}function Mr(){const e=document.getElementById("dash-metric-balance");if(!e)return;const t=u.currentUserBalance||u.bkcBalance||0n;if(!u.isConnected){e.innerHTML='<span style="font-size:11px;color:var(--dash-text-3)">Connect Wallet</span>';return}if(t===0n)e.innerHTML='0.00 <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>';else{const a=j(t);e.innerHTML=`${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`}}async function W0(){if(u.userAddress)try{const e=await fetch(`https://getuserprofile-4wvdcuoouq-uc.a.run.app/${u.userAddress}`);e.ok&&(O.userProfile=await e.json())}catch{}}async function dn(e=!1){var t,a;if(!u.isConnected){const n=document.getElementById("dash-booster-area");n&&(n.innerHTML=`
                <div style="text-align:center">
                    <p style="font-size:11px;color:var(--dash-text-3);margin-bottom:8px">Connect wallet to view</p>
                    <button onclick="window.openConnectModal()" class="dash-btn-secondary" style="font-size:11px">Connect</button>
                </div>`);return}try{const n=document.getElementById("dash-user-rewards");e&&n&&(n.style.opacity="0.6");const[,o,s]=await Promise.all([Pn(),fb(),md()]),i=(o==null?void 0:o.netClaimAmount)||0n;og(i),n&&(n.style.opacity="1");const r=document.getElementById("dashboardClaimBtn");r&&(r.disabled=i<=0n);const l=document.getElementById("dash-user-pstake");if(l){let c=((t=u.userData)==null?void 0:t.pStake)||((a=u.userData)==null?void 0:a.userTotalPStake)||u.userTotalPStake||0n;if(c===0n&&(u.stakingPoolContractPublic||u.stakingPoolContract)&&u.userAddress)try{c=await ie(u.stakingPoolContractPublic||u.stakingPoolContract,"userTotalPStake",[u.userAddress],0n)}catch{}l.innerText=kn(c)}Mr(),G0(s,o),W0(),Jo()}catch(n){console.error("User Hub Error:",n)}}function G0(e,t){var $;const a=document.getElementById("dash-booster-area");if(!a)return;const n=(e==null?void 0:e.highestBoost)||0,o=po(n),s=(t==null?void 0:t.totalRewards)||0n,i=s*BigInt(o)/100n,l=s-i,c=Qc(n),d=(e==null?void 0:e.imageUrl)||(c==null?void 0:c.image)||"./assets/bkc_logo_3d.png",f=st.find(F=>F.name==="Diamond");if(f!=null&&f.image,n===0){if(l>0n){const F=document.getElementById("dash-user-gain-area");F&&(F.classList.add("visible"),document.getElementById("dash-user-potential-gain").innerText=j(l).toFixed(2))}a.innerHTML=`
            <div style="text-align:center;width:100%">
                <div style="position:relative;margin:0 auto 12px;width:60px;height:60px;border-radius:50%;background:rgba(239,68,68,0.08);border:2px dashed rgba(239,68,68,0.25);display:flex;align-items:center;justify-content:center">
                    <i class="fa-solid fa-shield-halved" style="font-size:24px;color:rgba(239,68,68,0.35)"></i>
                    <div style="position:absolute;bottom:-3px;right:-3px;width:20px;height:20px;border-radius:50%;background:#1c1c21;border:2px solid rgba(239,68,68,0.3);display:flex;align-items:center;justify-content:center">
                        <i class="fa-solid fa-xmark" style="font-size:9px;color:#ef4444"></i>
                    </div>
                </div>

                <p style="font-size:11px;font-weight:700;color:var(--dash-text-3);margin:0 0 6px;text-transform:uppercase;letter-spacing:0.05em">No Booster NFT</p>

                <div style="display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:8px">
                    <span style="font-size:20px;font-weight:800;color:var(--dash-accent)">${o}%</span>
                    <span style="font-size:10px;color:var(--dash-text-3);text-align:left;line-height:1.2">you<br>keep</span>
                </div>

                <div style="width:100%;background:var(--dash-surface-2);border-radius:20px;height:6px;overflow:hidden;margin-bottom:10px">
                    <div style="background:linear-gradient(90deg,#ef4444,#f59e0b);height:100%;border-radius:20px;width:${o}%"></div>
                </div>

                ${s>0n&&l>0n?`
                <p style="font-size:10px;color:var(--dash-text-2);margin:0 0 10px">
                    <i class="fa-solid fa-arrow-up" style="color:var(--dash-green);margin-right:3px"></i>Get up to <span style="color:var(--dash-green);font-weight:700">+${j(l).toFixed(2)} BKC</span> with NFT
                </p>`:`
                <p style="font-size:10px;color:var(--dash-text-3);margin:0 0 10px">
                    <i class="fa-solid fa-recycle" style="color:var(--dash-accent);margin-right:3px"></i>50% recycled to stakers. <span style="color:var(--dash-green);font-weight:700">Diamond: keep 100%</span>
                </p>`}

                <div style="display:flex;gap:6px;justify-content:center">
                    <button class="dash-btn-primary go-to-store" style="background:linear-gradient(135deg,#d97706,#b45309);font-size:11px;padding:7px 14px;flex:1">
                        <i class="fa-solid fa-gem" style="margin-right:3px"></i>Buy NFT
                    </button>
                    <button class="dash-btn-primary go-to-rental" style="background:linear-gradient(135deg,#06b6d4,#0891b2);font-size:11px;padding:7px 14px;flex:1">
                        <i class="fa-solid fa-clock" style="margin-right:3px"></i>Rent NFT
                    </button>
                </div>
                <button id="open-booster-info" style="font-size:10px;color:var(--dash-text-3);background:none;border:none;cursor:pointer;margin-top:6px"><i class="fa-solid fa-circle-info" style="margin-right:3px"></i>How it works</button>
            </div>
        `;return}const g=e.source==="rented",m=(c==null?void 0:c.name)||(($=e.boostName)==null?void 0:$.replace(" Booster","").replace("Booster","").trim())||"Booster",h=(c==null?void 0:c.color)||"color:var(--dash-accent)",w=s*50n/100n,y=i-w,k=g?"fa-clock":"fa-check-circle",v=g?"#22d3ee":"#4ade80",T=g?"rgba(6,182,212,0.12)":"rgba(74,222,128,0.12)",I=g?"rgba(6,182,212,0.3)":"rgba(74,222,128,0.3)",N=g?"RENTED":"OWNED",S=g?"Active rental":"In your wallet";a.innerHTML=`
        <div class="nft-clickable-image" data-tokenid="${e.tokenId}" data-tier="${m}" style="width:100%;cursor:pointer;transition:all 0.2s">
            <div style="display:flex;align-items:center;gap:10px;background:var(--dash-surface-2);border:1px solid ${I};border-radius:12px;padding:10px 12px;margin-bottom:8px">
                <div style="position:relative;width:48px;height:48px;flex-shrink:0">
                    <img src="${d}" style="width:48px;height:48px;border-radius:10px;object-fit:cover;border:2px solid ${I}" alt="${m}" onerror="this.src='./assets/bkc_logo_3d.png'">
                    <div style="position:absolute;bottom:-4px;right:-4px;width:18px;height:18px;border-radius:50%;background:${v};display:flex;align-items:center;justify-content:center;border:2px solid var(--dash-surface-2)">
                        <i class="fa-solid ${k}" style="font-size:8px;color:#000"></i>
                    </div>
                </div>
                <div style="flex:1;min-width:0">
                    <div style="display:flex;align-items:center;gap:6px">
                        <h4 style="${h};font-weight:700;font-size:13px;margin:0">${m}</h4>
                        <span style="font-size:8px;font-weight:800;color:${v};background:${T};padding:2px 6px;border-radius:4px;letter-spacing:0.05em">${N}</span>
                        <span style="font-size:9px;color:var(--dash-text-3)">#${e.tokenId}</span>
                    </div>
                    <p style="font-size:10px;color:var(--dash-text-3);margin:2px 0 0"><i class="fa-solid ${k}" style="color:${v};margin-right:3px;font-size:9px"></i>${S}</p>
                </div>
                <div style="text-align:right;flex-shrink:0">
                    <div style="font-size:18px;font-weight:800;color:var(--dash-green)">${o}%</div>
                    <div style="font-size:8px;color:var(--dash-text-3);text-transform:uppercase;letter-spacing:0.05em">you keep</div>
                </div>
            </div>
            ${s>0n?`
            <div style="display:flex;gap:6px">
                <div style="flex:1;background:var(--dash-surface-2);border-radius:8px;padding:6px 8px;text-align:center">
                    <div style="font-size:9px;color:var(--dash-text-3);text-transform:uppercase;margin-bottom:2px">Net Reward</div>
                    <div style="font-size:12px;font-weight:700;color:var(--dash-green)">${j(i).toFixed(4)} <span style="font-size:9px;color:var(--dash-text-3)">BKC</span></div>
                </div>
                ${y>0n?`
                <div style="flex:1;background:var(--dash-surface-2);border-radius:8px;padding:6px 8px;text-align:center">
                    <div style="font-size:9px;color:var(--dash-text-3);text-transform:uppercase;margin-bottom:2px">NFT Bonus</div>
                    <div style="font-size:12px;font-weight:700;color:#34d399">+${j(y).toFixed(2)} <span style="font-size:9px;color:var(--dash-text-3)">BKC</span></div>
                </div>`:""}
            </div>`:""}
            ${o<100?`
            <p style="font-size:9px;color:var(--dash-accent);margin:6px 0 0;text-align:center"><i class="fa-solid fa-arrow-up" style="margin-right:2px"></i>Upgrade to Diamond for 100%</p>`:""}
        </div>
    `}async function Zo(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("activity-title");try{if(u.isConnected){if(O.activities.length===0){e&&(e.innerHTML='<div class="dash-loading"><img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt=""><span class="dash-loading-text">Loading your activity...</span></div>');const a=await fetch(`${ca.getHistory}/${u.userAddress}`);a.ok&&(O.activities=await a.json())}if(O.activities.length>0){t&&(t.textContent="Your Activity"),Ci();return}}t&&(t.textContent="Network Activity"),await Jl()}catch(a){console.error("Activity fetch error:",a),t&&(t.textContent="Network Activity"),await Jl()}}async function Jl(){const e=document.getElementById("dash-activity-list");if(!e||O.isLoadingNetworkActivity)return;const t=Date.now()-O.networkActivitiesTimestamp;if(O.networkActivities.length>0&&t<3e5){Zl();return}O.isLoadingNetworkActivity=!0,e.innerHTML='<div class="dash-loading"><img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt=""><span class="dash-loading-text">Loading network activity...</span></div>';try{const a=await fetch(`${B0}?limit=30`);if(a.ok){const n=await a.json();O.networkActivities=Array.isArray(n)?n:n.activities||[],O.networkActivitiesTimestamp=Date.now()}else O.networkActivities=[]}catch{O.networkActivities=[]}finally{O.isLoadingNetworkActivity=!1}Zl()}function Zl(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("dash-pagination-controls");if(!e)return;if(O.networkActivities.length===0){e.innerHTML=`
            <div style="text-align:center;padding:32px 16px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(245,158,11,0.08);border:1px dashed rgba(245,158,11,0.2);display:flex;align-items:center;justify-content:center;margin:0 auto 12px">
                    <i class="fa-solid fa-bolt" style="font-size:18px;color:rgba(245,158,11,0.3)"></i>
                </div>
                <p style="font-size:12px;color:var(--dash-text-3);margin:0 0 4px">No network activity yet</p>
                <p style="font-size:10px;color:var(--dash-text-3);margin:0">Be the first to stake, trade or play!</p>
            </div>`,t&&(t.style.display="none");return}const a=document.getElementById("activity-count");a&&(a.style.display="inline",a.textContent=O.networkActivities.length),e.innerHTML=O.networkActivities.slice(0,15).map(n=>ig(n,!0)).join(""),t&&(t.style.display="none")}function Ci(){let e=[...O.activities];const t=O.filters.type,a=n=>(n||"").toUpperCase();t!=="ALL"&&(e=e.filter(n=>{const o=a(n.type);return t==="STAKE"?o.includes("DELEGATION")||o.includes("DELEGAT")||o.includes("STAKE")||o.includes("UNSTAKE"):t==="CLAIM"?o.includes("REWARD")||o.includes("CLAIM"):t==="NFT"?o.includes("BOOSTER")||o.includes("RENT")||o.includes("NFT")||o.includes("TRANSFER"):t==="GAME"?o.includes("FORTUNE")||o.includes("GAME")||o.includes("REQUEST")||o.includes("RESULT")||o.includes("FULFILLED"):t==="CHARITY"?o.includes("CHARITY")||o.includes("CAMPAIGN")||o.includes("DONATION")||o.includes("DONATE"):t==="NOTARY"?o.includes("NOTARY")||o.includes("NOTARIZED")||o.includes("DOCUMENT"):t==="BACKCHAT"?o.includes("POST")||o.includes("LIKE")||o.includes("REPLY")||o.includes("REPOST")||o.includes("FOLLOW")||o.includes("PROFILE")||o.includes("BOOST")||o.includes("BADGE")||o.includes("TIP")||o.includes("BACKCHAT"):t==="FAUCET"?o.includes("FAUCET"):!0})),e.sort((n,o)=>{const s=i=>i.timestamp&&i.timestamp._seconds?i.timestamp._seconds:i.createdAt&&i.createdAt._seconds?i.createdAt._seconds:i.timestamp?new Date(i.timestamp).getTime()/1e3:0;return O.filters.sort==="NEWEST"?s(o)-s(n):s(n)-s(o)}),O.filteredActivities=e,O.pagination.currentPage=1,Bi()}function Bi(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("dash-pagination-controls");if(!e)return;if(O.filteredActivities.length===0){const s=O.filters.type!=="ALL";e.innerHTML=`
            <div style="text-align:center;padding:32px 16px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(167,139,250,0.08);border:1px dashed rgba(167,139,250,0.2);display:flex;align-items:center;justify-content:center;margin:0 auto 12px">
                    <i class="fa-solid ${s?"fa-filter":"fa-rocket"}" style="font-size:18px;color:rgba(167,139,250,0.3)"></i>
                </div>
                <p style="font-size:12px;color:var(--dash-text-3);margin:0 0 4px">${s?"No matching activity":"No activity yet"}</p>
                <p style="font-size:10px;color:var(--dash-text-3);margin:0">${s?"Try a different filter":"Start staking, trading or playing!"}</p>
            </div>`,t&&(t.style.display="none");const i=document.getElementById("activity-count");i&&(i.style.display="none");return}const a=document.getElementById("activity-count");a&&(a.style.display="inline",a.textContent=O.filteredActivities.length);const n=(O.pagination.currentPage-1)*O.pagination.itemsPerPage,o=O.filteredActivities.slice(n,n+O.pagination.itemsPerPage);if(e.innerHTML=o.map(s=>ig(s,!1)).join(""),t){const s=Math.ceil(O.filteredActivities.length/O.pagination.itemsPerPage);s>1?(t.style.display="flex",document.getElementById("page-indicator").innerText=`${O.pagination.currentPage}/${s}`,document.getElementById("page-prev").disabled=O.pagination.currentPage===1,document.getElementById("page-next").disabled=O.pagination.currentPage>=s):t.style.display="none"}}function ig(e,t=!1){const a=I0(e.timestamp||e.createdAt),n=P0(e.timestamp||e.createdAt),o=e.user||e.userAddress||e.from||"",s=ng(o),i=N0(e.type,e.details);let r="";const l=(e.type||"").toUpperCase().trim(),c=e.details||{};if(l.includes("GAME")||l.includes("FORTUNE")||l.includes("REQUEST")||l.includes("FULFILLED")||l.includes("RESULT")){const w=c.rolls||e.rolls||[],y=c.guesses||e.guesses||[],k=c.isWin||c.prizeWon&&BigInt(c.prizeWon||0)>0n,v=c.isCumulative!==void 0?c.isCumulative:y.length>1,T=v?"Combo":"Jackpot",I=v?"background:rgba(168,85,247,0.15);color:#c084fc":"background:rgba(245,158,11,0.15);color:#fbbf24",N=c.wagerAmount||c.amount,S=c.prizeWon,$=N?j(BigInt(N)).toFixed(0):"0";let F='<span style="color:var(--dash-text-3)">No win</span>';k&&S&&BigInt(S)>0n&&(F=`<span style="color:var(--dash-green);font-weight:700">+${j(BigInt(S)).toFixed(0)} BKC</span>`);let V="";return w.length>0&&(V=`<div style="display:flex;gap:3px">${w.map((re,le)=>{const se=y[le],ke=se!==void 0&&Number(se)===Number(re);return`<div style="width:24px;height:24px;border-radius:4px;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid ${ke?"rgba(52,211,153,0.4)":"var(--dash-border)"};background:${ke?"rgba(52,211,153,0.1)":"var(--dash-surface-2)"};color:${ke?"#34d399":"var(--dash-text-3)"}">${re}</div>`}).join("")}</div>`),`
            <a href="${e.txHash?`${ql}${e.txHash}`:"#"}" target="_blank" class="dash-fortune-item" title="${n}">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
                    <div style="display:flex;align-items:center;gap:8px">
                        <div style="width:28px;height:28px;border-radius:6px;background:var(--dash-surface-3);display:flex;align-items:center;justify-content:center"><i class="fa-solid fa-dice" style="color:var(--dash-text-3);font-size:11px"></i></div>
                        <span style="color:var(--dash-text);font-size:12px;font-weight:600">${t?s:"You"}</span>
                        <span style="font-size:9px;font-weight:700;${I};padding:1px 6px;border-radius:4px">${T}</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--dash-text-3)">
                        <span>${a}</span>
                        <i class="fa-solid fa-external-link dash-activity-item-link"></i>
                    </div>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between">
                    <div style="font-size:11px"><span style="color:var(--dash-text-3)">Bet: ${$}</span><span style="margin:0 6px;color:var(--dash-text-3)">â†’</span>${F}</div>
                    ${V}
                </div>
            </a>
        `}if(l.includes("NOTARY")){const w=c.ipfsCid;w&&(r=`<span style="margin-left:4px;font-size:9px;color:#818cf8;font-family:monospace">${w.replace("ipfs://","").slice(0,12)}...</span>`)}if(l.includes("STAKING")||l.includes("DELEGAT")){const w=c.pStakeGenerated;w&&(r=`<span style="font-size:10px;color:var(--dash-purple)">+${j(BigInt(w)).toFixed(0)} pStake</span>`)}if(l.includes("DONATION")||l.includes("CHARITY")){const w=c.netAmount||c.amount,y=c.campaignId;w&&BigInt(w)>0n&&(r=`<span style="color:#ec4899;font-weight:700">${j(BigInt(w)).toFixed(2)} BKC</span>`,y&&(r+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">Campaign #${y}</span>`))}if(l.includes("CLAIM")||l.includes("REWARD")){const w=c.amount||e.amount;w&&(r=`<span style="color:var(--dash-accent);font-weight:700">+${j(BigInt(w)).toFixed(2)} BKC</span>`);const y=c.feePaid;y&&BigInt(y)>0n&&(r+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">(fee: ${j(BigInt(y)).toFixed(2)})</span>`)}const f=l.includes("PROMOT")||l.includes("ADS")||l.includes("ADVERTIS");if(f){const w=c.promotionFee||c.amount||e.amount;w&&BigInt(w)>0n&&(r=`<span style="color:#fbbf24;font-weight:700">${parseFloat(zt.formatEther(BigInt(w))).toFixed(4)} ETH</span>`);const y=c.tokenId||e.tokenId;y&&(r+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">NFT #${y}</span>`)}const g=e.txHash?`${ql}${e.txHash}`:"#";let m="";if(f){const w=c.promotionFee||c.amount||e.amount;w&&BigInt(w)>0n&&(m=parseFloat(zt.formatEther(BigInt(w))).toFixed(4))}else{let w=e.amount||c.netAmount||c.amount||c.wagerAmount||c.prizeWon||"0";const y=j(BigInt(w));m=y>.001?y.toFixed(2):""}const h=f?"ETH":"BKC";return`
        <a href="${g}" target="_blank" class="dash-activity-item" title="${n}">
            <div class="dash-activity-item-icon" style="background:${i.bg};border:1px solid transparent">
                <i class="fa-solid ${i.icon}" style="color:${i.color}"></i>
            </div>
            <div class="dash-activity-item-info">
                <div class="dash-activity-item-label">${i.label}${r?` ${r}`:""}</div>
                <div class="dash-activity-item-meta">${t?s+" Â· ":""}${a}</div>
            </div>
            <div style="display:flex;align-items:center;gap:6px">
                ${m?`<div class="dash-activity-item-amount">${m} <span class="unit">${h}</span></div>`:""}
                <i class="fa-solid fa-arrow-up-right-from-square dash-activity-item-link"></i>
            </div>
        </a>
    `}function K0(){ht.dashboard&&ht.dashboard.addEventListener("click",async e=>{const t=e.target;if(t.closest("#manual-refresh-btn")){const s=t.closest("#manual-refresh-btn");s.disabled=!0,s.innerHTML='<i class="fa-solid fa-rotate fa-spin"></i>',await dn(!0),await Ti(),O.activities=[],O.networkActivities=[],O.networkActivitiesTimestamp=0,O.faucet.lastCheck=0,await Zo(),setTimeout(()=>{s.innerHTML='<i class="fa-solid fa-rotate"></i>',s.disabled=!1},1e3)}if(t.closest("#faucet-action-btn")){const s=t.closest("#faucet-action-btn");s.disabled||await Xl(s)}if(t.closest("#emergency-faucet-btn")&&await Xl(t.closest("#emergency-faucet-btn")),t.closest("#dash-buyback-btn")){const s=t.closest("#dash-buyback-btn");s.disabled||await U0(s)}if(t.closest("#referral-copy-btn")&&S0(),t.closest("#referral-share-btn")&&L0(),t.closest(".delegate-link")&&(e.preventDefault(),window.navigateTo("staking")),t.closest(".go-to-store")&&(e.preventDefault(),window.navigateTo("store")),t.closest(".go-to-rental")&&(e.preventDefault(),window.navigateTo("rental")),t.closest(".go-to-fortune")&&(e.preventDefault(),window.navigateTo("fortune")),t.closest(".go-to-notary")&&(e.preventDefault(),window.navigateTo("notary")),t.closest(".go-to-charity")&&(e.preventDefault(),window.navigateTo("charity")),t.closest(".go-to-backchat")&&(e.preventDefault(),window.navigateTo("agora")),t.closest(".go-to-trade")&&(e.preventDefault(),window.navigateTo("trade")),t.closest("#open-booster-info")){const s=document.getElementById("booster-info-modal");s&&s.classList.add("visible")}if(t.closest("#close-booster-modal")||t.id==="booster-info-modal"){const s=document.getElementById("booster-info-modal");s&&s.classList.remove("visible")}if(t.closest("#close-gas-modal-dash")||t.id==="no-gas-modal-dash"){const s=document.getElementById("no-gas-modal-dash");s&&s.classList.remove("visible")}const a=t.closest(".nft-clickable-image");if(a){const s=a.dataset.tokenid,i=a.dataset.tier||"Booster";s&&Yc(s,i)}const n=t.closest("#dashboardClaimBtn");if(n&&!n.disabled)try{if(n.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>',n.disabled=!0,!await _0()){n.innerHTML='<i class="fa-solid fa-coins" style="margin-right:6px"></i> Claim Rewards',n.disabled=!1;return}const{stakingRewards:i,minerRewards:r}=await Ji();(i>0n||r>0n)&&await La.claimRewards({button:n,onSuccess:async()=>{x("Rewards claimed!","success"),await dn(!0),O.activities=[],Zo()},onError:l=>{l.cancelled||x("Claim failed","error")}})}catch{x("Claim failed","error")}finally{n.innerHTML='<i class="fa-solid fa-coins" style="margin-right:6px"></i> Claim Rewards',n.disabled=!1}if(t.closest("#page-prev")&&O.pagination.currentPage>1&&(O.pagination.currentPage--,Bi()),t.closest("#page-next")){const s=Math.ceil(O.filteredActivities.length/O.pagination.itemsPerPage);O.pagination.currentPage<s&&(O.pagination.currentPage++,Bi())}t.closest("#activity-sort-toggle")&&(O.filters.sort=O.filters.sort==="NEWEST"?"OLDEST":"NEWEST",Ci());const o=t.closest(".dash-chip");o&&(document.querySelectorAll(".dash-chip").forEach(s=>s.classList.remove("active")),o.classList.add("active"),O.filters.type=o.dataset.filter,Ci())})}const V0={async render(e){if(F0(),z0(),Ti(),Zo(),So(),u.isConnected&&u.userAddress){try{localStorage.getItem("bkc_faucet_"+u.userAddress.toLowerCase())&&(O.faucet.canClaim=!1)}catch{}Jo()}u.isConnected?await dn(!1):(setTimeout(async()=>{u.isConnected&&(await dn(!1),So())},500),setTimeout(async()=>{u.isConnected&&(await dn(!1),So())},1500))},update(e){const t=Date.now();t-O.lastUpdate>1e4&&(O.lastUpdate=t,Ti(),e&&(dn(!1),So()),Zo())}},mt=window.ethers,Y0="https://sepolia.etherscan.io/tx/",wt={NONE:{boost:0,recycleRate:50,keepRate:50,color:"#71717a",name:"None",icon:"â—‹",class:"stk-tier-none"},BRONZE:{boost:1e3,recycleRate:30,keepRate:70,color:"#cd7f32",name:"Bronze",icon:"ðŸ¥‰",class:"stk-tier-bronze"},SILVER:{boost:2500,recycleRate:20,keepRate:80,color:"#c0c0c0",name:"Silver",icon:"ðŸ¥ˆ",class:"stk-tier-silver"},GOLD:{boost:4e3,recycleRate:10,keepRate:90,color:"#ffd700",name:"Gold",icon:"ðŸ¥‡",class:"stk-tier-gold"},DIAMOND:{boost:5e3,recycleRate:0,keepRate:100,color:"#b9f2ff",name:"Diamond",icon:"ðŸ’Ž",class:"stk-tier-diamond"}};let na=!1,Ra=0,Ms=3650,Me=!1,io=[],Oo=0n,ka=null,Vn="ALL",Pt=0,Ai=50,Ql="none",he=null,Ii=0n,gn=null,Os=!1,Or=0n,Ur=0n,At=null,Uo=null,Ho=null,jo=0n;function rg(e){if(e<=0)return"Ready";const t=Math.floor(e/86400),a=Math.floor(e%86400/3600),n=Math.floor(e%3600/60);return t>365?`${Math.floor(t/365)}y ${Math.floor(t%365/30)}mo`:t>30?`${Math.floor(t/30)}mo ${t%30}d`:t>0?`${t}d ${a}h`:a>0?`${a}h ${n}m`:`${n}m`}function q0(e){if(e>=365){const t=Math.floor(e/365);return t===1?"1 Year":`${t} Years`}return e>=30?`${Math.floor(e/30)} Month(s)`:`${e} Day(s)`}function X0(e,t){if(e<=0n||t<=0n)return 0n;const a=t/86400n,n=10000n,o=n+a*5918n/365n;return e*o/n}function J0(e){if(!e)return"Recent";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Recent"}}function Jn(e){const t=Number(e);return t>=5e3?wt.DIAMOND:t>=4e3?wt.GOLD:t>=2500?wt.SILVER:t>=1e3?wt.BRONZE:wt.NONE}function Z0(){if(document.getElementById("stk-styles-v10"))return;const e=document.createElement("style");e.id="stk-styles-v10",e.textContent=`
        .stk-shell {
            --stk-bg: #0c0c0e;
            --stk-surface: #141417;
            --stk-surface-2: #1c1c21;
            --stk-surface-3: #222228;
            --stk-border: rgba(255,255,255,0.06);
            --stk-border-h: rgba(255,255,255,0.12);
            --stk-text: #f0f0f2;
            --stk-text-2: #a0a0ab;
            --stk-text-3: #5c5c68;
            --stk-accent: #f59e0b;
            --stk-green: #4ade80;
            --stk-purple: #a78bfa;
            --stk-cyan: #22d3ee;
            --stk-red: #ef4444;
            --stk-radius: 16px;
            --stk-radius-sm: 10px;
            --stk-tr: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes stk-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes stk-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes stk-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes stk-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes stk-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }

        .stk-shell { max-width: 960px; margin: 0 auto; padding: 0 16px 40px; animation: stk-fadeIn 0.4s ease-out; }

        /* â”€â”€ Header â”€â”€ */
        .stk-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .stk-header-left { display: flex; align-items: center; gap: 14px; }
        .stk-header-icon {
            width: 48px; height: 48px; border-radius: var(--stk-radius);
            background: linear-gradient(135deg, rgba(167,139,250,0.15), rgba(139,92,246,0.1));
            border: 1px solid rgba(167,139,250,0.2);
            display: flex; align-items: center; justify-content: center;
            animation: stk-float 4s ease-in-out infinite;
        }
        .stk-header-icon i { font-size: 20px; color: var(--stk-purple); }
        .stk-header-title { font-size: 20px; font-weight: 800; color: var(--stk-text); }
        .stk-header-sub { font-size: 11px; color: var(--stk-text-3); }
        .stk-refresh-btn {
            width: 40px; height: 40px; border-radius: var(--stk-radius-sm);
            background: var(--stk-surface); border: 1px solid var(--stk-border);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all var(--stk-tr); color: var(--stk-text-3);
        }
        .stk-refresh-btn:hover { color: var(--stk-text); border-color: var(--stk-border-h); }

        /* â”€â”€ Hero Card â”€â”€ */
        .stk-hero {
            position: relative; overflow: hidden;
            background: linear-gradient(135deg, rgba(20,20,23,0.95), rgba(12,12,14,0.98));
            border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius);
            padding: 28px 24px;
            margin-bottom: 14px;
            animation: stk-scaleIn 0.5s ease-out;
        }
        .stk-hero::before {
            content: '';
            position: absolute; top: -50%; right: -20%;
            width: 400px; height: 400px;
            background: radial-gradient(circle, rgba(74,222,128,0.05) 0%, transparent 70%);
            pointer-events: none; animation: stk-glow 4s ease-in-out infinite;
        }
        .stk-hero::after {
            content: '';
            position: absolute; inset: 0;
            border-radius: var(--stk-radius); padding: 1px;
            background: linear-gradient(135deg, rgba(74,222,128,0.2), rgba(167,139,250,0.15), rgba(245,158,11,0.1));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude; -webkit-mask-composite: xor;
            pointer-events: none; opacity: 0.5;
        }
        .stk-hero-inner { display: flex; gap: 24px; position: relative; z-index: 1; }
        .stk-hero-left { flex: 1.2; min-width: 0; }
        .stk-hero-right { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }

        .stk-hero-label { font-size: 11px; color: var(--stk-text-3); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 4px; }
        .stk-reward-value {
            font-size: clamp(28px, 5vw, 40px); font-weight: 800;
            color: var(--stk-green); font-variant-numeric: tabular-nums;
            line-height: 1.1; text-shadow: 0 0 30px rgba(74,222,128,0.2);
        }
        .stk-reward-suffix { font-size: 14px; color: rgba(74,222,128,0.6); font-weight: 600; }

        .stk-claim-btn {
            display: inline-flex; align-items: center; gap: 8px;
            margin-top: 16px; padding: 10px 24px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white; font-weight: 700; font-size: 14px;
            border-radius: var(--stk-radius-sm); border: none; cursor: pointer;
            transition: all var(--stk-tr); box-shadow: 0 4px 20px rgba(34,197,94,0.25);
        }
        .stk-claim-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(34,197,94,0.35); }
        #stk-compound-btn:hover:not(:disabled) { box-shadow: 0 6px 28px rgba(124,58,237,0.4) !important; }
        .stk-claim-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
        .stk-claim-btn:not(:disabled) {
            background-size: 200% 100%;
            background-image: linear-gradient(90deg, #22c55e 0%, #34d399 25%, #22c55e 50%, #10b981 100%);
            animation: stk-shimmer 3s linear infinite;
        }
        .stk-eth-fee { font-size: 10px; color: var(--stk-text-3); margin-top: 6px; }

        .stk-breakdown { margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--stk-border); }
        .stk-breakdown-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; padding: 3px 0; }
        .stk-breakdown-label { color: var(--stk-text-3); display: flex; align-items: center; gap: 4px; }
        .stk-breakdown-val { font-weight: 700; font-family: 'SF Mono', monospace; }

        /* â”€â”€ NFT Boost Panel â”€â”€ */
        .stk-boost-panel {
            background: var(--stk-surface-2); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius-sm); padding: 16px;
        }
        .stk-tier-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 12px; border-radius: 20px;
            font-weight: 700; font-size: 12px; border: 1px solid;
        }
        .stk-tier-none { background: rgba(113,113,122,0.1); border-color: rgba(113,113,122,0.2); color: #a1a1aa; }
        .stk-tier-bronze { background: rgba(205,127,50,0.1); border-color: rgba(205,127,50,0.3); color: #cd7f32; }
        .stk-tier-silver { background: rgba(192,192,192,0.1); border-color: rgba(192,192,192,0.3); color: #e5e5e5; }
        .stk-tier-gold { background: rgba(255,215,0,0.1); border-color: rgba(255,215,0,0.3); color: #ffd700; }
        .stk-tier-diamond { background: rgba(185,242,255,0.1); border-color: rgba(185,242,255,0.3); color: #b9f2ff; }

        .stk-burn-bar { height: 8px; background: rgba(239,68,68,0.15); border-radius: 4px; overflow: hidden; position: relative; margin: 10px 0 6px; }
        .stk-burn-fill { position: absolute; left: 0; top: 0; height: 100%; background: linear-gradient(90deg, #ef4444, #f87171); border-radius: 4px; transition: width 0.5s ease; }
        .stk-keep-fill { position: absolute; right: 0; top: 0; height: 100%; background: linear-gradient(90deg, #22c55e, #4ade80); border-radius: 4px; transition: width 0.5s ease; }

        .stk-boost-cta {
            display: inline-flex; align-items: center; gap: 6px;
            margin-top: 10px; padding: 7px 14px; font-size: 11px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--stk-tr); color: #000;
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .stk-boost-cta:hover { filter: brightness(1.1); transform: translateY(-1px); }

        /* â”€â”€ Stats Row â”€â”€ */
        .stk-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 14px; }
        .stk-stat {
            display: flex; flex-direction: column; gap: 2px;
            padding: 10px 12px; background: var(--stk-surface);
            border: 1px solid var(--stk-border); border-radius: var(--stk-radius-sm);
            transition: border-color var(--stk-tr);
        }
        .stk-stat:hover { border-color: var(--stk-border-h); }
        .stk-stat-label { font-size: 9px; color: var(--stk-text-3); text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .stk-stat-label i { font-size: 9px; }
        .stk-stat-value { font-size: 14px; font-weight: 700; color: var(--stk-text); font-variant-numeric: tabular-nums; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* â”€â”€ Card Base â”€â”€ */
        .stk-card {
            background: var(--stk-surface); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius); padding: 18px;
            margin-bottom: 14px; animation: stk-fadeIn 0.5s ease-out both;
        }
        .stk-card-title { font-size: 14px; font-weight: 700; color: var(--stk-text); margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
        .stk-card-title i { color: var(--stk-text-3); font-size: 12px; }

        /* â”€â”€ Stake Form â”€â”€ */
        .stk-input-wrap { position: relative; margin-bottom: 12px; }
        .stk-amount-input {
            width: 100%; padding: 14px 70px 14px 16px;
            background: var(--stk-surface-2); border: 1px solid var(--stk-border-h);
            border-radius: var(--stk-radius-sm); color: var(--stk-text);
            font-size: 20px; font-weight: 700; font-family: 'SF Mono', 'JetBrains Mono', monospace;
            outline: none; transition: border-color var(--stk-tr);
        }
        .stk-amount-input::placeholder { color: var(--stk-text-3); font-weight: 400; }
        .stk-amount-input:focus { border-color: rgba(167,139,250,0.4); }
        .stk-amount-input.error { border-color: rgba(239,68,68,0.5); }
        .stk-max-btn {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            padding: 4px 10px; font-size: 10px; font-weight: 800;
            background: rgba(167,139,250,0.15); color: var(--stk-purple);
            border: 1px solid rgba(167,139,250,0.3); border-radius: 6px;
            cursor: pointer; transition: all var(--stk-tr);
        }
        .stk-max-btn:hover { background: rgba(167,139,250,0.25); }
        .stk-balance-row { display: flex; justify-content: space-between; align-items: center; font-size: 11px; color: var(--stk-text-3); margin-bottom: 14px; }

        /* Duration Chips */
        .stk-duration-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 14px; }
        .stk-duration-chip {
            padding: 10px 8px; text-align: center;
            background: var(--stk-surface-2); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius-sm); cursor: pointer;
            transition: all var(--stk-tr); position: relative;
        }
        .stk-duration-chip:hover { border-color: var(--stk-border-h); }
        .stk-duration-chip.selected {
            background: linear-gradient(135deg, rgba(167,139,250,0.12), rgba(139,92,246,0.08));
            border-color: rgba(167,139,250,0.4);
            box-shadow: 0 0 16px rgba(167,139,250,0.1);
        }
        .stk-duration-chip .stk-chip-label { font-size: 14px; font-weight: 700; color: var(--stk-text); }
        .stk-duration-chip .stk-chip-sub { font-size: 9px; color: var(--stk-text-3); margin-top: 2px; }
        .stk-duration-chip.selected .stk-chip-label { color: var(--stk-purple); }
        .stk-duration-chip.recommended::after {
            content: '\\2605'; position: absolute; top: -6px; right: -4px;
            width: 16px; height: 16px; font-size: 9px; line-height: 16px; text-align: center;
            background: linear-gradient(135deg, #f59e0b, #d97706); color: #000;
            border-radius: 50%;
        }

        .stk-preview-row { display: flex; justify-content: space-between; align-items: center; font-size: 12px; padding: 6px 0; }
        .stk-preview-label { color: var(--stk-text-3); }
        .stk-preview-val { color: var(--stk-text); font-weight: 700; font-family: 'SF Mono', monospace; }

        .stk-delegate-btn {
            width: 100%; padding: 12px; margin-top: 14px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white; font-weight: 700; font-size: 14px;
            border-radius: var(--stk-radius-sm); border: none; cursor: pointer;
            transition: all var(--stk-tr); box-shadow: 0 4px 20px rgba(139,92,246,0.2);
        }
        .stk-delegate-btn:hover:not(:disabled) { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 6px 28px rgba(139,92,246,0.3); }
        .stk-delegate-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }

        /* â”€â”€ Delegations â”€â”€ */
        .stk-deleg-list { display: flex; flex-direction: column; gap: 6px; max-height: 350px; overflow-y: auto; }
        .stk-deleg-list::-webkit-scrollbar { width: 4px; }
        .stk-deleg-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
        .stk-deleg-item {
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
            padding: 10px 12px; background: var(--stk-surface-2);
            border: 1px solid transparent; border-radius: 8px;
            transition: all var(--stk-tr);
        }
        .stk-deleg-item:hover { background: var(--stk-surface-3); border-color: var(--stk-border-h); transform: translateX(3px); }
        .stk-deleg-icon {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .stk-deleg-info { flex: 1; min-width: 0; }
        .stk-deleg-amount { font-size: 13px; font-weight: 700; color: var(--stk-text); }
        .stk-deleg-meta { font-size: 10px; color: var(--stk-text-3); margin-top: 1px; display: flex; align-items: center; gap: 6px; }
        .stk-countdown { font-size: 11px; font-weight: 700; color: #fbbf24; font-family: 'SF Mono', monospace; }
        .stk-unstake-btn {
            padding: 5px 10px; font-size: 10px; font-weight: 700;
            border-radius: 6px; cursor: pointer; transition: all var(--stk-tr); border: none;
        }
        .stk-unstake-ready { background: rgba(255,255,255,0.1); color: var(--stk-text); }
        .stk-unstake-ready:hover { background: rgba(255,255,255,0.2); }
        .stk-unstake-force { background: rgba(239,68,68,0.1); color: var(--stk-red); }
        .stk-unstake-force:hover { background: rgba(239,68,68,0.2); }

        /* â”€â”€ History â”€â”€ */
        .stk-tabs { display: flex; gap: 6px; margin-bottom: 12px; }
        .stk-tab {
            padding: 4px 10px; font-size: 10px; font-weight: 600;
            color: var(--stk-text-3); background: var(--stk-surface-2);
            border: 1px solid var(--stk-border); border-radius: 20px;
            cursor: pointer; transition: all var(--stk-tr); white-space: nowrap;
        }
        .stk-tab:hover { color: var(--stk-text-2); border-color: var(--stk-border-h); }
        .stk-tab.active { color: var(--stk-purple); background: rgba(167,139,250,0.1); border-color: rgba(167,139,250,0.3); }

        .stk-history-list { display: flex; flex-direction: column; gap: 4px; max-height: 400px; overflow-y: auto; }
        .stk-history-list::-webkit-scrollbar { width: 4px; }
        .stk-history-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
        .stk-history-item {
            display: flex; align-items: center; justify-content: space-between; gap: 10px;
            padding: 8px 10px; background: var(--stk-surface-2);
            border: 1px solid transparent; border-radius: 8px;
            transition: all var(--stk-tr); text-decoration: none;
        }
        .stk-history-item:hover { background: var(--stk-surface-3); border-color: var(--stk-border-h); }
        .stk-history-icon {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 12px;
        }
        .stk-history-info { flex: 1; min-width: 0; }
        .stk-history-label { font-size: 12px; font-weight: 600; color: var(--stk-text); display: flex; align-items: center; gap: 6px; }
        .stk-history-date { font-size: 10px; color: var(--stk-text-3); margin-top: 1px; }
        .stk-history-amount { font-size: 12px; font-weight: 600; color: var(--stk-text); font-family: 'SF Mono', monospace; text-align: right; white-space: nowrap; }
        .stk-history-link { font-size: 9px; color: var(--stk-text-3); transition: color var(--stk-tr); }
        .stk-history-item:hover .stk-history-link { color: var(--stk-purple); }

        /* â”€â”€ Empty / Loading â”€â”€ */
        .stk-empty { text-align: center; padding: 32px 16px; }
        .stk-empty i { font-size: 24px; color: var(--stk-text-3); margin-bottom: 8px; display: block; }
        .stk-empty p { font-size: 12px; color: var(--stk-text-3); }
        .stk-loading { display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 32px; }
        .stk-loading-icon { width: 36px; height: 36px; opacity: 0.3; animation: stk-float 2s ease-in-out infinite; }

        /* â”€â”€ Not Connected â”€â”€ */
        .stk-connect-card {
            text-align: center; padding: 48px 24px;
            background: var(--stk-surface); border: 1px solid var(--stk-border);
            border-radius: var(--stk-radius);
        }
        .stk-connect-btn {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 10px 24px; margin-top: 16px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white; font-weight: 700; font-size: 14px;
            border-radius: var(--stk-radius-sm); border: none; cursor: pointer;
            transition: all var(--stk-tr);
        }
        .stk-connect-btn:hover { filter: brightness(1.1); }

        /* â”€â”€ Buyback Card â”€â”€ */
        .stk-buyback {
            position: relative;
            padding: 16px 18px;
            background: linear-gradient(135deg, rgba(249,115,22,0.06), rgba(234,88,12,0.03));
            border: 1px solid rgba(249,115,22,0.18);
            border-radius: var(--stk-radius);
            margin-bottom: 14px;
            overflow: hidden;
            animation: stk-fadeIn 0.5s ease-out both;
        }
        .stk-buyback::before {
            content: '';
            position: absolute;
            top: -50%; right: -10%;
            width: 200px; height: 200px;
            background: radial-gradient(circle, rgba(249,115,22,0.06) 0%, transparent 70%);
            pointer-events: none;
            animation: stk-glow 5s ease-in-out infinite;
        }
        .stk-buyback-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 12px; position: relative; z-index: 1;
        }
        .stk-buyback-title {
            display: flex; align-items: center; gap: 8px;
            font-size: 13px; font-weight: 700; color: var(--stk-text);
        }
        .stk-buyback-title i { color: #f97316; font-size: 14px; }
        .stk-buyback-badge {
            font-size: 10px; font-weight: 700; padding: 3px 10px;
            border-radius: 20px; background: rgba(249,115,22,0.12);
            color: #f97316; border: 1px solid rgba(249,115,22,0.2);
        }
        .stk-buyback-grid {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 8px; margin-bottom: 12px; position: relative; z-index: 1;
        }
        .stk-buyback-metric {
            padding: 8px 10px; background: var(--stk-surface);
            border: 1px solid var(--stk-border); border-radius: var(--stk-radius-sm);
        }
        .stk-buyback-metric-label {
            font-size: 9px; color: var(--stk-text-3); text-transform: uppercase;
            letter-spacing: 0.08em; font-weight: 700; margin-bottom: 2px;
        }
        .stk-buyback-metric-value {
            font-size: 13px; font-weight: 700; color: var(--stk-text);
            font-variant-numeric: tabular-nums;
        }
        .stk-buyback-footer {
            display: flex; align-items: center; justify-content: space-between;
            gap: 12px; position: relative; z-index: 1;
        }
        .stk-buyback-info {
            font-size: 10px; color: var(--stk-text-3); flex: 1;
        }
        .stk-buyback-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 10px 20px; font-size: 12px; font-weight: 700;
            color: #000; background: linear-gradient(135deg, #f97316, #ea580c);
            border: none; border-radius: var(--stk-radius-sm); cursor: pointer;
            transition: all var(--stk-tr); white-space: nowrap;
        }
        .stk-buyback-btn:hover:not(:disabled) { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 6px 24px rgba(249,115,22,0.3); }
        .stk-buyback-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
        .stk-buyback-empty {
            text-align: center; padding: 8px 0; font-size: 11px; color: var(--stk-text-3);
            position: relative; z-index: 1;
        }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 640px) {
            .stk-shell { padding: 0 10px 30px; }
            .stk-hero { padding: 20px 16px; }
            .stk-hero-inner { flex-direction: column; gap: 16px; }
            .stk-hero-right { border-top: 1px solid var(--stk-border); padding-top: 16px; }
            .stk-stats { grid-template-columns: repeat(2, 1fr); }
            .stk-buyback-grid { grid-template-columns: 1fr 1fr; }
            .stk-buyback-footer { flex-direction: column; text-align: center; }
            .stk-buyback-btn { width: 100%; justify-content: center; }
            .stk-reward-value { font-size: 28px; }
            .stk-duration-grid { grid-template-columns: repeat(2, 1fr); }
            .stk-tabs { flex-wrap: nowrap; overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
            .stk-tabs::-webkit-scrollbar { display: none; }
        }
    `,document.head.appendChild(e)}function Q0(){const e=document.getElementById("staking");e&&(Z0(),e.innerHTML=`
        <div class="stk-shell">

            <!-- HEADER -->
            <div class="stk-header">
                <div class="stk-header-left">
                    <div class="stk-header-icon"><i class="fa-solid fa-layer-group"></i></div>
                    <div>
                        <div class="stk-header-title">Stake & Earn</div>
                        <div class="stk-header-sub">Delegate BKC, earn rewards. NFT + Tutor = keep more</div>
                    </div>
                </div>
                <button id="stk-refresh-btn" class="stk-refresh-btn"><i class="fa-solid fa-rotate"></i></button>
            </div>

            <!-- HERO REWARDS -->
            <div class="stk-hero">
                <div class="stk-hero-inner">
                    <div class="stk-hero-left">
                        <div class="stk-hero-label">You Will Receive</div>
                        <div id="stk-reward-value" class="stk-reward-value">-- <span class="stk-reward-suffix">BKC</span></div>

                        <div id="stk-breakdown" class="stk-breakdown" style="display:none">
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-layer-group" style="color:var(--stk-purple)"></i> Staking</span>
                                <span id="stk-break-staking" class="stk-breakdown-val" style="color:var(--stk-text)">0</span>
                            </div>
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-coins" style="color:var(--stk-accent)"></i> Mining</span>
                                <span id="stk-break-mining" class="stk-breakdown-val" style="color:var(--stk-text)">0</span>
                            </div>
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-recycle" style="color:#22d3ee"></i> Recycled</span>
                                <span id="stk-break-recycled" class="stk-breakdown-val" style="color:#22d3ee">0</span>
                            </div>
                            <div id="stk-break-tutor-row" class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-graduation-cap" style="color:var(--stk-accent)"></i> <span id="stk-break-tutor-label">Tutor</span></span>
                                <span id="stk-break-tutor" class="stk-breakdown-val" style="color:var(--stk-accent)">0</span>
                            </div>
                            <div class="stk-breakdown-row">
                                <span class="stk-breakdown-label"><i class="fa-solid fa-fire" style="color:var(--stk-red)"></i> Burned</span>
                                <span id="stk-break-burned" class="stk-breakdown-val" style="color:var(--stk-red)">0</span>
                            </div>
                        </div>

                        <div style="display:flex;gap:8px;flex-wrap:wrap">
                            <button id="stk-claim-btn" class="stk-claim-btn" style="flex:1" disabled>
                                <i class="fa-solid fa-hand-holding-dollar"></i> <span>Claim Rewards</span>
                            </button>
                            <button id="stk-compound-btn" class="stk-claim-btn" style="flex:1;background:linear-gradient(135deg,#7c3aed,#6d28d9);box-shadow:0 4px 20px rgba(124,58,237,0.3)" disabled>
                                <i class="fa-solid fa-arrows-spin"></i> <span>Compound</span>
                            </button>
                        </div>
                        <div id="stk-eth-fee" class="stk-eth-fee"></div>
                    </div>

                    <div class="stk-hero-right">
                        <div id="stk-boost-panel">
                            <div style="text-align:center">
                                <img src="./assets/bkc_logo_3d.png" style="width:32px;height:32px;opacity:0.3;animation:stk-float 2s infinite" alt="">
                                <p style="font-size:11px;color:var(--stk-text-3);margin-top:8px">Loading boost...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BUYBACK CARD -->
            <div id="stk-buyback-card" class="stk-buyback" style="display:none">
                <div class="stk-buyback-header">
                    <div class="stk-buyback-title">
                        <i class="fa-solid fa-hammer"></i> Buyback Available
                    </div>
                    <span id="stk-buyback-badge" class="stk-buyback-badge">5% Reward</span>
                </div>
                <div class="stk-buyback-grid">
                    <div class="stk-buyback-metric">
                        <div class="stk-buyback-metric-label">Pending BNB</div>
                        <div id="stk-buyback-pending" class="stk-buyback-metric-value" style="color:#f97316">--</div>
                    </div>
                    <div class="stk-buyback-metric">
                        <div class="stk-buyback-metric-label">Your Reward (5%)</div>
                        <div id="stk-buyback-reward" class="stk-buyback-metric-value" style="color:var(--stk-green)">--</div>
                    </div>
                    <div class="stk-buyback-metric">
                        <div class="stk-buyback-metric-label">BKC to Stakers</div>
                        <div id="stk-buyback-stakers" class="stk-buyback-metric-value" style="color:var(--stk-cyan)">--</div>
                    </div>
                    <div class="stk-buyback-metric">
                        <div class="stk-buyback-metric-label">Mining Rate</div>
                        <div id="stk-buyback-rate" class="stk-buyback-metric-value" style="color:var(--stk-purple)">--</div>
                    </div>
                </div>
                <div class="stk-buyback-footer">
                    <div class="stk-buyback-info" id="stk-buyback-info">
                        Execute buyback to earn 5% of pending BNB. Remaining converts to BKC staker rewards.
                    </div>
                    <button id="stk-buyback-btn" class="stk-buyback-btn" disabled>
                        <i class="fa-solid fa-hammer"></i> Execute Buyback
                    </button>
                </div>
            </div>

            <!-- STATS ROW -->
            <div class="stk-stats">
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-globe" style="color:var(--stk-purple)"></i> Network pStake</div>
                    <div id="stk-stat-network" class="stk-stat-value">--</div>
                </div>
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-bolt" style="color:var(--stk-cyan)"></i> Your Power</div>
                    <div id="stk-stat-power" class="stk-stat-value">--</div>
                </div>
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-gift" style="color:var(--stk-green)"></i> Pending</div>
                    <div id="stk-stat-rewards" class="stk-stat-value">--</div>
                </div>
                <div class="stk-stat">
                    <div class="stk-stat-label"><i class="fa-solid fa-lock" style="color:var(--stk-accent)"></i> Active Locks</div>
                    <div id="stk-stat-locks" class="stk-stat-value">--</div>
                </div>
            </div>

            <!-- STAKE FORM -->
            <div class="stk-card" style="animation-delay:0.1s">
                <div class="stk-card-title"><i class="fa-solid fa-arrow-right-to-bracket"></i> Delegate BKC</div>

                <div class="stk-input-wrap">
                    <input type="number" id="stk-amount-input" class="stk-amount-input" placeholder="0.00" step="any" min="0">
                    <button id="stk-max-btn" class="stk-max-btn">MAX</button>
                </div>

                <div class="stk-balance-row">
                    <span>Available</span>
                    <span id="stk-balance-display">-- BKC</span>
                </div>

                <div class="stk-duration-grid">
                    <div class="stk-duration-chip" data-days="30">
                        <div class="stk-chip-label">1M</div>
                        <div class="stk-chip-sub">30 days</div>
                    </div>
                    <div class="stk-duration-chip" data-days="365">
                        <div class="stk-chip-label">1Y</div>
                        <div class="stk-chip-sub">365 days</div>
                    </div>
                    <div class="stk-duration-chip" data-days="1825">
                        <div class="stk-chip-label">5Y</div>
                        <div class="stk-chip-sub">1,825 days</div>
                    </div>
                    <div class="stk-duration-chip selected recommended" data-days="3650">
                        <div class="stk-chip-label">10Y</div>
                        <div class="stk-chip-sub">3,650 days</div>
                    </div>
                </div>

                <div style="background:var(--stk-surface-2);border-radius:8px;padding:10px 12px;margin-bottom:4px">
                    <div class="stk-preview-row">
                        <span class="stk-preview-label">pStake Power</span>
                        <span id="stk-preview-pstake" class="stk-preview-val" style="color:var(--stk-purple)">0</span>
                    </div>
                    <div class="stk-preview-row">
                        <span class="stk-preview-label">Net Amount</span>
                        <span id="stk-preview-net" class="stk-preview-val">0.00 BKC</span>
                    </div>
                    <div class="stk-preview-row">
                        <span class="stk-preview-label">Fee</span>
                        <span id="stk-fee-info" class="stk-preview-val" style="color:var(--stk-text-3);font-size:11px">0.5%</span>
                    </div>
                </div>

                <button id="stk-delegate-btn" class="stk-delegate-btn" disabled>
                    <i class="fa-solid fa-lock" style="margin-right:6px"></i> Delegate BKC
                </button>
            </div>

            <!-- ACTIVE DELEGATIONS -->
            <div class="stk-card" style="animation-delay:0.15s">
                <div class="stk-card-title">
                    <i class="fa-solid fa-list-check"></i> Active Delegations
                    <span id="stk-deleg-count" style="font-size:10px;color:var(--stk-text-3);margin-left:auto">0</span>
                </div>
                <div id="stk-deleg-list" class="stk-deleg-list">
                    <div class="stk-empty"><i class="fa-solid fa-inbox"></i><p>No active delegations</p></div>
                </div>
            </div>

            <!-- HISTORY -->
            <div class="stk-card" style="animation-delay:0.2s">
                <div class="stk-card-title"><i class="fa-solid fa-clock-rotate-left"></i> History</div>
                <div class="stk-tabs">
                    <button class="stk-tab active" data-filter="ALL">All</button>
                    <button class="stk-tab" data-filter="STAKE">Stakes</button>
                    <button class="stk-tab" data-filter="UNSTAKE">Unstakes</button>
                    <button class="stk-tab" data-filter="CLAIM">Claims</button>
                </div>
                <div id="stk-history-list" class="stk-history-list">
                    <div class="stk-loading">
                        <img src="./assets/bkc_logo_3d.png" class="stk-loading-icon" alt="">
                        <span style="font-size:11px;color:var(--stk-text-3)">Loading history...</span>
                    </div>
                </div>
            </div>

        </div>
    `,xx(),u.isConnected?pa():lg())}async function pa(e=!1){if(na)return;const t=Date.now();if(!(!e&&t-Ra<1e4)){na=!0,Ra=t;try{await Promise.all([ex(),tx()]);const[,,a]=await Promise.all([Pn(),fd(),ub()]),n=u.stakingPoolContractPublic||u.stakingPoolContract;n&&(Oo=await ie(n,"totalPStake",[],0n)),await ax();const{stakingRewards:o,minerRewards:s}=await Ji();Or=o||0n,Ur=s||0n,sx(),ix(),rx(),lx(),ux(),Zn(),nx()}catch(a){console.error("Staking data load error:",a)}finally{na=!1}}}async function ex(){if(u.userAddress)try{const e=u.stakingPoolContractPublic||u.stakingPoolContract;if(e){const a=await ie(e,"getUserBestBoost",[u.userAddress],0n);Pt=Number(a)}if(Pt===0){const a=await md();a&&a.highestBoost>0&&(Pt=a.highestBoost,Ql=a.source||"api")}else Ql="active";Ai=Jn(Pt).recycleRate}catch(e){console.error("NFT boost load error:",e)}}async function tx(){if(u.userAddress)try{const e=u.ecosystemContractPublic||u.ecosystemContract;if(e){const t=await ie(e,"tutorOf",[u.userAddress],mt.ZeroAddress);gn=t&&t!==mt.ZeroAddress?t:null,Os=!!gn}}catch(e){console.error("Tutor data load error:",e)}}async function ax(){const e=u.stakingPoolContractPublic||u.stakingPoolContract;if(!(!u.userAddress||!e))try{const t=await ie(e,"previewClaim",[u.userAddress],null);t&&(he={totalRewards:t.totalRewards||t[0]||0n,recycleAmount:t.recycleAmount||t[1]||0n,burnAmount:t.burnAmount||t[2]||0n,tutorCut:t.tutorCut||t[3]||0n,userReceives:t.userReceives||t[4]||0n,recycleRateBps:t.recycleRateBps||t[5]||0n,nftBoost:t.nftBoost||t[6]||0n}),Ii=0n}catch(t){console.error("Claim preview error:",t);const a=Or+Ur,n=a*BigInt(Ai)/100n;he={totalRewards:a,recycleAmount:n,burnAmount:0n,tutorCut:0n,userReceives:a-n,recycleRateBps:BigInt(Ai*100),nftBoost:BigInt(Pt)}}}async function nx(){try{const[e,t,a,n]=await Promise.all([Gt.getPreviewBuyback().catch(()=>null),Gt.getBuybackStats().catch(()=>null),Gt.getLastBuyback().catch(()=>null),Gt.getExecutionFee().catch(()=>0n)]);At=e,Uo=t,Ho=a,jo=n,ox()}catch(e){console.error("Buyback data load error:",e)}}function ox(){const e=document.getElementById("stk-buyback-card");if(!e)return;const t=document.getElementById("stk-buyback-pending"),a=document.getElementById("stk-buyback-reward"),n=document.getElementById("stk-buyback-stakers"),o=document.getElementById("stk-buyback-rate"),s=document.getElementById("stk-buyback-btn"),i=document.getElementById("stk-buyback-info");if(!At){e.style.display="none";return}e.style.display="";const r=At.ethAvailable||0n,l=At.estimatedCallerReward||0n,c=At.estimatedToStakers||0n,d=Number(At.currentMiningRateBps||0n),f=At.isReady;t.textContent=`${Number(mt.formatEther(r)).toFixed(6)} BNB`,a.textContent=`+${Number(mt.formatEther(l)).toFixed(6)} BNB`,n.textContent=`${j(c).toLocaleString("en-US",{maximumFractionDigits:1})} BKC`,o.textContent=`${(d/100).toFixed(1)}%`,s.disabled=!f;const g=jo>0n?Number(mt.formatEther(jo)).toFixed(4):"0";let m=jo>0n?`Fee: ${g} BNB (added to buyback). Earn 5% of total.`:"Execute buyback to earn 5% of pending BNB.";if(Ho&&Number(Ho.timeSinceLast)>0){const h=Number(Ho.timeSinceLast),w=h<3600?`${Math.floor(h/60)}m ago`:h<86400?`${Math.floor(h/3600)}h ago`:`${Math.floor(h/86400)}d ago`;m+=` | Last: ${w}`}Uo&&Number(Uo.totalBuybacks)>0&&(m+=` | Total: ${Number(Uo.totalBuybacks)} buybacks`),i.textContent=m}function sx(){const e=document.getElementById("stk-reward-value"),t=document.getElementById("stk-claim-btn"),a=document.getElementById("stk-breakdown"),n=document.getElementById("stk-eth-fee"),o=(he==null?void 0:he.userReceives)||0n;he!=null&&he.totalRewards;const s=(he==null?void 0:he.recycleAmount)||0n,i=(he==null?void 0:he.burnAmount)||0n,r=(he==null?void 0:he.tutorCut)||0n,l=o>0n;if(e){const d=j(o);e.innerHTML=`${d.toFixed(4)} <span class="stk-reward-suffix">BKC</span>`}if(t){t.disabled=!l;const d=t.querySelector("span");d&&(d.textContent=l?"Claim Rewards":"No Rewards Yet")}const c=document.getElementById("stk-compound-btn");if(c){c.disabled=!l;const d=c.querySelector("span");d&&(d.textContent="Compound")}if(a&&l){a.style.display="";const d=j(Or).toFixed(4),f=j(Ur).toFixed(4),g=j(s).toFixed(4),m=j(i).toFixed(4);j(r).toFixed(4),document.getElementById("stk-break-staking").textContent=`${d} BKC`,document.getElementById("stk-break-mining").textContent=`${f} BKC`;const h=document.getElementById("stk-break-recycled");h&&(h.textContent=s>0n?`-${g} BKC`:"None",h.style.color=s>0n?"#22d3ee":"var(--stk-green)");const w=document.getElementById("stk-break-tutor-row");document.getElementById("stk-break-tutor"),document.getElementById("stk-break-tutor-label"),w&&(w.style.display="none"),document.getElementById("stk-break-burned").textContent=i>0n?`-${m} BKC`:"None",document.getElementById("stk-break-burned").style.color=i>0n?"var(--stk-red)":"var(--stk-green)"}else a&&(a.style.display="none");if(n)if(l&&Ii>0n){const d=parseFloat(mt.formatEther(Ii)).toFixed(6);n.innerHTML=`<i class="fa-brands fa-ethereum" style="margin-right:3px"></i>Claim fee: ${d} BNB`}else n.textContent=""}function ix(){const e=document.getElementById("stk-boost-panel");if(!e)return;const t=Jn(Pt),a=Pt>0,o=[wt.NONE,wt.BRONZE,wt.SILVER,wt.GOLD,wt.DIAMOND].map(r=>{const l=r.name===t.name;return`<div style="display:flex;align-items:center;justify-content:space-between;padding:3px 0;${l?"font-weight:700":"opacity:0.6"}">
            <span style="font-size:10px;color:${r.color}">${r.icon} ${r.name}${l?" â†":""}</span>
            <span style="font-size:10px;color:${r.keepRate===100?"var(--stk-green)":"var(--stk-text-2)"}">Keep ${r.keepRate}%</span>
        </div>`}).join(""),s=gn?`${gn.slice(0,6)}...${gn.slice(-4)}`:"",i=Os?`<div style="display:flex;align-items:center;gap:6px;margin-top:10px;padding:6px 8px;background:rgba(245,158,11,0.06);border:1px solid rgba(245,158,11,0.15);border-radius:6px">
            <i class="fa-solid fa-graduation-cap" style="color:var(--stk-accent);font-size:10px"></i>
            <span style="font-size:10px;color:var(--stk-accent);font-weight:600">Tutor: ${s}</span>
            <span style="font-size:9px;color:var(--stk-text-3);margin-left:auto">-10% recycle</span>
        </div>`:`<div style="margin-top:10px;padding:6px 8px;background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15);border-radius:6px">
            <div style="display:flex;align-items:center;gap:6px">
                <i class="fa-solid fa-graduation-cap" style="color:var(--stk-red);font-size:10px"></i>
                <span style="font-size:10px;color:var(--stk-red);font-weight:600">No tutor â€” +10% extra recycled</span>
            </div>
            <p style="font-size:9px;color:var(--stk-text-3);margin:3px 0 0">Set a tutor to reduce recycling by 10%</p>
            <a href="#referral" class="go-to-tutor" style="display:inline-flex;align-items:center;gap:4px;margin-top:4px;font-size:10px;font-weight:700;color:var(--stk-accent);text-decoration:none;cursor:pointer">
                <i class="fa-solid fa-arrow-right" style="font-size:8px"></i> Set a Tutor
            </a>
        </div>`;e.innerHTML=`
        <div class="stk-boost-panel">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
                <div class="stk-tier-badge ${t.class}">
                    <span style="font-size:16px">${t.icon}</span>
                    <span>${t.name}</span>
                    <span style="opacity:0.5">|</span>
                    <span>Keep ${t.keepRate}%</span>
                </div>
                ${a?'<span style="font-size:9px;color:var(--stk-green);font-weight:700"><i class="fa-solid fa-check" style="margin-right:3px"></i>ACTIVE</span>':""}
            </div>

            <div class="stk-burn-bar">
                <div class="stk-burn-fill" style="width:${t.recycleRate}%"></div>
                <div class="stk-keep-fill" style="width:${t.keepRate}%"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:10px">
                <span style="color:rgba(6,182,212,0.7)"><i class="fa-solid fa-recycle" style="margin-right:3px"></i>Recycle ${t.recycleRate}%</span>
                <span style="color:rgba(74,222,128,0.7)"><i class="fa-solid fa-check" style="margin-right:3px"></i>Keep ${t.keepRate}%</span>
            </div>

            <!-- Tier Comparison -->
            <div style="margin-top:10px;padding:8px;background:var(--stk-surface-3);border-radius:6px">
                <div style="font-size:9px;color:var(--stk-text-3);text-transform:uppercase;letter-spacing:0.05em;font-weight:700;margin-bottom:4px">
                    <i class="fa-solid fa-gem" style="margin-right:3px"></i>NFT Tier Benefits
                </div>
                ${o}
            </div>

            ${a?Pt<5e3?`
                <p style="font-size:10px;color:var(--stk-text-3);margin-top:8px">
                    <i class="fa-solid fa-arrow-up" style="color:var(--stk-cyan);margin-right:3px"></i>
                    Upgrade to ${wt.DIAMOND.icon} Diamond to keep 100%
                    <span class="go-to-store" style="color:var(--stk-accent);cursor:pointer;margin-left:4px">Upgrade</span>
                </p>
            `:"":`
                <button class="stk-boost-cta go-to-store"><i class="fa-solid fa-gem" style="font-size:10px"></i> Get an NFT</button>
            `}

            <!-- Tutor Info -->
            ${i}
        </div>
    `}function rx(){var d,f,g,m;const e=(h,w)=>{const y=document.getElementById(h);y&&(y.innerHTML=w)};e("stk-stat-network",kn(Oo));const t=((d=u.userData)==null?void 0:d.pStake)||((f=u.userData)==null?void 0:f.userTotalPStake)||u.userTotalPStake||0n,a=Oo>0n?Number(t*10000n/Oo)/100:0;e("stk-stat-power",`${kn(t)} <span style="font-size:10px;color:var(--stk-text-3)">(${a.toFixed(2)}%)</span>`);const n=(he==null?void 0:he.userReceives)||0n,o=j(n);e("stk-stat-rewards",o>0?`<span style="color:var(--stk-green)">${o.toFixed(2)}</span> <span style="font-size:10px;color:var(--stk-text-3)">BKC</span>`:'<span style="color:var(--stk-text-3)">0 BKC</span>');const s=((g=u.userDelegations)==null?void 0:g.length)||0;e("stk-stat-locks",`${s}`);const i=u.currentUserBalance||0n,r=document.getElementById("stk-balance-display");r&&(r.textContent=i>0n?`${j(i).toFixed(2)} BKC`:"0.00 BKC");const l=((m=u.systemFees)==null?void 0:m.DELEGATION_FEE_BIPS)||50n,c=document.getElementById("stk-fee-info");c&&(c.textContent=`${Number(l)/100}%`)}function lg(){gn=null,Os=!1;const e=(i,r)=>{const l=document.getElementById(i);l&&(l.innerHTML=r)};e("stk-reward-value",'-- <span class="stk-reward-suffix">BKC</span>'),e("stk-stat-network","--"),e("stk-stat-power","--"),e("stk-stat-rewards","--"),e("stk-stat-locks","--"),e("stk-balance-display","-- BKC");const t=document.getElementById("stk-claim-btn");t&&(t.disabled=!0);const a=document.getElementById("stk-breakdown");a&&(a.style.display="none");const n=document.getElementById("stk-deleg-list");n&&(n.innerHTML='<div class="stk-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>');const o=document.getElementById("stk-history-list");o&&(o.innerHTML='<div class="stk-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>');const s=document.getElementById("stk-boost-panel");s&&(s.innerHTML='<div class="stk-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet</p></div>')}function lx(){const e=document.getElementById("stk-deleg-list"),t=document.getElementById("stk-deleg-count");if(!e)return;const a=u.userDelegations||[];if(t&&(t.textContent=a.length),a.length===0){e.innerHTML='<div class="stk-empty"><i class="fa-solid fa-inbox"></i><p>No active delegations</p></div>';return}ka&&(clearInterval(ka),ka=null);const n=[...a].sort((o,s)=>Number(o.unlockTime)-Number(s.unlockTime));e.innerHTML=n.map((o,s)=>cx(o,s)).join(""),ka=setInterval(dx,6e4),e.querySelectorAll(".stk-unstake-btn").forEach(o=>{o.addEventListener("click",()=>fx(parseInt(o.dataset.index),o.classList.contains("stk-unstake-force")))})}function cx(e,t){const a=j(e.amount||0n),n=e.lockDays||Number(e.lockDuration||0n)/86400,o=Number(e.unlockTime||e.lockEnd||0n),s=Math.floor(Date.now()/1e3),i=o>s,r=i?o-s:0,l=e.lockDuration||BigInt(e.lockDays||0)*86400n,c=e.pStake||X0(e.amount||0n,l);return`
        <div class="stk-deleg-item">
            <div class="stk-deleg-icon" style="background:${i?"rgba(251,191,36,0.1)":"rgba(74,222,128,0.1)"}">
                <i class="fa-solid ${i?"fa-lock":"fa-lock-open"}" style="color:${i?"#fbbf24":"var(--stk-green)"}; font-size:14px"></i>
            </div>
            <div class="stk-deleg-info">
                <div class="stk-deleg-amount">${a.toFixed(2)} BKC</div>
                <div class="stk-deleg-meta">
                    <span style="color:var(--stk-purple)">${kn(c)} pS</span>
                    <span style="color:var(--stk-text-3)">|</span>
                    <span>${q0(n)}</span>
                </div>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
                ${i?`
                    <span class="stk-countdown" data-unlock-time="${o}">${rg(r)}</span>
                    <button class="stk-unstake-btn stk-unstake-force" data-index="${e.index!==void 0?e.index:t}" title="Force unstake (60% base penalty, reduced by NFT)">
                        <i class="fa-solid fa-bolt" style="font-size:10px"></i>
                    </button>
                `:`
                    <span style="font-size:10px;color:var(--stk-green);font-weight:700"><i class="fa-solid fa-check" style="margin-right:3px"></i>Ready</span>
                    <button class="stk-unstake-btn stk-unstake-ready" data-index="${e.index!==void 0?e.index:t}">Unstake</button>
                `}
            </div>
        </div>
    `}function dx(){document.querySelectorAll(".stk-countdown").forEach(e=>{const t=parseInt(e.dataset.unlockTime),a=Math.floor(Date.now()/1e3);e.textContent=rg(t-a)})}async function ux(){if(u.userAddress)try{const e=ca.getHistory||"https://gethistory-4wvdcuoouq-uc.a.run.app",t=await fetch(`${e}/${u.userAddress}`);t.ok&&(io=(await t.json()||[]).filter(n=>{const o=(n.type||"").toUpperCase();return o.includes("DELEGAT")||o.includes("STAKE")||o.includes("UNDELEGAT")||o.includes("CLAIM")||o.includes("REWARD")||o.includes("FORCE")}),cg())}catch(e){console.error("History load error:",e)}}function cg(){const e=document.getElementById("stk-history-list");if(!e)return;let t=io;if(Vn!=="ALL"&&(t=io.filter(a=>{const n=(a.type||"").toUpperCase();switch(Vn){case"STAKE":return(n.includes("DELEGAT")||n.includes("STAKE"))&&!n.includes("UNSTAKE")&&!n.includes("UNDELEGAT")&&!n.includes("FORCE");case"UNSTAKE":return n.includes("UNSTAKE")||n.includes("UNDELEGAT")||n.includes("FORCE");case"CLAIM":return n.includes("CLAIM")||n.includes("REWARD");default:return!0}})),t.length===0){e.innerHTML=`<div class="stk-empty"><i class="fa-solid fa-inbox"></i><p>No ${Vn==="ALL"?"":Vn.toLowerCase()+" "}history yet</p></div>`;return}e.innerHTML=t.slice(0,25).map(a=>{const n=(a.type||"").toUpperCase(),o=a.details||{},s=J0(a.timestamp||a.createdAt);let i,r,l,c,d="";n.includes("FORCE")?(i="fa-bolt",r="rgba(239,68,68,0.12)",l="#ef4444",c="Force Unstaked",o.feePaid&&BigInt(o.feePaid)>0n&&(d=`<span style="color:#ef4444">-${j(BigInt(o.feePaid)).toFixed(2)}</span>`)):(n.includes("DELEGAT")||n.includes("STAKE"))&&!n.includes("UNSTAKE")?(i="fa-lock",r="rgba(74,222,128,0.12)",l="#4ade80",c="Delegated",o.pStakeGenerated&&(d=`<span style="color:var(--stk-purple)">+${j(BigInt(o.pStakeGenerated)).toFixed(0)} pS</span>`)):n.includes("UNSTAKE")||n.includes("UNDELEGAT")?(i="fa-unlock",r="rgba(249,115,22,0.12)",l="#f97316",c="Unstaked"):n.includes("CLAIM")||n.includes("REWARD")?(i="fa-coins",r="rgba(251,191,36,0.12)",l="#fbbf24",c="Claimed",o.amountReceived&&BigInt(o.amountReceived)>0n&&(d=`<span style="color:var(--stk-green)">+${j(BigInt(o.amountReceived)).toFixed(2)}</span>`),o.recycledAmount&&BigInt(o.recycledAmount)>0n?d+=` <span style="font-size:9px;color:rgba(6,182,212,0.6)">â™»-${j(BigInt(o.recycledAmount)).toFixed(2)}</span>`:o.burnedAmount&&BigInt(o.burnedAmount)>0n&&(d+=` <span style="font-size:9px;color:rgba(239,68,68,0.6)">ðŸ”¥-${j(BigInt(o.burnedAmount)).toFixed(2)}</span>`)):(i="fa-circle",r="rgba(113,113,122,0.12)",l="#71717a",c=a.type||"Activity");const f=a.txHash?`${Y0}${a.txHash}`:"#",g=a.amount||o.amount||o.amountReceived||"0";let m=0;try{m=j(BigInt(g))}catch{}const h=m>.001?m.toFixed(2):"";return`
            <a href="${f}" target="_blank" class="stk-history-item">
                <div class="stk-history-icon" style="background:${r}">
                    <i class="fa-solid ${i}" style="color:${l}"></i>
                </div>
                <div class="stk-history-info">
                    <div class="stk-history-label">${c} ${d?`<span style="font-size:10px">${d}</span>`:""}</div>
                    <div class="stk-history-date">${s}</div>
                </div>
                <div style="display:flex;align-items:center;gap:6px">
                    ${h?`<span class="stk-history-amount">${h} <span style="font-size:10px;color:var(--stk-text-3)">BKC</span></span>`:""}
                    <i class="fa-solid fa-arrow-up-right-from-square stk-history-link"></i>
                </div>
            </a>
        `}).join("")}function Zn(){var n;const e=document.getElementById("stk-amount-input"),t=document.getElementById("stk-delegate-btn");if(!e)return;const a=e.value;if(!a||parseFloat(a)<=0){const o=document.getElementById("stk-preview-pstake");o&&(o.textContent="0");const s=document.getElementById("stk-preview-net");s&&(s.textContent="0.00 BKC"),t&&(t.disabled=!0);return}try{const o=mt.parseUnits(a,18),s=((n=u.systemFees)==null?void 0:n.DELEGATION_FEE_BIPS)||50n,i=o*BigInt(s)/10000n,r=o-i,l=BigInt(Ms),c=10000n,d=c+l*5918n/365n,f=r*d/c,g=document.getElementById("stk-preview-pstake");g&&(g.textContent=kn(f));const m=document.getElementById("stk-preview-net");m&&(m.textContent=`${j(r).toFixed(4)} BKC`);const h=u.currentUserBalance||0n;o>h?(e.classList.add("error"),t&&(t.disabled=!0)):(e.classList.remove("error"),t&&(t.disabled=Me))}catch{t&&(t.disabled=!0)}}async function px(){if(Me)return;const e=document.getElementById("stk-amount-input"),t=document.getElementById("stk-delegate-btn");if(!e||!t)return;const a=e.value;if(!a||parseFloat(a)<=0)return x("Enter an amount","warning");const n=u.currentUserBalance||0n;let o;try{if(o=mt.parseUnits(a,18),o>n)return x("Insufficient BKC balance","error")}catch{return x("Invalid amount","error")}try{if(await u.publicProvider.getBalance(u.userAddress)<mt.parseEther("0.001"))return x("Insufficient BNB for gas","error")}catch{}Me=!0;try{await La.delegate({amount:o,lockDays:Ms,button:t,onSuccess:async()=>{e.value="",x("Delegation successful!","success"),na=!1,Ra=0,await pa(!0)},onError:s=>{s.cancelled||x("Delegation failed: "+(s.reason||s.message||"Unknown error"),"error")}})}catch(s){x("Delegation failed: "+(s.reason||s.message||"Unknown error"),"error")}finally{Me=!1,Zn()}}async function fx(e,t){if(Me)return;if(t){let n=`Force unstake has a penalty based on your NFT tier.
`;try{const o=u.stakingPoolContractPublic||u.stakingPoolContract;if(o&&u.userAddress){const s=await ie(o,"previewForceUnstake",[u.userAddress,BigInt(e)],null);if(s){const i=j(s[0]||0n).toFixed(2),r=j(s[1]||0n).toFixed(2),l=j(s[2]||0n).toFixed(2),c=j(s[3]||0n).toFixed(2),d=j(s[4]||0n).toFixed(2),f=j(s[5]||0n).toFixed(2),g=parseFloat(mt.formatEther(s[8]||0n)).toFixed(4),m=Jn(Number(s[7]||0n));n=`Force Unstake Preview (${m.icon} ${m.name})

`,n+=`Staked: ${i} BKC
`,n+=`Penalty: -${r} BKC
`,n+=`  Recycled: ${l} BKC (to all stakers)
`,n+=`  BNB Fee: ${g} BNB
`,n+=`
You receive: ${f} BKC
`,n+=`
Continue?`}}}catch(o){console.warn("Force unstake preview error:",o),n+=`Your NFT tier: ${Jn(Pt).icon} ${Jn(Pt).name}
`,n+=`${Os?"Tutor reduces recycling by 10%":"No tutor (+10% extra recycled)"}
Continue?`}if(!confirm(n))return}const a=document.querySelector(`.stk-unstake-btn[data-index='${e}']`);Me=!0;try{await(t?La.forceUnstake:La.unstake)({delegationIndex:BigInt(e),button:a,onSuccess:async()=>{x(t?"Force unstaked (penalty applied)":"Unstaked successfully!",t?"warning":"success"),na=!1,Ra=0,await pa(!0)},onError:o=>{o.cancelled||x("Unstake failed: "+(o.reason||o.message||"Unknown error"),"error")}})}catch(n){x("Unstake failed: "+(n.reason||n.message||"Unknown error"),"error")}finally{Me=!1}}async function gx(){if(Me)return;const e=document.getElementById("stk-claim-btn");Me=!0;try{await La.claimRewards({button:e,onSuccess:async()=>{x("Rewards claimed!","success"),na=!1,Ra=0,io=[],await pa(!0)},onError:t=>{t.cancelled||x("Claim failed: "+(t.reason||t.message||"Unknown error"),"error")}})}catch(t){x("Claim failed: "+(t.reason||t.message||"Unknown error"),"error")}finally{Me=!1}}async function mx(){if(Me)return;const e=document.getElementById("stk-compound-btn");Me=!0;try{await La.compoundRewards({lockDays:Ms,button:e,onSuccess:async()=>{x("Rewards compounded into new delegation!","success"),na=!1,Ra=0,io=[],await pa(!0)},onError:t=>{t.cancelled||x("Compound failed: "+(t.reason||t.message||"Unknown error"),"error")}})}catch(t){x("Compound failed: "+(t.reason||t.message||"Unknown error"),"error")}finally{Me=!1}}async function bx(){if(Me)return;const e=document.getElementById("stk-buyback-btn");Me=!0;try{await Gt.executeBuyback({button:e,onSuccess:async t=>{const a=(At==null?void 0:At.estimatedCallerReward)||0n,n=Number(mt.formatEther(a)).toFixed(6);x(`Buyback executed! You earned ${n} BNB`,"success"),na=!1,Ra=0,await pa(!0)},onError:t=>{t.cancelled||x("Buyback failed: "+(t.reason||t.message||"Unknown error"),"error")}})}catch(t){x("Buyback failed: "+(t.reason||t.message||"Unknown error"),"error")}finally{Me=!1}}function xx(){var r,l,c;const e=document.getElementById("staking");if(!e)return;const t=document.getElementById("stk-amount-input"),a=document.getElementById("stk-max-btn"),n=document.getElementById("stk-delegate-btn"),o=document.getElementById("stk-refresh-btn"),s=document.querySelectorAll(".stk-duration-chip"),i=document.querySelectorAll(".stk-tab");t==null||t.addEventListener("input",Zn),a==null||a.addEventListener("click",()=>{const d=u.currentUserBalance||0n;t&&(t.value=mt.formatUnits(d,18),Zn())}),s.forEach(d=>{d.addEventListener("click",()=>{s.forEach(f=>f.classList.remove("selected")),d.classList.add("selected"),Ms=parseInt(d.dataset.days),Zn()})}),i.forEach(d=>{d.addEventListener("click",()=>{i.forEach(f=>f.classList.remove("active")),d.classList.add("active"),Vn=d.dataset.filter,cg()})}),n==null||n.addEventListener("click",px),o==null||o.addEventListener("click",()=>{const d=o.querySelector("i");d==null||d.classList.add("fa-spin"),pa(!0).then(()=>{setTimeout(()=>d==null?void 0:d.classList.remove("fa-spin"),500)})}),(r=document.getElementById("stk-claim-btn"))==null||r.addEventListener("click",gx),(l=document.getElementById("stk-compound-btn"))==null||l.addEventListener("click",mx),(c=document.getElementById("stk-buyback-btn"))==null||c.addEventListener("click",bx),e.addEventListener("click",d=>{d.target.closest(".go-to-store")&&(d.preventDefault(),window.navigateTo("store")),d.target.closest(".go-to-rental")&&(d.preventDefault(),window.navigateTo("rental")),d.target.closest(".go-to-tutor")&&(d.preventDefault(),window.navigateTo("referral"))})}function hx(){ka&&(clearInterval(ka),ka=null)}function vx(e){e?pa():lg()}const Wo={render:Q0,update:vx,cleanup:hx},gt=window.ethers,yx="https://sepolia.etherscan.io/tx/",wx=3e4,Ce={Diamond:{color:"#22d3ee",border:"rgba(34,211,238,0.4)",bg:"rgba(34,211,238,0.06)",gradient:"linear-gradient(135deg, rgba(34,211,238,0.12), rgba(59,130,246,0.08))",icon:"ðŸ’Ž",keepRate:100,recycleRate:0,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq"},Gold:{color:"#fbbf24",border:"rgba(251,191,36,0.4)",bg:"rgba(251,191,36,0.06)",gradient:"linear-gradient(135deg, rgba(251,191,36,0.12), rgba(217,119,6,0.08))",icon:"ðŸ¥‡",keepRate:90,recycleRate:10,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44"},Silver:{color:"#9ca3af",border:"rgba(156,163,175,0.4)",bg:"rgba(156,163,175,0.06)",gradient:"linear-gradient(135deg, rgba(156,163,175,0.12), rgba(100,116,139,0.08))",icon:"ðŸ¥ˆ",keepRate:80,recycleRate:20,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4"},Bronze:{color:"#f97316",border:"rgba(249,115,22,0.4)",bg:"rgba(249,115,22,0.06)",gradient:"linear-gradient(135deg, rgba(249,115,22,0.12), rgba(180,83,9,0.08))",icon:"ðŸ¥‰",keepRate:70,recycleRate:30,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m"}};function He(e){return Ce[e]||Ce.Bronze}const pi={0:1e3,1:2500,2:4e3,3:5e3};function jn({add:e=[],remove:t=[]}){let a=[...u.myBoosters||[]];for(const n of t){const o=BigInt(n);a=a.filter(s=>BigInt(s.tokenId)!==o)}for(const n of e)a.push({tokenId:BigInt(n.tokenId),boostBips:n.boostBips});u.myBoosters=a,Nn(!0).catch(()=>{})}const un=new Map,ec=new Map,Hr=new Map;let We=!1,Qn=[],eo=null,Ot=!1,Pa=0,ye=[],ut=null,Ue=null,Ze=null,pt=!1,oe=[],ve=null,Ge=null;const kx=["function getPoolAddress(uint256 boostBips) view returns (address)","function isPool(address) view returns (bool)"];function Ex(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function Tx(e){const t=Hr.get(e);return t&&Date.now()-t.timestamp<wx?t.data:null}function Cx(e,t){Hr.set(e,{data:t,timestamp:Date.now()})}function tn(){Hr.clear()}function Bx(){if(document.getElementById("nft-styles-v13"))return;const e=document.createElement("style");e.id="nft-styles-v13",e.textContent=`
        .nft-shell {
            --nft-bg: #0c0c0e;
            --nft-surface: #141417;
            --nft-surface-2: #1c1c21;
            --nft-surface-3: #222228;
            --nft-border: rgba(255,255,255,0.06);
            --nft-border-h: rgba(255,255,255,0.12);
            --nft-text: #f0f0f2;
            --nft-text-2: #a0a0ab;
            --nft-text-3: #5c5c68;
            --nft-accent: #f59e0b;
            --nft-green: #4ade80;
            --nft-purple: #a78bfa;
            --nft-cyan: #22d3ee;
            --nft-red: #ef4444;
            --nft-radius: 16px;
            --nft-radius-sm: 10px;
            --nft-tr: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes nft-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes nft-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes nft-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes nft-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes nft-success { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }

        .nft-shell { max-width: 960px; margin: 0 auto; padding: 0 16px 40px; animation: nft-fadeIn 0.4s ease-out; }

        /* Header */
        .nft-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .nft-header-left { display: flex; align-items: center; gap: 14px; }
        .nft-header-icon {
            width: 48px; height: 48px; border-radius: var(--nft-radius);
            background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(217,119,6,0.1));
            border: 1px solid rgba(245,158,11,0.2);
            display: flex; align-items: center; justify-content: center;
            animation: nft-float 4s ease-in-out infinite;
        }
        .nft-header-icon i { font-size: 20px; color: var(--nft-accent); }
        .nft-header-title { font-size: 20px; font-weight: 800; color: var(--nft-text); }
        .nft-header-sub { font-size: 11px; color: var(--nft-text-3); }
        .nft-refresh-btn {
            width: 40px; height: 40px; border-radius: var(--nft-radius-sm);
            background: var(--nft-surface); border: 1px solid var(--nft-border);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all var(--nft-tr); color: var(--nft-text-3);
        }
        .nft-refresh-btn:hover { color: var(--nft-text); border-color: var(--nft-border-h); }

        /* Tutor Banner */
        .nft-tutor-banner {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 14px; border-radius: var(--nft-radius-sm);
            margin-bottom: 14px; font-size: 11px; font-weight: 600;
            animation: nft-fadeIn 0.4s ease-out;
        }
        .nft-tutor-banner a { color: var(--nft-accent); text-decoration: none; font-weight: 700; margin-left: 4px; }
        .nft-tutor-banner a:hover { text-decoration: underline; }

        /* Tier Cards Grid */
        .nft-tier-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
            margin-bottom: 14px;
        }
        .nft-tier-card {
            position: relative; overflow: hidden;
            background: var(--nft-surface);
            border: 1px solid var(--nft-border);
            border-radius: var(--nft-radius);
            padding: 16px;
            transition: all var(--nft-tr);
            animation: nft-scaleIn 0.5s ease-out both;
        }
        .nft-tier-card:nth-child(1) { animation-delay: 0s; }
        .nft-tier-card:nth-child(2) { animation-delay: 0.05s; }
        .nft-tier-card:nth-child(3) { animation-delay: 0.1s; }
        .nft-tier-card:nth-child(4) { animation-delay: 0.15s; }
        .nft-tier-card:hover { border-color: var(--nft-border-h); }
        .nft-tier-card.nft-user-tier { box-shadow: 0 0 20px rgba(245,158,11,0.1); }
        .nft-user-badge {
            position: absolute; top: 8px; right: 8px;
            padding: 2px 8px; border-radius: 10px; font-size: 8px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 0.05em;
            background: var(--nft-accent); color: #000;
        }

        .nft-tier-top { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .nft-tier-img {
            width: 48px; height: 48px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; flex-shrink: 0;
        }
        .nft-tier-img img { width: 100%; height: 100%; object-contain: cover; }
        .nft-tier-name { font-size: 16px; font-weight: 800; }
        .nft-keep-badge {
            display: inline-block; padding: 2px 8px; border-radius: 8px;
            font-size: 10px; font-weight: 700; margin-top: 2px;
        }

        .nft-tier-prices { margin-bottom: 10px; }
        .nft-price-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 4px 0; font-size: 11px;
        }
        .nft-price-label { color: var(--nft-text-3); display: flex; align-items: center; gap: 4px; }
        .nft-price-val { font-weight: 700; font-family: 'SF Mono', monospace; font-size: 12px; }

        .nft-tier-stats {
            display: flex; justify-content: space-between;
            padding: 6px 0; margin-bottom: 10px;
            border-top: 1px solid var(--nft-border); border-bottom: 1px solid var(--nft-border);
        }
        .nft-tier-stat { text-align: center; flex: 1; }
        .nft-tier-stat-label { font-size: 8px; color: var(--nft-text-3); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; }
        .nft-tier-stat-val { font-size: 13px; font-weight: 800; }

        .nft-tier-actions { display: flex; gap: 6px; }
        .nft-action-btn {
            flex: 1; padding: 8px; font-size: 11px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--nft-tr); display: flex; align-items: center;
            justify-content: center; gap: 4px;
        }
        .nft-action-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .nft-action-btn:not(:disabled):hover { transform: translateY(-1px); filter: brightness(1.1); }
        .nft-buy-btn { background: linear-gradient(135deg, #22c55e, #10b981); color: white; }
        .nft-sell-btn { background: linear-gradient(135deg, #f59e0b, #d97706); color: #000; }

        /* Impact Card */
        .nft-impact {
            background: var(--nft-surface);
            border: 1px solid var(--nft-border);
            border-radius: var(--nft-radius);
            padding: 16px; margin-bottom: 14px;
            animation: nft-fadeIn 0.5s ease-out 0.2s both;
        }
        .nft-impact-title { font-size: 12px; font-weight: 700; color: var(--nft-text); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .nft-impact-title i { color: var(--nft-text-3); font-size: 11px; }
        .nft-impact-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
        }
        .nft-impact-item {
            text-align: center; padding: 8px 4px;
            background: var(--nft-surface-2); border-radius: 8px;
        }
        .nft-impact-num { font-size: 16px; font-weight: 800; }
        .nft-impact-label { font-size: 8px; color: var(--nft-text-3); text-transform: uppercase; letter-spacing: 0.04em; font-weight: 700; margin-top: 2px; }
        .nft-impact-cta { margin-top: 8px; font-size: 10px; }
        .nft-impact-cta a { color: var(--nft-accent); text-decoration: none; font-weight: 700; cursor: pointer; }
        .nft-impact-cta a:hover { text-decoration: underline; }

        /* Card Base */
        .nft-card {
            background: var(--nft-surface); border: 1px solid var(--nft-border);
            border-radius: var(--nft-radius); margin-bottom: 14px;
            animation: nft-fadeIn 0.5s ease-out 0.25s both;
        }
        .nft-card-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 16px; cursor: pointer; transition: background var(--nft-tr);
        }
        .nft-card-header:hover { background: var(--nft-surface-2); }
        .nft-card-title { font-size: 13px; font-weight: 700; color: var(--nft-text); display: flex; align-items: center; gap: 8px; }
        .nft-card-title i { color: var(--nft-text-3); font-size: 11px; }
        .nft-card-badge { font-size: 10px; background: var(--nft-surface-3); padding: 2px 8px; border-radius: 10px; color: var(--nft-text-3); }
        .nft-card-chevron { color: var(--nft-text-3); font-size: 10px; transition: transform var(--nft-tr); }

        .nft-card-body { padding: 0 16px 16px; }

        /* Inventory */
        .nft-inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .nft-inv-item {
            position: relative; padding: 8px; border-radius: 10px;
            background: var(--nft-surface-2); border: 1px solid transparent;
            transition: all var(--nft-tr); cursor: default;
        }
        .nft-inv-item:hover { border-color: var(--nft-border-h); background: var(--nft-surface-3); }
        .nft-inv-img {
            width: 100%; aspect-ratio: 1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; margin-bottom: 4px;
        }
        .nft-inv-img img { width: 100%; height: 100%; object-fit: contain; }
        .nft-inv-status {
            position: absolute; top: 4px; right: 4px;
            padding: 1px 5px; border-radius: 6px; font-size: 7px; font-weight: 800;
        }
        .nft-inv-name { font-size: 9px; text-align: center; font-weight: 700; }
        .nft-inv-id { font-size: 8px; text-align: center; color: var(--nft-text-3); }
        .nft-inv-actions {
            display: flex; align-items: center; justify-content: center; gap: 6px; margin-top: 3px;
        }
        .nft-inv-rent {
            font-size: 8px; font-weight: 700;
            color: var(--nft-accent); text-decoration: none; cursor: pointer;
        }
        .nft-inv-rent:hover { text-decoration: underline; }
        .nft-inv-metamask {
            display: flex; align-items: center; justify-content: center;
            opacity: 0.4; transition: opacity 0.2s ease; cursor: pointer;
        }
        .nft-inv-metamask:hover { opacity: 1; }

        /* â•â•â• Fusion/Split Section â€” Forge UI â•â•â• */
        .nft-fusion-card {
            background: var(--nft-surface); border: 1px solid var(--nft-border);
            border-radius: var(--nft-radius); margin-bottom: 12px; overflow: hidden;
            animation: nft-scaleIn 0.3s ease-out;
        }

        /* Toggle Tabs â€” Pill style */
        .nft-fusion-tabs {
            display: flex; gap: 4px; padding: 10px 14px 0;
        }
        .nft-fusion-tab {
            flex: 1; padding: 9px 14px; font-size: 11px; font-weight: 700;
            color: var(--nft-text-3); text-align: center; cursor: pointer;
            border-radius: 10px; transition: all 0.25s ease;
            background: transparent; border: 1px solid transparent;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .nft-fusion-tab:hover { color: var(--nft-text-2); background: var(--nft-surface-2); }
        .nft-fusion-tab.active[data-fusion-tab="fuse"] {
            color: #000; background: linear-gradient(135deg, #f59e0b, #f97316);
            border-color: rgba(245,158,11,0.4); box-shadow: 0 2px 12px rgba(245,158,11,0.2);
        }
        .nft-fusion-tab.active[data-fusion-tab="bulk"] {
            color: #f97316; border-color: #f97316; background: rgba(249,115,22,0.08);
        }
        .nft-fusion-tab.active[data-fusion-tab="split"] {
            color: #fff; background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-color: rgba(139,92,246,0.4); box-shadow: 0 2px 12px rgba(139,92,246,0.2);
        }
        .nft-fusion-tab i { font-size: 10px; }

        .nft-fusion-body { padding: 14px; }
        .nft-fusion-hint { font-size: 10px; color: var(--nft-text-3); margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        .nft-fusion-hint i { font-size: 8px; opacity: 0.5; }

        /* Tier Filter Pills */
        .nft-fusion-filters { display: flex; gap: 6px; margin-bottom: 12px; flex-wrap: wrap; }
        .nft-fusion-filter {
            padding: 6px 14px; border-radius: 20px; font-size: 10px; font-weight: 700;
            border: 1px solid var(--nft-border); background: var(--nft-surface-2);
            color: var(--nft-text-3); cursor: pointer; transition: all 0.2s ease;
            display: flex; align-items: center; gap: 4px;
        }
        .nft-fusion-filter:hover:not(:disabled) { border-color: var(--nft-border-h); color: var(--nft-text-2); background: var(--nft-surface-3); }
        .nft-fusion-filter.active { font-weight: 800; }
        .nft-fusion-filter:disabled { opacity: 0.25; cursor: not-allowed; }
        .nft-fusion-filter .ff-count { font-size: 8px; opacity: 0.6; }

        /* NFT Selection Grid */
        .nft-fusion-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 8px; margin-bottom: 12px; }
        .nft-fusion-nft {
            position: relative; padding: 12px 6px 10px; border-radius: 12px; text-align: center;
            background: var(--nft-surface-2); border: 2px solid var(--nft-border);
            cursor: pointer; transition: all 0.2s ease; user-select: none;
        }
        .nft-fusion-nft:hover { border-color: var(--nft-border-h); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .nft-fusion-nft.selected {
            background: rgba(245,158,11,0.06);
            box-shadow: 0 0 16px rgba(245,158,11,0.15), inset 0 0 20px rgba(245,158,11,0.04);
        }
        .nft-fusion-nft.selected::after {
            content: ''; position: absolute; inset: -3px; border-radius: 14px;
            border: 2px solid; opacity: 0.5;
            animation: nft-pulse-ring 2s ease-in-out infinite;
        }
        .nft-fusion-nft-icon { font-size: 24px; margin-bottom: 4px; display: block; transition: transform 0.2s ease; }
        .nft-fusion-nft.selected .nft-fusion-nft-icon { transform: scale(1.15); }
        .nft-fusion-nft-id { font-size: 9px; font-weight: 800; color: var(--nft-text); font-family: 'SF Mono', 'Fira Code', monospace; }
        .nft-fusion-nft-tier { font-size: 8px; color: var(--nft-text-3); margin-top: 2px; font-weight: 600; }
        .nft-fusion-nft-check {
            position: absolute; top: 4px; right: 4px; width: 18px; height: 18px;
            border-radius: 50%; color: #000;
            display: none; align-items: center; justify-content: center; font-size: 9px; font-weight: 900;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .nft-fusion-nft.selected .nft-fusion-nft-check { display: flex; }

        /* â•â•â• Forge Preview (Fuse) â•â•â• */
        .nft-forge-preview {
            position: relative; display: flex; align-items: center; justify-content: center; gap: 8px;
            padding: 16px; margin-bottom: 12px;
            background: radial-gradient(ellipse at center, rgba(245,158,11,0.06) 0%, transparent 70%);
            border: 1px solid rgba(245,158,11,0.15); border-radius: 14px;
            animation: nft-fadeIn 0.3s ease-out;
            overflow: hidden;
        }
        .nft-forge-preview::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(90deg, transparent, rgba(245,158,11,0.03), transparent);
            animation: nft-forge-shimmer 3s ease-in-out infinite;
        }
        .nft-forge-source {
            display: flex; flex-direction: column; align-items: center; gap: 2px;
            padding: 8px 12px; border-radius: 10px; background: var(--nft-surface-2);
            border: 1px solid var(--nft-border); z-index: 1;
        }
        .nft-forge-source-icon { font-size: 22px; }
        .nft-forge-source-id { font-size: 9px; font-weight: 800; font-family: 'SF Mono', monospace; }
        .nft-forge-op {
            font-size: 16px; font-weight: 900; color: var(--nft-text-3); z-index: 1;
            width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;
        }
        .nft-forge-arrow {
            z-index: 1; color: var(--nft-accent); font-size: 14px;
            animation: nft-forge-pulse 1.5s ease-in-out infinite;
        }
        .nft-forge-result {
            display: flex; flex-direction: column; align-items: center; gap: 2px;
            padding: 10px 16px; border-radius: 12px; z-index: 1;
            border: 1px solid rgba(245,158,11,0.3);
            background: linear-gradient(135deg, rgba(245,158,11,0.08), rgba(217,119,6,0.04));
            box-shadow: 0 0 20px rgba(245,158,11,0.08);
        }
        .nft-forge-result-icon { font-size: 28px; filter: drop-shadow(0 0 8px rgba(245,158,11,0.3)); }
        .nft-forge-result-name { font-size: 10px; font-weight: 800; }
        .nft-forge-fee {
            font-size: 9px; color: var(--nft-text-3); text-align: center; margin-bottom: 8px;
            display: flex; align-items: center; justify-content: center; gap: 4px;
        }
        .nft-forge-fee i { font-size: 7px; opacity: 0.5; }

        /* â•â•â• CTA Buttons â•â•â• */
        .nft-fusion-cta {
            width: 100%; padding: 11px; border: none; border-radius: 12px;
            font-size: 12px; font-weight: 800; cursor: pointer;
            transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 0.5px;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .nft-fusion-cta.fuse-cta {
            background: linear-gradient(135deg, #f59e0b, #ea580c); color: #000;
            box-shadow: 0 2px 12px rgba(245,158,11,0.25);
        }
        .nft-fusion-cta.fuse-cta:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(245,158,11,0.35); }
        .nft-fusion-cta.split-cta {
            background: linear-gradient(135deg, #a78bfa, #7c3aed); color: #fff;
            box-shadow: 0 2px 12px rgba(124,58,237,0.25);
        }
        .nft-fusion-cta.split-cta:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(124,58,237,0.35); }
        .nft-fusion-cta:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

        /* â•â•â• Split Options Panel â•â•â• */
        .nft-split-options {
            padding: 12px; margin-top: 10px;
            background: linear-gradient(135deg, var(--nft-surface-2), var(--nft-surface-3));
            border: 1px solid rgba(139,92,246,0.15); border-radius: 12px;
            animation: nft-fadeIn 0.2s ease-out;
        }
        .nft-split-header {
            display: flex; align-items: center; gap: 8px; margin-bottom: 10px;
            padding-bottom: 8px; border-bottom: 1px solid var(--nft-border);
        }
        .nft-split-header-icon { font-size: 20px; }
        .nft-split-header-info { flex: 1; }
        .nft-split-header-name { font-size: 11px; font-weight: 800; }
        .nft-split-header-sub { font-size: 9px; color: var(--nft-text-3); }
        .nft-split-option {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 12px; border-radius: 10px; cursor: pointer;
            transition: all 0.2s ease; margin-bottom: 4px;
            border: 1px solid transparent; background: transparent;
        }
        .nft-split-option:hover { background: rgba(139,92,246,0.04); border-color: rgba(139,92,246,0.1); }
        .nft-split-option.active {
            background: rgba(139,92,246,0.08); border-color: rgba(139,92,246,0.25);
            box-shadow: 0 0 10px rgba(139,92,246,0.06);
        }
        .nft-split-option-left { display: flex; align-items: center; gap: 8px; }
        .nft-split-option-radio {
            width: 16px; height: 16px; border-radius: 50%;
            border: 2px solid var(--nft-border); transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .nft-split-option.active .nft-split-option-radio {
            border-color: #a78bfa; background: #a78bfa;
            box-shadow: inset 0 0 0 2.5px var(--nft-surface-2), 0 0 6px rgba(167,139,250,0.3);
        }
        .nft-split-option-label { font-size: 11px; font-weight: 700; color: var(--nft-text); }
        .nft-split-option-fee { font-size: 9px; color: var(--nft-text-3); font-family: 'SF Mono', monospace; }

        /* Split Confirmation */
        .nft-split-confirm {
            margin-top: 10px; padding: 12px 14px; background: rgba(239,68,68,0.05);
            border: 1px solid rgba(239,68,68,0.15); border-radius: 10px;
            animation: nft-fadeIn 0.2s ease-out;
        }
        .nft-split-confirm-text { font-size: 10px; color: #fca5a5; margin-bottom: 10px; line-height: 1.5; }
        .nft-split-confirm-text i { color: #f87171; }
        .nft-split-confirm-btns { display: flex; gap: 8px; }
        .nft-split-confirm-cancel {
            flex: 1; padding: 8px; border-radius: 8px; font-size: 10px; font-weight: 700;
            background: var(--nft-surface-2); color: var(--nft-text-3); border: 1px solid var(--nft-border);
            cursor: pointer; transition: all 0.2s ease;
        }
        .nft-split-confirm-cancel:hover { color: var(--nft-text); border-color: var(--nft-border-h); }
        .nft-split-confirm-go {
            flex: 1; padding: 8px; border-radius: 8px; font-size: 10px; font-weight: 800;
            background: linear-gradient(135deg, #ef4444, #b91c1c); color: #fff; border: none;
            cursor: pointer; transition: all 0.2s ease;
        }
        .nft-split-confirm-go:hover { transform: scale(1.02); box-shadow: 0 2px 10px rgba(239,68,68,0.3); }
        .nft-split-confirm-go:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }

        /* Empty & Stats */
        .nft-fusion-empty {
            text-align: center; padding: 24px 16px; color: var(--nft-text-3); font-size: 11px; line-height: 1.5;
        }
        .nft-fusion-empty i { font-size: 22px; margin-bottom: 8px; display: block; opacity: 0.25; }
        .nft-fusion-stats {
            display: flex; align-items: center; justify-content: center; gap: 6px;
            padding: 8px 12px; border-top: 1px solid var(--nft-border);
            font-size: 9px; color: var(--nft-text-3);
        }

        /* â•â•â• Fusion Animations â•â•â• */
        @keyframes nft-pulse-ring {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.15; }
        }
        @keyframes nft-forge-shimmer {
            0%, 100% { opacity: 0; transform: translateX(-100%); }
            50% { opacity: 1; transform: translateX(100%); }
        }
        @keyframes nft-forge-pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* History */
        .nft-hist-list { display: flex; flex-direction: column; gap: 4px; max-height: 300px; overflow-y: auto; }
        .nft-hist-list::-webkit-scrollbar { width: 4px; }
        .nft-hist-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }
        .nft-hist-item {
            display: flex; align-items: center; justify-content: space-between; gap: 8px;
            padding: 8px 10px; background: var(--nft-surface-2);
            border: 1px solid transparent; border-radius: 8px;
            transition: all var(--nft-tr); text-decoration: none;
        }
        .nft-hist-item:hover { background: var(--nft-surface-3); border-color: var(--nft-border-h); }
        .nft-hist-icon {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 12px;
        }
        .nft-hist-info { flex: 1; min-width: 0; }
        .nft-hist-label { font-size: 11px; font-weight: 600; color: var(--nft-text); }
        .nft-hist-date { font-size: 9px; color: var(--nft-text-3); margin-top: 1px; }
        .nft-hist-amount { font-size: 11px; font-weight: 600; font-family: 'SF Mono', monospace; }

        /* Empty / Loading */
        .nft-empty { text-align: center; padding: 24px 16px; }
        .nft-empty i { font-size: 20px; color: var(--nft-text-3); margin-bottom: 6px; display: block; }
        .nft-empty p { font-size: 11px; color: var(--nft-text-3); }
        .nft-loading { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 24px; }
        .nft-loading-icon { width: 32px; height: 32px; opacity: 0.3; animation: nft-float 2s ease-in-out infinite; }

        /* Responsive */
        @media (max-width: 480px) {
            .nft-shell { padding: 0 10px 30px; }
            .nft-tier-grid { grid-template-columns: 1fr; }
            .nft-impact-grid { grid-template-columns: repeat(2, 1fr); }
            .nft-inv-grid { grid-template-columns: repeat(3, 1fr); }
            .nft-fusion-grid { grid-template-columns: repeat(3, 1fr); }
            .nft-fusion-preview { flex-wrap: wrap; gap: 6px; }
        }
    `,document.head.appendChild(e)}const Ax={async render(e){Bx(),await pd();const t=document.getElementById("store");t&&((t.innerHTML.trim()===""||e)&&(t.innerHTML=`
                <div class="nft-shell">

                    <!-- HEADER -->
                    <div class="nft-header">
                        <div class="nft-header-left">
                            <div class="nft-header-icon"><i class="fa-solid fa-gem"></i></div>
                            <div>
                                <div class="nft-header-title">Booster Market</div>
                                <div class="nft-header-sub">Buy Booster NFTs to keep more staking rewards. Higher tier = higher keep rate</div>
                            </div>
                        </div>
                        <button id="nft-refresh-btn" class="nft-refresh-btn"><i class="fa-solid fa-rotate"></i></button>
                    </div>

                    <!-- TUTOR BANNER -->
                    <div id="nft-tutor-banner"></div>

                    <!-- TIER CARDS GRID -->
                    <div id="nft-tier-grid" class="nft-tier-grid">
                        ${st.map(()=>`
                            <div class="nft-tier-card" style="min-height:200px">
                                <div class="nft-loading">
                                    <img src="./assets/bkc_logo_3d.png" class="nft-loading-icon" alt="">
                                    <span style="font-size:10px;color:var(--nft-text-3)">Loading...</span>
                                </div>
                            </div>
                        `).join("")}
                    </div>

                    <!-- REWARD IMPACT PREVIEW -->
                    <div id="nft-impact"></div>

                    <!-- MY NFTs + FUSION/SPLIT (merged) -->
                    <div class="nft-card">
                        <div id="nft-inv-toggle" class="nft-card-header">
                            <div class="nft-card-title">
                                <i class="fa-solid fa-wallet"></i> My NFTs
                                <span id="nft-inv-count" class="nft-card-badge">0</span>
                            </div>
                            <i id="nft-inv-chevron" class="fa-solid fa-chevron-down nft-card-chevron" style="transform:rotate(180deg)"></i>
                        </div>
                        <div id="nft-inv-body" class="nft-card-body">
                            <div id="nft-inv-grid" class="nft-inv-grid">
                                <div class="nft-empty" style="grid-column:1/-1"><i class="fa-solid fa-gem"></i><p>Loading...</p></div>
                            </div>
                            <div id="nft-fusion-section"></div>
                        </div>
                    </div>

                    <!-- NFT ACTIVITY (open by default) -->
                    <div class="nft-card">
                        <div id="nft-hist-toggle" class="nft-card-header">
                            <div class="nft-card-title">
                                <i class="fa-solid fa-clock-rotate-left"></i> NFT Activity
                                <span id="nft-hist-count" class="nft-card-badge">0</span>
                            </div>
                            <i id="nft-hist-chevron" class="fa-solid fa-chevron-down nft-card-chevron" style="transform:rotate(180deg)"></i>
                        </div>
                        <div id="nft-hist-body" class="nft-card-body">
                            <div id="nft-hist-list" class="nft-hist-list">
                                <div class="nft-loading">
                                    <img src="./assets/bkc_logo_3d.png" class="nft-loading-icon" alt="">
                                    <span style="font-size:10px;color:var(--nft-text-3)">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            `,Mx()),await Pi())},async update(){document.getElementById("store")&&!document.hidden&&await Pi()}};async function Pi(){try{await Promise.all([Ix(),Nn(),Xi(),Pn()]);const e=u.myBoosters||[];Pa=0,e.forEach(t=>{const a=Number(t.boostBips);a>Pa&&(Pa=a)}),await nn(),Nx(),on(),sn(),Te(),rn(),Ni()}catch(e){console.error("NFT Market data load error:",e)}}async function Ix(){if(!u.userAddress){eo=null,Ot=!1;return}try{const e=u.ecosystemContractPublic||u.ecosystemContract;if(e){const t=await ie(e,"tutorOf",[u.userAddress],gt.ZeroAddress);eo=t&&t!==gt.ZeroAddress?t:null,Ot=!!eo}}catch(e){console.error("Tutor data load error:",e)}}async function nn(){const e=st.find(t=>t.name==="Bronze");e&&await Px(e)}async function Px(e){var s;const t=e.boostBips,a=Tx(t);if(a){un.set(t,a);return}const n=`pool_${e.name.toLowerCase()}`;let o=E[n]||ec.get(t);if(!o){const i=E.nftPoolFactory||E.nftLiquidityPoolFactory;if(i&&u.publicProvider)try{o=await new gt.Contract(i,kx,u.publicProvider).getPoolAddress(t),o&&o!==gt.ZeroAddress&&ec.set(t,o)}catch(r){console.warn("Factory lookup failed for",e.name,r.message)}}if(!o||o===gt.ZeroAddress){un.set(t,{unavailable:!0});return}try{const i=new gt.Contract(o,td,u.publicProvider),[r,l,c]=await Promise.all([ie(i,"getBuyPrice",[],gt.MaxUint256).catch(()=>gt.MaxUint256),ie(i,"getSellPrice",[],0n).catch(()=>0n),i.getPoolInfo().catch(()=>null)]),d=r===gt.MaxUint256?0n:r,f=l,g=c?Number(c[1]):0,m=c?Number(c[2]):0,h=c?Number(c[4]):0,w=m>1;let y=((s=u.systemFees)==null?void 0:s.NFT_POOL_SELL_TAX_BIPS)||1000n;const k=typeof y=="bigint"?y:BigInt(y),v=f*k/10000n,T=f-v,I=u.myBoosters||[],N=u.rentalListings||[],S=new Set(N.map(re=>{var le;return(le=re.tokenId)==null?void 0:le.toString()})),$=Math.floor(Date.now()/1e3),F=I.filter(re=>Number(re.boostBips)===t),V=F.filter(re=>{var Pe;const le=(Pe=re.tokenId)==null?void 0:Pe.toString(),se=N.find(ct=>{var je;return((je=ct.tokenId)==null?void 0:je.toString())===le}),ke=S.has(le),G=se&&se.rentalEndTime&&Number(se.rentalEndTime)>$;return!ke&&!G}),X={buyPrice:d,sellPrice:f,netSellPrice:T,poolAddress:o,poolNFTCount:m,canBuy:w,userOwned:F.length,availableToSell:V.length,firstSellableTokenId:V.length>0?BigInt(V[0].tokenId):null,unavailable:!1};Cx(t,X),un.set(t,X)}catch(i){console.warn("Pool data error for",e.name,i.message),un.set(t,{unavailable:!0})}}function Nx(){const e=document.getElementById("nft-tutor-banner");if(e){if(!u.isConnected){e.innerHTML="";return}if(Ot){const t=`${eo.slice(0,6)}...${eo.slice(-4)}`;e.innerHTML=`
            <div class="nft-tutor-banner" style="background:rgba(74,222,128,0.06);border:1px solid rgba(74,222,128,0.15)">
                <i class="fa-solid fa-graduation-cap" style="color:var(--nft-green)"></i>
                <span style="color:var(--nft-green)">Tutor active (${t}) â€” 5% of rewards go to tutor instead of being burned</span>
            </div>
        `}else e.innerHTML=`
            <div class="nft-tutor-banner" style="background:rgba(239,68,68,0.06);border:1px solid rgba(239,68,68,0.15)">
                <i class="fa-solid fa-graduation-cap" style="color:var(--nft-red)"></i>
                <span style="color:var(--nft-red)">No tutor â€” 10% of staking rewards burned.</span>
                <a href="#" class="go-to-tutor">Set a Tutor</a>
                <span style="color:var(--nft-text-3);margin-left:2px">to reduce burn to 5%</span>
            </div>
        `}}function on(){const e=document.getElementById("nft-tier-grid");if(!e)return;const t=st.find(T=>T.name==="Bronze"),a=He("Bronze"),n=un.get(t.boostBips)||{},o=Pa===t.boostBips&&Pa>0,s=n.buyPrice||0n,i=n.netSellPrice||0n,r=n.poolNFTCount||0,l=n.userOwned||0,c=!n.canBuy,d=n.availableToSell===0,f=u.currentUserBalance||0n,g=s>0n&&s>f,m=s>0n?j(s).toFixed(1):"--",h=i>0n&&l>0?j(i).toFixed(1):"--";let w=!u.isConnected||c||g||s===0n,y=c?"Sold Out":g?"Low BKC":"Buy";u.isConnected||(y="Connect");let k=!u.isConnected||d,v="Sell";u.isConnected?l===0?v="No NFT":d&&(v="Rented"):v="--",e.innerHTML=`
        <div class="nft-tier-card ${o?"nft-user-tier":""}" style="border-color:${o?a.color:"var(--nft-border)"}" data-boost="${t.boostBips}">
            ${o?'<div class="nft-user-badge">YOUR TIER</div>':""}
            <div class="nft-tier-top">
                <div class="nft-tier-img" style="background:${a.bg};border:1px solid ${a.border}">
                    <img src="${a.image}" alt="Bronze" onerror="this.outerHTML='<span style=\\'font-size:28px\\'>${a.icon}</span>'">
                </div>
                <div>
                    <div class="nft-tier-name" style="color:${a.color}">${a.icon} Bronze</div>
                    <div class="nft-keep-badge" style="background:${a.bg};color:${a.color}">Keep ${a.keepRate}%</div>
                </div>
            </div>

            <div class="nft-tier-prices">
                <div class="nft-price-row">
                    <span class="nft-price-label"><i class="fa-solid fa-cart-plus" style="color:var(--nft-green)"></i> Buy</span>
                    <span class="nft-price-val" style="color:${c?"var(--nft-text-3)":"var(--nft-text)"}">${c?"Sold Out":`${m} BKC`}</span>
                </div>
                <div class="nft-price-row">
                    <span class="nft-price-label"><i class="fa-solid fa-money-bill-transfer" style="color:var(--nft-accent)"></i> Sell</span>
                    <span class="nft-price-val" style="color:${l>0?"var(--nft-text)":"var(--nft-text-3)"}">${l>0?`${h} BKC`:"Buy first"}</span>
                </div>
            </div>

            <div class="nft-tier-stats">
                <div class="nft-tier-stat">
                    <div class="nft-tier-stat-label">In Pool</div>
                    <div class="nft-tier-stat-val" style="color:${r>0?"var(--nft-green)":"var(--nft-red)"}">${r}</div>
                </div>
                <div class="nft-tier-stat">
                    <div class="nft-tier-stat-label">You Own</div>
                    <div class="nft-tier-stat-val" style="color:${l>0?a.color:"var(--nft-text-3)"}">${l}</div>
                </div>
            </div>

            <div class="nft-tier-actions">
                ${c?`
                    <button class="nft-action-btn" style="flex:1;background:var(--nft-surface-2);color:var(--nft-text-3);cursor:default" disabled>
                        <i class="fa-solid fa-store-slash" style="font-size:10px"></i> Sold Out
                    </button>
                `:`
                    <button class="nft-action-btn nft-buy-btn" data-action="buy" data-boost="${t.boostBips}" ${w?"disabled":""}>
                        <i class="fa-solid fa-cart-plus" style="font-size:10px"></i> ${y}
                    </button>
                `}
                ${l>0?`
                    <button class="nft-action-btn nft-sell-btn" data-action="sell" data-boost="${t.boostBips}" ${k?"disabled":""}>
                        <i class="fa-solid fa-money-bill-transfer" style="font-size:10px"></i> ${v}
                    </button>
                `:""}
            </div>
        </div>

        <div style="display:flex;align-items:center;justify-content:center;gap:6px;padding:10px 0 2px;flex-wrap:wrap">
            <span style="font-size:9px;color:var(--nft-text-3)">Fusion path:</span>
            <span style="padding:3px 8px;border-radius:6px;background:${Ce.Bronze.bg};border:1px solid ${Ce.Bronze.border};font-size:9px;font-weight:700;color:${Ce.Bronze.color}">${Ce.Bronze.icon} Bronze</span>
            <i class="fa-solid fa-arrow-right" style="font-size:7px;color:var(--nft-text-3)"></i>
            <span style="padding:3px 8px;border-radius:6px;background:${Ce.Silver.bg};border:1px solid ${Ce.Silver.border};font-size:9px;font-weight:700;color:${Ce.Silver.color}">${Ce.Silver.icon} Silver 70%</span>
            <i class="fa-solid fa-arrow-right" style="font-size:7px;color:var(--nft-text-3)"></i>
            <span style="padding:3px 8px;border-radius:6px;background:${Ce.Gold.bg};border:1px solid ${Ce.Gold.border};font-size:9px;font-weight:700;color:${Ce.Gold.color}">${Ce.Gold.icon} Gold 80%</span>
            <i class="fa-solid fa-arrow-right" style="font-size:7px;color:var(--nft-text-3)"></i>
            <span style="padding:3px 8px;border-radius:6px;background:${Ce.Diamond.bg};border:1px solid ${Ce.Diamond.border};font-size:9px;font-weight:700;color:${Ce.Diamond.color}">${Ce.Diamond.icon} Diamond 100%</span>
        </div>
    `}function sn(){const e=document.getElementById("nft-impact");if(!e)return;if(!u.isConnected){e.innerHTML="";return}const t=zx(Pa),a=t.keepRate,n=t.recycleRate,o=Ot?5:0,s=Ot?0:10,i=a-o-s,r=Pa<5e3,l=!Ot;e.innerHTML=`
        <div class="nft-impact">
            <div class="nft-impact-title"><i class="fa-solid fa-chart-pie"></i> Your Reward Distribution (on 100 BKC claimed)</div>
            <div class="nft-impact-grid">
                <div class="nft-impact-item">
                    <div class="nft-impact-num" style="color:var(--nft-green)">${i}</div>
                    <div class="nft-impact-label">You Keep</div>
                </div>
                <div class="nft-impact-item">
                    <div class="nft-impact-num" style="color:var(--nft-cyan)">${n}</div>
                    <div class="nft-impact-label">Recycled</div>
                </div>
                <div class="nft-impact-item">
                    <div class="nft-impact-num" style="color:${Ot?"var(--nft-accent)":"var(--nft-text-3)"}">${o}</div>
                    <div class="nft-impact-label">${Ot?"To Tutor":"Tutor"}</div>
                </div>
                <div class="nft-impact-item">
                    <div class="nft-impact-num" style="color:${s>0?"var(--nft-red)":"var(--nft-green)"}">${s}</div>
                    <div class="nft-impact-label">Burned</div>
                </div>
            </div>
            ${r||l?`
                <div class="nft-impact-cta">
                    ${r?`<span><i class="fa-solid fa-arrow-up" style="color:var(--nft-cyan);font-size:9px;margin-right:3px"></i><a href="#" class="go-to-diamond">Upgrade to Diamond</a> to keep ${Ot?"95":"90"}%</span>`:""}
                    ${r&&l?'<span style="color:var(--nft-text-3);margin:0 6px">|</span>':""}
                    ${l?'<span><i class="fa-solid fa-graduation-cap" style="color:var(--nft-accent);font-size:9px;margin-right:3px"></i><a href="#" class="go-to-tutor">Set a Tutor</a> to convert burn to tutor cut</span>':""}
                </div>
            `:`
                <div class="nft-impact-cta" style="color:var(--nft-green)">
                    <i class="fa-solid fa-check-circle" style="font-size:9px;margin-right:3px"></i> Maximum efficiency! ${a===100?"Diamond + Tutor = only 5% to tutor":""}
                </div>
            `}
        </div>
    `}function zx(e){return e>=5e3?{keepRate:100,recycleRate:0,name:"Diamond"}:e>=4e3?{keepRate:90,recycleRate:10,name:"Gold"}:e>=2500?{keepRate:80,recycleRate:20,name:"Silver"}:e>=1e3?{keepRate:70,recycleRate:30,name:"Bronze"}:{keepRate:50,recycleRate:50,name:"None"}}let kt="fuse";const De={0:"Bronze",1:"Silver",2:"Gold",3:"Diamond"};function dg(){const e=u.myBoosters||[],t=u.rentalListings||[],a=Math.floor(Date.now()/1e3),n={0:[],1:[],2:[],3:[]};for(const o of e){const s=Number(o.boostBips);let i=0;s>=5e3?i=3:s>=4e3?i=2:s>=2500&&(i=1);const r=t.find(d=>{var f,g;return((f=d.tokenId)==null?void 0:f.toString())===((g=o.tokenId)==null?void 0:g.toString())}),l=r&&r.rentalEndTime&&Number(r.rentalEndTime)>a;l||r&&!l||n[i].push({tokenId:Number(o.tokenId),tier:i,boost:s})}return n}function Te(){const e=document.getElementById("nft-fusion-section");if(!e)return;if(!u.isConnected){e.innerHTML="";return}u.myBoosters;const t=dg(),n=Object.values(t).reduce((o,s)=>o+s.length,0)>0;e.innerHTML=`
        <div class="nft-fusion-card">
            <div class="nft-fusion-tabs">
                <button class="nft-fusion-tab ${kt==="fuse"?"active":""}" data-fusion-tab="fuse">
                    <i class="fa-solid fa-fire"></i> Forge
                </button>
                <button class="nft-fusion-tab ${kt==="bulk"?"active":""}" data-fusion-tab="bulk">
                    <i class="fa-solid fa-layer-group"></i> Bulk
                </button>
                <button class="nft-fusion-tab ${kt==="split"?"active":""}" data-fusion-tab="split">
                    <i class="fa-solid fa-scissors"></i> Split
                </button>
            </div>
            <div class="nft-fusion-body">
                ${n?kt==="fuse"?Sx(t):kt==="bulk"?Lx(t):_x(t):$x()}
            </div>
            <div class="nft-fusion-stats" id="nft-fusion-stats"></div>
        </div>
    `,Wt.getFusionStats().then(o=>{const s=document.getElementById("nft-fusion-stats");if(!s)return;const i=[];if(o.totalFusions>0&&i.push(`${o.totalFusions} fusions`),o.totalSplits>0&&i.push(`${o.totalSplits} splits`),i.length===0){s.style.display="none";return}s.innerHTML=`<i class="fa-solid fa-chart-simple" style="font-size:8px;opacity:0.5"></i> ${i.join(" &middot; ")} on the platform`}).catch(()=>{})}function $x(){const e=["Bronze","Silver","Gold","Diamond"];return`
        <div style="padding:8px 4px;text-align:center">
            <div style="display:flex;align-items:center;justify-content:center;gap:4px;margin-bottom:16px">
                ${e.map((a,n)=>{const o=Ce[a],s=n===e.length-1;return`
            <div style="display:flex;flex-direction:column;align-items:center;gap:2px;flex:1;min-width:50px">
                <div style="font-size:${s?"28":"20"}px;${s?"filter:drop-shadow(0 0 8px rgba(34,211,238,0.3))":""}">${o.icon}</div>
                <div style="font-size:9px;font-weight:800;color:${o.color}">${a}</div>
                <div style="font-size:8px;color:var(--nft-text-3)">${o.keepRate}% keep</div>
            </div>
            ${s?"":'<div style="display:flex;align-items:center;color:var(--nft-text-3);font-size:10px;opacity:0.4;padding-top:0"><i class="fa-solid fa-chevron-right"></i></div>'}
        `}).join("")}
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;max-width:300px;margin:0 auto 14px">
                <div style="padding:10px 8px;border-radius:10px;background:rgba(245,158,11,0.05);border:1px solid rgba(245,158,11,0.12)">
                    <i class="fa-solid fa-fire" style="font-size:14px;color:#f59e0b;margin-bottom:4px;display:block"></i>
                    <div style="font-size:9px;font-weight:800;color:var(--nft-text);margin-bottom:2px">Forge</div>
                    <div style="font-size:8px;color:var(--nft-text-3);line-height:1.4">2 same-tier &rarr; 1 higher</div>
                </div>
                <div style="padding:10px 8px;border-radius:10px;background:rgba(139,92,246,0.05);border:1px solid rgba(139,92,246,0.12)">
                    <i class="fa-solid fa-scissors" style="font-size:14px;color:#a78bfa;margin-bottom:4px;display:block"></i>
                    <div style="font-size:9px;font-weight:800;color:var(--nft-text);margin-bottom:2px">Split</div>
                    <div style="font-size:8px;color:var(--nft-text-3);line-height:1.4">1 NFT &rarr; 2 lower-tier</div>
                </div>
            </div>
            <div style="font-size:10px;color:var(--nft-accent);font-weight:700">
                <i class="fa-solid fa-arrow-up" style="font-size:8px"></i> Buy Bronze above to start forging
            </div>
        </div>
    `}function Sx(e){const t=[];for(let d=0;d<=2;d++)e[d].length>=2&&t.push(d);if(t.length===0)return ye=[],ut=null,`
            <div class="nft-fusion-empty">
                <i class="fa-solid fa-fire"></i>
                Need 2+ NFTs of the same tier to forge.<br>
                <span style="display:inline-block;margin-top:6px;font-size:10px">${[0,1,2].map(f=>{const g=De[f],m=He(g),h=e[f].length;return`<span style="color:${m.color}">${m.icon} ${h}</span>`}).join(' <span style="opacity:0.3">/</span> ')}</span>
            </div>
        `;(ut===null||!t.includes(ut))&&(ut=t[0],ye=[]);const a=new Set(e[ut].map(d=>d.tokenId));ye=ye.filter(d=>a.has(d));const n=De[ut],o=He(n),s=[0,1,2].map(d=>{const f=De[d],g=He(f),m=e[d].length,h=d===ut,w=m<2;return`<button class="nft-fusion-filter ${h?"active":""}" data-fuse-filter="${d}" ${w?"disabled":""} style="${h?`border-color:${g.color};color:${g.color};background:${g.bg}`:""}">
            ${g.icon} ${f} <span class="ff-count">${m}</span>
        </button>`}).join(""),r=e[ut].map(d=>{const f=ye.includes(d.tokenId);return`<div class="nft-fusion-nft ${f?"selected":""}" data-fuse-nft="${d.tokenId}" style="${f?`border-color:${o.color}`:""}">
            <div class="nft-fusion-nft-check" style="background:${o.color}">&check;</div>
            <span class="nft-fusion-nft-icon">${o.icon}</span>
            <div class="nft-fusion-nft-id" style="color:${o.color}">#${d.tokenId}</div>
        </div>`}).join("");let l="";if(ye.length===2){const d=ut+1,f=De[d],g=He(f);l=`
            <div class="nft-forge-preview">
                <div class="nft-forge-source">
                    <span class="nft-forge-source-icon">${o.icon}</span>
                    <span class="nft-forge-source-id" style="color:${o.color}">#${ye[0]}</span>
                </div>
                <div class="nft-forge-op">+</div>
                <div class="nft-forge-source">
                    <span class="nft-forge-source-icon">${o.icon}</span>
                    <span class="nft-forge-source-id" style="color:${o.color}">#${ye[1]}</span>
                </div>
                <div class="nft-forge-arrow"><i class="fa-solid fa-angles-right"></i></div>
                <div class="nft-forge-result">
                    <span class="nft-forge-result-icon">${g.icon}</span>
                    <span class="nft-forge-result-name" style="color:${g.color}">${f}</span>
                </div>
            </div>
            <div class="nft-forge-fee"><i class="fa-solid fa-gas-pump"></i> <span id="fuse-fee-display">estimating...</span></div>
            <button class="nft-fusion-cta fuse-cta" id="fuse-execute-btn">
                <i class="fa-solid fa-fire"></i> Forge Now
            </button>
        `,setTimeout(()=>{Wt.getEstimatedFusionFee(ut).then(m=>{const h=document.getElementById("fuse-fee-display");h&&(h.textContent=`${Number(gt.formatEther(m)).toFixed(6)} BNB`)}).catch(()=>{const m=document.getElementById("fuse-fee-display");m&&(m.textContent="N/A")})},50)}const c=ye.length===0?`<i class="fa-solid fa-hand-pointer"></i> Select 2 ${n} NFTs to forge:`:ye.length===1?`<i class="fa-solid fa-hand-pointer"></i> Select 1 more ${n}:`:"";return`
        <div class="nft-fusion-filters">${s}</div>
        ${c?`<div class="nft-fusion-hint">${c}</div>`:""}
        <div class="nft-fusion-grid">${r}</div>
        ${l}
    `}function Lx(e){const t=[];for(let y=0;y<=2;y++)e[y].length>=4&&t.push(y);if(t.length===0)return oe=[],ve=null,Ge=null,`
            <div class="nft-fusion-empty">
                <i class="fa-solid fa-layer-group"></i>
                Need 4+ NFTs of the same tier to bulk forge.<br>
                <span style="display:inline-block;margin-top:6px;font-size:10px">${[0,1,2].map(k=>{const v=De[k],T=He(v),I=e[k].length;return`<span style="color:${T.color}">${T.icon} ${I}</span>`}).join(' <span style="opacity:0.3">/</span> ')}</span>
            </div>
        `;(ve===null||!t.includes(ve))&&(ve=t[0],oe=[],Ge=null);const a=new Set(e[ve].map(y=>y.tokenId));oe=oe.filter(y=>a.has(y));const n=De[ve],o=He(n),s=[0,1,2].map(y=>{const k=De[y],v=He(k),T=e[y].length,I=y===ve,N=T<4;return`<button class="nft-fusion-filter ${I?"active":""}" data-bulk-filter="${y}" ${N?"disabled":""} style="${I?`border-color:${v.color};color:${v.color};background:${v.bg}`:""}">
            ${v.icon} ${k} <span class="ff-count">${T}</span>
        </button>`}).join(""),i=[];for(let y=ve+1;y<=3;y++){const v=1<<y-ve,T=e[ve].length;if(Math.floor(T/v)<1)continue;const N=De[y],S=He(N),$=Ge===y;i.push(`<button class="nft-fusion-filter ${$?"active":""}" data-bulk-target="${y}" style="${$?`border-color:${S.color};color:${S.color};background:${S.bg}`:""}">
            &rarr; ${S.icon} ${N} <span class="ff-count">${v}:1</span>
        </button>`)}(Ge===null||Ge<=ve)&&(Ge=ve+1);const l=1<<Ge-ve,c=e[ve],d=Math.floor(c.length/l)*l,f=c.map(y=>{const k=oe.includes(y.tokenId);return`<div class="nft-fusion-nft ${k?"selected":""}" data-bulk-nft="${y.tokenId}" style="${k?`border-color:${o.color}`:""}">
            <div class="nft-fusion-nft-check" style="background:${o.color}">&check;</div>
            <span class="nft-fusion-nft-icon">${o.icon}</span>
            <div class="nft-fusion-nft-id" style="color:${o.color}">#${y.tokenId}</div>
        </div>`}).join(""),g=`<button class="nft-fusion-filter" id="bulk-select-all" style="font-size:9px">Select ${d}</button>`,m=oe.length>0?'<button class="nft-fusion-filter" id="bulk-clear" style="font-size:9px">Clear</button>':"";let h="";if(oe.length>=l&&oe.length%l===0){const y=oe.length/l,k=De[Ge],v=He(k);h=`
            <div style="margin-top:10px;padding:10px 12px;border-radius:10px;background:var(--nft-surface-2);border:1px solid var(--nft-border)">
                <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:8px">
                    <span style="font-size:12px;font-weight:800;color:${o.color}">${oe.length}x ${o.icon}</span>
                    <i class="fa-solid fa-angles-right" style="color:var(--nft-text-3);font-size:10px"></i>
                    <span style="font-size:12px;font-weight:800;color:${v.color}">${y}x ${v.icon} ${k}</span>
                </div>
                <div style="text-align:center;font-size:10px;color:var(--nft-text-3);margin-bottom:8px">
                    <i class="fa-solid fa-gas-pump" style="font-size:8px"></i> <span id="bulk-fee-display">estimating...</span>
                </div>
                <button class="nft-fusion-cta fuse-cta" id="bulk-fuse-execute-btn" style="width:100%">
                    <i class="fa-solid fa-layer-group"></i> Bulk Forge ${oe.length} â†’ ${y}x ${k}
                </button>
            </div>
        `,setTimeout(()=>{Wt.getEstimatedBulkFuseFee(ve,Ge,oe.length).then(T=>{const I=document.getElementById("bulk-fee-display");I&&(I.textContent=`${Number(gt.formatEther(T)).toFixed(6)} BNB`)}).catch(()=>{const T=document.getElementById("bulk-fee-display");T&&(T.textContent="N/A")})},50)}const w=oe.length>0?`<span style="color:${o.color};font-weight:700">${oe.length}</span> selected${oe.length%l!==0?` <span style="color:var(--nft-red);font-size:9px">(need multiples of ${l})</span>`:""}`:`Select ${l}+ ${n} NFTs:`;return`
        <div class="nft-fusion-filters">${s}</div>
        <div class="nft-fusion-filters" style="margin-bottom:8px">${i.join("")}</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
            <div class="nft-fusion-hint" style="margin-bottom:0"><i class="fa-solid fa-layer-group"></i> ${w}</div>
            <div style="display:flex;gap:4px">${g}${m}</div>
        </div>
        <div class="nft-fusion-grid">${f}</div>
        ${h}
    `}function _x(e){const t=[];for(let a=1;a<=3;a++)for(const n of e[a])t.push(n);if(t.length===0)return Ue=null,Ze=null,pt=!1,`
            <div class="nft-fusion-empty">
                <i class="fa-solid fa-scissors"></i>
                No splittable NFTs (need Silver or higher).<br>
                <span style="font-size:10px;opacity:0.7;display:inline-block;margin-top:4px">Forge 2 Bronze &rarr; Silver first</span>
            </div>
        `;if(Ue!==null&&!t.find(a=>a.tokenId===Ue)&&(Ue=null,Ze=null,pt=!1),Ue!==null&&Ze===null){const a=t.find(n=>n.tokenId===Ue);a&&(Ze=a.tier-1)}return`
        <div class="nft-fusion-hint"><i class="fa-solid fa-hand-pointer"></i> Select an NFT to split:</div>
        <div class="nft-fusion-grid" style="${Ue!==null?"margin-bottom:0":""}">${t.map(a=>{const n=De[a.tier],o=He(n),s=a.tokenId===Ue;return`<div class="nft-fusion-nft ${s?"selected":""}" data-split-nft="${a.tokenId}" data-split-nft-tier="${a.tier}" style="${s?`border-color:${o.color}`:""}">
                <div class="nft-fusion-nft-check" style="background:${o.color}">&check;</div>
                <span class="nft-fusion-nft-icon">${o.icon}</span>
                <div class="nft-fusion-nft-id" style="color:${o.color}">#${a.tokenId}</div>
            </div>`}).join("")}</div>
        ${Ue!==null?(()=>{const a=t.find(r=>r.tokenId===Ue);if(!a)return"";const n=De[a.tier],o=He(n),s=[];for(let r=a.tier-1;r>=0;r--){const c=1<<a.tier-r,d=De[r],f=He(d),g=Ze===r;s.push(`
                    <div class="nft-split-option ${g?"active":""}" data-split-target="${r}" data-split-source="${a.tier}" data-split-tokenid="${a.tokenId}">
                        <div class="nft-split-option-left">
                            <div class="nft-split-option-radio"></div>
                            <span class="nft-split-option-label">${c}x ${f.icon} ${d}</span>
                        </div>
                        <span class="nft-split-option-fee" id="split-fee-${a.tokenId}-${r}"><i class="fa-solid fa-spinner fa-spin" style="font-size:8px;opacity:0.3"></i></span>
                    </div>
                `)}let i="";if(pt){const r=1<<a.tier-Ze,l=De[Ze],c=He(l);i=`
                    <div class="nft-split-confirm">
                        <div class="nft-split-confirm-text">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            Burn <strong style="color:${o.color}">${n} #${a.tokenId}</strong> &rarr; ${r}x <strong style="color:${c.color}">${l}</strong>?<br>
                            This is <strong>irreversible</strong>.
                        </div>
                        <div class="nft-split-confirm-btns">
                            <button class="nft-split-confirm-cancel" id="split-cancel-btn">Cancel</button>
                            <button class="nft-split-confirm-go" id="split-confirm-btn" data-split-tokenid="${a.tokenId}" data-split-source="${a.tier}" data-split-target="${Ze}">
                                <i class="fa-solid fa-scissors"></i> Confirm Split
                            </button>
                        </div>
                    </div>
                `}return setTimeout(()=>Rx(a.tokenId,a.tier),50),`
                <div class="nft-split-options">
                    <div class="nft-split-header">
                        <span class="nft-split-header-icon">${o.icon}</span>
                        <div class="nft-split-header-info">
                            <div class="nft-split-header-name" style="color:${o.color}">${n} #${a.tokenId}</div>
                            <div class="nft-split-header-sub">Choose target tier:</div>
                        </div>
                    </div>
                    ${s.join("")}
                    ${pt?"":`
                        <button class="nft-fusion-cta split-cta" id="split-execute-btn" style="margin-top:10px"
                            data-split-tokenid="${a.tokenId}" data-split-source="${a.tier}">
                            <i class="fa-solid fa-scissors"></i> Split
                        </button>
                    `}
                    ${i}
                </div>
            `})():""}
    `}async function Rx(e,t){for(let a=t-1;a>=0;a--){const n=document.getElementById(`split-fee-${e}-${a}`);if(n)try{const o=await Wt.getEstimatedMultiSplitFee(t,a);n.innerHTML=`<span style="opacity:0.5"><i class="fa-solid fa-gas-pump" style="font-size:7px"></i></span> ${Number(gt.formatEther(o)).toFixed(6)} BNB`}catch{n.textContent="N/A"}}}function rn(){const e=document.getElementById("nft-inv-grid"),t=document.getElementById("nft-inv-count");if(!e)return;const a=u.myBoosters||[];if(t&&(t.textContent=a.length),!u.isConnected){e.innerHTML='<div class="nft-empty" style="grid-column:1/-1"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>';return}if(a.length===0){e.innerHTML=`
            <div class="nft-empty" style="grid-column:1/-1">
                <i class="fa-solid fa-gem"></i>
                <p>No NFTs owned</p>
                <p style="font-size:10px;color:var(--nft-text-3);margin-top:4px">Buy from a tier above to reduce your recycle rate</p>
            </div>
        `;return}const n=u.rentalListings||[],o=new Set(n.map(i=>{var r;return(r=i.tokenId)==null?void 0:r.toString()})),s=Math.floor(Date.now()/1e3);e.innerHTML=a.map(i=>{var w;const r=st.find(y=>y.boostBips===Number(i.boostBips)),l=He(r==null?void 0:r.name),c=(w=i.tokenId)==null?void 0:w.toString(),d=n.find(y=>{var k;return((k=y.tokenId)==null?void 0:k.toString())===c}),f=o.has(c),g=d&&d.rentalEndTime&&Number(d.rentalEndTime)>s;let m="";g?m='<div class="nft-inv-status" style="background:rgba(59,130,246,0.8);color:white">Rented</div>':f&&(m='<div class="nft-inv-status" style="background:rgba(74,222,128,0.8);color:#000">Listed</div>');const h=!f&&!g;return`
            <div class="nft-inv-item" style="${h?"":"opacity:0.5"}">
                ${m}
                <div class="nft-inv-img" style="background:${l.bg};border:1px solid ${l.border}">
                    <img src="${l.image}" alt="${r==null?void 0:r.name}" onerror="this.outerHTML='<span style=\\'font-size:24px\\'>${l.icon}</span>'">
                </div>
                <div class="nft-inv-name" style="color:${l.color}">${(r==null?void 0:r.name)||"NFT"}</div>
                <div class="nft-inv-id">#${i.tokenId}</div>
                <div class="nft-inv-actions">
                    ${h?`<a href="#" class="nft-inv-rent go-to-rental" data-tokenid="${i.tokenId}">Rent</a>`:""}
                    <a href="#" class="nft-inv-metamask" data-add-wallet="${i.tokenId}" data-tier-name="${(r==null?void 0:r.name)||"NFT"}" title="Add to MetaMask">
                        <i class="fa-solid fa-wallet" style="font-size:9px"></i>
                    </a>
                </div>
            </div>
        `}).join("")}const Fx=new Set(["NFTBOUGHT","NFTSOLD","NFT_BOUGHT","NFT_SOLD","NFTPURCHASED","NFT_PURCHASED","NFTFUSED","NFTSPLIT","RENTALLISTED","RENTALRENTED","RENTALWITHDRAWN","RENTALEARNINGSWITHDRAWN"]);function Dx(e){const t=e.toUpperCase();return t.includes("BOUGHT")||t.includes("PURCHASED")?{icon:"fa-cart-plus",color:"#22c55e",bg:"rgba(34,197,94,0.12)",label:"Bought"}:t.includes("SOLD")?{icon:"fa-money-bill-transfer",color:"#f59e0b",bg:"rgba(245,158,11,0.12)",label:"Sold"}:t.includes("FUSE")?{icon:"fa-fire",color:"#f97316",bg:"rgba(249,115,22,0.12)",label:"Forged"}:t.includes("SPLIT")?{icon:"fa-scissors",color:"#a78bfa",bg:"rgba(167,139,250,0.12)",label:"Split"}:t==="RENTALRENTED"?{icon:"fa-handshake",color:"#3b82f6",bg:"rgba(59,130,246,0.12)",label:"Rented"}:t==="RENTALLISTED"?{icon:"fa-tag",color:"#14b8a6",bg:"rgba(20,184,166,0.12)",label:"Listed"}:t==="RENTALWITHDRAWN"?{icon:"fa-rotate-left",color:"#6b7280",bg:"rgba(107,114,128,0.12)",label:"Unlisted"}:t==="RENTALEARNINGSWITHDRAWN"?{icon:"fa-coins",color:"#eab308",bg:"rgba(234,179,8,0.12)",label:"Earnings"}:{icon:"fa-circle-info",color:"#9ca3af",bg:"rgba(156,163,175,0.08)",label:e}}async function Ni(){const e=document.getElementById("nft-hist-list");if(!u.userAddress){e&&(e.innerHTML='<div class="nft-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>');return}try{const t=ca.getHistory||"https://gethistory-4wvdcuoouq-uc.a.run.app",a=await fetch(`${t}/${u.userAddress}`);if(!a.ok)throw new Error(`HTTP ${a.status}`);Qn=(await a.json()||[]).filter(s=>{const i=(s.type||"").toUpperCase();return Fx.has(i)||i.includes("NFTBOUGHT")||i.includes("NFTSOLD")||i.includes("NFTPURCHASED")||i.includes("NFTFUSE")||i.includes("NFTSPLIT")});const o=document.getElementById("nft-hist-count");o&&(o.textContent=Qn.length),tc()}catch(t){console.error("History load error:",t),Qn=[],tc()}}function tc(){const e=document.getElementById("nft-hist-list");if(e){if(!u.isConnected){e.innerHTML='<div class="nft-empty"><i class="fa-solid fa-wallet"></i><p>Connect wallet to view</p></div>';return}if(Qn.length===0){e.innerHTML=`
            <div class="nft-empty">
                <i class="fa-solid fa-receipt"></i>
                <p>No NFT activity yet</p>
            </div>
        `;return}e.innerHTML=Qn.slice(0,30).map(t=>{const a=(t.type||"").toUpperCase(),n=t.details||{},o=Ex(t.timestamp||t.createdAt),s=Dx(a),i=t.txHash?`${yx}${t.txHash}`:"#";let r="";const l=n.tokenId||n.burnedTokenId||"";a.includes("FUSE")?r=`<span style="font-family:monospace;font-size:9px;color:var(--nft-text-2)">#${n.tokenId1} + #${n.tokenId2}</span>
                <i class="fa-solid fa-arrow-right" style="font-size:7px;color:var(--nft-text-3);margin:0 3px"></i>
                <span style="font-size:9px;font-weight:700;color:#f97316">${n.resultTier||""} #${n.newTokenId||""}</span>`:a.includes("SPLIT")?((n.newTokenIds||[]).map(d=>`#${d}`).join(", "),r=`<span style="font-family:monospace;font-size:9px;color:var(--nft-text-2)">${n.sourceTier||""} #${n.burnedTokenId||""}</span>
                <i class="fa-solid fa-arrow-right" style="font-size:7px;color:var(--nft-text-3);margin:0 3px"></i>
                <span style="font-size:9px;font-weight:700;color:#a78bfa">${n.mintCount||""}x ${n.targetTier||""}</span>`):l&&(r=`<span style="font-size:9px;color:var(--nft-accent);font-family:monospace">#${l}</span>`);let c="";try{const d=n.price||n.payout||n.rentalCost||n.amount||"0";if(typeof d=="string"&&d!=="0"){const f=j(BigInt(d));if(f>.001){const g=a.includes("SOLD")||a==="RENTALEARNINGSWITHDRAWN"||a==="RENTALRENTED",m=(a==="RENTALEARNINGSWITHDRAWN"||a.includes("BOUGHT")||a.includes("SOLD"),"BKC");c=`<span class="nft-hist-amount" style="color:${g?"var(--nft-green)":"var(--nft-text)"}">${g?"+":"-"}${f.toFixed(2)} <span style="font-size:8px;color:var(--nft-text-3)">${m}</span></span>`}}}catch{}return`
            <a href="${i}" target="_blank" class="nft-hist-item">
                <div class="nft-hist-icon" style="background:${s.bg}">
                    <i class="fa-solid ${s.icon}" style="color:${s.color}"></i>
                </div>
                <div class="nft-hist-info">
                    <div class="nft-hist-label">
                        ${s.label}
                        ${r}
                    </div>
                    <div class="nft-hist-date">${o}</div>
                </div>
                <div style="display:flex;align-items:center;gap:6px">
                    ${c}
                    <i class="fa-solid fa-arrow-up-right-from-square" style="font-size:8px;color:var(--nft-text-3)"></i>
                </div>
            </a>
        `}).join("")}}function Mx(){const e=document.getElementById("store");e&&e.addEventListener("click",async t=>{if(t.target.closest("#nft-refresh-btn")){const v=t.target.closest("#nft-refresh-btn").querySelector("i");v.classList.add("fa-spin"),tn(),await Promise.all([Nn(!0),Xi()]),await Pi(),v.classList.remove("fa-spin");return}if(t.target.closest("#nft-inv-toggle")){const k=document.getElementById("nft-inv-body"),v=document.getElementById("nft-inv-chevron");if(k&&v){const T=k.style.display==="none";k.style.display=T?"":"none",v.style.transform=T?"rotate(180deg)":""}return}if(t.target.closest("#nft-hist-toggle")){const k=document.getElementById("nft-hist-body"),v=document.getElementById("nft-hist-chevron");if(k&&v){const T=k.style.display==="none";k.style.display=T?"":"none",v.style.transform=T?"rotate(180deg)":""}return}const a=t.target.closest(".nft-fusion-tab");if(a){kt=a.dataset.fusionTab,ye=[],ut=null,Ue=null,Ze=null,pt=!1,oe=[],ve=null,Ge=null,Te();return}const n=t.target.closest(".nft-fusion-filter");if(n&&!n.disabled){ut=Number(n.dataset.fuseFilter),ye=[],Te();return}const o=t.target.closest("[data-fuse-nft]");if(o&&kt==="fuse"){const k=Number(o.dataset.fuseNft),v=ye.indexOf(k);v>=0?ye.splice(v,1):ye.length<2&&ye.push(k),Te();return}const s=t.target.closest("#fuse-execute-btn");if(s&&!s.disabled&&!We&&ye.length===2){t.preventDefault();const k=ye[0],v=ye[1];We=!0;try{await Wt.fuseNfts({tokenId1:k,tokenId2:v,button:s,onSuccess:async({newTokenId:T,resultTier:I})=>{const N=De[I]||"NFT";x(`Fused into ${N} #${T}!`,"success"),jn({remove:[k,v],add:[{tokenId:T,boostBips:pi[I]||1e3}]}),ye=[],tn(),await nn(),on(),rn(),sn(),Te()},onError:T=>{!T.cancelled&&T.type!=="user_rejected"&&x("Fuse failed: "+(T.message||"Unknown"),"error")}})}finally{We=!1}return}const i=t.target.closest("[data-bulk-filter]");if(i&&!i.disabled){ve=Number(i.dataset.bulkFilter),oe=[],Ge=null,Te();return}const r=t.target.closest("[data-bulk-target]");if(r){Ge=Number(r.dataset.bulkTarget),oe=[],Te();return}const l=t.target.closest("[data-bulk-nft]");if(l&&kt==="bulk"){const k=Number(l.dataset.bulkNft),v=oe.indexOf(k);v>=0?oe.splice(v,1):oe.push(k),Te();return}if(t.target.closest("#bulk-select-all")&&kt==="bulk"){const v=dg()[ve]||[],I=1<<(Ge||ve+1)-ve,N=Math.floor(v.length/I)*I;oe=v.slice(0,N).map(S=>S.tokenId),Te();return}if(t.target.closest("#bulk-clear")&&kt==="bulk"){oe=[],Te();return}const c=t.target.closest("#bulk-fuse-execute-btn");if(c&&!c.disabled&&!We&&oe.length>0){t.preventDefault();const k=[...oe],v=Ge;We=!0;try{await Wt.bulkFuseNfts({tokenIds:k,targetTier:v,button:c,onSuccess:async({newTokenIds:T,targetTier:I,inputCount:N})=>{const S=De[I]||"NFT";x(`Bulk forged ${N} NFTs into ${T.length}x ${S}!`,"success"),jn({remove:k,add:T.map($=>({tokenId:$,boostBips:pi[I]||1e3}))}),oe=[],tn(),await nn(),on(),rn(),sn(),Te()},onError:T=>{!T.cancelled&&T.type!=="user_rejected"&&x("Bulk forge failed: "+(T.message||"Unknown"),"error")}})}finally{We=!1}return}const d=t.target.closest("[data-split-nft]");if(d&&kt==="split"&&!t.target.closest(".nft-split-options")){const k=Number(d.dataset.splitNft);Ue===k?(Ue=null,Ze=null,pt=!1):(Ue=k,Ze=Number(d.dataset.splitNftTier)-1,pt=!1),Te();return}const f=t.target.closest(".nft-split-option");if(f){Ze=Number(f.dataset.splitTarget),pt=!1,Te();return}const g=t.target.closest("#split-execute-btn");if(g&&!g.disabled&&!We){t.preventDefault(),pt=!0,Te();return}if(t.target.closest("#split-cancel-btn")){pt=!1,Te();return}const h=t.target.closest("#split-confirm-btn");if(h&&!h.disabled&&!We){t.preventDefault();const k=Number(h.dataset.splitTokenid),v=Number(h.dataset.splitSource),T=Number(h.dataset.splitTarget),I=v-T;We=!0;try{await(I===1?Wt.splitNft:Wt.splitNftTo)({...I===1?{tokenId:k,button:h}:{tokenId:k,targetTier:T,button:h},onSuccess:async({newTokenIds:$,targetTier:F})=>{const V=De[F]||"NFT";x(`Split into ${$.length}x ${V}!`,"success"),jn({remove:[k],add:$.map(X=>({tokenId:X,boostBips:pi[F]||1e3}))}),Ue=null,Ze=null,pt=!1,tn(),await nn(),on(),rn(),sn(),Te()},onError:$=>{pt=!1,Te(),!$.cancelled&&$.type!=="user_rejected"&&x("Split failed: "+($.message||"Unknown"),"error")}})}finally{We=!1}return}const w=t.target.closest("[data-add-wallet]");if(w){t.preventDefault();const k=w.dataset.addWallet,v=w.dataset.tierName||"NFT";Yc(k,v);return}if(t.target.closest(".go-to-tutor")){t.preventDefault(),window.navigateTo("referral");return}if(t.target.closest(".go-to-rental")){t.preventDefault(),window.navigateTo("rental");return}if(t.target.closest(".go-to-diamond")){t.preventDefault();return}if(t.target.closest(".go-to-staking")){t.preventDefault(),window.navigateTo("staking");return}const y=t.target.closest(".nft-action-btn");if(y&&!y.disabled){if(t.preventDefault(),t.stopPropagation(),We)return;const k=y.dataset.action,v=Number(y.dataset.boost);if(!u.isConnected){window.openConnectModal();return}const T=st.find(S=>S.boostBips===v);if(!T)return;const I=un.get(v);if(!I||I.unavailable)return;const N=I.poolAddress;if(!N){x("Pool address not found","error");return}We=!0;try{if(k==="buy")await Ei.buyFromPool({poolAddress:N,button:y,onSuccess:async(S,$)=>{x(`${T.name} NFT purchased!`,"success"),tn(),$!=null&&jn({add:[{tokenId:$,boostBips:v}]}),await nn(),on(),rn(),sn(),Te(),Ni()},onError:S=>{!S.cancelled&&S.type!=="user_rejected"&&x("Buy failed: "+(S.message||S.reason||"Unknown"),"error")}});else{const S=I.firstSellableTokenId;if(!S){x("No NFT available to sell","error"),We=!1;return}await Ei.sellToPool({poolAddress:N,tokenId:S,button:y,onSuccess:async()=>{x(`${T.name} NFT sold!`,"success"),tn(),jn({remove:[S]}),await nn(),on(),rn(),sn(),Te(),Ni()},onError:$=>{!$.cancelled&&$.type!=="user_rejected"&&x("Sell failed: "+($.message||$.reason||"Unknown"),"error")}})}}finally{We=!1}}})}const jr="https://sepolia.etherscan.io/tx/",Ox="https://sepolia.etherscan.io/address/",Ux=(E==null?void 0:E.fortunePool)||"0x123d881D96aD01c5C47996eC18D275eC87B7Dc96",mn=1e3,Hx=3e3,ac={pt:{title:"Compartilhe & Ganhe!",subtitle:`+${mn} pontos para o Airdrop`,later:"Talvez depois"},en:{title:"Share & Earn!",subtitle:`+${mn} points for Airdrop`,later:"Maybe later"},es:{title:"Â¡Comparte y Gana!",subtitle:`+${mn} puntos para el Airdrop`,later:"QuizÃ¡s despuÃ©s"}},jx={pt:{win:e=>`ðŸŽ‰ Ganhei ${e.toLocaleString()} BKC no Fortune Pool!

ðŸ¯ Loteria on-chain com resultados instantÃ¢neos!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #opBNB`,lose:`ðŸ¯ Jogando Fortune Pool no @backcoin!

Loteria on-chain verificÃ¡vel!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #opBNB`},en:{win:e=>`ðŸŽ‰ Just won ${e.toLocaleString()} BKC on Fortune Pool!

ðŸ¯ On-chain lottery with instant results!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #opBNB`,lose:`ðŸ¯ Playing Fortune Pool on @backcoin!

Verifiable on-chain lottery!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #opBNB`},es:{win:e=>`ðŸŽ‰ Â¡GanÃ© ${e.toLocaleString()} BKC en Fortune Pool!

ðŸ¯ Â¡LoterÃ­a on-chain con resultados instantÃ¡neos!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #opBNB`,lose:`ðŸ¯ Â¡Jugando Fortune Pool en @backcoin!

LoterÃ­a on-chain verificable!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #opBNB`}},Wx={pt:"./assets/pt.png",en:"./assets/en.png",es:"./assets/es.png"};let Wn="en";const xe=[{id:0,name:"Easy",emoji:"ðŸ€",range:4,multiplier:3.2,chance:"25%",color:"emerald",hex:"#10b981",bgFrom:"from-emerald-500/20",bgTo:"to-green-600/10",borderColor:"border-emerald-500/50",textColor:"text-emerald-400"},{id:1,name:"Medium",emoji:"âš¡",range:20,multiplier:16,chance:"5%",color:"violet",hex:"#8b5cf6",bgFrom:"from-violet-500/20",bgTo:"to-purple-600/10",borderColor:"border-violet-500/50",textColor:"text-violet-400"},{id:2,name:"Hard",emoji:"ðŸ‘‘",range:100,multiplier:80,chance:"1%",color:"amber",hex:"#f59e0b",bgFrom:"from-amber-500/20",bgTo:"to-orange-600/10",borderColor:"border-amber-500/50",textColor:"text-amber-400"}],zi=xe.reduce((e,t)=>e+t.multiplier,0),Gx=xe[2].multiplier;xe[2].range;const ug=1-xe.reduce((e,t)=>e*(1-1/t.range),1),Kx=(ug*100).toFixed(0);Math.round((ug-1/xe[0].range)/(1/xe[0].range)*100);const C={mode:"combo",phase:"intro",guess:2,guesses:[2,5,50],comboStep:0,wager:10,gameId:null,result:null,txHash:null,poolData:null,history:[],serviceFee:0n,serviceFee1x:0n,serviceFee5x:0n,tiersData:null,commitment:{hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:2,waitStartTime:null,canReveal:!1}};let Qe=null;function Rt(e){switch(e){case"easy":return{tiers:[xe[0]],tierMask:1,multi:xe[0].multiplier,isSingle:!0};case"medium":return{tiers:[xe[1]],tierMask:2,multi:xe[1].multiplier,isSingle:!0};case"hard":return{tiers:[xe[2]],tierMask:4,multi:xe[2].multiplier,isSingle:!0};case"combo":return{tiers:xe,tierMask:7,multi:zi,isSingle:!1};default:return{tiers:[xe[0]],tierMask:1,multi:xe[0].multiplier,isSingle:!0}}}function Vx(){if(document.getElementById("fortune-styles-v11"))return;const e=document.createElement("style");e.id="fortune-styles-v11",e.textContent=`
        /* (tiger animations removed for mobile optimization) */

        /* Step wizard intro */
        @keyframes intro-pop { 0% { transform: scale(0); } 70% { transform: scale(1.15); } 100% { transform: scale(1); } }
        .intro-pop { animation: intro-pop 0.6s ease-out; }
        @keyframes intro-fade { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        .intro-fade { animation: intro-fade 0.5s ease-out 0.3s both; }
        @keyframes intro-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .intro-pulse { animation: intro-pulse 2s ease-in-out infinite 1s; }

        /* Hide number input arrows */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] { -moz-appearance: textfield; }

        /* Slot spin */
        @keyframes slot-spin {
            0% { transform: translateY(-100%); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        .slot-spin { animation: slot-spin 0.1s linear infinite; }

        /* Number reveal */
        @keyframes number-reveal {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(10deg); }
            70% { transform: scale(0.9) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .number-reveal { animation: number-reveal 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; }

        /* Match/Miss */
        @keyframes match-pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        .match-pulse { animation: match-pulse 0.8s ease-out 3; }
        @keyframes miss-shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .miss-shake { animation: miss-shake 0.5s ease-out; }

        /* Glow pulse */
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px var(--glow-color, rgba(249,115,22,0.3)); }
            50% { box-shadow: 0 0 40px var(--glow-color, rgba(249,115,22,0.6)); }
        }
        .glow-pulse { animation: glow-pulse 1s ease-in-out infinite; }

        /* Progress bar shimmer */
        @keyframes progress-shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        @keyframes progress-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.75; }
        }
        .progress-animate {
            background: linear-gradient(90deg, #10b981, #f59e0b, #ea580c, #f59e0b, #10b981) !important;
            background-size: 200% 100% !important;
            animation: progress-shimmer 2s linear infinite, progress-pulse 1.5s ease-in-out infinite;
        }

        /* Confetti */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .confetti {
            position: fixed;
            pointer-events: none;
            animation: confetti-fall 3s ease-out forwards;
            z-index: 9999;
        }
        .confetti-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999;
        }

        /* Coin rain */
        @keyframes coin-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .coin {
            position: fixed; font-size: 24px; pointer-events: none;
            animation: coin-fall 3s ease-out forwards; z-index: 9999;
        }

        /* Slider */
        .fortune-slider {
            -webkit-appearance: none;
            height: 8px; border-radius: 4px; background: #27272a;
        }
        .fortune-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px; height: 24px; border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            cursor: pointer; box-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }
        .fortune-slider::-moz-range-thumb {
            width: 24px; height: 24px; border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            cursor: pointer; border: none;
        }

        /* Waiting dots */
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .waiting-dots::after { content: ''; animation: dots 1.5s infinite; }

        /* Waiting phase */
        @keyframes countdown-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .countdown-pulse { animation: countdown-pulse 1s ease-in-out infinite; }
        @keyframes waiting-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        .waiting-glow { animation: waiting-glow 2s ease-in-out infinite; }
        @keyframes hourglass-spin {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
            100% { transform: rotate(360deg); }
        }
        .hourglass-spin { animation: hourglass-spin 2s ease-in-out infinite; }

        /* Processing pulse */
        @keyframes processing-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.98); }
        }
        .processing-pulse { animation: processing-pulse 1.5s ease-in-out infinite; }

        /* Prize pool glow */
        @keyframes prize-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.15), inset 0 0 30px rgba(245, 158, 11, 0.05); }
            50% { box-shadow: 0 0 35px rgba(245, 158, 11, 0.3), inset 0 0 40px rgba(245, 158, 11, 0.1); }
        }
        .prize-glow { animation: prize-glow 3s ease-in-out infinite; }

        /* Tab active indicator */
        .tab-active {
            border-bottom: 3px solid #f59e0b;
            color: #f59e0b !important;
        }

        /* Reel land animation */
        @keyframes reel-land {
            0% { transform: translateY(-300%); opacity: 0; }
            60% { transform: translateY(10%); opacity: 1; }
            80% { transform: translateY(-5%); }
            100% { transform: translateY(0); opacity: 1; }
        }
        .reel-land { animation: reel-land 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    `,document.head.appendChild(e)}function Yx(){Vx();const e=document.getElementById("fortune");if(!e){console.error("[FortunePool] Container #fortune not found!");return}e.innerHTML=`
        <div class="max-w-md mx-auto px-4 py-3">
            <div id="game-area"></div>
        </div>
    `,fe(),Qo(),Xx()}function qx(){Qe&&(clearInterval(Qe),Qe=null),C.phase="intro",C.result=null,C._balanceLoaded=!1,C._wagerInit=!1,C.commitment={hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:C.commitment.revealDelay||2,waitStartTime:null,canReveal:!1}}async function nc(){var a;if(!u.userAddress)return;const e=JSON.parse(localStorage.getItem("fortune_pending_games")||"{}"),t=Object.entries(e).find(([,n])=>{var o,s;return((o=n.player)==null?void 0:o.toLowerCase())===((s=u.userAddress)==null?void 0:s.toLowerCase())&&!n.revealed});if(t){const[n,o]=t;console.log("[FortunePool] Recovering active game from localStorage:",n);try{if(u.fortunePoolContractPublic){const s=await u.fortunePoolContractPublic.getGameStatus(Number(n)),i=Number(s.status);if(i===0||i===3){console.log("[FortunePool] Game",n,"is expired on-chain, clearing"),delete e[n],localStorage.setItem("fortune_pending_games",JSON.stringify(e)),x("Previous game expired. Start a new one!","info"),C.phase="tier",fe();return}}}catch{}C.gameId=Number(n),C.commitment.userSecret=o.userSecret,C.mode=o.tierMask===1?"easy":o.tierMask===2?"medium":o.tierMask===4?"hard":"combo",C.guesses=o.guesses||[2,5,50],C.guess=((a=o.guesses)==null?void 0:a[0])||(C.mode==="hard"?50:C.mode==="medium"?5:2),C.commitment.waitStartTime=o.commitTimestamp||Date.now(),C.commitment.canReveal=!0,C.phase="waiting",fg(),mg();return}x("You have an active game but recovery data was lost. Wait ~50s for it to expire, then try again.","error"),C.phase="tier",fe()}async function Xx(){var e,t;if(u.userAddress)try{const a=JSON.parse(localStorage.getItem("fortune_pending_games")||"{}"),n=Object.entries(a).find(([,o])=>{var s,i;return((s=o.player)==null?void 0:s.toLowerCase())===((i=u.userAddress)==null?void 0:i.toLowerCase())&&!o.revealed});if(n){const[o,s]=n;console.log("[FortunePool] Recovering pending game:",o);try{if(u.fortunePoolContractPublic){const i=await u.fortunePoolContractPublic.getGameStatus(Number(o)),r=Number(i.status);if(r===0||r===3){console.log("[FortunePool] Pending game",o,"is expired, clearing"),delete a[o],localStorage.setItem("fortune_pending_games",JSON.stringify(a)),x("Previous game expired. Start a new one!","info");return}}}catch{}C.gameId=s.gameId||Number(o),C.commitment.userSecret=s.userSecret,C.mode=s.tierMask===1?"easy":s.tierMask===2?"medium":s.tierMask===4?"hard":"combo",C.guesses=s.guesses||[2,5,50],C.guess=((e=s.guesses)==null?void 0:e[0])||(C.mode==="hard"?50:C.mode==="medium"?5:2),C.wager=s.wagerAmount?Number(((t=window.ethers)==null?void 0:t.formatEther(BigInt(s.wagerAmount)))||10):10,C.commitment.waitStartTime=s.commitTimestamp||Date.now(),C.commitment.canReveal=!1,C.phase="waiting",fe(),sh()}}catch(a){console.warn("[FortunePool] Pending game recovery failed:",a)}}function pg(){try{const e=JSON.parse(localStorage.getItem("fortune_pending_games")||"{}");C.gameId&&e[C.gameId]&&(delete e[C.gameId],localStorage.setItem("fortune_pending_games",JSON.stringify(e)))}catch{}C.phase="tier",C.gameId=null,C.commitment={hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:2,waitStartTime:null,canReveal:!1},_e=0,x("Previous game expired. Start a new one!","info"),fe()}function fe(){const e=document.getElementById("game-area");if(e)switch(C.phase){case"intro":oc(e);break;case"tier":Jx(e);break;case"numbers":Zx(e);break;case"wager":Qx(e);break;case"processing":nh(e);break;case"waiting":oh(e);break;case"result":lh(e);break;default:oc(e)}}function oc(e){var n;const t=C.poolData?j(C.poolData.prizePool||0n).toFixed(0)+" BKC":"...";e.innerHTML=`
        <div id="intro-splash" class="flex flex-col items-center justify-center min-h-[65vh] text-center cursor-pointer">
            <img src="./assets/fortune.png" alt="Fortune Pool" class="w-40 h-40 object-contain mb-4 intro-pop drop-shadow-[0_0_30px_rgba(245,158,11,0.3)]"
                 onerror="this.outerHTML='<div class=\\'text-7xl mb-5 intro-pop\\'>ðŸ¯</div>'">
            <p class="text-zinc-500 text-xs uppercase tracking-[0.3em] mb-2 intro-fade">Accumulated Prize</p>
            <p class="text-4xl font-black text-amber-400 intro-fade intro-pulse" id="intro-prize">${t}</p>
            <p class="text-zinc-400 text-sm mt-3 intro-fade">Win up to <span class="text-amber-400 font-bold">${Gx}x</span> your bet</p>
            <div class="mt-8 text-zinc-600 text-xs animate-pulse intro-fade">Tap to play</div>
        </div>
    `;const a=()=>{C.phase==="intro"&&(C.phase="tier",fe())};(n=document.getElementById("intro-splash"))==null||n.addEventListener("click",a),setTimeout(a,2500)}function Jx(e){e.innerHTML=`
        <div class="space-y-3">
            <div class="flex items-center justify-between px-1 mb-1">
                <p class="text-white font-bold text-lg">Choose Your Game</p>
                <span class="text-xs text-zinc-500">Step 1 of 3</span>
            </div>

            <div class="space-y-2.5">
                ${xe.map(t=>`
                    <button class="tier-card w-full flex items-center gap-4 p-4 bg-gradient-to-r ${t.bgFrom} ${t.bgTo} border ${t.borderColor} rounded-2xl hover:scale-[1.02] active:scale-[0.98] transition-all text-left" data-mode="${t.name.toLowerCase()}">
                        <div class="text-3xl flex-shrink-0">${t.emoji}</div>
                        <div class="flex-1 min-w-0">
                            <p class="${t.textColor} font-bold">${t.name}</p>
                            <p class="text-zinc-400 text-xs">Pick 1â€“${t.range} &bull; ${t.chance} chance</p>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <p class="${t.textColor} font-black text-2xl">${t.multiplier}x</p>
                        </div>
                    </button>
                `).join("")}

                <button class="tier-card w-full flex items-center gap-4 p-5 bg-gradient-to-r from-violet-900/30 via-purple-900/20 to-amber-900/20 border-2 border-violet-500/50 rounded-2xl hover:scale-[1.02] active:scale-[0.98] transition-all text-left relative overflow-hidden" data-mode="combo">
                    <div class="absolute top-0 right-0 px-2.5 py-1 bg-amber-500 text-black text-[9px] font-black rounded-bl-lg">RECOMMENDED</div>
                    <div class="text-3xl flex-shrink-0">ðŸŽ°</div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <p class="text-violet-300 font-bold">Combo</p>
                            <span class="px-1.5 py-0.5 bg-emerald-500/20 border border-emerald-500/40 rounded text-[9px] text-emerald-400 font-bold">BEST VALUE</span>
                        </div>
                        <p class="text-zinc-400 text-xs">All 3 tiers &bull; ~${Kx}% win chance</p>
                        <p class="text-amber-400 text-[10px] mt-0.5">3 chances to win &bull; Up to ${zi}x your bet</p>
                    </div>
                    <div class="text-right flex-shrink-0">
                        <p class="text-violet-400 font-black text-2xl">${zi}x</p>
                        <p class="text-emerald-400 text-[10px] font-bold">max</p>
                    </div>
                </button>
            </div>

            <div class="text-center pt-1">
                <a href="${Ox}${Ux}" target="_blank" rel="noopener"
                   class="inline-flex items-center gap-1.5 text-zinc-600 text-xs hover:text-zinc-400 transition-colors">
                    <i class="fa-solid fa-file-contract text-[10px]"></i> Verify Contract
                </a>
            </div>
        </div>
    `,e.querySelectorAll(".tier-card").forEach(t=>{t.addEventListener("click",()=>{const a=t.dataset.mode;if(C.mode=a,a==="combo")C.comboStep=0,C.guess=C.guesses[0];else{const n=Rt(a);C.guess=Math.min(C.guess,n.tiers[0].range)}C.phase="numbers",fe()})})}function Zx(e){var n,o,s,i;const t=C.mode==="combo",a=t?xe[C.comboStep]:Rt(C.mode).tiers[0];t&&(C.guess=C.guesses[C.comboStep]),e.innerHTML=`
        <div class="space-y-3">
            <div class="flex items-center justify-between px-1">
                <button id="btn-back-tier" class="flex items-center gap-1.5 text-zinc-400 hover:text-white transition-colors text-sm">
                    <i class="fa-solid fa-arrow-left text-xs"></i> Back
                </button>
                <span class="text-xs text-zinc-500">Step 2 of 3</span>
            </div>

            <div class="text-center">
                <p class="text-white font-bold text-lg">${t?"Pick Numbers":"Pick a Number"}</p>
                <p class="text-zinc-400 text-xs">${t?`${a.emoji} ${a.name} (1â€“${a.range}) &bull; ${a.chance} &bull; ${a.multiplier}x`:`${a.emoji} ${a.name}: 1â€“${a.range} &bull; ${a.chance} chance &bull; ${a.multiplier}x`}</p>
            </div>

            ${t?`
                <div class="flex items-center justify-center gap-2">
                    ${xe.map((r,l)=>`
                        <div class="w-9 h-9 rounded-full flex items-center justify-center text-sm ${l===C.comboStep?`bg-gradient-to-br ${r.bgFrom} ${r.bgTo} border-2 ${r.borderColor}`:l<C.comboStep?"bg-emerald-500/20 border-2 border-emerald-500/50":"bg-zinc-800 border-2 border-zinc-700"}">
                            ${l<C.comboStep?'<i class="fa-solid fa-check text-emerald-400 text-xs"></i>':`<span class="${l===C.comboStep?r.textColor:"text-zinc-500"} font-bold">${r.emoji}</span>`}
                        </div>
                    `).join('<div class="w-4 h-px bg-zinc-700"></div>')}
                </div>
            `:""}

            <div class="bg-gradient-to-br ${a.bgFrom} ${a.bgTo} border ${a.borderColor} rounded-2xl p-5">
                <div id="number-picker"></div>
            </div>

            ${t?`
                <div class="flex gap-2">
                    <button id="btn-combo-prev" class="flex-1 py-3 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-xl transition-colors text-sm ${C.comboStep===0?"opacity-30 pointer-events-none":""}">
                        <i class="fa-solid fa-arrow-left mr-1"></i>Prev
                    </button>
                    <button id="btn-combo-next" class="flex-1 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl transition-all text-sm">
                        ${C.comboStep<2?'Next <i class="fa-solid fa-arrow-right ml-1"></i>':'Set Wager <i class="fa-solid fa-arrow-right ml-1"></i>'}
                    </button>
                </div>
            `:`
                <button id="btn-next-wager" class="w-full py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl transition-all text-base">
                    Next â€” Set Wager <i class="fa-solid fa-arrow-right ml-1"></i>
                </button>
            `}
        </div>
    `,eh(a),(n=document.getElementById("btn-back-tier"))==null||n.addEventListener("click",()=>{t&&(C.guesses[C.comboStep]=C.guess),C.phase="tier",fe()}),(o=document.getElementById("btn-next-wager"))==null||o.addEventListener("click",()=>{C.phase="wager",fe()}),(s=document.getElementById("btn-combo-prev"))==null||s.addEventListener("click",()=>{C.comboStep>0&&(C.guesses[C.comboStep]=C.guess,C.comboStep--,C.guess=C.guesses[C.comboStep],fe())}),(i=document.getElementById("btn-combo-next"))==null||i.addEventListener("click",()=>{C.guesses[C.comboStep]=C.guess,C.comboStep<2?(C.comboStep++,C.guess=C.guesses[C.comboStep],fe()):(C.phase="wager",fe())})}function Qx(e){const t=Rt(C.mode),a=C.mode==="combo",n=j(u.currentUserBalance||0n),o=n>=1,s=o&&u.isConnected;a&&(C.guesses[C.comboStep]=C.guess),!C._wagerInit&&n>=2&&(C.wager=Math.max(10,Math.floor(n/2)),C._wagerInit=!0),C.wager>n&&n>0&&(C.wager=Math.floor(n));const i=Math.max(1,Math.floor(n/2)),r=Math.max(1,Math.floor(n/4)),l=Math.max(1,Math.floor(n/10)),c=Math.max(1,Math.floor(n)),d=a?C.guesses:[C.guess],f=t.tiers;e.innerHTML=`
        <div class="space-y-3">
            <div class="flex items-center justify-between px-1">
                <button id="btn-back-numbers" class="flex items-center gap-1.5 text-zinc-400 hover:text-white transition-colors text-sm">
                    <i class="fa-solid fa-arrow-left text-xs"></i> Back
                </button>
                <span class="text-xs text-zinc-500">Step 3 of 3</span>
            </div>

            <!-- Summary of picks -->
            <div class="flex items-center justify-center gap-3 py-2">
                ${f.map((g,m)=>`
                    <div class="text-center">
                        <p class="text-[10px] ${g.textColor} mb-1">${g.emoji}</p>
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br ${g.bgFrom} ${g.bgTo} border ${g.borderColor} flex items-center justify-center">
                            <span class="text-base font-black ${g.textColor}">${d[m]}</span>
                        </div>
                    </div>
                `).join("")}
            </div>

            <!-- Wager controls -->
            <div class="bg-zinc-900/60 border border-zinc-800/50 rounded-2xl p-4">
                <div class="flex items-center justify-between mb-2">
                    <label class="text-sm text-zinc-400 font-bold"><i class="fa-solid fa-coins text-amber-400 mr-1.5"></i>Wager</label>
                    <span class="text-xs text-zinc-500">Bal: <span class="text-amber-400 font-bold">${n.toFixed(0)}</span> BKC</span>
                </div>

                <div class="flex items-center justify-center gap-2 mb-3">
                    <button id="wager-minus" class="w-10 h-10 rounded-lg bg-zinc-800 hover:bg-red-500/20 border border-zinc-700 text-zinc-400 hover:text-red-400 font-bold text-lg transition-all">&minus;</button>
                    <input type="number" id="custom-wager" value="${C.wager}" min="1" max="${c}"
                        class="w-28 h-14 text-center text-3xl font-black rounded-xl bg-zinc-900/80 border-2 border-amber-500/50 text-amber-400 focus:outline-none focus:border-amber-400 appearance-none"
                        style="-moz-appearance: textfield;">
                    <button id="wager-plus" class="w-10 h-10 rounded-lg bg-zinc-800 hover:bg-emerald-500/20 border border-zinc-700 text-zinc-400 hover:text-emerald-400 font-bold text-lg transition-all">+</button>
                </div>

                <div class="grid grid-cols-4 gap-1.5 mb-3">
                    ${[{val:l,label:"10%"},{val:r,label:"25%"},{val:i,label:"50%"},{val:c,label:"MAX"}].map(({val:g,label:m})=>`
                        <button class="wager-btn py-2 text-xs font-bold rounded-lg transition-all ${C.wager===g?"bg-amber-500/25 border border-amber-500/60 text-amber-400":"bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-amber-500/30"}" data-value="${g}">
                            <span class="block text-[10px] opacity-70">${g.toLocaleString()}</span>
                            <span class="block font-black">${m}</span>
                        </button>
                    `).join("")}
                </div>

                <div class="bg-emerald-500/10 rounded-xl p-3 mb-3 border border-emerald-500/20 text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Potential Win</p>
                    <p class="text-emerald-400 font-black text-2xl" id="potential-win">${(C.wager*t.multi).toLocaleString()} BKC</p>
                </div>

                <button id="btn-play" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-400 hover:to-green-400 text-white font-bold rounded-xl transition-all text-lg ${s?"":"opacity-40 cursor-not-allowed"}" ${s?"":"disabled"}>
                    <i class="fa-solid fa-play mr-2"></i>Play &mdash; ${C.wager.toLocaleString()} BKC
                </button>

                ${u.isConnected?"":'<p class="text-center text-zinc-500 text-xs mt-2">Connect wallet to play</p>'}
                ${u.isConnected&&!o?`
                    <button id="btn-faucet" class="w-full mt-2 py-2.5 bg-amber-500/10 border border-amber-500/30 rounded-lg text-amber-400 text-sm font-bold hover:bg-amber-500/20 transition-colors">
                        <i class="fa-solid fa-faucet mr-1"></i>Get Test Tokens
                    </button>
                `:""}
            </div>
        </div>
    `,th(t.multi,n)}function eh(e){var n,o,s,i,r;const t=document.getElementById("number-picker");if(!t)return;const a=C.guess;if(e.range<=5)t.innerHTML=`
            <div class="flex justify-center gap-3">
                ${Array.from({length:e.range},(l,c)=>c+1).map(l=>`
                    <button class="num-pick w-14 h-14 rounded-2xl font-black text-2xl transition-all active:scale-95 ${l===a?"":"bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-zinc-700"}"
                        data-num="${l}"
                        style="${l===a?`background: ${e.hex}; color: white; box-shadow: 0 0 15px ${e.hex}60; transform: scale(1.1)`:""}">
                        ${l}
                    </button>
                `).join("")}
            </div>
        `;else if(e.range<=20)t.innerHTML=`
            <div class="grid grid-cols-5 gap-2 justify-items-center">
                ${Array.from({length:e.range},(l,c)=>c+1).map(l=>`
                    <button class="num-pick w-12 h-12 rounded-xl font-bold text-lg transition-all active:scale-95 ${l===a?"":"bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-zinc-700"}"
                        data-num="${l}"
                        style="${l===a?`background: ${e.hex}; color: white; box-shadow: 0 0 12px ${e.hex}60; transform: scale(1.05)`:""}">
                        ${l}
                    </button>
                `).join("")}
            </div>
        `;else{t.innerHTML=`
            <div class="flex items-center justify-center gap-3 mb-3">
                <button class="np-minus-10 w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xs transition-all border border-zinc-700">-10</button>
                <button class="np-minus w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-lg transition-all border border-zinc-700">&minus;</button>
                <input type="number" id="np-number" min="1" max="${e.range}" value="${a}"
                    class="w-20 h-20 text-center text-3xl font-black rounded-2xl border-2 text-zinc-900 focus:outline-none appearance-none shadow-lg"
                    style="background: ${e.hex}; border-color: ${e.hex}; box-shadow: 0 0 20px ${e.hex}50; -moz-appearance: textfield;">
                <button class="np-plus w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-lg transition-all border border-zinc-700">+</button>
                <button class="np-plus-10 w-9 h-9 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xs transition-all border border-zinc-700">+10</button>
            </div>
            <div class="mb-3 px-1">
                <input type="range" id="np-slider" min="1" max="${e.range}" value="${a}"
                    class="fortune-slider w-full h-3 rounded-full appearance-none cursor-pointer"
                    style="background: linear-gradient(to right, ${e.hex} 0%, ${e.hex} ${a/e.range*100}%, #27272a ${a/e.range*100}%, #27272a 100%)">
                <div class="flex justify-between text-[10px] text-zinc-600 mt-1 px-1">
                    <span>1</span><span>${Math.round(e.range/4)}</span><span>${Math.round(e.range/2)}</span><span>${Math.round(e.range*3/4)}</span><span>${e.range}</span>
                </div>
            </div>
            <div class="flex justify-center gap-1.5 flex-wrap">
                ${[Math.round(e.range*.07),Math.round(e.range*.13),Math.round(e.range*.25),Math.round(e.range*.5),Math.round(e.range*.75),e.range].filter((f,g,m)=>f>=1&&m.indexOf(f)===g).map(f=>`
                    <button class="np-quick px-2 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="${f}">${f}</button>
                `).join("")}
                <button id="np-random" class="px-2 py-1.5 text-xs rounded-lg border transition-all"
                    style="background: ${e.hex}20; border-color: ${e.hex}50; color: ${e.hex}">
                    <i class="fa-solid fa-dice mr-1"></i>Random
                </button>
            </div>
        `;const l=document.getElementById("np-number"),c=document.getElementById("np-slider"),d=f=>{if(f=Math.max(1,Math.min(e.range,f)),C.guess=f,l&&(l.value=f),c){c.value=f;const g=f/e.range*100;c.style.background=`linear-gradient(to right, ${e.hex} 0%, ${e.hex} ${g}%, #27272a ${g}%, #27272a 100%)`}};l==null||l.addEventListener("input",f=>d(parseInt(f.target.value)||1)),l==null||l.addEventListener("blur",f=>d(parseInt(f.target.value)||1)),c==null||c.addEventListener("input",f=>d(parseInt(f.target.value))),(n=t.querySelector(".np-minus"))==null||n.addEventListener("click",()=>d(C.guess-1)),(o=t.querySelector(".np-plus"))==null||o.addEventListener("click",()=>d(C.guess+1)),(s=t.querySelector(".np-minus-10"))==null||s.addEventListener("click",()=>d(C.guess-10)),(i=t.querySelector(".np-plus-10"))==null||i.addEventListener("click",()=>d(C.guess+10)),t.querySelectorAll(".np-quick").forEach(f=>{f.addEventListener("click",()=>d(parseInt(f.dataset.num)))}),(r=document.getElementById("np-random"))==null||r.addEventListener("click",()=>{d(Math.floor(Math.random()*e.range)+1)});return}t.querySelectorAll(".num-pick").forEach(l=>{l.addEventListener("click",()=>{const c=parseInt(l.dataset.num);C.guess=c;const d=e.range<=5?1.1:1.05;t.querySelectorAll(".num-pick").forEach(f=>{parseInt(f.dataset.num)===c?(f.style.cssText=`background: ${e.hex}; color: white; box-shadow: 0 0 15px ${e.hex}60; transform: scale(${d})`,f.classList.remove("bg-zinc-800","border","border-zinc-700","text-zinc-300")):(f.style.cssText="",f.classList.contains("bg-zinc-800")||f.classList.add("bg-zinc-800","border","border-zinc-700","text-zinc-300"))})})})}function th(e,t){var n,o,s,i,r,l;const a=c=>{C.wager=Math.max(1,Math.min(Math.floor(c),Math.floor(t)));const d=document.getElementById("custom-wager"),f=document.getElementById("potential-win"),g=document.getElementById("btn-play");d&&(d.value=C.wager),f&&(f.textContent=(C.wager*e).toLocaleString()+" BKC"),g&&(g.innerHTML=`<i class="fa-solid fa-play mr-2"></i>Play &mdash; ${C.wager.toLocaleString()} BKC`),document.querySelectorAll(".wager-btn").forEach(m=>{const h=parseInt(m.dataset.value),w=C.wager===h;m.className=`wager-btn py-2 text-xs font-bold rounded-lg transition-all ${w?"bg-amber-500/25 border border-amber-500/60 text-amber-400":"bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-amber-500/30"}`})};document.querySelectorAll(".wager-btn").forEach(c=>{c.addEventListener("click",()=>a(parseInt(c.dataset.value)||1))}),(n=document.getElementById("custom-wager"))==null||n.addEventListener("input",c=>a(parseInt(c.target.value)||1)),(o=document.getElementById("wager-minus"))==null||o.addEventListener("click",()=>a(C.wager-1)),(s=document.getElementById("wager-plus"))==null||s.addEventListener("click",()=>a(C.wager+1)),(i=document.getElementById("btn-back-numbers"))==null||i.addEventListener("click",()=>{C.mode==="combo"&&(C.comboStep=2),C.phase="numbers",fe()}),(r=document.getElementById("btn-faucet"))==null||r.addEventListener("click",async()=>{x("Requesting tokens...","info");try{const c=await fetch(`/api/faucet?address=${u.userAddress}`),d=await c.json();if(c.ok&&d.success)x("Tokens received!","success"),await Pn(),fe();else{const f=d.error||"Faucet unavailable";x(f,f.toLowerCase().includes("cooldown")?"warning":"error")}}catch{x("Faucet temporarily unavailable","error")}}),(l=document.getElementById("btn-play"))==null||l.addEventListener("click",()=>{if(!u.isConnected)return x("Connect wallet first","warning");if(C.wager<1)return x("Min: 1 BKC","warning");ah()})}async function ah(){C.phase="processing",_e=0,fe();try{const e=Rt(C.mode),t=e.isSingle?[C.guess]:C.guesses,a=e.tierMask,n=window.ethers.parseEther(C.wager.toString());await Er.playGame({wagerAmount:n,guesses:t,tierMask:a,button:document.getElementById("btn-play"),onSuccess:o=>{C.gameId=(o==null?void 0:o.gameId)||Date.now(),C.commitment={hash:null,userSecret:(o==null?void 0:o.userSecret)||null,commitBlock:(o==null?void 0:o.commitBlock)||null,commitTxHash:(o==null?void 0:o.txHash)||null,revealDelay:C.commitment.revealDelay||2,waitStartTime:Date.now(),canReveal:!0},C.txHash=(o==null?void 0:o.txHash)||null,console.log("[FortunePool] Game committed:",C.gameId,"Block:",C.commitment.commitBlock),C.phase="waiting",fg(),mg()},onError:o=>{var s;if(!o.cancelled){const i=o.message||"",r=((s=o.original)==null?void 0:s.data)||o.data||i;if(String(r).includes("0xbfec5558")||i.includes("active game")){x("You have a pending game. Attempting to recover...","warning"),nc();return}x(i||"Commit failed","error")}C.phase="wager",fe()}})}catch(e){console.error("Commit error:",e);const t=e.message||"";if(String(e.data||t).includes("0xbfec5558")||t.includes("active game")){x("You have a pending game. Attempting to recover...","warning"),nc();return}x("Error: "+(t||"Transaction failed"),"error"),C.phase="wager",fe()}}function nh(e){const t=Rt(C.mode),a=t.isSingle?[C.guess]:C.guesses,n=t.tiers;e.innerHTML=`
        <div class="bg-gradient-to-br from-zinc-900 to-zinc-800/50 border border-zinc-700/50 rounded-2xl p-6 processing-pulse">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center">
                    <i class="fa-solid fa-dice text-3xl text-amber-400 animate-bounce"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">Committing<span class="waiting-dots"></span></h2>
                <p class="text-zinc-400 text-sm">Locking your numbers on-chain</p>
            </div>

            <!-- Animated Reels -->
            <div class="flex justify-center gap-4 mb-6">
                ${n.map((o,s)=>`
                    <div class="text-center">
                        <p class="text-xs text-zinc-500 mb-2">${o.emoji} ${o.name}</p>
                        <div class="w-20 h-24 rounded-2xl bg-gradient-to-br ${o.bgFrom} ${o.bgTo} border-2 ${o.borderColor} flex items-center justify-center overflow-hidden glow-pulse" style="--glow-color: ${o.hex}50">
                            <span class="text-4xl font-black ${o.textColor} slot-spin" id="spin-${s}">?</span>
                        </div>
                    </div>
                `).join("")}
            </div>

            <!-- Your Picks -->
            <div class="border-t border-zinc-700/50 pt-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">Your Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((o,s)=>{const i=a[s];return`
                            <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${o.bgFrom} ${o.bgTo} border-2 ${o.borderColor} flex items-center justify-center">
                                <span class="text-xl font-black ${o.textColor}">${i}</span>
                            </div>
                        `}).join("")}
                </div>
            </div>
        </div>
    `,n.forEach((o,s)=>{const i=document.getElementById(`spin-${s}`);i&&setInterval(()=>{i.textContent=Math.floor(Math.random()*o.range)+1},80)})}function fg(){const e=document.getElementById("game-area");if(!e)return;const t=Rt(C.mode),a=t.isSingle?[C.guess]:C.guesses,n=t.tiers;e.innerHTML=`
        <div class="bg-gradient-to-br from-violet-900/30 to-purple-900/20 border border-violet-500/30 rounded-2xl p-6 waiting-glow">
            <!-- Steps Progress -->
            <div class="mb-5">
                <div class="flex items-center justify-between mb-4">
                    <div id="step-1" class="flex items-center gap-2">
                        <div class="w-7 h-7 rounded-full bg-emerald-500 flex items-center justify-center">
                            <i class="fa-solid fa-check text-white text-xs"></i>
                        </div>
                        <span class="text-emerald-400 text-sm font-medium">Play Recorded</span>
                    </div>
                    <div class="flex-1 h-px bg-zinc-700 mx-2"></div>
                    <div id="step-2" class="flex items-center gap-2">
                        <div id="step-2-icon" class="w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center">
                            <i class="fa-solid fa-spinner fa-spin text-white text-xs"></i>
                        </div>
                        <span id="step-2-text" class="text-amber-400 text-sm font-medium">Confirming...</span>
                    </div>
                    <div class="flex-1 h-px bg-zinc-700 mx-2"></div>
                    <div id="step-3" class="flex items-center gap-2">
                        <div id="step-3-icon" class="w-7 h-7 rounded-full bg-zinc-700 flex items-center justify-center">
                            <span class="text-zinc-500 text-xs font-bold">3</span>
                        </div>
                        <span id="step-3-text" class="text-zinc-500 text-sm font-medium">Result</span>
                    </div>
                </div>
                <!-- Progress bar -->
                <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                    <div id="reveal-progress" class="h-full bg-gradient-to-r from-emerald-500 via-amber-500 to-orange-500 rounded-full transition-all duration-1000 progress-animate" style="width: 33%"></div>
                </div>
                <p id="reveal-status-text" class="text-center text-xs text-zinc-400 mt-2">
                    <i class="fa-solid fa-cube mr-1"></i>Waiting for block confirmations...
                </p>
            </div>

            <!-- Spinning Reels -->
            <div class="flex justify-center gap-4 mb-5">
                ${n.map((o,s)=>`
                    <div class="text-center">
                        <p class="text-xs text-zinc-500 mb-2">${o.emoji} ${o.name}</p>
                        <div class="w-20 h-24 rounded-2xl bg-gradient-to-br ${o.bgFrom} ${o.bgTo} border-2 ${o.borderColor} flex items-center justify-center overflow-hidden glow-pulse" style="--glow-color: ${o.hex}50">
                            <span class="text-4xl font-black ${o.textColor} slot-spin" id="quick-spin-${s}">?</span>
                        </div>
                    </div>
                `).join("")}
            </div>

            <!-- Locked Picks -->
            <div class="border-t border-violet-500/20 pt-4 mb-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">Your Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((o,s)=>{const i=a[s];return`
                            <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${o.bgFrom} ${o.bgTo} border-2 ${o.borderColor} flex items-center justify-center relative">
                                <span class="text-xl font-black ${o.textColor}">${i}</span>
                                <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-violet-500 flex items-center justify-center">
                                    <i class="fa-solid fa-lock text-[8px] text-white"></i>
                                </div>
                            </div>
                        `}).join("")}
                </div>
            </div>

            <button id="btn-reveal" disabled
                class="w-full py-3 rounded-xl font-bold bg-gradient-to-r from-amber-500 to-yellow-500 text-white opacity-80">
                <i class="fa-solid fa-spinner fa-spin mr-2"></i>
                <span id="reveal-btn-text">Waiting for blockchain...</span>
            </button>
        </div>
    `,n.forEach((o,s)=>{const i=document.getElementById(`quick-spin-${s}`);i&&setInterval(()=>{i.textContent=Math.floor(Math.random()*o.range)+1},80)})}function gg(){const e=document.getElementById("step-2-icon"),t=document.getElementById("step-2-text"),a=document.getElementById("step-3-icon"),n=document.getElementById("step-3-text"),o=document.getElementById("reveal-progress"),s=document.getElementById("reveal-status-text"),i=document.getElementById("reveal-btn-text");e&&(e.innerHTML='<i class="fa-solid fa-check text-white text-xs"></i>'),e&&(e.className="w-7 h-7 rounded-full bg-emerald-500 flex items-center justify-center"),t&&(t.textContent="Confirmed",t.className="text-emerald-400 text-sm font-medium"),a&&(a.innerHTML='<i class="fa-solid fa-spinner fa-spin text-white text-xs"></i>'),a&&(a.className="w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center"),n&&(n.textContent="Revealing...",n.className="text-amber-400 text-sm font-medium"),o&&(o.style.width="80%"),s&&(s.innerHTML='<i class="fa-solid fa-wand-magic-sparkles mr-1"></i>Confirm in MetaMask to see your result!'),i&&(i.textContent="Confirm in MetaMask...")}function oh(e){var c;const t=Rt(C.mode),a=t.isSingle?[C.guess]:C.guesses,n=t.tiers,o=Date.now()-(C.commitment.waitStartTime||Date.now()),i=ia[Math.min(_e,ia.length-1)]+2e3,r=Math.max(0,i-o),l=Math.ceil(r/1e3);e.innerHTML=`
        <div class="bg-gradient-to-br from-violet-900/30 to-purple-900/20 border border-violet-500/30 rounded-2xl p-6 waiting-glow">
            <div class="text-center mb-5">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-violet-500/20 to-purple-600/20 border border-violet-500/30 flex items-center justify-center">
                    <i class="fa-solid fa-hourglass-half text-3xl text-violet-400 hourglass-spin"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">Commitment Locked</h2>
                <p class="text-violet-300 text-sm">Waiting for blockchain confirmation...</p>
            </div>

            <!-- Countdown -->
            <div class="bg-zinc-900/50 rounded-xl p-4 mb-4 border border-violet-500/20">
                <div class="text-center">
                    <p class="text-xs text-zinc-500 uppercase mb-2">Time to Reveal</p>
                    <span id="countdown-timer" class="text-4xl font-black text-violet-400 countdown-pulse">~${l}s</span>
                    <div class="mt-3 w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                        <div id="progress-bar" class="h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-1000"
                             style="width: ${Math.min(100,o/i*100)}%"></div>
                    </div>
                </div>
            </div>

            <!-- Block Info -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center border border-zinc-700/50">
                    <p class="text-[10px] text-zinc-500 uppercase mb-1">Commit Block</p>
                    <p class="text-sm font-mono text-white">#${C.commitment.commitBlock||"..."}</p>
                </div>
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center border border-zinc-700/50">
                    <p class="text-[10px] text-zinc-500 uppercase mb-1">Reveal After</p>
                    <p class="text-sm font-mono text-violet-400">#${(C.commitment.commitBlock||0)+C.commitment.revealDelay}</p>
                </div>
            </div>

            <!-- Locked Numbers with spinning reels -->
            <div class="border-t border-violet-500/20 pt-4 mb-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">Your Locked Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((d,f)=>{const g=a[f];return`
                            <div class="text-center">
                                <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${d.bgFrom} ${d.bgTo} border-2 ${d.borderColor} flex items-center justify-center relative">
                                    <span class="text-xl font-black ${d.textColor}">${g}</span>
                                    <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-violet-500 flex items-center justify-center">
                                        <i class="fa-solid fa-lock text-[8px] text-white"></i>
                                    </div>
                                </div>
                            </div>
                        `}).join("")}
                </div>
            </div>

            <!-- Reveal Button -->
            <button id="btn-reveal"
                class="w-full py-3 rounded-xl font-bold transition-all ${C.commitment.canReveal?"bg-gradient-to-r from-emerald-500 to-green-500 text-white hover:shadow-lg hover:shadow-emerald-500/30":"bg-zinc-800 text-zinc-500 cursor-not-allowed"}"
                ${C.commitment.canReveal?"":"disabled"}>
                <i class="fa-solid ${C.commitment.canReveal?"fa-spinner fa-spin":"fa-lock"} mr-2"></i>
                <span id="reveal-btn-text">${C.commitment.canReveal?"Auto-revealing...":"Waiting for blocks..."}</span>
            </button>

            <div class="mt-3 p-2.5 bg-violet-500/10 rounded-lg border border-violet-500/20">
                <p class="text-[10px] text-violet-300 text-center">
                    <i class="fa-solid fa-shield-halved mr-1"></i>
                    Commit-reveal prevents manipulation. Reveal triggers automatically.
                </p>
            </div>

            ${C.commitment.commitTxHash?`
                <div class="text-center mt-3">
                    <a href="${jr}${C.commitment.commitTxHash}" target="_blank"
                       class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-zinc-400">
                        <i class="fa-solid fa-external-link"></i> View Commit TX
                    </a>
                </div>
            `:""}
        </div>
    `,(c=document.getElementById("btn-reveal"))==null||c.addEventListener("click",()=>Gr()),Wr()}function Wr(){if(C.phase!=="waiting")return;const e=document.getElementById("countdown-timer"),t=document.getElementById("progress-bar");if(!e)return;const a=Date.now()-(C.commitment.waitStartTime||Date.now()),o=ia[Math.min(_e,ia.length-1)]+2e3,s=Math.max(0,o-a),i=Math.ceil(s/1e3);i>0?e.textContent=`~${i}s`:e.textContent="Revealing...",t&&(t.style.width=`${Math.min(100,a/o*100)}%`),C.phase==="waiting"&&setTimeout(Wr,1e3)}function sh(){Qe&&clearInterval(Qe),setTimeout(Wr,100),Qe=setInterval(async()=>{if(C.phase!=="waiting"){clearInterval(Qe);return}try{const e=await ih();if(e==="expired"){clearInterval(Qe),Qe=null,console.log("[FortunePool] Game expired, clearing stuck game"),pg();return}e&&!C.commitment.canReveal&&(C.commitment.canReveal=!0,clearInterval(Qe),Qe=null,console.log("[FortunePool] canReveal=true, starting auto-reveal..."),$i())}catch(e){console.warn("Reveal check error:",e)}},Hx)}async function ih(){if(!u.fortunePoolContractPublic||!C.gameId)return!1;try{const e=await u.fortunePoolContractPublic.getGameStatus(C.gameId),t=Number(e.status);if(t===0||t===3)return"expired";if(!C.commitment.commitBlock)try{const a=await u.fortunePoolContractPublic.getGame(C.gameId),n=Number(a.commitBlock);n>0&&(C.commitment.commitBlock=n)}catch{}return e.canReveal===!0}catch{return Date.now()-(C.commitment.waitStartTime||Date.now())>=5e3}}let _e=0;const ia=[3e3,8e3,15e3];async function $i(){if(C.phase!=="waiting")return;const e=document.getElementById("reveal-status-text"),t=document.getElementById("btn-reveal"),a=document.getElementById("reveal-btn-text");t&&(t.disabled=!0,t.classList.remove("bg-zinc-800","text-zinc-500","cursor-not-allowed"),t.classList.add("bg-gradient-to-r","from-amber-500","to-yellow-500","text-white"));const n=ia[Math.min(_e,ia.length-1)];console.log(`[FortunePool] Waiting ${n/1e3}s before reveal attempt ${_e+1}...`),e&&(e.innerHTML='<i class="fa-solid fa-rotate mr-1"></i>Retrying automatically...');const o=Date.now(),s=setInterval(()=>{if(C.phase!=="waiting"){clearInterval(s);return}const i=Math.ceil((n-(Date.now()-o))/1e3);i>0&&a&&(a.textContent=`Retrying in ${i}s...`)},500);await new Promise(i=>setTimeout(i,n)),clearInterval(s),C.phase==="waiting"&&(gg(),console.log("[FortunePool] Starting direct reveal (skipping pre-sim for opBNB L2)"),Gr())}function Go(){const e=document.getElementById("reveal-status-text"),t=document.getElementById("btn-reveal"),a=document.getElementById("reveal-btn-text"),n=document.getElementById("countdown-timer"),o=document.getElementById("reveal-progress");e&&(e.innerHTML='<i class="fa-solid fa-hand-pointer mr-1"></i>Tap the button to see your result'),n&&(n.textContent="Ready!"),o&&(o.style.width="67%"),t&&(t.disabled=!1,t.classList.remove("bg-zinc-800","text-zinc-500","cursor-not-allowed","from-amber-500","to-yellow-500","opacity-80"),t.classList.add("bg-gradient-to-r","from-emerald-500","to-green-500","text-white")),a&&(a.textContent="Reveal & Get Result!");const s=document.getElementById("step-2-icon"),i=document.getElementById("step-2-text");s&&(s.innerHTML='<i class="fa-solid fa-check text-white text-xs"></i>',s.className="w-7 h-7 rounded-full bg-emerald-500 flex items-center justify-center"),i&&(i.textContent="Confirmed",i.className="text-emerald-400 text-sm font-medium")}function mg(){let e=0;const t=60;let a=999;const n=async()=>{if(C.phase==="waiting"){e++;try{const o=await u.fortunePoolContractPublic.getGameStatus(C.gameId),s=Number(o.status);if(s===0||s===3){pg();return}const i=Number(o.blocksUntilReveal),r=o.canReveal===!0,l=document.getElementById("reveal-progress"),c=document.getElementById("reveal-status-text");if(i>0&&c){const d=C.commitment.revealDelay||2,g=33+Math.max(0,d-i)/d*34;l&&(l.style.width=`${g}%`),c.innerHTML=`<i class="fa-solid fa-cube mr-1"></i>${i} block${i>1?"s":""} remaining...`,a=i}if(r){console.log(`[FortunePool] canReveal=true after ${e} polls (~${e*2}s)`),gg(),rh(),Gr();return}}catch(o){console.warn("[FortunePool] canReveal poll error:",o)}e<t?setTimeout(n,2e3):(console.warn("[FortunePool] canReveal poll timeout, enabling manual reveal"),Go())}};setTimeout(n,2e3)}async function rh(){var e;try{const t=Rt(C.mode).isSingle?[C.guess]:C.guesses,a=window.ethers,n=await u.fortunePoolContractPublic.generateCommitHash(t.map(o=>BigInt(o)),C.commitment.userSecret);console.log("[FortunePool] Hash diagnostic:",{computedHash:n,guesses:t.map(o=>Number(o)),secret:((e=C.commitment.userSecret)==null?void 0:e.slice(0,18))+"..."})}catch(t){console.warn("[FortunePool] Hash diagnostic failed:",t)}}async function Gr(){const e=document.getElementById("btn-reveal");try{const t=Rt(C.mode).isSingle?[C.guess]:C.guesses;await Er.revealPlay({gameId:C.gameId,guesses:t,userSecret:C.commitment.userSecret,button:e,onSuccess:(a,n)=>{Qe&&clearInterval(Qe),_e=0,C.txHash=a.hash,C.result={rolls:(n==null?void 0:n.rolls)||[],prizeWon:(n==null?void 0:n.prizeWon)||0n,matches:(n==null?void 0:n.matches)||[],matchCount:(n==null?void 0:n.matchCount)||0},console.log("[FortunePool] Game revealed:",C.result),C.phase="result",fe(),Qo()},onError:a=>{if(a.cancelled){console.log("[FortunePool] User rejected reveal, showing manual button"),x("You can reveal your result when ready","info"),_e=0,Go();return}const n=a.message||"";(a.type==="tx_reverted"||n.includes("revert")||n.includes("failed")||n.includes("0x92555c0e")||n.includes("BlockhashUnavailable")||n.includes("CALL_EXCEPTION"))&&_e<ia.length-1?(_e++,console.warn(`[FortunePool] Reveal reverted (attempt ${_e}), auto-retrying...`),$i()):(x("Reveal failed â€” tap the button to try again","error"),_e=0,Go())}})}catch(t){console.error("Reveal error:",t);const a=t.message||"";(a.includes("revert")||a.includes("failed")||a.includes("BlockhashUnavailable"))&&_e<ia.length-1?(_e++,console.warn(`[FortunePool] Reveal exception (attempt ${_e}), auto-retrying...`),$i()):(x("Reveal failed: "+(a||"Unknown error"),"error"),_e=0,Go())}}function lh(e){var g,m,h;const t=C.result;if(!t)return fe();const a=Rt(C.mode),n=a.isSingle?[C.guess]:C.guesses,o=t.rolls||[],s=a.tiers,i=n.map((w,y)=>{const k=o[y]!==void 0?Number(o[y]):null;return k!==null&&k===w}),r=i.filter(w=>w).length,l=t.prizeWon>0||r>0;let c=0;t.prizeWon&&t.prizeWon>0n?c=j(BigInt(t.prizeWon)):r>0&&i.forEach((w,y)=>{if(w){const k=a.tiers[y]||xe[y];c+=C.wager*k.multiplier}});const d=typeof c=="number"?c.toLocaleString(void 0,{maximumFractionDigits:2}):c.toLocaleString();e.innerHTML=`
        <div class="bg-gradient-to-br ${l?"from-emerald-900/30 to-green-900/10 border-emerald-500/30":"from-zinc-900 to-zinc-800/50 border-zinc-700/50"} border rounded-2xl p-5 relative overflow-hidden" id="result-container">

            <!-- Result Header -->
            <div class="text-center mb-4">
                ${l?`
                    <div class="text-5xl mb-2">ðŸŽ‰</div>
                    <h2 class="text-2xl font-black text-emerald-400 mb-1">YOU WON!</h2>
                    <p class="text-3xl font-black text-white">${d} BKC</p>
                `:`
                    <div class="text-5xl mb-2">ðŸ˜”</div>
                    <h2 class="text-xl font-bold text-zinc-400 mb-1">No Match</h2>
                    <p class="text-zinc-500 text-sm">Better luck next time!</p>
                `}
            </div>

            <!-- Animated Result Grid -->
            <div class="grid ${a.isSingle?"grid-cols-1 max-w-[220px] mx-auto":"grid-cols-3"} gap-3 mb-4">
                ${s.map((w,y)=>{const k=n[y],v=o[y],T=i[y];return`
                        <div class="text-center p-3 rounded-xl ${T?"bg-emerald-500/20 border border-emerald-500/50":"bg-zinc-800/50 border border-zinc-700/50"}" id="result-tier-${y}">
                            <p class="text-[10px] text-zinc-500 mb-1">${w.emoji} ${w.name}</p>
                            <div class="flex items-center justify-center gap-2">
                                <div class="text-center">
                                    <p class="text-[8px] text-zinc-600 mb-0.5">YOU</p>
                                    <div class="w-12 h-12 rounded-lg bg-gradient-to-br ${w.bgFrom} ${w.bgTo} border ${w.borderColor} flex items-center justify-center">
                                        <span class="text-xl font-black ${w.textColor}">${k}</span>
                                    </div>
                                </div>
                                <span class="text-xl" id="match-icon-${y}" style="opacity: 0">
                                    ${T?"=":"â‰ "}
                                </span>
                                <div class="text-center">
                                    <p class="text-[8px] text-zinc-600 mb-0.5">ROLL</p>
                                    <div class="w-12 h-12 rounded-lg ${T?"bg-emerald-500/30 border-emerald-500":"bg-zinc-700/50 border-zinc-600"} border flex items-center justify-center overflow-hidden">
                                        <span class="text-xl font-black ${T?"text-emerald-400":"text-zinc-300"}" id="roll-num-${y}" style="opacity: 0">${v!==void 0?v:"?"}</span>
                                    </div>
                                </div>
                            </div>
                            ${T?`<p class="text-emerald-400 text-xs font-bold mt-1" id="match-label-${y}" style="opacity: 0">+${w.multiplier}x</p>`:""}
                        </div>
                    `}).join("")}
            </div>

            <!-- TX Link -->
            ${C.txHash?`
                <div class="text-center mb-3">
                    <a href="${jr}${C.txHash}" target="_blank" class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-zinc-400">
                        <i class="fa-solid fa-external-link"></i> View Transaction
                    </a>
                </div>
            `:""}

            <!-- Share -->
            <div class="bg-gradient-to-r ${l?"from-amber-500/10 to-orange-500/10 border-amber-500/30":"from-zinc-800/50 to-zinc-700/30 border-zinc-600/30"} border rounded-xl p-3 mb-3">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-9 h-9 rounded-full ${l?"bg-amber-500/20":"bg-zinc-700/50"} flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-gift ${l?"text-amber-400":"text-zinc-400"}"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">${l?"Share Your Win!":"Share & Try Again!"}</p>
                        <p class="text-amber-400 text-xs font-medium">+${mn} Airdrop Points</p>
                    </div>
                </div>
                <button id="btn-share" class="w-full py-2.5 ${l?"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black":"bg-zinc-700 hover:bg-zinc-600 text-white border border-zinc-600"} font-bold rounded-xl transition-all text-sm">
                    <i class="fa-solid fa-share-nodes mr-2"></i>${l?"Share Now":"Share Anyway"}
                </button>
            </div>

            <button id="btn-new-game" class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black font-bold rounded-xl transition-all">
                <i class="fa-solid fa-paw mr-2"></i>Play Again
            </button>
            <button id="btn-change-game" class="w-full mt-2 py-2 text-zinc-500 hover:text-zinc-300 text-sm transition-colors">
                <i class="fa-solid fa-shuffle mr-1"></i>Change Game Mode
            </button>
        </div>

        <!-- History -->
        <div class="mt-3 bg-zinc-900/50 border border-zinc-800/50 rounded-2xl overflow-hidden">
            <div class="flex items-center justify-between p-3 border-b border-zinc-800/50">
                <span class="text-sm font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-clock-rotate-left text-orange-500 text-xs"></i>
                    Recent Games
                </span>
                <span id="win-rate" class="text-xs text-zinc-500"></span>
            </div>
            <div id="history-list" class="max-h-[200px] overflow-y-auto p-2">
                <div class="p-3 text-center text-zinc-600 text-sm">
                    <i class="fa-solid fa-spinner fa-spin text-zinc-600 mb-1"></i>
                    <p class="text-xs">Loading...</p>
                </div>
            </div>
        </div>
    `,s.forEach((w,y)=>{const k=600+y*800;setTimeout(()=>{const v=document.getElementById(`roll-num-${y}`),T=document.getElementById(`match-icon-${y}`),I=document.getElementById(`match-label-${y}`),N=document.getElementById(`result-tier-${y}`);v&&(v.style.opacity="1",v.classList.add("reel-land")),T&&(T.style.opacity="1",T.className=`text-xl ${i[y]?"text-emerald-400":"text-red-400"}`),setTimeout(()=>{N&&N.classList.add(i[y]?"match-pulse":"miss-shake"),I&&(I.style.opacity="1")},400)},k)});const f=600+s.length*800+500;l&&setTimeout(()=>{ch(),c>C.wager*10&&dh()},f),(g=document.getElementById("btn-new-game"))==null||g.addEventListener("click",()=>{C.phase="wager",C.result=null,C.txHash=null,C.gameId=null,fe(),Qo()}),(m=document.getElementById("btn-change-game"))==null||m.addEventListener("click",()=>{C.phase="tier",C.result=null,C.txHash=null,C.gameId=null,fe(),Qo()}),(h=document.getElementById("btn-share"))==null||h.addEventListener("click",()=>{uh(l,c)})}function ch(){const e=document.createElement("div");e.className="confetti-container",document.body.appendChild(e);const t=["#f59e0b","#10b981","#8b5cf6","#ec4899","#06b6d4"],a=["â—","â– ","â˜…","ðŸ¯","ðŸŽ‰"];for(let n=0;n<60;n++){const o=document.createElement("div");o.className="confetti",o.style.cssText=`
            left: ${Math.random()*100}%;
            color: ${t[n%t.length]};
            font-size: ${8+Math.random()*12}px;
            animation-delay: ${Math.random()*2}s;
            animation-duration: ${2+Math.random()*2}s;
        `,o.textContent=a[n%a.length],e.appendChild(o)}setTimeout(()=>e.remove(),5e3)}function dh(){const e=["ðŸª™","ðŸ’°","âœ¨","â­","ðŸŽ‰"];for(let t=0;t<30;t++)setTimeout(()=>{const a=document.createElement("div");a.className="coin",a.textContent=e[Math.floor(Math.random()*e.length)],a.style.left=`${Math.random()*100}%`,a.style.animationDelay=`${Math.random()*.5}s`,a.style.animationDuration=`${2+Math.random()*2}s`,document.body.appendChild(a),setTimeout(()=>a.remove(),4e3)},t*100)}function uh(e,t){var l,c,d,f,g,m;const a=ac[Wn],n=()=>{const h=jx[Wn];return e?h.win(t):h.lose},o=`
        <div class="text-center">
            <span class="text-4xl block mb-2">ðŸŽ°</span>
            <h3 id="share-modal-title" class="text-lg font-bold text-white">${a.title}</h3>
            <p id="share-modal-subtitle" class="text-amber-400 text-sm font-medium mb-3">${a.subtitle}</p>

            <!-- Language Selector -->
            <div class="flex justify-center gap-2 mb-4">
                ${["pt","en","es"].map(h=>`
                    <button class="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Wn===h?"bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50":"bg-zinc-800 border-zinc-700 hover:border-zinc-500"} border" data-lang="${h}">
                        <img src="${Wx[h]}" class="w-5 h-5 rounded-full object-cover" alt="${h.toUpperCase()}">
                        <span class="${Wn===h?"text-amber-400":"text-zinc-400"}">${h.toUpperCase()}</span>
                    </button>
                `).join("")}
            </div>

            <!-- Share Buttons -->
            <div class="grid grid-cols-5 gap-2 mb-4">
                <button id="share-twitter" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 rounded-xl transition-all">
                    <i class="fa-brands fa-x-twitter text-lg text-white mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Twitter</span>
                </button>
                <button id="share-telegram" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#0088cc]/20 border border-zinc-700 hover:border-[#0088cc]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-telegram text-lg text-[#0088cc] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Telegram</span>
                </button>
                <button id="share-whatsapp" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#25D366]/20 border border-zinc-700 hover:border-[#25D366]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-whatsapp text-lg text-[#25D366] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">WhatsApp</span>
                </button>
                <button id="share-instagram" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#E4405F]/20 border border-zinc-700 hover:border-[#E4405F]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-instagram text-lg text-[#E4405F] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Instagram</span>
                </button>
                <button id="share-copy" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 rounded-xl transition-all">
                    <i class="fa-solid fa-copy text-lg text-zinc-400 mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Copy</span>
                </button>
            </div>

            <button id="btn-close-share" class="text-zinc-500 hover:text-zinc-300 text-xs">${a.later}</button>
        </div>
    `;Vo(o,"max-w-xs");const s=h=>{Wn=h;const w=ac[h],y=document.getElementById("share-modal-title"),k=document.getElementById("share-modal-subtitle"),v=document.getElementById("btn-close-share");y&&(y.textContent=w.title),k&&(k.textContent=w.subtitle),v&&(v.textContent=w.later),document.querySelectorAll(".lang-btn").forEach(T=>{const I=T.dataset.lang,N=T.querySelector("span");I===h?(T.className="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50 border",N&&(N.className="text-amber-400")):(T.className="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all bg-zinc-800 border-zinc-700 hover:border-zinc-500 border",N&&(N.className="text-zinc-400"))})};document.querySelectorAll(".lang-btn").forEach(h=>{h.addEventListener("click",()=>s(h.dataset.lang))});const i=async h=>{if(!u.userAddress)return!1;try{const y=await(await fetch("https://us-central1-backchain-backand.cloudfunctions.net/trackShare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:u.userAddress,gameId:C.gameId||Date.now(),type:"fortune",platform:h})})).json();return y.success?(x(`+${y.pointsAwarded||mn} Airdrop Points!`,"success"),!0):!1}catch{return x(`+${mn} Airdrop Points!`,"success"),!0}},r=async(h,w)=>{await i(h),window.open(w,"_blank"),yt()};(l=document.getElementById("share-twitter"))==null||l.addEventListener("click",()=>{r("twitter",`https://twitter.com/intent/tweet?text=${encodeURIComponent(n())}`)}),(c=document.getElementById("share-telegram"))==null||c.addEventListener("click",()=>{r("telegram",`https://t.me/share/url?url=https://backcoin.org&text=${encodeURIComponent(n())}`)}),(d=document.getElementById("share-whatsapp"))==null||d.addEventListener("click",()=>{r("whatsapp",`https://wa.me/?text=${encodeURIComponent(n())}`)}),(f=document.getElementById("share-instagram"))==null||f.addEventListener("click",async()=>{const h=n();try{await navigator.clipboard.writeText(h),await i("instagram"),yt(),setTimeout(()=>{var y,k;Vo(`
                    <div class="text-center p-2">
                        <i class="fa-brands fa-instagram text-4xl text-[#E4405F] mb-3"></i>
                        <h3 class="text-lg font-bold text-white mb-2">Text Copied!</h3>
                        <p class="text-zinc-400 text-sm mb-4">Now paste it in your Instagram story or post!</p>
                        <button id="btn-open-ig" class="w-full py-3 bg-gradient-to-r from-[#833AB4] via-[#E4405F] to-[#FCAF45] text-white font-bold rounded-xl mb-2">
                            <i class="fa-brands fa-instagram mr-2"></i>Open Instagram
                        </button>
                        <button id="btn-close-ig" class="text-zinc-500 hover:text-zinc-300 text-xs">Close</button>
                    </div>
                `,"max-w-xs"),(y=document.getElementById("btn-open-ig"))==null||y.addEventListener("click",()=>{window.open("https://www.instagram.com/backcoin.bkc/","_blank"),yt()}),(k=document.getElementById("btn-close-ig"))==null||k.addEventListener("click",yt)},100)}catch{x("Could not copy text","error"),yt()}}),(g=document.getElementById("share-copy"))==null||g.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(n()),x("Copied!","success"),await i("copy")}catch{x("Copy failed","error")}yt()}),(m=document.getElementById("btn-close-share"))==null||m.addEventListener("click",yt)}async function ph(){const e=u.fortunePoolContract||u.fortunePoolContractPublic;if(!e)return null;try{const[t,a,n]=await Promise.all([e.prizePool().catch(()=>0n),e.gameCounter().catch(()=>0),e.TIER_COUNT().catch(()=>3)]),o=window.ethers;let s=0n,i=0n,r=0n;try{const c=[o.id("FORTUNE_TIER0"),o.id("FORTUNE_TIER1"),o.id("FORTUNE_TIER2")];s=await W(c[0]),i=0n;for(const d of c)i+=await W(d);r=s,console.log(`Service fees: single=${Number(s)/1e18} BNB, all=${Number(i)/1e18} BNB`)}catch(c){console.log("calculateFeeClientSide failed:",c.message)}C.serviceFee=r,C.serviceFee1x=s,C.serviceFee5x=i;try{const c=await e.revealDelay();C.commitment.revealDelay=Number(c)||2}catch{}try{const[c,d,f]=await e.getAllTiers();C.tiersData=c.map((g,m)=>({range:Number(g),multiplier:Number(d[m])/1e4,winChance:Number(f[m])/1e4}))}catch{}let l=0n;try{const c=await e.getPoolStats();l=c.maxPayoutNow||c[6]||0n}catch{}return{prizePool:t||0n,gameCounter:Number(a)||0,serviceFee:r,serviceFee1x:s,serviceFee5x:i,tierCount:Number(n)||3,maxPayout:l}}catch(t){return console.error("getFortunePoolStatus error:",t),{prizePool:0n,gameCounter:0,serviceFee:0n,maxPayout:0n}}}async function Qo(){try{const e=await ph();if(e){C.poolData=e;const a=document.getElementById("intro-prize");a&&C.phase==="intro"&&(a.textContent=j(e.prizePool||0n).toFixed(0)+" BKC")}j(u.currentUserBalance||0n)>0&&C.phase==="wager"&&!C._balanceLoaded&&(C._balanceLoaded=!0,fe()),fh()}catch(e){console.error("Pool error:",e)}}async function fh(){var e;try{const t=ca.fortuneGames||"https://getfortunegames-4wvdcuoouq-uc.a.run.app",a=u.userAddress?`${t}?player=${u.userAddress}&limit=15`:`${t}?limit=15`,o=await(await fetch(a)).json();if(((e=o.games)==null?void 0:e.length)>0){gh(o.games);const s=o.games.filter(r=>r.isWin||r.prizeWon&&BigInt(r.prizeWon)>0n).length,i=document.getElementById("win-rate");i&&(i.textContent=`${s}/${o.games.length} wins`)}else{const s=document.getElementById("history-list");s&&(s.innerHTML=`
                <div class="p-6 text-center">
                    <span class="text-3xl block mb-2 opacity-30">ðŸŽ°</span>
                    <p class="text-zinc-500 text-sm">No games yet</p>
                    <p class="text-zinc-600 text-xs mt-1">Be the first to play!</p>
                </div>
            `)}}catch(t){console.error("loadHistory error:",t)}}function gh(e){const t=document.getElementById("history-list");t&&(t.innerHTML=e.map(a=>{var h;const n=a.isWin||a.prizeWon&&BigInt(a.prizeWon)>0n,o=a.prizeWon?j(BigInt(a.prizeWon)):0,s=a.wagerAmount?j(BigInt(a.wagerAmount)):0,i=a.isCumulative,r=a.rolls||[],l=a.guesses||[],c=a.txHash||a.transactionHash,d=mh(a.timestamp||a.createdAt),f=a.player?`${a.player.slice(0,6)}...${a.player.slice(-4)}`:"???",g=u.userAddress&&((h=a.player)==null?void 0:h.toLowerCase())===u.userAddress.toLowerCase(),m=c?`${jr}${c}`:null;return`
            <a href="${m||"#"}" target="${m?"_blank":"_self"}" rel="noopener"
               class="block p-3 rounded-xl mb-2 ${n?"bg-emerald-500/10 border border-emerald-500/30":"bg-zinc-800/30 border border-zinc-700/30"} transition-all hover:scale-[1.01] ${m?"cursor-pointer hover:border-zinc-500":""}"
               ${m?"":'onclick="return false;"'}>
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">${n?"ðŸ†":"ðŸŽ²"}</span>
                        <span class="text-xs ${g?"text-amber-400 font-bold":"text-zinc-500"}">${g?"You":f}</span>
                        <span class="text-[10px] px-2 py-0.5 rounded-full ${i?"bg-violet-500/20 text-violet-400":"bg-emerald-500/20 text-emerald-400"}">${i?"Combo":"Single"}</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <span class="text-[10px] text-zinc-600">${d}</span>
                        ${m?'<i class="fa-solid fa-external-link text-[8px] text-zinc-600"></i>':""}
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-zinc-500">Bet: ${s.toFixed(0)}</span>
                        <span class="text-zinc-700">â†’</span>
                        <span class="text-xs ${n?"text-emerald-400 font-bold":"text-zinc-500"}">
                            ${n?`+${o.toFixed(0)} BKC`:"No win"}
                        </span>
                    </div>
                    <div class="flex gap-1">
                        ${(i?xe:[xe[2]]).map((w,y)=>{const k=l[y],v=r[y];return`
                                <div class="w-6 h-6 rounded text-[10px] font-bold flex items-center justify-center ${k!==void 0&&v!==void 0&&Number(k)===Number(v)?"bg-emerald-500/30 text-emerald-400":"bg-zinc-700/50 text-zinc-500"}">
                                    ${v??"?"}
                                </div>
                            `}).join("")}
                    </div>
                </div>
            </a>
        `}).join(""))}function mh(e){if(!e)return"N/A";try{const t=Date.now();let a;if(typeof e=="number"?a=e>1e12?e:e*1e3:typeof e=="string"?a=new Date(e).getTime():e._seconds?a=e._seconds*1e3:e.seconds?a=e.seconds*1e3:a=new Date(e).getTime(),isNaN(a))return"N/A";const n=t-a;if(n<0)return"Just now";const o=Math.floor(n/6e4),s=Math.floor(n/36e5),i=Math.floor(n/864e5);return o<1?"Just now":o<60?`${o}m ago`:s<24?`${s}h ago`:i<7?`${i}d ago`:new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return"N/A"}}const sc={render:Yx,cleanup:qx},bh=()=>{if(document.getElementById("about-styles-v5"))return;const e=document.createElement("style");e.id="about-styles-v5",e.innerHTML=`
        @keyframes pulse-hub {
            0%, 100% { box-shadow: 0 0 20px rgba(251,191,36,0.3), 0 0 40px rgba(251,191,36,0.1); }
            50% { box-shadow: 0 0 40px rgba(251,191,36,0.5), 0 0 80px rgba(251,191,36,0.2); }
        }

        @keyframes flow-down {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }

        @keyframes rotate-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ab-fade-up { animation: fade-in-up 0.6s ease-out forwards; }
        .ab-pulse-hub { animation: pulse-hub 3s ease-in-out infinite; }
        .ab-rotate { animation: rotate-slow 30s linear infinite; }

        .ab-section {
            background: linear-gradient(180deg, rgba(24,24,27,0.8) 0%, rgba(9,9,11,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.3);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .ab-card {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
        }

        .ab-card:hover {
            border-color: rgba(251,191,36,0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }

        .ab-hub {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(251,191,36,0.2) 0%, rgba(9,9,11,1) 70%);
            border: 3px solid #f59e0b;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
        }

        .ab-flow-line {
            position: relative;
            height: 40px;
            width: 2px;
            background: rgba(63,63,70,0.5);
            overflow: hidden;
        }

        .ab-flow-line::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(180deg, transparent, #f59e0b, transparent);
            animation: flow-down 1.5s linear infinite;
        }

        .ab-icon-box {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .ab-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 600;
        }

        .ab-gradient-text {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ab-orbit-container {
            position: relative;
            width: 280px;
            height: 280px;
        }

        .ab-orbit-ring {
            position: absolute;
            border: 1px dashed rgba(251,191,36,0.3);
            border-radius: 50%;
        }

        .ab-orbit-item {
            position: absolute;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(24,24,27,0.9);
            border: 2px solid;
            font-size: 14px;
        }

        .ab-module-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 10px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .ab-module-pill:hover {
            transform: translateX(4px);
        }
    `,document.head.appendChild(e)};function xh(){return`
        <div class="text-center mb-10 ab-fade-up">
            <div class="relative inline-block mb-6">
                <div class="absolute inset-0 bg-amber-500/20 rounded-full blur-2xl"></div>
                <img src="./assets/bkc_logo_3d.png" class="w-24 h-24 relative z-10" alt="Backcoin">
            </div>

            <h1 class="text-3xl md:text-4xl font-black text-white mb-3">
                The <span class="ab-gradient-text">Backchain</span> Ecosystem
            </h1>

            <p class="text-zinc-400 text-sm max-w-lg mx-auto leading-relaxed mb-5">
                An unstoppable, permissionless DeFi ecosystem on <span class="text-yellow-400 font-medium">opBNB</span>.
                No admin keys. No blacklists.
                A <span class="text-amber-400 font-medium">modular smart contract ecosystem</span> working together to create a self-sustaining digital economy.
            </p>

            <div class="flex items-center justify-center gap-3 flex-wrap">
                <span class="ab-badge bg-amber-500/20 text-amber-400">
                    <i class="fa-solid fa-users mr-1"></i>Community-Owned
                </span>
                <span class="ab-badge bg-emerald-500/20 text-emerald-400">
                    <i class="fa-solid fa-infinity mr-1"></i>Self-Sustaining
                </span>
                <span class="ab-badge bg-blue-500/20 text-blue-400">
                    <i class="fa-solid fa-shield-halved mr-1"></i>Unstoppable
                </span>
                <span class="ab-badge bg-purple-500/20 text-purple-400">
                    <i class="fa-solid fa-code mr-1"></i>Open Source
                </span>
            </div>
        </div>
    `}function hh(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.05s">
            <div class="absolute top-0 left-0 w-48 h-48 bg-amber-500/5 rounded-full blur-3xl"></div>

            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-scroll text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">The Philosophy</h2>
                    <p class="text-zinc-500 text-xs">Why Backchain exists</p>
                </div>
            </div>

            <p class="text-zinc-400 text-sm leading-relaxed mb-4">
                Most DeFi protocols are controlled by teams that can pause contracts, blacklist wallets, or change the rules. Backchain was built with a different philosophy: <strong class="text-white">once deployed, the code runs forever</strong> â€” no admin can stop it, no company can shut it down, and no government can censor it.
            </p>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                <div class="ab-card text-center p-4">
                    <div class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-2">
                        <i class="fa-solid fa-key text-red-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">No Admin Keys</h3>
                    <p class="text-zinc-500 text-[11px]">No one can modify contracts after deployment. Rules are enforced by code, not people.</p>
                </div>
                <div class="ab-card text-center p-4">
                    <div class="w-10 h-10 rounded-full bg-amber-500/10 flex items-center justify-center mx-auto mb-2">
                        <i class="fa-solid fa-ban text-amber-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">No Blacklists</h3>
                    <p class="text-zinc-500 text-[11px]">Every wallet has equal access. No addresses can be blocked or restricted.</p>
                </div>
                <div class="ab-card text-center p-4">
                    <div class="w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-2">
                        <i class="fa-solid fa-shield-halved text-emerald-400"></i>
                    </div>
                    <h3 class="text-white font-bold text-sm mb-1">Immutable Core</h3>
                    <p class="text-zinc-500 text-[11px]">Core contracts are immutable. Modules can be added or removed without changing existing code.</p>
                </div>
            </div>
        </div>
    `}function vh(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.1s">
            <div class="absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl"></div>

            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-sitemap text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Hub & Spoke Architecture</h2>
                    <p class="text-zinc-500 text-xs">Modular design for infinite scalability</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <div>
                    <p class="text-zinc-400 text-sm leading-relaxed mb-4">
                        Backchain uses a <strong class="text-white">modular architecture</strong>.
                        The <span class="text-amber-400 font-medium">Hub</span> (BackchainEcosystem) is the immutable core â€” it manages all fees, reward distribution, operator commissions, and tutor referrals.
                        The <span class="text-emerald-400 font-medium">Spokes</span> are independent services that plug into the Hub. New spokes can be added anytime without changing existing contracts.
                    </p>

                    <div class="ab-card bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/30 mb-3">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-brain text-amber-400"></i>
                            <span class="text-white font-bold text-sm">The Hub (BackchainEcosystem)</span>
                        </div>
                        <ul class="text-zinc-400 text-xs space-y-1">
                            <li><i class="fa-solid fa-check text-amber-500/60 mr-1.5"></i>Fee collection & per-module distribution</li>
                            <li><i class="fa-solid fa-check text-amber-500/60 mr-1.5"></i>Operator commissions (10-20% to builders)</li>
                            <li><i class="fa-solid fa-check text-amber-500/60 mr-1.5"></i>Tutor referral system (10% BNB + 5% BKC)</li>
                            <li><i class="fa-solid fa-check text-amber-500/60 mr-1.5"></i>Buyback & Burn engine (deflationary)</li>
                        </ul>
                    </div>

                    <div class="ab-card bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border-emerald-500/30">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-puzzle-piece text-emerald-400"></i>
                            <span class="text-white font-bold text-sm">The Spokes (Service Modules)</span>
                        </div>
                        <ul class="text-zinc-400 text-xs space-y-1">
                            <li><i class="fa-solid fa-check text-emerald-500/60 mr-1.5"></i>Each spoke generates fees for the ecosystem</li>
                            <li><i class="fa-solid fa-check text-emerald-500/60 mr-1.5"></i>Independent deployment & upgradability</li>
                            <li><i class="fa-solid fa-check text-emerald-500/60 mr-1.5"></i>More spokes = more revenue = higher rewards</li>
                        </ul>
                    </div>
                </div>

                <!-- Visual Diagram -->
                <div class="flex justify-center">
                    <div class="ab-orbit-container">
                        <div class="ab-orbit-ring ab-rotate" style="width: 100%; height: 100%; top: 0; left: 0;"></div>
                        <div class="ab-orbit-ring" style="width: 70%; height: 70%; top: 15%; left: 15%;"></div>

                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                            <div class="ab-hub ab-pulse-hub">
                                <i class="fa-solid fa-brain text-3xl text-amber-400 mb-1"></i>
                                <span class="text-[10px] font-bold text-white">HUB</span>
                            </div>
                        </div>

                        <!-- 8 Spokes around the orbit -->
                        <div class="ab-orbit-item border-purple-500 bg-purple-500/10" style="top: 2%; left: 50%; transform: translateX(-50%);">
                            <i class="fa-solid fa-dice text-purple-400"></i>
                        </div>
                        <div class="ab-orbit-item border-cyan-500 bg-cyan-500/10" style="top: 17%; right: 8%; transform: rotate(45deg);">
                            <i class="fa-solid fa-stamp text-cyan-400" style="transform: rotate(-45deg);"></i>
                        </div>
                        <div class="ab-orbit-item border-pink-500 bg-pink-500/10" style="top: 50%; right: 2%; transform: translateY(-50%);">
                            <i class="fa-solid fa-store text-pink-400"></i>
                        </div>
                        <div class="ab-orbit-item border-teal-500 bg-teal-500/10" style="bottom: 17%; right: 8%;">
                            <i class="fa-solid fa-rocket text-teal-400"></i>
                        </div>
                        <div class="ab-orbit-item border-emerald-500 bg-emerald-500/10" style="bottom: 2%; left: 50%; transform: translateX(-50%);">
                            <i class="fa-solid fa-landmark text-emerald-400"></i>
                        </div>
                        <div class="ab-orbit-item border-red-500 bg-red-500/10" style="bottom: 17%; left: 8%;">
                            <i class="fa-solid fa-hand-holding-heart text-red-400"></i>
                        </div>
                        <div class="ab-orbit-item border-blue-500 bg-blue-500/10" style="top: 50%; left: 2%; transform: translateY(-50%);">
                            <i class="fa-solid fa-layer-group text-blue-400"></i>
                        </div>
                        <div class="ab-orbit-item border-amber-500 bg-amber-500/10" style="top: 17%; left: 8%;">
                            <i class="fa-solid fa-coins text-amber-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `}function yh(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.15s">
            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-purple-500/20">
                    <i class="fa-solid fa-cubes text-purple-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">The Ecosystem Map</h2>
                    <p class="text-zinc-500 text-xs">Modular smart contracts, one interconnected economy</p>
                </div>
            </div>

            <!-- DeFi Core -->
            <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3 tracking-wider">DeFi Core</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-5">
                <div class="ab-module-pill bg-amber-500/5 border border-amber-500/20" onclick="window.navigateTo&&window.navigateTo('tokenomics')">
                    <div class="w-8 h-8 rounded-lg bg-amber-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-coins text-amber-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">BKC Token</p>
                        <p class="text-zinc-500 text-[10px]">ERC-20 with activity-based minting. 200M cap.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-blue-500/5 border border-blue-500/20" onclick="window.navigateTo&&window.navigateTo('tokenomics')">
                    <div class="w-8 h-8 rounded-lg bg-blue-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-water text-blue-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Liquidity Pool</p>
                        <p class="text-zinc-500 text-[10px]">Constant-product AMM for BNB/BKC trading.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-purple-500/5 border border-purple-500/20" onclick="window.navigateTo&&window.navigateTo('staking')">
                    <div class="w-8 h-8 rounded-lg bg-purple-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-layer-group text-purple-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Staking Pool</p>
                        <p class="text-zinc-500 text-[10px]">Delegate BKC with time-locks. Earn BNB + BKC rewards.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-orange-500/5 border border-orange-500/20">
                    <div class="w-8 h-8 rounded-lg bg-orange-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-fire text-orange-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Buyback Miner</p>
                        <p class="text-zinc-500 text-[10px]">Converts BNB fees into BKC via scarcity curve mining.</p>
                    </div>
                </div>
            </div>

            <!-- NFT Ecosystem -->
            <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3 tracking-wider">NFT Ecosystem</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-5">
                <div class="ab-module-pill bg-pink-500/5 border border-pink-500/20" onclick="window.navigateTo&&window.navigateTo('store')">
                    <div class="w-8 h-8 rounded-lg bg-pink-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-gem text-pink-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">RewardBooster NFTs</p>
                        <p class="text-zinc-500 text-[10px]">4-tier NFTs (Diamond/Gold/Silver/Bronze) that reduce staking burn rate.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-pink-500/5 border border-pink-500/20" onclick="window.navigateTo&&window.navigateTo('store')">
                    <div class="w-8 h-8 rounded-lg bg-pink-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-store text-pink-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">NFT Pool</p>
                        <p class="text-zinc-500 text-[10px]">Bonding curve marketplace. Buy low, sell high.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-violet-500/5 border border-violet-500/20" onclick="window.navigateTo&&window.navigateTo('store')">
                    <div class="w-8 h-8 rounded-lg bg-violet-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-wand-magic-sparkles text-violet-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">NFT Fusion</p>
                        <p class="text-zinc-500 text-[10px]">Fuse 2 same-tier NFTs into 1 higher tier, or split down.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-teal-500/5 border border-teal-500/20" onclick="window.navigateTo&&window.navigateTo('rental')">
                    <div class="w-8 h-8 rounded-lg bg-teal-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-rocket text-teal-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Rental Manager</p>
                        <p class="text-zinc-500 text-[10px]">Rent NFT boosts from other users. AirBNFT marketplace.</p>
                    </div>
                </div>
            </div>

            <!-- Community & Services -->
            <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3 tracking-wider">Community & Services</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-5">
                <div class="ab-module-pill bg-green-500/5 border border-green-500/20" onclick="window.navigateTo&&window.navigateTo('fortune')">
                    <div class="w-8 h-8 rounded-lg bg-green-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-dice text-green-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Fortune Pool</p>
                        <p class="text-zinc-500 text-[10px]">3-tier commit-reveal game. Win up to 4.5x your entry.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-cyan-500/5 border border-cyan-500/20" onclick="window.navigateTo&&window.navigateTo('agora')">
                    <div class="w-8 h-8 rounded-lg bg-cyan-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-landmark text-cyan-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Agora</p>
                        <p class="text-zinc-500 text-[10px]">Decentralized social protocol. Posts, likes, follows on-chain.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-slate-500/5 border border-slate-500/20" onclick="window.navigateTo&&window.navigateTo('notary')">
                    <div class="w-8 h-8 rounded-lg bg-slate-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-stamp text-slate-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Notary</p>
                        <p class="text-zinc-500 text-[10px]">Certify documents on-chain. Immutable proof of existence.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-red-500/5 border border-red-500/20" onclick="window.navigateTo&&window.navigateTo('charity')">
                    <div class="w-8 h-8 rounded-lg bg-red-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-hand-holding-heart text-red-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Charity Pool</p>
                        <p class="text-zinc-500 text-[10px]">Transparent fundraising. On-chain donation tracking.</p>
                    </div>
                </div>
            </div>

            <!-- Infrastructure -->
            <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3 tracking-wider">Infrastructure & Governance</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                <div class="ab-module-pill bg-amber-500/5 border border-amber-500/20">
                    <div class="w-8 h-8 rounded-lg bg-amber-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-brain text-amber-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">BackchainEcosystem</p>
                        <p class="text-zinc-500 text-[10px]">Master hub â€” fees, operators, tutors, reward splits.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-indigo-500/5 border border-indigo-500/20">
                    <div class="w-8 h-8 rounded-lg bg-indigo-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-landmark-dome text-indigo-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Governance</p>
                        <p class="text-zinc-500 text-[10px]">Progressive decentralization: Admin â†’ Multisig â†’ Timelock â†’ DAO.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-sky-500/5 border border-sky-500/20">
                    <div class="w-8 h-8 rounded-lg bg-sky-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-faucet-drip text-sky-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">Testnet Faucet</p>
                        <p class="text-zinc-500 text-[10px]">Free BKC for testing on opBNB testnet.</p>
                    </div>
                </div>
                <div class="ab-module-pill bg-zinc-500/5 border border-zinc-500/20">
                    <div class="w-8 h-8 rounded-lg bg-zinc-500/15 flex items-center justify-center shrink-0"><i class="fa-solid fa-file-code text-zinc-400 text-sm"></i></div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white text-sm font-medium">IBackchain</p>
                        <p class="text-zinc-500 text-[10px]">Shared interfaces for all contract interactions.</p>
                    </div>
                </div>
            </div>
        </div>
    `}function wh(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.2s">
            <div class="absolute bottom-0 left-0 w-48 h-48 bg-cyan-500/5 rounded-full blur-3xl"></div>

            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-cyan-500/20">
                    <i class="fa-solid fa-arrows-split-up-and-left text-cyan-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">The Fee System</h2>
                    <p class="text-zinc-500 text-xs">How every action creates value for everyone</p>
                </div>
            </div>

            <p class="text-zinc-400 text-sm leading-relaxed mb-5">
                Every protocol action generates a small BNB fee. The smart contract automatically splits this fee among multiple beneficiaries â€” creating aligned incentives for users, builders, referrers, and the protocol.
            </p>

            <!-- Fee Flow -->
            <div class="ab-card bg-zinc-900/50 mb-5">
                <p class="text-zinc-500 text-[10px] uppercase font-bold mb-4 tracking-wider">Where Your Fees Go</p>
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 rounded-xl bg-zinc-700/50 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-user text-zinc-300 text-sm"></i>
                    </div>
                    <div class="flex-1 text-sm text-white font-medium">User pays fee (BNB)</div>
                </div>
                <div class="ml-5 border-l-2 border-zinc-700 pl-4 py-1 text-[11px] text-zinc-500 mb-4">
                    <i class="fa-solid fa-arrow-down mr-1"></i> BackchainEcosystem splits automatically
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                    <div class="bg-amber-500/10 border border-amber-500/20 rounded-xl p-3 text-center">
                        <p class="text-amber-400 text-lg font-extrabold">10%</p>
                        <p class="text-amber-400/80 text-[10px] font-bold uppercase">Tutor</p>
                        <p class="text-zinc-500 text-[10px]">Who referred you</p>
                    </div>
                    <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-3 text-center">
                        <p class="text-emerald-400 text-lg font-extrabold">10-20%</p>
                        <p class="text-emerald-400/80 text-[10px] font-bold uppercase">Operator</p>
                        <p class="text-zinc-500 text-[10px]">App builder</p>
                    </div>
                    <div class="bg-orange-500/10 border border-orange-500/20 rounded-xl p-3 text-center">
                        <p class="text-orange-400 text-lg font-extrabold">30-50%</p>
                        <p class="text-orange-400/80 text-[10px] font-bold uppercase">Buyback</p>
                        <p class="text-zinc-500 text-[10px]">Buy + burn BKC</p>
                    </div>
                    <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-3 text-center">
                        <p class="text-blue-400 text-lg font-extrabold">10-30%</p>
                        <p class="text-blue-400/80 text-[10px] font-bold uppercase">Treasury</p>
                        <p class="text-zinc-500 text-[10px]">Protocol growth</p>
                    </div>
                </div>
                <p class="text-zinc-600 text-[10px] text-center mt-3">Exact split varies by module. All percentages are immutable on-chain.</p>
            </div>

            <!-- Key Insight -->
            <div class="p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl">
                <div class="flex items-start gap-3">
                    <i class="fa-solid fa-lightbulb text-amber-400 mt-0.5"></i>
                    <div>
                        <p class="text-amber-400 font-bold text-sm">Everyone Wins</p>
                        <p class="text-zinc-400 text-xs leading-relaxed">
                            No tutor? â†’ 10% is burned instead. No operator? â†’ Operator share is burned. Every scenario either rewards a participant or makes BKC more scarce. The system has no leaks.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `}function kh(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.25s">
            <div class="absolute bottom-0 right-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl"></div>

            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-emerald-500/20">
                    <i class="fa-solid fa-hammer text-emerald-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Mining by Purchase</h2>
                    <p class="text-zinc-500 text-xs">Proof-of-Purchase: Using = Mining</p>
                </div>
            </div>

            <p class="text-zinc-400 text-sm leading-relaxed mb-5">
                In Backchain, <strong class="text-white">using the platform IS mining</strong>. When you buy an NFT Booster,
                the BuybackMiner converts the BNB spent into newly minted BKC tokens via a scarcity curve â€” the more that's been mined, the harder it gets, just like Bitcoin.
            </p>

            <!-- Mining Flow -->
            <div class="ab-card mb-5">
                <p class="text-zinc-500 text-[10px] uppercase font-bold mb-4 tracking-wider">How Mining Works</p>

                <div class="space-y-4">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-blue-400 font-bold">1</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">You Buy an NFT Booster</p>
                            <p class="text-zinc-500 text-xs">From the bonding curve pool (Diamond, Gold, Silver, Bronze)</p>
                        </div>
                    </div>

                    <div class="flex justify-center"><div class="ab-flow-line"></div></div>

                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-emerald-400 font-bold">2</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">BuybackMiner Converts BNB â†’ BKC</p>
                            <p class="text-zinc-500 text-xs">Scarcity curve: earlier miners get more BKC per BNB</p>
                        </div>
                    </div>

                    <div class="flex justify-center"><div class="ab-flow-line"></div></div>

                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-purple-400 font-bold">3</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">Rewards Distributed</p>
                            <p class="text-zinc-500 text-xs">70% to stakers (proportional to pStake), 30% to treasury</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Distribution Cards -->
            <div class="grid grid-cols-2 gap-3">
                <div class="ab-card text-center bg-gradient-to-br from-purple-500/10 to-violet-500/10 border-purple-500/30 p-4">
                    <div class="text-3xl font-black text-purple-400 mb-1">70%</div>
                    <p class="text-white font-bold text-sm">Staker Rewards</p>
                    <p class="text-zinc-500 text-[10px]">Distributed based on pStake weight</p>
                </div>
                <div class="ab-card text-center bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border-blue-500/30 p-4">
                    <div class="text-3xl font-black text-blue-400 mb-1">30%</div>
                    <p class="text-white font-bold text-sm">Treasury</p>
                    <p class="text-zinc-500 text-[10px]">Funds ecosystem development</p>
                </div>
            </div>
        </div>
    `}function Eh(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.3s">
            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-violet-500/20">
                    <i class="fa-solid fa-rocket text-violet-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Growth Programs</h2>
                    <p class="text-zinc-500 text-xs">Two systems to grow the ecosystem</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Tutor System -->
                <div class="ab-card bg-gradient-to-br from-amber-500/5 to-orange-500/5 border-amber-500/20">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-9 h-9 rounded-lg bg-amber-500/15 flex items-center justify-center">
                            <i class="fa-solid fa-graduation-cap text-amber-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white font-bold text-sm">Tutor System</p>
                            <p class="text-zinc-500 text-[10px]">Tutor new users, earn forever</p>
                        </div>
                    </div>
                    <p class="text-zinc-400 text-xs leading-relaxed mb-3">
                        Share your tutor link. When someone joins through it, they become your Tutter and you earn <strong class="text-white">10% of their BNB fees</strong> + <strong class="text-white">5% of their BKC claims</strong> â€” forever.
                    </p>
                    <div class="flex items-center gap-2">
                        <span class="ab-badge bg-amber-500/20 text-amber-400"><i class="fa-solid fa-percentage mr-1"></i>10% BNB</span>
                        <span class="ab-badge bg-amber-500/20 text-amber-400"><i class="fa-solid fa-percentage mr-1"></i>5% BKC</span>
                        <span class="ab-badge bg-zinc-700/50 text-zinc-400"><i class="fa-solid fa-infinity mr-1"></i>Forever</span>
                    </div>
                    <button onclick="window.navigateTo&&window.navigateTo('referral')" class="w-full mt-3 text-center text-xs text-amber-400 hover:text-amber-300 font-medium py-2 bg-amber-500/10 rounded-lg transition-colors">
                        Learn More <i class="fa-solid fa-arrow-right ml-1"></i>
                    </button>
                </div>

                <!-- Operator System -->
                <div class="ab-card bg-gradient-to-br from-emerald-500/5 to-green-500/5 border-emerald-500/20">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-9 h-9 rounded-lg bg-emerald-500/15 flex items-center justify-center">
                            <i class="fa-solid fa-code text-emerald-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white font-bold text-sm">Operator System</p>
                            <p class="text-zinc-500 text-[10px]">Build an app, earn commissions</p>
                        </div>
                    </div>
                    <p class="text-zinc-400 text-xs leading-relaxed mb-3">
                        Build your own frontend, bot, or integration. Set your wallet as the <strong class="text-white">operator</strong> and earn <strong class="text-white">10-20% of every fee</strong> generated through your app. No registration needed.
                    </p>
                    <div class="flex items-center gap-2">
                        <span class="ab-badge bg-emerald-500/20 text-emerald-400"><i class="fa-solid fa-percentage mr-1"></i>10-20%</span>
                        <span class="ab-badge bg-zinc-700/50 text-zinc-400"><i class="fa-solid fa-lock-open mr-1"></i>Permissionless</span>
                    </div>
                    <button onclick="window.navigateTo&&window.navigateTo('operator')" class="w-full mt-3 text-center text-xs text-emerald-400 hover:text-emerald-300 font-medium py-2 bg-emerald-500/10 rounded-lg transition-colors">
                        Learn More <i class="fa-solid fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>
        </div>
    `}function Th(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.35s">
            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-star text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Why Backchain?</h2>
                    <p class="text-zinc-500 text-xs">What makes this different</p>
                </div>
            </div>

            <div class="space-y-3">
                <div class="ab-card flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-users-slash text-amber-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">No VCs, No Pre-mine, No Insiders</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">35% of TGE (14M BKC) goes directly to the community via airdrop. 65% goes to the liquidity pool. No investors dumping tokens on you. The team earns the same way you do â€” by using the protocol.</p>
                    </div>
                </div>
                <div class="ab-card flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-bolt text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Real Utility, Not Vapor</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">Notarize legal documents. Play verifiably fair games. Trade NFTs on bonding curves. Rent boost power. Post on a censorship-resistant social network. Donate to transparent charities. These aren't promises â€” they're live contracts on opBNB.</p>
                    </div>
                </div>
                <div class="ab-card flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-chart-line text-purple-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Sustainable Yield, Not Inflation</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">Staking rewards come from real protocol fees (BNB) and mining activity â€” not from printing tokens. The more the ecosystem is used, the higher the real yield. No ponzinomics.</p>
                    </div>
                </div>
                <div class="ab-card flex gap-4 items-start">
                    <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-scale-balanced text-blue-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Aligned Incentives at Every Level</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">Users earn by staking. Tutors earn by inviting. Operators earn by building. The protocol earns by growing. No participant is extracting value from another â€” everyone benefits from usage growth.</p>
                    </div>
                </div>
            </div>
        </div>
    `}function Ch(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.4s">
            <div class="flex items-center gap-3 mb-5">
                <div class="ab-icon-box bg-blue-500/20">
                    <i class="fa-solid fa-microchip text-blue-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Technology Stack</h2>
                    <p class="text-zinc-500 text-xs">Built on battle-tested infrastructure</p>
                </div>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                <div class="ab-card text-center p-4">
                    <div class="h-8 flex items-center justify-center mb-2">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center">
                            <span class="text-sm font-black text-white">B</span>
                        </div>
                    </div>
                    <p class="text-white font-bold text-xs">opBNB</p>
                    <p class="text-zinc-500 text-[10px]">BNB Chain L2 network</p>
                </div>
                <div class="ab-card text-center p-4">
                    <div class="h-8 flex items-center justify-center mb-2">
                        <i class="fa-solid fa-code text-2xl text-zinc-400"></i>
                    </div>
                    <p class="text-white font-bold text-xs">Solidity 0.8.28</p>
                    <p class="text-zinc-500 text-[10px]">Smart contracts</p>
                </div>
                <div class="ab-card text-center p-4">
                    <div class="h-8 flex items-center justify-center mb-2">
                        <i class="fa-brands fa-js text-2xl text-yellow-400/80"></i>
                    </div>
                    <p class="text-white font-bold text-xs">ethers.js v6</p>
                    <p class="text-zinc-500 text-[10px]">Blockchain interaction</p>
                </div>
                <div class="ab-card text-center p-4">
                    <img src="./assets/alchemy.svg" class="h-8 mx-auto mb-2 opacity-80" alt="Alchemy">
                    <p class="text-white font-bold text-xs">Alchemy</p>
                    <p class="text-zinc-500 text-[10px]">RPC infrastructure</p>
                </div>
                <div class="ab-card text-center p-4">
                    <img src="./assets/metamask_icon.png" class="h-8 mx-auto mb-2 opacity-80" alt="MetaMask">
                    <p class="text-white font-bold text-xs">MetaMask</p>
                    <p class="text-zinc-500 text-[10px]">Wallet connection</p>
                </div>
                <div class="ab-card text-center p-4">
                    <div class="h-8 flex items-center justify-center mb-2">
                        <i class="fa-solid fa-globe text-2xl text-cyan-400/80"></i>
                    </div>
                    <p class="text-white font-bold text-xs">Arweave / IPFS</p>
                    <p class="text-zinc-500 text-[10px]">Permanent storage</p>
                </div>
            </div>
        </div>
    `}function Bh(){return`
        <div class="ab-section ab-fade-up text-center bg-gradient-to-b from-amber-500/5 to-transparent" style="animation-delay: 0.45s">
            <img src="./assets/bkc_logo_3d.png" class="w-16 h-16 mx-auto mb-4 opacity-80" alt="BKC">

            <h2 class="text-2xl font-bold text-white mb-2">Ready to Join?</h2>
            <p class="text-zinc-400 text-sm mb-6 max-w-md mx-auto">
                Start earning airdrop points today. Stake, trade, play, or build â€” every action counts.
            </p>

            <div class="flex flex-col sm:flex-row gap-3 justify-center mb-4">
                <button onclick="window.navigateTo && window.navigateTo('airdrop')"
                    class="px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl hover:scale-105 transition-transform">
                    <i class="fa-solid fa-parachute-box mr-2"></i>Join Airdrop
                </button>
                <button onclick="window.navigateTo && window.navigateTo('staking')"
                    class="px-6 py-3 bg-zinc-800 text-white font-bold rounded-xl border border-zinc-700 hover:border-amber-500/50 transition-colors">
                    <i class="fa-solid fa-layer-group mr-2"></i>Start Staking
                </button>
                <button id="openWhitepaperBtn"
                    class="px-6 py-3 bg-zinc-800 text-white font-bold rounded-xl border border-zinc-700 hover:border-cyan-500/50 transition-colors">
                    <i class="fa-solid fa-file-lines mr-2"></i>Whitepaper
                </button>
            </div>

            <div class="flex justify-center gap-6 pt-2">
                <a href="https://x.com/backcoin" target="_blank" rel="noopener noreferrer" class="text-zinc-500 hover:text-white transition-colors text-lg" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
                <a href="https://web.telegram.org/k/#@BackCoinorg" target="_blank" rel="noopener noreferrer" class="text-zinc-500 hover:text-white transition-colors text-lg" title="Telegram"><i class="fa-brands fa-telegram"></i></a>
                <a href="https://www.youtube.com/@Backcoin" target="_blank" rel="noopener noreferrer" class="text-zinc-500 hover:text-white transition-colors text-lg" title="YouTube"><i class="fa-brands fa-youtube"></i></a>
            </div>
        </div>
    `}function Ah(){return`
        <div id="whitepaperModal" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
            <div class="ab-card bg-zinc-900 border-zinc-700 w-full max-w-md transform scale-95 transition-transform duration-300">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white">Documentation</h3>
                    <button id="closeWhitepaperBtn" class="text-zinc-500 hover:text-white transition-colors">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>

                <div class="space-y-3">
                    <a href="./assets/backchain-tokenomics-v3.html" target="_blank"
                        class="flex items-center gap-4 p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-amber-500/50 transition-all group">
                        <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-coins text-amber-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm group-hover:text-amber-400 transition-colors">Tokenomics Paper V3</p>
                            <p class="text-zinc-500 text-xs">Distribution, Mining & Scarcity Engines</p>
                        </div>
                        <i class="fa-solid fa-arrow-up-right-from-square text-zinc-600 group-hover:text-white"></i>
                    </a>

                    <a href="./assets/backchain-ecosystem-whitepaper-v2.html" target="_blank"
                        class="flex items-center gap-4 p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-cyan-500/50 transition-all group">
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-network-wired text-cyan-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm group-hover:text-cyan-400 transition-colors">Technical Whitepaper V2</p>
                            <p class="text-zinc-500 text-xs">Architecture, Contracts & Fee System</p>
                        </div>
                        <i class="fa-solid fa-arrow-up-right-from-square text-zinc-600 group-hover:text-white"></i>
                    </a>
                </div>
            </div>
        </div>
    `}function Si(){const e=document.getElementById("openWhitepaperBtn"),t=document.getElementById("closeWhitepaperBtn"),a=document.getElementById("whitepaperModal");if(!a)return;const n=()=>{a.classList.remove("hidden"),setTimeout(()=>{a.classList.remove("opacity-0"),a.querySelector(".ab-card").classList.remove("scale-95"),a.querySelector(".ab-card").classList.add("scale-100")},10)},o=()=>{a.classList.add("opacity-0"),a.querySelector(".ab-card").classList.remove("scale-100"),a.querySelector(".ab-card").classList.add("scale-95"),setTimeout(()=>a.classList.add("hidden"),300)};e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",o),a==null||a.addEventListener("click",s=>{s.target===a&&o()})}function Ih(){const e=document.getElementById("about");e&&(bh(),e.innerHTML=`
        <div class="max-w-3xl mx-auto px-4 py-8 pb-24">
            ${xh()}
            ${hh()}
            ${vh()}
            ${yh()}
            ${wh()}
            ${kh()}
            ${Eh()}
            ${Th()}
            ${Ch()}
            ${Bh()}
            ${Ah()}

            <!-- Footer -->
            <div class="text-center py-6 text-zinc-600 text-xs">
                <p>Built by the community, for the community.</p>
                <p class="mt-1">BACKCHAIN &copy; 2024-2026</p>
            </div>
        </div>
    `,Si(),e.scrollIntoView({behavior:"smooth",block:"start"}))}const Ph={render:Ih,init:Si,update:Si},Nh="#BKC #Backcoin #Airdrop",bg=2,xg={agoraProfile:{icon:"ðŸ‘¤",label:"Create Profile",points:3e3,maxCount:1,cooldownHours:0,enabled:!0},agoraPost:{icon:"âœï¸",label:"Post on Agora",points:2e3,maxCount:20,cooldownHours:0,enabled:!0},agoraLike:{icon:"â¤ï¸",label:"Like a Post",points:500,maxCount:20,cooldownHours:0,enabled:!0},faucet:{icon:"ðŸš°",label:"Claim Faucet",points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{icon:"ðŸ“Š",label:"Delegate BKC",points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{icon:"ðŸŽ°",label:"Play Fortune",points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{icon:"ðŸ›’",label:"Buy NFT",points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{icon:"ðŸ’°",label:"Sell NFT",points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{icon:"ðŸ·ï¸",label:"List for Rent",points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{icon:"â°",label:"Rent NFT",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{icon:"ðŸ“œ",label:"Notarize Doc",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{icon:"ðŸ’¸",label:"Claim Rewards",points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{icon:"â†©ï¸",label:"Unstake",points:500,maxCount:10,cooldownHours:0,enabled:!0}},zh={agoraProfile:"agora",agoraPost:"agora",agoraLike:"agora",faucet:"faucet",delegation:"tokenomics",fortune:"fortune",buyNFT:"marketplace",sellNFT:"marketplace",listRental:"rentals",rentNFT:"rentals",notarize:"notary",claimReward:"tokenomics",unstake:"tokenomics"},Et=[{name:"Diamond",icon:"ðŸ’Ž",ranks:"#1 â€“ #5",count:5,color:"cyan",burn:"0%",receive:"100%",gradient:"from-cyan-500/20 to-cyan-900/10",border:"border-cyan-500/30",text:"text-cyan-300",postsNeeded:0},{name:"Gold",icon:"ðŸ¥‡",ranks:"#6 â€“ #25",count:20,color:"yellow",burn:"10%",receive:"90%",gradient:"from-yellow-500/20 to-yellow-900/10",border:"border-yellow-500/30",text:"text-yellow-400",postsNeeded:0},{name:"Silver",icon:"ðŸ¥ˆ",ranks:"#26 â€“ #75",count:50,color:"gray",burn:"25%",receive:"75%",gradient:"from-gray-400/20 to-gray-800/10",border:"border-gray-400/30",text:"text-gray-300",postsNeeded:0},{name:"Bronze",icon:"ðŸ¥‰",ranks:"#76 â€“ #200",count:125,color:"amber",burn:"40%",receive:"60%",gradient:"from-amber-600/20 to-amber-900/10",border:"border-amber-600/30",text:"text-amber-500",postsNeeded:0}],Kr=200;function $h(e){if(!e||e<=0)return"Ready";const t=Math.floor(e/(1e3*60*60)),a=Math.floor(e%(1e3*60*60)/(1e3*60));return t>0?`${t}h ${a}m`:`${a}m`}function Sh(e){return e>=100?10:e>=90?9:e>=80?8:e>=70?7:e>=60?6:e>=50?5:e>=40?4:e>=30?3:e>=20?2:1}let L={isConnected:!1,systemConfig:null,platformUsageConfig:null,basePoints:null,leaderboards:null,user:null,dailyTasks:[],userSubmissions:[],platformUsage:{},isBanned:!1,activeTab:"earn",activeRanking:"posts",historyExpanded:!1,agoraHasProfile:!1,agoraUsername:null,agoraPosts:[],claimInfo:null,claimProof:null,claimLoading:!1};function Lh(){if(document.getElementById("airdrop-custom-styles"))return;const e=document.createElement("style");e.id="airdrop-custom-styles",e.textContent=`
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }

        @keyframes float-slow {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.02); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.2); }
            50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.4); }
        }

        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes fade-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-12px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes count-up {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes glow-pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        .airdrop-float { animation: float 4s ease-in-out infinite; }
        .airdrop-float-slow { animation: float-slow 3s ease-in-out infinite; }
        .airdrop-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .airdrop-bounce { animation: bounce-gentle 2s ease-in-out infinite; }
        .airdrop-spin { animation: spin-slow 20s linear infinite; }
        .airdrop-fade-up { animation: fade-up 0.5s ease-out forwards; }
        .airdrop-pulse-ring { animation: pulse-ring 2s infinite; }
        .airdrop-slide-in { animation: slide-in 0.4s ease-out forwards; }
        .airdrop-glow { animation: glow-pulse 2s ease-in-out infinite; }

        .airdrop-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
            background-size: 200% 100%;
            animation: shimmer 2.5s infinite;
        }

        .airdrop-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .airdrop-card:hover {
            transform: translateY(-3px);
        }

        .airdrop-tab-active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-weight: 700;
        }

        .airdrop-gradient-text {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .social-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .social-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .social-btn:active {
            transform: scale(0.95);
        }

        .cta-mega {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cta-mega:hover {
            box-shadow: 0 12px 40px rgba(245, 158, 11, 0.35);
            transform: translateY(-2px);
        }

        .platform-action-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .platform-action-card:hover:not(.completed) { transform: translateY(-3px); border-color: #f59e0b; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .platform-action-card.completed { opacity: 0.5; cursor: default; }

        .progress-bar-bg { background: rgba(63, 63, 70, 0.5); }
        .progress-bar-fill {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .scroll-area::-webkit-scrollbar { width: 4px; }
        .scroll-area::-webkit-scrollbar-track { background: transparent; }
        .scroll-area::-webkit-scrollbar-thumb { background: rgba(113, 113, 122, 0.5); border-radius: 2px; }

        .tier-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .tier-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.03) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .tier-card:hover::before { opacity: 1; }
        .tier-card:hover { transform: translateY(-2px) scale(1.01); }

        .stat-value {
            animation: count-up 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .rank-badge {
            position: relative;
            overflow: hidden;
        }
        .rank-badge::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent);
            animation: spin-slow 8s linear infinite;
        }

        /* V6.0: Accordion */
        .accordion-chevron {
            transition: transform 0.3s ease;
        }
        .accordion-chevron.expanded {
            transform: rotate(180deg);
        }
        .accordion-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .accordion-body.expanded {
            max-height: 2000px;
        }

        /* V6.0: Notification badge */
        .notif-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 999px;
            background: #ef4444;
            color: white;
            padding: 0 4px;
            animation: pulse-ring 2s infinite;
        }
    `,document.head.appendChild(e)}async function Fn(){var e;L.isConnected=u.isConnected,L.user=null,L.userSubmissions=[],L.platformUsage={},L.isBanned=!1;try{const t=await xs();if(L.systemConfig=t.config,L.leaderboards=t.leaderboards,L.dailyTasks=t.dailyTasks||[],L.platformUsageConfig=t.platformUsageConfig||xg,L.isConnected&&u.userAddress){const[a,n]=await Promise.all([cn(u.userAddress),yd()]);if(L.user=a,L.userSubmissions=n,a&&a.isBanned){L.isBanned=!0;return}try{typeof yi=="function"&&(L.platformUsage=await yi()||{})}catch(o){console.warn("Could not load platform usage:",o),L.platformUsage={}}L.dailyTasks.length>0&&(L.dailyTasks=await Promise.all(L.dailyTasks.map(async o=>{try{if(!o.id)return{...o,eligible:!1,timeLeftMs:0};const s=await Qi(o.id,o.cooldownHours);return{...o,eligible:s.eligible,timeLeftMs:s.timeLeft}}catch{return{...o,eligible:!1,timeLeftMs:0}}})))}}catch(t){if(console.error("Airdrop Data Load Error:",t),t.code==="permission-denied"||(e=t.message)!=null&&e.includes("permission")){console.warn("Firebase permissions issue - user may need to connect wallet or sign in"),L.systemConfig=L.systemConfig||{},L.leaderboards=L.leaderboards||{top100ByPoints:[],top100ByPosts:[]},L.dailyTasks=L.dailyTasks||[];return}x("Error loading data. Please refresh.","error")}}const ic=10313523;async function _h(){var e;if(L.agoraHasProfile=!1,L.agoraUsername=null,L.agoraPosts=[],!(!u.isConnected||!u.userAddress))try{const t=(E==null?void 0:E.agora)||(R==null?void 0:R.agora)||((e=window.contractAddresses)==null?void 0:e.agora);if(!t)return;const a=te.getProvider(),n=new window.ethers.Contract(t,la,a),[o,s]=await Promise.all([n.queryFilter(n.filters.ProfileCreated(u.userAddress),ic).catch(()=>[]),n.queryFilter(n.filters.PostCreated(null,u.userAddress),ic).catch(()=>[])]);o.length>0&&(L.agoraHasProfile=!0,L.agoraUsername=o[0].args.username||o[0].args[1]);const i=s.filter(r=>{const l=r.args.contentHash||r.args[4];return l&&l.length>0});L.agoraPosts=i.slice(-5).reverse().map(r=>({postId:Number(r.args.postId||r.args[0]),contentHash:r.args.contentHash||r.args[4],contentType:Number(r.args.contentType||r.args[3]),tag:Number(r.args.tag||r.args[2])}))}catch(t){console.warn("[Airdrop] Agora data:",t.message)}}async function hg(){if(L.claimInfo=null,L.claimProof=null,!(!u.isConnected||!u.userAddress)&&Xn.getAirdropClaimAddress())try{const e=await Xn.getClaimInfo(u.userAddress);if(L.claimInfo=e,e&&e.isActive&&!e.claimed){const t=await Xn.getMerkleProof(u.userAddress,e.phase);L.claimProof=t}}catch(e){console.warn("[Airdrop] Claim data load failed:",e.message)}}function Vr(e){if(!L.user||!e||e.length===0)return null;const t=e.findIndex(a=>{var n,o;return((n=a.walletAddress)==null?void 0:n.toLowerCase())===((o=L.user.walletAddress)==null?void 0:o.toLowerCase())});return t>=0?t+1:null}function Yr(e){return e?e<=5?Et[0]:e<=25?Et[1]:e<=75?Et[2]:e<=200?Et[3]:null:null}function vg(e){return e?e<=5?null:e<=25?{nextTier:Et[0],postsNeeded:e-5}:e<=75?{nextTier:Et[1],postsNeeded:e-25}:e<=200?{nextTier:Et[2],postsNeeded:e-75}:{nextTier:Et[3],postsNeeded:e-200}:{nextTier:Et[3],postsNeeded:1}}function Us(){const e=Date.now(),t=bg*60*60*1e3;return L.userSubmissions.filter(a=>["pending","auditing"].includes(a.status)&&a.submittedAt&&e-a.submittedAt.getTime()>=t)}function yg(){var l;const{user:e}=L,t=(e==null?void 0:e.totalPoints)||0,a=(e==null?void 0:e.approvedSubmissionsCount)||0,n=Sh(a),o=((l=L.leaderboards)==null?void 0:l.top100ByPosts)||[],s=Vr(o),i=Yr(s),r=Us().length;return`
        <div class="px-4 pt-4 md:pt-6 pb-2">
            <!-- Title Row -->
            <div class="flex items-center justify-between mb-3">
                <div>
                    <h1 class="text-lg md:text-2xl font-black text-white">Airdrop <span class="airdrop-gradient-text hidden md:inline">Campaign</span></h1>
                    <span class="text-[9px] md:text-xs text-zinc-500">${Kr} NFTs â€¢ 4 Tiers</span>
                </div>
                <a href="https://t.me/BackCoinorg" target="_blank"
                   class="flex items-center gap-1.5 bg-sky-500/10 hover:bg-sky-500/20 border border-sky-500/30 text-sky-400 px-3 py-1.5 rounded-full transition-all hover:scale-105 text-xs md:text-sm">
                    <i class="fa-brands fa-telegram"></i>
                    <span class="hidden md:inline font-bold">Community</span>
                </a>
            </div>

            ${L.isConnected?`
            <!-- Stats Row -->
            <div class="grid grid-cols-4 gap-2 md:gap-3 mb-3">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2 md:p-3 text-center">
                    <span class="text-sm md:text-xl font-bold text-amber-400 stat-value">${t.toLocaleString()}</span>
                    <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase tracking-wider">Points</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2 md:p-3 text-center">
                    <span class="text-sm md:text-xl font-bold text-green-400 stat-value">${a}</span>
                    <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase tracking-wider">Posts</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2 md:p-3 text-center">
                    <span class="text-sm md:text-xl font-bold text-purple-400 stat-value">${n.toFixed(1)}x</span>
                    <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase tracking-wider">Boost</p>
                </div>
                <div class="bg-zinc-900/80 border ${i?i.border:"border-zinc-800"} rounded-xl p-2 md:p-3 text-center relative overflow-hidden">
                    ${i?`
                        <div class="absolute inset-0 bg-gradient-to-br ${i.gradient} opacity-30"></div>
                        <span class="text-sm md:text-xl font-bold ${i.text} relative z-10">${i.icon} #${s}</span>
                        <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase relative z-10">${i.name}</p>
                    `:`
                        <span class="text-sm md:text-xl font-bold text-zinc-600">â€”</span>
                        <p class="text-[7px] md:text-[10px] text-zinc-500 uppercase">Rank</p>
                    `}
                </div>
            </div>
            `:""}

            <!-- Navigation â€” 2 Tabs -->
            <div class="flex justify-center">
                <div class="bg-zinc-900/80 p-1 md:p-1.5 rounded-full border border-zinc-800 inline-flex gap-1 w-full md:w-auto">
                    <button data-target="earn"
                            class="nav-pill-btn flex-1 md:flex-none md:px-6 py-2.5 rounded-full text-xs md:text-sm font-bold transition-all flex items-center justify-center gap-1.5 relative
                                   ${L.activeTab==="earn"?"airdrop-tab-active shadow-lg shadow-amber-500/20":"text-zinc-400 hover:text-white hover:bg-zinc-800"}">
                        <i class="fa-solid fa-coins"></i> Earn
                        ${r>0?`<span class="notif-badge">${r}</span>`:""}
                    </button>
                    <button data-target="ranking"
                            class="nav-pill-btn flex-1 md:flex-none md:px-6 py-2.5 rounded-full text-xs md:text-sm font-bold transition-all flex items-center justify-center gap-1.5
                                   ${L.activeTab==="ranking"?"airdrop-tab-active shadow-lg shadow-amber-500/20":"text-zinc-400 hover:text-white hover:bg-zinc-800"}">
                        <i class="fa-solid fa-trophy"></i> Ranking
                    </button>
                </div>
            </div>
        </div>
    `}function Rh(){const e=L.claimInfo;if(!e)return"";const t=window.ethers;if(!e.isActive)return`
            <div class="bg-gradient-to-br from-emerald-900/20 to-zinc-900/80 border border-emerald-500/20 rounded-2xl p-4 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-emerald-500/5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center">
                        <i class="fa-solid fa-gift text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white">Token Claim</h3>
                        <p class="text-zinc-500 text-[10px]">Phase ${e.phase||0} completed</p>
                    </div>
                </div>
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center">
                    <p class="text-zinc-400 text-xs">No active claim phase right now</p>
                    <p class="text-zinc-600 text-[10px] mt-1">Next phase will be announced on Telegram</p>
                </div>
                ${e.totalClaimCount>0?`
                <div class="flex items-center justify-center gap-4 mt-3 text-[10px] text-zinc-500">
                    <span>${e.totalClaimCount} claims</span>
                    <span>${Number(t.formatEther(e.totalClaimed)).toLocaleString()} BKC distributed</span>
                </div>
                `:""}
            </div>
        `;if(e.claimed)return`
            <div class="bg-gradient-to-br from-emerald-900/20 to-zinc-900/80 border border-emerald-500/30 rounded-2xl p-4 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-emerald-500/5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                        <i class="fa-solid fa-check-circle text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white">Phase ${e.phase} Claimed</h3>
                        <p class="text-emerald-400 text-[10px]">Tokens auto-staked for ${e.lockDays} days</p>
                    </div>
                </div>
                <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-3 text-center">
                    <p class="text-emerald-300 text-xs font-medium">You've already claimed your allocation!</p>
                    <p class="text-zinc-500 text-[10px] mt-1">Tokens are earning staking rewards</p>
                </div>
            </div>
        `;const a=L.claimProof,n=Number(t.formatEther(e.availableBalance)).toLocaleString();if(!a)return`
            <div class="bg-gradient-to-br from-emerald-900/20 to-zinc-900/80 border border-emerald-500/20 rounded-2xl p-4 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-emerald-500/5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center airdrop-pulse-glow">
                        <i class="fa-solid fa-gift text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white">Phase ${e.phase} Active</h3>
                        <p class="text-emerald-400 text-[10px]">${n} BKC available</p>
                    </div>
                </div>
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center">
                    <p class="text-zinc-400 text-xs">Your wallet is not eligible for this phase</p>
                    <p class="text-zinc-600 text-[10px] mt-1">Keep earning points â€” higher ranks qualify for future phases!</p>
                </div>
            </div>
        `;const o=Number(t.formatEther(a.amount)).toLocaleString(),s=L.claimLoading;return`
        <div class="bg-gradient-to-br from-emerald-900/30 to-zinc-900/80 border border-emerald-500/40 rounded-2xl p-4 relative overflow-hidden airdrop-pulse-glow">
            <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
            <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                    <i class="fa-solid fa-gift text-emerald-400 airdrop-bounce"></i>
                </div>
                <div>
                    <h3 class="text-sm font-bold text-white">Phase ${e.phase} â€” Claim Available!</h3>
                    <p class="text-emerald-400 text-[10px]">Your allocation is ready</p>
                </div>
            </div>

            <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-4 text-center mb-3">
                <p class="text-zinc-400 text-[10px] uppercase tracking-wider mb-1">Your Allocation</p>
                <p class="text-2xl font-black text-emerald-300">${o} <span class="text-sm text-emerald-500">BKC</span></p>
                <p class="text-zinc-500 text-[10px] mt-1">Auto-staked for ${e.lockDays} days</p>
            </div>

            <button id="claim-airdrop-btn"
                    class="w-full cta-mega text-black font-bold py-3 rounded-xl text-sm transition-all ${s?"opacity-60 cursor-not-allowed":""}"
                    ${s?"disabled":""}>
                ${s?'<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Claiming...':'<i class="fa-solid fa-rocket mr-2"></i> Claim & Auto-Stake'}
            </button>

            <p class="text-zinc-600 text-[10px] mt-2 text-center">
                <i class="fa-solid fa-lock mr-1"></i> Tokens are locked for ${e.lockDays} days while earning staking rewards
            </p>
        </div>
    `}function rc(){return L.isConnected?`
        <div class="px-4 space-y-4 airdrop-fade-up pb-24">
            ${Rh()}
            ${Fh()}
            ${Dh()}
            ${Uh()}
            ${Hh()}
            ${jh()}
            ${Wh()}
        </div>
    `:`
            <div class="text-center px-4 py-12 airdrop-fade-up">
                <div class="w-24 h-24 mx-auto mb-6 airdrop-float">
                    <img src="./assets/airdrop.png" alt="Connect" class="w-full h-full object-contain opacity-50">
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Connect Your Wallet</h3>
                <p class="text-zinc-500 text-sm max-w-xs mx-auto mb-4">Connect to start earning points and win NFT rewards.</p>

                <div class="max-w-xs mx-auto bg-zinc-900/60 border border-zinc-800 rounded-xl p-3">
                    <p class="text-zinc-500 text-[10px] uppercase tracking-wider mb-2">Win 1 of ${Kr} NFT Boosters</p>
                    <div class="flex justify-center gap-3 text-lg">
                        ${Et.map(e=>`<span title="${e.name}">${e.icon}</span>`).join("")}
                    </div>
                </div>
            </div>
        `}function Fh(){const e=Us();return e.length===0?"":`
        <div class="bg-gradient-to-r from-green-900/30 to-zinc-900/80 border border-green-500/40 rounded-xl p-3 relative overflow-hidden">
            <div class="absolute left-0 top-0 bottom-0 w-1 bg-green-500"></div>
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-full bg-green-500/20 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-bell text-green-400 airdrop-bounce"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">${e.length} post${e.length>1?"s":""} ready to verify!</p>
                        <p class="text-green-400/70 text-[10px]">Confirm to earn points</p>
                    </div>
                </div>
                <button id="action-required-btn" class="bg-green-600 hover:bg-green-500 text-white font-bold px-4 py-2 rounded-lg text-xs transition-all">
                    Review
                </button>
            </div>
        </div>
    `}function Dh(){var s;const e=((s=L.leaderboards)==null?void 0:s.top100ByPosts)||[],t=Vr(e),a=Yr(t),n=vg(t);if(!t)return`
            <div id="rank-snippet-btn" class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 flex items-center justify-between cursor-pointer hover:border-amber-500/30 transition-colors">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-amber-500/10 flex items-center justify-center">
                        <i class="fa-solid fa-arrow-up text-amber-400 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-zinc-300 text-sm font-medium">Start posting to join the ranking!</p>
                        <p class="text-zinc-500 text-[10px]">Top 200 earn exclusive NFT Boosters</p>
                    </div>
                </div>
                <i class="fa-solid fa-chevron-right text-zinc-600 text-xs"></i>
            </div>
        `;let o="";if(n){const i=t<=25?5:t<=75?25:t<=200?75:200,r=t<=25?25:t<=75?75:200;o=`
            <div class="flex-1 mx-3">
                <div class="progress-bar-bg h-1.5 rounded-full">
                    <div class="progress-bar-fill h-full rounded-full" style="width: ${Math.max(0,Math.min(100,(r-t)/(r-i)*100))}%"></div>
                </div>
                <p class="text-zinc-500 text-[9px] mt-0.5">${n.postsNeeded} more to ${n.nextTier.icon} ${n.nextTier.name}</p>
            </div>
        `}else o=`
            <div class="flex-1 mx-3">
                <div class="progress-bar-bg h-1.5 rounded-full">
                    <div class="progress-bar-fill h-full rounded-full" style="width: 100%"></div>
                </div>
                <p class="text-cyan-400/70 text-[9px] mt-0.5">Top tier reached!</p>
            </div>
        `;return`
        <div id="rank-snippet-btn" class="bg-zinc-900/80 border ${a.border} rounded-xl p-3 flex items-center cursor-pointer hover:border-amber-500/30 transition-colors relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r ${a.gradient} opacity-20"></div>
            <div class="flex items-center gap-2 relative z-10 shrink-0">
                <span class="text-lg">${a.icon}</span>
                <div>
                    <span class="${a.text} font-bold text-sm">#${t}</span>
                    <p class="text-zinc-500 text-[9px]">${a.name}</p>
                </div>
            </div>
            <div class="relative z-10 flex-1">${o}</div>
            <i class="fa-solid fa-chevron-right text-zinc-600 text-xs relative z-10 shrink-0"></i>
        </div>
    `}function Mh(e){const t=e.contentType;if(t===1)return{icon:"fa-image",text:"Image post",color:"text-blue-400"};if(t===2)return{icon:"fa-video",text:"Video post",color:"text-purple-400"};if(t===3)return{icon:"fa-link",text:"Link post",color:"text-cyan-400"};const a=e.contentHash||"";return{icon:"fa-quote-left",text:(a.length>80?a.slice(0,77)+"...":a)||"Text post",color:"text-zinc-300"}}function wg(e){const t=L.agoraUsername,a=u.userAddress||"",n=t?`@${t}/${e}`:`post=${e}`,o=a?`&ref=${a}`:"";return`${window.location.origin}/#agora?${n}${o}`}function Oh(e,t){const a=wg(e),n=`${t.length>60?t.slice(0,57)+"...":t}

${a}

${Nh}`;return`https://twitter.com/intent/tweet?text=${encodeURIComponent(n)}`}function Uh(){const{agoraHasProfile:e,agoraPosts:t}=L;return e?t.length===0?`
            <div class="bg-zinc-900/80 border border-zinc-800 rounded-2xl overflow-hidden">
                <div class="px-4 pt-4 pb-2">
                    <h2 class="text-sm font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-share-nodes text-amber-400"></i> Share to Earn
                    </h2>
                    <p class="text-zinc-500 text-[10px] mt-0.5">Post on Agora â†’ Share on social media â†’ Submit link â†’ Earn points</p>
                </div>
                <div class="px-4 pb-3 text-center">
                    <div class="bg-amber-500/10 border border-amber-500/20 rounded-xl p-4 mb-3">
                        <p class="text-amber-400 font-bold text-sm mb-1"><i class="fa-solid fa-pen-fancy mr-1"></i> Create Your First Post</p>
                        <p class="text-zinc-400 text-xs mb-3">Write something on Agora, then share it on social media to earn airdrop points!</p>
                        <button class="agora-nav-btn cta-mega text-black font-bold py-2 px-5 rounded-xl text-sm" data-target="agora">
                            <i class="fa-solid fa-plus mr-1"></i> Post on Agora
                        </button>
                    </div>
                </div>
                ${lc()}
            </div>
        `:`
        <div class="bg-zinc-900/80 border border-zinc-800 rounded-2xl overflow-hidden">
            <div class="px-4 pt-4 pb-2 flex items-center justify-between">
                <div>
                    <h2 class="text-sm font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-share-nodes text-amber-400"></i> Share to Earn
                    </h2>
                    <p class="text-zinc-500 text-[10px] mt-0.5">Share your Agora posts on social media to earn points</p>
                </div>
                <button class="agora-nav-btn text-amber-400 hover:text-amber-300 text-xs font-medium transition-colors" data-target="agora">
                    <i class="fa-solid fa-plus mr-1"></i>New Post
                </button>
            </div>

            <!-- Posts to Share -->
            <div class="px-4 pb-3 space-y-2">
                ${t.map(a=>{const n=Mh(a),o=wg(a.postId),s=Oh(a.postId,n.text);return`
                        <div class="bg-black/40 border border-zinc-700/50 rounded-xl p-3 flex items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <p class="text-xs ${n.color} truncate">
                                    <i class="fa-solid ${n.icon} mr-1 text-[10px]"></i>${n.text}
                                </p>
                                <p class="text-zinc-600 text-[9px] mt-0.5">#${a.postId}</p>
                            </div>
                            <div class="flex items-center gap-1.5 shrink-0">
                                <a href="${s}" target="_blank"
                                   class="social-btn w-8 h-8 rounded-lg bg-black/60 border border-zinc-700 hover:border-blue-500/50 flex items-center justify-center" title="Share on X">
                                    <i class="fa-brands fa-x-twitter text-white text-xs"></i>
                                </a>
                                <button class="social-btn copy-agora-link w-8 h-8 rounded-lg bg-black/60 border border-zinc-700 hover:border-amber-500/50 flex items-center justify-center" title="Copy link" data-url="${o}">
                                    <i class="fa-solid fa-copy text-zinc-400 text-xs"></i>
                                </button>
                            </div>
                        </div>
                    `}).join("")}
            </div>

            <!-- Divider -->
            <div class="border-t border-zinc-800 mx-4"></div>

            ${lc()}
        </div>
    `:`
            <div class="bg-gradient-to-br from-indigo-900/30 to-zinc-900/80 border border-indigo-500/30 rounded-2xl overflow-hidden">
                <div class="px-4 pt-4 pb-2">
                    <h2 class="text-sm font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-rocket text-indigo-400"></i> Share to Earn
                    </h2>
                    <p class="text-zinc-500 text-[10px] mt-0.5">Create posts on Agora, share on social media, earn points</p>
                </div>
                <div class="px-4 pb-4 text-center">
                    <div class="bg-indigo-500/10 border border-indigo-500/20 rounded-xl p-5 mb-3">
                        <div class="text-3xl mb-2"><i class="fa-solid fa-user-plus text-indigo-400"></i></div>
                        <p class="text-white font-bold text-sm mb-1">Create Your Agora Profile</p>
                        <p class="text-zinc-400 text-xs mb-3">Join the decentralized social network to start earning points by sharing your posts.</p>
                        <button class="agora-nav-btn cta-mega text-black font-bold py-2.5 px-6 rounded-xl text-sm" data-target="agora">
                            <i class="fa-solid fa-arrow-right mr-1"></i> Go to Agora
                        </button>
                    </div>
                    <div class="flex items-center gap-3 text-zinc-500 text-[10px]">
                        <div class="flex items-center gap-1"><i class="fa-solid fa-pen-to-square"></i> Create posts</div>
                        <div class="text-zinc-700">â†’</div>
                        <div class="flex items-center gap-1"><i class="fa-brands fa-x-twitter"></i> Share on X</div>
                        <div class="text-zinc-700">â†’</div>
                        <div class="flex items-center gap-1"><i class="fa-solid fa-coins"></i> Earn points</div>
                    </div>
                </div>
            </div>
        `}function lc(){return`
        <div class="px-4 py-3">
            <p class="text-zinc-400 text-[10px] uppercase tracking-wider mb-2 flex items-center gap-1">
                <i class="fa-solid fa-link text-[8px]"></i> Submit your social media post link
            </p>
            <div class="relative">
                <input type="url" id="content-url-input"
                       placeholder="Paste your X / TikTok / Instagram post URL..."
                       class="w-full bg-black/50 border border-zinc-600 rounded-xl pl-3 pr-20 py-2.5 text-white text-sm focus:border-amber-500 focus:ring-1 focus:ring-amber-500 outline-none transition-all placeholder:text-zinc-600">
                <button id="submit-content-btn"
                        class="absolute right-1.5 top-1.5 bottom-1.5 bg-green-600 hover:bg-green-500 text-white font-bold px-3 rounded-lg transition-all text-sm">
                    Submit
                </button>
            </div>
            <p class="text-amber-400/60 text-[9px] mt-1.5 flex items-center gap-1">
                <i class="fa-solid fa-exclamation-circle"></i> Share an Agora post on social media, then paste the link here â€¢ 2h audit
            </p>
        </div>
    `}function Hh(){var i;const e=L.platformUsageConfig||xg,t=L.platformUsage||{};let a=0,n=0;Object.keys(e).forEach(r=>{var l;e[r].enabled!==!1&&e[r].maxCount&&(a+=e[r].maxCount,n+=Math.min(((l=t[r])==null?void 0:l.count)||0,e[r].maxCount))});const o=a>0?n/a*100:0;return`
        <div>
            <!-- Section Header + Progress -->
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-sm font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-gamepad text-purple-400"></i> Platform Quests
                </h2>
                <span class="text-cyan-400 text-[10px] font-bold">${(((i=L.user)==null?void 0:i.platformUsagePoints)||0).toLocaleString()} pts</span>
            </div>
            <div class="flex items-center gap-2 mb-3">
                <div class="progress-bar-bg h-1.5 rounded-full flex-1">
                    <div class="progress-bar-fill h-full rounded-full" style="width: ${o}%"></div>
                </div>
                <span class="text-amber-400 text-[10px] font-bold shrink-0">${n}/${a}</span>
            </div>

            <!-- Actions Grid -->
            <div class="grid grid-cols-2 gap-2" id="platform-actions-grid">
                ${Object.entries(e).filter(([r,l])=>l.enabled!==!1).map(([r,l])=>{const c=t[r]||{count:0},d=c.count>=l.maxCount,f=Math.max(0,l.maxCount-c.count),g=c.count/l.maxCount*100,m=zh[r]||"";return`
                        <div class="platform-action-card bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 ${d?"completed opacity-60":"cursor-pointer hover:border-amber-500/50 hover:bg-zinc-800/80"} transition-all"
                             data-platform-action="${r}"
                             data-target-page="${m}">
                            <div class="flex items-start justify-between mb-1.5">
                                <span class="text-lg">${l.icon}</span>
                                ${d?'<span class="text-green-400 text-xs"><i class="fa-solid fa-check-circle"></i></span>':`<span class="text-amber-400 text-[10px] font-bold">+${l.points}</span>`}
                            </div>
                            <p class="text-white text-xs font-medium mb-1">${l.label}</p>
                            <div class="flex items-center justify-between mb-1.5">
                                <span class="text-zinc-500 text-[10px]">${c.count}/${l.maxCount}</span>
                                ${!d&&f>0?`<span class="text-zinc-600 text-[10px]">${f} left</span>`:""}
                            </div>
                            <div class="progress-bar-bg h-1 rounded-full">
                                <div class="progress-bar-fill h-full rounded-full" style="width: ${g}%"></div>
                            </div>
                            ${!d&&m?`
                                <div class="mt-2 text-center">
                                    <span class="text-amber-400/70 text-[9px]"><i class="fa-solid fa-arrow-right mr-1"></i>Tap to go</span>
                                </div>
                            `:""}
                        </div>
                    `}).join("")}
            </div>
        </div>
    `}function jh(){const e=L.dailyTasks||[],t=e.filter(n=>n.eligible),a=e.filter(n=>!n.eligible&&n.timeLeftMs>0);return e.length===0?`
            <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-3 text-center">
                <p class="text-zinc-500 text-xs"><i class="fa-solid fa-bolt text-zinc-600 mr-1"></i>No daily bonuses available</p>
            </div>
        `:`
        <div>
            <h2 class="text-sm font-bold text-white flex items-center gap-2 mb-2">
                <i class="fa-solid fa-bolt text-yellow-400"></i> Daily Bonuses
            </h2>
            <div class="space-y-2">
                ${t.map(n=>`
                    <div class="task-card bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 cursor-pointer hover:border-amber-500/50 transition-colors"
                         data-id="${n.id}" data-url="${n.url||""}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-star text-yellow-400 text-xs"></i>
                                </div>
                                <div>
                                    <p class="text-white text-sm font-medium">${n.title}</p>
                                    ${n.description?`<p class="text-zinc-500 text-[10px]">${n.description}</p>`:""}
                                </div>
                            </div>
                            <span class="text-green-400 text-sm font-bold">+${Math.round(n.points)}</span>
                        </div>
                    </div>
                `).join("")}
                ${a.map(n=>`
                    <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-3 opacity-50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-clock text-zinc-500 text-xs"></i>
                                </div>
                                <p class="text-zinc-400 text-sm">${n.title}</p>
                            </div>
                            <span class="text-zinc-600 text-xs">${$h(n.timeLeftMs)}</span>
                        </div>
                    </div>
                `).join("")}
            </div>
        </div>
    `}function Wh(){const{userSubmissions:e,user:t}=L,a=(t==null?void 0:t.approvedSubmissionsCount)||0,n=e.filter(r=>["pending","auditing"].includes(r.status)).length,o=e.filter(r=>r.status==="rejected").length,s=e.length;if(s===0)return"";const i=L.historyExpanded;return`
        <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl overflow-hidden">
            <!-- Accordion Header -->
            <button id="history-toggle-btn" class="w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-800/50 transition-colors">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-clock-rotate-left text-zinc-500 text-xs"></i>
                    <span class="text-zinc-300 text-sm font-medium">My Submissions</span>
                    <span class="text-zinc-600 text-[10px]">${s} total</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        ${a>0?`<span class="text-green-400 text-[10px]">${a} approved</span>`:""}
                        ${n>0?`<span class="text-amber-400 text-[10px]">${n} pending</span>`:""}
                        ${o>0?`<span class="text-red-400 text-[10px]">${o} rejected</span>`:""}
                    </div>
                    <i class="fa-solid fa-chevron-down text-zinc-500 text-xs accordion-chevron ${i?"expanded":""}"></i>
                </div>
            </button>

            <!-- Accordion Body -->
            <div class="accordion-body ${i?"expanded":""}">
                <div class="border-t border-zinc-800">
                    ${e.slice(0,10).map((r,l)=>{const c=l===Math.min(e.length,10)-1,d=["pending","auditing"].includes(r.status),f=r.status==="approved",g=r.status==="rejected";let m,h,w;f?(m='<i class="fa-solid fa-check-circle text-green-400"></i>',h="",w=""):g?(m='<i class="fa-solid fa-times-circle text-red-400"></i>',h="",w=""):(m='<i class="fa-solid fa-shield-halved text-amber-400 animate-pulse"></i>',h="bg-amber-900/10",w=`
                                <div class="mt-1.5 flex items-center gap-2 text-amber-400/80">
                                    <i class="fa-solid fa-magnifying-glass text-[10px] animate-pulse"></i>
                                    <span class="text-[10px] font-medium">Under security audit...</span>
                                </div>
                            `);const y=r.pointsAwarded?`+${r.pointsAwarded}`:"-",k=Date.now(),v=bg*60*60*1e3,T=d&&r.submittedAt&&k-r.submittedAt.getTime()>=v;return`
                            <div class="p-3 ${c?"":"border-b border-zinc-800"} ${h}">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3 overflow-hidden">
                                        ${m}
                                        <a href="${r.url}" target="_blank" class="text-zinc-400 text-xs truncate hover:text-blue-400 max-w-[180px] md:max-w-[300px]">${r.url}</a>
                                    </div>
                                    <div class="flex items-center gap-2 shrink-0">
                                        ${T?`
                                            <button data-action="confirm" data-id="${r.submissionId}"
                                                    class="action-btn bg-green-600 hover:bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded transition-colors">
                                                Verify
                                            </button>
                                        `:""}
                                        <span class="font-mono font-bold ${r.pointsAwarded?"text-green-400":"text-zinc-600"} text-sm">${y}</span>
                                    </div>
                                </div>
                                ${w}
                            </div>
                        `}).join("")}
                </div>
            </div>
        </div>
    `}function Gh(){var w,y,k,v;const e=((w=L.leaderboards)==null?void 0:w.top100ByPosts)||[],t=((y=L.leaderboards)==null?void 0:y.top100ByPoints)||[],a=L.activeRanking||"posts",n=Vr(e),o=Yr(n),s=vg(n),i=((k=L.user)==null?void 0:k.approvedSubmissionsCount)||0,r=((v=L.user)==null?void 0:v.totalPoints)||0;function l(T,I,N){var le,se;const S=L.user&&((le=T.walletAddress)==null?void 0:le.toLowerCase())===((se=L.user.walletAddress)==null?void 0:se.toLowerCase()),$=Kh(I+1),F=S?N==="posts"?"bg-amber-500/10":"bg-green-500/10":"",V=N==="posts"?"text-amber-400":"text-green-400",X=N==="posts"?"text-white":"text-green-400",re=N==="posts"?"posts":"pts";return`
            <div class="flex items-center justify-between p-3 ${F} ${S?"":"hover:bg-zinc-800/50"} transition-colors ${S?"border-l-2 border-amber-500":""}">
                <div class="flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full ${$.bg} flex items-center justify-center text-xs font-bold shrink-0">${$.icon||I+1}</span>
                    <div class="flex flex-col">
                        <span class="font-mono text-xs ${S?V+" font-bold":"text-zinc-400"}">
                            ${St(T.walletAddress)}${S?" (You)":""}
                        </span>
                        ${$.tierName?`<span class="text-[9px] ${$.tierTextColor}">${$.tierName}</span>`:""}
                    </div>
                </div>
                <span class="font-bold ${X} text-sm">${(T.value||0).toLocaleString()} <span class="text-zinc-500 text-xs">${re}</span></span>
            </div>
        `}const c=a==="posts"?"bg-gradient-to-r from-amber-500 to-orange-500 text-black shadow-lg shadow-amber-500/20":"bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700",d=a==="points"?"bg-gradient-to-r from-green-500 to-emerald-500 text-black shadow-lg shadow-green-500/20":"bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700",f=a==="posts"?"":"hidden",g=a==="points"?"":"hidden",m=e.length===0?'<p class="p-6 text-center text-zinc-500 text-sm">No data yet - be the first!</p>':e.slice(0,50).map((T,I)=>l(T,I,"posts")).join(""),h=t.length===0?'<p class="p-6 text-center text-zinc-500 text-sm">No data yet - be the first!</p>':t.slice(0,50).map((T,I)=>l(T,I,"points")).join("");return`
        <div class="px-4 airdrop-fade-up pb-24">

            <!-- Your Position Hero Card -->
            ${L.isConnected?`
            <div class="bg-gradient-to-br from-zinc-900 to-zinc-900 border ${o?o.border:"border-zinc-800"} rounded-2xl p-5 mb-5 relative overflow-hidden">
                ${o?`<div class="absolute inset-0 bg-gradient-to-br ${o.gradient} opacity-20"></div>`:""}

                ${o?`
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">${o.icon}</span>
                            <div>
                                <span class="${o.text} font-black text-2xl">#${n}</span>
                                <p class="text-zinc-400 text-xs">${o.name} Tier</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-amber-400 font-bold text-sm">${r.toLocaleString()} pts</p>
                            <p class="text-zinc-500 text-[10px]">${i} posts</p>
                        </div>
                    </div>
                    ${s?`
                    <div class="bg-black/30 rounded-lg p-2.5">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-zinc-400 text-[10px]">Next: ${s.nextTier.icon} ${s.nextTier.name}</span>
                            <span class="text-zinc-500 text-[10px]">${s.postsNeeded} positions away</span>
                        </div>
                        <div class="progress-bar-bg h-1.5 rounded-full">
                            <div class="progress-bar-fill h-full rounded-full" style="width: ${Math.max(10,100-s.postsNeeded*2)}%"></div>
                        </div>
                    </div>
                    `:`
                    <div class="bg-cyan-500/10 rounded-lg p-2.5 text-center">
                        <span class="text-cyan-300 text-xs font-medium">You're at the top! Keep it up!</span>
                    </div>
                    `}
                </div>
                `:`
                <div class="text-center py-4 relative z-10">
                    <div class="w-12 h-12 mx-auto mb-3 opacity-30">
                        <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                    </div>
                    <p class="text-zinc-400 text-sm font-medium">Submit your first post to join the leaderboard</p>
                    <p class="text-zinc-600 text-xs mt-1">Top 200 earn exclusive NFT Boosters</p>
                </div>
                `}
            </div>
            `:""}

            <!-- NFT Tier Legend -->
            <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4 mb-5">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs font-bold text-zinc-400 uppercase tracking-wider flex items-center gap-1.5">
                        <i class="fa-solid fa-gem text-amber-500 text-[10px]"></i> NFT Reward Tiers
                    </h3>
                    <span class="text-[10px] text-zinc-600">${Kr} NFTs</span>
                </div>
                <div class="space-y-2">
                    ${Et.map(T=>`
                        <div class="tier-card flex items-center justify-between p-2.5 rounded-lg bg-gradient-to-r ${T.gradient} border ${T.border}">
                            <div class="flex items-center gap-2.5">
                                <span class="text-lg">${T.icon}</span>
                                <div>
                                    <span class="${T.text} font-bold text-xs">${T.name}</span>
                                    <div class="text-zinc-500 text-[10px]">${T.count} NFTs</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-white font-bold text-xs">${T.ranks}</span>
                                <div class="flex items-center gap-1">
                                    <span class="text-green-400/80 text-[10px]">${T.burn} burn</span>
                                    <span class="text-zinc-600 text-[10px]">â€¢</span>
                                    <span class="text-green-400 text-[10px] font-medium">${T.receive} rewards</span>
                                </div>
                            </div>
                        </div>
                    `).join("")}
                </div>
                <p class="text-amber-400/60 text-[10px] mt-3 flex items-center gap-1">
                    <i class="fa-solid fa-info-circle"></i>
                    NFT Boosters reduce token burn when claiming mining rewards
                </p>
            </div>

            <!-- Ranking Toggle Tabs -->
            <div class="flex gap-2 mb-4">
                <button data-ranking="posts" class="ranking-tab-btn flex-1 py-2.5 px-4 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${c}">
                    <i class="fa-solid fa-share-nodes"></i> By Posts
                </button>
                <button data-ranking="points" class="ranking-tab-btn flex-1 py-2.5 px-4 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${d}">
                    <i class="fa-solid fa-star"></i> By Points
                </button>
            </div>

            <!-- Posts Ranking -->
            <div id="ranking-posts" class="${f}">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                        <h3 class="font-bold text-white text-sm flex items-center gap-2">
                            <i class="fa-solid fa-crown text-yellow-500"></i> Top Content Creators
                        </h3>
                        <span class="text-zinc-500 text-xs">${e.length} creators</span>
                    </div>
                    <div class="divide-y divide-zinc-800/50 max-h-[400px] overflow-y-auto scroll-area">
                        ${m}
                    </div>
                </div>
            </div>

            <!-- Points Ranking -->
            <div id="ranking-points" class="${g}">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                        <h3 class="font-bold text-white text-sm flex items-center gap-2">
                            <i class="fa-solid fa-star text-green-500"></i> Top Points Earners
                        </h3>
                        <span class="text-zinc-500 text-xs">${t.length} earners</span>
                    </div>
                    <div class="divide-y divide-zinc-800/50 max-h-[400px] overflow-y-auto scroll-area">
                        ${h}
                    </div>
                </div>
            </div>
        </div>
    `}function Kh(e){return e<=5?{icon:"ðŸ’Ž",bg:"bg-cyan-500/20 text-cyan-300",tierName:"Diamond",tierTextColor:"text-cyan-400/70"}:e<=25?{icon:"ðŸ¥‡",bg:"bg-yellow-500/20 text-yellow-400",tierName:"Gold",tierTextColor:"text-yellow-400/70"}:e<=75?{icon:"ðŸ¥ˆ",bg:"bg-gray-400/20 text-gray-300",tierName:"Silver",tierTextColor:"text-gray-400/70"}:e<=200?{icon:"ðŸ¥‰",bg:"bg-amber-600/20 text-amber-500",tierName:"Bronze",tierTextColor:"text-amber-500/70"}:{icon:null,bg:"bg-zinc-800 text-zinc-400",tierName:null,tierTextColor:""}}function at(){const e=document.getElementById("main-content"),t=document.getElementById("airdrop-header");if(e){if(t&&(t.innerHTML=yg()),L.isBanned){e.innerHTML=`
            <div class="px-4 py-12 text-center">
                <i class="fa-solid fa-ban text-red-500 text-4xl mb-4"></i>
                <h2 class="text-red-500 font-bold text-xl mb-2">Account Suspended</h2>
                <p class="text-zinc-400 text-sm">Contact support on Telegram.</p>
            </div>
        `;return}switch(L.activeTab){case"earn":e.innerHTML=rc();break;case"ranking":e.innerHTML=Gh();break;default:e.innerHTML=rc()}}}function cc(e){const t=e.target.closest(".nav-pill-btn");t&&(L.activeTab=t.dataset.target,at())}function Vh(e){const t=e.target.closest(".ranking-tab-btn");t&&t.dataset.ranking&&(L.activeRanking=t.dataset.ranking,at())}function Yh(){L.historyExpanded=!L.historyExpanded;const e=document.querySelector(".accordion-chevron"),t=document.querySelector(".accordion-body");e&&e.classList.toggle("expanded"),t&&t.classList.toggle("expanded")}function qr(e){var o;const t=`
        <div class="text-center">
            <div class="w-32 h-32 mx-auto mb-4">
                <img src="./assets/caution.png" alt="Caution" class="w-full h-full object-contain">
            </div>

            <h3 class="text-xl font-bold text-red-400 mb-2">FINAL VERIFICATION</h3>

            <div class="bg-red-900/30 border border-red-500/50 rounded-xl p-4 mb-4">
                <p class="text-red-300 text-sm font-bold mb-2">
                    <i class="fa-solid fa-shield-halved mr-1"></i>
                    All posts are AUDITED
                </p>
                <p class="text-zinc-400 text-xs leading-relaxed">
                    Our security team reviews every submission.
                    <span class="text-red-400 font-bold">Fake or fraudulent links will result in PERMANENT BAN</span>
                    from the airdrop campaign.
                </p>
            </div>

            <div class="bg-zinc-800/80 border border-zinc-700 rounded-xl p-3 mb-4">
                <p class="text-zinc-500 text-[10px] uppercase mb-1">Post being verified:</p>
                <a href="${e.url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm truncate block">${e.url}</a>
            </div>

            <label class="flex items-start gap-3 text-left bg-zinc-900/80 border border-zinc-700 rounded-xl p-3 mb-4 cursor-pointer hover:border-amber-500/50 transition-colors">
                <input type="checkbox" id="confirmCheckbox" class="mt-1 w-4 h-4 accent-amber-500">
                <span class="text-xs text-zinc-300">
                    I confirm this is <span class="text-white font-bold">my authentic public post</span> and I understand that
                    <span class="text-red-400 font-bold">submitting fake content will result in permanent ban</span>.
                </span>
            </label>

            <div class="flex gap-3">
                <button id="deletePostBtn" data-submission-id="${e.submissionId}"
                        class="flex-1 bg-red-900/50 hover:bg-red-800 text-red-300 hover:text-white py-3 rounded-xl font-medium text-sm transition-colors border border-red-500/30">
                    <i class="fa-solid fa-trash mr-1"></i> Delete Post
                </button>
                <button id="finalConfirmBtn" data-submission-id="${e.submissionId}"
                        class="flex-1 bg-green-600/50 text-green-200 py-3 rounded-xl font-bold text-sm cursor-not-allowed transition-colors"
                        disabled>
                    <i class="fa-solid fa-lock mr-1"></i> Confirm & Earn
                </button>
            </div>

            <p class="text-zinc-600 text-[10px] mt-4">
                <i class="fa-solid fa-info-circle mr-1"></i>
                By confirming, you agree to our audit process and anti-fraud policies.
            </p>
        </div>
    `;Vo(t,"max-w-md"),(o=document.getElementById("deletePostBtn"))==null||o.addEventListener("click",async s=>{const i=s.currentTarget,r=i.dataset.submissionId;i.disabled=!0,i.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-1"></i> Deleting...';try{await er(r),x("Post deleted. No penalty applied.","info"),yt(),await Fn(),at()}catch(l){x(l.message,"error"),i.disabled=!1,i.innerHTML='<i class="fa-solid fa-trash mr-1"></i> Delete Post'}});const a=document.getElementById("confirmCheckbox"),n=document.getElementById("finalConfirmBtn");a==null||a.addEventListener("change",()=>{a.checked?(n.disabled=!1,n.className="flex-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold text-sm transition-colors cursor-pointer",n.innerHTML='<i class="fa-solid fa-check mr-1"></i> Confirm & Earn'):(n.disabled=!0,n.className="flex-1 bg-green-600/50 text-green-200 py-3 rounded-xl font-bold text-sm cursor-not-allowed transition-colors",n.innerHTML='<i class="fa-solid fa-lock mr-1"></i> Confirm & Earn')}),n==null||n.addEventListener("click",qh)}async function qh(e){const t=e.currentTarget,a=t.dataset.submissionId;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Verifying...';try{await wd(a),x("Success! Points added.","success"),yt(),await Fn(),at()}catch{x("Verification failed.","error"),t.disabled=!1,t.innerHTML="Try Again"}}async function Xh(e){const t=e.target.closest(".action-btn");if(!t)return;const a=t.dataset.action,n=t.dataset.id;if(a==="confirm"){const o=L.userSubmissions.find(s=>s.submissionId===n);o&&qr(o)}else if(a==="delete"){if(!confirm("Remove this submission?"))return;try{await er(n),x("Removed.","info"),await Fn(),at()}catch(o){x(o.message,"error")}}}async function Jh(e){const t=e.target.closest("#submit-content-btn");if(!t)return;const a=document.getElementById("content-url-input"),n=a==null?void 0:a.value.trim();if(!n||!n.startsWith("http"))return x("Enter a valid URL.","warning");const o=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>';try{await vd(n),x("Submitted! Your post is now under security audit.","info"),a.value="",await Fn(),L.historyExpanded=!0,at(),setTimeout(()=>{var s;(s=document.getElementById("history-toggle-btn"))==null||s.scrollIntoView({behavior:"smooth",block:"center"})},300)}catch(s){x(s.message,"error")}finally{t.disabled=!1,t.innerHTML=o}}async function Zh(e){const t=e.target.closest(".task-card");if(!t)return;const a=t.dataset.id,n=t.dataset.url;n&&window.open(n,"_blank");const o=L.dailyTasks.find(s=>s.id===a);if(!(!o||!o.eligible))try{await hd(o,L.user.pointsMultiplier),x(`Task completed! +${o.points} pts`,"success"),await Fn(),at()}catch(s){s.message.includes("Cooldown")||x(s.message,"error")}}async function Qh(){const e=L.claimInfo,t=L.claimProof;if(!(!e||!t||e.claimed||!e.isActive)){L.claimLoading=!0,at();try{await Xn.claimAirdrop({amount:t.amount,merkleProof:t.proof,button:document.getElementById("claim-airdrop-btn"),onSuccess:async()=>{L.claimLoading=!1,await hg(),at()},onError:()=>{L.claimLoading=!1,at()}})}catch(a){console.error("[Airdrop] Claim error:",a),L.claimLoading=!1,at()}}}function ev(){const e=Us();e.length>0&&setTimeout(()=>{qr(e[0])},500)}function tv(){const e=Us();e.length>0&&qr(e[0])}const av={async render(e){const t=document.getElementById("airdrop");if(t){Lh(),(t.innerHTML.trim()===""||e)&&(t.innerHTML=`
                <div id="loading-state" class="fixed inset-0 z-50 bg-gradient-to-b from-zinc-900 via-zinc-900 to-black flex flex-col items-center justify-center px-6">
                    <div class="text-center">
                        <div class="w-20 h-20 mx-auto mb-4 airdrop-float-slow">
                            <img src="./assets/airdrop.png" alt="Airdrop" class="w-full h-full object-contain drop-shadow-2xl">
                        </div>
                        <p class="text-zinc-400 text-sm mb-4">Loading your campaign...</p>
                        <div class="flex items-center justify-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0s;"></div>
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0.1s;"></div>
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0.2s;"></div>
                        </div>
                    </div>
                </div>

                <div id="airdrop-main" class="hidden">
                    <div id="airdrop-header">${yg()}</div>
                    <div id="airdrop-body" class="max-w-2xl mx-auto pb-24">
                        <div id="main-content"></div>
                    </div>
                </div>
            `,this.attachListeners());try{const a=new Promise(i=>setTimeout(i,1500));await Promise.all([Fn(),_h(),hg(),a]);const n=document.getElementById("loading-state"),o=document.getElementById("airdrop-main"),s=document.getElementById("main-content");n&&(n.style.transition="opacity 0.5s ease-out",n.style.opacity="0",await new Promise(i=>setTimeout(i,500)),n.classList.add("hidden")),o&&o.classList.remove("hidden"),s&&(s.classList.remove("hidden"),at()),ev()}catch(a){console.error(a)}}},attachListeners(){const e=document.getElementById("airdrop-body"),t=document.getElementById("airdrop-header");t==null||t.addEventListener("click",cc),e==null||e.addEventListener("click",a=>{a.target.closest("#submit-content-btn")&&Jh(a),a.target.closest(".task-card")&&Zh(a),a.target.closest(".action-btn")&&Xh(a),a.target.closest(".ranking-tab-btn")&&Vh(a),a.target.closest(".nav-pill-btn")&&cc(a),a.target.closest("#history-toggle-btn")&&Yh(),a.target.closest("#action-required-btn")&&tv(),a.target.closest("#claim-airdrop-btn")&&Qh(),a.target.closest("#rank-snippet-btn")&&(L.activeTab="ranking",at());const n=a.target.closest(".agora-nav-btn");if(n){dc(n.dataset.target||"agora");return}const o=a.target.closest(".copy-agora-link");if(o){const i=o.dataset.url;i&&navigator.clipboard.writeText(i).then(()=>{x("Link copied! Paste it on social media.","success");const r=o.querySelector("i");r&&(r.className="fa-solid fa-check text-green-400 text-xs",setTimeout(()=>{r.className="fa-solid fa-copy text-zinc-400 text-xs"},2e3))}).catch(()=>x("Failed to copy.","error"));return}const s=a.target.closest(".platform-action-card");if(s&&!s.classList.contains("completed")){const i=s.dataset.targetPage;i&&dc(i)}})},update(e){L.isConnected!==e&&this.render(!0)}};function dc(e){const t=document.querySelector(`a[data-target="${e}"]`)||document.querySelector(`[data-target="${e}"]`);if(t){t.click();const o=document.getElementById("sidebar");o&&window.innerWidth<768&&o.classList.add("hidden");return}const a=document.querySelectorAll("main > section"),n=document.getElementById(e);if(n){a.forEach(s=>s.classList.add("hidden")),n.classList.remove("hidden"),document.querySelectorAll(".sidebar-link").forEach(s=>{s.classList.remove("active","bg-zinc-700","text-white"),s.classList.add("text-zinc-400")});const o=document.querySelector(`[data-target="${e}"]`);o&&(o.classList.add("active","bg-zinc-700","text-white"),o.classList.remove("text-zinc-400"));return}console.warn("Could not navigate to:",e)}const Gn=window.ethers,es="".toLowerCase(),nv="",kg="bkc_admin_auth_v3";window.__ADMIN_WALLET__=es;setTimeout(()=>{document.dispatchEvent(new CustomEvent("adminConfigReady")),console.log("âœ… Admin config ready, wallet:",es?"configured":"not set")},100);function uc(){return sessionStorage.getItem(kg)==="true"}function ov(){sessionStorage.setItem(kg,"true")}function sv(){return!u.isConnected||!u.userAddress||!es?!1:u.userAddress.toLowerCase()===es}const pc={pending:{text:"Pending Review",color:"text-amber-400",bgColor:"bg-amber-900/50",icon:"fa-clock"},auditing:{text:"Auditing",color:"text-blue-400",bgColor:"bg-blue-900/50",icon:"fa-magnifying-glass"},approved:{text:"Approved",color:"text-green-400",bgColor:"bg-green-900/50",icon:"fa-check-circle"},rejected:{text:"Rejected",color:"text-red-400",bgColor:"bg-red-900/50",icon:"fa-times-circle"},flagged_suspicious:{text:"Flagged",color:"text-red-300",bgColor:"bg-red-800/60",icon:"fa-flag"}},Hs={faucet:{icon:"ðŸš°",label:"Claim Faucet",points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{icon:"ðŸ“Š",label:"Delegate BKC",points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{icon:"ðŸŽ°",label:"Play Fortune",points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{icon:"ðŸ›’",label:"Buy NFT",points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{icon:"ðŸ’°",label:"Sell NFT",points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{icon:"ðŸ·ï¸",label:"List for Rent",points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{icon:"â°",label:"Rent NFT",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{icon:"ðŸ“œ",label:"Notarize Doc",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{icon:"ðŸ’¸",label:"Claim Rewards",points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{icon:"â†©ï¸",label:"Unstake",points:500,maxCount:10,cooldownHours:0,enabled:!0}};function iv(e){if(!e)return"N/A";const t=Date.now(),a=e instanceof Date?e.getTime():new Date(e).getTime(),n=Math.floor((t-a)/1e3);return n<60?"just now":n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:n<604800?`${Math.floor(n/86400)}d ago`:new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function fc(e){return{YouTube:"fa-brands fa-youtube text-red-500","YouTube Shorts":"fa-brands fa-youtube text-red-400",Instagram:"fa-brands fa-instagram text-pink-500","X/Twitter":"fa-brands fa-x-twitter text-zinc-300",Facebook:"fa-brands fa-facebook text-blue-500",Telegram:"fa-brands fa-telegram text-sky-400",TikTok:"fa-brands fa-tiktok text-pink-400",Reddit:"fa-brands fa-reddit text-orange-500",LinkedIn:"fa-brands fa-linkedin text-blue-400"}[e]||"fa-solid fa-globe text-zinc-400"}function rv(e,t=45){return e?e.length<=t?e:e.substring(0,t-3)+"...":""}function Eg(e,t,a){const o=[t.map(c=>c.label||c.key).join(",")];for(const c of e){const d=t.map(f=>{let g=c[f.key]??"";return g=String(g).replace(/"/g,'""'),`"${g}"`});o.push(d.join(","))}const s=o.join(`
`),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),l=document.createElement("a");l.href=r,l.download=a,l.click(),URL.revokeObjectURL(r)}let z={allSubmissions:[],dailyTasks:[],ugcBasePoints:null,platformUsageConfig:null,editingTask:null,activeTab:"overview",allUsers:[],selectedUserSubmissions:[],isSubmissionsModalOpen:!1,selectedWallet:null,usersFilter:"all",usersSearch:"",usersPage:1,usersPerPage:100,submissionsPage:1,submissionsPerPage:100,selectedSubmissions:new Set,submissionsFilterPlatform:"all",tasksPage:1,tasksPerPage:100,faucetStatus:null,settingsOpenSection:"ugc-points"};const bn=async()=>{var t;const e=document.getElementById("admin-content-wrapper");if(e){const a=document.createElement("div");e.innerHTML=a.innerHTML}try{u.userAddress&&(await Zi(u.userAddress),console.log("âœ… Firebase Auth: Admin authenticated"));const[a,n,o,s]=await Promise.all([Bd(),Ed(),xs(),Ad()]);z.allSubmissions=a,z.dailyTasks=n,z.allUsers=s,z.ugcBasePoints=((t=o.config)==null?void 0:t.ugcBasePoints)||{YouTube:5e3,"YouTube Shorts":2500,Instagram:3e3,"X/Twitter":1500,Facebook:2e3,Telegram:1e3,TikTok:3500,Reddit:1800,LinkedIn:2200,Other:1e3},z.platformUsageConfig=o.platformUsageConfig||Hs,z.editingTask&&(z.editingTask=n.find(i=>i.id===z.editingTask.id)||null),Ig()}catch(a){if(console.error("Error loading admin data:",a),e){const n=document.createElement("div");Ob(n,`Failed to load admin data: ${a.message}`),e.innerHTML=n.innerHTML}else x("Failed to load admin data.","error")}},Tg=async()=>{try{const t=u.faucetContractPublic;if(!t){z.faucetStatus={error:"Contract not loaded"};return}const[a,n,o]=await Promise.all([t.getFaucetStatus(),t.getStats(),t.paused()]);z.faucetStatus={ethBalance:a.ethBalance,tokenBalance:a.tokenBalance,ethPerDrip:a.ethPerDrip,tokensPerDrip:a.tokensPerDrip,estimatedEthClaims:a.estimatedEthClaims,estimatedTokenClaims:a.estimatedTokenClaims,totalTokens:n.tokens,totalEth:n.eth,totalClaims:n.claims,totalUsers:n.users,isPaused:o}}catch(t){console.error("Error loading faucet status:",t),z.faucetStatus={error:t.message}}document.getElementById("overview-faucet-card")&&lv()},lv=()=>{var l;const e=document.getElementById("overview-faucet-card");if(!e)return;const t=z.faucetStatus;if(!t||t.error){e.innerHTML=`<div class="p-4 text-sm text-zinc-400">${(t==null?void 0:t.error)||"Loading faucet..."}</div>`;return}const a=parseFloat(Gn.formatEther(t.tokenBalance)),n=parseFloat(Gn.formatEther(t.ethBalance)),o=parseFloat(Gn.formatEther(t.totalTokens)),s=t.isPaused?"text-red-400":"text-green-400",i=t.isPaused?"Paused":"Active",r=t.isPaused?"bg-red-500":"bg-green-500";e.innerHTML=`
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-bold text-white"><i class="fa-solid fa-faucet-drip mr-2 text-sky-400"></i>Faucet Status</h3>
            <span class="flex items-center gap-2 text-sm font-semibold ${s}">
                <span class="w-2.5 h-2.5 rounded-full ${r} animate-pulse"></span>${i}
            </span>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
            <div class="text-center">
                <span class="block text-lg font-bold text-amber-400">${a.toLocaleString("en-US",{maximumFractionDigits:0})} BKC</span>
                <span class="text-xs text-zinc-500">Token Balance</span>
            </div>
            <div class="text-center">
                <span class="block text-lg font-bold text-sky-400">${n.toFixed(4)} BNB</span>
                <span class="text-xs text-zinc-500">BNB Balance</span>
            </div>
            <div class="text-center">
                <span class="block text-lg font-bold text-purple-400">${Number(t.totalClaims).toLocaleString()}</span>
                <span class="text-xs text-zinc-500">Total Claims</span>
            </div>
            <div class="text-center">
                <span class="block text-lg font-bold text-green-400">${Number(t.totalUsers).toLocaleString()}</span>
                <span class="text-xs text-zinc-500">Unique Users</span>
            </div>
        </div>
        <div class="flex flex-wrap gap-2 text-xs text-zinc-400 mb-4">
            <span>Per claim: ${parseFloat(Gn.formatEther(t.tokensPerDrip)).toLocaleString()} BKC + ${parseFloat(Gn.formatEther(t.ethPerDrip))} BNB</span>
            <span>|</span>
            <span>Total distributed: ${o.toLocaleString("en-US",{maximumFractionDigits:0})} BKC</span>
        </div>
        <div class="flex gap-3">
            <button id="toggle-faucet-pause-btn" class="${t.isPaused?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"} text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                <i class="fa-solid ${t.isPaused?"fa-play":"fa-pause"} mr-2"></i>${t.isPaused?"Unpause Faucet":"Pause Faucet"}
            </button>
            <a href="https://sepolia.etherscan.io/address/${E.faucet||""}" target="_blank" rel="noopener noreferrer"
               class="bg-zinc-700 hover:bg-zinc-600 text-white text-sm py-2 px-4 rounded-lg transition-colors inline-flex items-center gap-2">
                <i class="fa-solid fa-arrow-up-right-from-square"></i>Explorer
            </a>
        </div>
    `,(l=document.getElementById("toggle-faucet-pause-btn"))==null||l.addEventListener("click",cv)},cv=async()=>{const e=document.getElementById("toggle-faucet-pause-btn");if(!e||e.disabled)return;const t=z.faucetStatus;if(!t)return;const a=!t.isPaused,n=a?"Are you sure you want to PAUSE the faucet? Users won't be able to claim.":"Are you sure you want to UNPAUSE the faucet?";if(!window.confirm(n))return;const o=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-2"></i>Processing...';try{const s=u.faucetContract;if(!s)throw new Error("Faucet signer contract not available.");const i=await s.setPaused(a);x("Transaction sent...","info"),await i.wait(),x(`Faucet ${a?"PAUSED":"UNPAUSED"} successfully!`,"success"),await Tg()}catch(s){console.error("Error toggling faucet pause:",s),x(`Error: ${s.reason||s.message}`,"error"),e.disabled=!1,e.innerHTML=o}},dv=()=>{var i,r,l,c;const e=document.getElementById("overview-content");if(!e)return;const t=z.allUsers.length,a=z.allSubmissions.length,n=z.allUsers.filter(d=>d.isBanned).length,o=z.allUsers.reduce((d,f)=>d+(f.totalPoints||0),0);e.innerHTML=`
        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <i class="fa-solid fa-users text-2xl text-blue-400 mb-2"></i>
                <span class="block text-2xl font-bold text-white">${t.toLocaleString()}</span>
                <span class="text-xs text-zinc-500">Total Users</span>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center cursor-pointer hover:border-amber-500/50 transition-colors" id="overview-go-submissions">
                <i class="fa-solid fa-clock text-2xl text-amber-400 mb-2"></i>
                <span class="block text-2xl font-bold text-white">${a.toLocaleString()}</span>
                <span class="text-xs text-zinc-500">Pending Submissions</span>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <i class="fa-solid fa-star text-2xl text-yellow-400 mb-2"></i>
                <span class="block text-2xl font-bold text-white">${o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toLocaleString()}</span>
                <span class="text-xs text-zinc-500">Total Points</span>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <i class="fa-solid fa-ban text-2xl text-red-400 mb-2"></i>
                <span class="block text-2xl font-bold text-white">${n}</span>
                <span class="text-xs text-zinc-500">Banned Users</span>
            </div>
        </div>

        <!-- Faucet Status -->
        <div id="overview-faucet-card" class="bg-zinc-800 border border-zinc-700 rounded-xl p-5 mb-6">
            <div class="p-4 text-sm text-zinc-400"><span class="loader !w-5 !h-5 inline-block mr-2"></span>Loading faucet status...</div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-5">
            <h3 class="text-lg font-bold text-white mb-4"><i class="fa-solid fa-bolt mr-2 text-amber-400"></i>Quick Actions</h3>
            <div class="flex flex-wrap gap-3">
                <button id="overview-go-submissions-btn" class="bg-amber-600 hover:bg-amber-500 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                    <i class="fa-solid fa-list-check mr-2"></i>Review Submissions ${a>0?`(${a})`:""}
                </button>
                <button id="overview-export-users-btn" class="bg-blue-600 hover:bg-blue-500 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                    <i class="fa-solid fa-file-csv mr-2"></i>Export Users CSV
                </button>
                <button id="overview-reload-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">
                    <i class="fa-solid fa-rotate mr-2"></i>Reload Data
                </button>
            </div>
        </div>
    `,Tg();const s=d=>{z.activeTab=d,Ig()};(i=document.getElementById("overview-go-submissions"))==null||i.addEventListener("click",()=>s("review-submissions")),(r=document.getElementById("overview-go-submissions-btn"))==null||r.addEventListener("click",()=>s("review-submissions")),(l=document.getElementById("overview-export-users-btn"))==null||l.addEventListener("click",Cg),(c=document.getElementById("overview-reload-btn"))==null||c.addEventListener("click",()=>{x("Reloading data...","info"),bn()})},Cg=()=>{const e=z.allUsers;if(!e||e.length===0){x("No users to export.","info");return}Eg(e,[{key:"walletAddress",label:"Wallet"},{key:"totalPoints",label:"Total Points"},{key:"approvedSubmissionsCount",label:"Approved"},{key:"rejectedCount",label:"Rejected"},{key:"isBanned",label:"Banned"},{key:"hasPendingAppeal",label:"Appealing"}],`backchain-users-${new Date().toISOString().split("T")[0]}.csv`),x(`Exported ${e.length} users.`,"success")},uv=()=>{const e=z.allSubmissions;if(!e||e.length===0){x("No submissions to export.","info");return}Eg(e,[{key:"walletAddress",label:"Wallet"},{key:"platform",label:"Platform"},{key:"normalizedUrl",label:"URL"},{key:"status",label:"Status"},{key:"basePoints",label:"Base Points"}],`backchain-submissions-${new Date().toISOString().split("T")[0]}.csv`),x(`Exported ${e.length} submissions.`,"success")},gc=async e=>{const t=z.selectedSubmissions;if(t.size===0)return;const a=e==="approved"?`Approve ${t.size} submission(s)?`:`Reject ${t.size} submission(s)?`;if(!window.confirm(a))return;const n=z.allSubmissions.filter(c=>t.has(c.submissionId)),o=document.getElementById("bulk-action-bar");o&&(o.innerHTML=`<span class="text-sm text-zinc-300"><i class="fa-solid fa-spinner fa-spin mr-2"></i>Processing ${n.length}...</span>`);const s=await Promise.allSettled(n.map(c=>hs(c.userId,c.submissionId,e))),i=s.filter(c=>c.status==="fulfilled").length,r=s.filter(c=>c.status==="rejected").length,l=new Set(n.map(c=>c.submissionId));z.allSubmissions=z.allSubmissions.filter(c=>!l.has(c.submissionId)),z.selectedSubmissions.clear(),r>0?x(`${i} ${e}, ${r} failed.`,"warning"):x(`${i} submission(s) ${e}!`,"success"),vo()},pv=(e,t)=>{t?z.selectedSubmissions.add(e):z.selectedSubmissions.delete(e),Xr()},fv=e=>{const t=Bg();e?t.forEach(a=>z.selectedSubmissions.add(a.submissionId)):z.selectedSubmissions.clear(),document.querySelectorAll(".submission-checkbox").forEach(a=>{a.checked=e}),Xr()},Xr=()=>{var a,n,o;const e=document.getElementById("bulk-action-bar");if(!e)return;const t=z.selectedSubmissions.size;if(t===0){e.classList.add("hidden");return}e.classList.remove("hidden"),e.innerHTML=`
        <span class="text-sm text-zinc-300 font-medium">${t} selected</span>
        <div class="flex gap-2">
            <button id="bulk-approve-btn" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1.5 px-3 rounded transition-colors">
                <i class="fa-solid fa-check mr-1"></i>Approve (${t})
            </button>
            <button id="bulk-reject-btn" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1.5 px-3 rounded transition-colors">
                <i class="fa-solid fa-times mr-1"></i>Reject (${t})
            </button>
            <button id="bulk-clear-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white text-xs py-1.5 px-3 rounded transition-colors">Clear</button>
        </div>
    `,(a=document.getElementById("bulk-approve-btn"))==null||a.addEventListener("click",()=>gc("approved")),(n=document.getElementById("bulk-reject-btn"))==null||n.addEventListener("click",()=>gc("rejected")),(o=document.getElementById("bulk-clear-btn"))==null||o.addEventListener("click",()=>{var s;z.selectedSubmissions.clear(),document.querySelectorAll(".submission-checkbox").forEach(i=>{i.checked=!1}),(s=document.getElementById("select-all-checkbox"))==null||s.setAttribute("checked",!1),Xr()})};function Bg(){let e=z.allSubmissions;return z.submissionsFilterPlatform!=="all"&&(e=e.filter(t=>t.platform===z.submissionsFilterPlatform)),[...e].sort((t,a)=>{var n,o;return(((n=a.submittedAt)==null?void 0:n.getTime())||0)-(((o=t.submittedAt)==null?void 0:o.getTime())||0)})}const gv=async e=>{const t=e.target.closest("button[data-action]");if(!t||t.disabled)return;const a=t.dataset.action,n=t.dataset.submissionId,o=t.dataset.userId;if(!a||!n||!o){console.warn("Missing data attributes for admin action:",t.dataset);return}const s=t.closest("tr"),i=t.closest("td").querySelectorAll("button");s?(s.style.opacity="0.5",s.style.pointerEvents="none"):i.forEach(r=>r.disabled=!0);try{(a==="approved"||a==="rejected")&&(await hs(o,n,a),x(`Submission ${a==="approved"?"APPROVED":"REJECTED"}!`,"success"),z.allSubmissions=z.allSubmissions.filter(r=>r.submissionId!==n),vo())}catch(r){x(`Failed to ${a} submission: ${r.message}`,"error"),console.error(r),s&&(s.style.opacity="1",s.style.pointerEvents="auto")}},mv=async e=>{const t=e.target.closest(".ban-user-btn");if(!t||t.disabled)return;const a=t.dataset.userId,n=t.dataset.action==="ban";if(!a)return;const o=n?`Are you sure you want to PERMANENTLY BAN this user?
(This is reversible)`:`Are you sure you want to UNBAN this user?
(This will reset their rejection count to 0)`;if(!window.confirm(o))return;const s=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>';try{await tr(a,n),x(`User ${n?"BANNED":"UNBANNED"}.`,"success");const i=z.allUsers.findIndex(r=>r.id===a);i>-1&&(z.allUsers[i].isBanned=n,z.allUsers[i].hasPendingAppeal=!1,n===!1&&(z.allUsers[i].rejectedCount=0)),Va()}catch(i){x(`Failed: ${i.message}`,"error"),t.disabled=!1,t.innerHTML=s}},bv=async e=>{const t=e.target.closest(".resolve-appeal-btn");if(!t||t.disabled)return;const a=t.dataset.userId,o=t.dataset.action==="approve";if(!a)return;const s=o?"Are you sure you want to APPROVE this appeal and UNBAN the user?":"Are you sure you want to DENY this appeal? The user will remain banned.";if(!window.confirm(s))return;const i=t.closest("td").querySelectorAll("button"),r=new Map;i.forEach(l=>{r.set(l,l.innerHTML),l.disabled=!0,l.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>'});try{o&&await tr(a,!1),x(`Appeal ${o?"APPROVED":"DENIED"}.`,"success");const l=z.allUsers.findIndex(c=>c.id===a);l>-1&&(z.allUsers[l].hasPendingAppeal=!1,o&&(z.allUsers[l].isBanned=!1,z.allUsers[l].rejectedCount=0)),Va()}catch(l){x(`Failed: ${l.message}`,"error"),i.forEach(c=>{c.disabled=!1,c.innerHTML=r.get(c)})}},xv=async e=>{const t=e.target.closest(".re-approve-btn");if(!t||t.disabled)return;const a=t.dataset.submissionId,n=t.dataset.userId;if(!a||!n)return;const o=t.closest("tr");o&&(o.style.opacity="0.5"),t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>';try{await hs(n,a,"approved"),x("Submission re-approved!","success"),z.selectedUserSubmissions=z.selectedUserSubmissions.filter(i=>i.submissionId!==a),o&&o.remove();const s=z.allUsers.findIndex(i=>i.id===n);if(s>-1){const i=z.allUsers[s];i.rejectedCount=Math.max(0,(i.rejectedCount||0)-1),Va()}if(z.selectedUserSubmissions.length===0){const i=document.querySelector("#admin-user-modal .p-6");i&&(i.innerHTML='<p class="text-zinc-400 text-center p-8">This user has no rejected submissions.</p>')}}catch(s){x(`Failed to re-approve: ${s.message}`,"error"),o&&(o.style.opacity="1"),t.disabled=!1,t.innerHTML='<i class="fa-solid fa-check"></i> Re-Approve'}},hv=async e=>{const t=e.target.closest(".view-rejected-btn");if(!t||t.disabled)return;const a=t.dataset.userId,n=t.dataset.wallet;if(a){z.selectedWallet=n,z.isSubmissionsModalOpen=!0,fi(!0,[]);try{const o=await Id(a,"rejected");z.selectedUserSubmissions=o,fi(!1,o)}catch(o){x(`Error fetching user submissions: ${o.message}`,"error"),fi(!1,[],!0)}}},vv=()=>{z.isSubmissionsModalOpen=!1,z.selectedUserSubmissions=[],z.selectedWallet=null;const e=document.getElementById("admin-user-modal");e&&e.remove(),document.body.style.overflow="auto"},yv=e=>{const t=e.target.closest(".user-profile-link");if(!t)return;e.preventDefault();const a=t.dataset.userId;if(!a)return;const n=z.allUsers.find(o=>o.id===a);if(!n){x("Error: Could not find user data.","error");return}Bv(n)},wv=()=>{const e=document.getElementById("admin-user-profile-modal");e&&e.remove(),document.body.style.overflow="auto"},kv=async e=>{e.preventDefault();const t=e.target;let a,n;try{if(a=new Date(t.startDate.value+"T00:00:00Z"),n=new Date(t.endDate.value+"T23:59:59Z"),isNaN(a.getTime())||isNaN(n.getTime()))throw new Error("Invalid date format.");if(a>=n)throw new Error("Start Date must be before End Date.")}catch(l){x(l.message,"error");return}const o={title:t.title.value.trim(),url:t.url.value.trim(),description:t.description.value.trim(),points:parseInt(t.points.value,10),cooldownHours:parseInt(t.cooldown.value,10),startDate:a,endDate:n};if(!o.title||!o.description){x("Please fill in Title and Description.","error");return}if(o.points<=0||o.cooldownHours<=0){x("Points and Cooldown must be positive numbers.","error");return}if(o.url&&!o.url.startsWith("http")){x("URL must start with http:// or https://","error");return}z.editingTask&&z.editingTask.id&&(o.id=z.editingTask.id);const s=t.querySelector('button[type="submit"]'),i=s.innerHTML;s.disabled=!0;const r=document.createElement("span");r.classList.add("inline-block"),s.innerHTML="",s.appendChild(r);try{await Td(o),x(`Task ${o.id?"updated":"created"} successfully!`,"success"),t.reset(),z.editingTask=null,bn()}catch(l){x(`Failed to save task: ${l.message}`,"error"),console.error(l),s.disabled=!1,s.innerHTML=i}},Ev=async e=>{e.preventDefault();const t=e.target,a={YouTube:parseInt(t.youtubePoints.value,10),"YouTube Shorts":parseInt(t.youtubeShortsPoints.value,10),Instagram:parseInt(t.instagramPoints.value,10),"X/Twitter":parseInt(t.xTwitterPoints.value,10),Facebook:parseInt(t.facebookPoints.value,10),Telegram:parseInt(t.telegramPoints.value,10),TikTok:parseInt(t.tiktokPoints.value,10),Reddit:parseInt(t.redditPoints.value,10),LinkedIn:parseInt(t.linkedinPoints.value,10),Other:parseInt(t.otherPoints.value,10)};if(Object.values(a).some(i=>isNaN(i)||i<0)){x("All points must be positive numbers (or 0).","error");return}const n=t.querySelector('button[type="submit"]'),o=n.innerHTML;n.disabled=!0;const s=document.createElement("span");s.classList.add("inline-block"),n.innerHTML="",n.appendChild(s);try{await kd(a),x("UGC Base Points updated successfully!","success"),z.ugcBasePoints=a}catch(i){x(`Failed to update points: ${i.message}`,"error"),console.error(i)}finally{document.body.contains(n)&&(n.disabled=!1,n.innerHTML=o)}},Tv=e=>{const t=z.dailyTasks.find(a=>a.id===e);t&&(z.editingTask=t,js())},Cv=async e=>{if(window.confirm("Are you sure you want to delete this task permanently?"))try{await Cd(e),x("Task deleted.","success"),z.editingTask=null,bn()}catch(t){x(`Failed to delete task: ${t.message}`,"error"),console.error(t)}};function fi(e,t,a=!1){var i,r;const n=document.getElementById("admin-user-modal");n&&n.remove(),document.body.style.overflow="hidden";let o="";e?o='<div class="p-8"></div>':a?o='<p class="text-red-400 text-center p-8">Failed to load submissions.</p>':t.length===0?o='<p class="text-zinc-400 text-center p-8">This user has no rejected submissions.</p>':o=`
             <table class="w-full text-left min-w-[600px]">
                 <thead>
                     <tr class="border-b border-border-color text-xs text-zinc-400 uppercase">
                         <th class="p-3">Link</th>
                         <th class="p-3">Resolved</th>
                         <th class="p-3 text-right">Actions</th>
                     </tr>
                 </thead>
                 <tbody id="modal-submissions-tbody">
                     ${t.map(l=>`
                         <tr class="border-b border-border-color hover:bg-zinc-800/50">
                             <td class="p-3 text-sm max-w-xs truncate" title="${l.url}">
                                 <a href="${l.url}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">${l.url}</a>
                             </td>
                             <td class="p-3 text-xs">${l.resolvedAt?l.resolvedAt.toLocaleString("en-US"):"N/A"}</td>
                             <td class="p-3 text-right">
                                 <button data-user-id="${l.userId}" 
                                         data-submission-id="${l.submissionId}" 
                                         class="re-approve-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                                     <i class="fa-solid fa-check"></i> Re-Approve
                                 </button>
                             </td>
                         </tr>
                     `).join("")}
                 </tbody>
             </table>
         `;const s=`
         <div id="admin-user-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" style="backdrop-filter: blur(5px);">
             <div class="bg-sidebar border border-border-color rounded-xl shadow-lg w-full max-w-3xl max-h-[90vh] flex flex-col">
                 <div class="p-5 border-b border-border-color flex justify-between items-center">
                     <h2 class="text-xl font-bold text-white">Rejected Posts for ${St(z.selectedWallet)}</h2>
                     <button id="close-admin-modal-btn" class="text-zinc-400 hover:text-white text-2xl">&times;</button>
                 </div>
                 <div class="p-6 overflow-y-auto">
                     ${o}
                 </div>
             </div>
         </div>
     `;document.body.insertAdjacentHTML("beforeend",s),e&&document.getElementById("admin-user-modal").querySelector(".p-8"),(i=document.getElementById("close-admin-modal-btn"))==null||i.addEventListener("click",vv),(r=document.getElementById("modal-submissions-tbody"))==null||r.addEventListener("click",xv)}function Bv(e){var o;const t=document.getElementById("admin-user-profile-modal");t&&t.remove(),document.body.style.overflow="hidden";const a=e.isBanned?'<span class="text-xs font-bold py-1 px-3 rounded-full bg-red-600 text-white">BANNED</span>':e.hasPendingAppeal?'<span class="text-xs font-bold py-1 px-3 rounded-full bg-yellow-600 text-white">APPEALING</span>':'<span class="text-xs font-bold py-1 px-3 rounded-full bg-green-600 text-white">ACTIVE</span>',n=`
         <div id="admin-user-profile-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" style="backdrop-filter: blur(5px);">
             <div class="bg-sidebar border border-border-color rounded-xl shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col">
                 <div class="p-5 border-b border-border-color flex justify-between items-center">
                     <h2 class="text-xl font-bold text-white">User Profile</h2>
                     <button id="close-admin-profile-modal-btn" class="text-zinc-400 hover:text-white text-2xl">&times;</button>
                 </div>
                 
                 <div class="p-6 overflow-y-auto space-y-4">
                    
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-zinc-100">${St(e.walletAddress)}</h3>
                        ${a}
                    </div>

                    <div class="bg-main p-4 rounded-lg border border-border-color space-y-3">
                        <div class="flex flex-wrap justify-between gap-2">
                            <span class="text-sm text-zinc-400">Full Wallet:</span>
                            <span class="text-sm text-zinc-200 font-mono break-all">${e.walletAddress||"N/A"}</span>
                        </div>
                        <div class="flex flex-wrap justify-between gap-2">
                            <span class="text-sm text-zinc-400">User ID:</span>
                            <span class="text-sm text-zinc-200 font-mono break-all">${e.id||"N/A"}</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Total Points</span>
                            <span class="block text-2xl font-bold text-yellow-400">${(e.totalPoints||0).toLocaleString("en-US")}</span>
                        </div>
                        <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Approved</span>
                            <span class="block text-2xl font-bold text-green-400">${(e.approvedSubmissionsCount||0).toLocaleString("en-US")}</span>
                        </div>
                         <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Rejected</span>
                            <span class="block text-2xl font-bold text-red-400">${(e.rejectedCount||0).toLocaleString("en-US")}</span>
                        </div>
                    </div>

                    <div class="border-t border-border-color pt-4 text-right">
                        <p class="text-sm text-zinc-500 italic text-left">User actions (Ban, Unban, View Rejected) are available in the main table.</p>
                    </div>

                 </div>
             </div>
         </div>
     `;document.body.insertAdjacentHTML("beforeend",n),(o=document.getElementById("close-admin-profile-modal-btn"))==null||o.addEventListener("click",wv)}const Av=e=>{const t=e.target.closest(".user-filter-btn");!t||t.classList.contains("active")||(z.usersFilter=t.dataset.filter||"all",z.usersPage=1,Va())},Iv=e=>{z.usersSearch=e.target.value,z.usersPage=1,Va()},Pv=e=>{z.usersPage=e,Va()},Nv=e=>{z.submissionsPage=e,vo()},zv=e=>{z.tasksPage=e,js()},Va=()=>{var I,N,S;const e=document.getElementById("manage-users-content");if(!e)return;const t=z.allUsers;if(!t)return;const n=(z.usersSearch||"").toLowerCase().trim().replace(/[^a-z0-9x]/g,""),o=z.usersFilter;let s=t;n&&(s=s.filter($=>{var F,V;return((F=$.walletAddress)==null?void 0:F.toLowerCase().includes(n))||((V=$.id)==null?void 0:V.toLowerCase().includes(n))})),o==="banned"?s=s.filter($=>$.isBanned):o==="appealing"&&(s=s.filter($=>$.hasPendingAppeal===!0));const i=t.length,r=t.filter($=>$.isBanned).length,l=t.filter($=>$.hasPendingAppeal===!0).length,c=s.sort(($,F)=>$.hasPendingAppeal!==F.hasPendingAppeal?$.hasPendingAppeal?-1:1:$.isBanned!==F.isBanned?$.isBanned?-1:1:(F.totalPoints||0)-($.totalPoints||0)),d=z.usersPage,f=z.usersPerPage,g=c.length,m=Math.ceil(g/f),h=(d-1)*f,w=d*f,y=c.slice(h,w),k=y.length>0?y.map($=>{let F="border-b border-border-color hover:bg-zinc-800/50",V="";return $.hasPendingAppeal?(F+=" bg-yellow-900/40",V='<span class="ml-2 text-xs font-bold text-yellow-300">[APPEALING]</span>'):$.isBanned&&(F+=" bg-red-900/30 opacity-70",V='<span class="ml-2 text-xs font-bold text-red-400">[BANNED]</span>'),`
        <tr class="${F}">
            <td class="p-3 text-xs text-zinc-300 font-mono" title="User ID: ${$.id}">
                <a href="#" class="user-profile-link font-bold text-blue-400 hover:underline" 
                   data-user-id="${$.id}" 
                   title="Click to view profile. Full Wallet: ${$.walletAddress||"N/A"}">
                    ${St($.walletAddress)}
                </a>
                ${V}
            </td>
            <td class="p-3 text-sm font-bold text-yellow-400">${($.totalPoints||0).toLocaleString("en-US")}</td>
            <td class="p-3 text-sm font-bold ${$.rejectedCount>0?"text-red-400":"text-zinc-400"}">${$.rejectedCount||0}</td>
            <td class="p-3 text-right">
                <div class="flex items-center justify-end gap-2">
                    ${$.hasPendingAppeal?`<button data-user-id="${$.id}" data-action="approve" 
                                   class="resolve-appeal-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-check"></i> Approve
                           </button>
                           <button data-user-id="${$.id}" data-action="deny" 
                                   class="resolve-appeal-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-times"></i> Deny
                           </button>`:`<button data-user-id="${$.id}" data-wallet="${$.walletAddress}" 
                                   class="view-rejected-btn bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-eye"></i> View Rejected
                           </button>
                           ${$.isBanned?`<button data-user-id="${$.id}" data-action="unban" 
                                            class="ban-user-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                                       <i class="fa-solid fa-check"></i> Unban
                                   </button>`:`<button data-user-id="${$.id}" data-action="ban" 
                                            class="ban-user-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">
                                       <i class="fa-solid fa-ban"></i> Ban
                                   </button>`}`}
                </div>
            </td>
        </tr>
    `}).join(""):`
        <tr>
            <td colspan="4" class="p-8 text-center text-zinc-400">
                ${i===0?"No users found in Airdrop.":"No users match the current filters."}
            </td>
        </tr>
    `;e.innerHTML=`
        <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
            <h2 class="text-2xl font-bold">Users (${i})</h2>
            <button id="export-users-csv-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white text-xs py-1.5 px-3 rounded-lg transition-colors">
                <i class="fa-solid fa-file-csv mr-1"></i>Export CSV
            </button>
        </div>

        <div class="mb-4 p-4 bg-zinc-800 rounded-xl border border-border-color flex flex-wrap gap-4 justify-between items-center">
            <div id="user-filters-nav" class="flex items-center gap-2">
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${o==="all"?"bg-blue-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="all">
                    All (${i})
                </button>
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${o==="banned"?"bg-red-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="banned">
                    Banned (${r})
                </button>
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${o==="appealing"?"bg-yellow-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="appealing">
                    Appealing (${l})
                </button>
            </div>
            <div class="relative flex-grow max-w-xs">
                <input type="text" id="user-search-input" class="form-input pl-10" placeholder="Search Wallet or User ID..." value="${z.usersSearch}">
                <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"></i>
            </div>
        </div>

        <div class="bg-zinc-800 rounded-xl border border-border-color overflow-x-auto">
            <table class="w-full text-left min-w-[700px]">
                <thead>
                    <tr class="bg-main border-b border-border-color text-xs text-zinc-400 uppercase">
                        <th class="p-3">Wallet / User ID</th>
                        <th class="p-3">Total Points</th>
                        <th class="p-3">Rejections</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-users-tbody">${k}</tbody>
            </table>
        </div>
        
        <div id="admin-users-pagination" class="mt-6"></div>
    `;const v=document.getElementById("admin-users-pagination");v&&m>1&&sr(v,z.usersPage,m,Pv),(I=document.getElementById("export-users-csv-btn"))==null||I.addEventListener("click",Cg),(N=document.getElementById("admin-users-tbody"))==null||N.addEventListener("click",$=>{$.target.closest(".user-profile-link")&&yv($),$.target.closest(".ban-user-btn")&&mv($),$.target.closest(".view-rejected-btn")&&hv($),$.target.closest(".resolve-appeal-btn")&&bv($)}),(S=document.getElementById("user-filters-nav"))==null||S.addEventListener("click",Av);const T=document.getElementById("user-search-input");if(T){let $;T.addEventListener("keyup",F=>{clearTimeout($),$=setTimeout(()=>Iv(F),300)})}},$v=()=>{var n;const e=document.getElementById("manage-ugc-points-content");if(!e)return;const t=z.ugcBasePoints;if(!t)return;const a={YouTube:5e3,"YouTube Shorts":2500,Instagram:3e3,"X/Twitter":1500,Facebook:2e3,Telegram:1e3,TikTok:3500,Reddit:1800,LinkedIn:2200,Other:1e3};e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">Manage UGC Base Points</h2>
        <p class="text-sm text-zinc-400 mb-6 max-w-2xl mx-auto">
            Defina os pontos base concedidos para cada plataforma de divulgaÃ§Ã£o (UGC). 
            Este valor serÃ¡ "exportado" para a pÃ¡gina do airdrop e Ã© o valor usado 
            <strong>antes</strong> do multiplicador do usuÃ¡rio ser aplicado.
        </p>
        <form id="ugcPointsForm" class="bg-zinc-800 p-6 rounded-xl space-y-4 border border-border-color max-w-lg mx-auto">
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">YouTube:</label>
                    <input type="number" name="youtubePoints" class="form-input" value="${t.YouTube!==void 0?t.YouTube:a.YouTube}" required>
                </div>
                 <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">YouTube Shorts:</label>
                    <input type="number" name="youtubeShortsPoints" class="form-input" value="${t["YouTube Shorts"]!==void 0?t["YouTube Shorts"]:a["YouTube Shorts"]}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Instagram:</label>
                    <input type="number" name="instagramPoints" class="form-input" value="${t.Instagram!==void 0?t.Instagram:a.Instagram}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">TikTok:</label>
                    <input type="number" name="tiktokPoints" class="form-input" value="${t.TikTok!==void 0?t.TikTok:a.TikTok}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">X/Twitter:</label>
                    <input type="number" name="xTwitterPoints" class="form-input" value="${t["X/Twitter"]!==void 0?t["X/Twitter"]:a["X/Twitter"]}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Facebook:</label>
                    <input type="number" name="facebookPoints" class="form-input" value="${t.Facebook!==void 0?t.Facebook:a.Facebook}" required>
                </div>
            </div>

             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Reddit:</label>
                    <input type="number" name="redditPoints" class="form-input" value="${t.Reddit!==void 0?t.Reddit:a.Reddit}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">LinkedIn:</label>
                    <input type="number" name="linkedinPoints" class="form-input" value="${t.LinkedIn!==void 0?t.LinkedIn:a.LinkedIn}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                 <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Telegram:</label>
                    <input type="number" name="telegramPoints" class="form-input" value="${t.Telegram!==void 0?t.Telegram:a.Telegram}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Other Platform:</label>
                    <input type="number" name="otherPoints" class="form-input" value="${t.Other!==void 0?t.Other:a.Other}" required>
                </div>
            </div>
            
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-md transition-colors shadow-md mt-6">
                <i class="fa-solid fa-save mr-2"></i>Save Base Points
            </button>
        </form>
    `,(n=document.getElementById("ugcPointsForm"))==null||n.addEventListener("submit",Ev)},js=()=>{var h,w,y;const e=document.getElementById("manage-tasks-content");if(!e)return;const t=z.editingTask,a=!!t,n=k=>{if(!k)return"";try{return(k.toDate?k.toDate():k instanceof Date?k:new Date(k)).toISOString().split("T")[0]}catch{return""}},o=z.tasksPage,s=z.tasksPerPage,i=[...z.dailyTasks].sort((k,v)=>{var N,S;const T=(N=k.startDate)!=null&&N.toDate?k.startDate.toDate():new Date(k.startDate||0);return((S=v.startDate)!=null&&S.toDate?v.startDate.toDate():new Date(v.startDate||0)).getTime()-T.getTime()}),r=i.length,l=Math.ceil(r/s),c=(o-1)*s,d=o*s,f=i.slice(c,d),g=f.length>0?f.map(k=>{var S,$;const v=new Date,T=(S=k.startDate)!=null&&S.toDate?k.startDate.toDate():k.startDate?new Date(k.startDate):null,I=($=k.endDate)!=null&&$.toDate?k.endDate.toDate():k.endDate?new Date(k.endDate):null;let N="text-zinc-500";return T&&I&&(v>=T&&v<=I?N="text-green-400":v<T&&(N="text-blue-400")),`
        <div class="bg-zinc-800 p-4 rounded-lg border border-border-color flex justify-between items-center flex-wrap gap-3">
            <div class="flex-1 min-w-[250px]">
                <p class="font-semibold text-white">${k.title||"No Title"}</p>
                 <p class="text-xs text-zinc-400 mt-0.5">${k.description||"No Description"}</p>
                <p class="text-xs ${N} mt-1">
                   <span class="font-medium text-amber-400">${k.points||0} Pts</span> |
                   <span class="text-blue-400">${k.cooldownHours||0}h CD</span> |
                   Active: ${n(k.startDate)} to ${n(k.endDate)}
                </p>
                ${k.url?`<a href="${k.url}" target="_blank" rel="noopener noreferrer" class="text-xs text-blue-400 hover:underline break-all block mt-1">${k.url}</a>`:""}
            </div>
            <div class="flex gap-2 shrink-0">
                <button data-id="${k.id}" data-action="edit" class="edit-task-btn bg-amber-600 hover:bg-amber-700 text-black text-xs font-bold py-1 px-3 rounded-md transition-colors"><i class="fa-solid fa-pencil mr-1"></i>Edit</button>
                <button data-id="${k.id}" data-action="delete" class="delete-task-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-3 rounded-md transition-colors"><i class="fa-solid fa-trash mr-1"></i>Delete</button>
            </div>
        </div>
    `}).join(""):document.createElement("div").innerHTML;e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">${a?"Edit Daily Task":"Create New Daily Task"}</h2>

        <form id="taskForm" class="bg-zinc-800 p-6 rounded-xl space-y-4 border border-border-color">
            <input type="hidden" name="id" value="${(t==null?void 0:t.id)||""}">
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Task Title:</label><input type="text" name="title" class="form-input" value="${(t==null?void 0:t.title)||""}" required></div>
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Description:</label><input type="text" name="description" class="form-input" value="${(t==null?void 0:t.description)||""}" required></div>
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Link URL (Optional):</label><input type="url" name="url" class="form-input" value="${(t==null?void 0:t.url)||""}" placeholder="https://..."></div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Points (Base):</label><input type="number" name="points" class="form-input" value="${(t==null?void 0:t.points)||10}" min="1" required></div>
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Cooldown (Hours):</label><input type="number" name="cooldown" class="form-input" value="${(t==null?void 0:t.cooldownHours)||24}" min="1" required></div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Start Date (UTC):</label><input type="date" name="startDate" class="form-input" value="${n(t==null?void 0:t.startDate)}" required></div>
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">End Date (UTC):</label><input type="date" name="endDate" class="form-input" value="${n(t==null?void 0:t.endDate)}" required></div>
            </div>

            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-md transition-colors shadow-md">
                ${a?'<i class="fa-solid fa-save mr-2"></i>Save Changes':'<i class="fa-solid fa-plus mr-2"></i>Create Task'}
            </button>
            ${a?'<button type="button" id="cancelEditBtn" class="w-full mt-2 bg-zinc-600 hover:bg-zinc-700 text-white font-bold py-2 rounded-md transition-colors">Cancel Edit</button>':""}
        </form>

        <h3 class="text-xl font-bold mt-10 mb-4 border-t border-border-color pt-6">Existing Tasks (${r})</h3>
        <div id="existing-tasks-list" class="space-y-3">
            ${g}
        </div>
        <div id="admin-tasks-pagination" class="mt-6"></div>
    `;const m=document.getElementById("admin-tasks-pagination");m&&l>1&&sr(m,z.tasksPage,l,zv),(h=document.getElementById("taskForm"))==null||h.addEventListener("submit",kv),(w=document.getElementById("cancelEditBtn"))==null||w.addEventListener("click",()=>{z.editingTask=null,js()}),(y=document.getElementById("existing-tasks-list"))==null||y.addEventListener("click",k=>{const v=k.target.closest("button[data-id]");if(!v)return;const T=v.dataset.id;v.dataset.action==="edit"&&Tv(T),v.dataset.action==="delete"&&Cv(T)})},vo=()=>{var m,h,w,y,k;const e=document.getElementById("submissions-content");if(!e)return;if(z.selectedSubmissions.clear(),!z.allSubmissions||z.allSubmissions.length===0){const v=document.createElement("div");e.innerHTML=v.innerHTML;return}const t=[...new Set(z.allSubmissions.map(v=>v.platform).filter(Boolean))].sort(),a=z.submissionsFilterPlatform,n=Bg(),o=z.submissionsPage,s=z.submissionsPerPage,i=n.length,r=Math.ceil(i/s),l=(o-1)*s,d=n.slice(l,l+s).map(v=>{var T,I;return`
        <tr class="border-b border-border-color hover:bg-zinc-800/50">
            <td class="p-3 text-center">
                <input type="checkbox" class="submission-checkbox accent-blue-500 w-4 h-4 cursor-pointer" data-id="${v.submissionId}">
            </td>
            <td class="p-3 text-xs text-zinc-400 font-mono" title="${v.userId}">${St(v.walletAddress)}</td>
            <td class="p-3 text-sm max-w-xs" title="${v.normalizedUrl}">
                <a href="${v.normalizedUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">${rv(v.normalizedUrl)}</a>
                <span class="flex items-center gap-1.5 text-xs text-zinc-500 mt-0.5">
                    <i class="${fc(v.platform)} text-[10px]"></i>${v.platform||"Other"}
                    <span class="text-zinc-600">|</span>
                    ${v.basePoints||0} pts
                </span>
            </td>
            <td class="p-3 text-xs text-zinc-400" title="${v.submittedAt?v.submittedAt.toLocaleString("en-US"):""}">${iv(v.submittedAt)}</td>
            <td class="p-3 text-xs font-semibold ${((T=pc[v.status])==null?void 0:T.color)||"text-gray-500"}">${((I=pc[v.status])==null?void 0:I.text)||v.status}</td>
            <td class="p-3 text-right">
                <div class="flex items-center justify-end gap-2">
                    <button data-user-id="${v.userId}" data-submission-id="${v.submissionId}" data-action="approved" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded transition-colors"><i class="fa-solid fa-check"></i></button>
                    <button data-user-id="${v.userId}" data-submission-id="${v.submissionId}" data-action="rejected" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded transition-colors"><i class="fa-solid fa-times"></i></button>
                </div>
            </td>
        </tr>
    `}).join(""),f=`
        <button class="platform-filter-btn text-xs py-1.5 px-3 rounded-full transition-colors ${a==="all"?"bg-blue-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-platform="all">
            All (${z.allSubmissions.length})
        </button>
        ${t.map(v=>{const T=z.allSubmissions.filter(I=>I.platform===v).length;return`<button class="platform-filter-btn text-xs py-1.5 px-3 rounded-full transition-colors ${a===v?"bg-blue-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-platform="${v}">
                <i class="${fc(v)} mr-1"></i>${v} (${T})
            </button>`}).join("")}
    `;e.innerHTML=`
        <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
            <h2 class="text-2xl font-bold">Submissions (${z.allSubmissions.length})</h2>
            <button id="export-submissions-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white text-xs py-1.5 px-3 rounded-lg transition-colors">
                <i class="fa-solid fa-file-csv mr-1"></i>Export CSV
            </button>
        </div>

        <!-- Platform Filter -->
        <div id="platform-filter-bar" class="flex flex-wrap gap-2 mb-4">${f}</div>

        <!-- Bulk Action Bar -->
        <div id="bulk-action-bar" class="hidden mb-3 p-3 bg-blue-900/30 border border-blue-500/30 rounded-lg flex items-center justify-between gap-3"></div>

        <div class="bg-zinc-800 rounded-xl border border-border-color overflow-x-auto">
            <table class="w-full text-left min-w-[750px]">
                <thead>
                    <tr class="bg-main border-b border-border-color text-xs text-zinc-400 uppercase">
                        <th class="p-3 w-10 text-center"><input type="checkbox" id="select-all-checkbox" class="accent-blue-500 w-4 h-4 cursor-pointer"></th>
                        <th class="p-3 font-semibold">Wallet</th>
                        <th class="p-3 font-semibold">Link & Platform</th>
                        <th class="p-3 font-semibold">Submitted</th>
                        <th class="p-3 font-semibold">Status</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-submissions-tbody">${d}</tbody>
            </table>
        </div>
        <div id="admin-submissions-pagination" class="mt-6"></div>
    `;const g=document.getElementById("admin-submissions-pagination");g&&r>1&&sr(g,z.submissionsPage,r,Nv),(m=document.getElementById("admin-submissions-tbody"))==null||m.addEventListener("click",gv),(h=document.getElementById("export-submissions-btn"))==null||h.addEventListener("click",uv),(w=document.getElementById("select-all-checkbox"))==null||w.addEventListener("change",v=>fv(v.target.checked)),(y=document.getElementById("admin-submissions-tbody"))==null||y.addEventListener("change",v=>{v.target.classList.contains("submission-checkbox")&&pv(v.target.dataset.id,v.target.checked)}),(k=document.getElementById("platform-filter-bar"))==null||k.addEventListener("click",v=>{const T=v.target.closest(".platform-filter-btn");T&&(z.submissionsFilterPlatform=T.dataset.platform,z.submissionsPage=1,z.selectedSubmissions.clear(),vo())})},Jr=()=>{var s,i;const e=document.getElementById("platform-usage-content");if(!e)return;const t=z.platformUsageConfig||Hs;let a=0;Object.values(t).forEach(r=>{r.enabled!==!1&&(a+=(r.points||0)*(r.maxCount||1))});const n=Object.entries(t).map(([r,l])=>`
        <tr class="border-b border-zinc-700/50 hover:bg-zinc-800/50" data-action-key="${r}">
            <td class="p-3">
                <div class="flex items-center gap-2">
                    <span class="text-xl">${l.icon||"âš¡"}</span>
                    <span class="text-white font-medium">${l.label||r}</span>
                </div>
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-20 text-amber-400 font-bold text-center" 
                       data-field="points" value="${l.points||0}" min="0" step="100">
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-16 text-white text-center" 
                       data-field="maxCount" value="${l.maxCount||1}" min="1" max="100">
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-16 text-white text-center" 
                       data-field="cooldownHours" value="${l.cooldownHours||0}" min="0" max="168">
            </td>
            <td class="p-3 text-center">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer platform-toggle" data-field="enabled" ${l.enabled!==!1?"checked":""}>
                    <div class="w-9 h-5 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600"></div>
                </label>
            </td>
            <td class="p-3 text-right text-xs text-zinc-400">
                ${((l.points||0)*(l.maxCount||1)).toLocaleString()}
            </td>
        </tr>
    `).join("");e.innerHTML=`
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-2">Platform Usage Points Configuration</h2>
            <p class="text-zinc-400 text-sm">Configure points awarded for using platform features. Changes are saved immediately.</p>
        </div>

        <!-- Stats Summary -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-amber-400">${Object.keys(t).length}</span>
                <p class="text-xs text-zinc-500 mt-1">Total Actions</p>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-green-400">${Object.values(t).filter(r=>r.enabled!==!1).length}</span>
                <p class="text-xs text-zinc-500 mt-1">Enabled</p>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-purple-400">${a.toLocaleString()}</span>
                <p class="text-xs text-zinc-500 mt-1">Max Points Possible</p>
            </div>
        </div>

        <!-- Actions Table -->
        <div class="bg-zinc-800 rounded-xl border border-zinc-700 overflow-hidden">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-zinc-900 border-b border-zinc-700 text-xs text-zinc-400 uppercase">
                        <th class="p-3 font-semibold">Action</th>
                        <th class="p-3 font-semibold">Points</th>
                        <th class="p-3 font-semibold">Max Count</th>
                        <th class="p-3 font-semibold">Cooldown (h)</th>
                        <th class="p-3 font-semibold text-center">Enabled</th>
                        <th class="p-3 font-semibold text-right">Max Total</th>
                    </tr>
                </thead>
                <tbody id="platform-usage-tbody">
                    ${n}
                </tbody>
            </table>
        </div>

        <!-- Save Button -->
        <div class="mt-6 flex justify-end gap-3">
            <button id="reset-platform-config-btn" class="px-4 py-2 bg-zinc-700 hover:bg-zinc-600 text-white rounded-lg transition-colors">
                <i class="fa-solid fa-rotate-left mr-2"></i>Reset to Default
            </button>
            <button id="save-platform-config-btn" class="px-6 py-2 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-lg transition-colors">
                <i class="fa-solid fa-save mr-2"></i>Save Configuration
            </button>
        </div>

        <!-- Info Box -->
        <div class="mt-6 p-4 bg-blue-900/20 border border-blue-500/30 rounded-xl">
            <h4 class="text-blue-400 font-bold mb-2"><i class="fa-solid fa-info-circle mr-2"></i>How It Works</h4>
            <ul class="text-zinc-400 text-sm space-y-1">
                <li>â€¢ <strong>Points:</strong> Amount awarded per action</li>
                <li>â€¢ <strong>Max Count:</strong> Maximum times a user can earn points for this action</li>
                <li>â€¢ <strong>Cooldown:</strong> Hours between earning points (0 = no cooldown)</li>
                <li>â€¢ <strong>Enabled:</strong> Toggle to enable/disable this action</li>
                <li>â€¢ Points are tracked with transaction hashes to prevent fraud</li>
            </ul>
        </div>
    `;const o=document.getElementById("platform-usage-tbody");o==null||o.addEventListener("input",mc),o==null||o.addEventListener("change",mc),(s=document.getElementById("save-platform-config-btn"))==null||s.addEventListener("click",Sv),(i=document.getElementById("reset-platform-config-btn"))==null||i.addEventListener("click",Lv)},mc=e=>{const t=e.target;if(!t.classList.contains("platform-input")&&!t.classList.contains("platform-toggle"))return;const a=t.closest("tr"),n=a==null?void 0:a.dataset.actionKey,o=t.dataset.field;if(!n||!o)return;z.platformUsageConfig[n]||(z.platformUsageConfig[n]={...Hs[n]}),o==="enabled"?z.platformUsageConfig[n].enabled=t.checked:z.platformUsageConfig[n][o]=parseInt(t.value)||0;const s=z.platformUsageConfig[n],i=a.querySelector("td:last-child");i&&(i.textContent=((s.points||0)*(s.maxCount||1)).toLocaleString())},Sv=async e=>{const t=e.target.closest("button");if(!t)return;const a=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-2"></i>Saving...';try{await nr(z.platformUsageConfig),x("âœ… Platform Usage config saved!","success"),Jr()}catch(n){console.error("Error saving platform config:",n),x("Failed to save config: "+n.message,"error")}finally{t.disabled=!1,t.innerHTML=a}},Lv=async()=>{if(confirm("Are you sure you want to reset to default values? This will save immediately."))try{z.platformUsageConfig={...Hs},await nr(z.platformUsageConfig),x("âœ… Config reset to defaults!","success"),Jr()}catch(e){console.error("Error resetting platform config:",e),x("Failed to reset config: "+e.message,"error")}},Ag=()=>{const e=document.getElementById("settings-content");if(!e)return;const t=z.settingsOpenSection,a=[{id:"ugc-points",title:"UGC Base Points",icon:"fa-solid fa-coins text-yellow-400",contentId:"manage-ugc-points-content"},{id:"daily-tasks",title:"Daily Tasks",icon:"fa-solid fa-list-check text-green-400",contentId:"manage-tasks-content"},{id:"platform-usage",title:"Platform Usage",icon:"fa-solid fa-gamepad text-purple-400",contentId:"platform-usage-content"}];e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">Settings</h2>
        <div class="space-y-3">
            ${a.map(n=>`
                <div class="bg-zinc-800 border border-zinc-700 rounded-xl overflow-hidden">
                    <button class="settings-accordion-btn w-full flex items-center justify-between p-4 hover:bg-zinc-700/50 transition-colors" data-section="${n.id}">
                        <span class="flex items-center gap-3">
                            <i class="${n.icon}"></i>
                            <span class="font-semibold text-white">${n.title}</span>
                        </span>
                        <i class="fa-solid ${t===n.id?"fa-chevron-up":"fa-chevron-down"} text-zinc-400 transition-transform"></i>
                    </button>
                    <div class="settings-accordion-body ${t===n.id?"":"hidden"}" data-section="${n.id}">
                        <div class="border-t border-zinc-700 p-4">
                            <div id="${n.contentId}"></div>
                        </div>
                    </div>
                </div>
            `).join("")}
        </div>
    `,t==="ugc-points"?$v():t==="daily-tasks"?js():t==="platform-usage"&&Jr(),e.querySelectorAll(".settings-accordion-btn").forEach(n=>{n.addEventListener("click",()=>{const o=n.dataset.section;z.settingsOpenSection===o?z.settingsOpenSection=null:z.settingsOpenSection=o,Ag()})})},Ig=()=>{const e=document.getElementById("admin-content-wrapper");if(!e)return;const t=z.allSubmissions.length,a=z.activeTab;e.innerHTML=`
        <h1 class="text-3xl font-bold mb-6">Admin Panel</h1>

        <div class="border-b border-border-color mb-6">
            <nav id="admin-tabs" class="-mb-px flex flex-wrap gap-x-6 gap-y-2">
                <button class="tab-btn ${a==="overview"?"active":""}" data-target="overview">
                    <i class="fa-solid fa-gauge-high mr-1.5"></i>Overview
                </button>
                <button class="tab-btn ${a==="review-submissions"?"active":""}" data-target="review-submissions">
                    <i class="fa-solid fa-list-check mr-1.5"></i>Submissions${t>0?` <span class="ml-1 text-xs bg-amber-600 text-white px-1.5 py-0.5 rounded-full">${t}</span>`:""}
                </button>
                <button class="tab-btn ${a==="manage-users"?"active":""}" data-target="manage-users">
                    <i class="fa-solid fa-users mr-1.5"></i>Users
                </button>
                <button class="tab-btn ${a==="settings"?"active":""}" data-target="settings">
                    <i class="fa-solid fa-gear mr-1.5"></i>Settings
                </button>
            </nav>
        </div>

        <div id="overview_tab" class="tab-content ${a==="overview"?"active":""}">
            <div id="overview-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="review_submissions_tab" class="tab-content ${a==="review-submissions"?"active":""}">
            <div id="submissions-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="manage_users_tab" class="tab-content ${a==="manage-users"?"active":""}">
            <div id="manage-users-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="settings_tab" class="tab-content ${a==="settings"?"active":""}">
            <div id="settings-content" class="max-w-4xl mx-auto"></div>
        </div>
    `;const n=s=>{s==="overview"?dv():s==="review-submissions"?vo():s==="manage-users"?Va():s==="settings"&&Ag()};n(a);const o=document.getElementById("admin-tabs");o&&!o._listenerAttached&&(o.addEventListener("click",s=>{const i=s.target.closest(".tab-btn");if(!i||i.classList.contains("active"))return;const r=i.dataset.target;z.activeTab=r,r!=="manage-users"&&(z.usersPage=1,z.usersFilter="all",z.usersSearch=""),r!=="review-submissions"&&(z.submissionsPage=1,z.submissionsFilterPlatform="all",z.selectedSubmissions.clear()),document.querySelectorAll("#admin-tabs .tab-btn").forEach(c=>c.classList.remove("active")),i.classList.add("active"),e.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));const l=document.getElementById(r.replace(/-/g,"_")+"_tab");l&&(l.classList.add("active"),n(r))}),o._listenerAttached=!0)},_v={render(){const e=document.getElementById("admin");if(e){if(!sv()){e.innerHTML='<div class="text-center text-red-400 p-8 bg-sidebar border border-red-500/50 rounded-lg">Access Denied. This page is restricted to administrators.</div>';return}if(uc()){e.innerHTML='<div id="admin-content-wrapper"></div>',bn();return}e.innerHTML=`
            <div class="flex items-center justify-center min-h-[60vh]">
                <div class="bg-sidebar border border-yellow-500/30 rounded-2xl p-8 max-w-md w-full shadow-xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-shield-halved text-3xl text-yellow-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Admin Access</h2>
                        <p class="text-zinc-400 text-sm">Enter the admin key to continue</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-zinc-400 text-sm mb-2">Admin Key</label>
                            <input type="password" id="admin-key-input" 
                                   class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-yellow-500 focus:outline-none"
                                   placeholder="Enter admin key"
                                   onkeypress="if(event.key === 'Enter') document.getElementById('admin-login-btn').click()">
                        </div>
                        
                        <button id="admin-login-btn"
                                class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-4 rounded-xl transition-colors">
                            <i class="fa-solid fa-unlock mr-2"></i>Access Admin Panel
                        </button>
                        
                        <p id="admin-login-error" class="text-red-400 text-sm text-center hidden">
                            <i class="fa-solid fa-exclamation-circle mr-1"></i>Incorrect key
                        </p>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-zinc-800">
                        <p class="text-zinc-500 text-xs text-center">
                            <i class="fa-solid fa-wallet mr-1"></i>Connected: ${St(u.userAddress)}
                        </p>
                    </div>
                </div>
            </div>
        `,document.getElementById("admin-login-btn").addEventListener("click",()=>{const t=document.getElementById("admin-key-input"),a=document.getElementById("admin-login-error");t.value===nv?(ov(),x("âœ… Admin access granted!","success"),e.innerHTML='<div id="admin-content-wrapper"></div>',bn()):(a.classList.remove("hidden"),t.value="",t.focus(),setTimeout(()=>a.classList.add("hidden"),3e3))}),setTimeout(()=>{var t;(t=document.getElementById("admin-key-input"))==null||t.focus()},100)}},refreshData(){const e=document.getElementById("admin");e&&!e.classList.contains("hidden")&&uc()&&(console.log("Refreshing Admin Page data..."),bn())}},gi=2e8,Rv=2e7,bc=35e5,xc=35e5,Fv=13e6,mi={burn:5,stakers:75,treasury:20},Dv=()=>{if(document.getElementById("tokenomics-styles-v9"))return;const e=document.createElement("style");e.id="tokenomics-styles-v9",e.innerHTML=`
        @keyframes tk-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        @keyframes tk-glow { 0%, 100% { box-shadow: 0 0 20px rgba(245,158,11,0.2); } 50% { box-shadow: 0 0 40px rgba(245,158,11,0.4); } }
        @keyframes tk-fade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes tk-flow { 0% { transform: translateX(-100%); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateX(100%); opacity: 0; } }
        .tk-float { animation: tk-float 4s ease-in-out infinite; }
        .tk-glow { animation: tk-glow 2s ease-in-out infinite; }
        .tk-fade { animation: tk-fade 0.6s ease-out forwards; }
        .tk-section { background: linear-gradient(180deg, rgba(24,24,27,0.8), rgba(9,9,11,0.9)); border: 1px solid rgba(63,63,70,0.3); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; }
        .tk-card { background: rgba(39,39,42,0.4); border: 1px solid rgba(63,63,70,0.5); border-radius: 0.75rem; padding: 1rem; transition: all 0.3s ease; }
        .tk-card:hover { border-color: rgba(245,158,11,0.3); transform: translateY(-2px); }
        .tk-badge { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 10px; font-weight: 600; }
        .tk-flow-line { position: relative; height: 2px; background: rgba(63,63,70,0.5); overflow: hidden; }
        .tk-flow-line::after { content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 100%; background: linear-gradient(90deg, transparent, #f59e0b, transparent); animation: tk-flow 2s linear infinite; }
        .tk-pie-ring { width: 160px; height: 160px; border-radius: 50%; position: relative; }
        .tk-pie-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; background: #09090b; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #27272a; }
        .tk-bar { height: 8px; background: rgba(63,63,70,0.5); border-radius: 999px; overflow: hidden; }
        .tk-bar-fill { height: 100%; border-radius: 999px; transition: width 1s ease-out; }
        .tk-icon-box { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
    `,document.head.appendChild(e)},Ut=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(0)+"K":e.toLocaleString();function Mv(){return`
        <div class="text-center mb-6 tk-fade">
            <div class="relative inline-block mb-4">
                <img src="./assets/bkc_logo_3d.png" class="w-20 h-20 tk-float tk-glow rounded-full" alt="BKC">
            </div>
            <h1 class="text-2xl font-black text-white mb-2">
                <span class="bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">BACKCHAIN</span>
                <span class="text-zinc-400 font-normal">Tokenomics</span>
            </h1>
            <p class="text-zinc-500 text-sm max-w-md mx-auto">
                Modular smart contract ecosystem. <span class="text-amber-400">Real yield</span> from protocol fees.
                <span class="text-emerald-400">Deflationary</span> by design.
                No admin keys. <span class="text-purple-400">Unstoppable.</span>
            </p>
        </div>`}function Ov(){const e=u.totalSupply?j(u.totalSupply):Rv,t=(e/gi*100).toFixed(1),a=gi-e;return`
        <div class="tk-section tk-fade" style="animation-delay:0.1s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(245,158,11,0.2)"><i class="fa-solid fa-coins text-amber-400"></i></div>
                <div><h2 class="text-white font-bold">Token Supply</h2><p class="text-zinc-500 text-xs">BKC â€” ERC-20 on opBNB</p></div>
            </div>
            <div class="grid grid-cols-3 gap-3 mb-4">
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Max Supply</p>
                    <p class="text-xl font-black text-white">${Ut(gi)}</p>
                </div>
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Circulating</p>
                    <p class="text-xl font-black text-emerald-400">${Ut(e)}</p>
                </div>
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">To Mine</p>
                    <p class="text-xl font-black text-amber-400">${Ut(a)}</p>
                </div>
            </div>
            <div class="tk-bar mb-2"><div class="tk-bar-fill bg-gradient-to-r from-amber-500 to-emerald-500" style="width:${t}%"></div></div>
            <p class="text-center text-zinc-600 text-[10px]"><i class="fa-solid fa-hammer mr-1"></i>${t}% minted â€” remaining ${Ut(a)} BKC mined via BuybackMiner</p>
        </div>`}function Uv(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.15s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(168,85,247,0.2)"><i class="fa-solid fa-rocket text-purple-400"></i></div>
                <div><h2 class="text-white font-bold">TGE â€” Token Launch</h2><p class="text-zinc-500 text-xs">20M BKC minted at genesis</p></div>
            </div>
            <div class="flex items-center justify-center gap-6 mb-4">
                <div class="tk-pie-ring" style="background: conic-gradient(#f59e0b 0% 17.5%, #ea580c 17.5% 35%, #10b981 35% 100%);">
                    <div class="tk-pie-center">
                        <p class="text-2xl font-black text-white">20M</p>
                        <p class="text-[10px] text-zinc-500">BKC</p>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                        <div>
                            <p class="text-white font-bold text-sm">17.5% Phase 1</p>
                            <p class="text-zinc-500 text-[10px]">${Ut(bc)} BKC</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-orange-600"></div>
                        <div>
                            <p class="text-white font-bold text-sm">17.5% Phase 2</p>
                            <p class="text-zinc-500 text-[10px]">${Ut(xc)} BKC</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                        <div>
                            <p class="text-white font-bold text-sm">65% Liquidity</p>
                            <p class="text-zinc-500 text-[10px]">${Ut(Fv)} BKC</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 1 â€” Active -->
            <div class="tk-card mb-3" style="background:linear-gradient(135deg,rgba(245,158,11,0.08),rgba(234,88,12,0.08));border-color:rgba(245,158,11,0.3)">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-lg"><i class="fa-solid fa-parachute-box text-amber-400"></i></span>
                        <p class="text-amber-400 font-bold text-sm">Phase 1 â€” ${Ut(bc)} BKC</p>
                    </div>
                    <span class="tk-badge" style="background:rgba(34,197,94,0.2);color:#4ade80">ACTIVE</span>
                </div>
                <p class="text-zinc-400 text-xs mb-2">Earn points and climb the ranking to win NFT Boosters + BKC tokens.</p>
                <div class="grid grid-cols-2 gap-2 mb-3 text-[10px]">
                    <div class="rounded-lg p-2 flex items-center gap-2" style="background:rgba(39,39,42,0.5)">
                        <i class="fa-solid fa-share-nodes text-amber-400"></i>
                        <span class="text-zinc-400">Social media posts</span>
                    </div>
                    <div class="rounded-lg p-2 flex items-center gap-2" style="background:rgba(39,39,42,0.5)">
                        <i class="fa-solid fa-gamepad text-purple-400"></i>
                        <span class="text-zinc-400">Platform quests</span>
                    </div>
                    <div class="rounded-lg p-2 flex items-center gap-2" style="background:rgba(39,39,42,0.5)">
                        <i class="fa-solid fa-trophy text-yellow-400"></i>
                        <span class="text-zinc-400">Top 200 earn NFTs</span>
                    </div>
                    <div class="rounded-lg p-2 flex items-center gap-2" style="background:rgba(39,39,42,0.5)">
                        <i class="fa-solid fa-gem text-cyan-400"></i>
                        <span class="text-zinc-400">4 tiers: D/G/S/B</span>
                    </div>
                </div>
                <div class="flex gap-2">
                    <a href="#airdrop" class="inline-flex items-center gap-1.5 text-xs font-bold text-amber-400 hover:text-amber-300 transition-colors">
                        <i class="fa-solid fa-arrow-right"></i> Join Airdrop
                    </a>
                    <a href="#referral" class="inline-flex items-center gap-1.5 text-xs font-bold text-cyan-400 hover:text-cyan-300 transition-colors ml-4">
                        <i class="fa-solid fa-user-plus"></i> Invite Friends
                    </a>
                </div>
            </div>

            <!-- Phase 2 â€” Coming Soon -->
            <div class="tk-card" style="opacity:0.5;border-color:rgba(63,63,70,0.5)">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-lg"><i class="fa-solid fa-lock text-zinc-500"></i></span>
                        <div>
                            <p class="text-zinc-400 font-bold text-sm">Phase 2 â€” ${Ut(xc)} BKC</p>
                            <p class="text-zinc-600 text-[10px]">Criteria to be announced</p>
                        </div>
                    </div>
                    <span class="tk-badge" style="background:rgba(113,113,122,0.2);color:#a1a1aa">SOON</span>
                </div>
            </div>
        </div>`}function Hv(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.2s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(6,182,212,0.2)"><i class="fa-solid fa-arrows-split-up-and-left text-cyan-400"></i></div>
                <div><h2 class="text-white font-bold">Fee Flow</h2><p class="text-zinc-500 text-xs">How protocol revenue is distributed</p></div>
            </div>

            <div class="tk-card mb-3">
                <p class="text-white font-bold text-sm mb-2"><i class="fa-solid fa-layer-group text-blue-400 mr-2"></i>Tier 1 â€” BNB Fees</p>
                <p class="text-zinc-500 text-xs mb-3">Every on-chain action pays a BNB fee split among:</p>
                <div class="grid grid-cols-3 gap-2 text-center text-[10px]">
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-emerald-400 font-bold text-base">Buyback</p><p class="text-zinc-500">BNB accumulates</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-blue-400 font-bold text-base">Treasury</p><p class="text-zinc-500">Protocol fund</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-amber-400 font-bold text-base">Operator</p><p class="text-zinc-500">Frontend builder</p></div>
                </div>
            </div>

            <div class="tk-flow-line my-3"></div>

            <div class="tk-card mb-3">
                <p class="text-white font-bold text-sm mb-2"><i class="fa-solid fa-layer-group text-purple-400 mr-2"></i>Tier 2 â€” BKC Fees</p>
                <p class="text-zinc-500 text-xs mb-3">Staking claims and Fortune wagers pay BKC fees:</p>
                <div class="grid grid-cols-3 gap-2 text-center text-[10px]">
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-red-400 font-bold text-base">${mi.burn}%</p><p class="text-zinc-500">Burn</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-purple-400 font-bold text-base">${mi.stakers}%</p><p class="text-zinc-500">Stakers</p></div>
                    <div class="rounded-lg p-2" style="background:rgba(39,39,42,0.5)"><p class="text-blue-400 font-bold text-base">${mi.treasury}%</p><p class="text-zinc-500">Treasury</p></div>
                </div>
            </div>

            <div class="tk-flow-line my-3"></div>

            <div class="tk-card" style="background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(6,182,212,0.08));border-color:rgba(16,185,129,0.3)">
                <p class="text-white font-bold text-sm mb-2"><i class="fa-solid fa-recycle text-emerald-400 mr-2"></i>BuybackMiner â€” The Engine</p>
                <p class="text-zinc-500 text-xs mb-2">When BNB fees accumulate, anyone can trigger a buyback:</p>
                <div class="space-y-1 text-[10px] text-zinc-400">
                    <p><span class="text-emerald-400">1.</span> Withdraw BNB from Ecosystem</p>
                    <p><span class="text-emerald-400">2.</span> 1% to caller incentive (permissionless MEV)</p>
                    <p><span class="text-emerald-400">3.</span> 99% swaps BNB to BKC via LiquidityPool</p>
                    <p><span class="text-emerald-400">4.</span> Mint new BKC (scarcity curve decreases over time)</p>
                    <p><span class="text-emerald-400">5.</span> 5% burned + 95% to StakingPool rewards</p>
                </div>
            </div>
        </div>`}function jv(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.3s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(245,158,11,0.2)"><i class="fa-solid fa-receipt text-amber-400"></i></div>
                <div><h2 class="text-white font-bold">Fixed Pricing</h2><p class="text-zinc-500 text-xs">Minimum fees ensure ecosystem sustainability</p></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(139,92,246,0.2)">
                        <i class="fa-solid fa-stamp text-violet-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Notary â€” Certify</p>
                        <p class="text-violet-400 text-[10px] font-bold">0.0005 BNB</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(34,197,94,0.2)">
                        <i class="fa-solid fa-dice-one text-green-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Fortune â€” Tier 0 (2x)</p>
                        <p class="text-green-400 text-[10px] font-bold">0.0003 BNB</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(16,185,129,0.2)">
                        <i class="fa-solid fa-dice-three text-emerald-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Fortune â€” Tier 1 (10x)</p>
                        <p class="text-emerald-400 text-[10px] font-bold">0.0005 BNB</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(20,184,166,0.2)">
                        <i class="fa-solid fa-dice-six text-teal-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Fortune â€” Tier 2 (100x)</p>
                        <p class="text-teal-400 text-[10px] font-bold">0.001 BNB</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(59,130,246,0.2)">
                        <i class="fa-solid fa-circle-check text-blue-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Verified Badge</p>
                        <p class="text-blue-400 text-[10px] font-bold">0.02 BNB/yr</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(245,158,11,0.2)">
                        <i class="fa-solid fa-circle-check text-amber-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Premium Badge</p>
                        <p class="text-amber-400 text-[10px] font-bold">0.1 BNB/yr</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(168,85,247,0.2)">
                        <i class="fa-solid fa-gem text-purple-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Elite Badge</p>
                        <p class="text-purple-400 text-[10px] font-bold">0.25 BNB/yr</p>
                    </div>
                </div>
                <div class="tk-card flex items-center gap-2 p-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style="background:rgba(6,182,212,0.2)">
                        <i class="fa-solid fa-rocket text-cyan-400 text-xs"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white text-xs font-medium truncate">Agora â€” Post Boost</p>
                        <p class="text-cyan-400 text-[10px] font-bold">0.002 BNB/day</p>
                    </div>
                </div>
            </div>
            <div class="mt-3 p-3 rounded-lg text-center" style="background:rgba(39,39,42,0.5);border:1px solid rgba(63,63,70,0.5)">
                <p class="text-zinc-500 text-[10px]"><i class="fa-solid fa-users mr-1"></i>Operators earn 10-20% commission on every action â€” <a href="#operator" class="text-emerald-400 hover:underline">become an operator</a></p>
            </div>
        </div>`}function Wv(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.35s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(139,92,246,0.2)"><i class="fa-solid fa-gem text-violet-400"></i></div>
                <div><h2 class="text-white font-bold">NFT Boosters</h2><p class="text-zinc-500 text-xs">Reduce burn rate on staking claim rewards</p></div>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(6,182,212,0.2)">
                            <i class="fa-solid fa-gem text-cyan-400 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Diamond</p>
                            <p class="text-cyan-400 text-[10px]">+50% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 0%</span>
                        <span class="text-zinc-500">Keep: 100%</span>
                    </div>
                </div>
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(234,179,8,0.2)">
                            <i class="fa-solid fa-gem text-yellow-400 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Gold</p>
                            <p class="text-yellow-400 text-[10px]">+40% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 10%</span>
                        <span class="text-zinc-500">Keep: 90%</span>
                    </div>
                </div>
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(161,161,170,0.2)">
                            <i class="fa-solid fa-gem text-zinc-400 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Silver</p>
                            <p class="text-zinc-400 text-[10px]">+25% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 25%</span>
                        <span class="text-zinc-500">Keep: 75%</span>
                    </div>
                </div>
                <div class="tk-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background:rgba(245,158,11,0.2)">
                            <i class="fa-solid fa-gem text-amber-500 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-white text-xs font-bold">Bronze</p>
                            <p class="text-amber-500 text-[10px]">+10% boost</p>
                        </div>
                    </div>
                    <div class="flex justify-between text-[10px]">
                        <span class="text-emerald-400">Burn: 40%</span>
                        <span class="text-zinc-500">Keep: 60%</span>
                    </div>
                </div>
            </div>
            <p class="text-center text-zinc-600 text-[10px] mt-3">
                <i class="fa-solid fa-info-circle mr-1"></i>Without NFT: 50% of claimed rewards are burned. Diamond holders keep 100%.
            </p>
        </div>`}function Gv(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.4s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(245,158,11,0.2)"><i class="fa-solid fa-sack-dollar text-amber-400"></i></div>
                <div><h2 class="text-white font-bold">How to Earn</h2><p class="text-zinc-500 text-xs">6 ways to generate income</p></div>
            </div>
            <div class="space-y-2">
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(168,85,247,0.2)">
                            <i class="fa-solid fa-lock text-purple-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Stake BKC</p><span class="tk-badge" style="background:rgba(168,85,247,0.2);color:#c084fc">Real Yield</span></div>
                            <p class="text-zinc-500 text-xs">Delegate to earn share of BuybackMiner output + Tier 2 fees. Longer locks = higher pStake = bigger share.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(6,182,212,0.2)">
                            <i class="fa-solid fa-landmark text-cyan-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Agora Social</p><span class="tk-badge" style="background:rgba(6,182,212,0.2);color:#22d3ee">BNB Tips</span></div>
                            <p class="text-zinc-500 text-xs">Earn from followers, replies, SuperLikes, and tips. Build an audience and monetize your content.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(20,184,166,0.2)">
                            <i class="fa-solid fa-house text-teal-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Rent NFTs</p><span class="tk-badge" style="background:rgba(20,184,166,0.2);color:#2dd4bf">Passive</span></div>
                            <p class="text-zinc-500 text-xs">List your Booster NFT for rent. Other stakers pay per-hour for temporary boost access.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(34,197,94,0.2)">
                            <i class="fa-solid fa-clover text-green-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Fortune Pool</p><span class="tk-badge" style="background:rgba(34,197,94,0.2);color:#4ade80">Up to 100x</span></div>
                            <p class="text-zinc-500 text-xs">Commit-reveal game with 3 tiers: 2x, 10x, or 100x. Provably fair on-chain randomness.</p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(245,158,11,0.2)">
                            <i class="fa-solid fa-code text-amber-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Operate a Frontend</p><span class="tk-badge" style="background:rgba(245,158,11,0.2);color:#fbbf24">10-20%</span></div>
                            <p class="text-zinc-500 text-xs">Build a UI for any module and earn operator commissions on all user activity. <a href="#operator" class="text-emerald-400 hover:underline">Learn more</a></p>
                        </div>
                    </div>
                </div>
                <div class="tk-card">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style="background:rgba(234,179,8,0.2)">
                            <i class="fa-solid fa-bolt text-yellow-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2"><p class="text-white font-bold text-sm">Trigger Buybacks</p><span class="tk-badge" style="background:rgba(234,179,8,0.2);color:#facc15">1% Reward</span></div>
                            <p class="text-zinc-500 text-xs">Call executeBuyback() when BNB accumulates. Earn 1% caller incentive. Permissionless MEV.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>`}function Kv(){return`
        <div class="tk-section tk-fade" style="animation-delay:0.5s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box" style="background:rgba(161,161,170,0.2)"><i class="fa-solid fa-file-contract text-zinc-400"></i></div>
                <div><h2 class="text-white font-bold">Smart Contract Modules</h2><p class="text-zinc-500 text-xs">Modular ecosystem â€” no admin, no blacklist</p></div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-[10px]">
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-coins text-amber-400"></i><span class="text-zinc-400">BKCToken</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-network-wired text-blue-400"></i><span class="text-zinc-400">BackchainEcosystem</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-water text-indigo-400"></i><span class="text-zinc-400">LiquidityPool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-lock text-purple-400"></i><span class="text-zinc-400">StakingPool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-hammer text-emerald-400"></i><span class="text-zinc-400">BuybackMiner</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-gem text-violet-400"></i><span class="text-zinc-400">RewardBooster</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-fire text-orange-400"></i><span class="text-zinc-400">NFTFusion</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-store text-pink-400"></i><span class="text-zinc-400">NFTPool (x4)</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-clover text-green-400"></i><span class="text-zinc-400">FortunePool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-landmark text-cyan-400"></i><span class="text-zinc-400">Agora</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-stamp text-slate-400"></i><span class="text-zinc-400">Notary</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-heart text-red-400"></i><span class="text-zinc-400">CharityPool</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-rocket text-teal-400"></i><span class="text-zinc-400">RentalManager</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-scale-balanced text-amber-400"></i><span class="text-zinc-400">Governance</span></div>
                <div class="tk-card p-2 flex items-center gap-2"><i class="fa-solid fa-faucet-drip text-sky-400"></i><span class="text-zinc-400">SimpleBKCFaucet</span></div>
            </div>
            <div class="mt-3 p-3 rounded-lg" style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3)">
                <p class="text-emerald-400 text-xs font-medium text-center"><i class="fa-solid fa-shield-halved mr-1"></i>Progressive decentralization: Admin â†’ Multisig â†’ Timelock â†’ DAO</p>
            </div>
            <div class="mt-3 text-center">
                <a href="https://sepolia.etherscan.io" target="_blank" class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-amber-400 transition-colors">
                    <i class="fa-solid fa-external-link"></i> View all contracts on Explorer
                </a>
            </div>
        </div>`}function Vv(){const e=document.getElementById("tokenomics");e&&(Dv(),e.innerHTML=`
        <div class="max-w-2xl mx-auto px-4 py-6 pb-24">
            ${Mv()}
            ${Ov()}
            ${Uv()}
            ${Hv()}
            ${jv()}
            ${Wv()}
            ${Gv()}
            ${Kv()}
            <div class="text-center py-6 text-zinc-600 text-xs">
                <p>Unstoppable, permissionless DeFi infrastructure</p>
                <p class="mt-1">BACKCHAIN &copy; 2024-2026</p>
            </div>
        </div>`,e.scrollIntoView({behavior:"smooth",block:"start"}))}const Yv={render:Vv,init:()=>{},update:()=>{}},qv=5*1024*1024,Pg="https://sepolia.etherscan.io",Xv=`${Pg}/tx/`,Dn=`${Pg}/address/`,Ng=["event Certified(uint256 indexed certId, address indexed owner, bytes32 documentHash, uint8 docType, address operator)","event CertificateTransferred(bytes32 indexed documentHash, address indexed from, address indexed to)","event AssetRegistered(uint256 indexed tokenId, address indexed owner, uint8 assetType, bytes32 documentHash, address operator)","event AssetTransferred(uint256 indexed tokenId, address indexed from, address indexed to, uint256 declaredValue, uint48 timestamp)","event AnnotationAdded(uint256 indexed tokenId, uint256 indexed annotationId, address indexed author, uint8 annotationType)"],Mt={image:{icon:"fa-regular fa-image",color:"#34d399",bg:"rgba(52,211,153,0.12)",label:"Image"},pdf:{icon:"fa-regular fa-file-pdf",color:"#f87171",bg:"rgba(248,113,113,0.12)",label:"PDF"},audio:{icon:"fa-solid fa-music",color:"#a78bfa",bg:"rgba(167,139,250,0.12)",label:"Audio"},video:{icon:"fa-regular fa-file-video",color:"#60a5fa",bg:"rgba(96,165,250,0.12)",label:"Video"},document:{icon:"fa-regular fa-file-word",color:"#60a5fa",bg:"rgba(96,165,250,0.12)",label:"Document"},spreadsheet:{icon:"fa-regular fa-file-excel",color:"#4ade80",bg:"rgba(74,222,128,0.12)",label:"Spreadsheet"},code:{icon:"fa-solid fa-code",color:"#22d3ee",bg:"rgba(34,211,238,0.12)",label:"Code"},archive:{icon:"fa-regular fa-file-zipper",color:"#facc15",bg:"rgba(250,204,21,0.12)",label:"Archive"},default:{icon:"fa-regular fa-file",color:"#fbbf24",bg:"rgba(251,191,36,0.12)",label:"File"}},Vt=[{id:0,name:"Property",desc:"Real estate, land, buildings",icon:"fa-solid fa-house",color:"#f59e0b",bg:"rgba(245,158,11,0.12)"},{id:1,name:"Vehicle",desc:"Cars, motorcycles, boats",icon:"fa-solid fa-car",color:"#3b82f6",bg:"rgba(59,130,246,0.12)"},{id:2,name:"Intellectual Property",desc:"Patents, copyrights, trademarks",icon:"fa-solid fa-lightbulb",color:"#a855f7",bg:"rgba(168,85,247,0.12)"},{id:3,name:"Other",desc:"Any other valuable asset",icon:"fa-solid fa-box",color:"#6b7280",bg:"rgba(107,114,128,0.12)"}],ts={0:{descPlaceholder:"e.g. 2BR Apartment at 123 Main St",metaLabel:"Address, registration number, area (sqft)",docHint:"Upload deed, title, or property photos"},1:{descPlaceholder:"e.g. 2024 Toyota Camry, Blue",metaLabel:"VIN, license plate, mileage, year",docHint:"Upload registration, title, or vehicle photos"},2:{descPlaceholder:"e.g. Patent for Solar Panel Design",metaLabel:"Patent/copyright number, filing date",docHint:"Upload patent certificate or trademark filing"},3:{descPlaceholder:"e.g. Gold Watch, Rolex Submariner",metaLabel:"Serial number, brand, model",docHint:"Upload certificate, receipt, or photos"}},Li=[{id:0,name:"Mortgage",icon:"fa-solid fa-building-columns",color:"#ef4444"},{id:1,name:"Lien",icon:"fa-solid fa-gavel",color:"#f97316"},{id:2,name:"Court Order",icon:"fa-solid fa-scale-balanced",color:"#dc2626"},{id:3,name:"Insurance",icon:"fa-solid fa-shield-halved",color:"#22c55e"},{id:4,name:"Renovation",icon:"fa-solid fa-hammer",color:"#eab308"},{id:5,name:"Note",icon:"fa-solid fa-note-sticky",color:"#64748b"},{id:6,name:"Cancellation",icon:"fa-solid fa-ban",color:"#991b1b"}],b={view:"documents",activeTab:"documents",viewHistory:[],wizStep:1,wizFile:null,wizFileHash:null,wizDescription:"",wizDuplicateCheck:null,wizIsHashing:!1,wizDocType:0,wizUploadCost:null,assetWizStep:1,assetWizType:0,assetWizDescription:"",assetWizMeta:"",assetWizFile:null,assetWizFileHash:null,bkcFee:0n,ethFee:0n,assetRegisterFee:0n,assetTransferFee:0n,annotateFee:0n,feesLoaded:!1,certificates:[],certsLoading:!1,assets:[],assetsLoading:!1,selectedCert:null,selectedAsset:null,selectedAssetAnnotations:[],verifyFile:null,verifyHash:null,verifyResult:null,verifyIsChecking:!1,stats:null,totalSupply:0,recentNotarizations:[],statsLoading:!1,isProcessing:!1,processStep:"",isLoading:!1,contractAvailable:!0,_render:()=>{},_renderHeader:()=>{}};function Jv(){if(document.getElementById("notary-styles-v10"))return;const e=document.createElement("style");e.id="notary-styles-v10",e.textContent=`
        :root {
            --nt-bg:       #0c0c0e;
            --nt-bg2:      #141417;
            --nt-bg3:      #1c1c21;
            --nt-surface:  #222228;
            --nt-border:   rgba(255,255,255,0.06);
            --nt-border-h: rgba(255,255,255,0.1);
            --nt-text:     #f0f0f2;
            --nt-text-2:   #a0a0ab;
            --nt-text-3:   #5c5c68;
            --nt-accent:   #f59e0b;
            --nt-accent-2: #d97706;
            --nt-accent-glow: rgba(245,158,11,0.15);
            --nt-red:      #ef4444;
            --nt-green:    #22c55e;
            --nt-blue:     #3b82f6;
            --nt-radius:   14px;
            --nt-radius-sm: 10px;
            --nt-radius-lg: 20px;
            --nt-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes nt-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
        @keyframes nt-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: none; } }
        @keyframes nt-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes nt-stamp { 0% { transform: scale(1) rotate(0); } 25% { transform: scale(1.2) rotate(-5deg); } 50% { transform: scale(0.9) rotate(5deg); } 100% { transform: scale(1) rotate(0); } }
        @keyframes nt-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes nt-scan { 0% { top: 0; opacity: 1; } 50% { opacity: 0.5; } 100% { top: 100%; opacity: 1; } }
        @keyframes nt-pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); } 100% { box-shadow: 0 0 0 15px rgba(245,158,11,0); } }

        .nt-shell {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 16px 32px;
            min-height: 100vh;
            background: var(--nt-bg);
        }
        .nt-header {
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 12px 0 0;
            background: var(--nt-bg);
        }
        .nt-header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }
        .nt-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nt-brand-icon {
            width: 44px; height: 44px;
            border-radius: var(--nt-radius);
            background: var(--nt-accent-glow);
            border: 1px solid rgba(245,158,11,0.2);
            display: flex; align-items: center; justify-content: center;
            color: var(--nt-accent);
            font-size: 20px;
            animation: nt-float 4s ease-in-out infinite;
        }
        .nt-brand-name {
            font-size: 18px;
            font-weight: 800;
            color: var(--nt-text);
            letter-spacing: -0.02em;
        }
        .nt-brand-sub {
            font-size: 11px;
            color: var(--nt-text-3);
        }

        /* Navigation */
        .nt-nav {
            display: flex;
            gap: 2px;
            padding: 4px;
            background: var(--nt-bg2);
            border-radius: var(--nt-radius);
            border: 1px solid var(--nt-border);
            margin-top: 8px;
        }
        .nt-nav-item {
            flex: 1;
            padding: 10px 6px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--nt-text-3);
            border-radius: var(--nt-radius-sm);
            cursor: pointer;
            transition: all var(--nt-transition);
            border: none;
            background: none;
        }
        .nt-nav-item:hover { color: var(--nt-text-2); background: var(--nt-bg3); }
        .nt-nav-item.active {
            color: var(--nt-text);
            background: var(--nt-surface);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .nt-nav-item i { margin-right: 6px; }

        /* Back header */
        .nt-back-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
        }
        .nt-back-btn {
            width: 36px; height: 36px;
            border-radius: var(--nt-radius-sm);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            color: var(--nt-text-2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-back-btn:hover { background: var(--nt-surface); color: var(--nt-text); }

        /* Card */
        .nt-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            padding: 20px;
            animation: nt-fadeIn 0.3s ease;
        }

        /* Certificate grid */
        .nt-cert-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        @media (max-width: 640px) {
            .nt-cert-grid { grid-template-columns: 1fr; }
        }
        .nt-cert-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-cert-card:hover {
            border-color: var(--nt-border-h);
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.3);
        }
        .nt-cert-thumb {
            height: 120px;
            background: var(--nt-bg3);
            display: flex; align-items: center; justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .nt-cert-thumb img {
            width: 100%; height: 100%; object-fit: cover; opacity: 0.8;
        }
        .nt-cert-info {
            padding: 14px;
        }
        .nt-card-action {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            color: var(--nt-text-2);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--nt-transition);
            text-decoration: none;
            font-family: inherit;
        }
        .nt-card-action:hover {
            color: var(--nt-accent);
            border-color: rgba(245,158,11,0.3);
            background: var(--nt-accent-glow);
        }

        /* Dropzone */
        .nt-dropzone {
            border: 2px dashed var(--nt-border-h);
            border-radius: var(--nt-radius-lg);
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.15);
        }
        .nt-dropzone:hover {
            border-color: rgba(245,158,11,0.4);
            background: var(--nt-accent-glow);
        }
        .nt-dropzone.drag-over {
            border-color: var(--nt-accent);
            background: var(--nt-accent-glow);
            transform: scale(1.01);
        }

        /* Wizard steps */
        .nt-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            margin-bottom: 28px;
        }
        .nt-step-dot {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .nt-step-dot.pending {
            background: var(--nt-bg3);
            color: var(--nt-text-3);
            border: 2px solid var(--nt-border);
        }
        .nt-step-dot.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            box-shadow: 0 0 20px rgba(245,158,11,0.3);
        }
        .nt-step-dot.done {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
        }
        .nt-step-line {
            width: 60px; height: 3px;
            background: var(--nt-border);
            border-radius: 2px;
            transition: all 0.4s ease;
        }
        .nt-step-line.done { background: var(--nt-green); }
        .nt-step-line.active { background: linear-gradient(90deg, var(--nt-green), var(--nt-accent)); }

        /* Fee box */
        .nt-fee-box {
            background: rgba(245,158,11,0.06);
            border: 1px solid rgba(245,158,11,0.15);
            border-radius: var(--nt-radius);
            padding: 16px;
        }
        .nt-fee-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .nt-fee-row + .nt-fee-row {
            border-top: 1px solid var(--nt-border);
        }

        /* Verify */
        .nt-verified {
            background: rgba(34,197,94,0.08);
            border: 1px solid rgba(34,197,94,0.2);
            border-radius: var(--nt-radius);
            padding: 20px;
        }
        .nt-not-found {
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: var(--nt-radius);
            padding: 20px;
        }

        /* Stats */
        .nt-stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        @media (min-width: 640px) {
            .nt-stat-grid { grid-template-columns: repeat(4, 1fr); }
        }
        .nt-stat-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            padding: 16px;
            text-align: center;
            animation: nt-fadeIn 0.3s ease;
        }
        .nt-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--nt-text);
            font-family: monospace;
        }
        .nt-recent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--nt-border);
            transition: background var(--nt-transition);
        }
        .nt-recent-item:hover { background: var(--nt-bg3); }
        .nt-recent-item:last-child { border-bottom: none; }

        /* Detail */
        .nt-detail { animation: nt-fadeIn 0.3s ease; }
        .nt-detail-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        @media (max-width: 640px) {
            .nt-detail-meta { grid-template-columns: 1fr; }
        }
        .nt-hash-display {
            font-family: monospace;
            font-size: 11px;
            color: var(--nt-text-2);
            background: var(--nt-bg3);
            padding: 12px;
            border-radius: var(--nt-radius-sm);
            word-break: break-all;
            cursor: pointer;
            border: 1px solid var(--nt-border);
            transition: border-color var(--nt-transition);
        }
        .nt-hash-display:hover { border-color: var(--nt-accent); }

        /* Buttons */
        .nt-btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-weight: 700;
            border: none;
            border-radius: var(--nt-radius-sm);
            padding: 12px 24px;
            cursor: pointer;
            transition: all var(--nt-transition);
            font-size: 14px;
        }
        .nt-btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(245,158,11,0.3);
        }
        .nt-btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
        .nt-btn-secondary {
            background: var(--nt-bg3);
            color: var(--nt-text-2);
            font-weight: 600;
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius-sm);
            padding: 10px 20px;
            cursor: pointer;
            transition: all var(--nt-transition);
            font-size: 13px;
        }
        .nt-btn-secondary:hover { background: var(--nt-surface); color: var(--nt-text); }
        .nt-btn-icon {
            width: 36px; height: 36px;
            border-radius: var(--nt-radius-sm);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            color: var(--nt-text-2);
            display: inline-flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-btn-icon:hover { background: var(--nt-surface); color: var(--nt-text); }

        /* Overlay */
        .nt-overlay {
            position: fixed; inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.92);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center; justify-content: center;
        }
        .nt-overlay.active { display: flex; }

        /* Shimmer loading */
        .nt-shimmer {
            background: linear-gradient(90deg, var(--nt-bg3) 25%, var(--nt-surface) 50%, var(--nt-bg3) 75%);
            background-size: 200% 100%;
            animation: nt-shimmer 1.5s ease infinite;
            border-radius: var(--nt-radius-sm);
        }

        /* Duplicate warning */
        .nt-duplicate-warn {
            background: rgba(251,191,36,0.08);
            border: 1px solid rgba(251,191,36,0.25);
            border-radius: var(--nt-radius);
            padding: 16px;
        }
    `,document.head.appendChild(e);const t=document.getElementById("notary-styles-v6");t&&t.remove()}function Ya(e="",t=""){const a=e.toLowerCase(),n=t.toLowerCase();return a.includes("image")||/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico)$/.test(n)?Mt.image:a.includes("pdf")||n.endsWith(".pdf")?Mt.pdf:a.includes("audio")||/\.(mp3|wav|ogg|flac|aac|m4a)$/.test(n)?Mt.audio:a.includes("video")||/\.(mp4|avi|mov|mkv|webm|wmv)$/.test(n)?Mt.video:a.includes("word")||a.includes("document")||/\.(doc|docx|odt|rtf)$/.test(n)?Mt.document:a.includes("sheet")||a.includes("excel")||/\.(xls|xlsx|csv|ods)$/.test(n)?Mt.spreadsheet:/\.(js|ts|py|java|cpp|c|h|html|css|json|xml|sol|rs|go|php|rb)$/.test(n)?Mt.code:a.includes("zip")||a.includes("archive")||/\.(zip|rar|7z|tar|gz)$/.test(n)?Mt.archive:Mt.default}function Zr(e){if(!e)return"";let t;if(typeof e=="number")t=new Date(e>1e12?e:e*1e3);else if(typeof e=="string")t=new Date(e);else if(e!=null&&e.toDate)t=e.toDate();else if(e!=null&&e.seconds)t=new Date(e.seconds*1e3);else return"";if(isNaN(t.getTime()))return"";const a=new Date,n=a-t,o=Math.floor(n/6e4),s=Math.floor(n/36e5),i=Math.floor(n/864e5);return o<1?"Just now":o<60?`${o}m`:s<24?`${s}h`:i<7?`${i}d`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==a.getFullYear()?"numeric":void 0})}function ro(e){if(!e)return"";const t=typeof e=="number"?new Date(e>1e12?e:e*1e3):new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function Ws(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function Mn(e){return En(e)||""}function Qr(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(2)} MB`}function zg(e){if(!e)return{};try{if(e.trim().startsWith("{"))return JSON.parse(e)}catch{}return{desc:e}}function $g(e){return Vt[e]||Vt[3]}function Zv(e){return Li[e]||Li[5]}function Qv(e){if(!e)return"";try{if(e.trim().startsWith("{")){const o=JSON.parse(e);if(o.uri)return o.uri}}catch{}const t=e.match(/ar:\/\/[a-zA-Z0-9_-]{43,44}/);if(t)return t[0];const a=e.match(/ipfs:\/\/\S+/);if(a)return a[0];const n=e.match(/\b(Qm[1-9A-HJ-NP-Za-km-z]{44}|bafy\S+)\b/);if(n)return n[1];if(e.includes("---")){const o=e.split("---"),s=o[o.length-1].trim();if(s.length>10)return s}return""}const xn=window.ethers;async function Sg(e=0){var t;try{const a=await ce.getCertifyFee(e);b.ethFee=a.fee,b.feesLoaded=!0}catch{b.ethFee=(xn==null?void 0:xn.parseEther("0.0001"))||0n,b.feesLoaded=!0}try{const[a,n,o]=await Promise.all([ce.getAssetRegisterFee(),ce.getAssetTransferFee(),ce.getAnnotateFee()]);b.assetRegisterFee=a.fee,b.assetTransferFee=n.fee,b.annotateFee=o.fee}catch(a){console.warn("[NotaryPage] Could not load asset fees:",a.message)}if((t=b.wizFile)!=null&&t.size)try{b.wizUploadCost=await Yd(b.wizFile.size)}catch(a){console.warn("[NotaryPage] Could not estimate upload cost:",a.message),b.wizUploadCost=null}}async function Gs(){if(!(!u.isConnected||!u.userAddress)){b.certsLoading=!0,b._render();try{const e=await ey();b.certificates=e,console.log("[NotaryPage] Loaded",e.length,"certificates from contract")}catch(e){console.error("[NotaryPage] Contract load failed:",e),b.certificates=[]}b.certsLoading=!1,b._render()}}async function ey(){var s,i;const e=await ce.getTotalDocuments();if(e===0)return[];console.log(`[NotaryPage] Total tokens on-chain: ${e}, scanning for owner: ${u.userAddress}`);const t=u.userAddress.toLowerCase(),a=[],n=50;for(let r=1;r<=e;r+=n){const l=Math.min(n,e-r+1),c=await ce.getCertificatesBatch(r,l);for(const d of c)((s=d.owner)==null?void 0:s.toLowerCase())===t&&a.push(d)}const o=[];for(const r of a)try{const l=await ce.getCertificate(r.id),c=zg((l==null?void 0:l.meta)||"");o.push({id:r.id,hash:r.documentHash||(l==null?void 0:l.documentHash)||"",description:c.desc||c.name||"",docType:r.docType??(l==null?void 0:l.docType)??0,timestamp:r.timestamp||(l==null?void 0:l.timestamp)||0,owner:r.owner,ipfs:c.uri||Qv((l==null?void 0:l.meta)||""),mimeType:c.type||"",fileName:c.name||"",rawMeta:(l==null?void 0:l.meta)||"",txHash:""})}catch{o.push({id:r.id,hash:r.documentHash||"",description:"",docType:r.docType??0,timestamp:r.timestamp||0,owner:r.owner,ipfs:"",txHash:""})}if(o.length>0)try{const{NetworkManager:r}=await U(async()=>{const{NetworkManager:c}=await Promise.resolve().then(()=>q);return{NetworkManager:c}},void 0),l=r.getProvider();if(l&&(E!=null&&E.notary)){const c=new xn.Contract(E.notary,Ng,l),d=10313523,f=c.filters.CertificateTransferred(null,null,u.userAddress),g=await c.queryFilter(f,d),m=new Set(g.map(h=>h.args.documentHash.toLowerCase()));for(const h of o)m.has((i=h.hash)==null?void 0:i.toLowerCase())&&(h.received=!0)}}catch(r){console.warn("[NotaryPage] Could not check transfer events:",r.message)}return o.sort((r,l)=>l.id-r.id)}async function Ks(){if(!(!u.isConnected||!u.userAddress)){b.assetsLoading=!0,b._render();try{const e=await ty();b.assets=e,console.log("[NotaryPage] Loaded",e.length,"assets from contract")}catch(e){console.error("[NotaryPage] Asset load failed:",e),b.assets=[]}b.assetsLoading=!1,b._render()}}async function ty(){const e=await ce.getTotalDocuments();if(e===0)return[];const t=u.userAddress.toLowerCase(),a=[];for(let n=1;n<=e;n++)try{if(!await ce.isAsset(n))continue;const s=await ce.getAsset(n);if(!s||s.owner.toLowerCase()!==t)continue;const i=zg(s.meta||"");a.push({id:s.id,owner:s.owner,assetType:s.assetType,assetTypeName:s.assetTypeName,registeredAt:s.registeredAt,date:s.date,annotationCount:s.annotationCount,transferCount:s.transferCount,documentHash:s.documentHash,description:i.desc||i.name||"",meta:s.meta,parsedMeta:i})}catch{}return a.sort((n,o)=>o.id-n.id)}async function Lg(e){try{const t=await ce.getAnnotations(e);b.selectedAssetAnnotations=t||[]}catch(t){console.error("[NotaryPage] Annotations load failed:",t),b.selectedAssetAnnotations=[]}}async function ay(){b.statsLoading=!0;try{const[e,t]=await Promise.all([ce.getStats(),ce.getTotalDocuments()]);b.stats=e,b.totalSupply=t}catch(e){console.warn("[NotaryPage] Stats load error:",e)}try{await ny()}catch{}b.statsLoading=!1,b.view==="stats"&&b._render()}async function ny(){if(!xn||!(E!=null&&E.notary))return;const{NetworkManager:e}=await U(async()=>{const{NetworkManager:r}=await Promise.resolve().then(()=>q);return{NetworkManager:r}},void 0),t=e.getProvider();if(!t)return;const a=new xn.Contract(E.notary,Ng,t),n=a.filters.Certified(),i=(await a.queryFilter(n,10313523)).slice(-20).reverse();b.recentNotarizations=i.map(r=>({tokenId:Number(r.args.certId),owner:r.args.owner,hash:r.args.documentHash,docType:Number(r.args.docType||0),timestamp:null,blockNumber:r.blockNumber}));try{const r=[...new Set(i.map(c=>c.blockNumber))],l={};await Promise.all(r.slice(0,10).map(async c=>{const d=await t.getBlock(c);d&&(l[c]=d.timestamp)})),b.recentNotarizations.forEach(c=>{l[c.blockNumber]&&(c.timestamp=l[c.blockNumber])})}catch{}}function ln(e,t){const a=document.getElementById("nt-overlay");if(!a)return;a.classList.add("active");const n={uploading:{icon:"fa-solid fa-cloud-arrow-up",text:"Uploading to Arweave...",sub:"Permanent decentralized storage",pct:20},funding:{icon:"fa-solid fa-wallet",text:"Funding storage...",sub:"Confirm in MetaMask",pct:15,animate:!0},minting:{icon:"fa-solid fa-stamp",text:"Certifying on Blockchain...",sub:"Waiting for confirmation",pct:65,animate:!0},success:{icon:"fa-solid fa-check",text:"Certified!",sub:t?`Certificate #${t}`:"Certificate created",pct:100,success:!0},"asset-success":{icon:"fa-solid fa-check",text:"Asset Registered!",sub:t?`Asset #${t}`:"Asset registered",pct:100,success:!0}},o=n[e]||n.uploading;if(a.innerHTML=`
        <div style="text-align:center;padding:24px;max-width:360px">
            <div style="width:100px;height:100px;margin:0 auto 24px;position:relative">
                ${o.success?"":`
                    <div style="position:absolute;inset:-4px;border-radius:50%;border:3px solid transparent;border-top-color:var(--nt-accent);border-right-color:rgba(245,158,11,0.3);animation:nt-spin 1s linear infinite"></div>
                `}
                <div style="width:100%;height:100%;border-radius:50%;background:${o.success?"rgba(34,197,94,0.15)":"var(--nt-bg3)"};display:flex;align-items:center;justify-content:center;border:2px solid ${o.success?"var(--nt-green)":"rgba(245,158,11,0.2)"}">
                    <i class="${o.icon}" style="font-size:36px;color:${o.success?"var(--nt-green)":"var(--nt-accent)"};${o.animate?"animation:nt-stamp 0.6s ease":""}"></i>
                </div>
            </div>
            <div style="font-size:18px;font-weight:700;color:var(--nt-text);margin-bottom:6px">${o.text}</div>
            <div style="font-size:12px;color:${o.success?"var(--nt-green)":"var(--nt-accent)"};font-family:monospace;margin-bottom:16px">${o.sub}</div>
            <div style="width:100%;height:4px;background:var(--nt-bg3);border-radius:2px;overflow:hidden">
                <div style="height:100%;width:${o.pct}%;background:linear-gradient(90deg,var(--nt-accent),${o.success?"var(--nt-green)":"#fbbf24"});border-radius:2px;transition:width 0.5s ease"></div>
            </div>
            ${o.success?"":'<div style="font-size:10px;color:var(--nt-text-3);margin-top:12px">Do not close this window</div>'}
        </div>
    `,!document.getElementById("nt-spin-kf")){const s=document.createElement("style");s.id="nt-spin-kf",s.textContent="@keyframes nt-spin { to { transform: rotate(360deg); } }",document.head.appendChild(s)}}function hn(){const e=document.getElementById("nt-overlay");e&&e.classList.remove("active")}function oy(e,t,a){const n=document.getElementById("nt-overlay");if(!n)return;n.classList.add("active");const o=e.hash?`${e.hash.slice(0,10)}...${e.hash.slice(-8)}`:"",s=e.owner?`${e.owner.slice(0,6)}...${e.owner.slice(-4)}`:"",i=e.timestamp?new Date(e.timestamp>1e12?e.timestamp:e.timestamp*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"";if(n.innerHTML=`
        <div style="padding:20px;max-width:360px;width:100%;animation:nt-card-in 0.4s ease" onclick="event.stopPropagation()">
            <!-- NFT Card -->
            <div style="background:linear-gradient(145deg,rgba(15,15,20,0.98),rgba(25,20,40,0.98));border-radius:20px;overflow:hidden;border:1px solid rgba(245,158,11,0.3);box-shadow:0 0 60px rgba(245,158,11,0.15),0 20px 60px rgba(0,0,0,0.5)">
                <!-- Image -->
                <div style="height:280px;background:var(--nt-bg3);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden">
                    ${t?`
                        <img src="${t}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
                        <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;inset:0">
                            <i class="${(a==null?void 0:a.icon)||"fa-regular fa-file"}" style="font-size:64px;color:${(a==null?void 0:a.color)||"#fbbf24"}"></i>
                        </div>
                    `:`
                        <i class="${(a==null?void 0:a.icon)||"fa-regular fa-file"}" style="font-size:64px;color:${(a==null?void 0:a.color)||"#fbbf24"}"></i>
                    `}
                    <div style="position:absolute;top:0;left:0;right:0;height:60px;background:linear-gradient(to bottom,rgba(0,0,0,0.6),transparent)"></div>
                    <div style="position:absolute;top:12px;left:14px;font-size:10px;font-weight:700;color:rgba(255,255,255,0.7);text-transform:uppercase;letter-spacing:0.1em">Backchain Notary</div>
                    <div style="position:absolute;top:12px;right:14px;background:rgba(245,158,11,0.9);padding:3px 12px;border-radius:20px;font-size:13px;font-weight:800;color:#000;font-family:monospace">#${e.id}</div>
                    <div style="position:absolute;bottom:0;left:0;right:0;height:80px;background:linear-gradient(to top,rgba(15,15,20,1),transparent)"></div>
                </div>

                <!-- Info -->
                <div style="padding:20px">
                    <div style="font-size:16px;font-weight:700;color:#fff;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${e.description||e.fileName||"Certified Document"}</div>
                    <div style="font-size:11px;color:rgba(255,255,255,0.4);margin-bottom:16px">${i}</div>

                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px">
                        <div style="background:rgba(255,255,255,0.05);border-radius:10px;padding:10px">
                            <div style="font-size:9px;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:3px">Owner</div>
                            <div style="font-size:11px;font-family:monospace;color:var(--nt-accent)">${s}</div>
                        </div>
                        <div style="background:rgba(255,255,255,0.05);border-radius:10px;padding:10px">
                            <div style="font-size:9px;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:3px">SHA-256</div>
                            <div style="font-size:11px;font-family:monospace;color:rgba(255,255,255,0.6)">${o}</div>
                        </div>
                    </div>

                    <!-- Chain badge -->
                    <div style="display:flex;align-items:center;gap:6px;margin-bottom:16px">
                        <div style="width:18px;height:18px;border-radius:50%;background:linear-gradient(135deg,#F0B90B,#d4a20a);display:flex;align-items:center;justify-content:center">
                            <span style="font-size:10px;font-weight:800;color:#fff">B</span>
                        </div>
                        <span style="font-size:11px;color:rgba(255,255,255,0.5)">opBNB</span>
                        <span style="font-size:10px;color:var(--nt-green);margin-left:auto"><i class="fa-solid fa-shield-check" style="margin-right:3px"></i>On-chain</span>
                    </div>

                    <!-- Actions -->
                    <div style="display:flex;gap:8px">
                        <button onclick="NotaryPage.addToWallet('${e.id}')" style="flex:1;padding:12px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--nt-accent),#f59e0b);color:#000;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px">
                            <i class="fa-solid fa-wallet"></i>Add to Wallet
                        </button>
                        ${t?`
                            <a href="${t}" target="_blank" style="flex:1;padding:12px;border:none;border-radius:12px;background:rgba(255,255,255,0.1);color:#fff;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;text-decoration:none">
                                <i class="fa-solid fa-eye"></i>View
                            </a>
                        `:""}
                    </div>
                </div>
            </div>

            <!-- Close -->
            <button onclick="NotaryPage.hideNftCard()" style="display:block;margin:16px auto 0;padding:10px 32px;border:1px solid rgba(255,255,255,0.15);border-radius:12px;background:transparent;color:rgba(255,255,255,0.6);font-size:13px;cursor:pointer">
                Close
            </button>
        </div>
    `,n.onclick=r=>{r.target===n&&hn()},!document.getElementById("nt-card-kf")){const r=document.createElement("style");r.id="nt-card-kf",r.textContent="@keyframes nt-card-in { from { opacity:0; transform:scale(0.9) translateY(20px); } to { opacity:1; transform:scale(1) translateY(0); } }",document.head.appendChild(r)}}function _g(e,t){b.viewHistory.push({view:b.view,data:b.selectedCert||b.selectedAsset}),b.view=e,e!=="cert-detail"&&e!=="asset-detail"&&(b.activeTab=e),t&&(e==="asset-detail"?b.selectedAsset=t:b.selectedCert=t),b._render(),b._renderHeader()}function sy(){const e=b.viewHistory.pop();e?(b.view=e.view,b.activeTab=e.view==="cert-detail"||e.view==="asset-detail"?e.view==="asset-detail"?"assets":"documents":e.view,e.data&&(e.view==="asset-detail"?b.selectedAsset=e.data:b.selectedCert=e.data)):(b.view="documents",b.activeTab="documents"),b._render(),b._renderHeader()}function iy(e){b.activeTab===e&&b.view===e||(b.viewHistory=[],b.view=e,b.activeTab=e,b._render(),b._renderHeader())}function ry(e){const t=b.certificates.find(a=>String(a.id)===String(e));t&&_g("cert-detail",t)}async function ly(e){const t=b.assets.find(a=>String(a.id)===String(e));t&&(_g("asset-detail",t),await Lg(t.id),b._render())}function cy(){var e;b.wizStep===1&&b.wizFileHash&&!((e=b.wizDuplicateCheck)!=null&&e.exists)?b.wizStep=2:b.wizStep===2&&(b.wizStep=3),b._render()}function dy(){b.wizStep>1&&(b.wizStep--,b._render())}function uy(){const e=document.getElementById("nt-wiz-desc");e&&(b.wizDescription=e.value||""),b.wizStep=3,b._render()}function py(){b.wizFile=null,b.wizFileHash=null,b.wizDuplicateCheck=null,b.wizStep=1,b._render()}function fy(e){b.wizDocType=parseInt(e)||0;const t=document.getElementById("nt-wiz-desc");t&&(b.wizDescription=t.value||""),Sg(b.wizDocType).then(()=>b._render())}function gy(){b.assetWizStep<4&&(b.assetWizStep++,b._render())}function my(){b.assetWizStep>1&&(b.assetWizStep--,b._render())}function Rg(){b.assetWizStep=1,b.assetWizType=0,b.assetWizDescription="",b.assetWizMeta="",b.assetWizFile=null,b.assetWizFileHash=null,b._render()}function by(e){b.assetWizType=parseInt(e)||0,b._render()}function xy(e){b.assetWizDescription=e||""}function hy(e){b.assetWizMeta=e||""}function vy(){const e=document.getElementById("nt-asset-desc");e&&(b.assetWizDescription=e.value||"");const t=document.getElementById("nt-asset-meta");t&&(b.assetWizMeta=t.value||""),b.assetWizDescription&&(b.assetWizStep=3,b._render())}function yy(){b.assetWizFile=null,b.assetWizFileHash=null,b.assetWizStep=4,b._render()}function wy(){b.assetWizStep=4,b._render()}async function ky(e){if(e){b.assetWizFile=e;try{const t=await e.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",t),n=Array.from(new Uint8Array(a));b.assetWizFileHash="0x"+n.map(o=>o.toString(16).padStart(2,"0")).join("")}catch{b.assetWizFileHash=null}b._render()}}function Ey(){b.assetWizFile=null,b.assetWizFileHash=null,b._render()}function Ty(){const e=document.getElementById("nt-asset-transfer-form");if(!e)return;const t=e.style.display==="none";e.style.display=t?"block":"none";const a=document.getElementById("nt-annotation-form");if(a&&t&&(a.style.display="none"),t){const n=document.getElementById("nt-asset-transfer-addr");n&&(n.value="",n.focus())}}function Cy(){const e=document.getElementById("nt-annotation-form");if(!e)return;const t=e.style.display==="none";e.style.display=t?"block":"none";const a=document.getElementById("nt-asset-transfer-form");a&&t&&(a.style.display="none")}function By(){Ks()}async function Ay(){if(b.isProcessing)return;b.isProcessing=!0;const e=document.getElementById("nt-btn-mint");e&&(e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Uploading...'),ln("uploading");try{b.processStep="UPLOADING";const t=await ja(b.wizFile,{tags:[{name:"Type",value:"notary-document"},{name:"Doc-Type",value:String(b.wizDocType)},{name:"File-Name",value:b.wizFile.name}],onProgress:n=>{n==="funding"?ln("funding"):n==="uploading"&&ln("uploading")}});console.log("[NotaryPage] Arweave upload:",t.url),b.processStep="MINTING",ln("minting");const a=JSON.stringify({uri:`ipfs://${t.id}`,name:b.wizFile.name,size:b.wizFile.size,type:b.wizFile.type,desc:b.wizDescription||""});await ce.certify({documentHash:b.wizFileHash,meta:a,docType:b.wizDocType,operator:K(),button:e,onSuccess:(n,o)=>{b.processStep="SUCCESS",ln("success",o),setTimeout(()=>{hn(),b.wizFile=null,b.wizFileHash=null,b.wizDescription="",b.wizDuplicateCheck=null,b.wizDocType=0,b.wizUploadCost=null,b.wizStep=1,b.isProcessing=!1,b.view="documents",b.activeTab="documents",b._renderHeader(),b._render(),Gs(),x("Document certified on Arweave + Blockchain!","success")},3e3)},onError:n=>{if(n.cancelled||n.type==="user_rejected"){b.isProcessing=!1,hn(),e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint');return}throw n}})}catch(t){console.error("[NotaryPage] Mint error:",t),hn(),b.isProcessing=!1,e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint'),t.code!==4001&&t.code!=="ACTION_REJECTED"&&x(t.message||"Certification failed","error")}}async function Iy(){if(b.isProcessing)return;b.isProcessing=!0;const e=document.getElementById("nt-btn-register-asset");e&&(e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Registering...');try{let t="";if(b.assetWizFile){e&&(e.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Uploading document...');const s=await ja(b.assetWizFile,{tags:[{name:"Type",value:"notary-asset-doc"},{name:"Asset-Type",value:String(b.assetWizType)},{name:"File-Name",value:b.assetWizFile.name}]});t=`ipfs://${s.id}`,console.log("[NotaryPage] Asset doc upload:",s.url),e&&(e.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Registering...')}const a={desc:b.assetWizDescription||"",extra:b.assetWizMeta||""};t&&(a.uri=t,a.fileName=b.assetWizFile.name,a.fileType=b.assetWizFile.type,a.fileSize=b.assetWizFile.size);const n=JSON.stringify(a),o=b.assetWizFileHash||"0x"+"0".repeat(64);await ce.registerAsset({assetType:b.assetWizType,meta:n,documentHash:o,operator:K(),button:e,onSuccess:(s,i)=>{ln("asset-success",i),setTimeout(()=>{hn(),Rg(),b.isProcessing=!1,b.view="assets",b.activeTab="assets",b._renderHeader(),b._render(),Ks(),x(`Asset #${i} registered!`,"success")},3e3)},onError:s=>{if(s.cancelled||s.type==="user_rejected"){b.isProcessing=!1,e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-file-signature" style="margin-right:6px"></i>Register Asset');return}throw s}})}catch(t){console.error("[NotaryPage] Register asset error:",t),b.isProcessing=!1,e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-file-signature" style="margin-right:6px"></i>Register Asset'),t.code!==4001&&t.code!=="ACTION_REJECTED"&&x(t.message||"Registration failed","error")}}async function Py(){var c,d;const e=document.getElementById("nt-asset-transfer-addr"),t=document.getElementById("nt-asset-transfer-value"),a=document.getElementById("nt-asset-transfer-note"),n=document.getElementById("nt-btn-transfer-asset"),o=(c=e==null?void 0:e.value)==null?void 0:c.trim(),s=window.ethers;if(!o||!s.isAddress(o)){x("Enter a valid wallet address","error");return}const i=b.selectedAsset;if(!(i!=null&&i.id)){x("Asset not found","error");return}const r=t!=null&&t.value?s.parseEther(t.value):0n,l=((d=a==null?void 0:a.value)==null?void 0:d.trim())||"";n&&(n.disabled=!0,n.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Transferring...');try{await ce.transferAsset({tokenId:i.id,newOwner:o,declaredValue:r,meta:l,operator:K(),button:n,onSuccess:f=>{x(`Asset #${i.id} transferred!`,"success"),i.owner=o,b.selectedAsset=i,Ks(),b._render()},onError:f=>{if(f.cancelled||f.type==="user_rejected"){n&&(n.disabled=!1,n.innerHTML='<i class="fa-solid fa-paper-plane" style="margin-right:6px"></i>Transfer');return}throw f}})}catch(f){console.error("[NotaryPage] Asset transfer error:",f),n&&(n.disabled=!1,n.innerHTML='<i class="fa-solid fa-paper-plane" style="margin-right:6px"></i>Transfer'),f.code!==4001&&f.code!=="ACTION_REJECTED"&&x(f.message||"Transfer failed","error")}}async function Ny(){var i;const e=document.getElementById("nt-annotation-type"),t=document.getElementById("nt-annotation-meta"),a=document.getElementById("nt-btn-add-annotation"),n=b.selectedAsset;if(!(n!=null&&n.id)){x("Asset not found","error");return}const o=parseInt(e==null?void 0:e.value)||0,s=((i=t==null?void 0:t.value)==null?void 0:i.trim())||"";a&&(a.disabled=!0,a.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Adding...');try{await ce.addAnnotation({tokenId:n.id,annotationType:o,meta:s,operator:K(),button:a,onSuccess:(r,l)=>{x(`Annotation added to asset #${n.id}!`,"success"),Lg(n.id).then(()=>{n.annotationCount=(n.annotationCount||0)+1,b.selectedAsset=n,b._render()}),a&&(a.disabled=!1,a.innerHTML='<i class="fa-solid fa-plus" style="margin-right:6px"></i>Add Annotation'),t&&(t.value="")},onError:r=>{if(r.cancelled||r.type==="user_rejected"){a&&(a.disabled=!1,a.innerHTML='<i class="fa-solid fa-plus" style="margin-right:6px"></i>Add Annotation');return}throw r}})}catch(r){console.error("[NotaryPage] Annotation error:",r),a&&(a.disabled=!1,a.innerHTML='<i class="fa-solid fa-plus" style="margin-right:6px"></i>Add Annotation'),r.code!==4001&&r.code!=="ACTION_REJECTED"&&x(r.message||"Annotation failed","error")}}function zy(){const e=b.selectedCert;if(!e)return;const t=Mn(e.ipfs),a=Ya(e.mimeType||"",e.description||"");oy(e,t,a)}function $y(){hn()}function Sy(){const e=b.selectedCert;if(!e)return;const t=Mn(e.ipfs);if(t)window.open(t,"_blank");else{const a=E==null?void 0:E.notary;a&&window.open(`${Dn}${a}?a=${e.id}`,"_blank")}}function Ly(){const e=document.getElementById("nt-transfer-form");if(!e)return;const t=e.style.display==="none";if(e.style.display=t?"block":"none",t){const a=document.getElementById("nt-transfer-addr");a&&(a.value="",a.focus())}}async function _y(){var s;const e=document.getElementById("nt-transfer-addr"),t=document.getElementById("nt-btn-transfer"),a=(s=e==null?void 0:e.value)==null?void 0:s.trim(),n=window.ethers;if(!a||!n.isAddress(a)){x("Enter a valid wallet address","error");return}const o=b.selectedCert;if(!(o!=null&&o.hash)){x("Certificate not found","error");return}t&&(t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Transferring...');try{await ce.transferCertificate({documentHash:o.hash,newOwner:a,operator:K(),button:t,onSuccess:i=>{x(`Certificate #${o.id} transferred!`,"success"),o.owner=a,b.selectedCert=o,Gs(),b._render()},onError:i=>{if(i.cancelled||i.type==="user_rejected"){t&&(t.disabled=!1,t.innerHTML='<i class="fa-solid fa-paper-plane" style="margin-right:6px"></i>Transfer');return}throw i}})}catch(i){console.error("[NotaryPage] Transfer error:",i),t&&(t.disabled=!1,t.innerHTML='<i class="fa-solid fa-paper-plane" style="margin-right:6px"></i>Transfer'),i.code!==4001&&i.code!=="ACTION_REJECTED"&&x(i.message||"Transfer failed","error")}}let an=!1;async function Ry(e){if(an){x("Please wait...","info");return}const t=E==null?void 0:E.notary;if(!t){x("Contract address not found","error");return}const a=u.web3Provider||window.ethereum;if(!a){x("Connect your wallet first","error");return}if(!u.isConnected){x("Wallet disconnected. Please reconnect.","error");return}const n=`https://backcoin.org/api/cert-image/${e}`;an=!0;try{await a.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:t,tokenId:String(e),image:n}}})&&x(`Token #${e} added to wallet!`,"success")}catch(o){console.warn("[Notary] wallet_watchAsset error:",o);const s=(o.message||"").toLowerCase();if(o.code===4001||s.includes("user rejected")||s.includes("user denied")){an=!1;return}if(s.includes("spam")||s.includes("rate limit")||s.includes("too many")){x("MetaMask is rate-limited. Wait a moment and try again.","error"),an=!1;return}if(s.includes("network")||s.includes("chain")||s.includes("ownership")){x("Check your wallet network and try again.","error"),an=!1;return}try{await a.request({method:"wallet_watchAsset",params:[{type:"ERC721",options:{address:t,tokenId:String(e),image:n}}]}),x(`Token #${e} added!`,"success")}catch(i){console.warn("[Notary] fallback also failed:",i),x("Open MetaMask â†’ NFTs â†’ Import NFT to add manually","info")}}finally{setTimeout(()=>{an=!1},3e3)}}function Fy(e){e&&navigator.clipboard.writeText(e).then(()=>{x("Hash copied!","success")}).catch(()=>{x("Failed to copy","error")})}function hc(e){if(!u.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to view your certificates</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}if(b.certsLoading){e.innerHTML=`
            <div class="nt-cert-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>`
                    <div class="nt-cert-card">
                        <div class="nt-shimmer" style="height:120px"></div>
                        <div style="padding:14px">
                            <div class="nt-shimmer" style="height:16px;width:70%;margin-bottom:8px"></div>
                            <div class="nt-shimmer" style="height:12px;width:50%"></div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `;return}if(!b.certificates.length){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-stamp" style="font-size:24px;color:var(--nt-accent);opacity:0.5"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">No Certificates</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Notarize a document to create your first certificate</div>
                <button class="nt-btn-primary" onclick="NotaryPage.setTab('notarize')">
                    <i class="fa-solid fa-plus" style="margin-right:8px"></i>Notarize Document
                </button>
            </div>
        `;return}e.innerHTML=`
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:4px">
            <div style="font-size:13px;color:var(--nt-text-2)">${b.certificates.length} certificate${b.certificates.length>1?"s":""}</div>
            <div style="display:flex;gap:8px;align-items:center">
                <button class="nt-btn-primary" style="padding:6px 14px;font-size:12px" onclick="NotaryPage.setTab('notarize')">
                    <i class="fa-solid fa-plus" style="margin-right:6px"></i>Notarize
                </button>
                <button class="nt-btn-icon" onclick="NotaryPage.refreshHistory()" title="Refresh">
                    <i class="fa-solid fa-rotate-right" style="font-size:12px"></i>
                </button>
            </div>
        </div>
        <div class="nt-cert-grid">
            ${b.certificates.map(t=>Dy(t)).join("")}
        </div>
    `}function Dy(e){var i,r,l;const t=Mn(e.ipfs),a=Ya(e.mimeType||"",e.description||e.fileName||""),n=Zr(e.timestamp),o=((i=e.description)==null?void 0:i.split("---")[0].trim().split(`
`)[0].trim())||"Notarized Document",s=((r=ce.DOC_TYPE_NAMES)==null?void 0:r[e.docType])||"";return`
        <div class="nt-cert-card" onclick="NotaryPage.viewCert(${e.id})">
            <div class="nt-cert-thumb">
                ${t?`
                    <img src="${t}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="">
                    <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;inset:0;background:var(--nt-bg3)">
                        <i class="${a.icon}" style="font-size:28px;color:${a.color}"></i>
                    </div>
                `:`
                    <i class="${a.icon}" style="font-size:28px;color:${a.color}"></i>
                `}
                <span style="position:absolute;top:8px;right:8px;font-size:10px;font-family:monospace;color:var(--nt-accent);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px;font-weight:700">#${e.id}</span>
                ${e.received?'<span style="position:absolute;top:8px;left:8px;font-size:10px;font-weight:600;color:#fff;background:rgba(99,102,241,0.9);padding:2px 8px;border-radius:20px;display:flex;align-items:center;gap:3px"><i class="fa-solid fa-inbox" style="font-size:8px"></i>Received</span>':n?`<span style="position:absolute;top:8px;left:8px;font-size:10px;color:var(--nt-text-3);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px"><i class="fa-regular fa-clock" style="margin-right:4px"></i>${n}</span>`:""}
            </div>
            <div class="nt-cert-info">
                <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px">${o}</div>
                ${s?`<div style="font-size:10px;color:${a.color};margin-bottom:2px"><i class="${a.icon}" style="margin-right:3px;font-size:9px"></i>${s}</div>`:""}
                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px">SHA-256: ${((l=e.hash)==null?void 0:l.slice(0,18))||"..."}...</div>
                <div style="display:flex;gap:6px" onclick="event.stopPropagation()">
                    <a href="${Dn}${E==null?void 0:E.notary}?a=${e.id}" target="_blank" class="nt-card-action" title="Verify on Explorer">
                        <i class="fa-solid fa-cube"></i> Verify
                    </a>
                    <button class="nt-card-action" onclick="NotaryPage.addToWallet('${e.id}')" title="Copy certificate link">
                        <i class="fa-solid fa-share-nodes"></i> Share
                    </button>
                </div>
            </div>
        </div>
    `}function My(e){if(!u.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to view your assets</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}if(b.assetsLoading){e.innerHTML=`
            <div class="nt-cert-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>`
                    <div class="nt-cert-card">
                        <div class="nt-shimmer" style="height:120px"></div>
                        <div style="padding:14px">
                            <div class="nt-shimmer" style="height:16px;width:70%;margin-bottom:8px"></div>
                            <div class="nt-shimmer" style="height:12px;width:50%"></div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `;return}if(!b.assets.length){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:rgba(245,158,11,0.08);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-house" style="font-size:24px;color:var(--nt-accent);opacity:0.5"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">No Assets Registered</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Register your first asset to get started</div>
                <button class="nt-btn-primary" onclick="NotaryPage.setTab('register-asset')">
                    <i class="fa-solid fa-plus" style="margin-right:8px"></i>Register Asset
                </button>
            </div>
        `;return}e.innerHTML=`
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:4px">
            <div style="font-size:13px;color:var(--nt-text-2)">${b.assets.length} asset${b.assets.length>1?"s":""}</div>
            <div style="display:flex;gap:8px;align-items:center">
                <button class="nt-btn-primary" style="padding:6px 14px;font-size:12px" onclick="NotaryPage.setTab('register-asset')">
                    <i class="fa-solid fa-plus" style="margin-right:6px"></i>Register Asset
                </button>
                <button class="nt-btn-icon" onclick="NotaryPage.refreshAssets()" title="Refresh">
                    <i class="fa-solid fa-rotate-right" style="font-size:12px"></i>
                </button>
            </div>
        </div>
        <div class="nt-cert-grid">
            ${b.assets.map(t=>Oy(t)).join("")}
        </div>
    `}function Oy(e){var s;const t=$g(e.assetType),a=Zr(e.registeredAt),n=e.description||t.name,o=Mn((s=e.parsedMeta)==null?void 0:s.uri);return`
        <div class="nt-cert-card" onclick="NotaryPage.viewAsset(${e.id})">
            <div class="nt-cert-thumb" style="background:${t.bg}">
                ${o?`
                    <img src="${o}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="">
                    <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;inset:0;background:${t.bg}">
                        <i class="${t.icon}" style="font-size:32px;color:${t.color}"></i>
                    </div>
                `:`
                    <i class="${t.icon}" style="font-size:32px;color:${t.color}"></i>
                `}
                <span style="position:absolute;top:8px;right:8px;font-size:10px;font-family:monospace;color:var(--nt-accent);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px;font-weight:700">#${e.id}</span>
                ${a?`<span style="position:absolute;top:8px;left:8px;font-size:10px;color:var(--nt-text-3);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px"><i class="fa-regular fa-clock" style="margin-right:4px"></i>${a}</span>`:""}
            </div>
            <div class="nt-cert-info">
                <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px">${n}</div>
                <div style="font-size:10px;color:${t.color};margin-bottom:4px"><i class="${t.icon}" style="margin-right:3px;font-size:9px"></i>${t.name}</div>
                <div style="display:flex;gap:8px;font-size:10px;color:var(--nt-text-3)">
                    <span><i class="fa-solid fa-right-left" style="margin-right:2px"></i>${e.transferCount||0} transfers</span>
                    <span><i class="fa-solid fa-note-sticky" style="margin-right:2px"></i>${e.annotationCount||0} annotations</span>
                </div>
            </div>
        </div>
    `}const vc=window.ethers;function Uy(e){if(!u.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to register assets</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}const t=b.assetWizStep,a=["Type","Details","Document","Confirm"];if(e.innerHTML=`
        <div class="nt-card" style="margin-top:16px;padding:24px">
            <!-- Header -->
            <div style="text-align:center;margin-bottom:24px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(245,158,11,0.12);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-file-signature" style="font-size:20px;color:var(--nt-accent)"></i>
                </div>
                <div style="font-size:18px;font-weight:800;color:var(--nt-text)">Register Asset</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">On-chain property registration</div>
            </div>

            <!-- Step indicators (4 steps) -->
            <div style="display:flex;align-items:center;justify-content:center;gap:0;margin-bottom:24px">
                ${[1,2,3,4].map((n,o)=>`
                    <div style="display:flex;flex-direction:column;align-items:center;gap:4px">
                        <div style="width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;transition:all 0.2s;${t>n?"background:var(--nt-accent);color:#000;":t===n?"background:var(--nt-accent);color:#000;box-shadow:0 0 0 3px rgba(245,158,11,0.25);":"background:var(--nt-bg3);color:var(--nt-text-3);"}">
                            ${t>n?'<i class="fa-solid fa-check" style="font-size:11px"></i>':n}
                        </div>
                        <span style="font-size:9px;color:${t>=n?"var(--nt-accent)":"var(--nt-text-3)"};font-weight:${t===n?"700":"500"}">${a[o]}</span>
                    </div>
                    ${o<3?`<div style="flex:1;max-width:40px;height:2px;background:${t>n?"var(--nt-accent)":"var(--nt-bg3)"};margin:0 4px 16px;transition:background 0.2s"></div>`:""}
                `).join("")}
            </div>

            <!-- Step content -->
            <div id="nt-asset-wiz-panel">
                ${t===1?Hy():""}
                ${t===2?jy():""}
                ${t===3?Wy():""}
                ${t===4?Gy():""}
            </div>
        </div>
    `,t===2){const n=document.getElementById("nt-asset-desc");n&&b.assetWizDescription&&(n.value=b.assetWizDescription);const o=document.getElementById("nt-asset-meta");o&&b.assetWizMeta&&(o.value=b.assetWizMeta)}}function Hy(){return`
        <div style="animation:nt-fadeIn 0.3s ease">
            <div style="font-size:14px;font-weight:700;color:var(--nt-text);margin-bottom:4px;text-align:center">What are you registering?</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-bottom:16px;text-align:center">Choose the type of asset to register on-chain</div>

            <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:20px">
                ${Vt.map(e=>{const t=b.assetWizType===e.id;return`
                    <div onclick="NotaryPage.onAssetTypeChange(${e.id})" style="padding:16px;border-radius:var(--nt-radius-sm);background:${t?e.bg:"var(--nt-bg3)"};border:2px solid ${t?e.color:"var(--nt-border)"};cursor:pointer;transition:all var(--nt-transition);display:flex;align-items:center;gap:14px">
                        <div style="width:44px;height:44px;border-radius:var(--nt-radius-sm);background:${t?"rgba(0,0,0,0.15)":"var(--nt-bg)"};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="${e.icon}" style="font-size:20px;color:${e.color}"></i>
                        </div>
                        <div style="flex:1;min-width:0">
                            <div style="font-size:14px;font-weight:700;color:${t?e.color:"var(--nt-text)"}">${e.name}</div>
                            <div style="font-size:11px;color:var(--nt-text-3);margin-top:2px">${e.desc}</div>
                        </div>
                        ${t?`<i class="fa-solid fa-circle-check" style="font-size:18px;color:${e.color};flex-shrink:0"></i>`:""}
                    </div>
                    `}).join("")}
            </div>

            <button class="nt-btn-primary" style="width:100%;padding:14px;font-size:14px" onclick="NotaryPage.assetWizNext()">
                Continue <i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
            </button>
        </div>
    `}function jy(){const e=Vt[b.assetWizType]||Vt[3],t=ts[b.assetWizType]||ts[3];return`
        <div style="animation:nt-fadeIn 0.3s ease">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;padding:12px;background:${e.bg};border-radius:var(--nt-radius-sm)">
                <i class="${e.icon}" style="font-size:18px;color:${e.color}"></i>
                <span style="font-size:13px;font-weight:600;color:${e.color}">${e.name}</span>
            </div>

            <div style="margin-bottom:16px">
                <label style="font-size:12px;font-weight:600;color:var(--nt-text-2);display:block;margin-bottom:6px">Description *</label>
                <input id="nt-asset-desc" type="text" placeholder="${t.descPlaceholder}"
                    style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;outline:none;box-sizing:border-box;transition:border-color var(--nt-transition)"
                    onfocus="this.style.borderColor='rgba(245,158,11,0.5)'" onblur="this.style.borderColor='var(--nt-border)'"
                    oninput="NotaryPage.onAssetDescChange(this.value);var b=document.getElementById('nt-asset-continue');if(b)b.disabled=!this.value.trim()"
                    value="${b.assetWizDescription||""}">
            </div>

            <div style="margin-bottom:20px">
                <label style="font-size:12px;font-weight:600;color:var(--nt-text-2);display:block;margin-bottom:6px">Additional Info <span style="color:var(--nt-text-3);font-weight:400">(optional)</span></label>
                <textarea id="nt-asset-meta" placeholder="${t.metaLabel}"
                    style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;outline:none;box-sizing:border-box;resize:vertical;min-height:60px;font-family:inherit;transition:border-color var(--nt-transition)"
                    onfocus="this.style.borderColor='rgba(245,158,11,0.5)'" onblur="this.style.borderColor='var(--nt-border)'"
                    oninput="NotaryPage.onAssetMetaChange(this.value)"
                >${b.assetWizMeta||""}</textarea>
            </div>

            <div style="display:flex;gap:8px">
                <button class="nt-btn-secondary" style="flex:1;padding:12px" onclick="NotaryPage.assetWizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button id="nt-asset-continue" class="nt-btn-primary" style="flex:2;padding:12px" onclick="NotaryPage.assetWizToStep3()" ${b.assetWizDescription?"":"disabled"}>
                    Continue <i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        </div>
    `}function Wy(){const e=Vt[b.assetWizType]||Vt[3],t=ts[b.assetWizType]||ts[3];return`
        <div style="animation:nt-fadeIn 0.3s ease">
            <div style="font-size:14px;font-weight:700;color:var(--nt-text);margin-bottom:4px;text-align:center">Supporting Document</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-bottom:16px;text-align:center">
                Attach a document to anchor its hash on-chain <span style="color:var(--nt-text-3);font-weight:400">(optional)</span>
            </div>

            <div style="background:${e.bg};border-radius:var(--nt-radius-sm);padding:10px 14px;margin-bottom:16px;display:flex;align-items:center;gap:8px">
                <i class="fa-solid fa-lightbulb" style="font-size:13px;color:${e.color}"></i>
                <span style="font-size:12px;color:${e.color}">${t.docHint}</span>
            </div>

            <div id="nt-asset-dropzone" class="nt-dropzone" style="padding:32px 16px;margin-bottom:12px"
                ondragover="event.preventDefault();this.classList.add('drag-over')"
                ondragleave="this.classList.remove('drag-over')"
                ondrop="event.preventDefault();this.classList.remove('drag-over');NotaryPage.onAssetFileSelect(event.dataTransfer.files[0])"
                onclick="document.getElementById('nt-asset-file-input').click()">
                ${b.assetWizFile?`
                    <div style="display:flex;align-items:center;gap:12px;text-align:left">
                        <i class="fa-regular fa-file" style="font-size:24px;color:var(--nt-accent)"></i>
                        <div style="flex:1;min-width:0">
                            <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${b.assetWizFile.name}</div>
                            <div style="font-size:11px;color:var(--nt-text-3)">${(b.assetWizFile.size/1024).toFixed(1)} KB</div>
                        </div>
                        <button onclick="event.stopPropagation();NotaryPage.removeAssetFile()" style="width:28px;height:28px;border-radius:50%;background:rgba(239,68,68,0.15);border:none;color:var(--nt-red);cursor:pointer;display:flex;align-items:center;justify-content:center">
                            <i class="fa-solid fa-xmark" style="font-size:12px"></i>
                        </button>
                    </div>
                `:`
                    <i class="fa-solid fa-cloud-arrow-up" style="font-size:28px;color:var(--nt-text-3);margin-bottom:8px"></i>
                    <div style="font-size:13px;color:var(--nt-text-2);font-weight:600">Drop file here or click to browse</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Max 5MB â€” PDF, images, documents</div>
                `}
                <input type="file" id="nt-asset-file-input" style="display:none" onchange="NotaryPage.onAssetFileSelect(this.files[0])">
            </div>

            <div style="text-align:center;margin-bottom:16px">
                <button onclick="NotaryPage.assetWizSkipDoc()" style="background:none;border:none;color:var(--nt-text-3);font-size:12px;cursor:pointer;text-decoration:underline;padding:4px 8px">
                    Skip this step
                </button>
            </div>

            <div style="display:flex;gap:8px">
                <button class="nt-btn-secondary" style="flex:1;padding:12px" onclick="NotaryPage.assetWizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2;padding:12px" onclick="NotaryPage.assetWizToReview()">
                    Review <i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        </div>
    `}function Gy(){const e=Vt[b.assetWizType]||Vt[3],t=b.assetRegisterFee||0n,a=vc?vc.formatEther(t):"0";return`
        <div style="animation:nt-fadeIn 0.3s ease">
            <div style="font-size:14px;font-weight:700;color:var(--nt-text);margin-bottom:16px;text-align:center">Review & Sign</div>

            <!-- Summary card -->
            <div style="background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--nt-border)">
                    <div style="width:40px;height:40px;border-radius:var(--nt-radius-sm);background:${e.bg};display:flex;align-items:center;justify-content:center">
                        <i class="${e.icon}" style="font-size:18px;color:${e.color}"></i>
                    </div>
                    <div>
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${b.assetWizDescription||"Asset"}</div>
                        <div style="font-size:11px;color:${e.color}">${e.name}</div>
                    </div>
                </div>
                ${b.assetWizMeta?`
                    <div style="font-size:11px;color:var(--nt-text-3);margin-bottom:8px">
                        <i class="fa-solid fa-info-circle" style="margin-right:4px"></i>${b.assetWizMeta}
                    </div>
                `:""}
                ${b.assetWizFile?`
                    <div style="font-size:11px;color:var(--nt-text-3)">
                        <i class="fa-regular fa-file" style="margin-right:4px"></i>${b.assetWizFile.name}
                    </div>
                `:`
                    <div style="font-size:11px;color:var(--nt-text-3);font-style:italic">
                        No supporting document
                    </div>
                `}
            </div>

            <!-- Fee -->
            <div class="nt-fee-box" style="margin-bottom:16px">
                <div class="nt-fee-row">
                    <span style="font-size:12px;color:var(--nt-text-2)">Registration Fee</span>
                    <span style="font-size:13px;font-weight:700;color:var(--nt-accent);font-family:monospace">${parseFloat(a).toFixed(4)} BNB</span>
                </div>
            </div>

            <div style="font-size:11px;color:var(--nt-text-3);text-align:center;margin-bottom:16px">
                <i class="fa-solid fa-shield-check" style="color:var(--nt-green);margin-right:4px"></i>
                Permanently recorded on opBNB blockchain
            </div>

            <div style="display:flex;gap:8px">
                <button class="nt-btn-secondary" style="flex:1;padding:12px" onclick="NotaryPage.assetWizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button id="nt-btn-register-asset" class="nt-btn-primary" style="flex:2;padding:14px;font-size:14px" onclick="NotaryPage.handleRegisterAsset()">
                    <i class="fa-solid fa-file-signature" style="margin-right:6px"></i>Register Asset
                </button>
            </div>
        </div>
    `}function Ky(e){var c,d,f,g,m,h,w,y,k;const t=b.selectedAsset;if(!t){b.view="assets",b.activeTab="assets",b._render(),b._renderHeader();return}const a=$g(t.assetType),n=t.owner&&u.userAddress&&t.owner.toLowerCase()===u.userAddress.toLowerCase(),o=b.selectedAssetAnnotations||[],s=Mn((c=t.parsedMeta)==null?void 0:c.uri);(f=(d=t.parsedMeta)==null?void 0:d.fileType)==null||f.startsWith("image/");const i=Ya(((g=t.parsedMeta)==null?void 0:g.fileType)||"",((m=t.parsedMeta)==null?void 0:m.fileName)||""),r=((h=t.parsedMeta)==null?void 0:h.fileName)||"",l=(w=t.parsedMeta)!=null&&w.fileSize?`${(t.parsedMeta.fileSize/1024).toFixed(1)} KB`:"";e.innerHTML=`
        <div class="nt-detail" style="margin-top:8px">
            <!-- Asset Header Card -->
            <div style="background:${a.bg};border-radius:var(--nt-radius);padding:24px;margin-bottom:16px;position:relative;overflow:hidden">
                <div style="position:absolute;top:-20px;right:-20px;font-size:120px;opacity:0.06">
                    <i class="${a.icon}"></i>
                </div>
                <div style="display:flex;align-items:center;gap:14px;position:relative;z-index:1">
                    <div style="width:52px;height:52px;border-radius:var(--nt-radius-sm);background:rgba(0,0,0,0.2);display:flex;align-items:center;justify-content:center">
                        <i class="${a.icon}" style="font-size:24px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:16px;font-weight:700;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t.description||a.name}</div>
                        <div style="font-size:12px;color:${a.color};margin-top:2px">${a.name} &middot; Token #${t.id}</div>
                    </div>
                </div>
            </div>

            ${s?`
            <!-- Document Preview -->
            <div style="margin-bottom:16px;cursor:pointer" onclick="window.open('${s}','_blank')">
                <div style="min-height:200px;max-height:400px;background:var(--nt-bg3);border-radius:var(--nt-radius);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid var(--nt-border);transition:border-color var(--nt-transition)" onmouseover="this.style.borderColor='rgba(245,158,11,0.3)'" onmouseout="this.style.borderColor='var(--nt-border)'">
                    <img src="${s}" style="width:100%;height:100%;object-fit:contain;max-height:400px" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="Document">
                    <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:200px;position:absolute;inset:0;background:var(--nt-bg3)">
                        <i class="${i.icon}" style="font-size:48px;color:${i.color};margin-bottom:8px"></i>
                        <span style="font-size:12px;color:var(--nt-text-2);font-weight:600">${r||i.label+" file"}</span>
                        ${l?`<span style="font-size:11px;color:var(--nt-text-3);margin-top:2px">${l}</span>`:""}
                        <span style="font-size:10px;color:var(--nt-accent);margin-top:6px"><i class="fa-solid fa-arrow-up-right-from-square" style="margin-right:4px"></i>Tap to open</span>
                    </div>
                    <div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.id}</div>
                    <div style="position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,0.75);padding:4px 10px;border-radius:8px;font-size:10px;color:var(--nt-text-2)">
                        <i class="fa-solid fa-arrow-up-right-from-square" style="margin-right:4px"></i>Tap to view
                    </div>
                </div>
            </div>
            `:""}

            <!-- Quick Stats -->
            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:16px">
                <div class="nt-card" style="padding:12px;text-align:center">
                    <div style="font-size:18px;font-weight:800;color:var(--nt-text);font-family:monospace">${t.transferCount||0}</div>
                    <div style="font-size:10px;color:var(--nt-text-3);margin-top:2px">Transfers</div>
                </div>
                <div class="nt-card" style="padding:12px;text-align:center">
                    <div style="font-size:18px;font-weight:800;color:var(--nt-text);font-family:monospace">${t.annotationCount||0}</div>
                    <div style="font-size:10px;color:var(--nt-text-3);margin-top:2px">Annotations</div>
                </div>
                <div class="nt-card" style="padding:12px;text-align:center">
                    <div style="font-size:18px;font-weight:800;color:var(--nt-text);font-family:monospace">${((y=ro(t.registeredAt))==null?void 0:y.split(",")[0])||"â€”"}</div>
                    <div style="font-size:10px;color:var(--nt-text-3);margin-top:2px">Registered</div>
                </div>
            </div>

            <!-- Owner -->
            <div class="nt-card" style="margin-bottom:12px;padding:14px">
                <div style="font-size:10px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">Owner</div>
                <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2)">${t.owner||"â€”"}</div>
                ${n?'<div style="font-size:10px;color:var(--nt-green);margin-top:4px"><i class="fa-solid fa-check-circle" style="margin-right:3px"></i>You own this asset</div>':""}
            </div>

            <!-- Document Hash -->
            ${t.documentHash&&t.documentHash!=="0x"+"0".repeat(64)?`
                <div class="nt-card" style="margin-bottom:12px;padding:14px">
                    <div style="font-size:10px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">
                        <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>Document Hash
                    </div>
                    <div class="nt-hash-display" onclick="NotaryPage.copyHash('${t.documentHash}')" title="Click to copy">
                        ${t.documentHash}
                        <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                    </div>
                </div>
            `:""}

            <!-- Additional Info -->
            ${(k=t.parsedMeta)!=null&&k.extra?`
                <div class="nt-card" style="margin-bottom:12px;padding:14px">
                    <div style="font-size:10px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">Additional Info</div>
                    <div style="font-size:13px;color:var(--nt-text-2);line-height:1.5">${t.parsedMeta.extra}</div>
                </div>
            `:""}

            <!-- Actions (owner only) -->
            ${n?`
                <div style="display:flex;gap:8px;margin-bottom:16px">
                    <button class="nt-btn-primary" style="flex:1;padding:14px;font-size:13px;display:flex;align-items:center;justify-content:center;gap:8px;background:linear-gradient(135deg,#3b82f6,#6366f1)" onclick="NotaryPage.toggleAssetTransferForm()">
                        <i class="fa-solid fa-paper-plane"></i>Transfer
                    </button>
                    <button class="nt-btn-primary" style="flex:1;padding:14px;font-size:13px;display:flex;align-items:center;justify-content:center;gap:8px" onclick="NotaryPage.toggleAnnotationForm()">
                        <i class="fa-solid fa-note-sticky"></i>Annotate
                    </button>
                </div>

                <!-- Transfer Form (hidden by default) -->
                <div id="nt-asset-transfer-form" class="nt-card" style="display:none;margin-bottom:12px;padding:16px">
                    <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:10px">
                        <i class="fa-solid fa-paper-plane" style="color:#6366f1;margin-right:4px"></i>Transfer Asset
                    </div>
                    <div style="font-size:12px;color:var(--nt-text-2);margin-bottom:12px">
                        Transfer ownership. This creates a permanent on-chain record.
                    </div>
                    <input id="nt-asset-transfer-addr" type="text" placeholder="New owner address (0x...)"
                        style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;font-family:monospace;outline:none;box-sizing:border-box;margin-bottom:8px;transition:border-color var(--nt-transition)"
                        onfocus="this.style.borderColor='rgba(99,102,241,0.5)'" onblur="this.style.borderColor='var(--nt-border)'">
                    <input id="nt-asset-transfer-value" type="text" placeholder="Declared value in BNB (optional)"
                        style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;outline:none;box-sizing:border-box;margin-bottom:8px;transition:border-color var(--nt-transition)"
                        onfocus="this.style.borderColor='rgba(99,102,241,0.5)'" onblur="this.style.borderColor='var(--nt-border)'">
                    <input id="nt-asset-transfer-note" type="text" placeholder="Transfer note (optional)"
                        style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;outline:none;box-sizing:border-box;margin-bottom:10px;transition:border-color var(--nt-transition)"
                        onfocus="this.style.borderColor='rgba(99,102,241,0.5)'" onblur="this.style.borderColor='var(--nt-border)'">
                    <div style="display:flex;gap:8px">
                        <button id="nt-btn-transfer-asset" class="nt-btn-primary" style="flex:1;padding:12px;font-size:13px;background:linear-gradient(135deg,#3b82f6,#6366f1);display:flex;align-items:center;justify-content:center;gap:6px" onclick="NotaryPage.handleTransferAsset()">
                            <i class="fa-solid fa-paper-plane"></i>Transfer
                        </button>
                        <button class="nt-btn-secondary" style="padding:12px 16px;font-size:13px" onclick="NotaryPage.toggleAssetTransferForm()">Cancel</button>
                    </div>
                </div>

                <!-- Annotation Form (hidden by default) -->
                <div id="nt-annotation-form" class="nt-card" style="display:none;margin-bottom:12px;padding:16px">
                    <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:10px">
                        <i class="fa-solid fa-note-sticky" style="color:var(--nt-accent);margin-right:4px"></i>Add Annotation
                    </div>
                    <select id="nt-annotation-type" style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;outline:none;box-sizing:border-box;margin-bottom:8px">
                        ${Li.map(v=>`<option value="${v.id}" style="background:var(--nt-bg)">${v.name}</option>`).join("")}
                    </select>
                    <textarea id="nt-annotation-meta" placeholder="Details about this annotation..."
                        style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;outline:none;box-sizing:border-box;resize:vertical;min-height:60px;font-family:inherit;margin-bottom:10px;transition:border-color var(--nt-transition)"
                        onfocus="this.style.borderColor='rgba(245,158,11,0.5)'" onblur="this.style.borderColor='var(--nt-border)'"></textarea>
                    <div style="display:flex;gap:8px">
                        <button id="nt-btn-add-annotation" class="nt-btn-primary" style="flex:1;padding:12px;font-size:13px;display:flex;align-items:center;justify-content:center;gap:6px" onclick="NotaryPage.handleAddAnnotation()">
                            <i class="fa-solid fa-plus"></i>Add Annotation
                        </button>
                        <button class="nt-btn-secondary" style="padding:12px 16px;font-size:13px" onclick="NotaryPage.toggleAnnotationForm()">Cancel</button>
                    </div>
                </div>
            `:""}

            <!-- Annotations List -->
            <div class="nt-card" style="margin-bottom:12px;padding:0;overflow:hidden">
                <div style="padding:14px 16px;border-bottom:1px solid var(--nt-border);display:flex;align-items:center;justify-content:space-between">
                    <div style="font-size:13px;font-weight:700;color:var(--nt-text)">
                        <i class="fa-solid fa-note-sticky" style="color:var(--nt-accent);margin-right:6px"></i>Annotations
                    </div>
                    <span style="font-size:11px;color:var(--nt-text-3)">${o.length} total</span>
                </div>
                ${o.length===0?`
                    <div style="text-align:center;padding:24px;color:var(--nt-text-3);font-size:12px">
                        No annotations yet
                    </div>
                `:o.map(v=>{const T=Zv(v.annotationType);return`
                        <div style="padding:12px 16px;border-bottom:1px solid var(--nt-border);display:flex;align-items:flex-start;gap:10px">
                            <div style="width:32px;height:32px;border-radius:50%;background:rgba(${Vy(T.color)},0.12);display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px">
                                <i class="${T.icon}" style="font-size:13px;color:${T.color}"></i>
                            </div>
                            <div style="flex:1;min-width:0">
                                <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px">
                                    <span style="font-size:12px;font-weight:600;color:${T.color}">${T.name}</span>
                                    <span style="font-size:10px;color:var(--nt-text-3)">${ro(v.timestamp)||""}</span>
                                </div>
                                ${v.meta?`<div style="font-size:12px;color:var(--nt-text-2);line-height:1.4">${v.meta}</div>`:""}
                                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);margin-top:4px">${Ws(v.author)}</div>
                            </div>
                        </div>
                    `}).join("")}
            </div>

            <!-- Actions -->
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                ${s?`
                    <a href="${s}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-eye"></i>View Document
                    </a>
                `:""}
                <a href="${Dn}${E==null?void 0:E.notary}?a=${t.id}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>View on Explorer
                </a>
                <button class="nt-btn-secondary" style="font-size:12px;display:inline-flex;align-items:center;gap:6px" onclick="NotaryPage.addToWallet('${t.id}')">
                    <i class="fa-solid fa-wallet"></i>Add to Wallet
                </button>
            </div>
        </div>
    `}function Vy(e){if(!e)return"128,128,128";e=e.replace("#","");const t=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return`${t},${a},${n}`}const va=window.ethers;function Yy(e){if(!u.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to notarize documents on the blockchain</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}e.innerHTML=`
        <div class="nt-card" style="margin-top:16px">
            ${qy()}
            <div id="nt-wiz-panel"></div>
        </div>
    `;const t=document.getElementById("nt-wiz-panel");if(t)switch(b.wizStep){case 1:Xy(t);break;case 2:Fg(t);break;case 3:Jy(t);break}}function qy(){const e=b.wizStep;return`
        <div class="nt-steps">
            <div class="nt-step-dot ${e>1?"done":e===1?"active":"pending"}">${e>1?'<i class="fa-solid fa-check" style="font-size:12px"></i>':"1"}</div>
            <div class="nt-step-line ${e>1?"done":""}"></div>
            <div class="nt-step-dot ${e>2?"done":e===2?"active":"pending"}">${e>2?'<i class="fa-solid fa-check" style="font-size:12px"></i>':"2"}</div>
            <div class="nt-step-line ${e>2?"done":e===2?"active":""}"></div>
            <div class="nt-step-dot ${e===3?"active":"pending"}">3</div>
        </div>
    `}function Xy(e){if(b.wizFile&&b.wizFileHash){const t=b.wizFile,a=Ya(t.type,t.name),n=b.wizDuplicateCheck;e.innerHTML=`
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">File Selected</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">SHA-256 hash computed in your browser</div>
            </div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:14px">
                    <div style="width:48px;height:48px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="${a.icon}" style="font-size:20px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t.name}</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">${Qr(t.size)} &bull; ${a.label}</div>
                    </div>
                    <button class="nt-btn-icon" onclick="NotaryPage.wizRemoveFile()" title="Remove">
                        <i class="fa-solid fa-xmark" style="color:var(--nt-red)"></i>
                    </button>
                </div>
            </div>

            <div style="margin-bottom:16px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">
                    <i class="fa-solid fa-fingerprint" style="margin-right:4px;color:var(--nt-accent)"></i>SHA-256 Hash
                </div>
                <div class="nt-hash-display" onclick="NotaryPage.copyHash('${b.wizFileHash}')" title="Click to copy">
                    ${b.wizFileHash}
                    <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                </div>
            </div>

            ${n===null?`
                <div style="text-align:center;padding:12px;color:var(--nt-text-3);font-size:12px">
                    <i class="fa-solid fa-spinner fa-spin" style="margin-right:6px;color:var(--nt-accent)"></i>Checking for duplicates...
                </div>
            `:n!=null&&n.exists?`
                <div class="nt-duplicate-warn" style="margin-bottom:16px">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <i class="fa-solid fa-triangle-exclamation" style="color:#fbbf24;font-size:16px"></i>
                        <span style="font-size:13px;font-weight:700;color:#fbbf24">Document already notarized!</span>
                    </div>
                    <div style="font-size:12px;color:var(--nt-text-2);line-height:1.5">
                        This hash already exists on the blockchain.<br>
                        Token ID: <strong style="color:var(--nt-accent)">#${n.tokenId}</strong><br>
                        Owner: <span style="font-family:monospace;font-size:11px">${Ws(n.owner)}</span><br>
                        Date: ${ro(n.timestamp)}
                    </div>
                </div>
            `:`
                <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:var(--nt-radius);padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:8px">
                    <i class="fa-solid fa-circle-check" style="color:var(--nt-green)"></i>
                    <span style="font-size:12px;color:var(--nt-green);font-weight:600">Unique hash â€” ready to certify</span>
                </div>
            `}

            <div style="display:flex;gap:10px;margin-top:8px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizRemoveFile()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Change File
                </button>
                <button class="nt-btn-primary" style="flex:2" ${n!=null&&n.exists?"disabled":""} onclick="NotaryPage.wizNext()">
                    Continue<i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        `;return}if(b.wizIsHashing){e.innerHTML=`
            <div style="text-align:center;padding:40px 20px">
                <div style="width:56px;height:56px;border-radius:50%;background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-fingerprint fa-spin" style="font-size:24px;color:var(--nt-accent)"></i>
                </div>
                <div style="font-size:14px;font-weight:600;color:var(--nt-text)">Computing SHA-256...</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:6px">Hash being computed locally in your browser</div>
            </div>
        `;return}e.innerHTML=`
        <div style="text-align:center;margin-bottom:20px">
            <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Upload Document</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">Select a file to certify permanently on the blockchain</div>
        </div>

        <div class="nt-dropzone" id="nt-wiz-dropzone">
            <input type="file" id="nt-wiz-file-input" style="display:none">
            <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:14px">
                <i class="fa-solid fa-cloud-arrow-up" style="font-size:24px;color:var(--nt-accent)"></i>
            </div>
            <div style="font-size:14px;font-weight:600;color:var(--nt-text);margin-bottom:4px">Click or drag file here</div>
            <div style="font-size:11px;color:var(--nt-text-3)">Max 5MB &bull; Any format</div>
        </div>

        <div style="display:flex;align-items:center;justify-content:center;gap:20px;margin-top:16px;font-size:11px;color:var(--nt-text-3)">
            <span><i class="fa-solid fa-shield-halved" style="color:var(--nt-green);margin-right:4px"></i>Local hash</span>
            <span><i class="fa-solid fa-database" style="color:var(--nt-blue);margin-right:4px"></i>Arweave</span>
            <span><i class="fa-solid fa-infinity" style="color:var(--nt-accent);margin-right:4px"></i>Permanent</span>
        </div>
    `,Zy()}function Fg(e){var f;const t=b.wizFile,a=Ya((t==null?void 0:t.type)||"",(t==null?void 0:t.name)||""),n=b.feesLoaded?va?va.formatEther(b.ethFee):"0.0001":"...",o=b.wizUploadCost?b.wizUploadCost.costFormatted:"...",s=u.currentUserNativeBalance||0n,i=(b.ethFee||0n)+(((f=b.wizUploadCost)==null?void 0:f.cost)||0n)+((va==null?void 0:va.parseEther("0.001"))||0n),r=b.feesLoaded?s>=i:!0,l=r,d=["General","Contract","Identity","Diploma","Property","Financial","Legal","Medical","IP","Other"].map((g,m)=>`<option value="${m}" ${b.wizDocType===m?"selected":""}>${g}</option>`).join("");e.innerHTML=`
        <div style="max-width:420px;margin:0 auto">
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Details & Fees</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">Describe your document and review the fees</div>
            </div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:12px">
                <div style="width:40px;height:40px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                    <i class="${a.icon}" style="font-size:16px;color:${a.color}"></i>
                </div>
                <div style="flex:1;min-width:0">
                    <div style="font-size:12px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${(t==null?void 0:t.name)||"File"}</div>
                    <div style="font-size:10px;color:var(--nt-text-3)">${Qr((t==null?void 0:t.size)||0)}</div>
                </div>
            </div>

            <div style="margin-bottom:16px">
                <label style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;display:block;margin-bottom:6px">
                    Document Type
                </label>
                <select id="nt-wiz-doctype"
                    style="width:100%;background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius-sm);padding:10px 12px;font-size:13px;color:var(--nt-text);outline:none;font-family:inherit;cursor:pointer"
                    onchange="NotaryPage.onDocTypeChange(this.value)">
                    ${d}
                </select>
            </div>

            <div style="margin-bottom:16px">
                <label style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;display:block;margin-bottom:6px">
                    Description <span style="font-weight:400;text-transform:none">(optional)</span>
                </label>
                <textarea id="nt-wiz-desc" rows="3"
                    style="width:100%;background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius-sm);padding:12px;font-size:13px;color:var(--nt-text);resize:none;outline:none;font-family:inherit;transition:border-color var(--nt-transition)"
                    onfocus="this.style.borderColor='rgba(245,158,11,0.4)'"
                    onblur="this.style.borderColor='var(--nt-border)'"
                    placeholder="E.g., Property deed signed Jan 2025...">${b.wizDescription}</textarea>
            </div>

            <div class="nt-fee-box" style="margin-bottom:16px">
                <div style="font-size:11px;font-weight:700;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">
                    <i class="fa-solid fa-coins" style="color:var(--nt-accent);margin-right:4px"></i>Fees
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">Arweave Storage</span>
                    <span style="font-size:14px;font-weight:700;color:#22d3ee;font-family:monospace">${o}</span>
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">Certification Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-blue);font-family:monospace">${n} BNB</span>
                </div>
                <div style="font-size:10px;color:var(--nt-text-3);margin-top:6px;font-style:italic">
                    <i class="fa-solid fa-infinity" style="margin-right:4px"></i>Arweave = permanent, decentralized storage
                </div>
                ${r?"":'<div style="font-size:11px;color:var(--nt-red);margin-top:8px"><i class="fa-solid fa-circle-xmark" style="margin-right:4px"></i>Insufficient BNB for fees + gas</div>'}
            </div>

            <div style="display:flex;gap:10px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2" ${l?"":"disabled"} onclick="NotaryPage.wizToStep3()">
                    Review<i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        </div>
    `}function Jy(e){const t=b.wizFile,a=Ya((t==null?void 0:t.type)||"",(t==null?void 0:t.name)||""),n=b.wizDescription||"No description",o=["General","Contract","Identity","Diploma","Property","Financial","Legal","Medical","IP","Other"],s=va?va.formatEther(b.ethFee):"0.0001",i=b.wizUploadCost?b.wizUploadCost.costFormatted:"~0 BNB";e.innerHTML=`
        <div style="max-width:420px;margin:0 auto;text-align:center">
            <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:4px">Confirm & Mint</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-bottom:20px">Review and sign to create your certificate</div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;text-align:left;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:12px;padding-bottom:12px;border-bottom:1px solid var(--nt-border);margin-bottom:12px">
                    <div style="width:44px;height:44px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="${a.icon}" style="font-size:18px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t==null?void 0:t.name}</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">${Qr((t==null?void 0:t.size)||0)} &middot; ${o[b.wizDocType]||"General"}</div>
                    </div>
                </div>
                <div style="font-size:12px;color:var(--nt-text-2);font-style:italic">"${n}"</div>
                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);margin-top:8px;word-break:break-all">
                    <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>${b.wizFileHash}
                </div>
            </div>

            <div class="nt-fee-box" style="margin-bottom:20px">
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">Arweave Storage</span>
                    <span style="font-size:14px;font-weight:700;color:#22d3ee;font-family:monospace">${i}</span>
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">Certification Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-blue);font-family:monospace">${s} BNB</span>
                </div>
            </div>

            <div style="display:flex;gap:10px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2" id="nt-btn-mint" onclick="NotaryPage.handleMint()">
                    <i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint
                </button>
            </div>
        </div>
    `}function Zy(){const e=document.getElementById("nt-wiz-dropzone"),t=document.getElementById("nt-wiz-file-input");!e||!t||(e.onclick=()=>t.click(),["dragenter","dragover","dragleave","drop"].forEach(a=>{e.addEventListener(a,n=>{n.preventDefault(),n.stopPropagation()})}),e.addEventListener("dragenter",()=>e.classList.add("drag-over")),e.addEventListener("dragover",()=>e.classList.add("drag-over")),e.addEventListener("dragleave",()=>e.classList.remove("drag-over")),e.addEventListener("drop",a=>{var n,o;e.classList.remove("drag-over"),yc((o=(n=a.dataTransfer)==null?void 0:n.files)==null?void 0:o[0])}),t.addEventListener("change",a=>{var n;return yc((n=a.target.files)==null?void 0:n[0])}))}async function yc(e){if(e){if(e.size>qv){x("File too large (max 5MB)","error");return}b.wizFile=e,b.wizFileHash=null,b.wizDuplicateCheck=null,b.wizIsHashing=!0,b._render();try{const t=await ce.calculateFileHash(e);b.wizFileHash=t,b.wizIsHashing=!1,b._render(),b.wizDuplicateCheck=null,b._render();const a=await ce.verifyByHash(t);b.wizDuplicateCheck=a,b._render()}catch(t){console.error("[NotaryPage] Hash error:",t),b.wizIsHashing=!1,b.wizFile=null,x("Error computing file hash","error"),b._render()}}}function Qy(e){e.innerHTML=`
        <div class="nt-card" style="margin-top:16px">
            <div style="text-align:center;margin-bottom:20px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-shield-check" style="font-size:22px;color:var(--nt-green)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Public Verification</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px;max-width:380px;margin-left:auto;margin-right:auto">
                    Verify if a document was notarized on the blockchain. <strong style="color:var(--nt-green)">No wallet needed.</strong>
                </div>
            </div>

            <div class="nt-dropzone" id="nt-verify-dropzone" style="margin-bottom:16px">
                <input type="file" id="nt-verify-file-input" style="display:none">
                <div style="width:48px;height:48px;border-radius:var(--nt-radius);background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-magnifying-glass" style="font-size:20px;color:var(--nt-green)"></i>
                </div>
                <div style="font-size:14px;font-weight:600;color:var(--nt-text);margin-bottom:4px">Drag a file to verify</div>
                <div style="font-size:11px;color:var(--nt-text-3)">The SHA-256 hash will be computed locally</div>
            </div>

            <div id="nt-verify-result"></div>
        </div>
    `,ew(),b.verifyResult&&Dg()}function ew(){const e=document.getElementById("nt-verify-dropzone"),t=document.getElementById("nt-verify-file-input");!e||!t||(e.onclick=()=>t.click(),["dragenter","dragover","dragleave","drop"].forEach(a=>{e.addEventListener(a,n=>{n.preventDefault(),n.stopPropagation()})}),e.addEventListener("dragenter",()=>e.classList.add("drag-over")),e.addEventListener("dragover",()=>e.classList.add("drag-over")),e.addEventListener("dragleave",()=>e.classList.remove("drag-over")),e.addEventListener("drop",a=>{var n,o;e.classList.remove("drag-over"),wc((o=(n=a.dataTransfer)==null?void 0:n.files)==null?void 0:o[0])}),t.addEventListener("change",a=>{var n;return wc((n=a.target.files)==null?void 0:n[0])}))}async function wc(e){if(!e)return;b.verifyFile=e,b.verifyHash=null,b.verifyResult=null,b.verifyIsChecking=!0;const t=document.getElementById("nt-verify-result");t&&(t.innerHTML=`
            <div style="text-align:center;padding:20px;color:var(--nt-text-3);font-size:13px">
                <i class="fa-solid fa-spinner fa-spin" style="margin-right:6px;color:var(--nt-accent)"></i>Computing hash and verifying...
            </div>
        `);try{const a=await ce.calculateFileHash(e);b.verifyHash=a;const n=await ce.verifyByHash(a);b.verifyResult=n,b.verifyIsChecking=!1,Dg()}catch(a){console.error("[NotaryPage] Verify error:",a),b.verifyIsChecking=!1,t&&(t.innerHTML=`
                <div class="nt-not-found" style="text-align:center">
                    <i class="fa-solid fa-circle-xmark" style="font-size:20px;color:var(--nt-red);margin-bottom:8px"></i>
                    <div style="font-size:13px;color:var(--nt-red)">Verification error: ${a.message}</div>
                </div>
            `)}}function Dg(){const e=document.getElementById("nt-verify-result");if(!e||!b.verifyResult)return;const t=b.verifyResult,a=b.verifyFile;t.exists?e.innerHTML=`
            <div class="nt-verified">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
                    <div style="width:40px;height:40px;border-radius:50%;background:rgba(34,197,94,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="fa-solid fa-shield-check" style="font-size:18px;color:var(--nt-green)"></i>
                    </div>
                    <div>
                        <div style="font-size:15px;font-weight:700;color:var(--nt-green)">Document Verified!</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">This document was notarized on the blockchain</div>
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Token ID</div>
                        <div style="font-size:16px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.tokenId}</div>
                    </div>
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Data</div>
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${ro(t.timestamp)}</div>
                    </div>
                </div>

                <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px;margin-bottom:12px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Owner</div>
                    <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${t.owner}</div>
                </div>

                ${b.verifyHash?`
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">SHA-256 Hash</div>
                        <div style="font-size:10px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${b.verifyHash}</div>
                    </div>
                `:""}

                <div style="margin-top:12px;display:flex;gap:8px">
                    <a href="${Dn}${E==null?void 0:E.notary}?a=${t.tokenId}" target="_blank" class="nt-btn-secondary" style="font-size:12px;padding:8px 14px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i>View on Explorer
                    </a>
                </div>
            </div>
        `:e.innerHTML=`
            <div class="nt-not-found">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
                    <div style="width:40px;height:40px;border-radius:50%;background:rgba(239,68,68,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="fa-solid fa-circle-xmark" style="font-size:18px;color:var(--nt-red)"></i>
                    </div>
                    <div>
                        <div style="font-size:15px;font-weight:700;color:var(--nt-red)">Not Found</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">This document was not notarized on the blockchain</div>
                    </div>
                </div>

                ${a?`<div style="font-size:12px;color:var(--nt-text-3);margin-bottom:8px">File: <strong style="color:var(--nt-text-2)">${a.name}</strong></div>`:""}
                ${b.verifyHash?`
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">SHA-256 Hash</div>
                        <div style="font-size:10px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${b.verifyHash}</div>
                    </div>
                `:""}
            </div>
        `}function tw(e){if(b.statsLoading&&!b.stats){e.innerHTML=`
            <div class="nt-stat-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>'<div class="nt-stat-card"><div class="nt-shimmer" style="height:32px;width:60%;margin:0 auto 8px"></div><div class="nt-shimmer" style="height:12px;width:40%;margin:0 auto"></div></div>').join("")}
            </div>
        `;return}const t=b.stats;b.totalSupply,e.innerHTML=`
        <div style="margin-top:16px">
            <div class="nt-stat-grid">
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-stamp" style="font-size:16px;color:var(--nt-accent)"></i>
                    </div>
                    <div class="nt-stat-value">${(t==null?void 0:t.totalCertifications)??(t==null?void 0:t.totalNotarizations)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Notarizations</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-right-left" style="font-size:16px;color:var(--nt-green)"></i>
                    </div>
                    <div class="nt-stat-value">${(t==null?void 0:t.totalTransfers)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Transfers</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(245,158,11,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-house" style="font-size:16px;color:var(--nt-accent)"></i>
                    </div>
                    <div class="nt-stat-value">${(t==null?void 0:t.totalAssets)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Assets</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(96,165,250,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-note-sticky" style="font-size:16px;color:var(--nt-blue)"></i>
                    </div>
                    <div class="nt-stat-value">${(t==null?void 0:t.totalAnnotations)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Annotations</div>
                </div>
            </div>

            <!-- Recent notarizations -->
            <div class="nt-card" style="margin-top:16px;padding:0;overflow:hidden">
                <div style="padding:16px 20px;border-bottom:1px solid var(--nt-border)">
                    <div style="font-size:13px;font-weight:700;color:var(--nt-text)">
                        <i class="fa-solid fa-clock-rotate-left" style="color:var(--nt-accent);margin-right:6px"></i>Recent Notarizations
                    </div>
                </div>
                <div id="nt-recent-feed">
                    ${b.recentNotarizations.length===0?`
                        <div style="text-align:center;padding:32px 20px;color:var(--nt-text-3);font-size:13px">
                            ${b.statsLoading?'<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Loading...':"No recent notarizations found"}
                        </div>
                    `:b.recentNotarizations.map(a=>`
                        <div class="nt-recent-item">
                            <div style="width:36px;height:36px;border-radius:50%;background:var(--nt-accent-glow);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                                <i class="fa-solid fa-stamp" style="font-size:14px;color:var(--nt-accent)"></i>
                            </div>
                            <div style="flex:1;min-width:0">
                                <div style="font-size:12px;font-weight:600;color:var(--nt-text)">Certificate #${a.tokenId}</div>
                                <div style="font-size:11px;color:var(--nt-text-3)">${Ws(a.owner)}</div>
                            </div>
                            <div style="text-align:right;flex-shrink:0">
                                <div style="font-size:11px;color:var(--nt-text-3)">${Zr(a.timestamp)}</div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>

            <div style="text-align:center;margin-top:16px">
                <a href="${Dn}${E==null?void 0:E.notary}" target="_blank" class="nt-btn-secondary" style="font-size:12px;padding:10px 20px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>View Contract on Explorer
                </a>
            </div>
        </div>
    `}function aw(e){const t=b.selectedCert;if(!t){b.view="documents",b.activeTab="documents",b._render(),b._renderHeader();return}const a=Mn(t.ipfs),n=Ya(t.mimeType||"",t.description||""),o=t.owner&&u.userAddress&&t.owner.toLowerCase()===u.userAddress.toLowerCase(),s=t.received===!0;e.innerHTML=`
        <div class="nt-detail" style="margin-top:8px">
            <!-- Image Preview (clickable â†’ NFT card overlay) -->
            <div onclick="NotaryPage.showCertCard()" style="display:block;margin-bottom:16px;cursor:pointer">
                <div style="min-height:240px;max-height:400px;background:var(--nt-bg3);border-radius:var(--nt-radius);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid var(--nt-border);transition:border-color var(--nt-transition)" onmouseover="this.style.borderColor='rgba(245,158,11,0.3)'" onmouseout="this.style.borderColor='var(--nt-border)'">
                    ${a?`
                        <img src="${a}" style="width:100%;height:100%;object-fit:contain;max-height:400px" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="Certificate #${t.id}">
                        <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:240px;position:absolute;inset:0;background:var(--nt-bg3)">
                            <i class="${n.icon}" style="font-size:48px;color:${n.color};margin-bottom:8px"></i>
                            <span style="font-size:12px;color:var(--nt-text-3)">${n.label} file</span>
                        </div>
                    `:`
                        <div style="text-align:center">
                            <i class="${n.icon}" style="font-size:48px;color:${n.color};margin-bottom:8px"></i>
                            <div style="font-size:12px;color:var(--nt-text-3)">${n.label} file</div>
                        </div>
                    `}
                    <div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.id}</div>
                    ${s?`
                        <div style="position:absolute;top:12px;left:12px;background:rgba(99,102,241,0.9);padding:4px 10px;border-radius:20px;font-size:10px;font-weight:600;color:#fff;display:flex;align-items:center;gap:4px">
                            <i class="fa-solid fa-inbox"></i>Received
                        </div>
                    `:""}
                    <div style="position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,0.75);padding:4px 10px;border-radius:8px;font-size:10px;color:var(--nt-text-2)">
                        <i class="fa-solid fa-id-card" style="margin-right:4px"></i>Tap to view NFT card
                    </div>
                </div>
            </div>

            <!-- Primary Actions -->
            <div style="display:flex;gap:8px;margin-bottom:16px">
                <button class="nt-btn-primary" style="flex:1;padding:14px;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px" onclick="NotaryPage.addToWallet('${t.id}')">
                    <i class="fa-solid fa-wallet"></i>Add to Wallet
                </button>
                ${o?`
                    <button class="nt-btn-primary" style="flex:1;padding:14px;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;background:linear-gradient(135deg,#3b82f6,#6366f1)" onclick="NotaryPage.toggleTransferForm()">
                        <i class="fa-solid fa-paper-plane"></i>Transfer
                    </button>
                `:""}
            </div>

            <!-- Transfer Form (hidden by default) -->
            ${o?`
                <div id="nt-transfer-form" class="nt-card" style="display:none;margin-bottom:12px;padding:16px">
                    <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:10px">
                        <i class="fa-solid fa-paper-plane" style="color:#6366f1;margin-right:4px"></i>Transfer Certificate
                    </div>
                    <div style="font-size:12px;color:var(--nt-text-2);margin-bottom:12px">
                        Transfer ownership of this certificate to another wallet. This action is permanent and requires a small fee.
                    </div>
                    <input id="nt-transfer-addr" type="text" placeholder="Recipient address (0x...)"
                        style="width:100%;padding:12px 14px;background:var(--nt-bg);border:1px solid var(--nt-border);border-radius:10px;color:var(--nt-text);font-size:13px;font-family:monospace;outline:none;box-sizing:border-box;margin-bottom:10px;transition:border-color var(--nt-transition)"
                        onfocus="this.style.borderColor='rgba(99,102,241,0.5)'" onblur="this.style.borderColor='var(--nt-border)'"
                    >
                    <div style="display:flex;gap:8px">
                        <button id="nt-btn-transfer" class="nt-btn-primary" style="flex:1;padding:12px;font-size:13px;background:linear-gradient(135deg,#3b82f6,#6366f1);display:flex;align-items:center;justify-content:center;gap:6px" onclick="NotaryPage.handleTransfer()">
                            <i class="fa-solid fa-paper-plane"></i>Transfer
                        </button>
                        <button class="nt-btn-secondary" style="padding:12px 16px;font-size:13px" onclick="NotaryPage.toggleTransferForm()">Cancel</button>
                    </div>
                </div>
            `:""}

            <!-- Description -->
            <div class="nt-card" style="margin-bottom:12px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">Description</div>
                <div style="font-size:14px;color:var(--nt-text);line-height:1.5">${t.description||"Notarized Document"}</div>
                ${t.fileName?`<div style="font-size:12px;color:var(--nt-text-2);margin-top:6px"><i class="${n.icon}" style="margin-right:4px;color:${n.color}"></i>${t.fileName}</div>`:""}
            </div>

            <!-- Content Hash -->
            <div class="nt-card" style="margin-bottom:12px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">
                    <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>Content Hash (SHA-256)
                </div>
                <div class="nt-hash-display" onclick="NotaryPage.copyHash('${t.hash}')" title="Click to copy">
                    ${t.hash||"N/A"}
                    <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                </div>
            </div>

            <!-- Metadata grid -->
            <div class="nt-detail-meta" style="margin-bottom:12px">
                <div class="nt-card" style="padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Date</div>
                    <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${ro(t.timestamp)||"N/A"}</div>
                </div>
                <div class="nt-card" style="padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Owner</div>
                    <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2)">${Ws(t.owner||u.userAddress)}</div>
                </div>
            </div>

            ${t.ipfs?`
                <div class="nt-card" style="margin-bottom:12px;padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Storage URI</div>
                    <div style="font-size:11px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${t.ipfs}</div>
                </div>
            `:""}

            <!-- Secondary Actions -->
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                ${a?`
                    <a href="${a}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-eye"></i>View Original
                    </a>
                `:""}
                <a href="${Dn}${E==null?void 0:E.notary}?a=${t.id}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>Explorer
                </a>
                ${t.txHash?`
                    <a href="${Xv}${t.txHash}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-receipt"></i>Transaction
                    </a>
                `:""}
            </div>
        </div>
    `}function el(){var t,a;const e=document.getElementById("nt-header");if(e){if(b.view==="cert-detail"){e.innerHTML=`
            <div class="nt-back-header">
                <button class="nt-back-btn" onclick="NotaryPage.goBack()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div>
                    <div style="font-size:15px;font-weight:700;color:var(--nt-text)">Certificate #${((t=b.selectedCert)==null?void 0:t.id)||""}</div>
                    <div style="font-size:11px;color:var(--nt-text-3)">Document details</div>
                </div>
            </div>
        `;return}if(b.view==="asset-detail"){e.innerHTML=`
            <div class="nt-back-header">
                <button class="nt-back-btn" onclick="NotaryPage.goBack()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div>
                    <div style="font-size:15px;font-weight:700;color:var(--nt-text)">Asset #${((a=b.selectedAsset)==null?void 0:a.id)||""}</div>
                    <div style="font-size:11px;color:var(--nt-text-3)">Property details</div>
                </div>
            </div>
        `;return}if(b.view==="register-asset"){e.innerHTML=`
            <div class="nt-back-header">
                <button class="nt-back-btn" onclick="NotaryPage.goBack()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div>
                    <div style="font-size:15px;font-weight:700;color:var(--nt-text)">Register Asset</div>
                    <div style="font-size:11px;color:var(--nt-text-3)">On-chain property registration</div>
                </div>
            </div>
        `;return}e.innerHTML=`
        <div class="nt-header-bar">
            <div class="nt-brand">
                <div class="nt-brand-icon"><i class="fa-solid fa-stamp"></i></div>
                <div>
                    <div class="nt-brand-name">Digital Notary</div>
                    <div class="nt-brand-sub">Blockchain registry &amp; certification</div>
                </div>
            </div>
        </div>
        <nav class="nt-nav">
            <button class="nt-nav-item ${b.activeTab==="documents"?"active":""}" onclick="NotaryPage.setTab('documents')">
                <i class="fa-solid fa-certificate"></i><span>Documents</span>
            </button>
            <button class="nt-nav-item ${b.activeTab==="assets"?"active":""}" onclick="NotaryPage.setTab('assets')">
                <i class="fa-solid fa-house"></i><span>Assets</span>
            </button>
            <button class="nt-nav-item ${b.activeTab==="verify"?"active":""}" onclick="NotaryPage.setTab('verify')">
                <i class="fa-solid fa-shield-check"></i><span>Verify</span>
            </button>
            <button class="nt-nav-item ${b.activeTab==="stats"?"active":""}" onclick="NotaryPage.setTab('stats')">
                <i class="fa-solid fa-chart-simple"></i><span>Stats</span>
            </button>
        </nav>
    `}}function tl(){const e=document.getElementById("nt-content");if(e)switch(b.view){case"documents":hc(e);break;case"notarize":Yy(e);break;case"assets":My(e);break;case"register-asset":Uy(e);break;case"asset-detail":Ky(e);break;case"verify":Qy(e);break;case"stats":tw(e);break;case"cert-detail":aw(e);break;default:hc(e)}}b._render=tl;b._renderHeader=el;function nw(e){const t=document.getElementById("notary");t&&(Jv(),t.innerHTML=`
        <div class="nt-shell">
            <div class="nt-header" id="nt-header"></div>
            <div id="nt-content"></div>
            <div id="nt-overlay" class="nt-overlay"></div>
        </div>
    `,el(),tl(),Promise.all([Sg(),Gs(),Ks(),ay()]).catch(()=>{}))}const Mg={async render(e){e&&nw()},reset(){b.wizFile=null,b.wizFileHash=null,b.wizDescription="",b.wizDuplicateCheck=null,b.wizStep=1,b.view="documents",b.activeTab="documents",b.viewHistory=[],tl(),el()},update(){if(!b.isProcessing&&b.view==="notarize"){const e=document.getElementById("nt-wiz-panel");e&&b.wizStep===2&&Fg(e)}},refreshHistory(){Gs()},setTab:iy,goBack:sy,viewCert:ry,viewAsset:ly,wizNext:cy,wizBack:dy,wizToStep3:uy,wizRemoveFile:py,onDocTypeChange:fy,handleMint:Ay,assetWizNext:gy,assetWizBack:my,assetWizReset:Rg,assetWizToStep3:vy,assetWizSkipDoc:yy,assetWizToReview:wy,onAssetTypeChange:by,onAssetDescChange:xy,onAssetMetaChange:hy,onAssetFileSelect:ky,removeAssetFile:Ey,handleRegisterAsset:Iy,handleTransferAsset:Py,handleAddAnnotation:Ny,toggleAssetTransferForm:Ty,toggleAnnotationForm:Cy,refreshAssets:By,viewDocument:Sy,toggleTransferForm:Ly,handleTransfer:_y,showCertCard:zy,hideNftCard:$y,addToWallet:Ry,copyHash:Fy};window.NotaryPage=Mg;const al=window.ethers,_i={Diamond:{emoji:"ðŸ’Ž",color:"#22d3ee",bg:"rgba(34,211,238,0.15)",border:"rgba(34,211,238,0.3)",keepRate:100,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq"},Gold:{emoji:"ðŸ¥‡",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",border:"rgba(251,191,36,0.3)",keepRate:90,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44"},Silver:{emoji:"ðŸ¥ˆ",color:"#9ca3af",bg:"rgba(156,163,175,0.15)",border:"rgba(156,163,175,0.3)",keepRate:80,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4"},Bronze:{emoji:"ðŸ¥‰",color:"#fb923c",bg:"rgba(251,146,60,0.15)",border:"rgba(251,146,60,0.3)",keepRate:70,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m"}},_={activeTab:"marketplace",filterTier:"ALL",sortBy:"boosted",selectedListing:null,isLoading:!1,isTransactionPending:!1,countdownIntervals:[],pendingEarningsAmount:0n,marketStats:null},Lt=e=>e==null?"":String(e),Og=(e,t)=>Lt(e)===Lt(t),lo=(e,t)=>e&&t&&e.toLowerCase()===t.toLowerCase();function On(e){return st.find(t=>t.boostBips===Number(e))||{name:"Unknown",boostBips:0}}function yo(e){return _i[e]||{emoji:"ðŸ’Ž",color:"#71717a",bg:"rgba(113,113,122,0.15)",border:"rgba(113,113,122,0.3)",keepRate:50}}function It(e){if(!e)return"0";const t=parseFloat(al.formatEther(BigInt(e)));return t===0?"0":t<1e-4?"<0.0001":t<.01?t.toFixed(4):t<1?t.toFixed(3):t.toFixed(2)}function Ug(e){const t=e-Math.floor(Date.now()/1e3);if(t<=0)return{text:"Expired",expired:!0,seconds:0};const a=Math.floor(t/3600),n=Math.floor(t%3600/60),o=t%60;return a>0?{text:`${a}h ${n}m`,expired:!1,seconds:t}:n>0?{text:`${n}m ${o}s`,expired:!1,seconds:t}:{text:`${o}s`,expired:!1,seconds:t}}function ow(){if(document.getElementById("boost-market-styles"))return;const e=document.createElement("style");e.id="boost-market-styles",e.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V9.0 Boost Market Styles
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        @keyframes bm-float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }
        @keyframes bm-card-in {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes bm-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .bm-float { animation: bm-float 4s ease-in-out infinite; }

        /* Main Cards */
        .bm-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        /* NFT Cards */
        .bm-nft-card {
            background: linear-gradient(165deg, rgba(24,24,27,0.98) 0%, rgba(15,15,17,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 20px;
            overflow: hidden;
            animation: bm-card-in 0.5s ease-out forwards;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bm-nft-card:hover {
            transform: translateY(-6px);
            border-color: rgba(34,197,94,0.4);
            box-shadow: 0 25px 50px -15px rgba(0,0,0,0.5), 0 0 30px -10px rgba(34,197,94,0.15);
        }
        .bm-nft-card.owned { border-color: rgba(59,130,246,0.3); }
        .bm-nft-card.rented-out { opacity: 0.7; }
        .bm-nft-card.rented-out:hover { transform: none; }

        /* Tier Badge */
        .bm-tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tabs */
        .bm-tab {
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.25s;
            cursor: pointer;
            color: #71717a;
            white-space: nowrap;
            border: none;
            background: transparent;
        }
        .bm-tab:hover:not(.active) {
            color: #a1a1aa;
            background: rgba(63,63,70,0.3);
        }
        .bm-tab.active {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #000;
            box-shadow: 0 4px 20px rgba(34,197,94,0.35);
        }
        .bm-tab .tab-count {
            display: inline-flex;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            margin-left: 6px;
            font-size: 10px;
            font-weight: 700;
            border-radius: 9px;
            background: rgba(0,0,0,0.25);
            align-items: center;
            justify-content: center;
        }

        /* Filter Chips */
        .bm-filter {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.25s;
            cursor: pointer;
            border: 1px solid transparent;
            background: rgba(39,39,42,0.7);
            color: #71717a;
        }
        .bm-filter:hover:not(.active) {
            color: #fff;
            background: rgba(63,63,70,0.7);
        }
        .bm-filter.active {
            background: rgba(34,197,94,0.15);
            color: #22c55e;
            border-color: rgba(34,197,94,0.3);
        }

        /* Buttons */
        .bm-btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34,197,94,0.4);
        }
        .bm-btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .bm-btn-secondary {
            background: rgba(63,63,70,0.8);
            color: #a1a1aa;
            font-weight: 600;
            border: 1px solid rgba(63,63,70,0.8);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-secondary:hover {
            background: rgba(63,63,70,1);
            color: #fff;
        }

        .bm-btn-danger {
            background: rgba(239,68,68,0.15);
            color: #f87171;
            font-weight: 600;
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-danger:hover {
            background: rgba(239,68,68,0.25);
        }

        .bm-btn-amber {
            background: rgba(251,191,36,0.15);
            color: #fbbf24;
            font-weight: 600;
            border: 1px solid rgba(251,191,36,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .bm-btn-amber:hover {
            background: rgba(251,191,36,0.25);
        }

        /* Timer */
        .bm-timer {
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 8px;
        }
        .bm-timer.active {
            background: rgba(34,197,94,0.15);
            color: #22c55e;
            border: 1px solid rgba(34,197,94,0.25);
        }
        .bm-timer.warning {
            background: rgba(245,158,11,0.15);
            color: #f59e0b;
            border: 1px solid rgba(245,158,11,0.25);
        }
        .bm-timer.critical {
            background: rgba(239,68,68,0.15);
            color: #ef4444;
            border: 1px solid rgba(239,68,68,0.25);
            animation: bm-pulse 1s infinite;
        }

        /* Modal */
        .bm-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .bm-modal.active { display: flex; }
        .bm-modal-content {
            background: linear-gradient(145deg, rgba(39,39,42,0.98) 0%, rgba(24,24,27,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Empty State */
        .bm-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        /* How It Works Steps */
        .bm-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }
        .bm-step-num {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            flex-shrink: 0;
        }

        /* Boost badge */
        .bm-boost-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            background: rgba(251,146,60,0.15);
            color: #fb923c;
            border: 1px solid rgba(251,146,60,0.3);
        }
        .bm-nft-card.boosted {
            border-color: rgba(251,146,60,0.4);
            box-shadow: 0 0 20px -5px rgba(251,146,60,0.15);
        }

        /* Boost inline panel */
        .bm-boost-panel {
            background: rgba(251,146,60,0.06);
            border: 1px solid rgba(251,146,60,0.2);
            border-radius: 12px;
            padding: 12px;
        }

        /* Rented overlay */
        .bm-rented-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            border-radius: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .bm-stats-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .bm-nft-grid { grid-template-columns: 1fr !important; }
            .bm-how-grid { grid-template-columns: 1fr !important; }
        }
    `,document.head.appendChild(e)}function Ri(){const e=document.getElementById("rental");if(!e)return;ow();const t=u.rentalListings||[],a=t.filter(i=>u.isConnected&&lo(i.owner,u.userAddress)),n=Math.floor(Date.now()/1e3),o=(u.myRentals||[]).filter(i=>lo(i.tenant,u.userAddress)&&Number(i.endTime)>n),s=_.marketStats;e.innerHTML=`
        <div class="max-w-6xl mx-auto px-4 py-6">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-green-600/20 border border-emerald-500/30 flex items-center justify-center bm-float">
                        <i class="fa-solid fa-rocket text-2xl text-emerald-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Boost Market</h1>
                        <p class="text-sm text-zinc-500">Rent NFT Boosters. Keep more rewards.</p>
                    </div>
                </div>
                <div id="bm-header-actions">
                    ${u.isConnected?`
                        <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                            <span class="text-emerald-400 text-sm font-medium">Connected</span>
                        </div>
                    `:`
                        <button onclick="window.openConnectModal && window.openConnectModal()"
                            class="bm-btn-primary px-6 py-2.5 text-sm">
                            <i class="fa-solid fa-wallet mr-2"></i>Connect
                        </button>
                    `}
                </div>
            </div>

            <!-- How It Works -->
            <div class="bm-card p-5 mb-6" style="border-color: rgba(34,197,94,0.15);">
                <div class="flex items-center gap-2 mb-4">
                    <i class="fa-solid fa-circle-info text-emerald-400 text-sm"></i>
                    <h3 class="text-sm font-bold text-white">How It Works</h3>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 bm-how-grid">
                    <div class="bm-step">
                        <div class="bm-step-num bg-emerald-500/15 text-emerald-400 border border-emerald-500/25">1</div>
                        <div>
                            <p class="text-sm font-bold text-white">List</p>
                            <p class="text-xs text-zinc-500">Owners list NFTs with daily BNB price</p>
                        </div>
                    </div>
                    <div class="bm-step">
                        <div class="bm-step-num bg-blue-500/15 text-blue-400 border border-blue-500/25">2</div>
                        <div>
                            <p class="text-sm font-bold text-white">Rent</p>
                            <p class="text-xs text-zinc-500">Tenants rent to reduce burn rate on staking claims</p>
                        </div>
                    </div>
                    <div class="bm-step">
                        <div class="bm-step-num bg-amber-500/15 text-amber-400 border border-amber-500/25">3</div>
                        <div>
                            <p class="text-sm font-bold text-white">Earn</p>
                            <p class="text-xs text-zinc-500">Owners withdraw accumulated BNB earnings anytime</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6 bm-stats-grid">
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-emerald-400 font-mono">${t.length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Listed</p>
                </div>
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-blue-400 font-mono">${t.filter(i=>i.isRented||i.currentlyRented).length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Rented</p>
                </div>
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-amber-400 font-mono">${s?s.totalRentals:"â€”"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Total Rentals</p>
                </div>
                <div class="bm-card p-4 text-center">
                    <p class="text-2xl font-bold text-purple-400 font-mono"><i class="fa-brands fa-ethereum text-lg mr-1"></i>${s?It(s.totalVolume):"â€”"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Volume (BNB)</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex flex-wrap items-center gap-2 mb-6 pb-4 border-b border-zinc-800/50">
                <button class="bm-tab ${_.activeTab==="marketplace"?"active":""}" data-tab="marketplace">
                    <i class="fa-solid fa-store mr-2"></i>Marketplace
                </button>
                <button class="bm-tab ${_.activeTab==="my-listings"?"active":""}" data-tab="my-listings">
                    <i class="fa-solid fa-tags mr-2"></i>My Listings
                    <span class="tab-count">${a.length}</span>
                </button>
                <button class="bm-tab ${_.activeTab==="my-rentals"?"active":""}" data-tab="my-rentals">
                    <i class="fa-solid fa-clock-rotate-left mr-2"></i>My Rentals
                    <span class="tab-count">${o.length}</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div id="bm-tab-content"></div>
        </div>

        <!-- Modals -->
        ${cw()}
        ${dw()}
        ${uw()}
    `,gw(),to()}function to(){const e=document.getElementById("bm-tab-content");if(e){switch(_.activeTab){case"marketplace":e.innerHTML=sw();break;case"my-listings":e.innerHTML=iw();break;case"my-rentals":e.innerHTML=rw();break}_.activeTab==="my-rentals"&&kw()}}function sw(){const e=u.rentalListings||[],t=Math.floor(Date.now()/1e3);let a=e.filter(n=>!(n.isRented||n.currentlyRented||n.rentalEndTime&&Number(n.rentalEndTime)>t||_.filterTier!=="ALL"&&On(n.boostBips).name!==_.filterTier));return a.sort((n,o)=>{if(_.sortBy==="boosted")return n.isBoosted&&!o.isBoosted?-1:!n.isBoosted&&o.isBoosted?1:n.isBoosted&&o.isBoosted?(o.boostExpiry||0)-(n.boostExpiry||0):(o.boostBips||0)-(n.boostBips||0);const s=BigInt(n.pricePerDay||0),i=BigInt(o.pricePerDay||0);return _.sortBy==="price-low"?s<i?-1:s>i?1:0:_.sortBy==="price-high"?s>i?-1:s<i?1:0:(o.boostBips||0)-(n.boostBips||0)}),`
        <div>
            <!-- Filters & Sort -->
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="bm-filter ${_.filterTier==="ALL"?"active":""}" data-filter="ALL">All Tiers</button>
                    ${Object.keys(_i).map(n=>`
                        <button class="bm-filter ${_.filterTier===n?"active":""}" data-filter="${n}">
                            ${_i[n].emoji} ${n}
                        </button>
                    `).join("")}
                </div>
                <div class="flex items-center gap-3">
                    <select id="bm-sort" class="bg-zinc-800/80 border border-zinc-700 rounded-xl px-4 py-2.5 text-sm text-white outline-none cursor-pointer">
                        <option value="boosted" ${_.sortBy==="boosted"?"selected":""}>Promoted First</option>
                        <option value="boost-high" ${_.sortBy==="boost-high"?"selected":""}>Best Boost First</option>
                        <option value="price-low" ${_.sortBy==="price-low"?"selected":""}>Price: Low to High</option>
                        <option value="price-high" ${_.sortBy==="price-high"?"selected":""}>Price: High to Low</option>
                    </select>
                    ${u.isConnected?`
                        <button id="bm-open-list" class="bm-btn-primary px-5 py-2.5 text-sm">
                            <i class="fa-solid fa-plus mr-2"></i>List NFT
                        </button>
                    `:""}
                </div>
            </div>

            <!-- NFT Grid -->
            ${a.length===0?nl("No NFTs Available","Be the first to list your NFT booster!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 bm-nft-grid">
                    ${a.map((n,o)=>Hg(n,o,!1)).join("")}
                </div>
            `}
        </div>
    `}function Hg(e,t,a=!1){const n=On(e.boostBips),o=yo(n.name),s=It(e.pricePerDay),i=Lt(e.tokenId),r=u.isConnected&&lo(e.owner,u.userAddress),l=e.isRented||e.currentlyRented,c=po(e.boostBips||0),d=e.isBoosted,f=d?Math.max(0,Math.ceil((e.boostExpiry-Math.floor(Date.now()/1e3))/86400)):0;return`
        <div class="bm-nft-card ${r?"owned":""} ${l?"rented-out":""} ${d?"boosted":""}"
             style="animation-delay:${t*60}ms">

            <!-- Header -->
            <div class="flex items-center justify-between p-4 pb-0">
                <div class="bm-tier-badge" style="background:${o.bg};color:${o.color};border:1px solid ${o.border}">
                    ${o.emoji} ${n.name}
                </div>
                <div class="flex items-center gap-2">
                    ${d?`<span class="bm-boost-badge"><i class="fa-solid fa-fire"></i> ${f}d</span>`:""}
                    <span class="text-sm font-bold font-mono" style="color:${o.color}">
                        Keep ${c}%
                    </span>
                </div>
            </div>

            <!-- NFT Display -->
            <div class="relative aspect-square flex items-center justify-center p-6">
                <div class="absolute inset-0 rounded-2xl opacity-50"
                     style="background: radial-gradient(circle at center, ${o.color}15 0%, transparent 70%);"></div>
                <img src="${o.image}" alt="${n.name} Booster"
                     class="w-4/5 h-4/5 object-contain bm-float rounded-xl"
                     onerror="this.outerHTML='<div class=\\'text-7xl bm-float\\'>${o.emoji}</div>'">

                ${r?`
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-full bg-blue-500/20 border border-blue-500/30 text-blue-400 text-[10px] font-bold">
                        <i class="fa-solid fa-user mr-1"></i>YOURS
                    </div>
                `:""}

                ${l&&!r?`
                    <div class="bm-rented-overlay">
                        <i class="fa-solid fa-lock text-3xl text-zinc-400 mb-2"></i>
                        <span class="text-xs text-zinc-300 font-semibold">Currently Rented</span>
                    </div>
                `:""}
            </div>

            <!-- Info -->
            <div class="p-4 pt-0">
                <div class="flex items-baseline justify-between mb-2">
                    <h3 class="text-base font-bold text-white">${n.name} Booster</h3>
                    <span class="text-xs font-mono" style="color:${o.color}">#${i}</span>
                </div>

                <p class="text-xs ${c===100?"text-emerald-400":"text-zinc-500"} mb-4">
                    ${c===100?"Keep 100% of your staking rewards!":`Save ${c-50}% on claim burns`}
                </p>

                <div class="h-px bg-gradient-to-r from-transparent via-zinc-700 to-transparent mb-4"></div>

                <!-- Price & Actions -->
                <div class="flex items-end justify-between">
                    <div>
                        <span class="text-[10px] text-zinc-500 uppercase block mb-1">Price/Day</span>
                        <div class="flex items-baseline gap-1.5">
                            <i class="fa-brands fa-ethereum text-blue-400 text-sm"></i>
                            <span class="text-xl font-bold text-white">${s}</span>
                            <span class="text-xs text-zinc-500">BNB</span>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        ${r?`
                            <button class="bm-boost-btn bm-btn-amber px-3 py-2 text-xs" data-id="${i}" title="Boost listing">
                                <i class="fa-solid fa-fire mr-1"></i>${d?"Extend":"Boost"}
                            </button>
                            <button class="bm-share-btn bm-btn-secondary px-3 py-2 text-xs" data-id="${i}" title="Share listing">
                                <i class="fa-solid fa-share-nodes"></i>
                            </button>
                            <button class="bm-withdraw-btn bm-btn-danger px-3 py-2 text-xs" data-id="${i}" ${l?"disabled":""}>
                                <i class="fa-solid fa-arrow-right-from-bracket"></i>
                            </button>
                        `:`
                            <button class="bm-rent-btn bm-btn-primary px-5 py-2.5 text-sm" data-id="${i}" ${l?"disabled":""}>
                                <i class="fa-solid fa-bolt mr-1"></i>Rent 1 Day
                            </button>
                        `}
                    </div>
                </div>
            </div>
        </div>
    `}function iw(){if(!u.isConnected)return Wg("View your listings");const e=u.rentalListings||[],t=e.filter(s=>lo(s.owner,u.userAddress)),a=new Set(e.map(s=>Lt(s.tokenId))),n=(u.myBoosters||[]).filter(s=>!a.has(Lt(s.tokenId))),o=t.reduce((s,i)=>s+BigInt(i.totalEarnings||0),0n);return`
        <div>
            <!-- Earnings Card -->
            <div class="bm-card p-6 mb-6" style="border-color: rgba(34,197,94,0.2);">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
                    <div class="flex items-center gap-5">
                        <div class="w-16 h-16 rounded-2xl bg-emerald-500/15 flex items-center justify-center border border-emerald-500/25">
                            <i class="fa-solid fa-sack-dollar text-emerald-400 text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-zinc-400">Total Lifetime Earnings</p>
                            <p class="text-3xl font-bold text-white">
                                <i class="fa-brands fa-ethereum text-blue-400 text-2xl mr-1"></i>${It(o)} <span class="text-lg text-zinc-500">BNB</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-3 items-center">
                        <!-- Pending Earnings -->
                        <div class="bm-card p-4 text-center min-w-[120px]" style="border-color: rgba(251,191,36,0.2);">
                            <p class="text-xl font-bold text-amber-400 font-mono" id="bm-pending-amount">
                                ${_.pendingEarningsAmount>0n?It(_.pendingEarningsAmount):"0"}
                            </p>
                            <p class="text-[10px] text-zinc-500 uppercase">Pending BNB</p>
                        </div>
                        <button id="bm-withdraw-earnings" class="bm-btn-amber px-5 py-3 text-sm"
                                ${_.pendingEarningsAmount===0n?'disabled style="opacity:0.4;cursor:not-allowed"':""}>
                            <i class="fa-solid fa-coins mr-2"></i>Withdraw Earnings
                        </button>
                        <div class="bm-card p-4 text-center min-w-[80px]">
                            <p class="text-xl font-bold text-white">${t.length}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">Listed</p>
                        </div>
                        <div class="bm-card p-4 text-center min-w-[80px]">
                            <p class="text-xl font-bold text-white">${n.length}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">Available</p>
                        </div>
                        <button id="bm-open-list" class="bm-btn-primary px-6 py-3" ${n.length===0?"disabled":""}>
                            <i class="fa-solid fa-plus mr-2"></i>List
                        </button>
                    </div>
                </div>
            </div>

            <!-- My Listed NFTs -->
            ${t.length===0?nl("No Listings Yet","List your first NFT to start earning BNB!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 bm-nft-grid">
                    ${t.map((s,i)=>Hg(s,i,!0)).join("")}
                </div>
            `}
        </div>
    `}function rw(){if(!u.isConnected)return Wg("View your active rentals");const e=Math.floor(Date.now()/1e3),t=(u.myRentals||[]).filter(a=>lo(a.tenant,u.userAddress)&&Number(a.endTime)>e);return`
        <div>
            <!-- Tier Info -->
            <div class="bm-card p-5 mb-6" style="border-color: rgba(34,197,94,0.15);">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/15 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-shield-halved text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white mb-1">Boost Tiers</h3>
                        <p class="text-xs text-zinc-400">
                            Diamond = Keep 100% | Gold = 90% | Silver = 80% | Bronze = 70% â€” Without NFT: 50% recycled.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Active Rentals -->
            ${t.length===0?nl("No Active Rentals","Rent an NFT booster to keep more staking rewards!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
                    ${t.map((a,n)=>lw(a,n)).join("")}
                </div>
            `}
        </div>
    `}function lw(e,t){const a=On(e.boostBips),n=yo(a.name),o=Ug(Number(e.endTime)),s=po(e.boostBips||0);let i="active";return o.seconds<3600?i="critical":o.seconds<7200&&(i="warning"),`
        <div class="bm-card p-5" style="animation: bm-card-in 0.5s ease-out ${t*60}ms forwards; opacity: 0;">
            <div class="flex items-center justify-between mb-4">
                <div class="bm-tier-badge" style="background:${n.bg};color:${n.color};border:1px solid ${n.border}">
                    ${n.emoji} ${a.name}
                </div>
                <div class="bm-timer ${i}" data-end="${e.endTime}">
                    <i class="fa-solid fa-clock mr-1"></i>${o.text}
                </div>
            </div>

            <div class="flex items-center gap-4 mb-4">
                <div class="w-16 h-16 rounded-xl flex items-center justify-center overflow-hidden"
                     style="background:${n.bg}">
                    <img src="${n.image}" alt="${a.name}" class="w-full h-full object-contain"
                         onerror="this.outerHTML='<span class=\\'text-4xl\\'>${n.emoji}</span>'">
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white">${a.name} Booster</h3>
                    <p class="text-xs text-zinc-500">Token #${Lt(e.tokenId)}</p>
                </div>
            </div>

            <div class="p-3 rounded-xl ${s===100?"bg-emerald-500/10 border border-emerald-500/20":"bg-zinc-800/50"}">
                <p class="text-sm ${s===100?"text-emerald-400":"text-zinc-300"}">
                    <i class="fa-solid fa-shield-halved mr-2"></i>
                    ${s===100?"Keep 100% of rewards!":`Keep ${s}% of rewards on claims`}
                </p>
            </div>
        </div>
    `}function cw(){const e=u.rentalListings||[],t=new Set(e.map(n=>Lt(n.tokenId)));return`
        <div class="bm-modal" id="bm-modal-list">
            <div class="bm-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-tag text-emerald-400"></i>List NFT for Rent
                    </h3>
                    <button class="bm-close-list text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="p-5 space-y-5">
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Select NFT</label>
                        <select id="bm-list-select" class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none">
                            <option value="">-- Select an NFT --</option>
                            ${(u.myBoosters||[]).filter(n=>!t.has(Lt(n.tokenId))).map(n=>{const o=On(n.boostBips),s=yo(o.name);return`<option value="${n.tokenId}">${s.emoji} ${o.name} Booster #${n.tokenId}</option>`}).join("")}
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Price per Day (BNB)</label>
                        <input type="number" id="bm-list-price" min="0.0001" step="0.0001" placeholder="0.005"
                            class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none text-lg font-mono">
                        <p class="text-[10px] text-zinc-600 mt-2">Fixed 1-day rental. NFT auto re-lists after each rental.</p>
                    </div>
                </div>
                <div class="flex gap-3 p-5 pt-0">
                    <button class="bm-close-list bm-btn-secondary flex-1 py-3">Cancel</button>
                    <button id="bm-confirm-list" class="bm-btn-primary flex-1 py-3">
                        <i class="fa-solid fa-check mr-2"></i>List NFT
                    </button>
                </div>
            </div>
        </div>
    `}function dw(){return`
        <div class="bm-modal" id="bm-modal-rent">
            <div class="bm-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-bolt text-emerald-400"></i>Rent Booster
                    </h3>
                    <button class="bm-close-rent text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div id="bm-rent-modal-body" class="p-5">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>
    `}function uw(){return`
        <div class="bm-modal" id="bm-modal-boost">
            <div class="bm-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-fire text-amber-400"></i>Boost Listing
                    </h3>
                    <button class="bm-close-boost text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div id="bm-boost-modal-body" class="p-5">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>
    `}function pw(e){const t=(u.rentalListings||[]).find(d=>Og(d.tokenId,e));if(!t)return;_.selectedListing=t;const a=On(t.boostBips),n=yo(a.name),o=t.isBoosted,s=o?Math.max(0,Math.ceil((t.boostExpiry-Math.floor(Date.now()/1e3))/86400)):0,i=document.getElementById("bm-boost-modal-body");if(!i)return;i.innerHTML=`
        <div class="flex items-center gap-4 mb-5 p-4 rounded-xl" style="background:${n.bg}">
            <img src="${n.image}" alt="${a.name}" class="w-14 h-14 object-contain rounded-lg"
                 onerror="this.outerHTML='<div class=\\'text-4xl\\'>${n.emoji}</div>'">
            <div>
                <h3 class="text-base font-bold text-white">${a.name} Booster #${e}</h3>
                ${o?`<p class="text-xs text-amber-400"><i class="fa-solid fa-fire mr-1"></i>Boosted â€” ${s} days remaining</p>`:'<p class="text-xs text-zinc-500">Not boosted</p>'}
            </div>
        </div>

        <div class="mb-5">
            <p class="text-sm text-zinc-400 mb-4">
                Boosted listings appear first in the marketplace. Choose how many days to boost.
                ${o?"New days will extend from current expiry.":""}
            </p>
            <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Boost Duration (days)</label>
            <input type="range" id="bm-boost-days" min="1" max="90" value="30"
                class="w-full accent-amber-500 cursor-pointer">
            <div class="flex justify-between text-xs text-zinc-500 mt-1">
                <span>1 day</span>
                <span id="bm-boost-days-label" class="text-amber-400 font-bold">30 days</span>
                <span>90 days</span>
            </div>
        </div>

        <div id="bm-boost-cost" class="bm-boost-panel mb-5">
            <div class="flex justify-between text-sm mb-2">
                <span class="text-zinc-500">Cost per day</span>
                <span class="text-zinc-300 font-mono" id="bm-boost-cost-day">Calculating...</span>
            </div>
            <div class="h-px bg-amber-500/20 my-2"></div>
            <div class="flex justify-between text-sm">
                <span class="text-amber-400 font-bold">Total Cost</span>
                <span class="text-lg font-bold text-amber-400 font-mono" id="bm-boost-cost-total">â€”</span>
            </div>
        </div>

        <div class="flex gap-3">
            <button class="bm-close-boost bm-btn-secondary flex-1 py-3">Cancel</button>
            <button id="bm-confirm-boost" class="bm-btn-amber flex-1 py-3" data-id="${e}">
                <i class="fa-solid fa-fire mr-2"></i>${o?"Extend Boost":"Boost Now"}
            </button>
        </div>
    `;const r=document.getElementById("bm-boost-days"),l=document.getElementById("bm-boost-days-label"),c=async()=>{const d=parseInt(r.value)||1;l.textContent=`${d} day${d>1?"s":""}`;try{const f=await _t.getBoostCost(d);document.getElementById("bm-boost-cost-day").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${f.feePerDayFormatted} BNB`,document.getElementById("bm-boost-cost-total").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${f.totalFeeFormatted} BNB`}catch{document.getElementById("bm-boost-cost-day").textContent="Error",document.getElementById("bm-boost-cost-total").textContent="Error"}};c(),r.addEventListener("input",c),document.getElementById("bm-modal-boost").classList.add("active")}function jg(){const e=document.getElementById("bm-modal-boost");e&&e.classList.remove("active"),_.selectedListing=null}async function fw(){if(_.isTransactionPending||!_.selectedListing)return;const e=Lt(_.selectedListing.tokenId),t=parseInt(document.getElementById("bm-boost-days").value)||1,a=document.getElementById("bm-confirm-boost");_.isTransactionPending=!0;try{await _t.boostListing({tokenId:e,days:t,button:a,onSuccess:async()=>{_.isTransactionPending=!1,jg(),x(`Listing boosted for ${t} days!`,"success"),await Fa()},onError:n=>{_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&x("Boost failed: "+(n.message||"Error"),"error")}})}catch(n){_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&x("Boost failed: "+(n.message||"Error"),"error")}}function nl(e,t){return`
        <div class="bm-empty">
            <div class="w-20 h-20 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-rocket text-3xl text-zinc-600"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">${e}</h3>
            <p class="text-sm text-zinc-500">${t}</p>
        </div>
    `}function Wg(e){return`
        <div class="bm-empty">
            <div class="w-20 h-20 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-wallet text-3xl text-zinc-500"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">Connect Wallet</h3>
            <p class="text-sm text-zinc-500 mb-4">${e}</p>
            <button onclick="window.openConnectModal && window.openConnectModal()" class="bm-btn-primary px-8 py-3">
                <i class="fa-solid fa-wallet mr-2"></i>Connect Wallet
            </button>
        </div>
    `}let Ea=null,Ta=null;function gw(){Ea&&document.removeEventListener("click",Ea),Ta&&document.removeEventListener("change",Ta),Ea=e=>{const t=e.target,a=t.closest(".bm-tab");if(a){_.activeTab=a.dataset.tab,document.querySelectorAll(".bm-tab").forEach(l=>l.classList.remove("active")),a.classList.add("active"),to();return}const n=t.closest(".bm-filter");if(n){_.filterTier=n.dataset.filter,to();return}if(t.closest("#bm-open-list")){mw();return}if(t.closest(".bm-close-list")){Gg();return}if(t.closest(".bm-close-rent")){Kg();return}if(t.closest("#bm-confirm-list")){hw();return}if(t.closest("#bm-confirm-rent")){xw();return}if(t.closest("#bm-confirm-boost")){fw();return}if(t.closest(".bm-close-boost")){jg();return}const o=t.closest(".bm-boost-btn");if(o){pw(o.dataset.id);return}const s=t.closest(".bm-rent-btn");if(s&&!s.disabled){bw(s.dataset.id);return}const i=t.closest(".bm-withdraw-btn");if(i&&!i.disabled){vw(i);return}const r=t.closest(".bm-share-btn");if(r){ww(r.dataset.id);return}if(t.closest("#bm-withdraw-earnings")){yw();return}if(t.classList.contains("bm-modal")){t.classList.remove("active"),_.selectedListing=null;return}},Ta=e=>{e.target.id==="bm-sort"&&(_.sortBy=e.target.value,to())},document.addEventListener("click",Ea),document.addEventListener("change",Ta)}function mw(){const e=document.getElementById("bm-modal-list");e&&e.classList.add("active")}function Gg(){const e=document.getElementById("bm-modal-list");e&&e.classList.remove("active")}function bw(e){const t=(u.rentalListings||[]).find(d=>Og(d.tokenId,e));if(!t)return;_.selectedListing=t;const a=On(t.boostBips),n=yo(a.name);It(t.pricePerDay);const o=po(t.boostBips||0),s=document.getElementById("bm-rent-modal-body");if(!s)return;s.innerHTML=`
        <div class="flex items-center gap-4 mb-5 p-4 rounded-xl" style="background:${n.bg}">
            <img src="${n.image}" alt="${a.name}" class="w-16 h-16 object-contain rounded-lg"
                 onerror="this.outerHTML='<div class=\\'text-5xl\\'>${n.emoji}</div>'">
            <div>
                <h3 class="text-lg font-bold text-white">${a.name} Booster #${e}</h3>
                <p class="text-sm" style="color:${n.color}">Keep ${o}% of rewards</p>
            </div>
        </div>

        <div class="space-y-4 mb-5">
            <div class="flex justify-between text-sm">
                <span class="text-zinc-500">Duration</span>
                <span class="text-white font-bold">1 Day (24 hours)</span>
            </div>
            <div id="bm-rent-cost" class="p-4 rounded-xl bg-zinc-800/50 space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-500">Rental Cost</span>
                    <span class="text-white font-mono" id="bm-cost-rental"><i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>Calculating...</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-500">Ecosystem Fee (20%)</span>
                    <span class="text-zinc-400 font-mono" id="bm-cost-fee">â€”</span>
                </div>
                <div class="h-px bg-zinc-700 my-1"></div>
                <div class="flex justify-between text-sm">
                    <span class="text-zinc-400 font-bold">Total</span>
                    <span class="text-xl font-bold text-emerald-400 font-mono" id="bm-cost-total">â€”</span>
                </div>
            </div>
            <div id="bm-balance-warn" class="hidden p-3 rounded-xl bg-red-500/10 border border-red-500/20 text-center">
                <p class="text-xs text-red-400" id="bm-balance-warn-text"></p>
            </div>
        </div>

        <div class="flex gap-3">
            <button class="bm-close-rent bm-btn-secondary flex-1 py-3">Cancel</button>
            <button id="bm-confirm-rent" class="bm-btn-primary flex-1 py-3">
                <i class="fa-solid fa-bolt mr-2"></i>Rent 1 Day
            </button>
        </div>
    `;const i=document.getElementById("bm-confirm-rent"),r=document.getElementById("bm-balance-warn"),l=document.getElementById("bm-balance-warn-text");(async()=>{let d=0n;try{const f=await _t.getRentalCost(e);d=f.totalCost,document.getElementById("bm-cost-rental").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${f.rentalCostFormatted} BNB`,document.getElementById("bm-cost-fee").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${f.ethFeeFormatted} BNB`,document.getElementById("bm-cost-total").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${f.totalCostFormatted} BNB`}catch{const g=BigInt(t.pricePerDay||0);d=g,document.getElementById("bm-cost-rental").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>${It(g)} BNB`,document.getElementById("bm-cost-fee").textContent="~fee",document.getElementById("bm-cost-total").innerHTML=`<i class="fa-brands fa-ethereum text-blue-400 mr-1"></i>~${It(g)} BNB`}if(u.isConnected&&d>0n)try{const{NetworkManager:f}=await U(async()=>{const{NetworkManager:h}=await Promise.resolve().then(()=>q);return{NetworkManager:h}},void 0),g=await f.getProvider().getBalance(u.userAddress),m=d+al.parseEther("0.001");if(g<m){const h=It(m-g);i.disabled=!0,i.className="flex-1 py-3 rounded-xl font-bold text-sm border border-red-500/30 bg-red-500/10 text-red-400 cursor-not-allowed",i.innerHTML=`<i class="fa-brands fa-ethereum mr-1"></i>Need ${It(m)} BNB`,r.classList.remove("hidden"),l.textContent=`Your balance: ${It(g)} BNB â€” need ${h} more BNB`}else i.disabled=!1,i.className="bm-btn-primary flex-1 py-3",i.innerHTML='<i class="fa-solid fa-bolt mr-2"></i>Rent 1 Day',r.classList.add("hidden")}catch{i.disabled=!1,i.className="bm-btn-primary flex-1 py-3",i.innerHTML='<i class="fa-solid fa-bolt mr-2"></i>Rent 1 Day',r.classList.add("hidden")}})(),document.getElementById("bm-modal-rent").classList.add("active")}function Kg(){const e=document.getElementById("bm-modal-rent");e&&e.classList.remove("active"),_.selectedListing=null}async function xw(){if(_.isTransactionPending||!_.selectedListing)return;const e=Lt(_.selectedListing.tokenId),t=document.getElementById("bm-confirm-rent");_.isTransactionPending=!0;try{await _t.rent({tokenId:e,button:t,onSuccess:async()=>{_.isTransactionPending=!1,Kg(),x("NFT Rented Successfully!","success"),await Fa()},onError:a=>{_.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&x("Failed: "+(a.message||"Error"),"error")}})}catch(a){_.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&x("Failed: "+(a.message||"Error"),"error")}}async function hw(){if(_.isTransactionPending)return;const e=document.getElementById("bm-list-select").value,t=document.getElementById("bm-list-price").value;if(!e){x("Select an NFT","error");return}if(!t||parseFloat(t)<=0){x("Enter valid price","error");return}const a=document.getElementById("bm-confirm-list");_.isTransactionPending=!0;try{await _t.list({tokenId:e,pricePerDay:al.parseEther(t),button:a,onSuccess:async()=>{_.isTransactionPending=!1,Gg(),x("NFT Listed Successfully!","success"),await Fa()},onError:n=>{_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&x("Failed: "+(n.message||"Error"),"error")}})}catch(n){_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&x("Failed: "+(n.message||"Error"),"error")}}async function vw(e){if(_.isTransactionPending)return;const t=e.dataset.id;if(confirm("Withdraw this NFT from the marketplace?")){_.isTransactionPending=!0;try{await _t.withdraw({tokenId:t,button:e,onSuccess:async()=>{_.isTransactionPending=!1,x("NFT Withdrawn Successfully!","success"),await Fa()},onError:a=>{_.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&x("Failed: "+(a.message||"Error"),"error")}})}catch(a){_.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&x("Failed: "+(a.message||"Error"),"error")}}}async function yw(){if(_.isTransactionPending||_.pendingEarningsAmount===0n)return;const e=document.getElementById("bm-withdraw-earnings");_.isTransactionPending=!0;try{await _t.withdrawEarnings({button:e,onSuccess:async()=>{_.isTransactionPending=!1,_.pendingEarningsAmount=0n,x("Earnings Withdrawn!","success"),await Fa()},onError:t=>{_.isTransactionPending=!1,!t.cancelled&&t.type!=="user_rejected"&&x("Failed: "+(t.message||"Error"),"error")}})}catch(t){_.isTransactionPending=!1,!t.cancelled&&t.type!=="user_rejected"&&x("Failed: "+(t.message||"Error"),"error")}}function ww(e){const t="https://backcoin.org/#rental",a=`Rent NFT Boosters on Backchain Boost Market!

Keep up to 100% of your staking rewards by renting an NFT booster.

${t}

#Backchain #DeFi #BNBChain #opBNB #Web3`;navigator.share?navigator.share({title:"Backchain Boost Market",text:a,url:t}).catch(()=>{}):navigator.clipboard.writeText(a).then(()=>{x("Link copied to clipboard!","success")}).catch(()=>{x("Could not copy link","error")})}function kw(){_.countdownIntervals.forEach(clearInterval),_.countdownIntervals=[],document.querySelectorAll(".bm-timer[data-end]").forEach(e=>{const t=Number(e.dataset.end),a=setInterval(()=>{const n=Ug(t);e.innerHTML=`<i class="fa-solid fa-clock mr-1"></i>${n.text}`,n.expired?(clearInterval(a),to()):n.seconds<3600?e.className="bm-timer critical":n.seconds<7200&&(e.className="bm-timer warning")},1e3);_.countdownIntervals.push(a)})}async function Fa(){_.isLoading=!0;try{const e=[Xi()];u.isConnected&&(e.push(gd()),e.push(Nn()),e.push(Ew())),e.push(Tw()),await Promise.all(e)}catch(e){console.warn("[BoostMarket] Refresh error:",e)}_.isLoading=!1,Ri()}async function Ew(){if(u.userAddress)try{const e=await _t.getPendingEarnings(u.userAddress);_.pendingEarningsAmount=e.amount}catch{_.pendingEarningsAmount=0n}}async function Tw(){try{_.marketStats=await _t.getMarketplaceStats()}catch{_.marketStats=null}}function kc(){_.countdownIntervals.forEach(clearInterval),_.countdownIntervals=[],Ea&&(document.removeEventListener("click",Ea),Ea=null),Ta&&(document.removeEventListener("change",Ta),Ta=null)}const Vg={async render(e){if(!e){kc();return}Ri(),await Fa()},update(){Ri()},refresh:Fa,cleanup:kc};window.RentalPage=Vg;const Cw={render:async e=>{const t=document.getElementById("socials");if(!t||!e&&t.innerHTML.trim()!=="")return;const a=`
            <style>
                @keyframes telegram-pulse {
                    0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); transform: scale(1); }
                    70% { box-shadow: 0 0 0 15px rgba(56, 189, 248, 0); transform: scale(1.02); }
                    100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); transform: scale(1); }
                }
                .telegram-glow {
                    animation: telegram-pulse 2s infinite;
                }
            </style>
        `;t.innerHTML=`
            ${a}
            <div class="max-w-5xl mx-auto py-8">
                
                <div class="text-center mb-10">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-yellow-200 mb-4">
                        Join the Backcoin Community
                    </h1>
                    <p class="text-zinc-400 text-lg max-w-2xl mx-auto">
                        Connect with thousands of holders, stay updated on the Mainnet launch, and participate in exclusive airdrops.
                    </p>
                </div>

                <div class="mb-12 flex justify-center">
                    <a href="https://t.me/BackCoinorg" target="_blank" 
                       class="telegram-glow relative group w-full max-w-2xl bg-gradient-to-br from-sky-600 to-blue-700 hover:from-sky-500 hover:to-blue-600 border border-sky-400/50 rounded-2xl p-8 flex flex-col md:flex-row items-center justify-between gap-6 transition-all duration-300 shadow-2xl">
                        
                        <div class="flex items-center gap-6">
                            <div class="bg-white/20 p-4 rounded-full backdrop-blur-sm">
                                <i class="fa-brands fa-telegram text-5xl text-white"></i>
                            </div>
                            <div class="text-center md:text-left">
                                <h2 class="text-2xl font-bold text-white mb-1">Official Telegram Group</h2>
                                <p class="text-sky-100 text-sm font-medium">Chat with the team & community â€¢ 24/7 Support</p>
                            </div>
                        </div>

                        <div class="bg-white text-blue-600 font-extrabold py-3 px-8 rounded-full shadow-lg group-hover:scale-105 transition-transform flex items-center gap-2 whitespace-nowrap">
                            JOIN NOW <i class="fa-solid fa-arrow-right"></i>
                        </div>
                    </a>
                </div>

                <div class="border-t border-zinc-800 my-10"></div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
                    
                    <a href="https://x.com/backcoin" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-zinc-500 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-x-twitter text-3xl text-white"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">X (Twitter)</h3>
                        <p class="text-zinc-400 text-sm">Latest news & announcements</p>
                    </a>

                    <a href="https://www.youtube.com/@Backcoin" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-red-500/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-youtube text-3xl text-red-500"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">YouTube</h3>
                        <p class="text-zinc-400 text-sm">Video tutorials & AMAs</p>
                    </a>

                    <a href="https://www.instagram.com/backcoin.bkc/" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-pink-500/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-instagram text-3xl text-pink-500"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Instagram</h3>
                        <p class="text-zinc-400 text-sm">Visual updates & stories</p>
                    </a>

                    <a href="https://www.tiktok.com/@backcoin.org" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-cyan-400/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-tiktok text-3xl text-cyan-400"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">TikTok</h3>
                        <p class="text-zinc-400 text-sm">Short clips & viral content</p>
                    </a>

                    <a href="https://www.facebook.com/profile.php?id=61584248964781" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-blue-600/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-facebook text-3xl text-blue-600"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Facebook</h3>
                        <p class="text-zinc-400 text-sm">Community discussions</p>
                    </a>

                </div>

                <div class="mt-12 text-center text-zinc-500 text-sm">
                    <p>Always verify links. Official admins will never DM you first asking for funds.</p>
                </div>
            </div>
        `},cleanup:()=>{}},Fi="https://www.youtube.com/@Backcoin",ol={overview:[{id:"ov-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"beginner",icon:"fa-play-circle",en:{title:"What is Backcoin?",description:"A complete overview of the Backcoin ecosystem. Unstoppable DeFi on opBNB: staking, NFTs, games, social network, and more â€” all without admin keys."},pt:{title:"O Que Ã© o Backcoin?",description:"Uma visÃ£o completa do ecossistema Backcoin. DeFi imparÃ¡vel na opBNB: staking, NFTs, jogos, rede social e mais â€” tudo sem chaves de admin."}},{id:"ov-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"4:00",tag:"beginner",icon:"fa-money-bill-trend-up",en:{title:"How to Earn Money with Backcoin",description:"Three income streams: be an Operator (commissions), Delegator (staking rewards), or Tutor (10% BNB + 5% BKC forever). Learn how to combine all three."},pt:{title:"Como Ganhar Dinheiro com Backcoin",description:"TrÃªs fontes de renda: seja Operador (comissÃµes), Delegador (recompensas de staking) ou Tutor (10% BNB + 5% BKC pra sempre). Aprenda a combinar as trÃªs."}},{id:"ov-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"5:00",tag:"intermediate",icon:"fa-laptop-code",en:{title:"Be an Operator â€” Build & Earn Commissions",description:"Build your own Backcoin frontend (site, app, bot) and earn automatic commissions on every user transaction. No approval needed. Full guide."},pt:{title:"Seja um Operador â€” Construa e Ganhe ComissÃµes",description:"Construa seu prÃ³prio frontend Backcoin (site, app, bot) e ganhe comissÃµes automÃ¡ticas em cada transaÃ§Ã£o. Sem aprovaÃ§Ã£o. Guia completo."}},{id:"ov-4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"beginner",icon:"fa-graduation-cap",en:{title:"Tutor System â€” Passive Income Forever",description:"Share your tutor link and earn 10% BNB fees + 5% BKC claims from your tutters â€” automatically, forever. How to set up and maximize your network."},pt:{title:"Sistema Tutor â€” Renda Passiva Pra Sempre",description:"Compartilhe seu link de tutor e ganhe 10% das taxas BNB + 5% dos claims BKC dos seus tutters â€” automaticamente, pra sempre. Como configurar e maximizar."}},{id:"ov-5",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:30",tag:"beginner",icon:"fa-cube",en:{title:"What is opBNB & Why We Chose It",description:"opBNB is BNB Chain's Layer 2 network â€” ultra-low fees, high speed, and massive scalability. Learn why Backchain chose opBNB as its home and how it benefits you."},pt:{title:"O Que Ã© opBNB e Por Que Escolhemos",description:"opBNB Ã© a rede Layer 2 da BNB Chain â€” taxas ultrabaixas, alta velocidade e escalabilidade massiva. Saiba por que a Backchain escolheu a opBNB e como isso te beneficia."}},{id:"ov-6",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"4:00",tag:"beginner",icon:"fa-cart-shopping",en:{title:"How to Buy BNB â€” The Fuel of Backchain",description:"BNB is the native currency of opBNB and the fuel for every Backchain action. Learn how to buy BNB on exchanges, bridge to opBNB, and add it to MetaMask step by step."},pt:{title:"Como Comprar BNB â€” O CombustÃ­vel da Backchain",description:"BNB Ã© a moeda nativa da opBNB e o combustÃ­vel para cada aÃ§Ã£o na Backchain. Aprenda como comprar BNB em exchanges, fazer bridge para opBNB e adicionar na MetaMask passo a passo."}}],gettingStarted:[{id:"gs-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:30",tag:"beginner",icon:"fa-wallet",en:{title:"MetaMask Setup (PC & Mobile)",description:"Install MetaMask, create your wallet, and add the opBNB Testnet network. Your gateway to the Backcoin universe."},pt:{title:"Configurando MetaMask (PC & Mobile)",description:"Instale a MetaMask, crie sua carteira e adicione a rede opBNB Testnet. Sua entrada para o universo Backcoin."}},{id:"gs-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:00",tag:"beginner",icon:"fa-plug",en:{title:"Connect Wallet & Claim Free Tokens",description:"Connect to backcoin.org, use the Faucet to claim free BKC + BNB for gas, and add BKC to MetaMask. Ready in 2 minutes."},pt:{title:"Conectar Carteira e Receber Tokens GrÃ¡tis",description:"Conecte no backcoin.org, use o Faucet para receber BKC + BNB grÃ¡tis pra gas, e adicione o BKC na MetaMask. Pronto em 2 minutos."}},{id:"gs-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"beginner",icon:"fa-compass",en:{title:"Navigating the Dashboard",description:"Tour of the main dashboard: your balance, rewards, NFT booster status, activity feed, and quick actions. Everything at a glance."},pt:{title:"Navegando pelo Dashboard",description:"Tour pelo dashboard principal: seu saldo, recompensas, status do NFT booster, feed de atividades e aÃ§Ãµes rÃ¡pidas. Tudo num relance."}}],stakingMining:[{id:"sm-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"4:00",tag:"intermediate",icon:"fa-lock",en:{title:"Staking â€” Delegate BKC and Earn Rewards",description:"How to delegate BKC tokens, choose lock period for maximum power (pStake), and understand the reward multiplier. Step-by-step guide."},pt:{title:"Staking â€” Delegue BKC e Ganhe Recompensas",description:"Como delegar tokens BKC, escolher perÃ­odo de lock para mÃ¡ximo poder (pStake) e entender o multiplicador de recompensas. Passo a passo."}},{id:"sm-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"intermediate",icon:"fa-hand-holding-dollar",en:{title:"Claiming Rewards & Understanding Burn Rate",description:"How to claim your staking rewards. Why 50% is burned without NFT Booster, and how to keep up to 100% with a Diamond NFT."},pt:{title:"Clamando Recompensas e Entendendo o Burn",description:"Como clamar suas recompensas de staking. Por que 50% Ã© queimado sem NFT Booster, e como manter atÃ© 100% com um Diamond NFT."}},{id:"sm-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:00",tag:"intermediate",icon:"fa-unlock",en:{title:"Force Unstake â€” Emergency Exit",description:"Need your tokens before lock expires? Force unstake with 10% penalty. When to use it and when to wait."},pt:{title:"Force Unstake â€” SaÃ­da de EmergÃªncia",description:"Precisa dos tokens antes do lock expirar? Force unstake com 10% de penalidade. Quando usar e quando esperar."}},{id:"sm-4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:30",tag:"advanced",icon:"fa-hammer",en:{title:"Buyback Mining â€” How Protocol Fees Become Rewards",description:"The Buyback Miner converts BNB fees into BKC rewards. Learn the scarcity curve, the 5% caller incentive, and how to run a mining bot."},pt:{title:"MineraÃ§Ã£o Buyback â€” Como Taxas Viram Recompensas",description:"O Buyback Miner converte taxas BNB em recompensas BKC. Aprenda a curva de escassez, o incentivo de 5% e como rodar um bot de mineraÃ§Ã£o."}}],nfts:[{id:"nft-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"beginner",icon:"fa-gem",en:{title:"NFT Boosters Explained â€” Why You Need One",description:"The 4 tiers (Bronze to Diamond), how they reduce burn rate, and why a Diamond holder earns 2x more than someone without NFT."},pt:{title:"NFT Boosters â€” Por Que VocÃª Precisa de Um",description:"Os 4 tiers (Bronze a Diamond), como reduzem o burn, e por que um Diamond holder ganha 2x mais do que quem nÃ£o tem NFT."}},{id:"nft-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:30",tag:"intermediate",icon:"fa-cart-shopping",en:{title:"Buying & Selling NFTs â€” Bonding Curve Trading",description:"How to buy and sell Booster NFTs instantly via bonding curve pools. Understand price movements, slippage protection, and trading strategies."},pt:{title:"Comprando e Vendendo NFTs â€” Trading por Bonding Curve",description:"Como comprar e vender NFTs Booster instantaneamente via pools de bonding curve. Entenda preÃ§os, proteÃ§Ã£o contra slippage e estratÃ©gias."}},{id:"nft-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"intermediate",icon:"fa-clock",en:{title:"Renting an NFT â€” Affordable Boost",description:"Rent a Diamond NFT for a fraction of the purchase price. How to browse, rent, and maximize ROI by timing your claims."},pt:{title:"Alugando um NFT â€” Boost AcessÃ­vel",description:"Alugue um Diamond NFT por uma fraÃ§Ã£o do preÃ§o de compra. Como navegar, alugar e maximizar ROI cronometrando seus claims."}},{id:"nft-4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"intermediate",icon:"fa-tag",en:{title:"Listing Your NFT for Rent â€” Earn Passive BNB",description:"Turn idle NFTs into passive income. How to list on the rental market, set daily price, and collect BNB from tenants."},pt:{title:"Listando seu NFT pra Aluguel â€” Ganhe BNB Passivo",description:"Transforme NFTs parados em renda passiva. Como listar no mercado de aluguel, definir preÃ§o diÃ¡rio e coletar BNB."}},{id:"nft-5",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"intermediate",icon:"fa-fire",en:{title:"NFT Fusion â€” Combine, Split & Upgrade",description:"Fuse 2 same-tier NFTs into 1 higher tier. Split a high tier into 2 lower tiers. Advanced strategies for NFT management."},pt:{title:"NFT Fusion â€” Fundir, Dividir e Fazer Upgrade",description:"Funda 2 NFTs do mesmo tier em 1 de tier superior. Divida um tier alto em 2 inferiores. EstratÃ©gias avanÃ§adas de gestÃ£o de NFTs."}}],fortune:[{id:"fp-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:30",tag:"intermediate",icon:"fa-dice",en:{title:"Fortune Pool â€” How to Play",description:"Choose Easy (3x), Medium (15x) or Hard (75x). Understand commit-reveal mechanics, combos, and why no one can cheat."},pt:{title:"Fortune Pool â€” Como Jogar",description:"Escolha Easy (3x), Medium (15x) ou Hard (75x). Entenda o commit-reveal, combos e por que ninguÃ©m pode trapacear."}},{id:"fp-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"intermediate",icon:"fa-layer-group",en:{title:"Fortune Pool â€” Combo Mode & Strategies",description:"Play multiple tiers in one game for up to 93x multiplier. Combo bitmasks, prize pool mechanics, and bankroll management tips."},pt:{title:"Fortune Pool â€” Modo Combo e EstratÃ©gias",description:"Jogue mÃºltiplos tiers em um jogo sÃ³ para atÃ© 93x. Bitmasks de combo, mecÃ¢nica do prize pool e dicas de gestÃ£o de banca."}}],social:[{id:"ag-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"beginner",icon:"fa-comments",en:{title:"Agora â€” The Unstoppable Social Network",description:"Post, reply, follow, and earn. Create content that can never be censored or deleted. Your posts live on the blockchain forever."},pt:{title:"Agora â€” A Rede Social ImparÃ¡vel",description:"Poste, responda, siga e ganhe. Crie conteÃºdo que nunca pode ser censurado ou deletado. Seus posts vivem na blockchain pra sempre."}},{id:"ag-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:00",tag:"beginner",icon:"fa-heart",en:{title:"SuperLikes â€” Earn BNB from Your Content",description:"How SuperLikes send BNB directly to content creators. Build an audience and monetize without algorithms or middlemen."},pt:{title:"SuperLikes â€” Ganhe BNB com seu ConteÃºdo",description:"Como SuperLikes enviam BNB direto para criadores de conteÃºdo. Construa audiÃªncia e monetize sem algoritmos ou intermediÃ¡rios."}},{id:"ag-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"intermediate",icon:"fa-user-tag",en:{title:"Register Username & Build Your Profile",description:"Claim your unique handle, set up avatar and bio via IPFS, get a trust badge, and boost your profile visibility."},pt:{title:"Registre Username e Monte seu Perfil",description:"Registre seu handle Ãºnico, configure avatar e bio via IPFS, obtenha badge de confianÃ§a e aumente sua visibilidade."}}],utilities:[{id:"ut-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"beginner",icon:"fa-stamp",en:{title:"Digital Notary â€” Certify Documents Forever",description:"Certify any document on-chain without revealing its content. Hash-based proof of existence, batch certification, and free verification."},pt:{title:"CartÃ³rio Digital â€” Certifique Documentos pra Sempre",description:"Certifique qualquer documento on-chain sem revelar o conteÃºdo. Prova por hash, certificaÃ§Ã£o em lote e verificaÃ§Ã£o grÃ¡tis."}},{id:"ut-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"beginner",icon:"fa-hand-holding-heart",en:{title:"Fundraising â€” Create Campaigns Without Middlemen",description:"Launch a fundraising campaign in 30 seconds. Receive 100% of donations, withdraw anytime. No platform fees, no approval process."},pt:{title:"ArrecadaÃ§Ã£o â€” Crie Campanhas sem IntermediÃ¡rios",description:"Lance uma campanha em 30 segundos. Receba 100% das doaÃ§Ãµes, saque quando quiser. Sem taxa de plataforma, sem aprovaÃ§Ã£o."}},{id:"ut-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:00",tag:"beginner",icon:"fa-circle-dollar-to-slot",en:{title:"How to Donate to a Campaign",description:"Find campaigns, donate BNB directly to creators, and track donations on-chain. Full transparency, zero hidden fees."},pt:{title:"Como Doar para uma Campanha",description:"Encontre campanhas, doe BNB direto para criadores e acompanhe doaÃ§Ãµes on-chain. TransparÃªncia total, zero taxas ocultas."}},{id:"ut-4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"intermediate",icon:"fa-arrow-right-arrow-left",en:{title:"Swap BNB/BKC â€” Trade on the Liquidity Pool",description:"Swap BNB for BKC and vice-versa on the built-in AMM. Understand the 0.3% fee, price impact, and how the constant product formula works."},pt:{title:"Swap BNB/BKC â€” Troque no Pool de Liquidez",description:"Troque BNB por BKC e vice-versa no AMM integrado. Entenda a taxa de 0.3%, impacto no preÃ§o e a fÃ³rmula de produto constante."}},{id:"ut-5",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"intermediate",icon:"fa-droplet",en:{title:"Provide Liquidity â€” Earn 0.3% per Swap",description:"Add BNB and BKC to the liquidity pool and earn fees on every swap. How to add, remove, and calculate your share."},pt:{title:"Prover Liquidez â€” Ganhe 0.3% por Swap",description:"Adicione BNB e BKC ao pool de liquidez e ganhe taxas em cada swap. Como adicionar, remover e calcular sua fatia."}}],advanced:[{id:"ad-1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"advanced",icon:"fa-coins",en:{title:"BKC Tokenomics â€” Supply, Burns & Scarcity",description:"Deep dive into BKC economics: 200M cap, 0% team allocation, scarcity curve, 5 burn mechanisms, and why supply shrinks over time."},pt:{title:"Tokenomics do BKC â€” Supply, Burns e Escassez",description:"Mergulho profundo: teto de 200M, 0% pro time, curva de escassez, 5 mecanismos de burn e por que o supply encolhe com o tempo."}},{id:"ad-2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"2:30",tag:"advanced",icon:"fa-sitemap",en:{title:"Fees Explained â€” Where Every Cent Goes",description:"Complete breakdown of BNB and BKC fees. How fees flow to operators, tutors, stakers, burn, and treasury. Full transparency."},pt:{title:"Taxas Explicadas â€” Pra Onde Vai Cada Centavo",description:"Detalhamento completo das taxas BNB e BKC. Como fluem para operadores, tutores, delegadores, burn e tesouro."}},{id:"ad-3",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"advanced",icon:"fa-landmark",en:{title:"Governance â€” From Admin to DAO",description:"The 4 phases of progressive decentralization: Admin â†’ Multisig â†’ Timelock â†’ DAO. What can change and what's immutable forever."},pt:{title:"GovernanÃ§a â€” Do Admin ao DAO",description:"As 4 fases da descentralizaÃ§Ã£o progressiva: Admin â†’ Multisig â†’ Timelock â†’ DAO. O que pode mudar e o que Ã© imutÃ¡vel pra sempre."}},{id:"ad-4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:00",tag:"advanced",icon:"fa-code",en:{title:"For Developers â€” SDK & Smart Contracts",description:"The @backchain/sdk monorepo: 17 packages, event indexing, API helpers, and how to build on top of Backcoin. Developer quickstart."},pt:{title:"Para Desenvolvedores â€” SDK e Smart Contracts",description:"O monorepo @backchain/sdk: 17 pacotes, indexaÃ§Ã£o de eventos, API helpers e como construir no Backcoin. Quickstart para devs."}}]},Bw=[{key:"overview",icon:"star",color:"amber",en:{title:"What is Backcoin",desc:"6 videos â€” Overview, Earning, opBNB & Tutor Guide"},pt:{title:"O Que Ã© o Backcoin",desc:"6 vÃ­deos â€” VisÃ£o Geral, Ganhos, opBNB e Guia Tutor"}},{key:"gettingStarted",icon:"rocket",color:"emerald",en:{title:"Getting Started",desc:"3 videos â€” Setup & First Steps"},pt:{title:"Primeiros Passos",desc:"3 vÃ­deos â€” ConfiguraÃ§Ã£o Inicial"}},{key:"stakingMining",icon:"coins",color:"yellow",en:{title:"Staking & Mining",desc:"4 videos â€” Delegate, Claim, Unstake & Buyback"},pt:{title:"Staking e MineraÃ§Ã£o",desc:"4 vÃ­deos â€” Delegar, Clamar, Unstake e Buyback"}},{key:"nfts",icon:"gem",color:"purple",en:{title:"NFTs â€” Boosters, Trading & Rental",desc:"5 videos â€” Buy, Sell, Rent, List & Fuse"},pt:{title:"NFTs â€” Boosters, Trading e Aluguel",desc:"5 vÃ­deos â€” Comprar, Vender, Alugar, Listar e Fundir"}},{key:"fortune",icon:"dice",color:"red",en:{title:"Fortune Pool",desc:"2 videos â€” Play & Strategies"},pt:{title:"Fortune Pool",desc:"2 vÃ­deos â€” Jogar e EstratÃ©gias"}},{key:"social",icon:"comments",color:"cyan",en:{title:"Agora â€” Social Network",desc:"3 videos â€” Post, Earn & Build Profile"},pt:{title:"Agora â€” Rede Social",desc:"3 vÃ­deos â€” Postar, Ganhar e Montar Perfil"}},{key:"utilities",icon:"toolbox",color:"blue",en:{title:"Utilities",desc:"5 videos â€” Notary, Fundraising, Swap & Liquidity"},pt:{title:"Utilidades",desc:"5 vÃ­deos â€” CartÃ³rio, ArrecadaÃ§Ã£o, Swap e Liquidez"}},{key:"advanced",icon:"graduation-cap",color:"rose",en:{title:"Advanced & Vision",desc:"4 videos â€” Tokenomics, Fees, Governance & Dev Guide"},pt:{title:"AvanÃ§ado e VisÃ£o",desc:"4 vÃ­deos â€” Tokenomics, Taxas, GovernanÃ§a e Dev Guide"}}],Yg={en:{heroTitle:"Master the Backcoin Ecosystem",heroSubtitle:"Complete video tutorials covering every feature â€” from your first BKC to building your own operator business",videoCount:"Videos",languages:"2 Languages",allCategories:"All Categories",tagBeginner:"Beginner",tagIntermediate:"Intermediate",tagAdvanced:"Advanced",comingSoon:"Video coming soon",watchNow:"Watch",subscribe:"Subscribe on YouTube",filterAll:"All",filterBeginner:"Beginner",filterIntermediate:"Intermediate",filterAdvanced:"Advanced"},pt:{heroTitle:"Domine o Ecossistema Backcoin",heroSubtitle:"Tutoriais completos em vÃ­deo cobrindo cada recurso â€” do seu primeiro BKC a construir seu prÃ³prio negÃ³cio de operador",videoCount:"VÃ­deos",languages:"2 Idiomas",allCategories:"Todas as Categorias",tagBeginner:"Iniciante",tagIntermediate:"IntermediÃ¡rio",tagAdvanced:"AvanÃ§ado",comingSoon:"VÃ­deo em breve",watchNow:"Assistir",subscribe:"Inscreva-se no YouTube",filterAll:"Todos",filterBeginner:"Iniciante",filterIntermediate:"IntermediÃ¡rio",filterAdvanced:"AvanÃ§ado"}};let Tt=localStorage.getItem("backcoin-tutorials-lang")||"pt",Se="all";function qg(){return Object.values(ol).reduce((e,t)=>e+t.length,0)}function Aw(e){const t={amber:{bg:"rgba(245,158,11,0.15)",text:"#f59e0b",border:"rgba(245,158,11,0.3)"},emerald:{bg:"rgba(52,211,153,0.15)",text:"#34d399",border:"rgba(52,211,153,0.3)"},yellow:{bg:"rgba(250,204,21,0.15)",text:"#facc15",border:"rgba(250,204,21,0.3)"},purple:{bg:"rgba(168,85,247,0.15)",text:"#a855f7",border:"rgba(168,85,247,0.3)"},red:{bg:"rgba(239,68,68,0.15)",text:"#ef4444",border:"rgba(239,68,68,0.3)"},cyan:{bg:"rgba(34,211,238,0.15)",text:"#22d3ee",border:"rgba(34,211,238,0.3)"},blue:{bg:"rgba(59,130,246,0.15)",text:"#3b82f6",border:"rgba(59,130,246,0.3)"},rose:{bg:"rgba(251,113,133,0.15)",text:"#fb7185",border:"rgba(251,113,133,0.3)"}};return t[e]||t.amber}function Iw(e){return e==="beginner"?{bg:"rgba(52,211,153,0.15)",text:"#34d399"}:e==="intermediate"?{bg:"rgba(245,158,11,0.15)",text:"#f59e0b"}:{bg:"rgba(239,68,68,0.15)",text:"#ef4444"}}function Pw(e,t){const a=e[Tt],n=Iw(e.tag),o=Yg[Tt][`tag${e.tag.charAt(0).toUpperCase()+e.tag.slice(1)}`];return`
        <a href="${!a.url||a.url===Fi?Fi:a.url}" target="_blank" rel="noopener noreferrer"
           class="group block rounded-xl overflow-hidden transition-all duration-300 hover:-translate-y-1"
           style="background:var(--dash-surface-2, #1c1c21);border:1px solid var(--dash-border, rgba(255,255,255,0.06))">
            <div class="relative overflow-hidden" style="aspect-ratio:16/9;background:#0a0a0f">
                <img src="${e.thumbnail}" alt="${a.title}"
                     style="width:100%;height:100%;object-fit:cover;transition:transform 0.3s"
                     class="group-hover:scale-105"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div style="display:none;width:100%;height:100%;align-items:center;justify-content:center;background:linear-gradient(135deg,#1a1a2e,#16213e)">
                    <i class="fa-solid ${e.icon||"fa-play"}" style="font-size:32px;color:rgba(245,158,11,0.3)"></i>
                </div>
                <!-- Play overlay -->
                <div style="position:absolute;inset:0;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s" class="group-hover:opacity-100">
                    <div style="width:50px;height:50px;border-radius:50%;background:#f59e0b;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(245,158,11,0.4)">
                        <i class="fa-solid fa-play" style="color:#000;font-size:18px;margin-left:3px"></i>
                    </div>
                </div>
                <!-- Number badge -->
                <span style="position:absolute;top:8px;left:8px;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);padding:3px 8px;border-radius:6px;font-size:11px;font-weight:800;color:#f59e0b">#${t+1}</span>
                <!-- Duration -->
                <span style="position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,0.8);padding:3px 8px;border-radius:6px;font-size:11px;font-weight:600;color:#fff">${e.duration}</span>
            </div>
            <div style="padding:14px">
                <div style="display:flex;align-items:center;gap:6px;margin-bottom:8px">
                    <i class="fa-solid ${e.icon||"fa-play"}" style="font-size:12px;color:rgba(255,255,255,0.3)"></i>
                    <h3 style="font-weight:700;color:#fff;font-size:13px;margin:0;line-height:1.3;flex:1">${a.title}</h3>
                </div>
                <p style="color:rgba(255,255,255,0.45);font-size:11px;line-height:1.5;margin:0 0 10px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">${a.description}</p>
                <span style="display:inline-block;font-size:10px;font-weight:700;text-transform:uppercase;padding:3px 8px;border-radius:4px;letter-spacing:0.05em;background:${n.bg};color:${n.text}">${o}</span>
            </div>
        </a>
    `}function Nw(e,t,a){const n=e[Tt],o=Aw(e.color),s=Se==="all"?t:t.filter(c=>c.tag===Se);if(s.length===0)return{html:"",nextIndex:a};let i="",r=a;return s.forEach(c=>{const d=Object.values(ol).flat().indexOf(c);i+=Pw(c,d>=0?d:r),r++}),{html:`
        <div style="margin-bottom:40px">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,0.06)">
                <div style="width:40px;height:40px;border-radius:10px;background:${o.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                    <i class="fa-solid fa-${e.icon}" style="color:${o.text};font-size:16px"></i>
                </div>
                <div>
                    <h2 style="font-size:17px;font-weight:700;color:#fff;margin:0">${n.title}</h2>
                    <p style="font-size:11px;color:rgba(255,255,255,0.35);margin:2px 0 0">${n.desc}</p>
                </div>
            </div>
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px">
                ${i}
            </div>
        </div>
    `,nextIndex:r}}function zw(e){Tt=e,localStorage.setItem("backcoin-tutorials-lang",e),document.querySelectorAll(".tutorials-lang-btn").forEach(t=>{const a=t.dataset.lang===e;t.style.background=a?"#f59e0b":"rgba(255,255,255,0.06)",t.style.color=a?"#000":"rgba(255,255,255,0.6)"}),sl()}function $w(e){Se=e,document.querySelectorAll(".tutorials-filter-btn").forEach(t=>{const a=t.dataset.filter===e;t.style.background=a?"rgba(245,158,11,0.15)":"transparent",t.style.color=a?"#f59e0b":"rgba(255,255,255,0.4)",t.style.borderColor=a?"rgba(245,158,11,0.3)":"rgba(255,255,255,0.08)"}),sl()}function sl(){const e=document.getElementById("tutorials-content");if(!e)return;const t=Yg[Tt],a=qg();let n=`
        <!-- Hero -->
        <div style="text-align:center;margin-bottom:32px">
            <h1 style="font-size:28px;font-weight:800;margin:0 0 8px">
                <span style="background:linear-gradient(135deg,#f59e0b,#fbbf24,#f59e0b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">
                    ${t.heroTitle}
                </span>
            </h1>
            <p style="color:rgba(255,255,255,0.45);max-width:600px;margin:0 auto 16px;font-size:13px;line-height:1.5">${t.heroSubtitle}</p>
            <div style="display:flex;align-items:center;justify-content:center;gap:16px">
                <div style="display:flex;align-items:center;gap:6px;font-size:13px;color:rgba(255,255,255,0.4)">
                    <i class="fa-solid fa-video" style="color:#f59e0b"></i>
                    <span>${a} ${t.videoCount}</span>
                </div>
                <div style="width:4px;height:4px;border-radius:50%;background:rgba(255,255,255,0.15)"></div>
                <div style="display:flex;align-items:center;gap:6px;font-size:13px;color:rgba(255,255,255,0.4)">
                    <i class="fa-solid fa-language" style="color:#34d399"></i>
                    <span>${t.languages}</span>
                </div>
                <div style="width:4px;height:4px;border-radius:50%;background:rgba(255,255,255,0.15)"></div>
                <div style="display:flex;align-items:center;gap:6px;font-size:13px;color:rgba(255,255,255,0.4)">
                    <i class="fa-solid fa-layer-group" style="color:#a855f7"></i>
                    <span>8 ${Tt==="pt"?"Categorias":"Categories"}</span>
                </div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:28px;flex-wrap:wrap">
            <button class="tutorials-filter-btn" data-filter="all" onclick="TutorialsPage.setFilter('all')"
                    style="padding:6px 14px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;border:1px solid ${Se==="all"?"rgba(245,158,11,0.3)":"rgba(255,255,255,0.08)"};background:${Se==="all"?"rgba(245,158,11,0.15)":"transparent"};color:${Se==="all"?"#f59e0b":"rgba(255,255,255,0.4)"};transition:all 0.2s">
                ${t.filterAll} (${a})
            </button>
            <button class="tutorials-filter-btn" data-filter="beginner" onclick="TutorialsPage.setFilter('beginner')"
                    style="padding:6px 14px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;border:1px solid ${Se==="beginner"?"rgba(52,211,153,0.3)":"rgba(255,255,255,0.08)"};background:${Se==="beginner"?"rgba(52,211,153,0.15)":"transparent"};color:${Se==="beginner"?"#34d399":"rgba(255,255,255,0.4)"};transition:all 0.2s">
                ${t.filterBeginner}
            </button>
            <button class="tutorials-filter-btn" data-filter="intermediate" onclick="TutorialsPage.setFilter('intermediate')"
                    style="padding:6px 14px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;border:1px solid ${Se==="intermediate"?"rgba(245,158,11,0.3)":"rgba(255,255,255,0.08)"};background:${Se==="intermediate"?"rgba(245,158,11,0.15)":"transparent"};color:${Se==="intermediate"?"#f59e0b":"rgba(255,255,255,0.4)"};transition:all 0.2s">
                ${t.filterIntermediate}
            </button>
            <button class="tutorials-filter-btn" data-filter="advanced" onclick="TutorialsPage.setFilter('advanced')"
                    style="padding:6px 14px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;border:1px solid ${Se==="advanced"?"rgba(239,68,68,0.3)":"rgba(255,255,255,0.08)"};background:${Se==="advanced"?"rgba(239,68,68,0.15)":"transparent"};color:${Se==="advanced"?"#ef4444":"rgba(255,255,255,0.4)"};transition:all 0.2s">
                ${t.filterAdvanced}
            </button>
        </div>
    `,o=0;for(const s of Bw){const i=ol[s.key];if(!i)continue;const r=Nw(s,i,o);n+=r.html,o=r.nextIndex}n+=`
        <div style="text-align:center;padding:32px 20px;margin-top:20px;background:linear-gradient(135deg,rgba(245,158,11,0.08),rgba(239,68,68,0.05));border:1px solid rgba(245,158,11,0.15);border-radius:16px">
            <i class="fa-brands fa-youtube" style="font-size:36px;color:#ef4444;margin-bottom:12px"></i>
            <h3 style="font-size:16px;font-weight:700;color:#fff;margin:0 0 6px">${t.subscribe}</h3>
            <p style="font-size:12px;color:rgba(255,255,255,0.4);margin:0 0 16px">${Tt==="pt"?"Fique por dentro de novos tutoriais e atualizaÃ§Ãµes":"Stay updated with new tutorials and updates"}</p>
            <a href="${Fi}" target="_blank" rel="noopener noreferrer"
               style="display:inline-flex;align-items:center;gap:8px;background:#ef4444;color:#fff;padding:10px 24px;border-radius:10px;font-size:13px;font-weight:700;text-decoration:none;transition:all 0.2s;border:none"
               onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">
                <i class="fa-brands fa-youtube"></i>
                ${Tt==="pt"?"Inscrever-se":"Subscribe"}
            </a>
        </div>
    `,e.innerHTML=n}const Xg={render:function(e=!1){const t=document.getElementById("tutorials");t&&(e||t.innerHTML.trim()==="")&&(t.innerHTML=`
                <div style="max-width:1100px;margin:0 auto;padding:0 16px">
                    <!-- Header -->
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px">
                        <div style="display:flex;align-items:center;gap:12px">
                            <div style="width:42px;height:42px;border-radius:12px;background:rgba(34,211,238,0.15);display:flex;align-items:center;justify-content:center">
                                <i class="fa-solid fa-play-circle" style="color:#22d3ee;font-size:20px"></i>
                            </div>
                            <div>
                                <h1 style="font-size:20px;font-weight:800;color:#fff;margin:0">Video Tutorials</h1>
                                <p style="font-size:11px;color:rgba(255,255,255,0.35);margin:2px 0 0">${qg()} videos â€” ${Tt==="pt"?"Todas as funÃ§Ãµes do ecossistema":"Every ecosystem feature"}</p>
                            </div>
                        </div>

                        <!-- Language Switcher -->
                        <div style="display:flex;align-items:center;gap:4px;background:rgba(255,255,255,0.04);padding:4px;border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
                            <button class="tutorials-lang-btn" data-lang="en" onclick="TutorialsPage.setLang('en')"
                                    style="display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:none;transition:all 0.2s;${Tt==="en"?"background:#f59e0b;color:#000":"background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.6)"}">
                                <img src="./assets/en.png" alt="EN" style="width:18px;height:18px;border-radius:50%" onerror="this.style.display='none'">
                                EN
                            </button>
                            <button class="tutorials-lang-btn" data-lang="pt" onclick="TutorialsPage.setLang('pt')"
                                    style="display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;border:none;transition:all 0.2s;${Tt==="pt"?"background:#f59e0b;color:#000":"background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.6)"}">
                                <img src="./assets/pt.png" alt="PT" style="width:18px;height:18px;border-radius:50%" onerror="this.style.display='none'">
                                PT
                            </button>
                        </div>
                    </div>

                    <!-- Content Container -->
                    <div id="tutorials-content"></div>
                </div>
            `,sl())},update:function(e){},cleanup:function(){Se="all"},setLang:zw,setFilter:$w};window.TutorialsPage=Xg;const fa=window.ethers,Ko={ACTIVE:0,CLOSED:1},Ec={0:{label:"Active",color:"#10b981",icon:"fa-circle-play",bg:"bg-emerald-500/15"},1:{label:"Closed",color:"#3b82f6",icon:"fa-circle-check",bg:"bg-blue-500/15"},2:{label:"Withdrawn",color:"#8b5cf6",icon:"fa-circle-dollar-to-slot",bg:"bg-purple-500/15"}},Jg={getCampaigns:"https://getcharitycampaigns-4wvdcuoouq-uc.a.run.app",saveCampaign:"https://savecharitycampaign-4wvdcuoouq-uc.a.run.app",uploadMedia:"/api/upload-media"},Zg="https://sepolia.etherscan.io/address/",as={animal:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=800&q=80",humanitarian:"https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=800&q=80",environment:"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&q=80",medical:"https://images.unsplash.com/photo-1538108149393-fbbd81895907?w=800&q=80",education:"https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=800&q=80",disaster:"https://images.unsplash.com/photo-1547683905-f686c993aae5?w=800&q=80",community:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800&q=80",default:"https://images.unsplash.com/photo-1532629345422-7515f3d16bb6?w=800&q=80"},ze={animal:{name:"Animal Welfare",emoji:"ðŸ¾",color:"#10b981"},humanitarian:{name:"Humanitarian Aid",emoji:"ðŸ’—",color:"#ec4899"},environment:{name:"Environment",emoji:"ðŸŒ¿",color:"#22c55e"},medical:{name:"Medical & Health",emoji:"ðŸ©º",color:"#06b6d4"},education:{name:"Education & Youth",emoji:"ðŸ“š",color:"#8b5cf6"},disaster:{name:"Disaster Relief",emoji:"âš¡",color:"#ef4444"},community:{name:"Community & Social",emoji:"ðŸ¤",color:"#f59e0b"}},Sw=10*1024*1024,Lw=100*1024*1024,_w=["image/jpeg","image/png","image/gif","image/webp"],Rw=["video/mp4","video/webm","video/ogg"],Di=5,Mi=2,A={campaigns:[],stats:null,currentView:"main",currentCampaign:null,selectedCategory:null,isLoading:!1,carouselIndex:0,createStep:1,createCategory:null,createTitle:"",createDesc:"",createGoal:"",createDuration:"",createMedia:[],createMediaUrls:[],boostDays:7,boostCampaignId:null,boostCost:null,createFee:null,donateFee5pct:!0};function Fw(){if(document.getElementById("charity-styles-v2"))return;const e=document.createElement("style");e.id="charity-styles-v2",e.textContent=`
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes pulse-border { 0%, 100% { border-color: rgba(245,158,11,0.3); } 50% { border-color: rgba(245,158,11,0.6); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes glow-pulse { 0%, 100% { box-shadow: 0 0 8px rgba(245,158,11,0.2); } 50% { box-shadow: 0 0 20px rgba(245,158,11,0.5); } }

        .float-animation { animation: float 3s ease-in-out infinite; }
        .charity-page { max-width: 1200px; margin: 0 auto; padding: 1.5rem 1rem; min-height: 400px; }

        .cp-card-base {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .cp-card-base:hover { border-color: rgba(245,158,11,0.3); transform: translateY(-2px); }

        .cp-stat-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.7) 0%, rgba(24,24,27,0.8) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .cp-campaign-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .cp-campaign-card:hover { transform: translateY(-4px); border-color: rgba(245,158,11,0.4); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .cp-campaign-card:hover .cp-card-img-wrap img { transform: scale(1.05); }
        .cp-campaign-card.boosted { border-color: rgba(245,158,11,0.4); animation: glow-pulse 3s ease-in-out infinite; }
        .cp-card-img-wrap { position: relative; overflow: hidden; }
        .cp-card-img-wrap::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 60%; background: linear-gradient(to top, rgba(0,0,0,0.5), transparent); pointer-events: none; }
        .cp-campaign-card img { width: 100%; height: 200px; object-fit: cover; background: rgba(63,63,70,0.5); transition: transform 0.4s ease; }

        .cp-progress { height: 8px; background: rgba(63,63,70,0.5); border-radius: 4px; overflow: hidden; }
        .cp-progress-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; background: linear-gradient(90deg, #f59e0b, #d97706); }

        .cp-badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
        .cp-boosted-badge { background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(251,191,36,0.2)); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }

        .cp-btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 20px; border-radius: 10px; font-weight: 600; font-size: 14px; border: none; cursor: pointer; transition: all 0.2s ease; }
        .cp-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .cp-btn-primary { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000; }
        .cp-btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(245,158,11,0.3); }
        .cp-btn-secondary { background: rgba(63,63,70,0.8); color: #fafafa; border: 1px solid rgba(63,63,70,0.8); }
        .cp-btn-secondary:hover:not(:disabled) { background: rgba(63,63,70,1); }
        .cp-btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: #fff; }
        .cp-btn-success:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(16,185,129,0.3); }
        .cp-btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: #fff; }

        .cp-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 9999; align-items: center; justify-content: center; padding: 1rem; }
        .cp-modal.active { display: flex; }
        .cp-modal-content { background: linear-gradient(145deg, rgba(39,39,42,0.98) 0%, rgba(24,24,27,0.99) 100%); border: 1px solid rgba(63,63,70,0.5); border-radius: 20px; width: 100%; max-width: 520px; max-height: 90vh; overflow-y: auto; }
        .cp-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; border-bottom: 1px solid rgba(63,63,70,0.5); }
        .cp-modal-title { font-size: 1.125rem; font-weight: 700; color: #fafafa; display: flex; align-items: center; gap: 10px; margin: 0; }
        .cp-modal-close { background: none; border: none; color: #a1a1aa; font-size: 1.25rem; cursor: pointer; padding: 4px; }
        .cp-modal-close:hover { color: #fafafa; }
        .cp-modal-body { padding: 1.25rem; }
        .cp-modal-footer { display: flex; justify-content: flex-end; gap: 10px; padding: 1rem 1.25rem; border-top: 1px solid rgba(63,63,70,0.5); }

        .cp-form-group { margin-bottom: 1rem; }
        .cp-form-label { display: block; font-size: 12px; font-weight: 600; color: #fafafa; margin-bottom: 6px; }
        .cp-form-label span { color: #a1a1aa; font-weight: 400; }
        .cp-form-input { width: 100%; padding: 12px 14px; background: rgba(0,0,0,0.4); border: 2px solid rgba(63,63,70,0.5); border-radius: 10px; color: #fafafa; font-size: 14px; box-sizing: border-box; transition: all 0.2s; }
        .cp-form-input:focus { outline: none; border-color: rgba(245,158,11,0.6); }
        .cp-form-textarea { min-height: 100px; resize: vertical; }
        .cp-form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        .cp-donate-input-wrap { position: relative; }
        .cp-donate-input { width: 100%; padding: 1rem; padding-right: 4rem; font-size: 1.5rem; font-weight: 700; text-align: center; background: rgba(0,0,0,0.4); border: 2px solid rgba(63,63,70,0.5); border-radius: 12px; color: #fafafa; box-sizing: border-box; }
        .cp-donate-input:focus { outline: none; border-color: rgba(16,185,129,0.6); }
        .cp-donate-currency { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); color: #a1a1aa; font-weight: 600; }
        .cp-donate-presets { display: flex; gap: 8px; margin: 10px 0; }
        .cp-preset { flex: 1; padding: 8px; background: rgba(63,63,70,0.5); border: 1px solid rgba(63,63,70,0.8); border-radius: 8px; color: #fafafa; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .cp-preset:hover { background: rgba(63,63,70,0.8); }
        .cp-preset.active { background: rgba(245,158,11,0.2); border-color: rgba(245,158,11,0.5); color: #f59e0b; }

        .cp-media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; margin-top: 10px; }
        .cp-media-thumb { position: relative; width: 100%; aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 2px solid rgba(63,63,70,0.5); }
        .cp-media-thumb img, .cp-media-thumb video { width: 100%; height: 100%; object-fit: cover; }
        .cp-media-thumb .cp-media-remove { position: absolute; top: 4px; right: 4px; width: 22px; height: 22px; border-radius: 50%; background: rgba(239,68,68,0.9); color: #fff; border: none; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; }
        .cp-media-thumb .cp-media-type { position: absolute; bottom: 4px; left: 4px; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 700; background: rgba(0,0,0,0.7); color: #fff; }

        .cp-media-upload { border: 2px dashed rgba(63,63,70,0.8); border-radius: 12px; padding: 1.5rem; text-align: center; cursor: pointer; transition: all 0.2s; background: rgba(0,0,0,0.2); }
        .cp-media-upload:hover { border-color: rgba(245,158,11,0.5); background: rgba(245,158,11,0.05); }
        .cp-media-upload input { display: none; }

        .cp-carousel { position: relative; width: 100%; border-radius: 16px; overflow: hidden; margin-bottom: 1.5rem; }
        .cp-carousel img, .cp-carousel video { width: 100%; height: 350px; object-fit: cover; background: rgba(63,63,70,0.5); }
        .cp-carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 50%; background: rgba(0,0,0,0.6); color: #fff; border: none; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
        .cp-carousel-nav:hover { background: rgba(0,0,0,0.8); }
        .cp-carousel-nav.prev { left: 10px; }
        .cp-carousel-nav.next { right: 10px; }
        .cp-carousel-dots { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; }
        .cp-carousel-dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.4); cursor: pointer; border: none; }
        .cp-carousel-dot.active { background: #f59e0b; }

        .cp-share-box { background: rgba(63,63,70,0.3); border-radius: 12px; padding: 1rem; }
        .cp-share-title { font-size: 12px; color: #a1a1aa; margin-bottom: 10px; text-align: center; }
        .cp-share-btns { display: flex; justify-content: center; gap: 8px; }
        .cp-share-btn { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; font-size: 1rem; transition: all 0.2s; }
        .cp-share-btn:hover { transform: scale(1.1); }
        .cp-share-btn.twitter { background: #000; color: #fff; }
        .cp-share-btn.telegram { background: #0088cc; color: #fff; }
        .cp-share-btn.whatsapp { background: #25d366; color: #fff; }
        .cp-share-btn.copy { background: rgba(63,63,70,0.8); color: #fafafa; }

        .cp-empty { text-align: center; padding: 3rem 1rem; color: #a1a1aa; }
        .cp-empty i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
        .cp-empty h3 { color: #fafafa; margin: 0 0 8px; }
        .cp-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; gap: 1rem; }
        .cp-spinner { width: 40px; height: 40px; border: 3px solid rgba(63,63,70,0.5); border-top-color: #f59e0b; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .cp-step-container { display: flex; align-items: center; justify-content: space-between; position: relative; padding: 0 1rem; }
        .cp-step-item { display: flex; flex-direction: column; align-items: center; z-index: 1; }
        .cp-step-dot { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; transition: all 0.3s ease; }
        .cp-step-dot.pending { background: rgba(39,39,42,0.8); color: #71717a; border: 2px solid rgba(63,63,70,0.8); }
        .cp-step-dot.active { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #000; box-shadow: 0 0 20px rgba(245,158,11,0.4); }
        .cp-step-dot.done { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: #fff; }
        .cp-step-line { position: absolute; top: 20px; height: 3px; background: rgba(63,63,70,0.5); transition: all 0.5s ease; }
        .cp-step-line.ln-1 { left: 14%; width: 22%; }
        .cp-step-line.ln-2 { left: 39%; width: 22%; }
        .cp-step-line.ln-3 { left: 64%; width: 22%; }
        .cp-step-line.active { background: linear-gradient(90deg, #10b981, #f59e0b); }
        .cp-step-line.done { background: #10b981; }

        .cp-wiz-cat-card { background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%); border: 2px solid rgba(63,63,70,0.5); border-radius: 16px; padding: 1.5rem 1rem; cursor: pointer; transition: all 0.3s ease; text-align: center; }
        .cp-wiz-cat-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .cp-wiz-cat-card.selected { transform: translateY(-4px); border-color: #f59e0b; box-shadow: 0 12px 30px rgba(0,0,0,0.3); }

        .cp-wiz-summary { background: rgba(0,0,0,0.3); border: 1px solid rgba(63,63,70,0.5); border-radius: 12px; padding: 1rem; }
        .cp-wiz-summary-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 13px; }
        .cp-wiz-summary-row + .cp-wiz-summary-row { border-top: 1px solid rgba(63,63,70,0.3); }

        .cp-cat-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }

        .cp-boost-slider { width: 100%; accent-color: #f59e0b; }

        .cp-detail { max-width: 900px; margin: 0 auto; }
        .cp-detail-content { display: grid; grid-template-columns: 1fr 340px; gap: 1.5rem; }
        .cp-detail-sidebar { display: flex; flex-direction: column; gap: 1rem; }

        .cp-ref-box { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 10px; padding: 12px; }
        .cp-ref-link { display: flex; align-items: center; gap: 8px; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 8px 12px; word-break: break-all; font-size: 11px; color: #fbbf24; font-family: monospace; }

        .cp-skeleton-card { border-radius: 16px; overflow: hidden; background: linear-gradient(145deg, rgba(39,39,42,0.9), rgba(24,24,27,0.95)); border: 1px solid rgba(63,63,70,0.3); }
        .cp-skeleton-img { width: 100%; height: 200px; background: linear-gradient(90deg, rgba(63,63,70,0.3) 25%, rgba(63,63,70,0.5) 50%, rgba(63,63,70,0.3) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        .cp-skeleton-line { height: 12px; border-radius: 6px; background: linear-gradient(90deg, rgba(63,63,70,0.3) 25%, rgba(63,63,70,0.5) 50%, rgba(63,63,70,0.3) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; margin-bottom: 8px; }
        .cp-skeleton-line.short { width: 40%; }
        .cp-skeleton-line.medium { width: 70%; }
        .cp-skeleton-line.long { width: 100%; }
        .cp-skeleton-bar { height: 8px; border-radius: 4px; background: linear-gradient(90deg, rgba(63,63,70,0.3) 25%, rgba(63,63,70,0.5) 50%, rgba(63,63,70,0.3) 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; margin: 12px 0; }

        .cp-cat-scroll { display: flex; gap: 8px; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; padding-bottom: 4px; }
        .cp-cat-scroll::-webkit-scrollbar { display: none; }

        .cp-fee-preview { font-size: 12px; color: #a1a1aa; padding: 8px 12px; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center; margin-top: 8px; transition: all 0.3s; }
        .cp-fee-preview .fee-val { color: #f59e0b; font-weight: 600; }
        .cp-fee-preview .net-val { color: #10b981; font-weight: 600; }

        .cp-balance-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; font-size: 11px; }
        .cp-balance-row .bal { color: #a1a1aa; }
        .cp-balance-row .max-btn { color: #f59e0b; cursor: pointer; font-weight: 600; background: none; border: none; font-size: 11px; padding: 2px 6px; border-radius: 4px; }
        .cp-balance-row .max-btn:hover { background: rgba(245,158,11,0.1); }

        @media(max-width:768px) {
            .cp-detail-content { grid-template-columns: 1fr; }
            .cp-detail-sidebar { order: -1; }
            .cp-form-row { grid-template-columns: 1fr; }
            .cp-cat-grid { grid-template-columns: repeat(2, 1fr); }
            .cp-carousel img, .cp-carousel video { height: 220px; }
        }
        @media(max-width:640px) {
            .cp-cat-scroll { flex-wrap: nowrap; }
            .cp-cat-scroll .cp-btn { white-space: nowrap; flex-shrink: 0; }
        }
    `,document.head.appendChild(e)}const bt=e=>{try{const t=Number(e)/1e18;return t<1e-4?"0":t<1?t.toFixed(4):t<1e3?t.toFixed(2):t.toLocaleString("en-US",{maximumFractionDigits:2})}catch{return"0"}},Qg=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",Vs=(e,t)=>{const a=typeof e=="bigint"?e:BigInt(e||0),n=typeof t=="bigint"?t:BigInt(t||1);return n===0n?0:Math.min(100,Number(a*100n/n))},il=e=>{const t=Math.floor(Date.now()/1e3),a=Number(e)-t;if(a<=0)return{text:"Ended",color:"#ef4444"};const n=Math.floor(a/86400);return n>0?{text:`${n}d left`,color:"#10b981"}:{text:`${Math.floor(a/3600)}h left`,color:"#f59e0b"}},Dw=e=>{const t=Math.floor(Date.now()/1e3),a=e-t;if(a<=0)return null;const n=Math.floor(a/86400);return n>0?`${n}d`:`${Math.floor(a/3600)}h`},Da=e=>{var t;if(((t=e==null?void 0:e.mediaUrls)==null?void 0:t.length)>0){const a=e.mediaUrls.find(n=>n.type==="image");if(a)return a.url}return(e==null?void 0:e.imageUrl)||as[e==null?void 0:e.category]||as.default},Ys=e=>{const t=`${window.location.origin}${window.location.pathname}#charity/${e}`;return u!=null&&u.userAddress?`${t}?ref=${u.userAddress}`:t},em=()=>{const t=window.location.hash.match(/#charity\/(\d+)/);return t?t[1]:null},Mw=e=>{window.location.hash=`charity/${e}`},Ow=()=>{window.location.hash.startsWith("#charity/")&&(window.location.hash="charity")},qs=e=>Number(e.status)===Ko.ACTIVE&&Number(e.deadline)>Math.floor(Date.now()/1e3),tm=e=>{const t=Number(e.status),a=Number(e.deadline)<=Math.floor(Date.now()/1e3);return(t===Ko.ACTIVE||t===Ko.CLOSED)&&(a||t===Ko.CLOSED)&&BigInt(e.raisedAmount||e.raised||0)>0n};function am(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""}function Uw(e){let t=am(e);return t=t.replace(/(https?:\/\/[^\s<]+)/g,'<a href="$1" target="_blank" rel="noopener" class="text-amber-500 hover:text-amber-400" onclick="event.stopPropagation()">$1</a>'),t}function nm(){try{const e=window.location.hash.split("?");if(e.length<2)return;const a=new URLSearchParams(e[1]).get("ref");a&&fa.isAddress(a)&&(localStorage.setItem("bkc_operator",a),console.log("[Charity] Referral captured:",a))}catch{}}const om="charity-meta-";function Hw(e,t){try{localStorage.setItem(`${om}${e}`,JSON.stringify(t))}catch{}}function sm(e){try{return JSON.parse(localStorage.getItem(`${om}${e}`)||"null")}catch{return null}}async function qa(){A.isLoading=!0;try{const[e,t]=await Promise.all([fetch(Jg.getCampaigns).then(o=>o.json()).catch(()=>({campaigns:[]})),jw()]),a=(e==null?void 0:e.campaigns)||[];let n=0;try{n=await Ye.getCampaignCount()}catch(o){console.error("[CharityPage] getCampaignCount failed:",o)}if(n>0){let s=[];for(let i=1;i<=n;i+=50){const r=Math.min(50,n-i+1);try{const l=await Ye.getCampaignsBatch(i,r);s=s.concat(l)}catch(l){console.warn("[CharityPage] getCampaignsBatch failed, falling back:",l.message);for(let c=i;c<i+r;c++)try{const d=await Ye.getCampaign(c);s.push({...d,id:String(c)})}catch{}}}A.campaigns=s.map(i=>{const r=String(i.id),l=a.find(d=>String(d.id)===r),c=sm(r);return{...i,id:r,title:(l==null?void 0:l.title)||(c==null?void 0:c.title)||i.title||`Campaign #${r}`,description:(l==null?void 0:l.description)||(c==null?void 0:c.description)||i.metadataUri||"",metadataUri:i.metadataUri||"",category:(l==null?void 0:l.category)||(c==null?void 0:c.category)||"humanitarian",imageUrl:(l==null?void 0:l.imageUrl)||(c==null?void 0:c.imageUrl)||null,mediaUrls:(l==null?void 0:l.mediaUrls)||(c==null?void 0:c.mediaUrls)||[]}})}else A.campaigns=[];A.stats=t}catch(e){console.error("[CharityPage] loadData error:",e)}finally{A.isLoading=!1}}async function jw(){try{const e=await Ye.getStats();return{raised:e.totalDonated,fees:e.totalEthFees,created:e.totalCampaigns,withdrawn:e.totalWithdrawn,boostRevenue:e.totalBoostRevenue}}catch(e){return console.error("[CharityPage] loadStats error:",e),null}}async function Ww(e){return(await ja(e,{})).url}function Gw(e){const t=Array.from(e.target.files||[]);for(const a of t){const n=Rw.includes(a.type),o=_w.includes(a.type);if(!o&&!n){x(`Unsupported file: ${a.name}`,"error");continue}if(o&&a.size>Sw){x("Image must be less than 10MB","error");continue}if(n&&a.size>Lw){x("Video must be less than 100MB","error");continue}const s=A.createMedia.filter(c=>c.type==="image").length,i=A.createMedia.filter(c=>c.type==="video").length;if(o&&s>=Di){x(`Maximum ${Di} images`,"warning");continue}if(n&&i>=Mi){x(`Maximum ${Mi} videos`,"warning");continue}const r=n?"video":"image",l=new FileReader;l.onload=c=>{A.createMedia.push({file:a,url:null,type:r,preview:c.target.result}),rl()},l.readAsDataURL(a)}e.target.value=""}function Kw(e){A.createMedia.splice(e,1),rl()}function rl(){const e=document.getElementById("wiz-media-grid");if(e){if(A.createMedia.length===0){e.innerHTML="";return}e.innerHTML=A.createMedia.map((t,a)=>`
        <div class="cp-media-thumb">
            ${t.type==="video"?`<video src="${t.preview}" muted></video>`:`<img src="${t.preview}" alt="media">`}
            <button class="cp-media-remove" onclick="event.stopPropagation();CharityPage.removeMedia(${a})">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <span class="cp-media-type">${t.type==="video"?"VIDEO":"IMG"}</span>
        </div>
    `).join("")}}const ll=e=>{const t=Ec[Number(e)]||Ec[0];return`<span class="cp-badge" style="background:${t.color}20;color:${t.color}"><i class="fa-solid ${t.icon}"></i> ${t.label}</span>`},im=e=>{const t=Dw(e);return`<span class="cp-badge cp-boosted-badge"><i class="fa-solid fa-rocket"></i> Boosted${t?` ${t}`:""}</span>`},Vw=()=>{const e='<div class="cp-skeleton-card"><div class="cp-skeleton-img"></div><div style="padding:1rem"><div class="cp-skeleton-line short"></div><div class="cp-skeleton-line long"></div><div class="cp-skeleton-bar"></div><div class="cp-skeleton-line medium"></div></div></div>';return`<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">${e}${e}${e}</div>`},rm=e=>`<div class="cp-empty">
    <div style="font-size:4rem;margin-bottom:1rem;opacity:0.5"><i class="fa-solid fa-hand-holding-heart"></i></div>
    <h3 style="font-size:1.25rem;margin-bottom:0.5rem">${e}</h3>
    <p class="text-zinc-500 text-sm" style="max-width:360px;margin:0 auto 1.5rem">Create a campaign to raise BNB for a cause you care about. Share it and earn referral rewards!</p>
    <button class="cp-btn cp-btn-primary" onclick="CharityPage.openCreate()" style="margin:0 auto">
        <i class="fa-solid fa-plus"></i> Create Campaign
    </button>
    <div style="display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:1.5rem">
        ${Object.entries(ze).map(([t,a])=>`<button class="cp-btn cp-btn-secondary text-xs py-1.5 px-3" onclick="CharityPage.openCreate('${t}')" style="border-color:${a.color}30">${a.emoji} ${a.name}</button>`).join("")}
    </div>
</div>`,lm=e=>{var o,s,i,r,l,c;const t=Vs(e.raisedAmount,e.goalAmount),a=il(e.deadline),n=e.category||"humanitarian";return`
        <div class="cp-campaign-card ${e.isBoosted?"boosted":""}" onclick="CharityPage.viewCampaign('${e.id}')">
            <div class="cp-card-img-wrap">
                <img src="${Da(e)}" alt="${am(e.title||"")}" onerror="this.src='${as.default}'">
                <button class="cp-share-btn copy" style="position:absolute;top:10px;right:10px;width:32px;height:32px;font-size:12px;z-index:2"
                        onclick="event.stopPropagation();CharityPage.quickShare('${e.id}')">
                    <i class="fa-solid fa-share-nodes"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="flex flex-wrap gap-1.5 mb-2">
                    ${ll(e.status)}
                    <span class="cp-badge" style="background:${((o=ze[n])==null?void 0:o.color)||"#888"}20;color:${((s=ze[n])==null?void 0:s.color)||"#888"}">
                        ${((i=ze[n])==null?void 0:i.emoji)||""} ${((r=ze[n])==null?void 0:r.name)||n}
                    </span>
                    ${e.isBoosted?im(e.boostExpiry):""}
                </div>
                <h3 class="text-white font-bold text-sm mb-1 line-clamp-2">${e.title||""}</h3>
                <p class="text-zinc-500 text-xs mb-3">by <a href="${Zg}${e.creator}" target="_blank" class="text-amber-500 hover:text-amber-400" onclick="event.stopPropagation()">${Qg(e.creator)}</a></p>
                <div class="cp-progress mb-2">
                    <div class="cp-progress-fill" style="width:${t}%;background:linear-gradient(90deg,${((l=ze[n])==null?void 0:l.color)||"#f59e0b"},${((c=ze[n])==null?void 0:c.color)||"#d97706"}88)"></div>
                </div>
                <div class="flex justify-between text-xs mb-3">
                    <span class="text-white font-semibold"><i class="fa-solid fa-coins text-zinc-500 mr-1"></i>${bt(e.raisedAmount)} BNB</span>
                    <span class="text-zinc-500">${t}% of ${bt(e.goalAmount)}</span>
                </div>
                <div class="flex justify-between text-xs text-zinc-500 pt-2 border-t border-zinc-800">
                    <span><i class="fa-solid fa-heart mr-1"></i>${e.donationCount||0} donors</span>
                    <span style="color:${a.color}">${a.text}</span>
                </div>
            </div>
        </div>
    `},Tc=()=>{var n,o,s;const t=A.campaigns.filter(i=>qs(i)).filter(i=>!A.selectedCategory||i.category===A.selectedCategory).sort((i,r)=>i.isBoosted&&!r.isBoosted?-1:!i.isBoosted&&r.isBoosted?1:i.isBoosted&&r.isBoosted?(r.boostExpiry||0)-(i.boostExpiry||0):Number(r.deadline||0)-Number(i.deadline||0)),a=Object.entries(ze);return`
        <div class="charity-page">
            ${cm()}
            ${dm()}

            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center float-animation">
                        <i class="fa-solid fa-hand-holding-heart text-2xl text-amber-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Charity Pool</h1>
                        <p class="text-sm text-zinc-500">Support causes with BNB &bull; Share & earn referral rewards</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button class="cp-btn cp-btn-secondary" onclick="CharityPage.openMyCampaigns()">
                        <i class="fa-solid fa-folder-open"></i> My Campaigns
                    </button>
                    <button class="cp-btn cp-btn-primary" onclick="CharityPage.openCreate()">
                        <i class="fa-solid fa-plus"></i> Create
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-emerald-400 font-mono"><i class="fa-solid fa-coins text-lg mr-1"></i>${A.stats?bt(A.stats.raised):"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Total Donated</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-amber-400 font-mono">${((n=A.stats)==null?void 0:n.created)??"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Campaigns</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-blue-400 font-mono"><i class="fa-solid fa-coins text-lg mr-1"></i>${A.stats?bt(A.stats.fees):"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">BNB Fees</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-purple-400 font-mono"><i class="fa-solid fa-coins text-lg mr-1"></i>${A.stats?bt(A.stats.withdrawn):"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Withdrawn</p>
                </div>
            </div>

            <!-- Categories -->
            <div class="cp-cat-scroll mb-6">
                <button class="cp-btn ${A.selectedCategory?"cp-btn-secondary":"cp-btn-primary"} text-xs py-2 px-3" onclick="CharityPage.clearCat()">
                    All
                </button>
                ${a.map(([i,r])=>`
                    <button class="cp-btn ${A.selectedCategory===i?"cp-btn-primary":"cp-btn-secondary"} text-xs py-2 px-3"
                            onclick="CharityPage.selectCat('${i}')"
                            style="${A.selectedCategory===i?"":`border-color:${r.color}40`}">
                        ${r.emoji} ${r.name}
                    </button>
                `).join("")}
            </div>

            <!-- Campaigns Header -->
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-fire text-amber-500"></i>
                    ${A.selectedCategory?`${(o=ze[A.selectedCategory])==null?void 0:o.emoji} ${(s=ze[A.selectedCategory])==null?void 0:s.name}`:"Active Campaigns"}
                </h2>
                <span class="text-xs text-zinc-500">${t.length} campaigns</span>
            </div>

            <!-- Campaigns Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="cp-grid">
                ${t.length?t.map(i=>lm(i)).join(""):rm("No active campaigns")}
            </div>
        </div>
    `},Xs=e=>{var o;const t=((o=e.mediaUrls)==null?void 0:o.length)>0?e.mediaUrls:[{url:Da(e),type:"image"}];t.length===0&&t.push({url:Da(e),type:"image"});const a=A.carouselIndex%t.length,n=t[a];return`
        <div class="cp-carousel">
            ${n.type==="video"?`<video src="${n.url}" controls style="width:100%;height:350px;object-fit:cover;background:rgba(63,63,70,0.5)"></video>`:`<img src="${n.url}" alt="${e.title||""}" style="width:100%;height:350px;object-fit:cover;background:rgba(63,63,70,0.5)" onerror="this.src='${as.default}'">`}
            ${t.length>1?`
                <button class="cp-carousel-nav prev" onclick="CharityPage.carouselPrev()"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="cp-carousel-nav next" onclick="CharityPage.carouselNext()"><i class="fa-solid fa-chevron-right"></i></button>
                <div class="cp-carousel-dots">
                    ${t.map((s,i)=>`<button class="cp-carousel-dot ${i===a?"active":""}" onclick="CharityPage.carouselGo(${i})"></button>`).join("")}
                </div>
            `:""}
        </div>
    `},Cc=e=>{var r,l,c,d,f,g;if(!e)return`
        <div class="charity-page">
            <button class="cp-btn cp-btn-secondary mb-6" onclick="CharityPage.goBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>
            <div class="cp-empty"><i class="fa-solid fa-circle-question"></i><h3>Campaign not found</h3></div>
        </div>`;const t=Vs(e.raisedAmount,e.goalAmount),a=il(e.deadline),n=e.category||"humanitarian",o=qs(e),s=((r=e.creator)==null?void 0:r.toLowerCase())===((l=u==null?void 0:u.userAddress)==null?void 0:l.toLowerCase()),i=tm(e);return`
        <div class="charity-page">
            ${cm()}
            ${dm()}

            <div class="cp-detail">
                <!-- Header -->
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <button class="cp-btn cp-btn-secondary" onclick="CharityPage.goBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>
                    ${ll(e.status)}
                    <span class="cp-badge" style="background:${((c=ze[n])==null?void 0:c.color)||"#888"}20;color:${((d=ze[n])==null?void 0:d.color)||"#888"}">
                        ${((f=ze[n])==null?void 0:f.emoji)||""} ${((g=ze[n])==null?void 0:g.name)||n}
                    </span>
                    ${e.isBoosted?im(e.boostExpiry):""}
                    ${s?'<span class="cp-badge" style="background:rgba(245,158,11,0.2);color:#f59e0b"><i class="fa-solid fa-user"></i> Your Campaign</span>':""}
                </div>

                ${Xs(e)}

                <div class="cp-detail-content">
                    <!-- Main Content -->
                    <div class="cp-card-base p-6">
                        <h1 class="text-2xl font-bold text-white mb-2">${e.title}</h1>
                        <p class="text-sm text-zinc-500 mb-4">
                            Created by <a href="${Zg}${e.creator}" target="_blank" class="text-amber-500 hover:text-amber-400">${Qg(e.creator)}</a>
                        </p>
                        <p class="text-zinc-400 leading-relaxed whitespace-pre-wrap">${Uw(e.description||e.metadataUri||"No description provided.")}</p>
                    </div>

                    <!-- Sidebar -->
                    <div class="cp-detail-sidebar">
                        <!-- Progress Card -->
                        <div class="cp-card-base p-5">
                            <div class="cp-progress h-3 mb-3">
                                <div class="cp-progress-fill" style="width:${t}%"></div>
                            </div>
                            <p class="text-3xl font-bold text-white mb-1"><i class="fa-solid fa-coins text-zinc-500"></i> ${bt(e.raisedAmount)} BNB</p>
                            <p class="text-sm text-zinc-500 mb-4">raised of ${bt(e.goalAmount)} BNB goal (${t}%)</p>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="text-center p-3 bg-zinc-800/50 rounded-xl">
                                    <p class="text-lg font-bold text-white">${e.donationCount||0}</p>
                                    <p class="text-[10px] text-zinc-500 uppercase">Donors</p>
                                </div>
                                <div class="text-center p-3 bg-zinc-800/50 rounded-xl">
                                    <p class="text-lg font-bold" style="color:${a.color}">${a.text}</p>
                                    <p class="text-[10px] text-zinc-500 uppercase">${o?"Remaining":"Status"}</p>
                                </div>
                            </div>
                        </div>

                        ${o?`
                        <!-- Donate Card -->
                        <div class="cp-card-base p-5">
                            <h4 class="text-sm font-bold text-white mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-heart text-emerald-500"></i> Make a Donation
                            </h4>
                            <div class="cp-balance-row">
                                <span class="bal">Balance: <span id="detail-bal">${u!=null&&u.ethBalance?Number(fa.formatEther(u.ethBalance)).toFixed(4):"--"}</span> BNB</span>
                                <button class="max-btn" onclick="CharityPage.setMax('detail-amount')">MAX</button>
                            </div>
                            <input type="number" id="detail-amount" placeholder="Amount in BNB" min="0.001" step="0.001"
                                   class="cp-form-input text-center text-lg font-bold mb-2"
                                   oninput="CharityPage.updateDonatePreview('detail-amount','detail-fee-preview')">
                            <div class="cp-donate-presets mb-3" id="detail-presets">
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.01,'detail-amount')">0.01</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.05,'detail-amount')">0.05</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.1,'detail-amount')">0.1</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.5,'detail-amount')">0.5</button>
                            </div>
                            <button id="btn-donate-detail" class="cp-btn cp-btn-success w-full" onclick="CharityPage.donateDetail('${e.id}')">
                                <i class="fa-solid fa-heart"></i> Donate Now
                            </button>
                            <div class="cp-fee-preview mt-2" id="detail-fee-preview">
                                ~<strong>5%</strong> platform fee &bull; ~<strong>95%</strong> to campaign
                            </div>
                        </div>
                        `:""}

                        ${s&&o?`
                        <button id="btn-close-campaign" class="cp-btn cp-btn-danger w-full" onclick="CharityPage.closeCampaign('${e.id}')">
                            <i class="fa-solid fa-xmark"></i> Close Campaign
                        </button>`:""}

                        ${s&&i?`
                        <button id="btn-withdraw" class="cp-btn cp-btn-primary w-full" onclick="CharityPage.withdraw('${e.id}')">
                            <i class="fa-solid fa-wallet"></i> Withdraw Funds
                        </button>`:""}

                        ${o?`
                        <button class="cp-btn cp-btn-secondary w-full" onclick="CharityPage.openBoost('${e.id}')">
                            <i class="fa-solid fa-rocket"></i> Boost Campaign
                        </button>`:""}

                        <!-- Share -->
                        <div class="cp-share-box">
                            <p class="cp-share-title">Share this campaign & earn referral rewards</p>
                            <div class="cp-share-btns mb-3">
                                <button class="cp-share-btn twitter" onclick="CharityPage.share('twitter')"><i class="fa-brands fa-x-twitter"></i></button>
                                <button class="cp-share-btn telegram" onclick="CharityPage.share('telegram')"><i class="fa-brands fa-telegram"></i></button>
                                <button class="cp-share-btn whatsapp" onclick="CharityPage.share('whatsapp')"><i class="fa-brands fa-whatsapp"></i></button>
                                <button class="cp-share-btn copy" onclick="CharityPage.copyLink()"><i class="fa-solid fa-link"></i></button>
                            </div>
                            ${u!=null&&u.userAddress?`
                            <div class="cp-ref-box">
                                <p class="text-[10px] text-amber-400 mb-1 font-semibold">Your referral link:</p>
                                <div class="cp-ref-link">
                                    <span class="flex-1 truncate">${Ys(e.id)}</span>
                                    <button class="text-amber-500 hover:text-amber-400" onclick="CharityPage.copyLink()"><i class="fa-solid fa-copy"></i></button>
                                </div>
                                <p class="text-[9px] text-zinc-500 mt-1">Anyone who donates via your link earns you referral rewards!</p>
                            </div>`:""}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `},cm=()=>`
    <div class="cp-modal" id="modal-donate" onclick="if(event.target===this) CharityPage.closeModal('donate')">
        <div class="cp-modal-content">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-heart text-emerald-500"></i> Donate</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('donate')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body">
                <div id="donate-campaign-info"></div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Amount (BNB)</label>
                    <div class="cp-balance-row">
                        <span class="bal">Balance: <span id="donate-bal">${u!=null&&u.ethBalance?Number(fa.formatEther(u.ethBalance)).toFixed(4):"--"}</span> BNB</span>
                        <button class="max-btn" onclick="CharityPage.setMax('donate-amount')">MAX</button>
                    </div>
                    <div class="cp-donate-input-wrap">
                        <input type="number" id="donate-amount" class="cp-donate-input" placeholder="0.1" min="0.001" step="0.001"
                               oninput="CharityPage.updateDonatePreview('donate-amount','donate-fee-preview')">
                        <span class="cp-donate-currency">BNB</span>
                    </div>
                    <div class="cp-donate-presets" id="donate-presets">
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.01,'donate-amount')">0.01</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.05,'donate-amount')">0.05</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.1,'donate-amount')">0.1</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.5,'donate-amount')">0.5</button>
                    </div>
                </div>
                <div class="cp-fee-preview" id="donate-fee-preview">
                    ~<strong>5%</strong> platform fee &bull; ~<strong>95%</strong> goes to campaign
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.closeModal('donate')">Cancel</button>
                <button id="btn-donate" class="cp-btn cp-btn-success" onclick="CharityPage.donate()"><i class="fa-solid fa-heart"></i> Donate</button>
            </div>
        </div>
    </div>`,dm=()=>`
    <div class="cp-modal" id="modal-boost" onclick="if(event.target===this) CharityPage.closeModal('boost')">
        <div class="cp-modal-content">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-rocket text-amber-500"></i> Boost Campaign</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('boost')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body">
                <p class="text-sm text-zinc-400 mb-4">Boost this campaign to appear at the top. Duration stacks with existing boost.</p>
                <div class="cp-form-group">
                    <label class="cp-form-label">Duration: <strong id="boost-days-label">${A.boostDays}</strong> days</label>
                    <input type="range" id="boost-days-slider" class="cp-boost-slider" min="1" max="30" value="${A.boostDays}"
                           oninput="CharityPage.updateBoostDays(this.value)">
                    <div class="flex justify-between text-[10px] text-zinc-500"><span>1 day</span><span>30 days</span></div>
                </div>
                <div class="text-center p-4 bg-zinc-800/50 rounded-xl mb-4">
                    <p class="text-xs text-zinc-500 mb-1">Estimated cost</p>
                    <p class="text-2xl font-bold text-amber-400" id="boost-cost-display">
                        <i class="fa-solid fa-coins mr-1"></i><span id="boost-cost-value">...</span> BNB
                    </p>
                    <p class="text-[10px] text-zinc-600 mt-1" id="boost-per-day-display"></p>
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.closeModal('boost')">Cancel</button>
                <button id="btn-boost" class="cp-btn cp-btn-primary" onclick="CharityPage.confirmBoost()">
                    <i class="fa-solid fa-rocket"></i> Boost
                </button>
            </div>
        </div>
    </div>`,Yw=()=>`
    <div class="cp-modal" id="modal-my" onclick="if(event.target===this) CharityPage.closeModal('my')">
        <div class="cp-modal-content" style="max-width:600px">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-folder-open text-amber-500"></i> My Campaigns</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('my')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body" style="max-height:60vh;overflow-y:auto">
                <div id="my-campaigns-list"></div>
            </div>
        </div>
    </div>`,qw=()=>`
    <div class="charity-page">
        <div class="flex items-center gap-4 mb-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.cancelCreate()"><i class="fa-solid fa-arrow-left"></i></button>
            <div>
                <h1 class="text-xl font-bold text-white">Create Campaign</h1>
                <p class="text-sm text-zinc-500">Step ${A.createStep} of 4</p>
            </div>
        </div>
        <div class="cp-card-base p-5 mb-6">
            <div class="cp-step-container">
                <div class="cp-step-line ln-1" id="cp-ln-1"></div>
                <div class="cp-step-line ln-2" id="cp-ln-2"></div>
                <div class="cp-step-line ln-3" id="cp-ln-3"></div>
                ${[1,2,3,4].map(e=>`
                    <div class="cp-step-item">
                        <div class="cp-step-dot ${A.createStep>e?"done":A.createStep===e?"active":"pending"}" id="cp-step-${e}">
                            ${A.createStep>e?'<i class="fa-solid fa-check text-sm"></i>':e}
                        </div>
                        <span class="text-[10px] text-zinc-500 mt-2">${["Category","Details","Media","Confirm"][e-1]}</span>
                    </div>
                `).join("")}
            </div>
        </div>
        <div class="cp-card-base p-6" id="cp-wiz-panel"></div>
    </div>`;function Js(){const e=document.getElementById("cp-wiz-panel");if(e)switch(A.createStep){case 1:Xw(e);break;case 2:Jw(e);break;case 3:Zw(e);break;case 4:Qw(e);break}}function Xw(e){const t=Object.entries(ze);e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Choose a Category</h2>
        <p class="text-sm text-zinc-500 mb-6">Select what type of cause your campaign supports</p>
        <div class="cp-cat-grid">
            ${t.map(([a,n])=>`
                <div class="cp-wiz-cat-card ${A.createCategory===a?"selected":""}" style="${A.createCategory===a?`border-color:${n.color}`:""}"
                     onclick="CharityPage.wizardSelectCategory('${a}')">
                    <div class="text-2xl mb-2">${n.emoji}</div>
                    <div class="text-xs font-bold text-white">${n.name}</div>
                </div>
            `).join("")}
        </div>
        <div class="flex justify-end mt-6">
            <button class="cp-btn cp-btn-primary ${A.createCategory?"":"opacity-50 cursor-not-allowed"}"
                    onclick="CharityPage.wizardNext()" ${A.createCategory?"":"disabled"}>
                Next <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>`}function Jw(e){e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Campaign Details</h2>
        <p class="text-sm text-zinc-500 mb-6">Tell your story â€” what is this campaign about?</p>
        <div class="cp-form-group">
            <label class="cp-form-label">Title *</label>
            <input type="text" id="wiz-title" class="cp-form-input" placeholder="Give your campaign a clear title" maxlength="100"
                   value="${A.createTitle.replace(/"/g,"&quot;")}">
        </div>
        <div class="cp-form-group">
            <label class="cp-form-label">Description *</label>
            <textarea id="wiz-desc" class="cp-form-input cp-form-textarea" placeholder="Describe the cause, how funds will be used, and why it matters..."
                      maxlength="2000" style="min-height:140px">${A.createDesc}</textarea>
        </div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>
            <button class="cp-btn cp-btn-primary" onclick="CharityPage.wizardNext()">Next <i class="fa-solid fa-arrow-right"></i></button>
        </div>`}function Zw(e){const t=A.createMedia.filter(n=>n.type==="image").length,a=A.createMedia.filter(n=>n.type==="video").length;e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Campaign Media</h2>
        <p class="text-sm text-zinc-500 mb-4">Add images and videos to attract more donors <span class="text-zinc-600">(optional)</span></p>
        <p class="text-xs text-zinc-500 mb-4">
            <i class="fa-solid fa-image mr-1"></i> ${t}/${Di} images &bull;
            <i class="fa-solid fa-video mr-1"></i> ${a}/${Mi} videos
        </p>
        <div class="cp-media-upload" onclick="document.getElementById('wiz-media-file').click()">
            <input type="file" id="wiz-media-file" accept="image/*,video/mp4,video/webm,video/ogg" multiple onchange="CharityPage.handleMediaSelect(event)">
            <div style="font-size:2rem;color:#a1a1aa;margin-bottom:8px"><i class="fa-solid fa-cloud-arrow-up"></i></div>
            <div style="font-size:13px;color:#a1a1aa"><span style="color:#f59e0b;font-weight:600">Click to upload</span> images or videos<br><small>PNG, JPG, GIF, WebP (10MB) &bull; MP4, WebM (100MB)</small></div>
        </div>
        <div class="cp-media-grid" id="wiz-media-grid"></div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>
            <div class="flex gap-2">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardNext()">
                    ${A.createMedia.length>0?"Next":"Skip"} <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>`,setTimeout(rl,50)}function Qw(e){const t=ze[A.createCategory]||ze.humanitarian;e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Confirm & Launch</h2>
        <p class="text-sm text-zinc-500 mb-6">Set your goal, duration and review before launching</p>
        <div class="cp-form-row mb-4">
            <div class="cp-form-group">
                <label class="cp-form-label">Goal (BNB) *</label>
                <input type="number" id="wiz-goal" class="cp-form-input" placeholder="1.0" min="0.01" step="0.01" value="${A.createGoal}">
            </div>
            <div class="cp-form-group">
                <label class="cp-form-label">Duration (Days) * <span>1-365</span></label>
                <input type="number" id="wiz-duration" class="cp-form-input" placeholder="30" min="1" max="365" value="${A.createDuration}">
            </div>
        </div>
        <div class="cp-wiz-summary mb-4">
            <h4 class="text-sm font-bold text-white mb-3"><i class="fa-solid fa-clipboard-list text-amber-500 mr-2"></i>Summary</h4>
            <div class="cp-wiz-summary-row"><span class="text-zinc-500">Category</span><span class="text-white">${t.emoji} ${t.name}</span></div>
            <div class="cp-wiz-summary-row"><span class="text-zinc-500">Title</span><span class="text-white truncate ml-4" style="max-width:200px">${A.createTitle||"â€”"}</span></div>
            <div class="cp-wiz-summary-row"><span class="text-zinc-500">Description</span><span class="text-white">${A.createDesc?`${A.createDesc.length} chars`:"â€”"}</span></div>
            <div class="cp-wiz-summary-row"><span class="text-zinc-500">Media</span><span class="text-white">${A.createMedia.length>0?`${A.createMedia.length} files`:"None"}</span></div>
        </div>
        <div class="text-center text-xs text-zinc-500 p-3 bg-zinc-800/50 rounded-xl mb-4">
            <i class="fa-solid fa-coins text-amber-400 mr-1"></i>
            Campaign creation requires a small <strong class="text-amber-400">BNB fee</strong> (gas + ecosystem fee)
        </div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>
            <button id="btn-wizard-launch" class="cp-btn cp-btn-primary" onclick="CharityPage.wizardLaunch()">
                <i class="fa-solid fa-rocket"></i> Launch Campaign
            </button>
        </div>`}function e1(e){A.createCategory=e,Js()}function t1(){var e,t,a,n;switch(A.createStep){case 1:if(!A.createCategory)return x("Select a category","error");break;case 2:{const o=((t=(e=document.getElementById("wiz-title"))==null?void 0:e.value)==null?void 0:t.trim())||"",s=((n=(a=document.getElementById("wiz-desc"))==null?void 0:a.value)==null?void 0:n.trim())||"";if(A.createTitle=o,A.createDesc=s,!o)return x("Enter a title","error");if(!s)return x("Enter a description","error");break}}A.createStep=Math.min(4,A.createStep+1),Js()}function a1(){n1(),A.createStep=Math.max(1,A.createStep-1),Js()}function um(){A.currentView="main",A.createStep=1,A.createCategory=null,A.createTitle="",A.createDesc="",A.createGoal="",A.createDuration="",A.createMedia=[],Ft()}function n1(){switch(A.createStep){case 2:{const e=document.getElementById("wiz-title"),t=document.getElementById("wiz-desc");e&&(A.createTitle=e.value),t&&(A.createDesc=t.value);break}case 4:{const e=document.getElementById("wiz-goal"),t=document.getElementById("wiz-duration");e&&(A.createGoal=e.value),t&&(A.createDuration=t.value);break}}}async function o1(){var c,d,f;if(!(u!=null&&u.isConnected))return x("Connect wallet","warning");const e=(c=document.getElementById("wiz-goal"))==null?void 0:c.value,t=(d=document.getElementById("wiz-duration"))==null?void 0:d.value;if(A.createGoal=e||"",A.createDuration=t||"",!A.createCategory)return x("Select a category","error");if(!A.createTitle)return x("Enter a title","error");if(!A.createDesc)return x("Enter a description","error");if(!e||parseFloat(e)<.01)return x("Goal must be at least 0.01 BNB","error");if(!t||parseInt(t)<1||parseInt(t)>365)return x("Duration must be 1-365 days","error");let a=[];if(A.createMedia.length>0){x(`Uploading ${A.createMedia.length} file(s) to Arweave...`,"info");for(const g of A.createMedia)if(g.file)try{const m=await Ww(g.file);a.push({url:m,type:g.type})}catch(m){console.error("Upload failed:",m),x(`Failed to upload ${g.type}: ${m.message}`,"warning")}a.length>0&&x(`${a.length} file(s) uploaded!`,"success")}const n=((f=a.find(g=>g.type==="image"))==null?void 0:f.url)||"",o=A.createTitle,s=A.createDesc,i=A.createCategory,r=fa.parseEther(e),l=parseInt(t);await Ye.createCampaign({title:o,metadataUri:s,goalAmount:r,durationDays:l,button:document.getElementById("btn-wizard-launch"),onSuccess:async(g,m)=>{if(m){Hw(m,{imageUrl:n,category:i,title:o,description:s,mediaUrls:a});try{await fetch(Jg.saveCampaign,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m,title:o,description:s,category:i,imageUrl:n,mediaUrls:a,creator:u.userAddress})})}catch{}}x("Campaign created!","success"),um(),await qa(),Ft()},onError:g=>{var m;!g.cancelled&&g.type!=="user_rejected"&&x(((m=g.message)==null?void 0:m.slice(0,80))||"Failed","error")}})}function Zs(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.add("active")}function Na(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.remove("active")}function s1(e=null){A.createStep=e?2:1,A.createCategory=e,A.createTitle="",A.createDesc="",A.createGoal="",A.createDuration="",A.createMedia=[],A.currentView="create",Ft()}function i1(e){const t=A.campaigns.find(o=>o.id===e||o.id===String(e));if(!t)return;const a=document.getElementById("donate-campaign-info");a&&(a.innerHTML=`
            <div class="flex items-center gap-3 p-3 bg-zinc-800/50 rounded-xl mb-4">
                <img src="${Da(t)}" class="w-12 h-12 rounded-lg object-cover">
                <div class="flex-1 min-w-0">
                    <p class="text-white font-semibold text-sm truncate">${t.title}</p>
                    <p class="text-zinc-500 text-xs">${Vs(t.raisedAmount,t.goalAmount)}% funded</p>
                </div>
            </div>`);const n=document.getElementById("donate-amount");n&&(n.value=""),A.currentCampaign=t,Zs("donate")}function r1(){var o;if(!document.getElementById("modal-my")){const s=document.createElement("div");s.innerHTML=Yw(),document.body.appendChild(s.firstElementChild)}const t=(o=u==null?void 0:u.userAddress)==null?void 0:o.toLowerCase(),a=A.campaigns.filter(s=>{var i;return((i=s.creator)==null?void 0:i.toLowerCase())===t}),n=document.getElementById("my-campaigns-list");n&&(a.length===0?n.innerHTML=`
            <div class="cp-empty">
                <i class="fa-solid fa-folder-open"></i>
                <h3>No campaigns yet</h3>
                <p class="text-zinc-600 text-sm mb-4">Create your first campaign to start raising funds</p>
                <button class="cp-btn cp-btn-primary" onclick="CharityPage.closeModal('my');CharityPage.openCreate()">
                    <i class="fa-solid fa-plus"></i> Create Campaign
                </button>
            </div>`:n.innerHTML=a.map(s=>{const i=Vs(s.raisedAmount,s.goalAmount),r=tm(s),l=il(s.deadline),c=qs(s);return`
                <div class="flex items-center gap-3 p-3 bg-zinc-800/30 rounded-xl mb-2 hover:bg-zinc-800/50 transition-colors">
                    <img src="${Da(s)}" class="w-14 h-14 rounded-lg object-cover cursor-pointer" onclick="CharityPage.viewCampaign('${s.id}')">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <p class="text-white font-semibold text-sm truncate cursor-pointer hover:text-amber-400" onclick="CharityPage.viewCampaign('${s.id}')" style="margin:0">${s.title}</p>
                            ${ll(s.status)}
                        </div>
                        <p class="text-zinc-500 text-xs" style="margin:0">
                            <i class="fa-solid fa-coins"></i> <strong class="text-white">${bt(s.raisedAmount)}</strong> / ${bt(s.goalAmount)} BNB (${i}%)
                            &bull; <span style="color:${l.color}">${l.text}</span>
                        </p>
                    </div>
                    <div class="flex gap-2">
                        ${c?`<button class="cp-btn cp-btn-danger text-xs py-1.5 px-3" onclick="event.stopPropagation();CharityPage.closeCampaign('${s.id}')" title="Close"><i class="fa-solid fa-xmark"></i></button>`:""}
                        ${r?`<button id="btn-withdraw-${s.id}" class="cp-btn cp-btn-primary text-xs py-1.5 px-3" onclick="event.stopPropagation();CharityPage.withdraw('${s.id}')" title="Withdraw"><i class="fa-solid fa-wallet"></i></button>`:""}
                    </div>
                </div>`}).join(""),Zs("my"))}function l1(e){A.boostCampaignId=e,A.boostDays=7,Zs("boost"),pm()}async function c1(e){A.boostDays=parseInt(e);const t=document.getElementById("boost-days-label");t&&(t.textContent=A.boostDays),await pm()}async function pm(){const e=document.getElementById("boost-cost-value"),t=document.getElementById("boost-per-day-display");if(e)try{const a=await Ye.getBoostCost(A.boostDays);A.boostCost=a,e.textContent=a.totalFeeFormatted,t&&(t.textContent=`${a.feePerDayFormatted} BNB/day`)}catch{e.textContent="...",t&&(t.textContent="")}}function d1(e,t){const a=document.getElementById(t||"donate-amount")||document.getElementById("detail-amount");if(a){a.value=e;const n=t==="detail-amount"?"detail-presets":"donate-presets",o=document.getElementById(n);o&&o.querySelectorAll(".cp-preset").forEach(i=>{i.classList.toggle("active",i.textContent.trim()===String(e))}),cl(t||"donate-amount",t==="detail-amount"?"detail-fee-preview":"donate-fee-preview")}}function u1(e){if(!(u!=null&&u.ethBalance))return;const t=Number(fa.formatEther(u.ethBalance))-.001;if(t<=0){x("Insufficient BNB balance","error");return}const a=document.getElementById(e);a&&(a.value=Math.floor(t*1e4)/1e4,cl(e,e==="detail-amount"?"detail-fee-preview":"donate-fee-preview"))}let Bc=null;function cl(e,t){clearTimeout(Bc),Bc=setTimeout(async()=>{const a=document.getElementById(e),n=document.getElementById(t);if(!a||!n)return;const o=parseFloat(a.value);if(!o||o<.001){n.innerHTML="~<strong>5%</strong> platform fee &bull; ~<strong>95%</strong> goes to campaign";return}try{const s=await Ye.previewDonation(fa.parseEther(String(o)));n.innerHTML=`Fee: <span class="fee-val">${s.feeFormatted} BNB</span> &bull; Campaign receives: <span class="net-val">${s.netFormatted} BNB</span>`}catch{const s=(o*.05).toFixed(4),i=(o*.95).toFixed(4);n.innerHTML=`Fee: <span class="fee-val">~${s} BNB</span> &bull; Campaign receives: <span class="net-val">~${i} BNB</span>`}},300)}async function p1(){var a;if(!(u!=null&&u.isConnected))return x("Connect wallet","warning");const e=A.currentCampaign;if(!e)return;const t=(a=document.getElementById("donate-amount"))==null?void 0:a.value;if(!t||parseFloat(t)<.001)return x("Minimum 0.001 BNB","error");await Ye.donate({campaignId:e.id,amount:fa.parseEther(t),button:document.getElementById("btn-donate"),onSuccess:async()=>{x("Thank you for your donation!","success"),Na("donate"),await qa(),Ft()},onError:n=>{var o;!n.cancelled&&n.type!=="user_rejected"&&x(((o=n.message)==null?void 0:o.slice(0,80))||"Failed","error")}})}async function f1(e){var a;if(!(u!=null&&u.isConnected))return x("Connect wallet","warning");const t=(a=document.getElementById("detail-amount"))==null?void 0:a.value;if(!t||parseFloat(t)<.001)return x("Minimum 0.001 BNB","error");await Ye.donate({campaignId:e,amount:fa.parseEther(t),button:document.getElementById("btn-donate-detail"),onSuccess:async()=>{x("Thank you for your donation!","success"),await qa(),await Xa(e)},onError:n=>{var o;!n.cancelled&&n.type!=="user_rejected"&&x(((o=n.message)==null?void 0:o.slice(0,80))||"Failed","error")}})}async function g1(e){if(!(u!=null&&u.isConnected))return x("Connect wallet","warning");confirm("Close this campaign? You can still withdraw raised funds.")&&await Ye.closeCampaign({campaignId:e,button:document.getElementById("btn-close-campaign"),onSuccess:async()=>{x("Campaign closed","success"),await qa(),Ft()},onError:t=>{var a;!t.cancelled&&t.type!=="user_rejected"&&x(((a=t.message)==null?void 0:a.slice(0,80))||"Failed","error")}})}async function m1(e){if(!(u!=null&&u.isConnected))return x("Connect wallet","warning");const t=A.campaigns.find(a=>a.id===e||a.id===String(e));t&&confirm(`Withdraw ${bt(t.raisedAmount)} BNB?`)&&await Ye.withdraw({campaignId:e,button:document.getElementById(`btn-withdraw-${e}`)||document.getElementById("btn-withdraw"),onSuccess:async()=>{var a;x("Funds withdrawn successfully!","success"),Na("my"),await qa(),Ft(),((a=A.currentCampaign)==null?void 0:a.id)===e&&await Xa(e)},onError:a=>{var n;!a.cancelled&&a.type!=="user_rejected"&&x(((n=a.message)==null?void 0:n.slice(0,80))||"Failed","error")}})}async function Ac(){if(!(u!=null&&u.isConnected))return x("Connect wallet","warning");const e=A.boostCampaignId;e&&await Ye.boostCampaign({campaignId:e,days:A.boostDays,button:document.getElementById("btn-boost"),onSuccess:async()=>{var t;x(`Campaign boosted for ${A.boostDays} days!`,"success"),Na("boost"),await qa(),((t=A.currentCampaign)==null?void 0:t.id)===String(e)?await Xa(e):Ft()},onError:t=>{var a;!t.cancelled&&t.type!=="user_rejected"&&x(((a=t.message)==null?void 0:a.slice(0,80))||"Failed","error")}})}function b1(e){const t=A.currentCampaign;if(!t)return;const a=Ys(t.id),n=`Support "${t.title}" on Backcoin Charity!

${bt(t.raisedAmount)} BNB raised of ${bt(t.goalAmount)} goal.

Donate now and make a difference:
`;if(e==="native"&&navigator.share){navigator.share({title:t.title,text:n,url:a}).catch(()=>{});return}let o;e==="twitter"?o=`https://twitter.com/intent/tweet?text=${encodeURIComponent(n)}&url=${encodeURIComponent(a)}`:e==="telegram"?o=`https://t.me/share/url?url=${encodeURIComponent(a)}&text=${encodeURIComponent(n)}`:e==="whatsapp"&&(o=`https://wa.me/?text=${encodeURIComponent(n+a)}`),o&&window.open(o,"_blank","width=600,height=400")}function x1(){const e=A.currentCampaign;e&&navigator.clipboard.writeText(Ys(e.id)).then(()=>x("Referral link copied!","success")).catch(()=>x("Copy failed","error"))}function h1(e){const t=Ys(e);if(navigator.share){const a=A.campaigns.find(n=>n.id===e);navigator.share({title:(a==null?void 0:a.title)||"Charity Campaign",url:t}).catch(()=>{})}else navigator.clipboard.writeText(t).then(()=>x("Referral link copied!","success")).catch(()=>x("Copy failed","error"))}function fm(){Ow(),A.currentCampaign=null,A.currentView="main",A.carouselIndex=0,Ft()}function v1(e){Na("my"),Na("donate"),Na("boost"),Mw(e),Xa(e)}function y1(e){A.selectedCategory=A.selectedCategory===e?null:e,dl()}function w1(){A.selectedCategory=null,dl()}function k1(){var n;const e=A.currentCampaign;if(!e)return;const t=((n=e.mediaUrls)==null?void 0:n.length)>0?e.mediaUrls:[{url:Da(e),type:"image"}];A.carouselIndex=(A.carouselIndex-1+t.length)%t.length;const a=document.querySelector(".cp-carousel");a&&(a.outerHTML=Xs(e))}function E1(){var n;const e=A.currentCampaign;if(!e)return;const t=((n=e.mediaUrls)==null?void 0:n.length)>0?e.mediaUrls:[{url:Da(e),type:"image"}];A.carouselIndex=(A.carouselIndex+1)%t.length;const a=document.querySelector(".cp-carousel");a&&(a.outerHTML=Xs(e))}function T1(e){A.carouselIndex=e;const t=A.currentCampaign;if(!t)return;const a=document.querySelector(".cp-carousel");a&&(a.outerHTML=Xs(t))}function dl(){const e=document.getElementById("cp-grid");if(!e)return;let t=A.campaigns.filter(a=>qs(a));A.selectedCategory&&(t=t.filter(a=>a.category===A.selectedCategory)),t.sort((a,n)=>a.isBoosted&&!n.isBoosted?-1:!a.isBoosted&&n.isBoosted?1:a.isBoosted&&n.isBoosted?(n.boostExpiry||0)-(a.boostExpiry||0):Number(n.deadline||0)-Number(a.deadline||0)),e.innerHTML=t.length?t.map(a=>lm(a)).join(""):rm("No campaigns")}async function Xa(e){A.currentView="detail",A.isLoading=!0,A.carouselIndex=0;const t=Oi();t&&(t.innerHTML=Vw());try{let a=A.campaigns.find(n=>n.id===e||n.id===String(e));if(!a)try{const n=await Ye.getCampaign(e),o=sm(e);a={...n,id:String(e),title:n.title||(o==null?void 0:o.title)||`Campaign #${e}`,description:(o==null?void 0:o.description)||n.metadataUri||"",category:(o==null?void 0:o.category)||"humanitarian",imageUrl:(o==null?void 0:o.imageUrl)||null,mediaUrls:(o==null?void 0:o.mediaUrls)||[]}}catch(n){console.error(`[CharityPage] loadDetail(${e}) failed:`,n)}A.currentCampaign=a,t&&(t.innerHTML=Cc(a))}catch{t&&(t.innerHTML=Cc(null))}finally{A.isLoading=!1}}function Oi(){let e=document.getElementById("charity-container");if(e)return e;const t=document.getElementById("charity");return t?(e=document.createElement("div"),e.id="charity-container",t.innerHTML="",t.appendChild(e),e):null}function Ft(){Fw(),nm();const e=Oi();if(!e)return;if(A.currentView==="create"){e.innerHTML=qw(),Js();return}const t=em();t?Xa(t):(A.currentView="main",A.currentCampaign=null,e.innerHTML=Tc(),qa().then(()=>{if(A.currentView==="main"){const a=Oi();a&&(a.innerHTML=Tc())}}))}async function C1(){A.campaigns=[],A.stats=null,A.currentView==="detail"&&A.currentCampaign?await Xa(A.currentCampaign.id):Ft()}window.addEventListener("hashchange",()=>{var e;if(window.location.hash.startsWith("#charity")){nm();const t=em();t?((e=A.currentCampaign)==null?void 0:e.id)!==t&&Xa(t):A.currentView!=="main"&&fm()}});const B1={render(e){e&&Ft()},update(){A.currentView==="main"&&dl()},refresh:C1,openModal:Zs,closeModal:Na,openCreate:s1,openDonate:i1,openMyCampaigns:r1,openBoost:l1,donate:p1,donateDetail:f1,closeCampaign:g1,withdraw:m1,boostCampaign:Ac,confirmBoost:Ac,updateBoostDays:c1,setAmt:d1,setMax:u1,updateDonatePreview:cl,goBack:fm,viewCampaign:v1,selectCat:y1,clearCat:w1,share:b1,copyLink:x1,quickShare:h1,carouselPrev:k1,carouselNext:E1,carouselGo:T1,handleMediaSelect:Gw,removeMedia:Kw,wizardSelectCategory:e1,wizardNext:t1,wizardBack:a1,cancelCreate:um,wizardLaunch:o1},gm="https://sepolia.etherscan.io/address/",A1="https://sepolia.etherscan.io/tx/",Ca={default:2e3,verified:5e3,premium:2e4,elite:5e4},I1=10313523,oa=I1,Tn=[{id:0,name:"General",icon:"fa-globe",color:"#8b8b9e"},{id:1,name:"News",icon:"fa-newspaper",color:"#f59e0b"},{id:2,name:"Politics",icon:"fa-landmark-dome",color:"#6366f1"},{id:3,name:"Comedy",icon:"fa-face-laugh-squint",color:"#facc15"},{id:4,name:"Sports",icon:"fa-futbol",color:"#fb923c"},{id:5,name:"Crypto",icon:"fa-bitcoin-sign",color:"#f7931a"},{id:6,name:"Tech",icon:"fa-microchip",color:"#3b82f6"},{id:7,name:"Art",icon:"fa-palette",color:"#f472b6"},{id:8,name:"Music",icon:"fa-music",color:"#a78bfa"},{id:9,name:"Gaming",icon:"fa-gamepad",color:"#ec4899"},{id:10,name:"Business",icon:"fa-briefcase",color:"#10b981"},{id:11,name:"Education",icon:"fa-graduation-cap",color:"#14b8a6"},{id:12,name:"Lifestyle",icon:"fa-heart",color:"#e879f9"},{id:13,name:"Adult",icon:"fa-fire",color:"#ef4444"},{id:14,name:"Random",icon:"fa-shuffle",color:"#6b7280"}],ya=[{code:"en",name:"English",flag:"ðŸ‡ºðŸ‡¸"},{code:"pt",name:"PortuguÃªs",flag:"ðŸ‡§ðŸ‡·"},{code:"es",name:"EspaÃ±ol",flag:"ðŸ‡ªðŸ‡¸"},{code:"fr",name:"FranÃ§ais",flag:"ðŸ‡«ðŸ‡·"},{code:"de",name:"Deutsch",flag:"ðŸ‡©ðŸ‡ª"},{code:"zh",name:"ä¸­æ–‡",flag:"ðŸ‡¨ðŸ‡³"},{code:"ja",name:"æ—¥æœ¬èªž",flag:"ðŸ‡¯ðŸ‡µ"},{code:"ko",name:"í•œêµ­ì–´",flag:"ðŸ‡°ðŸ‡·"},{code:"ru",name:"Ð ÑƒÑÑÐºÐ¸Ð¹",flag:"ðŸ‡·ðŸ‡º"},{code:"ar",name:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",flag:"ðŸ‡¸ðŸ‡¦"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"tr",name:"TÃ¼rkÃ§e",flag:"ðŸ‡¹ðŸ‡·"}],Ic={image:{max:10*1024*1024,types:["image/jpeg","image/png","image/gif","image/webp"],label:"10MB"},video:{max:100*1024*1024,types:["video/mp4","video/webm","video/ogg"],label:"100MB"}},ns=10;var Kc;const p={view:"feed",activeTab:"feed",viewHistory:[],posts:[],trendingPosts:[],allItems:[],replies:new Map,likesMap:new Map,replyCountMap:new Map,repostCountMap:new Map,postsById:new Map,userProfile:null,profiles:new Map,hasProfile:null,following:new Set,followers:new Set,followCounts:new Map,pendingMedia:[],isUploadingImage:!1,pendingImage:null,pendingImagePreview:null,pendingMediaType:null,selectedPost:null,selectedProfile:null,wizStep:1,wizUsername:"",wizDisplayName:"",wizBio:"",wizUsernameOk:null,wizFee:null,wizChecking:!1,wizLanguage:((Kc=navigator.language)==null?void 0:Kc.slice(0,2))||"en",fees:{post:0n,reply:0n,like:0n,follow:0n,repost:0n,downvote:0n,boostStd:0n,boostFeat:0n,badge:0n},hasBadge:!1,badgeTier:0,isBoosted:!1,boostExpiry:0,badgeExpiry:0,blockedAuthors:new Set,selectedTag:-1,selectedLanguage:null,composeTag:0,feedPage:0,feedMode:"tiktok",globalStats:null,isLoading:!1,isPosting:!1,contractAvailable:!0,error:null,liveStream:null,isLive:!1,liveViewerCount:0,activeRooms:new Map,watchingStreamId:null,actionCart:[],cartVisible:!1,cartSubmitting:!1,_render:()=>{}};function ra(){return p.hasBadge?p.badgeTier>=2?Ca.elite:p.badgeTier>=1?Ca.premium:Ca.verified:Ca.default}function mm(){return E.agora||E.backchat||E.Backchat||null}function vt(){return E.operator||E.treasury||null}function Pc(e){if(!e||e===0)return"";const t=Math.floor(Date.now()/1e3),a=e-t;if(a<=0)return"(expired)";const n=Math.floor(a/86400);return n>0?`(${n}d left)`:`(${Math.floor(a/3600)}h left)`}function P1(){const e=Math.floor(Date.now()/1e3);let t="";if(p.isBoosted&&p.boostExpiry>0){const a=Math.floor((p.boostExpiry-e)/86400);a<=7&&a>0&&(t+=`<div style="padding:8px 16px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.15);border-radius:8px;margin-top:8px;font-size:12px;color:var(--bc-accent);display:flex;align-items:center;gap:6px;">
                <i class="fa-solid fa-clock"></i> Boost expires in ${a} day${a!==1?"s":""} â€”
                <button class="bc-btn bc-btn-primary" style="padding:4px 12px;font-size:11px;" onclick="AgoraPage.openBoost()">Renew</button>
            </div>`)}if(p.hasBadge&&p.badgeExpiry>0){const a=Math.floor((p.badgeExpiry-e)/86400);a<=30&&a>0&&(t+=`<div style="padding:8px 16px;background:rgba(245,158,11,0.08);border:1px solid rgba(245,158,11,0.15);border-radius:8px;margin-top:8px;font-size:12px;color:var(--bc-accent);display:flex;align-items:center;gap:6px;">
                <i class="fa-solid fa-clock"></i> Badge expires in ${a} day${a!==1?"s":""} â€”
                <button class="bc-btn bc-btn-primary" style="padding:4px 12px;font-size:11px;" onclick="AgoraPage.openBadge()">Renew</button>
            </div>`)}return t}const N1=window.ethers;function os(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function Ui(e){const a=Date.now()/1e3-e;return a<60?"now":a<3600?`${Math.floor(a/60)}m`:a<86400?`${Math.floor(a/3600)}h`:a<604800?`${Math.floor(a/86400)}d`:new Date(e*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Cn(e){if(!e||e===0n)return"0";const t=parseFloat(N1.formatEther(e));return t<1e-4?"<0.0001":t<.01?t.toFixed(4):t<1?t.toFixed(3):t.toFixed(2)}function nt(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function ul(e){return En(e)||""}function Nc(e){const t={text:"",media:[],mediaCID:"",isVideo:!1};if(!e)return t;const a=e.indexOf(`
[gallery]`);if(a!==-1){const s=e.slice(0,a),i=e.slice(a+10).trim().split("|").map(l=>l.startsWith("vid:")?{cid:l.slice(4),type:"video"}:l.startsWith("img:")?{cid:l.slice(4),type:"image"}:{cid:l,type:"image"}).filter(l=>l.cid),r=i[0]||null;return{text:s,media:i,mediaCID:(r==null?void 0:r.cid)||"",isVideo:(r==null?void 0:r.type)==="video"}}const n=e.indexOf(`
[vid]`);if(n!==-1){const s=e.slice(n+6).trim();return{text:e.slice(0,n),media:[{cid:s,type:"video"}],mediaCID:s,isVideo:!0}}const o=e.indexOf(`
[img]`);if(o!==-1){const s=e.slice(o+6).trim();return{text:e.slice(0,o),media:[{cid:s,type:"image"}],mediaCID:s,isVideo:!1}}return{text:e,media:[],mediaCID:"",isVideo:!1}}function bi(e){if(!e)return{displayName:"",bio:"",avatar:"",language:""};try{const t=JSON.parse(e);return{displayName:t.displayName||"",bio:t.bio||"",avatar:t.avatar||"",language:t.language||""}}catch{return{displayName:"",bio:"",avatar:"",language:""}}}function bm(e){if(!e)return"";let t=e.replace(/(https?:\/\/[^\s<]+)/g,'<a href="$1" target="_blank" rel="noopener" style="color:var(--bc-accent);text-decoration:none;" onclick="event.stopPropagation()">$1</a>');return t=t.replace(/@([a-z0-9_]{1,15})/g,(a,n)=>{let o=null;for(const[s,i]of p.profiles)if(i.username===n){o=s;break}return o?`<span style="color:var(--bc-accent);cursor:pointer;" onclick="event.stopPropagation(); AgoraPage.viewProfile('${o}')">@${n}</span>`:`<span style="color:var(--bc-accent);">@${n}</span>`}),t}function co(e){return e?e.slice(2,4).toUpperCase():"?"}function xm(e){if(!e)return"";const t=p.profiles.get(e.toLowerCase());return t!=null&&t.avatar?ul(t.avatar):""}function hm(e){const t=xm(e),a=pl(e),n=a?a.charAt(0).toUpperCase():co(e);return t?`<img src="${t}" alt="" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" onerror="this.outerHTML='${n}'">`:n}function za(e){if(!e)return"?";const t=p.profiles.get(e.toLowerCase());return t!=null&&t.displayName?t.displayName:t!=null&&t.username?`@${t.username}`:os(e)}function pl(e){var t;return e&&((t=p.profiles.get(e.toLowerCase()))==null?void 0:t.username)||null}function z1(e){var t;return(e==null?void 0:e.toLowerCase())===((t=u.userAddress)==null?void 0:t.toLowerCase())?p.isBoosted:!1}function $1(e){var t;return(e==null?void 0:e.toLowerCase())===((t=u.userAddress)==null?void 0:t.toLowerCase())?p.hasBadge:!1}function S1(e){return Tn[e]||Tn[0]}function L1(){if(document.getElementById("agora-styles-v13"))return;["agora-styles-v11","backchat-styles-v70"].forEach(a=>{var n;return(n=document.getElementById(a))==null?void 0:n.remove()});const t=document.createElement("style");t.id="agora-styles-v13",t.textContent=`
        :root {
            --bc-bg: #0a0a0c; --bc-bg2: #111115; --bc-bg3: #1a1a20;
            --bc-surface: #212128; --bc-border: rgba(255,255,255,0.06);
            --bc-border-h: rgba(255,255,255,0.1); --bc-text: #ededf0;
            --bc-text-2: #9898a8; --bc-text-3: #58586a;
            --bc-accent: #f59e0b; --bc-accent-2: #d97706;
            --bc-accent-glow: rgba(245,158,11,0.12);
            --bc-red: #ef4444; --bc-green: #22c55e; --bc-blue: #3b82f6;
            --bc-purple: #8b5cf6; --bc-cyan: #06b6d4;
            --bc-radius: 14px; --bc-radius-sm: 10px; --bc-radius-lg: 20px;
            --bc-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes bc-fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        @keyframes bc-scaleIn { from { opacity:0; transform:scale(0.95); } to { opacity:1; transform:scale(1); } }
        @keyframes bc-spin { to { transform:rotate(360deg); } }
        @keyframes bc-like-pop { 0% { transform:scale(1); } 40% { transform:scale(1.35); } 100% { transform:scale(1); } }
        @keyframes bc-pulse-ring { 0% { box-shadow:0 0 0 0 rgba(245,158,11,0.4); } 70% { box-shadow:0 0 0 8px rgba(245,158,11,0); } 100% { box-shadow:0 0 0 0 rgba(245,158,11,0); } }
        @keyframes bc-shimmer { 0% { background-position:-200px 0; } 100% { background-position:calc(200px + 100%) 0; } }

        .bc-shell { max-width:640px; margin:0 auto; min-height:100vh; background:var(--bc-bg); position:relative; }

        /* Header */
        .bc-header { position:sticky; top:0; z-index:200; background:rgba(10,10,12,0.85); backdrop-filter:blur(20px) saturate(1.4); -webkit-backdrop-filter:blur(20px) saturate(1.4); border-bottom:1px solid var(--bc-border); }
        .bc-header-bar { display:flex; align-items:center; justify-content:space-between; padding:10px 16px; }
        .bc-brand { display:flex; align-items:center; gap:10px; }
        .bc-brand-icon { width:34px; height:34px; border-radius:10px; object-fit:contain; }
        .bc-brand-name { font-size:20px; font-weight:800; letter-spacing:-0.3px; background:linear-gradient(135deg,#fbbf24,#f59e0b,#d97706); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .bc-header-right { display:flex; align-items:center; gap:6px; }
        .bc-icon-btn { width:36px; height:36px; border-radius:50%; background:transparent; border:1px solid var(--bc-border); color:var(--bc-text-2); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-icon-btn:hover { background:var(--bc-bg3); border-color:var(--bc-border-h); color:var(--bc-text); }

        /* Tabs */
        .bc-nav { display:flex; padding:0 20px; }
        .bc-nav-item { flex:1; padding:8px 0; background:none; border:none; border-bottom:2px solid transparent; color:var(--bc-text-3); font-size:13px; font-weight:600; letter-spacing:0.02em; cursor:pointer; transition:all var(--bc-transition); display:flex; align-items:center; justify-content:center; gap:7px; }
        .bc-nav-item:hover { color:var(--bc-text-2); }
        .bc-nav-item.active { color:var(--bc-accent); border-bottom-color:var(--bc-accent); }
        .bc-nav-item i { font-size:14px; }

        /* Tag Bar */
        .bc-tag-bar { display:flex; gap:6px; padding:10px 20px; overflow-x:auto; scrollbar-width:none; border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-tag-bar::-webkit-scrollbar { display:none; }
        .bc-tag-pill { flex-shrink:0; padding:5px 12px; border-radius:20px; border:1px solid var(--bc-border); background:transparent; color:var(--bc-text-3); font-size:12px; font-weight:600; cursor:pointer; transition:all var(--bc-transition); display:flex; align-items:center; gap:5px; white-space:nowrap; }
        .bc-tag-pill:hover { border-color:var(--bc-border-h); color:var(--bc-text-2); }
        .bc-tag-pill.active { background:var(--bc-accent); border-color:var(--bc-accent); color:#000; box-shadow:0 0 10px rgba(245,158,11,0.25); }
        .bc-tag-pill i { font-size:11px; }

        /* Compose */
        .bc-compose { padding:20px; border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-compose-row { display:flex; gap:14px; }
        .bc-compose-avatar { width:42px; height:42px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-weight:700; color:#000; font-size:15px; flex-shrink:0; }
        .bc-compose-body { flex:1; min-width:0; }
        .bc-compose-textarea { width:100%; min-height:72px; max-height:240px; background:transparent; border:none; color:var(--bc-text); font-size:16px; line-height:1.5; resize:none; outline:none; font-family:inherit; }
        .bc-compose-textarea::placeholder { color:var(--bc-text-3); }
        .bc-upgrade-hint { display:flex; align-items:center; gap:6px; padding:6px 12px; margin:8px 0 0 56px; border-radius:8px; background:rgba(245,158,11,0.05); border:1px solid rgba(245,158,11,0.1); font-size:11px; color:var(--bc-text-3); cursor:pointer; transition:all var(--bc-transition); }
        .bc-upgrade-hint:hover { background:rgba(245,158,11,0.1); border-color:rgba(245,158,11,0.2); }
        .bc-compose-divider { height:1px; background:var(--bc-border); margin:12px 0; }
        .bc-compose-tags { display:flex; gap:4px; flex-wrap:wrap; margin-bottom:10px; }
        .bc-compose-tag { padding:3px 10px; border-radius:16px; border:1px solid var(--bc-border); background:transparent; color:var(--bc-text-3); font-size:11px; font-weight:600; cursor:pointer; transition:all var(--bc-transition); }
        .bc-compose-tag:hover { border-color:var(--bc-border-h); }
        .bc-compose-tag.active { border-color:var(--bc-accent); color:var(--bc-accent); background:var(--bc-accent-glow); }
        .bc-compose-bottom { display:flex; align-items:center; justify-content:space-between; }
        .bc-compose-tools { display:flex; gap:4px; }
        .bc-compose-tool { width:34px; height:34px; border-radius:50%; background:none; border:none; color:var(--bc-accent); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:15px; transition:background var(--bc-transition); }
        .bc-compose-tool:hover:not(:disabled) { background:var(--bc-accent-glow); }
        .bc-compose-tool:disabled { color:var(--bc-text-3); cursor:not-allowed; }
        .bc-compose-right { display:flex; align-items:center; gap:14px; }
        .bc-char-count { font-size:12px; color:var(--bc-text-3); font-variant-numeric:tabular-nums; }
        .bc-char-count.warn { color:var(--bc-accent); }
        .bc-char-count.danger { color:var(--bc-red); }
        .bc-compose-fee { font-size:11px; color:var(--bc-text-3); background:var(--bc-bg3); padding:4px 10px; border-radius:20px; }
        .bc-post-btn { padding:9px 22px; background:linear-gradient(135deg,#f59e0b,#d97706); border:none; border-radius:24px; color:#000; font-weight:700; font-size:14px; cursor:pointer; transition:all var(--bc-transition); }
        .bc-post-btn:hover:not(:disabled) { box-shadow:0 4px 20px rgba(245,158,11,0.35); transform:translateY(-1px); }
        .bc-post-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }

        /* Post Card */
        .bc-post { padding:18px 20px; border-bottom:1px solid var(--bc-border); transition:all var(--bc-transition); animation:bc-fadeIn 0.35s ease-out both; cursor:pointer; border-left:2px solid transparent; }
        .bc-post:hover { background:rgba(255,255,255,0.02); border-left-color:var(--bc-accent); }
        .bc-post-top { display:flex; gap:12px; }
        .bc-avatar { width:44px; height:44px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-weight:700; color:#000; font-size:15px; flex-shrink:0; cursor:pointer; transition:transform var(--bc-transition); }
        .bc-avatar:hover { transform:scale(1.06); }
        .bc-avatar.boosted { box-shadow:0 0 0 2.5px var(--bc-bg), 0 0 0 4.5px var(--bc-accent); animation:bc-pulse-ring 2s infinite; }
        .bc-post-head { flex:1; min-width:0; }
        .bc-post-author-row { display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
        .bc-author-name { font-weight:700; color:var(--bc-text); font-size:15px; cursor:pointer; transition:color var(--bc-transition); }
        .bc-author-name:hover { color:var(--bc-accent); }
        .bc-verified-icon { color:var(--bc-accent); font-size:13px; }
        .bc-post-time { color:var(--bc-text-3); font-size:13px; }
        .bc-edited-hint { font-size:11px; opacity:0.6; cursor:default; }
        .bc-post-context { color:var(--bc-text-3); font-size:13px; margin-top:1px; }
        .bc-tag-badge { display:inline-flex; align-items:center; gap:3px; padding:1px 7px; border-radius:12px; font-size:10px; font-weight:700; letter-spacing:0.02em; border:1px solid; opacity:0.8; }
        .bc-trending-tag { display:inline-flex; align-items:center; gap:4px; padding:2px 9px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:11px; font-weight:700; }
        .bc-trending-tag i { font-size:9px; }
        .bc-post-body { margin-top:10px; margin-left:56px; color:var(--bc-text); font-size:15px; line-height:1.6; white-space:pre-wrap; word-break:break-word; }
        .bc-post-media { margin-top:14px; margin-left:56px; border-radius:var(--bc-radius); overflow:hidden; border:1px solid var(--bc-border); }
        .bc-post-media img { width:100%; max-height:420px; object-fit:cover; display:block; }
        .bc-post-media video { width:100%; max-height:480px; display:block; background:#000; }
        .bc-post-deleted { margin-top:10px; margin-left:56px; color:var(--bc-text-3); font-size:14px; font-style:italic; }
        .bc-pinned-banner { display:flex; align-items:center; gap:6px; padding:8px 20px 0 68px; font-size:12px; color:var(--bc-accent); font-weight:600; }
        .bc-pinned-banner i { font-size:11px; }
        .bc-repost-banner { display:flex; align-items:center; gap:6px; padding:8px 20px 0 68px; font-size:13px; color:var(--bc-green); font-weight:600; }
        .bc-repost-banner i { font-size:12px; }

        /* Post Menu */
        .bc-post-menu-wrap { position:relative; margin-left:auto; }
        .bc-post-menu-btn { width:30px; height:30px; border-radius:50%; background:transparent; border:none; color:var(--bc-text-3); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-post-menu-btn:hover { background:var(--bc-bg3); color:var(--bc-text-2); }
        .bc-post-dropdown { position:absolute; top:100%; right:0; z-index:100; min-width:160px; background:var(--bc-bg2); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); padding:6px 0; box-shadow:0 8px 30px rgba(0,0,0,0.5); animation:bc-scaleIn 0.15s ease-out; }
        .bc-post-dropdown-item { display:flex; align-items:center; gap:8px; width:100%; padding:10px 16px; background:none; border:none; color:var(--bc-text-2); font-size:13px; cursor:pointer; transition:all var(--bc-transition); text-align:left; }
        .bc-post-dropdown-item:hover { background:var(--bc-bg3); color:var(--bc-text); }
        .bc-post-dropdown-item.danger { color:var(--bc-red); }
        .bc-post-dropdown-item.danger:hover { background:rgba(239,68,68,0.08); }
        .bc-post-dropdown-item i { width:16px; text-align:center; font-size:13px; }

        /* Engagement Bar */
        .bc-actions { display:flex; gap:2px; margin-top:12px; margin-left:56px; max-width:480px; justify-content:space-between; }
        .bc-action { display:flex; align-items:center; gap:5px; padding:6px 10px; background:none; border:none; border-radius:20px; color:var(--bc-text-3); font-size:13px; cursor:pointer; transition:all var(--bc-transition); }
        .bc-action i { font-size:15px; transition:transform 0.2s; }
        .bc-action .count { font-variant-numeric:tabular-nums; }
        .bc-action.act-reply:hover { color:var(--bc-blue); background:rgba(59,130,246,0.08); }
        .bc-action.act-repost:hover { color:var(--bc-green); background:rgba(34,197,94,0.08); }
        .bc-action.act-like:hover { color:var(--bc-red); background:rgba(239,68,68,0.08); }
        .bc-action.act-like:hover i { transform:scale(1.2); }
        .bc-action.act-like.liked { color:var(--bc-red); }
        .bc-action.act-like.liked i { animation:bc-like-pop 0.3s ease-out; }
        .bc-action.act-down:hover { color:var(--bc-purple); background:rgba(139,92,246,0.08); }
        .bc-action.act-super:hover { color:var(--bc-accent); background:var(--bc-accent-glow); }
        .bc-action.act-super:hover i { transform:scale(1.2) rotate(15deg); }
        .bc-action.act-super .bc-eth-val { font-size:11px; color:var(--bc-accent); font-weight:700; font-family:'SF Mono',monospace; }

        /* Profile */
        .bc-profile-section { animation:bc-fadeIn 0.4s ease-out; }
        .bc-profile-banner { height:120px; background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(217,119,6,0.08),rgba(10,10,12,0)); position:relative; }
        .bc-profile-main { padding:0 20px 20px; margin-top:-40px; position:relative; }
        .bc-profile-top-row { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:16px; }
        .bc-profile-pic { width:80px; height:80px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:800; color:#000; border:4px solid var(--bc-bg); }
        .bc-profile-pic.boosted { box-shadow:0 0 0 3px var(--bc-bg), 0 0 0 5px var(--bc-accent); }
        .bc-profile-actions { display:flex; gap:8px; padding-bottom:6px; }
        .bc-profile-name-row { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
        .bc-profile-name { font-size:22px; font-weight:800; color:var(--bc-text); letter-spacing:-0.3px; }
        .bc-profile-badge { color:var(--bc-accent); font-size:16px; }
        .bc-boosted-tag { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:11px; font-weight:700; }
        .bc-profile-handle { margin-top:8px; }
        .bc-profile-handle a { color:var(--bc-text-3); text-decoration:none; font-size:13px; transition:color var(--bc-transition); }
        .bc-profile-handle a:hover { color:var(--bc-accent); }
        .bc-profile-handle a i { font-size:10px; margin-left:4px; }
        .bc-profile-bio { margin-top:8px; font-size:14px; color:var(--bc-text-2); line-height:1.5; }
        .bc-profile-username { color:var(--bc-text-3); font-size:14px; margin-top:2px; }
        .bc-profile-stats { display:grid; grid-template-columns:repeat(3, 1fr); gap:1px; margin-top:20px; background:var(--bc-border); border-radius:var(--bc-radius); overflow:hidden; }
        .bc-stat-cell { background:var(--bc-bg2); padding:16px 12px; text-align:center; }
        .bc-stat-cell:first-child { border-radius:var(--bc-radius) 0 0 var(--bc-radius); }
        .bc-stat-cell:last-child { border-radius:0 var(--bc-radius) var(--bc-radius) 0; }
        .bc-stat-value { font-size:20px; font-weight:800; color:var(--bc-text); }
        .bc-stat-label { font-size:12px; color:var(--bc-text-3); margin-top:2px; font-weight:500; }

        /* Section Header */
        .bc-section-head { padding:16px 20px; border-bottom:1px solid var(--bc-border); display:flex; align-items:center; justify-content:space-between; }
        .bc-section-title { font-size:15px; font-weight:700; color:var(--bc-text); display:flex; align-items:center; gap:8px; }
        .bc-section-title i { color:var(--bc-accent); font-size:14px; }
        .bc-section-subtitle { font-size:13px; color:var(--bc-text-3); }

        /* Discover Header */
        .bc-discover-header { padding:24px 20px; border-bottom:1px solid var(--bc-border); background:linear-gradient(180deg,rgba(245,158,11,0.06),transparent); }
        .bc-discover-header h2 { font-size:18px; font-weight:800; color:var(--bc-text); display:flex; align-items:center; gap:8px; margin:0; }
        .bc-discover-header h2 i { color:var(--bc-accent); }
        .bc-discover-header p { margin:4px 0 0; font-size:13px; color:var(--bc-text-3); }
        .bc-stats-row { display:flex; gap:16px; margin-top:16px; }
        .bc-mini-stat { display:flex; align-items:center; gap:6px; font-size:13px; color:var(--bc-text-2); }
        .bc-mini-stat strong { color:var(--bc-text); font-weight:700; }

        /* Buttons */
        .bc-btn { padding:9px 18px; border-radius:24px; font-weight:700; font-size:13px; cursor:pointer; transition:all var(--bc-transition); border:none; display:inline-flex; align-items:center; gap:6px; letter-spacing:0.01em; }
        .bc-btn-primary { background:linear-gradient(135deg,#f59e0b,#d97706); color:#000; }
        .bc-btn-primary:hover { box-shadow:0 4px 16px rgba(245,158,11,0.3); transform:translateY(-1px); }
        .bc-btn-primary:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }
        .bc-btn-outline { background:transparent; border:1px solid var(--bc-border-h); color:var(--bc-text); }
        .bc-btn-outline:hover { background:var(--bc-bg3); border-color:rgba(255,255,255,0.15); }
        .bc-btn-follow { background:var(--bc-text); color:var(--bc-bg); }
        .bc-btn-follow:hover { opacity:0.9; }
        .bc-follow-toggle { padding:8px 20px; border-radius:24px; font-weight:700; font-size:13px; cursor:pointer; transition:all var(--bc-transition); border:none; }
        .bc-follow-toggle.do-follow { background:var(--bc-text); color:var(--bc-bg); }
        .bc-follow-toggle.do-follow:hover { opacity:0.9; }
        .bc-follow-toggle.do-unfollow { background:transparent; border:1px solid var(--bc-border-h); color:var(--bc-text); }
        .bc-follow-toggle.do-unfollow:hover { border-color:var(--bc-red); color:var(--bc-red); background:rgba(239,68,68,0.08); }

        /* Empty State */
        .bc-empty { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:72px 24px; text-align:center; animation:bc-fadeIn 0.5s ease-out; }
        .bc-empty-glyph { width:72px; height:72px; border-radius:50%; background:var(--bc-bg3); display:flex; align-items:center; justify-content:center; margin-bottom:20px; }
        .bc-empty-glyph i { font-size:28px; color:var(--bc-text-3); }
        .bc-empty-glyph.accent { background:var(--bc-accent-glow); }
        .bc-empty-glyph.accent i { color:var(--bc-accent); }
        .bc-empty-title { font-size:18px; font-weight:700; color:var(--bc-text); margin-bottom:8px; }
        .bc-empty-text { color:var(--bc-text-3); font-size:14px; max-width:280px; line-height:1.5; }

        /* Loading */
        .bc-loading { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:56px; gap:16px; }
        .bc-spinner { width:36px; height:36px; border:3px solid var(--bc-bg3); border-top-color:var(--bc-accent); border-radius:50%; animation:bc-spin 0.8s linear infinite; }
        .bc-loading-text { font-size:13px; color:var(--bc-text-3); }

        /* Modal */
        .bc-modal-overlay { display:none; position:fixed; inset:0; z-index:9999; background:rgba(0,0,0,0.75); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px); align-items:center; justify-content:center; padding:20px; }
        .bc-modal-overlay.active { display:flex; }
        .bc-modal-box { background:var(--bc-bg2); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-lg); width:100%; max-width:440px; max-height:90vh; overflow-y:auto; animation:bc-scaleIn 0.25s ease-out; }
        .bc-modal-top { display:flex; align-items:center; justify-content:space-between; padding:18px 20px; border-bottom:1px solid var(--bc-border); }
        .bc-modal-title { font-size:17px; font-weight:700; color:var(--bc-text); display:flex; align-items:center; gap:8px; }
        .bc-modal-x { width:32px; height:32px; border-radius:50%; background:var(--bc-bg3); border:none; color:var(--bc-text-2); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-modal-x:hover { background:var(--bc-surface); color:var(--bc-text); }
        .bc-modal-inner { padding:20px; }
        .bc-modal-desc { color:var(--bc-text-2); font-size:14px; line-height:1.5; margin-bottom:20px; }

        /* Form */
        .bc-field { margin-bottom:18px; }
        .bc-label { display:block; margin-bottom:8px; color:var(--bc-text-2); font-size:13px; font-weight:600; }
        .bc-input { width:100%; padding:12px 16px; background:var(--bc-bg3); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); color:var(--bc-text); font-size:15px; outline:none; transition:border-color var(--bc-transition); font-family:inherit; box-sizing:border-box; }
        .bc-input:focus { border-color:rgba(245,158,11,0.5); }
        .bc-fee-row { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.15); border-radius:var(--bc-radius-sm); }
        .bc-fee-label { font-size:13px; color:var(--bc-accent); font-weight:500; }
        .bc-fee-val { font-size:14px; font-weight:700; color:var(--bc-text); }

        /* Back Header */
        .bc-back-header { display:flex; align-items:center; gap:12px; padding:14px 20px; }
        .bc-back-btn { width:34px; height:34px; border-radius:50%; background:transparent; border:1px solid var(--bc-border); color:var(--bc-text); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-back-btn:hover { background:var(--bc-bg3); border-color:var(--bc-border-h); }
        .bc-back-title { font-size:17px; font-weight:700; color:var(--bc-text); }

        /* Wizard */
        .bc-wizard { padding:24px 20px; animation:bc-fadeIn 0.4s ease-out; }
        .bc-wizard-title { font-size:22px; font-weight:800; color:var(--bc-text); margin-bottom:6px; }
        .bc-wizard-desc { font-size:14px; color:var(--bc-text-3); margin-bottom:24px; line-height:1.5; }
        .bc-wizard-dots { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:28px; }
        .bc-wizard-dot { width:10px; height:10px; border-radius:50%; background:var(--bc-bg3); transition:all var(--bc-transition); }
        .bc-wizard-dot.active { background:var(--bc-accent); width:28px; border-radius:10px; }
        .bc-wizard-dot.done { background:var(--bc-green); }
        .bc-wizard-card { background:var(--bc-bg2); border:1px solid var(--bc-border); border-radius:var(--bc-radius-lg); padding:24px; margin-bottom:20px; }
        .bc-username-row { display:flex; align-items:center; gap:8px; margin-top:8px; min-height:24px; }
        .bc-username-ok { color:var(--bc-green); font-size:13px; display:flex; align-items:center; gap:4px; }
        .bc-username-taken { color:var(--bc-red); font-size:13px; display:flex; align-items:center; gap:4px; }
        .bc-username-checking { color:var(--bc-text-3); font-size:13px; }
        .bc-username-fee { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.15); border-radius:20px; color:var(--bc-accent); font-size:12px; font-weight:600; margin-left:8px; }
        .bc-wizard-nav { display:flex; gap:12px; margin-top:20px; }
        .bc-wizard-nav .bc-btn { flex:1; justify-content:center; }

        /* Thread */
        .bc-thread-parent { border-bottom:1px solid var(--bc-border); }
        .bc-thread-divider { padding:12px 20px; font-size:13px; font-weight:700; color:var(--bc-text-2); border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-thread-reply { position:relative; padding-left:36px; }
        .bc-thread-reply::before { content:''; position:absolute; left:40px; top:0; bottom:0; width:2px; background:var(--bc-border); }
        .bc-thread-reply:last-child::before { bottom:50%; }
        .bc-reply-compose { padding:16px 20px; border-top:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-reply-label { font-size:13px; color:var(--bc-text-3); margin-bottom:8px; }
        .bc-reply-row { display:flex; gap:12px; align-items:flex-start; }
        .bc-reply-input { flex:1; min-height:48px; max-height:160px; background:var(--bc-bg3); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); color:var(--bc-text); font-size:14px; padding:10px 14px; resize:none; outline:none; font-family:inherit; }
        .bc-reply-input:focus { border-color:rgba(245,158,11,0.5); }
        .bc-reply-send { padding:10px 18px; }

        /* Image Upload */
        .bc-image-preview { position:relative; margin-top:12px; border-radius:var(--bc-radius); overflow:hidden; border:1px solid var(--bc-border); max-height:200px; }
        .bc-image-preview img { width:100%; max-height:200px; object-fit:cover; display:block; }
        .bc-image-remove { position:absolute; top:8px; right:8px; width:28px; height:28px; border-radius:50%; background:rgba(0,0,0,0.7); border:none; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; }
        .bc-image-remove:hover { background:var(--bc-red); }
        .bc-uploading-badge { display:inline-flex; align-items:center; gap:6px; padding:4px 12px; background:rgba(245,158,11,0.1); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:12px; margin-top:8px; }
        .bc-video-badge { position:absolute; bottom:8px; left:8px; display:flex; align-items:center; gap:4px; padding:3px 10px; background:rgba(0,0,0,0.75); border-radius:12px; color:#fff; font-size:11px; font-weight:600; }
        .bc-video-badge i { font-size:9px; }

        /* Profile Create Banner */
        .bc-profile-create-banner { margin:16px 20px; padding:16px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:var(--bc-radius); text-align:center; animation:bc-fadeIn 0.4s ease-out; }
        .bc-profile-create-banner p { font-size:13px; color:var(--bc-text-2); margin-bottom:12px; }

        /* Live Streaming */
        .bc-live-bar { padding:16px 20px; background:linear-gradient(135deg, rgba(239,68,68,0.08), rgba(0,0,0,0.4)); border-bottom:1px solid rgba(239,68,68,0.2); }
        .bc-live-bar-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
        .bc-live-indicator { display:flex; align-items:center; gap:8px; }
        .bc-live-dot { width:10px; height:10px; border-radius:50%; background:#ef4444; animation:bc-pulse-ring 1.5s infinite; }
        .bc-live-label { font-weight:700; color:#ef4444; font-size:14px; }
        .bc-live-viewers { font-size:12px; color:var(--bc-text-3); }
        .bc-live-video { width:100%; border-radius:var(--bc-radius); background:#000; max-height:400px; object-fit:cover; }
        .bc-live-badge { display:inline-flex; align-items:center; gap:3px; padding:2px 8px; background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.3); border-radius:12px; color:#ef4444; font-size:10px; font-weight:700; margin-left:6px; }
        .bc-live-badge-dot { width:6px; height:6px; border-radius:50%; background:#ef4444; animation:bc-pulse-ring 1.5s infinite; }
        .bc-live-join { padding:16px 20px; background:rgba(239,68,68,0.05); border-bottom:1px solid rgba(239,68,68,0.2); text-align:center; }
        .bc-go-live-btn { background:linear-gradient(135deg, #ef4444, #dc2626); color:#fff; border:none; padding:8px 16px; border-radius:var(--bc-radius-sm); cursor:pointer; font-size:13px; font-weight:600; display:inline-flex; align-items:center; gap:6px; transition:all 0.15s; }
        .bc-go-live-btn:hover { filter:brightness(1.1); transform:scale(1.02); }
        .bc-go-live-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

        /* Skeleton Loader */
        .bc-skeleton-post { padding:18px 20px; border-bottom:1px solid var(--bc-border); display:flex; gap:12px; }
        .bc-skeleton-avatar { width:44px; height:44px; border-radius:50%; flex-shrink:0; }
        .bc-skeleton-body { flex:1; display:flex; flex-direction:column; gap:10px; }
        .bc-skeleton-line { height:12px; border-radius:6px; }
        .bc-skeleton-line.short { width:40%; }
        .bc-skeleton-line.medium { width:75%; }
        .bc-skeleton-line.long { width:90%; }
        .bc-skeleton-actions { display:flex; gap:24px; margin-top:4px; }
        .bc-skeleton-dot { width:18px; height:12px; border-radius:6px; }
        .bc-skeleton-avatar, .bc-skeleton-line, .bc-skeleton-dot {
            background:linear-gradient(90deg, var(--bc-bg3) 25%, rgba(255,255,255,0.06) 50%, var(--bc-bg3) 75%);
            background-size:200px 100%;
            animation:bc-shimmer 1.5s infinite linear;
        }

        /* Trending Rank Badge */
        .bc-rank-badge { display:inline-flex; align-items:center; justify-content:center; width:24px; height:24px; border-radius:50%; font-size:11px; font-weight:800; flex-shrink:0; margin-right:4px; }
        .bc-rank-1 { background:linear-gradient(135deg,#fbbf24,#f59e0b); color:#000; box-shadow:0 0 12px rgba(245,158,11,0.4); }
        .bc-rank-2 { background:linear-gradient(135deg,#d1d5db,#9ca3af); color:#000; }
        .bc-rank-3 { background:linear-gradient(135deg,#f59e0b,#92400e); color:#fff; }

        /* Media Grid (composer multi-upload) */
        .bc-media-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(80px, 1fr)); gap:8px; margin-top:12px; }
        .bc-media-thumb { position:relative; aspect-ratio:1; border-radius:var(--bc-radius-sm); overflow:hidden; border:1px solid var(--bc-border); }
        .bc-media-thumb img { width:100%; height:100%; object-fit:cover; display:block; }
        .bc-media-thumb .bc-image-remove { position:absolute; top:4px; right:4px; width:22px; height:22px; font-size:11px; }
        .bc-media-thumb .bc-video-badge { bottom:4px; left:4px; padding:2px 6px; font-size:9px; }
        .bc-media-add { display:flex; align-items:center; justify-content:center; background:var(--bc-bg3); border:2px dashed var(--bc-border-h); cursor:pointer; color:var(--bc-text-3); font-size:20px; transition:all var(--bc-transition); }
        .bc-media-add:hover { border-color:var(--bc-accent); color:var(--bc-accent); background:var(--bc-accent-glow); }

        /* Read More */
        .bc-read-more { color:var(--bc-accent); cursor:pointer; font-weight:600; font-size:14px; margin-left:4px; transition:opacity var(--bc-transition); }
        .bc-read-more:hover { opacity:0.8; text-decoration:underline; }

        /* Media Carousel */
        .bc-carousel { position:relative; user-select:none; -webkit-user-select:none; }
        .bc-carousel-track { position:relative; overflow:hidden; }
        .bc-carousel-slide { width:100%; }
        .bc-carousel-slide img, .bc-carousel-slide video { width:100%; max-height:480px; object-fit:cover; display:block; background:#000; }
        .bc-carousel-dots { display:flex; justify-content:center; gap:5px; padding:8px 0; position:absolute; bottom:8px; left:50%; transform:translateX(-50%); z-index:5; }
        .bc-carousel-dot { width:7px; height:7px; border-radius:50%; background:rgba(255,255,255,0.35); cursor:pointer; transition:all 0.2s; border:none; padding:0; }
        .bc-carousel-dot.active { background:#fff; width:20px; border-radius:10px; }
        .bc-carousel-arrow { position:absolute; top:50%; transform:translateY(-50%); z-index:5; width:32px; height:32px; border-radius:50%; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); border:1px solid rgba(255,255,255,0.15); color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:12px; transition:all var(--bc-transition); }
        .bc-carousel-arrow:hover { background:rgba(0,0,0,0.8); border-color:rgba(255,255,255,0.3); }
        .bc-carousel-prev { left:8px; }
        .bc-carousel-next { right:8px; }
        .bc-carousel-counter { position:absolute; top:10px; right:10px; z-index:5; padding:3px 10px; border-radius:12px; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); color:#fff; font-size:11px; font-weight:600; letter-spacing:0.02em; }

        /* Video overlay for auto-play */
        .bc-video-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:3; cursor:pointer; }
        .bc-video-mute-btn { position:absolute; bottom:12px; right:12px; width:32px; height:32px; border-radius:50%; background:rgba(0,0,0,0.6); border:none; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:13px; z-index:4; transition:all var(--bc-transition); }
        .bc-video-mute-btn:hover { background:rgba(0,0,0,0.85); }
        .bc-video-progress { position:absolute; bottom:0; left:0; height:3px; background:var(--bc-accent); z-index:4; transition:width 0.25s linear; border-radius:0 2px 0 0; }

        /* Discover Mode Toggle */
        .bc-discover-mode-toggle { display:inline-flex; gap:2px; background:var(--bc-bg3); border-radius:8px; padding:2px; margin-left:12px; vertical-align:middle; }
        .bc-mode-btn { width:30px; height:28px; border:none; background:transparent; color:var(--bc-text-3); cursor:pointer; border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:13px; transition:all var(--bc-transition); }
        .bc-mode-btn.active { background:var(--bc-accent); color:#000; }
        .bc-mode-btn:hover:not(.active) { color:var(--bc-text); }

        /* TikTok Feed â€” desktop: only Agora header (~100px); mobile: header + bottom tabs (64px) */
        .bc-tiktok-feed { scroll-snap-type:y mandatory; overflow-y:auto; height:calc(100vh - 100px); scroll-behavior:smooth; }
        .bc-tiktok-card { position:relative; width:100%; height:calc(100vh - 100px); scroll-snap-align:start; scroll-snap-stop:always; overflow:hidden; cursor:pointer; }
        @media (max-width:1023px) {
            .bc-tiktok-feed, .bc-tiktok-card { height:calc(100vh - 164px); }
        }
        .bc-tiktok-video { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
        .bc-tiktok-img-overlay { position:absolute; inset:0; background:linear-gradient(transparent 40%, rgba(0,0,0,0.7)); z-index:1; }
        .bc-tiktok-overlay { position:absolute; inset:0; z-index:2; display:flex; flex-direction:column; justify-content:flex-end; background:linear-gradient(transparent 50%, rgba(0,0,0,0.6) 80%, rgba(0,0,0,0.85)); pointer-events:none; }
        .bc-tiktok-bottom { display:flex; align-items:flex-end; gap:12px; padding:20px 16px 20px; pointer-events:auto; }
        .bc-tiktok-info { flex:1; min-width:0; }
        .bc-tiktok-author { font-size:15px; color:#fff; cursor:pointer; display:flex; align-items:center; gap:8px; }
        .bc-tiktok-author strong { font-weight:700; }
        .bc-tiktok-time { font-size:12px; color:rgba(255,255,255,0.5); }
        .bc-tiktok-caption { font-size:14px; color:rgba(255,255,255,0.85); line-height:1.4; margin-top:6px; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; cursor:pointer; }
        .bc-tiktok-caption.expanded { -webkit-line-clamp:unset; display:block; max-height:50vh; overflow-y:auto; }
        .bc-tiktok-more { color:var(--bc-text-3); font-weight:600; font-size:13px; }
        .bc-tiktok-actions { display:flex; flex-direction:column; align-items:center; gap:18px; flex-shrink:0; }
        .bc-tiktok-action { display:flex; flex-direction:column; align-items:center; gap:2px; color:rgba(255,255,255,0.85); cursor:pointer; transition:all 0.15s; }
        .bc-tiktok-action:hover { transform:scale(1.15); }
        .bc-tiktok-action.liked { color:var(--bc-red); }
        .bc-tiktok-action i { font-size:24px; filter:drop-shadow(0 1px 3px rgba(0,0,0,0.5)); }
        .bc-tiktok-action span { font-size:11px; font-weight:600; }
        .bc-tiktok-avatar { width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#fbbf24); display:flex; align-items:center; justify-content:center; font-weight:700; color:#000; font-size:14px; border:2px solid #fff; overflow:hidden; }
        .bc-tiktok-avatar img { width:100%; height:100%; object-fit:cover; }

        /* Double-tap like animation */
        @keyframes bc-float-heart { 0% { opacity:1; transform:scale(0) translateY(0); } 30% { opacity:1; transform:scale(1.2) translateY(-20px); } 100% { opacity:0; transform:scale(0.8) translateY(-120px); } }
        .bc-float-heart { position:absolute; font-size:60px; color:var(--bc-red); pointer-events:none; z-index:10; animation:bc-float-heart 0.8s ease-out forwards; }

        /* Feed Sentinel (infinite scroll) */
        .bc-feed-sentinel { padding:24px 0; }

        /* Responsive */
        @media (max-width: 640px) {
            .bc-shell { max-width:100%; }
            .bc-actions { margin-left:0; margin-top:14px; }
            .bc-post-body { margin-left:0; margin-top:12px; }
            .bc-post-media { margin-left:0; }
            .bc-compose-avatar { display:none; }
        }
        @media (max-width: 480px) {
            .bc-tag-pill { font-size:11px; padding:4px 9px; }
            .bc-tag-pill i { font-size:10px; }
            .bc-action { padding:5px 6px; font-size:12px; gap:3px; }
            .bc-action i { font-size:13px; }
            .bc-stat-value { font-size:17px; }
            .bc-stat-label { font-size:11px; }
            .bc-compose-bottom { flex-wrap:wrap; gap:8px; }
            .bc-profile-pic { width:64px; height:64px; font-size:22px; }
        }

        /* Action Cart */
        .bc-cart-bar { position:fixed; bottom:0; left:50%; transform:translateX(-50%); width:100%; max-width:640px; z-index:500; background:rgba(17,17,21,0.95); backdrop-filter:blur(20px) saturate(1.4); -webkit-backdrop-filter:blur(20px) saturate(1.4); border-top:1px solid var(--bc-border-h); animation:bc-slideUp 0.3s ease-out; }
        @keyframes bc-slideUp { from { transform:translateX(-50%) translateY(100%); } to { transform:translateX(-50%) translateY(0); } }
        .bc-cart-summary { display:flex; align-items:center; justify-content:space-between; padding:12px 20px; cursor:pointer; }
        .bc-cart-summary:hover { background:var(--bc-bg3); }
        .bc-cart-info { display:flex; align-items:center; gap:10px; }
        .bc-cart-badge { display:inline-flex; align-items:center; justify-content:center; min-width:22px; height:22px; border-radius:50%; background:var(--bc-accent); color:#000; font-size:12px; font-weight:800; padding:0 4px; }
        .bc-cart-label { font-size:13px; color:var(--bc-text-2); }
        .bc-cart-label strong { color:var(--bc-text); font-weight:700; }
        .bc-cart-fee { display:none; }
        .bc-cart-actions { display:flex; align-items:center; gap:8px; }
        .bc-cart-submit-btn { padding:8px 18px; border-radius:24px; background:linear-gradient(135deg,#f59e0b,#d97706); color:#000; font-weight:700; font-size:12px; border:none; cursor:pointer; transition:all var(--bc-transition); display:inline-flex; align-items:center; gap:6px; }
        .bc-cart-submit-btn:hover { box-shadow:0 4px 16px rgba(245,158,11,0.3); transform:translateY(-1px); }
        .bc-cart-submit-btn:disabled { opacity:0.4; cursor:not-allowed; transform:none; box-shadow:none; }
        .bc-cart-toggle { width:28px; height:28px; border-radius:50%; background:transparent; border:1px solid var(--bc-border); color:var(--bc-text-2); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:11px; transition:all var(--bc-transition); }
        .bc-cart-toggle:hover { background:var(--bc-bg3); color:var(--bc-text); }

        .bc-cart-panel { border-top:1px solid var(--bc-border); max-height:300px; overflow-y:auto; }
        .bc-cart-header { display:flex; align-items:center; justify-content:space-between; padding:12px 20px; border-bottom:1px solid var(--bc-border); }
        .bc-cart-title { font-size:13px; font-weight:700; color:var(--bc-text); }
        .bc-cart-clear { font-size:12px; color:var(--bc-red); cursor:pointer; background:none; border:none; font-weight:600; padding:4px 8px; border-radius:8px; transition:all var(--bc-transition); }
        .bc-cart-clear:hover { background:rgba(239,68,68,0.1); }

        .bc-cart-item { display:flex; align-items:center; justify-content:space-between; padding:10px 20px; border-bottom:1px solid var(--bc-border); transition:background var(--bc-transition); }
        .bc-cart-item:hover { background:var(--bc-bg3); }
        .bc-cart-item-info { display:flex; align-items:center; gap:10px; flex:1; min-width:0; }
        .bc-cart-item-icon { width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; flex-shrink:0; }
        .bc-cart-item-icon.like { background:rgba(239,68,68,0.1); color:var(--bc-red); }
        .bc-cart-item-icon.follow { background:rgba(59,130,246,0.1); color:var(--bc-blue); }
        .bc-cart-item-icon.downvote { background:rgba(139,92,246,0.1); color:var(--bc-purple); }
        .bc-cart-item-label { font-size:13px; color:var(--bc-text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .bc-cart-item-type { font-size:11px; color:var(--bc-text-3); text-transform:capitalize; }
        .bc-cart-item-remove { width:24px; height:24px; border-radius:50%; background:transparent; border:none; color:var(--bc-text-3); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:11px; transition:all var(--bc-transition); flex-shrink:0; }
        .bc-cart-item-remove:hover { background:rgba(239,68,68,0.1); color:var(--bc-red); }

        .bc-cart-footer { padding:12px 20px; border-top:1px solid var(--bc-border); }
        .bc-cart-warning { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--bc-accent); margin-top:8px; }

        /* Inline wallet button (Agora header) */
        .bc-wallet-inline { display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border-radius:20px; border:1px solid var(--bc-border); background:transparent; color:var(--bc-text-2); font-size:12px; font-weight:600; cursor:pointer; transition:all var(--bc-transition); font-family:inherit; white-space:nowrap; }
        .bc-wallet-inline:hover { background:var(--bc-bg3); border-color:var(--bc-border-h); color:var(--bc-text); }
        .bc-wallet-inline.disconnected { background:linear-gradient(135deg,var(--bc-accent),#d97706); color:#000; border-color:transparent; font-weight:700; }
        .bc-wallet-inline.disconnected:hover { box-shadow:0 2px 12px rgba(245,158,11,0.3); }
        .bc-wallet-inline.disconnected i { color:#000; }
        .bc-wallet-inline.connected { border-color:rgba(34,197,94,0.3); }
        .bc-wallet-inline.connected:hover { border-color:rgba(239,68,68,0.4); }
        .bc-wallet-inline.connected:hover .bc-wallet-dot { background:var(--bc-red); box-shadow:0 0 6px rgba(239,68,68,0.5); }
        .bc-wallet-inline.connected:hover .bc-disconnect-icon { color:var(--bc-red); }
        .bc-wallet-dot { width:8px; height:8px; border-radius:50%; background:var(--bc-green); flex-shrink:0; box-shadow:0 0 6px rgba(34,197,94,0.5); transition:all var(--bc-transition); }
        .bc-disconnect-icon { font-size:11px !important; color:var(--bc-text-3) !important; margin-left:2px; transition:color var(--bc-transition); }

        /* FAB â€” Floating Action Button for compose */
        .bc-fab { position:fixed; bottom:80px; right:max(16px, calc((100vw - 640px)/2 + 16px)); width:52px; height:52px; border-radius:50%; background:linear-gradient(135deg,var(--bc-accent),#d97706); color:#000; border:none; font-size:22px; cursor:pointer; z-index:400; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 20px rgba(245,158,11,0.4); transition:all 0.2s; }
        .bc-fab:hover { transform:scale(1.08); box-shadow:0 6px 28px rgba(245,158,11,0.5); }
        .bc-fab:active { transform:scale(0.95); }
        @media (max-width:1023px) { .bc-fab { bottom:80px; right:16px; } }

        /* Web3Modal overrides â€” more subtle backdrop */
        w3m-modal { --w3m-z-index: 9999 !important; }

        /* Mobile: cart bar above bottom tabs */
        @media (max-width: 1023px) {
            .bc-cart-bar { bottom:64px; }
            .bc-cart-panel { max-height:calc(100vh - 280px); }
        }
    `,document.head.appendChild(t)}const zc=15,$c=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}];class ss{constructor(){this.roomId=null,this.localStream=null,this.peerConnections=new Map,this.unsubscribers=[],this.isStreamer=!1,this.remoteStream=null,this.onViewerCountChange=null,this.onStreamEnd=null,this.onRemoteStream=null,this.onError=null}async startStream(t,a){this.localStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!0}),this.isStreamer=!0,this.roomId=`live_${t}_${Date.now()}`;const n=Z(H,"agora_live_rooms",this.roomId);await Bn(n,{streamerAddress:a.toLowerCase(),postId:String(t),status:"live",viewerCount:0,createdAt:Be()});const o=Ie(H,"agora_live_rooms",this.roomId,"signals"),s=xa(Fe(o,Le("type","==","join-request")),l=>{l.docChanges().forEach(c=>{c.type==="added"&&this._handleJoinRequest(c.doc.data()).catch(d=>console.warn("[WebRTC] Join request error:",d))})});this.unsubscribers.push(s);const i=xa(Fe(o,Le("type","==","answer-complete")),l=>{l.docChanges().forEach(c=>{c.type==="added"&&this._handleAnswerComplete(c.doc.data()).catch(d=>console.warn("[WebRTC] Answer complete error:",d))})});this.unsubscribers.push(i);const r=xa(Fe(o,Le("type","==","ice-from-viewer")),l=>{l.docChanges().forEach(c=>{c.type==="added"&&this._handleRemoteICE(c.doc.data()).catch(d=>console.warn("[WebRTC] ICE error:",d))})});return this.unsubscribers.push(r),console.log(`[WebRTC] Stream started: ${this.roomId}`),{roomId:this.roomId,stream:this.localStream}}async _handleJoinRequest(t){const a=t.from;if(!a)return;if(this.peerConnections.size>=zc){console.warn(`[WebRTC] Max viewers (${zc}) reached, rejecting ${a}`);return}this.peerConnections.has(a)&&(this.peerConnections.get(a).close(),this.peerConnections.delete(a));const n=new RTCPeerConnection({iceServers:$c});this.peerConnections.set(a,n),this.localStream.getTracks().forEach(r=>{n.addTrack(r,this.localStream)}),n.onicecandidate=async r=>{if(r.candidate)try{const l=Ie(H,"agora_live_rooms",this.roomId,"signals");await ha(l,{type:"ice-from-streamer",to:a,data:JSON.stringify(r.candidate.toJSON()),createdAt:Be()})}catch(l){console.warn("[WebRTC] Failed to send ICE:",l)}},n.onconnectionstatechange=()=>{(n.connectionState==="disconnected"||n.connectionState==="failed")&&this._removeViewer(a)};const o=await n.createOffer();await n.setLocalDescription(o);const s=Ie(H,"agora_live_rooms",this.roomId,"signals");await ha(s,{type:"offer-for-viewer",to:a,data:JSON.stringify(n.localDescription.toJSON()),createdAt:Be()});const i=Z(H,"agora_live_rooms",this.roomId);await Sa(i,{viewerCount:Ne(1)}),this.onViewerCountChange&&this.onViewerCountChange(this.peerConnections.size),console.log(`[WebRTC] Offer sent to viewer: ${a.slice(0,8)}...`)}async _handleAnswerComplete(t){const a=t.from,n=this.peerConnections.get(a);if(n)try{const o=JSON.parse(t.data);await n.setRemoteDescription(new RTCSessionDescription(o)),console.log(`[WebRTC] Connection established with viewer: ${a.slice(0,8)}...`)}catch(o){console.warn("[WebRTC] Failed to set remote description:",o)}}async _handleRemoteICE(t){const a=this.peerConnections.get(t.from);if(a)try{const n=JSON.parse(t.data);await a.addIceCandidate(new RTCIceCandidate(n))}catch(n){console.warn("[WebRTC] Failed to add ICE candidate:",n)}}_removeViewer(t){const a=this.peerConnections.get(t);a&&(a.close(),this.peerConnections.delete(t),this.onViewerCountChange&&this.onViewerCountChange(this.peerConnections.size))}async endStream(){var t;if((t=this.localStream)==null||t.getTracks().forEach(a=>a.stop()),this.peerConnections.forEach(a=>a.close()),this.peerConnections.clear(),this.unsubscribers.forEach(a=>a()),this.unsubscribers=[],this.roomId)try{const a=Z(H,"agora_live_rooms",this.roomId);await Sa(a,{status:"ended"})}catch(a){console.warn("[WebRTC] Failed to update room status:",a)}console.log(`[WebRTC] Stream ended: ${this.roomId}`),this.localStream=null,this.roomId=null,this.isStreamer=!1}async joinStream(t,a){this.roomId=t,this.isStreamer=!1;const n=a.toLowerCase(),o=new RTCPeerConnection({iceServers:$c});this.peerConnections.set("streamer",o),o.ontrack=d=>{this.remoteStream=d.streams[0],this.onRemoteStream&&this.onRemoteStream(this.remoteStream)},o.onicecandidate=async d=>{if(d.candidate)try{const f=Ie(H,"agora_live_rooms",this.roomId,"signals");await ha(f,{type:"ice-from-viewer",from:n,data:JSON.stringify(d.candidate.toJSON()),createdAt:Be()})}catch(f){console.warn("[WebRTC] Failed to send ICE:",f)}},o.onconnectionstatechange=()=>{o.connectionState==="failed"&&(this.onError&&this.onError("Connection failed"),this.leaveStream())};const s=Ie(H,"agora_live_rooms",this.roomId,"signals");await ha(s,{type:"join-request",from:n,createdAt:Be()});const i=xa(Fe(s,Le("type","==","offer-for-viewer"),Le("to","==",n)),d=>{d.docChanges().forEach(async f=>{if(f.type==="added")try{const g=JSON.parse(f.doc.data().data);await o.setRemoteDescription(new RTCSessionDescription(g));const m=await o.createAnswer();await o.setLocalDescription(m),await ha(s,{type:"answer-complete",from:n,data:JSON.stringify(o.localDescription.toJSON()),createdAt:Be()}),console.log("[WebRTC] Answer sent to streamer")}catch(g){console.warn("[WebRTC] Offer handling error:",g)}})});this.unsubscribers.push(i);const r=xa(Fe(s,Le("type","==","ice-from-streamer"),Le("to","==",n)),d=>{d.docChanges().forEach(async f=>{if(f.type==="added")try{const g=JSON.parse(f.doc.data().data);await o.addIceCandidate(new RTCIceCandidate(g))}catch(g){console.warn("[WebRTC] ICE add failed:",g)}})});this.unsubscribers.push(r);const l=Z(H,"agora_live_rooms",this.roomId),c=xa(l,d=>{d.exists()&&d.data().status==="ended"&&(this.leaveStream(),this.onStreamEnd&&this.onStreamEnd())});this.unsubscribers.push(c),console.log(`[WebRTC] Joined stream: ${t}`)}leaveStream(){this.peerConnections.forEach(t=>t.close()),this.peerConnections.clear(),this.unsubscribers.forEach(t=>t()),this.unsubscribers=[],this.remoteStream=null,this.roomId=null}static async getActiveRooms(){try{const t=Ie(H,"agora_live_rooms"),a=Fe(t,Le("status","==","live"));return(await xt(a)).docs.map(o=>({id:o.id,...o.data()}))}catch(t){return console.warn("[WebRTC] Failed to get active rooms:",t),[]}}static async getRoomByPostId(t){try{const a=Ie(H,"agora_live_rooms"),n=Fe(a,Le("postId","==",String(t)),Le("status","==","live")),o=await xt(n);if(o.empty)return null;const s=o.docs[0];return{id:s.id,...s.data()}}catch(a){return console.warn("[WebRTC] Failed to get room by postId:",a),null}}}const Ht=window.ethers;function Qs(){if(u.agoraContract)return u.agoraContract;if(u.agoraContractPublic)return u.agoraContractPublic;const e=mm();return e&&u.publicProvider?new Ht.Contract(e,la,u.publicProvider):null}async function Sc(){try{let e=0n,t=0n,a=0n,n=0n,o=0n;try{[e,t,a,n,o]=await Promise.all([W(Ht.id("AGORA_LIKE"),0n),W(Ht.id("AGORA_FOLLOW"),0n),W(Ht.id("AGORA_DOWNVOTE"),0n),W(Ht.id("AGORA_BOOST_STD"),0n),W(Ht.id("AGORA_BOOST_FEAT"),0n)])}catch(s){console.warn("[Agora] Fee calc fallback:",s.message)}p.fees={post:0n,reply:0n,repost:0n,like:e,follow:t,downvote:a,boostStd:n,boostFeat:o,badge:0n}}catch(e){console.warn("[Agora] Failed to load fees:",e.message)}}async function Hi(){if(!(!u.isConnected||!u.userAddress))try{const e=await ee.getUserProfile(u.userAddress).catch(()=>null);e&&(p.hasBadge=e.hasBadge,p.isBoosted=e.boosted,p.boostExpiry=e.boostExpiry,p.badgeExpiry=e.badgeExpiry,p.badgeTier=e.badgeTier)}catch(e){console.warn("[Agora] Failed to load user status:",e.message)}}async function Lc(){try{p.globalStats=await ee.getGlobalStats()}catch(e){console.warn("[Agora] Failed to load global stats:",e.message)}}async function ji(){try{const e=Qs();if(!e){p.hasProfile=!1;return}const[t,a]=await Promise.all([e.queryFilter(e.filters.ProfileCreated(),oa).catch(()=>[]),e.queryFilter(e.filters.ProfileUpdated(),oa).catch(()=>[])]);for(const n of t){const o=n.args.user.toLowerCase(),s=bi(n.args.metadataURI);p.profiles.set(o,{username:n.args.username,metadataURI:n.args.metadataURI||"",displayName:s.displayName,bio:s.bio,avatar:s.avatar,language:s.language})}for(const n of a){const o=n.args.user.toLowerCase(),s=p.profiles.get(o);if(!s)continue;const i=bi(n.args.metadataURI);p.profiles.set(o,{...s,metadataURI:n.args.metadataURI||"",displayName:i.displayName||s.displayName,bio:i.bio,avatar:i.avatar||s.avatar,language:i.language||s.language})}if(u.isConnected&&u.userAddress){const n=u.userAddress.toLowerCase();let o=p.profiles.get(n);if(!o)try{const s=await ee.getUserProfile(u.userAddress);if(s&&s.usernameHash&&s.usernameHash!==Ht.ZeroHash){const i=bi(s.metadataURI);o={username:null,metadataURI:s.metadataURI,displayName:i.displayName,bio:i.bio,avatar:i.avatar,language:i.language},p.profiles.set(n,o)}s&&p.followCounts.set(n,{followers:s.followers,following:s.following})}catch{}o?(p.userProfile={...o,address:u.userAddress},p.hasProfile=!0,p.selectedLanguage===null&&o.language&&(p.selectedLanguage=o.language)):(p.hasProfile=!1,p.userProfile=null)}else p.hasProfile=!1;console.log("[Agora] Profiles loaded:",p.profiles.size,"| hasProfile:",p.hasProfile)}catch(e){console.warn("[Agora] Failed to load profiles:",e.message),p.hasProfile=!1}p._render()}async function Wi(){var e,t,a,n,o,s,i,r;if(p.following=new Set,p.followers=new Set,p.followCounts=new Map,!(!u.isConnected||!u.userAddress))try{const l=Qs();if(!l)return;const c=await l.queryFilter(l.filters.Followed(),oa).catch(()=>[]),d=await l.queryFilter(l.filters.Unfollowed(),oa).catch(()=>[]),f=u.userAddress.toLowerCase();for(const g of c)((e=g.args.follower)==null?void 0:e.toLowerCase())===f&&p.following.add((t=g.args.followed)==null?void 0:t.toLowerCase()),((a=g.args.followed)==null?void 0:a.toLowerCase())===f&&p.followers.add((n=g.args.follower)==null?void 0:n.toLowerCase());for(const g of d)((o=g.args.follower)==null?void 0:o.toLowerCase())===f&&p.following.delete((s=g.args.followed)==null?void 0:s.toLowerCase()),((i=g.args.followed)==null?void 0:i.toLowerCase())===f&&p.followers.delete((r=g.args.follower)==null?void 0:r.toLowerCase());console.log(`[Agora] Social graph: following=${p.following.size}, followers=${p.followers.size}`)}catch(l){console.warn("[Agora] Failed to load social graph:",l.message)}}async function _c(){var e;if(!(!u.isConnected||!u.userAddress))try{const t=Qs();if(!t)return;const a=await t.queryFilter(t.filters.PostReported(),oa).catch(()=>[]),n=u.userAddress.toLowerCase();for(const o of a)if(((e=o.args.reporter)==null?void 0:e.toLowerCase())===n){const s=o.args.postId.toString(),i=p.postsById.get(s);i!=null&&i.author&&p.blockedAuthors.add(i.author.toLowerCase())}console.log(`[Agora] Blocked authors: ${p.blockedAuthors.size}`)}catch(t){console.warn("[Agora] Failed to load blocked authors:",t.message)}}async function ot(){var e,t,a;p.isLoading=!0,p._render();try{let y=function(v){var ke,G;const T=((G=v.type==="repost"?(ke=p.postsById.get(v.originalPostId))==null?void 0:ke.author:v.author)==null?void 0:G.toLowerCase())||"",N=1e3/(1+Math.max(m-v.timestamp,1)/21600),S=w&&p.following.has(T)?500:0,$=p.profiles.get(T),F=h&&($==null?void 0:$.language)===h?300:0,V=v.likesCount||0,X=v.repliesCount||p.replyCountMap.get(v.id)||0,re=v.repostsCount||p.repostCountMap.get(v.id)||0,le=Number(Ht.formatEther(v.superLikeETH||0n)),se=V+X*2+re*1.5+Math.min(le*100,200);return N+S+F+se};if(!mm()){p.contractAvailable=!1,p.error="Agora contract not deployed yet.";return}const o=Qs();if(!o){p.contractAvailable=!1,p.error="Could not connect to Agora contract";return}p.contractAvailable=!0;const[s,i,r]=await Promise.all([o.queryFilter(o.filters.PostCreated(),oa).catch(v=>(console.warn("[Agora] PostCreated query failed:",v.message),[])),o.queryFilter(o.filters.ReplyCreated(),oa).catch(v=>(console.warn("[Agora] ReplyCreated query failed:",v.message),[])),o.queryFilter(o.filters.RepostCreated(),oa).catch(v=>(console.warn("[Agora] RepostCreated query failed:",v.message),[]))]);console.log(`[Agora] Events found: ${s.length} posts, ${i.length} replies, ${r.length} reposts`);const l=[];for(const v of s.slice(-80))l.push({ev:v,type:"post"});for(const v of i.slice(-60))l.push({ev:v,type:"reply"});for(const v of r.slice(-30))l.push({ev:v,type:"repost"});const c=[],d=[];p.postsById=new Map,p.replies=new Map,p.replyCountMap=new Map,p.repostCountMap=new Map,p.likesMap=new Map;const f=l.map(({ev:v})=>v.args.postId||v.args.newPostId),g=[];for(let v=0;v<f.length;v+=20){const T=f.slice(v,v+20);try{const I=await ee.getPostsBatch(T);g.push(...I)}catch{for(const I of T)try{g.push(await ee.getPost(I))}catch{g.push(null)}}}for(let v=0;v<l.length;v++){const{ev:T,type:I}=l[v],N=g[v],S=(T.args.postId||T.args.newPostId).toString();if(N&&N.deleted)continue;const $=N?N.createdAt:0,F=N?N.likes:0,V=N&&N.superLikeETH||0n,X=N?N.downvotes:0,re=N?N.replies:0,le=N?N.reposts:0,se=N?N.editedAt:0,ke=N?N.tag:0;if(I==="post"){const{text:G,media:Pe,mediaCID:ct,isVideo:je}=Nc(T.args.contentHash||T.args.content||""),ne={id:S,type:"post",author:T.args.author||(N?N.author:null),content:G,media:Pe,mediaCID:ct,isVideo:je,tag:T.args.tag!=null?Number(T.args.tag):ke,timestamp:$,superLikeETH:V,editedAt:se,likesCount:F,downvotesCount:X,repliesCount:re,repostsCount:le,txHash:T.transactionHash};c.push(ne),d.push(ne),p.postsById.set(S,ne)}else if(I==="reply"){const G=T.args.parentId.toString(),{text:Pe,media:ct,mediaCID:je,isVideo:ne}=Nc(T.args.contentHash||T.args.content||""),dt={id:S,type:"reply",parentId:G,author:T.args.author||(N?N.author:null),content:Pe,media:ct,mediaCID:je,isVideo:ne,tag:T.args.tag!=null?Number(T.args.tag):ke,timestamp:$,superLikeETH:V,editedAt:se,likesCount:F,downvotesCount:X,txHash:T.transactionHash};c.push(dt),p.postsById.set(S,dt),p.replies.has(G)||p.replies.set(G,[]),p.replies.get(G).push(dt),p.replyCountMap.set(G,(p.replyCountMap.get(G)||0)+1)}else if(I==="repost"){const G=((e=T.args.originalId)==null?void 0:e.toString())||((t=T.args.originalPostId)==null?void 0:t.toString())||"0",Pe={id:S,type:"repost",originalPostId:G,author:T.args.author||T.args.reposter,timestamp:$,superLikeETH:0n,editedAt:0,txHash:T.transactionHash};c.push(Pe),d.push(Pe),p.postsById.set(S,Pe),p.repostCountMap.set(G,(p.repostCountMap.get(G)||0)+1)}}if(u.isConnected&&u.userAddress){const v=c.filter(T=>T.type!=="repost").map(T=>T.id);for(let T=0;T<v.length;T+=10){const I=v.slice(T,T+10),N=await Promise.all(I.map(S=>o.hasLiked(S,u.userAddress).catch(()=>!1)));for(let S=0;S<I.length;S++)N[S]&&(p.likesMap.has(I[S])||p.likesMap.set(I[S],new Set),p.likesMap.get(I[S]).add(u.userAddress.toLowerCase()))}}const m=Math.floor(Date.now()/1e3),h=((a=p.userProfile)==null?void 0:a.language)||p.wizLanguage||"",w=u.isConnected&&u.userAddress;d.forEach(v=>{v._score=y(v)}),d.sort((v,T)=>T._score-v._score);const k=v=>p.blockedAuthors.size===0?v:v.filter(T=>{var I;return!p.blockedAuthors.has((I=T.author)==null?void 0:I.toLowerCase())});p.posts=k(d),p.allItems=c,p.trendingPosts=k([...c].filter(v=>v.type!=="repost")).map(v=>{const T=Math.max((m-v.timestamp)/3600,.5),I=Number(Ht.formatEther(v.superLikeETH||0n)),N=v.likesCount||0,S=v.repliesCount||p.replyCountMap.get(v.id)||0,$=v.repostsCount||p.repostCountMap.get(v.id)||0,F=1+N*.5+S*1+$*.8+I*50;return v._trendScore=F/Math.sqrt(T),v}).sort((v,T)=>T._trendScore-v._trendScore),console.log(`[Agora] Loaded: ${p.posts.length} feed posts, ${p.allItems.length} total items, ${p.trendingPosts.length} trending`)}catch(n){console.error("[Agora] Failed to load posts:",n),p.error=n.message}finally{p.isLoading=!1,p._render()}}async function Rc(){try{const e=await ss.getActiveRooms();p.activeRooms=new Map,e.forEach(t=>p.activeRooms.set(String(t.postId),t))}catch(e){console.warn("[Agora] Failed to load live rooms:",e)}}const fl=window.ethers;function Yn(e,t){p.viewHistory.push({view:p.view,activeTab:p.activeTab,selectedPost:p.selectedPost,selectedProfile:p.selectedProfile}),p.view=e,t!=null&&t.post&&(p.selectedPost=t.post),t!=null&&t.profile&&(p.selectedProfile=t.profile),p._render()}function _1(){if(p.viewHistory.length>0){const e=p.viewHistory.pop();p.view=e.view,p.activeTab=e.activeTab||p.view,p.selectedPost=e.selectedPost,p.selectedProfile=e.selectedProfile}else p.view="feed",p.activeTab="feed";p._render()}async function R1(){var i;const e=document.getElementById("bc-compose-input"),t=(i=e==null?void 0:e.value)==null?void 0:i.trim();if(!t){x("Please write something","error");return}const a=ra();if(t.length>a){x(`Post too long (max ${a.toLocaleString()} chars)`,"error");return}p.isPosting=!0,p._render();let n=t,o=0;if(p.pendingMedia.length>0)try{p.isUploadingImage=!0,p._render();const r=[];for(const l of p.pendingMedia){const c=await sk(l.file);c.ipfsHash&&r.push({cid:c.ipfsHash,type:l.type})}if(r.length===1){const l=r[0];n=t+(l.type==="video"?`
[vid]`:`
[img]`)+l.cid,o=l.type==="video"?2:1}else if(r.length>1){const l=r.map(c=>`${c.type==="video"?"vid":"img"}:${c.cid}`).join("|");n=t+`
[gallery]`+l,o=1}}catch(r){console.error("[Agora] Media upload failed:",r),x("Upload failed: "+r.message,"error"),p.isPosting=!1,p.isUploadingImage=!1,p._render();return}finally{p.isUploadingImage=!1}const s=document.getElementById("bc-post-btn");await ee.createPost({content:n,tag:p.composeTag,contentType:o,operator:vt(),button:s,onSuccess:async()=>{e&&(e.value=""),p.pendingMedia=[],p.pendingImage=null,p.pendingImagePreview=null,p.pendingMediaType=null,p.composeTag=0,p.isPosting=!1,x("Post created!","success"),await ot()},onError:()=>{p.isPosting=!1,p._render()}}),p.isPosting=!1,p._render()}async function F1(e){var o;const t=document.getElementById("bc-reply-input"),a=(o=t==null?void 0:t.value)==null?void 0:o.trim();if(!a){x("Please write a reply","error");return}const n=document.getElementById("bc-reply-btn");await ee.createReply({parentId:e,content:a,contentType:0,operator:vt(),button:n,onSuccess:async()=>{t&&(t.value=""),x("Reply posted!","success"),await ot(),p._render()}})}async function D1(e){const t=document.getElementById("bc-repost-confirm-btn");await ee.createRepost({originalPostId:e,operator:vt(),button:t,onSuccess:async()=>{lt("repost"),x("Reposted!","success"),await ot()}})}async function M1(e){var n;const t=(n=u.userAddress)==null?void 0:n.toLowerCase();if(p.actionCart.some(o=>o.type==="like"&&String(o.targetId)===String(e))){x("Already in cart","info");return}t&&(p.likesMap.has(e)||p.likesMap.set(e,new Set),p.likesMap.get(e).add(t));const a=`Post #${e}`;p.actionCart.push({type:"like",targetId:String(e),label:a}),Un(),x("Like added to cart","success"),p._render()}async function O1(e,t){const a=fl.parseEther(t);await ee.superLike({postId:e,ethAmount:a,operator:vt(),onSuccess:async()=>{x("Super Liked!","success"),await ot()}})}async function U1(e){if(p.actionCart.some(a=>a.type==="downvote"&&String(a.targetId)===String(e))){x("Already in cart","info");return}const t=`Post #${e}`;p.actionCart.push({type:"downvote",targetId:String(e),label:t}),Un(),x("Downvote added to cart","success"),p._render()}async function H1(e){await ee.deletePost({postId:e,onSuccess:async()=>{x("Post deleted","success"),await ot()}})}async function j1(e){var s;const t=document.getElementById("bc-edit-post-input"),a=(s=t==null?void 0:t.value)==null?void 0:s.trim();if(!a){x("Content is required","error");return}const n=ra();if(a.length>n){x(`Too long (max ${n.toLocaleString()})`,"error");return}const o=document.getElementById("bc-edit-post-btn");await ee.editPost({postId:e,newContent:a,button:o,onSuccess:async()=>{x("Post edited!","success"),lt("edit-post"),await ot(),p._render()},onError:i=>{x((i==null?void 0:i.shortMessage)||(i==null?void 0:i.message)||"Edit failed","error")}})}async function W1(e){await ee.blockUser({userAddress:e,onSuccess:()=>{p.blockedAuthors.add(e.toLowerCase()),x("User blocked","success"),p._render()},onError:t=>{x((t==null?void 0:t.shortMessage)||(t==null?void 0:t.message)||"Block failed","error")}})}async function G1(e){await ee.unblockUser({userAddress:e,onSuccess:()=>{p.blockedAuthors.delete(e.toLowerCase()),x("User unblocked","success"),p._render()},onError:t=>{x((t==null?void 0:t.shortMessage)||(t==null?void 0:t.message)||"Unblock failed","error")}})}async function K1(e){await ee.pinPost({postId:e,onSuccess:async()=>{x("Post pinned!","success"),await ot()}})}async function V1(e){if(p.actionCart.some(a=>a.type==="follow"&&a.targetId.toLowerCase()===e.toLowerCase())){x("Already in cart","info");return}p.following.add(e.toLowerCase());const t=za(e);p.actionCart.push({type:"follow",targetId:e,label:t}),Un(),x("Follow added to cart","success"),p._render()}async function Y1(e){await ee.unfollow({toUnfollow:e,onSuccess:()=>{p.following.delete(e.toLowerCase()),x("Unfollowed","success"),p._render()}})}async function q1(){const e=JSON.stringify({displayName:p.wizDisplayName,bio:p.wizBio,language:p.wizLanguage}),t=document.getElementById("bc-wizard-confirm-btn");await ee.createProfile({username:p.wizUsername,metadataURI:e,operator:vt(),button:t,onSuccess:async()=>{x("Profile created!","success"),p.hasProfile=!0,p.userProfile={username:p.wizUsername,displayName:p.wizDisplayName,bio:p.wizBio,language:p.wizLanguage,address:u.userAddress},p.profiles.set(u.userAddress.toLowerCase(),{username:p.wizUsername,displayName:p.wizDisplayName,bio:p.wizBio,language:p.wizLanguage}),p.selectedLanguage=p.wizLanguage,p.wizStep=1,p.wizUsername="",p.wizDisplayName="",p.wizBio="",p.view="profile",p.activeTab="profile",p._render()}})}async function X1(){var r,l,c,d,f,g,m,h,w;const e=((l=(r=document.getElementById("edit-displayname"))==null?void 0:r.value)==null?void 0:l.trim())||"",t=((d=(c=document.getElementById("edit-bio"))==null?void 0:c.value)==null?void 0:d.trim())||"",a=document.getElementById("bc-edit-profile-btn");let n=((f=p.userProfile)==null?void 0:f.avatar)||"";const o=(m=(g=document.getElementById("edit-avatar-file"))==null?void 0:g.files)==null?void 0:m[0];if(o)try{a&&(a.disabled=!0),a&&(a.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Optimizing & uploading avatar...'),n=(await ja(o,{tags:[{name:"Type",value:"agora-avatar"}],optimize:{maxWidth:512,maxHeight:512,quality:.8}})).id}catch(y){x("Avatar upload error: "+y.message,"error"),a&&(a.disabled=!1),a&&(a.innerHTML='<i class="fa-solid fa-check"></i> Save Changes');return}const s=((h=document.getElementById("edit-language"))==null?void 0:h.value)||((w=p.userProfile)==null?void 0:w.language)||"",i=JSON.stringify({displayName:e,bio:t,avatar:n,language:s});await ee.updateProfile({metadataURI:i,button:a,onSuccess:()=>{p.userProfile.displayName=e,p.userProfile.bio=t,p.userProfile.avatar=n,p.userProfile.language=s,p.profiles.set(u.userAddress.toLowerCase(),{...p.profiles.get(u.userAddress.toLowerCase()),displayName:e,bio:t,avatar:n,language:s}),lt("edit-profile"),x("Profile updated!","success"),p._render()}})}async function J1(e=0){await ee.obtainBadge({tier:e,operator:vt(),onSuccess:()=>{p.hasBadge=!0,p.badgeTier=Math.max(p.badgeTier,e),lt("badge"),x(`${["Verified","Premium","Elite"][e]} badge obtained!`,"success"),p._render()}})}async function Z1(e,t=0){await ee.reportPost({postId:e,category:t,operator:vt(),onSuccess:()=>{const a=p.postsById.get(Number(e));a&&p.blockedAuthors.add(a.author.toLowerCase()),lt("report"),x("Post reported. Author blocked from your feed.","success"),p._render()},onError:a=>{x((a==null?void 0:a.shortMessage)||(a==null?void 0:a.message)||"Report failed","error")}})}async function Q1(e,t=0){var n;const a=parseInt(((n=document.getElementById("boost-post-days"))==null?void 0:n.value)||"1",10);await ee.boostPost({postId:e,tier:t,days:a,operator:vt(),onSuccess:()=>{lt("boost-post"),x(`Post boosted (${["Standard","Featured"][t]}) for ${a} day${a!==1?"s":""}!`,"success"),p._render()},onError:o=>{x((o==null?void 0:o.shortMessage)||(o==null?void 0:o.message)||"Boost failed","error")}})}async function ek(e){var a;const t=((a=document.getElementById("tip-amount"))==null?void 0:a.value)||"0.001";await ee.tipPost({postId:e,ethAmount:fl.parseEther(t),operator:vt(),onSuccess:()=>{lt("tip"),x(`Tipped ${t} BNB!`,"success"),p._render()},onError:n=>{x((n==null?void 0:n.shortMessage)||(n==null?void 0:n.message)||"Tip failed","error")}})}async function tk(e=1){await ee.boostProfile({days:e,operator:vt(),onSuccess:()=>{p.isBoosted=!0,lt("boost"),x(`Profile boosted for ${e} day${e!==1?"s":""}!`,"success"),p._render()},onError:t=>{x((t==null?void 0:t.shortMessage)||(t==null?void 0:t.message)||"Boost failed","error")}})}let Gi=null,is=null;function ak(e){var a;Gi=e,is=null,document.querySelectorAll('[id^="change-tag-opt-"]').forEach(n=>n.classList.remove("active"));const t=document.getElementById("bc-change-tag-btn");t&&(t.disabled=!0),(a=document.getElementById("modal-change-tag"))==null||a.classList.add("active")}function nk(e){var a;is=e,document.querySelectorAll('[id^="change-tag-opt-"]').forEach(n=>n.classList.remove("active")),(a=document.getElementById(`change-tag-opt-${e}`))==null||a.classList.add("active");const t=document.getElementById("bc-change-tag-btn");t&&(t.disabled=!1)}async function ok(){is===null||!Gi||(lt("change-tag"),await ee.changeTag({postId:Gi,newTag:is,onSuccess:async()=>{x("Tag changed!","success"),await ot()}}))}async function sk(e){const t=e.type.startsWith("video/");return{success:!0,ipfsHash:(await ja(e,{tags:[{name:"Type",value:t?"agora-video":"agora-image"},{name:"Content-Type",value:e.type}]})).id,isVideo:t}}function ik(e){var s;const t=(s=e.target)==null?void 0:s.files;if(!t||t.length===0)return;const a=ns-p.pendingMedia.length;if(a<=0){x(`Max ${ns} media items`,"error");return}const n=Array.from(t).slice(0,a);let o=0;for(const i of n){const r=i.type.startsWith("image/"),l=i.type.startsWith("video/");if(!r&&!l){x("Unsupported file type. Use images or videos.","error");continue}const c=l?Ic.video:Ic.image;if(!c.types.includes(i.type)){x(`Invalid ${l?"video":"image"} format.`,"error");continue}if(i.size>c.max){x(`File too large. Maximum ${c.label}.`,"error");continue}if(l){const d=document.createElement("video");d.preload="metadata",d.onloadeddata=()=>{d.currentTime=1},d.onseeked=()=>{const f=document.createElement("canvas");f.width=d.videoWidth,f.height=d.videoHeight,f.getContext("2d").drawImage(d,0,0),p.pendingMedia.push({file:i,preview:f.toDataURL("image/jpeg"),type:"video"}),URL.revokeObjectURL(d.src),++o===n.length&&p._render()},d.src=URL.createObjectURL(i)}else{const d=new FileReader;d.onload=f=>{p.pendingMedia.push({file:i,preview:f.target.result,type:"image"}),++o===n.length&&p._render()},d.readAsDataURL(i)}}e.target&&(e.target.value="")}function rk(e){typeof e=="number"?p.pendingMedia.splice(e,1):(p.pendingMedia=[],p.pendingImage=null,p.pendingImagePreview=null,p.pendingMediaType=null);const t=document.getElementById("bc-image-input");t&&(t.value=""),p._render()}let Fc=null;function lk(e){p.wizUsername=e.toLowerCase().replace(/[^a-z0-9_]/g,""),p.wizUsernameOk=null,p.wizFee=null,clearTimeout(Fc);const t=document.getElementById("wiz-username-input");t&&(t.value=p.wizUsername),p.wizUsername.length>=1&&p.wizUsername.length<=15?(p.wizChecking=!0,xi(),Fc=setTimeout(async()=>{try{const[a,n]=await Promise.all([ee.isUsernameAvailable(p.wizUsername),ee.getUsernamePrice(p.wizUsername.length)]);p.wizUsernameOk=a,p.wizFee=n.formatted}catch(a){console.warn("Username check failed:",a)}p.wizChecking=!1,xi()},600)):(p.wizChecking=!1,xi())}function xi(){const e=document.getElementById("wiz-username-status");e&&(p.wizChecking?e.innerHTML='<span class="bc-username-checking"><i class="fa-solid fa-spinner fa-spin"></i> Checking...</span>':p.wizUsernameOk===!0?e.innerHTML=`<span class="bc-username-ok"><i class="fa-solid fa-check"></i> Available</span>
                ${p.wizFee&&p.wizFee!=="0.0"?`<span class="bc-username-fee">${p.wizFee} BNB</span>`:'<span class="bc-username-fee">FREE</span>'}`:p.wizUsernameOk===!1?e.innerHTML='<span class="bc-username-taken"><i class="fa-solid fa-xmark"></i> Taken</span>':e.innerHTML="");const t=document.querySelector(".bc-wizard-nav .bc-btn-primary");t&&p.wizStep===1&&(t.disabled=!p.wizUsernameOk)}let ta=null,vn=[];async function ck(){if(p.isLive){x("You are already live!","info");return}if(!u.isConnected){x("Connect your wallet to go live","error");return}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){x("Your browser does not support live streaming (HTTPS required)","error");return}try{x("Requesting camera access...","info"),(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach(t=>t.stop()),x("Creating live post on-chain...","info"),await ee.createPost({content:"LIVE NOW",tag:p.composeTag,contentType:2,operator:vt(),onSuccess:async t=>{var a;try{let n=null;if(t!=null&&t.logs)for(const r of t.logs)try{const c=new fl.Interface(la).parseLog({topics:r.topics,data:r.data});if((c==null?void 0:c.name)==="PostCreated"&&((a=c.args)==null?void 0:a.postId)!=null){n=String(c.args.postId);break}}catch{}if(!n)try{const r=await ee.getPostCount();n=String(r)}catch{n=String(Date.now())}const o=new ss,{roomId:s,stream:i}=await o.startStream(n,u.userAddress);p.liveStream=o,p.isLive=!0,p.liveViewerCount=0,fk(i),o.onViewerCountChange=r=>{p.liveViewerCount=r;const l=document.querySelector("[data-live-viewers]");l&&(l.textContent=`${r} viewer${r!==1?"s":""}`)},x("You are now LIVE!","success"),p._render(),setTimeout(()=>{const r=document.getElementById("bc-local-video");r&&(r.srcObject=i)},150)}catch(n){console.error("[Agora] LiveStream start error:",n),x("Failed to start stream: "+n.message,"error")}},onError:t=>{x("Failed to create live post: "+((t==null?void 0:t.message)||"Transaction rejected"),"error")}})}catch(e){console.error("[Agora] goLive error:",e),e.name==="NotAllowedError"||e.name==="PermissionDeniedError"?x("Camera/mic permission denied. Please allow access and try again.","error"):e.name==="NotFoundError"?x("No camera or microphone found on this device","error"):e.name==="NotReadableError"?x("Camera is in use by another application","error"):x("Failed to go live: "+e.message,"error")}}async function dk(){if(!p.liveStream)return;gk(),await p.liveStream.endStream(),p.liveStream=null,p.isLive=!1,p.liveViewerCount=0,x("Stream ended. Saving recording...","success"),p._render();const e=await mk();e&&(console.log("[Agora] VOD saved with CID:",e),await ot())}async function uk(e){if(!u.isConnected)return;const t=await ss.getRoomByPostId(e);if(!t){x("Stream has ended","info");return}const a=new ss;a.onRemoteStream=n=>{const o=document.getElementById("bc-remote-video");o&&(o.srcObject=n)},a.onStreamEnd=()=>{x("Stream ended","info"),p.liveStream=null,p.watchingStreamId=null,p._render()},a.onError=n=>{x("Stream error: "+n,"error")},await a.joinStream(t.id,u.userAddress),p.liveStream=a,p.watchingStreamId=String(e),p._render(),setTimeout(()=>{if(a.remoteStream){const n=document.getElementById("bc-remote-video");n&&(n.srcObject=a.remoteStream)}},200)}function pk(){p.liveStream&&!p.isLive&&p.liveStream.leaveStream(),p.liveStream=null,p.watchingStreamId=null,p._render()}function fk(e){if(!(!MediaRecorder||!e)){vn=[];try{const t=MediaRecorder.isTypeSupported("video/webm;codecs=vp9,opus")?"video/webm;codecs=vp9,opus":MediaRecorder.isTypeSupported("video/webm;codecs=vp8,opus")?"video/webm;codecs=vp8,opus":"video/webm";ta=new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:15e5}),ta.ondataavailable=a=>{a.data&&a.data.size>0&&vn.push(a.data)},ta.onstop=()=>{console.log(`[Agora] Recording stopped: ${vn.length} chunks`)},ta.start(5e3)}catch(t){console.warn("[Agora] MediaRecorder not available:",t.message)}}}function gk(){ta&&ta.state!=="inactive"&&ta.stop()}async function mk(){if(vn.length===0)return null;const e=new Blob(vn,{type:"video/webm"}),t=(e.size/(1024*1024)).toFixed(1);if(e.size>100*1024*1024)return x(`Recording too large (${t}MB). Max 100MB.`,"error"),null;x(`Saving recording to Arweave (${t}MB)...`,"info");try{const a=new File([e],`agora-live-${Date.now()}.webm`,{type:"video/webm"}),n=await ja(a,{tags:[{name:"Type",value:"agora-vod"}]});return x("Live recording saved permanently!","success"),n.id}catch(a){return console.error("[Agora] VOD upload failed:",a),x("Failed to save recording: "+a.message,"error"),null}finally{vn=[],ta=null}}const vm="agora_action_cart";function Un(){try{localStorage.setItem(vm,JSON.stringify(p.actionCart))}catch{}}function bk(){var e;try{const t=localStorage.getItem(vm);if(!t)return;const a=JSON.parse(t);if(!Array.isArray(a)||a.length===0)return;p.actionCart=a;const n=(e=u.userAddress)==null?void 0:e.toLowerCase();if(n)for(const o of a)if(o.type==="like"){const s=o.targetId;p.likesMap.has(s)||p.likesMap.set(s,new Set),p.likesMap.get(s).add(n)}else o.type==="follow"&&p.following.add(o.targetId.toLowerCase())}catch{}}function xk(e){var n,o;const t=p.actionCart[e];if(!t)return;const a=(n=u.userAddress)==null?void 0:n.toLowerCase();t.type==="like"&&a?(o=p.likesMap.get(t.targetId))==null||o.delete(a):t.type==="follow"&&a&&p.following.delete(t.targetId.toLowerCase()),p.actionCart.splice(e,1),Un(),p.actionCart.length===0&&(p.cartVisible=!1),p._render()}function hk(){var t,a;const e=(t=u.userAddress)==null?void 0:t.toLowerCase();if(e)for(const n of p.actionCart)n.type==="like"?(a=p.likesMap.get(n.targetId))==null||a.delete(e):n.type==="follow"&&p.following.delete(n.targetId.toLowerCase());p.actionCart=[],p.cartVisible=!1,Un(),x("Cart cleared","info"),p._render()}function vk(){p.cartVisible=!p.cartVisible,p._render()}function yk(){const e=window.ethers;let t=0,a=0,n=0;for(const s of p.actionCart)s.type==="like"?t++:s.type==="follow"?a++:s.type==="downvote"&&n++;const o=p.fees.like*BigInt(t)+p.fees.follow*BigInt(a)+p.fees.downvote*BigInt(n);return{total:o,formatted:e.formatEther(o),likes:t,follows:a,downvotes:n}}async function wk(){if(p.actionCart.length===0){x("Cart is empty","info");return}if(p.cartSubmitting)return;p.cartSubmitting=!0,p._render();const{total:e}=yk(),t=[...p.actionCart];await ee.batchActions({actions:t,totalFee:e,operator:vt(),onSuccess:async()=>{p.actionCart=[],p.cartVisible=!1,p.cartSubmitting=!1,Un(),x(`${t.length} actions registered on blockchain!`,"success"),await ot(),p._render()},onError:a=>{console.error("[Agora] Batch failed:",a),p.cartSubmitting=!1,x((a==null?void 0:a.shortMessage)||(a==null?void 0:a.message)||"Batch transaction failed","error"),p._render()}}),p.cartSubmitting=!1,p._render()}function kk(e){document.querySelectorAll(".bc-post-dropdown").forEach(d=>d.style.display="none");const t=p.postsById.get(e),a=pl(t==null?void 0:t.author),n=u.userAddress||"",o=a?`@${a}/${e}`:`post=${e}`,s=n?`&ref=${n}`:"",i=`${window.location.origin}/#agora?${o}${s}`,r=a?`@${a}`:"someone",c=(t!=null&&t.content?t.content.slice(0,100)+(t.content.length>100?"...":""):"")||`Check out ${r}'s post on Backchain Agora`;navigator.share?navigator.share({title:`${r} on Backchain`,text:c,url:i}).catch(()=>{}):navigator.clipboard.writeText(i).then(()=>{x("Link copied!","success")}).catch(()=>{const d=document.createElement("input");d.value=i,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),x("Link copied!","success")})}function lt(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.remove("active")}function Ek(e){const t=document.getElementById(`post-menu-${e}`);if(!t)return;const a=t.style.display!=="none";document.querySelectorAll(".bc-post-dropdown").forEach(n=>n.style.display="none"),t.style.display=a?"none":"block"}document.addEventListener("click",()=>{document.querySelectorAll(".bc-post-dropdown").forEach(e=>e.style.display="none")});function Tk(){let e='<div class="bc-compose-tags">';for(const t of Tn){const a=p.composeTag===t.id?"active":"";e+=`<button class="bc-compose-tag ${a}" onclick="AgoraPage.setComposeTag(${t.id})">${t.name}</button>`}return e+="</div>",e}function Ck(){if(p.hasBadge&&p.badgeTier>=2)return"";ra();let e,t,a,n;return p.hasBadge?p.badgeTier===0?(e="Premium",t=Ca.premium,a="fa-circle-check",n="#eab308"):(e="Elite",t=Ca.elite,a="fa-gem",n="#a855f7"):(e="Verified",t=Ca.verified,a="fa-circle-check",n="#3b82f6"),`<div class="bc-upgrade-hint" onclick="AgoraPage.openBadge()">
        <i class="fa-solid ${a}" style="color:${n};font-size:11px;"></i>
        <span>Up to ${t.toLocaleString()} chars with <strong style="color:${n}">${e}</strong></span>
        <i class="fa-solid fa-chevron-right" style="font-size:9px;opacity:0.5;"></i>
    </div>`}function Bk(){if(p.pendingMedia.length===0)return"";const e=p.pendingMedia.length<ns;return`<div class="bc-media-grid">${p.pendingMedia.map((n,o)=>`
        <div class="bc-media-thumb">
            <img src="${n.preview}" alt="">
            ${n.type==="video"?'<div class="bc-video-badge"><i class="fa-solid fa-play"></i> Video</div>':""}
            <button class="bc-image-remove" onclick="event.stopPropagation(); AgoraPage.removeImage(${o})"><i class="fa-solid fa-xmark"></i></button>
        </div>`).join("")}${e?`
        <div class="bc-media-thumb bc-media-add" onclick="document.getElementById('bc-image-input').click()">
            <i class="fa-solid fa-plus"></i>
        </div>`:""}</div>`}function ym(){var o;if(!u.isConnected)return"";const t=p.pendingMedia.length>0?`~${Cn(p.fees.post||0n)} BNB`:"FREE",a=!p.hasProfile&&u.isConnected?`
        <div class="bc-profile-create-banner">
            <p>Create your profile to get a username and start posting</p>
            <button class="bc-btn bc-btn-primary" onclick="AgoraPage.openProfileSetup()">
                <i class="fa-solid fa-user-plus"></i> Create Profile
            </button>
        </div>`:"",n=Ck();return`
        ${a}
        <div class="bc-compose">
            <div class="bc-compose-row">
                <div class="bc-compose-avatar">
                    ${(o=p.userProfile)!=null&&o.username?p.userProfile.username.charAt(0).toUpperCase():co(u.userAddress)}
                </div>
                <div class="bc-compose-body">
                    <textarea id="bc-compose-input" class="bc-compose-textarea" placeholder="What's happening on-chain?" maxlength="${ra()}" oninput="AgoraPage._updateCharCount(this)"></textarea>
                    ${Bk()}
                    ${p.isUploadingImage?'<div class="bc-uploading-badge"><i class="fa-solid fa-spinner fa-spin"></i> Uploading media...</div>':""}
                    ${Tk()}
                </div>
            </div>
            ${n}
            <div class="bc-compose-divider"></div>
            <div class="bc-compose-bottom">
                <div class="bc-compose-tools">
                    <button class="bc-compose-tool" title="Add media" onclick="document.getElementById('bc-image-input').click()" ${p.pendingMedia.length>=ns?"disabled":""}><i class="fa-solid fa-image"></i></button>
                    <input type="file" id="bc-image-input" hidden accept="image/jpeg,image/png,image/gif,image/webp,video/mp4,video/webm,video/ogg" multiple onchange="AgoraPage.handleImageSelect(event)">
                    <button class="bc-go-live-btn" title="Go Live" onclick="AgoraPage.goLive()" ${p.isLive?"disabled":""}>
                        <i class="fa-solid fa-video"></i> ${p.isLive?"LIVE":"Go Live"}
                    </button>
                </div>
                <div class="bc-compose-right">
                    <span class="bc-char-count" id="bc-char-counter">0/${ra().toLocaleString()}</span>
                    <span class="bc-compose-fee">${t}</span>
                    <button id="bc-post-btn" class="bc-post-btn" onclick="AgoraPage.createPost()" ${p.isPosting?"disabled":""}>
                        ${p.isPosting?'<i class="fa-solid fa-spinner fa-spin"></i> Posting':"Post"}
                    </button>
                </div>
            </div>
        </div>`}const Dc=280;function Ak(e,t={}){if(!e.content)return"";const n=!(t.noAnimation&&!t.isRepostContent)&&e.content.length>Dc,o=n?e.content.slice(0,Dc)+"...":e.content;return`<div class="bc-post-body" data-post-id="${e.id}">
        ${bm(nt(o))}
        ${n?`<span class="bc-read-more" onclick="event.stopPropagation(); AgoraPage.expandPost('${e.id}')">Read more</span>`:""}
    </div>`}function Ik(e){var o,s;const t=e.media||[];if(t.length===0&&!e.mediaCID)return"";if(t.length<=1){const i=((o=t[0])==null?void 0:o.cid)||e.mediaCID,r=((s=t[0])==null?void 0:s.type)==="video"||e.isVideo;if(!i)return"";const l=En(i)||"";return`<div class="bc-post-media">${r?`<video src="${l}" playsinline muted loop preload="metadata" data-post-video="${e.id}" onerror="this.style.display='none'"></video>`:`<img src="${l}" alt="Media" loading="lazy" onerror="this.style.display='none'">`}</div>`}const a=t.map((i,r)=>{const l=En(i.cid)||"",c=r===0?"":' style="display:none;"';return i.type==="video"?`<div class="bc-carousel-slide" data-slide="${r}"${c}><video src="${l}" playsinline muted loop preload="metadata" data-post-video="${e.id}"></video></div>`:`<div class="bc-carousel-slide" data-slide="${r}"${c}><img src="${l}" alt="Media ${r+1}" loading="lazy"></div>`}).join(""),n=t.map((i,r)=>`<span class="bc-carousel-dot${r===0?" active":""}" data-idx="${r}"></span>`).join("");return`
        <div class="bc-post-media bc-carousel" data-carousel="${e.id}" data-current="0" data-total="${t.length}" onclick="event.stopPropagation();">
            <div class="bc-carousel-track">${a}</div>
            <div class="bc-carousel-dots">${n}</div>
            <button class="bc-carousel-arrow bc-carousel-prev" onclick="AgoraPage.carouselPrev('${e.id}')" style="display:none;"><i class="fa-solid fa-chevron-left"></i></button>
            <button class="bc-carousel-arrow bc-carousel-next" onclick="AgoraPage.carouselNext('${e.id}')"><i class="fa-solid fa-chevron-right"></i></button>
            <span class="bc-carousel-counter">1/${t.length}</span>
        </div>`}function Pk(e){var o,s,i;if(!u.isConnected)return"";const t=((o=e.author)==null?void 0:o.toLowerCase())===((s=u.userAddress)==null?void 0:s.toLowerCase()),a=p.blockedAuthors.has((i=e.author)==null?void 0:i.toLowerCase()),n=t;return`
        <div class="bc-post-menu-wrap">
            <button class="bc-post-menu-btn" onclick="event.stopPropagation(); AgoraPage.togglePostMenu('${e.id}')" title="Options">
                <i class="fa-solid fa-ellipsis"></i>
            </button>
            <div class="bc-post-dropdown" id="post-menu-${e.id}" style="display:none;">
                ${t?`
                ${n?`<button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.openEditPost('${e.id}')">
                    <i class="fa-solid fa-pen"></i> Edit Post
                </button>`:""}
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.pinPost('${e.id}')">
                    <i class="fa-solid fa-thumbtack"></i> Pin to profile
                </button>
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.openChangeTag('${e.id}')">
                    <i class="fa-solid fa-tag"></i> Change Tag
                </button>`:`
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.openTip('${e.id}')">
                    <i class="fa-solid fa-hand-holding-dollar"></i> Tip Author
                </button>
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.${a?"unblockUser":"blockUser"}('${e.author}')">
                    <i class="fa-solid fa-${a?"unlock":"ban"}"></i> ${a?"Unblock":"Block"} User
                </button>
                <button class="bc-post-dropdown-item danger" onclick="event.stopPropagation(); AgoraPage.openReport('${e.id}')">
                    <i class="fa-solid fa-flag"></i> Report
                </button>`}
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.sharePost('${e.id}')">
                    <i class="fa-solid fa-share-nodes"></i> Share
                </button>
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); AgoraPage.openBoostPost('${e.id}')">
                    <i class="fa-solid fa-rocket"></i> Boost Post
                </button>
                ${e.txHash?`
                <button class="bc-post-dropdown-item" onclick="event.stopPropagation(); window.open('${A1}${e.txHash}', '_blank')">
                    <i class="fa-solid fa-cube"></i> View on Explorer
                </button>`:""}
                ${t?`
                <button class="bc-post-dropdown-item danger" onclick="event.stopPropagation(); AgoraPage.deletePost('${e.id}')">
                    <i class="fa-solid fa-trash"></i> Delete
                </button>`:""}
            </div>
        </div>`}function Ma(e,t=0,a={}){var y,k,v,T;if(e.type==="repost"&&!a.isRepostContent){const I=p.postsById.get(e.originalPostId);return`
            <div class="bc-post" data-post-id="${e.id}" style="animation-delay:${Math.min(t*.04,.4)}s">
                <div class="bc-repost-banner"><i class="fa-solid fa-retweet"></i> <span>${za(e.author)} reposted</span></div>
                ${I?Ma(I,t,{isRepostContent:!0,noAnimation:!0}):'<div class="bc-post-body" style="padding:16px 20px;color:var(--bc-text-3);">Original post not found</div>'}
            </div>`}const n=za(e.author),o=pl(e.author),s=z1(e.author),i=$1(e.author),r=Cn(e.superLikeETH||0n),l=e.repliesCount||p.replyCountMap.get(e.id)||0,c=e.repostsCount||p.repostCountMap.get(e.id)||0,d=e.likesCount||((y=p.likesMap.get(e.id))==null?void 0:y.size)||0,f=e.downvotesCount||0,g=((v=p.likesMap.get(e.id))==null?void 0:v.has((k=u.userAddress)==null?void 0:k.toLowerCase()))||!1,m=e.editedAt>0,h=a.noAnimation?"":`style="animation-delay:${Math.min(t*.04,.4)}s"`,w=S1(e.tag||0);return`
        <div class="bc-post" data-post-id="${e.id}" ${h} onclick="AgoraPage.viewPost('${e.id}')">
            <div class="bc-post-top">
                <div class="bc-avatar ${s?"boosted":""}" onclick="event.stopPropagation(); AgoraPage.viewProfile('${e.author}')">
                    ${hm(e.author)}
                </div>
                <div class="bc-post-head">
                    <div class="bc-post-author-row">
                        <span class="bc-author-name" onclick="event.stopPropagation(); AgoraPage.viewProfile('${e.author}')">${n}</span>
                        ${i?`<i class="fa-solid fa-circle-check bc-verified-icon" title="${["Verified","Premium","Elite"][p.badgeTier]||"Verified"}" style="${p.badgeTier===2?"color:#a855f7":p.badgeTier===1?"color:#f59e0b":""}"></i>`:""}
                        ${o?`<span class="bc-post-time">@${o}</span>`:""}
                        <span class="bc-post-time">&middot; ${Ui(e.timestamp)}</span>
                        ${m?`<span class="bc-post-time bc-edited-hint" title="Edited ${Ui(e.editedAt)}">&#9998; edited</span>`:""}
                        ${e.tag>0?`<span class="bc-tag-badge" style="color:${w.color};border-color:${w.color}30"><i class="fa-solid ${w.icon}"></i> ${w.name}</span>`:""}
                        ${p.activeRooms.has(String(e.id))?'<span class="bc-live-badge"><span class="bc-live-badge-dot"></span> LIVE</span>':""}
                    </div>
                    ${e.type==="reply"?`<div class="bc-post-context">Replying to ${za((T=p.postsById.get(e.parentId))==null?void 0:T.author)}</div>`:""}
                </div>
                ${Pk(e)}
            </div>
            ${Ak(e,a)}
            ${Ik(e)}
            <div class="bc-actions" onclick="event.stopPropagation()">
                <button class="bc-action act-reply" onclick="AgoraPage.openReply('${e.id}')" title="Reply">
                    <i class="fa-regular fa-comment"></i>${l>0?`<span class="count">${l}</span>`:""}
                </button>
                <button class="bc-action act-repost" onclick="AgoraPage.openRepostConfirm('${e.id}')" title="Repost">
                    <i class="fa-solid fa-retweet"></i>${c>0?`<span class="count">${c}</span>`:""}
                </button>
                <button class="bc-action act-like ${g?"liked":""}" onclick="AgoraPage.like('${e.id}')" title="Like">
                    <i class="${g?"fa-solid":"fa-regular"} fa-heart"></i>${d>0?`<span class="count">${d}</span>`:""}
                </button>
                <button class="bc-action act-down" onclick="AgoraPage.openDownvote('${e.id}')" title="Downvote">
                    <i class="fa-solid fa-arrow-down"></i>${f>0?`<span class="count">${f}</span>`:""}
                </button>
                <button class="bc-action act-super" onclick="AgoraPage.openSuperLike('${e.id}')" title="Super Like">
                    <i class="fa-solid fa-star"></i>${(e.superLikeETH||0n)>0n?`<span class="bc-eth-val">${r}</span>`:""}
                </button>
                <button class="bc-action act-share" onclick="AgoraPage.sharePost('${e.id}')" title="Share">
                    <i class="fa-solid fa-arrow-up-from-bracket"></i>
                </button>
            </div>
        </div>`}const Nk=20;function zk(){let t=`<div class="bc-tag-bar">
        <button class="bc-tag-pill ${p.selectedTag===-1?"active":""}" onclick="AgoraPage.filterTag(-1)"><i class="fa-solid fa-layer-group"></i> All</button>`;for(const a of Tn){const n=p.selectedTag===a.id?"active":"";t+=`<button class="bc-tag-pill ${n}" onclick="AgoraPage.filterTag(${a.id})" style="${n?"":`color:${a.color}`}"><i class="fa-solid ${a.icon}"></i> ${a.name}</button>`}return t+="</div>",t}function $k(){var o;const e={};for(const s of p.posts){const i=p.profiles.get((o=s.author)==null?void 0:o.toLowerCase()),r=(i==null?void 0:i.language)||"";r&&(e[r]=(e[r]||0)+1)}const t=ya.filter(s=>e[s.code]);if(t.length<=1)return"";let n=`<div class="bc-tag-bar" style="margin-bottom:4px;">
        <button class="bc-tag-pill ${p.selectedLanguage?"":"active"}" onclick="AgoraPage.filterLanguage(null)"><i class="fa-solid fa-globe"></i> All</button>`;for(const s of t){const i=p.selectedLanguage===s.code?"active":"";n+=`<button class="bc-tag-pill ${i}" onclick="AgoraPage.filterLanguage('${s.code}')">${s.flag} ${s.name} <span style="opacity:0.6;font-size:11px;">${e[s.code]}</span></button>`}return n+="</div>",n}function Sk(){return p.watchingStreamId?`
        <div class="bc-live-bar">
            <video id="bc-remote-video" class="bc-live-video" autoplay playsinline style="max-height:400px;object-fit:contain;"></video>
            <div style="display:flex;align-items:center;justify-content:space-between;margin-top:12px;">
                <div class="bc-live-indicator">
                    <span class="bc-live-dot"></span>
                    <span class="bc-live-label">LIVE</span>
                </div>
                <button class="bc-btn bc-btn-outline" onclick="AgoraPage.leaveLive()">
                    <i class="fa-solid fa-xmark"></i> Leave
                </button>
            </div>
        </div>`:""}function Lk(){const e=`<div class="bc-skeleton-post">
        <div class="bc-skeleton-avatar"></div>
        <div class="bc-skeleton-body">
            <div class="bc-skeleton-line short"></div>
            <div class="bc-skeleton-line long"></div>
            <div class="bc-skeleton-line medium"></div>
            <div class="bc-skeleton-actions"><div class="bc-skeleton-dot"></div><div class="bc-skeleton-dot"></div><div class="bc-skeleton-dot"></div><div class="bc-skeleton-dot"></div></div>
        </div>
    </div>`;return e+e+e}function Mc(){var s;if(!p.contractAvailable)return`<div class="bc-empty">
            <div class="bc-empty-glyph accent"><i class="fa-solid fa-rocket"></i></div>
            <div class="bc-empty-title">Coming Soon!</div>
            <div class="bc-empty-text">${p.error||"Agora is being deployed. The unstoppable social network will be live soon!"}</div>
            <button class="bc-btn bc-btn-outline" style="margin-top:24px;" onclick="AgoraPage.refresh()"><i class="fa-solid fa-arrows-rotate"></i> Retry</button>
        </div>`;if(p.isLoading)return Lk();let e=p.posts;if(p.selectedLanguage&&(e=e.filter(i=>{var c;const r=i.type==="repost"?(c=p.postsById.get(i.originalPostId))==null?void 0:c.author:i.author,l=p.profiles.get(r==null?void 0:r.toLowerCase());return(l==null?void 0:l.language)===p.selectedLanguage})),p.selectedTag>=0&&(e=e.filter(i=>{if(i.type==="repost"){const r=p.postsById.get(i.originalPostId);return r&&r.tag===p.selectedTag}return i.tag===p.selectedTag})),e.length===0){const i=p.selectedTag>=0&&((s=Tn[p.selectedTag])==null?void 0:s.name)||"";return p.selectedTag>=0?`<div class="bc-empty">
                <div class="bc-empty-glyph"><i class="fa-regular fa-comment-dots"></i></div>
                <div class="bc-empty-title">No ${i} posts</div>
                <div class="bc-empty-text">Try a different tag or be the first to post!</div>
            </div>`:u.isConnected&&!p.hasProfile?`<div class="bc-empty">
                <div class="bc-empty-glyph accent"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
                <div class="bc-empty-title">Welcome to Agora</div>
                <div style="display:flex;flex-direction:column;gap:12px;margin:16px 0;text-align:left;max-width:280px;">
                    <div style="display:flex;align-items:center;gap:10px;font-size:14px;color:var(--bc-text-2);">
                        <span style="width:24px;height:24px;border-radius:50%;background:var(--bc-accent);color:#000;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;flex-shrink:0;">1</span>
                        Create your profile
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;font-size:14px;color:var(--bc-text-2);">
                        <span style="width:24px;height:24px;border-radius:50%;background:var(--bc-bg3);color:var(--bc-text-3);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;flex-shrink:0;">2</span>
                        Post your first thought
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;font-size:14px;color:var(--bc-text-2);">
                        <span style="width:24px;height:24px;border-radius:50%;background:var(--bc-bg3);color:var(--bc-text-3);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;flex-shrink:0;">3</span>
                        Earn Super Likes
                    </div>
                </div>
                <button class="bc-btn bc-btn-primary" style="margin-top:8px;" onclick="AgoraPage.openProfileSetup()"><i class="fa-solid fa-user-plus"></i> Get Started</button>
            </div>`:`<div class="bc-empty">
            <div class="bc-empty-glyph"><i class="fa-regular fa-comment-dots"></i></div>
            <div class="bc-empty-title">No posts yet</div>
            <div class="bc-empty-text">Be the first to post on the unstoppable social network!</div>
        </div>`}const t=(p.feedPage+1)*Nk,a=e.slice(0,t),n=e.length>t;if(p.feedMode==="tiktok")return`<div class="bc-tiktok-feed" data-tiktok-feed>
                ${a.map((i,r)=>wm(i)).join("")}
            </div>`;let o=a.map((i,r)=>Ma(i,r)).join("");return n&&(o+='<div class="bc-feed-sentinel" data-sentinel="feed"><div class="bc-loading"><div class="bc-spinner"></div></div></div>'),o}function wm(e,t){var m,h,w,y,k,v,T;const a=((h=(m=e.media)==null?void 0:m[0])==null?void 0:h.cid)||e.mediaCID,n=((y=(w=e.media)==null?void 0:w[0])==null?void 0:y.type)==="video"||e.isVideo,o=a&&En(a)||"",s=za(e.author),i=e.content?nt(e.content):"",r=e.content&&e.content.length>100,l=e.likesCount||((k=p.likesMap.get(e.id))==null?void 0:k.size)||0,c=e.repliesCount||p.replyCountMap.get(e.id)||0,d=Cn(e.superLikeETH||0n),f=((T=p.likesMap.get(e.id))==null?void 0:T.has((v=u.userAddress)==null?void 0:v.toLowerCase()))||!1;let g;if(n&&o)g="background:#000;";else if(o)g=`background-image:url('${o}');background-size:cover;background-position:center;`;else{const I=e.id*37%360;g=`background:linear-gradient(135deg, hsl(${I},40%,15%), hsl(${(I+60)%360},30%,8%));`}return`
        <div class="bc-tiktok-card" data-post-id="${e.id}" ${g.includes("background-image")?`style="${g}"`:`style="${g}"`}>
            ${n&&o?`<video class="bc-tiktok-video" src="${o}" playsinline muted loop preload="metadata" data-post-video="${e.id}"></video>`:""}
            ${!n&&o?'<div class="bc-tiktok-img-overlay"></div>':""}
            <div class="bc-tiktok-overlay">
                <div class="bc-tiktok-bottom">
                    <div class="bc-tiktok-info">
                        <div class="bc-tiktok-author" onclick="event.stopPropagation(); AgoraPage.viewProfile('${e.author}')">
                            <strong>${s}</strong>
                            <span class="bc-tiktok-time">${Ui(e.timestamp)}</span>
                        </div>
                        ${i?`<div class="bc-tiktok-caption" data-caption-id="${e.id}" onclick="event.stopPropagation(); AgoraPage.toggleCaption('${e.id}')">${i}${r?'<span class="bc-tiktok-more"> more</span>':""}</div>`:""}
                    </div>
                    <div class="bc-tiktok-actions">
                        <div class="bc-tiktok-action" onclick="event.stopPropagation(); AgoraPage.viewProfile('${e.author}')">
                            <div class="bc-tiktok-avatar">${hm(e.author)}</div>
                        </div>
                        <div class="bc-tiktok-action ${f?"liked":""}" onclick="event.stopPropagation(); AgoraPage.like('${e.id}')">
                            <i class="${f?"fa-solid":"fa-regular"} fa-heart"></i>
                            <span>${l||""}</span>
                        </div>
                        <div class="bc-tiktok-action" onclick="event.stopPropagation(); AgoraPage.viewPost('${e.id}')">
                            <i class="fa-regular fa-comment"></i>
                            <span>${c||""}</span>
                        </div>
                        <div class="bc-tiktok-action" onclick="event.stopPropagation(); AgoraPage.openSuperLike('${e.id}')">
                            <i class="fa-solid fa-star"></i>
                            <span>${(e.superLikeETH||0n)>0n?d:""}</span>
                        </div>
                        <div class="bc-tiktok-action" onclick="event.stopPropagation(); AgoraPage.sharePost('${e.id}')">
                            <i class="fa-solid fa-arrow-up-from-bracket"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>`}function _k(){const e=`
        <div class="bc-discover-mode-toggle">
            <button class="bc-mode-btn ${p.feedMode==="list"?"active":""}" onclick="AgoraPage.setFeedMode('list')" title="List view">
                <i class="fa-solid fa-list"></i>
            </button>
            <button class="bc-mode-btn ${p.feedMode==="tiktok"?"active":""}" onclick="AgoraPage.setFeedMode('tiktok')" title="Vertical scroll">
                <i class="fa-solid fa-clapperboard"></i>
            </button>
        </div>`;return p.trendingPosts.length===0?`
            <div class="bc-discover-header">
                <h2><i class="fa-solid fa-fire"></i> Discover ${e}</h2>
                <p>Ranked by engagement â€” likes, replies, reposts & Super Likes</p>
            </div>
            <div class="bc-empty">
                <div class="bc-empty-glyph accent"><i class="fa-solid fa-fire"></i></div>
                <div class="bc-empty-title">No posts yet</div>
                <div class="bc-empty-text">Be the first to post! Posts are ranked by engagement â€” likes, replies, and Super Likes boost visibility.</div>
            </div>`:p.feedMode==="tiktok"?`
            <div class="bc-tiktok-feed" data-tiktok-feed>
                ${p.trendingPosts.map((t,a)=>wm(t)).join("")}
            </div>`:`
        <div class="bc-discover-header">
            <h2><i class="fa-solid fa-fire"></i> Discover ${e}</h2>
            <p>Ranked by engagement â€” likes, replies, reposts & Super Likes</p>
        </div>
        ${p.trendingPosts.map((t,a)=>Ma(t,a,{})).join("")}`}function Rk(){var r,l,c,d,f,g,m,h,w,y;if(!u.isConnected)return`<div class="bc-empty">
            <div class="bc-empty-glyph"><i class="fa-solid fa-wallet"></i></div>
            <div class="bc-empty-title">Connect Wallet</div>
            <div class="bc-empty-text">Connect your wallet to view your profile.</div>
            <button class="bc-btn bc-btn-primary" style="margin-top:24px;" onclick="window.openConnectModal && window.openConnectModal()"><i class="fa-solid fa-wallet"></i> Connect Wallet</button>
        </div>`;const e=(r=u.userAddress)==null?void 0:r.toLowerCase(),t=p.allItems.filter(k=>{var v;return((v=k.author)==null?void 0:v.toLowerCase())===e&&k.type!=="repost"}),a=((l=p.followCounts.get(e))==null?void 0:l.followers)??p.followers.size,n=((c=p.followCounts.get(e))==null?void 0:c.following)??p.following.size,o=((d=p.userProfile)==null?void 0:d.displayName)||((f=p.userProfile)==null?void 0:f.username)||os(u.userAddress),s=(g=p.userProfile)!=null&&g.avatar?ul(p.userProfile.avatar):"",i=t.reduce((k,v)=>k+(v.superLikeETH||0n),0n);return`
        <div class="bc-profile-section">
            <div class="bc-profile-banner"></div>
            <div class="bc-profile-main">
                <div class="bc-profile-top-row">
                    <div class="bc-profile-pic ${p.isBoosted?"boosted":""}">${s?`<img src="${s}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" onerror="this.outerHTML='${(m=p.userProfile)!=null&&m.username?p.userProfile.username.charAt(0).toUpperCase():co(u.userAddress)}'">`:(h=p.userProfile)!=null&&h.username?p.userProfile.username.charAt(0).toUpperCase():co(u.userAddress)}</div>
                    <div class="bc-profile-actions">
                        ${p.hasProfile?'<button class="bc-btn bc-btn-outline" onclick="AgoraPage.openEditProfile()"><i class="fa-solid fa-pen"></i> Edit</button>':'<button class="bc-btn bc-btn-primary" onclick="AgoraPage.openProfileSetup()"><i class="fa-solid fa-user-plus"></i> Create Profile</button>'}
                        ${p.hasBadge?"":'<button class="bc-btn bc-btn-outline" onclick="AgoraPage.openBadge()"><i class="fa-solid fa-circle-check"></i> Badge</button>'}
                        ${p.isBoosted?"":'<button class="bc-btn bc-btn-outline" onclick="AgoraPage.openBoost()"><i class="fa-solid fa-rocket"></i> Boost</button>'}
                    </div>
                </div>
                <div class="bc-profile-name-row">
                    <span class="bc-profile-name">${nt(o)}</span>
                    ${p.hasBadge?`<i class="fa-solid fa-circle-check bc-profile-badge"></i> <span style="font-size:11px;color:var(--bc-text-3);">${Pc(p.badgeExpiry)}</span>`:""}
                    ${p.isBoosted?`<span class="bc-boosted-tag"><i class="fa-solid fa-rocket"></i> Boosted ${Pc(p.boostExpiry)}</span>`:""}
                </div>
                ${(w=p.userProfile)!=null&&w.username?`<div class="bc-profile-username">@${p.userProfile.username}</div>`:""}
                ${(y=p.userProfile)!=null&&y.bio?`<div class="bc-profile-bio">${nt(p.userProfile.bio)}</div>`:""}
                <div class="bc-profile-handle">
                    <a href="${gm}${u.userAddress}" target="_blank" rel="noopener">View on Explorer <i class="fa-solid fa-arrow-up-right-from-square"></i></a>
                </div>
                <div class="bc-profile-stats" style="grid-template-columns:repeat(4,1fr);">
                    <div class="bc-stat-cell"><div class="bc-stat-value">${t.length}</div><div class="bc-stat-label">Posts</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${a}</div><div class="bc-stat-label">Followers</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${n}</div><div class="bc-stat-label">Following</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value" style="color:var(--bc-accent);">${Cn(i)}</div><div class="bc-stat-label"><i class="fa-solid fa-star" style="color:var(--bc-accent);font-size:10px;"></i> BNB</div></div>
                </div>
                ${P1()}
            </div>
            <div class="bc-section-head">
                <span class="bc-section-title"><i class="fa-solid fa-clock-rotate-left"></i> Your Posts</span>
                <span class="bc-section-subtitle">${t.length} total</span>
            </div>
            ${t.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No posts yet â€” share your first thought!</div></div>':t.sort((k,v)=>v.timestamp-k.timestamp).map((k,v)=>Ma(k,v)).join("")}
        </div>`}function Fk(){var m;const e=p.selectedProfile;if(!e)return'<div class="bc-empty"><div class="bc-empty-title">User not found</div></div>';const t=e.toLowerCase(),a=p.profiles.get(t),n=(a==null?void 0:a.displayName)||(a==null?void 0:a.username)||os(e),o=a==null?void 0:a.username,s=a==null?void 0:a.bio,i=xm(e),r=o?o.charAt(0).toUpperCase():co(e),l=t===((m=u.userAddress)==null?void 0:m.toLowerCase()),c=p.following.has(t),d=p.blockedAuthors.has(t),f=p.followCounts.get(t)||{followers:0,following:0},g=p.allItems.filter(h=>{var w;return((w=h.author)==null?void 0:w.toLowerCase())===t&&h.type!=="repost"});return p.followCounts.has(t)||ee.getUserProfile(e).then(h=>{h&&(p.followCounts.set(t,{followers:h.followers,following:h.following}),p._render())}).catch(()=>{}),`
        <div class="bc-profile-section">
            <div class="bc-profile-banner"></div>
            <div class="bc-profile-main">
                <div class="bc-profile-top-row">
                    <div class="bc-profile-pic">${i?`<img src="${i}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;" onerror="this.outerHTML='${r}'">`:r}</div>
                    <div class="bc-profile-actions">
                        ${!l&&u.isConnected?`
                            <button class="bc-follow-toggle ${c?"do-unfollow":"do-follow"}"
                                onclick="AgoraPage.${c?"unfollow":"follow"}('${e}')">
                                ${c?"Following":"Follow"}
                            </button>
                            <button class="bc-btn bc-btn-outline" style="padding:8px 14px;${d?"border-color:var(--bc-red);color:var(--bc-red);":""}"
                                onclick="AgoraPage.${d?"unblockUser":"blockUser"}('${e}')">
                                <i class="fa-solid fa-${d?"unlock":"ban"}"></i> ${d?"Unblock":"Block"}
                            </button>`:""}
                    </div>
                </div>
                <div class="bc-profile-name-row"><span class="bc-profile-name">${nt(n)}</span></div>
                ${o?`<div class="bc-profile-username">@${o}</div>`:""}
                ${s?`<div class="bc-profile-bio">${nt(s)}</div>`:""}
                <div class="bc-profile-handle">
                    <a href="${gm}${e}" target="_blank" rel="noopener">${os(e)} <i class="fa-solid fa-arrow-up-right-from-square"></i></a>
                </div>
                <div class="bc-profile-stats">
                    <div class="bc-stat-cell"><div class="bc-stat-value">${g.length}</div><div class="bc-stat-label">Posts</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${f.followers}</div><div class="bc-stat-label">Followers</div></div>
                    <div class="bc-stat-cell"><div class="bc-stat-value">${f.following}</div><div class="bc-stat-label">Following</div></div>
                </div>
            </div>
            <div class="bc-section-head"><span class="bc-section-title"><i class="fa-solid fa-clock-rotate-left"></i> Posts</span><span class="bc-section-subtitle">${g.length}</span></div>
            ${g.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No posts yet</div></div>':g.sort((h,w)=>w.timestamp-h.timestamp).map((h,w)=>Ma(h,w)).join("")}
        </div>`}function Oc(){if(!u.isConnected)return`<div class="bc-empty">
            <div class="bc-empty-glyph"><i class="fa-solid fa-wallet"></i></div>
            <div class="bc-empty-title">Connect Wallet</div>
            <div class="bc-empty-text">Connect your wallet to create your profile.</div>
        </div>`;const e=p.wizStep;return`
        <div class="bc-wizard">
            <div class="bc-wizard-title">Create Your Profile</div>
            <div class="bc-wizard-desc">Set up your on-chain identity on Agora</div>
            <div class="bc-wizard-dots">
                <div class="bc-wizard-dot ${e===1?"active":e>1?"done":""}"></div>
                <div class="bc-wizard-dot ${e===2?"active":e>2?"done":""}"></div>
                <div class="bc-wizard-dot ${e===3?"active":""}"></div>
            </div>
            <div class="bc-wizard-card">
                ${e===1?`
                    <div class="bc-field">
                        <label class="bc-label">Choose a Username</label>
                        <input type="text" id="wiz-username-input" class="bc-input" placeholder="e.g. satoshi"
                            value="${p.wizUsername}" maxlength="15" oninput="AgoraPage.onWizUsernameInput(this.value)">
                        <div id="wiz-username-status" class="bc-username-row"></div>
                        <div style="font-size:12px;color:var(--bc-text-3);margin-top:8px;">1-15 chars: lowercase letters, numbers, underscores. Shorter usernames cost more BNB.</div>
                    </div>
                `:e===2?`
                    <div class="bc-field">
                        <label class="bc-label">Display Name</label>
                        <input type="text" id="wiz-displayname-input" class="bc-input" placeholder="Your public name" value="${nt(p.wizDisplayName)}" maxlength="30">
                    </div>
                    <div class="bc-field">
                        <label class="bc-label">Bio</label>
                        <textarea id="wiz-bio-input" class="bc-input" placeholder="Tell the world about yourself..." maxlength="160" rows="3" style="resize:none;">${nt(p.wizBio)}</textarea>
                    </div>
                    <div class="bc-field">
                        <label class="bc-label">Language</label>
                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                            ${ya.map(t=>`<button class="bc-compose-tag ${p.wizLanguage===t.code?"active":""}" onclick="AgoraPage.setWizLanguage('${t.code}')" style="font-size:13px;">${t.flag} ${t.name}</button>`).join("")}
                        </div>
                        <div style="font-size:12px;color:var(--bc-text-3);margin-top:6px;">Your posts will be tagged with this language for filtering.</div>
                    </div>
                    <div style="font-size:12px;color:var(--bc-text-3);">Display name, bio, and language are stored as metadata and can be updated anytime for free.</div>
                `:`
                    <div style="text-align:center;">
                        <div style="font-size:48px; margin-bottom:16px;">${p.wizUsername.charAt(0).toUpperCase()}</div>
                        <div style="font-size:18px; font-weight:700; color:var(--bc-text);">@${p.wizUsername}</div>
                        ${p.wizDisplayName?`<div style="font-size:14px; color:var(--bc-text-2); margin-top:4px;">${nt(p.wizDisplayName)}</div>`:""}
                        ${p.wizBio?`<div style="font-size:13px; color:var(--bc-text-3); margin-top:8px;">${nt(p.wizBio)}</div>`:""}
                        <div style="font-size:13px; color:var(--bc-text-2); margin-top:8px;">${(ya.find(t=>t.code===p.wizLanguage)||ya[0]).flag} ${(ya.find(t=>t.code===p.wizLanguage)||ya[0]).name}</div>
                        <div class="bc-fee-row" style="margin-top:20px;">
                            <span class="bc-fee-label">Username Fee</span>
                            <span class="bc-fee-val">${p.wizFee||"0"} BNB</span>
                        </div>
                    </div>
                `}
            </div>
            <div class="bc-wizard-nav">
                ${e>1?'<button class="bc-btn bc-btn-outline" onclick="AgoraPage.wizBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>':""}
                ${e<3?`
                    <button class="bc-btn bc-btn-primary" onclick="AgoraPage.wizNext()" ${e===1&&!p.wizUsernameOk?"disabled":""}>
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                `:`
                    <button id="bc-wizard-confirm-btn" class="bc-btn bc-btn-primary" onclick="AgoraPage.wizConfirm()">
                        <i class="fa-solid fa-check"></i> Create Profile
                    </button>
                `}
            </div>
        </div>`}function Dk(){const e=p.selectedPost?p.postsById.get(p.selectedPost):null;if(!e)return'<div class="bc-empty"><div class="bc-empty-title">Post not found</div></div>';const t=p.replies.get(e.id)||[];t.sort((s,i)=>s.timestamp-i.timestamp);const a=za(e.author),n=p.activeRooms.has(String(e.id)),o=p.watchingStreamId===String(e.id);return`
        ${o?Sk():""}
        ${n&&!o?`
            <div class="bc-live-join">
                <button class="bc-go-live-btn" onclick="AgoraPage.watchLive('${e.id}')">
                    <i class="fa-solid fa-play"></i> Join Live Stream
                </button>
            </div>`:""}
        <div class="bc-thread-parent">${Ma(e,0,{noAnimation:!0})}</div>
        <div class="bc-thread-divider">Replies ${t.length>0?`(${t.length})`:""}</div>
        ${t.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No replies yet. Be the first!</div></div>':t.map((s,i)=>`<div class="bc-thread-reply">${Ma(s,i,{noAnimation:!0})}</div>`).join("")}
        ${u.isConnected?`
            <div class="bc-reply-compose">
                <div class="bc-reply-label">Replying to ${a}</div>
                <div class="bc-reply-row">
                    <textarea id="bc-reply-input" class="bc-reply-input" placeholder="Write a reply..." maxlength="${ra()}"></textarea>
                    <button id="bc-reply-btn" class="bc-btn bc-btn-primary bc-reply-send" onclick="AgoraPage.submitReply('${e.id}')">Reply</button>
                </div>
                <div style="font-size:11px;color:var(--bc-text-3);margin-top:6px;">Text replies: FREE (gas only)</div>
            </div>`:""}`}let Xe=null;function Mk(){var e,t,a,n;return`
        <!-- Super Like Modal -->
        <div class="bc-modal-overlay" id="modal-superlike" onclick="if(event.target===this) AgoraPage.closeModal('superlike')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-star" style="color:var(--bc-accent)"></i> Super Like</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('superlike')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Send any amount of BNB to boost this post to trending. More BNB = higher rank. All BNB goes to the ecosystem.</p>
                    <div class="bc-field"><label class="bc-label">Amount (BNB)</label><input type="number" id="superlike-amount" class="bc-input" value="0.001" min="0.000001" step="0.0001"></div>
                    <div class="bc-fee-row"><span class="bc-fee-label">Any amount</span><span class="bc-fee-val">&gt; 0 BNB</span></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="AgoraPage.confirmSuperLike()"><i class="fa-solid fa-star"></i> Super Like</button>
                </div>
            </div>
        </div>

        <!-- Downvote Modal -->
        <div class="bc-modal-overlay" id="modal-downvote" onclick="if(event.target===this) AgoraPage.closeModal('downvote')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-arrow-down" style="color:var(--bc-purple)"></i> Downvote</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('downvote')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Downvote this post. You can only downvote each post once.</p>
                    <button class="bc-btn bc-btn-outline" style="width:100%;margin-top:20px;justify-content:center;border-color:var(--bc-purple);color:var(--bc-purple);" onclick="AgoraPage.confirmDownvote()"><i class="fa-solid fa-arrow-down"></i> Downvote</button>
                </div>
            </div>
        </div>

        <!-- Badge Modal -->
        <div class="bc-modal-overlay" id="modal-badge" onclick="if(event.target===this) AgoraPage.closeModal('badge')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-circle-check" style="color:var(--bc-accent)"></i> Trust Badge</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('badge')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Get a verified badge for 1 year. Higher tiers unlock longer posts and more prestige.</p>
                    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px;">
                        <button class="bc-btn bc-btn-outline bc-badge-option" style="width:100%;padding:12px 16px;${p.badgeTier===0&&p.hasBadge?"border-color:#3b82f6;opacity:0.5;":""}" onclick="AgoraPage.confirmBadge(0)">
                            <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
                                <span><i class="fa-solid fa-circle-check" style="color:#3b82f6"></i> Verified</span><span style="color:var(--bc-text-3)">0.02 BNB/yr</span>
                            </div>
                            <div style="font-size:10px;color:var(--bc-text-3);margin-top:4px;text-align:left;">Up to 5,000 chars per post${p.hasBadge&&p.badgeTier>=0?' <span style="color:#3b82f6">&#10003; current</span>':""}</div>
                        </button>
                        <button class="bc-btn bc-btn-outline bc-badge-option" style="width:100%;padding:12px 16px;border-color:#eab308;${p.badgeTier===1&&p.hasBadge?"opacity:0.5;":""}" onclick="AgoraPage.confirmBadge(1)">
                            <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
                                <span><i class="fa-solid fa-circle-check" style="color:#eab308"></i> Premium</span><span style="color:var(--bc-text-3)">0.1 BNB/yr</span>
                            </div>
                            <div style="font-size:10px;color:var(--bc-text-3);margin-top:4px;text-align:left;">Up to 20,000 chars per post${p.hasBadge&&p.badgeTier>=1?' <span style="color:#eab308">&#10003; current</span>':""}</div>
                        </button>
                        <button class="bc-btn bc-btn-outline bc-badge-option" style="width:100%;padding:12px 16px;border-color:#a855f7;" onclick="AgoraPage.confirmBadge(2)">
                            <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
                                <span><i class="fa-solid fa-gem" style="color:#a855f7"></i> Elite</span><span style="color:var(--bc-text-3)">0.25 BNB/yr</span>
                            </div>
                            <div style="font-size:10px;color:var(--bc-text-3);margin-top:4px;text-align:left;">Up to 50,000 chars per post${p.hasBadge&&p.badgeTier>=2?' <span style="color:#a855f7">&#10003; current</span>':""}</div>
                        </button>
                    </div>
                    <div style="font-size:10px;color:var(--bc-text-3);text-align:center;opacity:0.6;">Without badge: 2,000 chars per post</div>
                </div>
            </div>
        </div>

        <!-- Boost Modal -->
        <div class="bc-modal-overlay" id="modal-boost" onclick="if(event.target===this) AgoraPage.closeModal('boost')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-rocket" style="color:var(--bc-accent)"></i> Profile Boost</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('boost')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Boost your profile for more visibility. Pricing set by ecosystem governance.</p>
                    <div class="bc-field"><label class="bc-label">Days</label><input type="number" id="boost-days" class="bc-input" value="7" min="1" max="365" step="1"></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="AgoraPage.confirmBoost()"><i class="fa-solid fa-rocket"></i> Boost Profile</button>
                </div>
            </div>
        </div>

        <!-- Repost Modal -->
        <div class="bc-modal-overlay" id="modal-repost" onclick="if(event.target===this) AgoraPage.closeModal('repost')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-retweet" style="color:var(--bc-green)"></i> Repost</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('repost')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Repost this to your followers? FREE (gas only)</p>
                    <button id="bc-repost-confirm-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="AgoraPage.confirmRepost()"><i class="fa-solid fa-retweet"></i> Repost</button>
                </div>
            </div>
        </div>

        <!-- Change Tag Modal -->
        <div class="bc-modal-overlay" id="modal-change-tag" onclick="if(event.target===this) AgoraPage.closeModal('change-tag')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-tag" style="color:var(--bc-accent)"></i> Change Tag</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('change-tag')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Select a new category for your post. Only gas fee applies.</p>
                    <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px;">
                        ${Tn.map(o=>`<button class="bc-compose-tag" onclick="AgoraPage.selectNewTag(${o.id})" id="change-tag-opt-${o.id}" style="color:${o.color}"><i class="fa-solid ${o.icon}"></i> ${o.name}</button>`).join("")}
                    </div>
                    <button id="bc-change-tag-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="AgoraPage.confirmChangeTag()" disabled><i class="fa-solid fa-check"></i> Change Tag</button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div class="bc-modal-overlay" id="modal-edit-profile" onclick="if(event.target===this) AgoraPage.closeModal('edit-profile')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-pen" style="color:var(--bc-accent)"></i> Edit Profile</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('edit-profile')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <div class="bc-field">
                        <label class="bc-label">Profile Picture</label>
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                            <div class="bc-avatar" style="width:56px;height:56px;font-size:20px;" id="edit-avatar-preview">
                                ${(e=p.userProfile)!=null&&e.avatar?`<img src="${ul(p.userProfile.avatar)}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`:(t=p.userProfile)!=null&&t.username?p.userProfile.username.charAt(0).toUpperCase():"?"}
                            </div>
                            <label class="bc-btn bc-btn-outline" style="cursor:pointer;font-size:13px;">
                                <i class="fa-solid fa-camera"></i> Change Photo
                                <input type="file" id="edit-avatar-file" accept="image/jpeg,image/png,image/gif,image/webp" style="display:none;" onchange="AgoraPage.previewAvatar(this)">
                            </label>
                        </div>
                    </div>
                    <div class="bc-field"><label class="bc-label">Display Name</label><input type="text" id="edit-displayname" class="bc-input" value="${nt(((a=p.userProfile)==null?void 0:a.displayName)||"")}" maxlength="30" placeholder="Your display name"></div>
                    <div class="bc-field"><label class="bc-label">Bio</label><textarea id="edit-bio" class="bc-input" maxlength="160" rows="3" placeholder="About you..." style="resize:none;">${nt(((n=p.userProfile)==null?void 0:n.bio)||"")}</textarea></div>
                    <div class="bc-field">
                        <label class="bc-label">Language</label>
                        <select id="edit-language" class="bc-input" style="padding:10px 12px;">
                            ${ya.map(o=>{var s;return`<option value="${o.code}" ${(((s=p.userProfile)==null?void 0:s.language)||"")===o.code?"selected":""}>${o.flag} ${o.name}</option>`}).join("")}
                        </select>
                    </div>
                    <p style="font-size:12px;color:var(--bc-text-3);margin-bottom:16px;">Username cannot be changed. Only gas fee applies.</p>
                    <button id="bc-edit-profile-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="AgoraPage.confirmEditProfile()"><i class="fa-solid fa-check"></i> Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Report Modal -->
        <div class="bc-modal-overlay" id="modal-report" onclick="if(event.target===this) AgoraPage.closeModal('report')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-flag" style="color:#ef4444"></i> Report Post</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('report')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Report this post and block the author from your feed. Cost: 0.0001 BNB</p>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="AgoraPage.confirmReport(0)"><i class="fa-solid fa-robot"></i> Spam</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="AgoraPage.confirmReport(1)"><i class="fa-solid fa-hand"></i> Harassment</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;border-color:#ef4444;color:#ef4444;" onclick="AgoraPage.confirmReport(2)"><i class="fa-solid fa-gavel"></i> Illegal Content</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="AgoraPage.confirmReport(3)"><i class="fa-solid fa-mask"></i> Scam</button>
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:flex-start;gap:8px;" onclick="AgoraPage.confirmReport(4)"><i class="fa-solid fa-circle-exclamation"></i> Other</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boost Post Modal -->
        <div class="bc-modal-overlay" id="modal-boost-post" onclick="if(event.target===this) AgoraPage.closeModal('boost-post')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-rocket" style="color:var(--bc-accent)"></i> Boost Post</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('boost-post')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Boost this post for more visibility. Pricing set by ecosystem governance.</p>
                    <div class="bc-field"><label class="bc-label">Days</label><input type="number" id="boost-post-days" class="bc-input" value="1" min="1" max="90" step="1"></div>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px;">
                        <button class="bc-btn bc-btn-outline" style="width:100%;justify-content:space-between;" onclick="AgoraPage.confirmBoostPost(0)">
                            <span><i class="fa-solid fa-rocket"></i> Standard</span><span style="color:var(--bc-text-3)">~${Cn(p.fees.boostStd)} BNB/day</span>
                        </button>
                        <button class="bc-btn bc-btn-primary" style="width:100%;justify-content:space-between;" onclick="AgoraPage.confirmBoostPost(1)">
                            <span><i class="fa-solid fa-star"></i> Featured</span><span>~${Cn(p.fees.boostFeat)} BNB/day</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tip Modal -->
        <div class="bc-modal-overlay" id="modal-tip" onclick="if(event.target===this) AgoraPage.closeModal('tip')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-hand-holding-dollar" style="color:var(--bc-green)"></i> Tip Author</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('tip')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Send BNB directly to the post author as a tip. Any amount &gt; 0.</p>
                    <div class="bc-field"><label class="bc-label">Amount (BNB)</label><input type="number" id="tip-amount" class="bc-input" value="0.001" min="0.000001" step="0.0001"></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:16px;justify-content:center;background:var(--bc-green);" onclick="AgoraPage.confirmTip()"><i class="fa-solid fa-hand-holding-dollar"></i> Send Tip</button>
                </div>
            </div>
        </div>

        <!-- Edit Post Modal -->
        <div class="bc-modal-overlay" id="modal-edit-post" onclick="if(event.target===this) AgoraPage.closeModal('edit-post')">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-pen" style="color:var(--bc-accent)"></i> Edit Post</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('edit-post')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Edit within 15 minutes of posting. Free (gas only). Can only edit once.</p>
                    <div class="bc-field">
                        <textarea id="bc-edit-post-input" class="bc-input" rows="4" maxlength="${ra()}" style="resize:none;"></textarea>
                    </div>
                    <button id="bc-edit-post-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="AgoraPage.confirmEditPost()"><i class="fa-solid fa-check"></i> Save Edit</button>
                </div>
            </div>
        </div>`}function Ok(e){var t;Xe=e,(t=document.getElementById("modal-superlike"))==null||t.classList.add("active")}async function Uk(){var t;const e=((t=document.getElementById("superlike-amount"))==null?void 0:t.value)||"0.001";lt("superlike"),await O1(Xe,e)}function Hk(e){var t;Xe=e,(t=document.getElementById("modal-downvote"))==null||t.classList.add("active")}async function jk(){lt("downvote"),await U1(Xe)}function Wk(){var e;(e=document.getElementById("modal-badge"))==null||e.classList.add("active")}async function Gk(e=0){await J1(e)}function Kk(){var e;(e=document.getElementById("modal-boost"))==null||e.classList.add("active")}async function Vk(){var t;const e=parseInt(((t=document.getElementById("boost-days"))==null?void 0:t.value)||"7",10);lt("boost"),await tk(e)}function Yk(e){var t;Xe=e,(t=document.getElementById("modal-report"))==null||t.classList.add("active")}async function qk(e){await Z1(Xe,e)}function Xk(e){var t;Xe=e,(t=document.getElementById("modal-boost-post"))==null||t.classList.add("active")}async function Jk(e){await Q1(Xe,e)}function Zk(e){var t;Xe=e,(t=document.getElementById("modal-tip"))==null||t.classList.add("active")}async function Qk(){await ek(Xe)}function e2(e){Xe=e;const t=p.postsById.get(e);p._render();const a=document.getElementById("modal-edit-post"),n=document.getElementById("bc-edit-post-input");n&&t&&(n.value=t.content||""),a==null||a.classList.add("active")}async function t2(){await j1(Xe)}function a2(e){var n;const t=(n=e==null?void 0:e.files)==null?void 0:n[0];if(!t)return;if(t.size>5*1024*1024){x("Image too large. Maximum 5MB.","error");return}const a=new FileReader;a.onload=o=>{const s=document.getElementById("edit-avatar-preview");s&&(s.innerHTML=`<img src="${o.target.result}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`)},a.readAsDataURL(t)}function n2(e){var t;Xe=e,(t=document.getElementById("modal-repost"))==null||t.classList.add("active")}async function o2(){await D1(Xe)}function s2(){var e;p._render(),(e=document.getElementById("modal-edit-profile"))==null||e.classList.add("active")}async function i2(){await X1()}function r2(){if(["post-detail","user-profile","profile-setup"].includes(p.view)){let t="Post";return p.view==="user-profile"&&(t=za(p.selectedProfile)),p.view==="profile-setup"&&(t="Create Profile"),`
            <div class="bc-header">
                <div class="bc-back-header">
                    <button class="bc-back-btn" onclick="AgoraPage.goBack()"><i class="fa-solid fa-arrow-left"></i></button>
                    <span class="bc-back-title">${t}</span>
                </div>
            </div>`}return`
        <div class="bc-header">
            <div class="bc-header-bar">
                <div class="bc-brand">
                    <img src="assets/Agora.png" alt="Agora" class="bc-brand-icon" onerror="this.style.display='none'">
                    <span class="bc-brand-name">Agora</span>
                </div>
                <div class="bc-header-right">
                    ${l2()}
                    <button class="bc-icon-btn" onclick="AgoraPage.refresh()" title="Refresh"><i class="fa-solid fa-arrows-rotate"></i></button>
                </div>
            </div>
            <div class="bc-nav">
                <button class="bc-nav-item ${p.activeTab==="feed"?"active":""}" onclick="AgoraPage.setTab('feed')">
                    <i class="fa-solid fa-house"></i> Feed
                </button>
                <button class="bc-nav-item ${p.activeTab==="discover"?"active":""}" onclick="AgoraPage.setTab('discover')">
                    <i class="fa-solid fa-fire"></i> Discover
                </button>
                <button class="bc-nav-item ${p.activeTab==="profile"?"active":""}" onclick="AgoraPage.setTab('profile')">
                    <i class="fa-solid fa-user"></i> Profile
                </button>
            </div>
        </div>`}function l2(){return u.isConnected&&u.userAddress?`<button class="bc-wallet-inline connected" onclick="event.stopPropagation(); AgoraPage.connectWallet()" title="Tap to manage wallet">
            <span class="bc-wallet-dot"></span>${u.userAddress.slice(0,6)+"..."+u.userAddress.slice(-4)}<i class="fa-solid fa-power-off bc-disconnect-icon"></i>
        </button>`:`<button class="bc-wallet-inline disconnected" onclick="event.stopPropagation(); AgoraPage.connectWallet()" title="Connect Wallet">
        <i class="fa-solid fa-wallet"></i> Connect
    </button>`}function c2(){const e=document.querySelector("header.sticky");e&&(e.style.display="none")}function d2(){const e=document.querySelector("header.sticky");e&&(e.style.display="")}function ft(){const e=document.getElementById("backchat-content");if(!e)return;let t="";switch(p.view){case"feed":t=Mc();break;case"discover":t=_k();break;case"profile":t=!p.hasProfile&&u.isConnected?Oc():Rk();break;case"post-detail":t=Dk();break;case"user-profile":t=Fk();break;case"profile-setup":t=Oc();break;default:t=ym()+$k()+zk()+Mc()}e.innerHTML=t,e.style.paddingBottom=p.actionCart.length>0?"80px":"";const a=document.querySelector(".bc-cart-bar"),n=km();if(n&&!a){const o=document.getElementById("agora");o&&o.insertAdjacentHTML("afterend",n)}else a&&(n?a.outerHTML=n:a.remove())}function $a(){p._videoObserver||(p._videoObserver=new IntersectionObserver(e=>{e.forEach(t=>{const a=t.target;t.isIntersecting&&t.intersectionRatio>=.6?a.play().catch(()=>{}):a.pause()})},{threshold:[0,.6]})),p._videoObserver.disconnect(),document.querySelectorAll("video[data-post-video]").forEach(e=>{p._videoObserver.observe(e)})}function jt(){p._sentinelObserver&&p._sentinelObserver.disconnect();const e=document.querySelector('[data-sentinel="feed"]');e&&(p._sentinelObserver=new IntersectionObserver(t=>{var a;(a=t[0])!=null&&a.isIntersecting&&(p.feedPage++,ft(),$a(),jt())},{rootMargin:"200px"}),p._sentinelObserver.observe(e))}let hi=0;function u2(){document.addEventListener("click",e=>{var n;const t=e.target.closest(".bc-tiktok-card");if(!t)return;const a=Date.now();if(a-hi<300){const o=t.dataset.postId;if(o){(n=window.AgoraPage)==null||n.like(o);const s=document.createElement("div");s.className="bc-float-heart",s.innerHTML='<i class="fa-solid fa-heart"></i>',s.style.left=e.clientX-t.getBoundingClientRect().left-30+"px",s.style.top=e.clientY-t.getBoundingClientRect().top-30+"px",t.appendChild(s),setTimeout(()=>s.remove(),900),navigator.vibrate&&navigator.vibrate(50)}hi=0}else hi=a})}u2();p._render=()=>{ft(),$a(),jt()};let Uc=0;document.addEventListener("visibilitychange",()=>{var t;if(document.hidden)return;const e=Date.now();e-Uc<3e3||(t=document.getElementById("agora"))!=null&&t.classList.contains("active")&&(Uc=e,Promise.all([ji(),ot(),Wi(),Hi()]).then(()=>{ft(),$a(),jt()}).catch(()=>{}))});function km(){if(p.actionCart.length===0)return"";const e=p.actionCart.length,t={like:"fa-heart",follow:"fa-user-plus",downvote:"fa-arrow-down"},a={like:"like",follow:"follow",downvote:"downvote"},n={like:"Like",follow:"Follow",downvote:"Downvote"};let o="";if(p.cartVisible){const s=p.actionCart.map((i,r)=>`
            <div class="bc-cart-item">
                <div class="bc-cart-item-info">
                    <div class="bc-cart-item-icon ${a[i.type]}"><i class="fa-solid ${t[i.type]}"></i></div>
                    <div>
                        <div class="bc-cart-item-label">${n[i.type]} â€” ${i.label}</div>
                        <div class="bc-cart-item-type">${i.type}</div>
                    </div>
                </div>
                <button class="bc-cart-item-remove" onclick="event.stopPropagation(); AgoraPage.removeFromCart(${r})" title="Remove">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>`).join("");o=`
            <div class="bc-cart-panel">
                <div class="bc-cart-header">
                    <span class="bc-cart-title">Action Cart (${e})</span>
                    <button class="bc-cart-clear" onclick="AgoraPage.clearCart()"><i class="fa-solid fa-trash"></i> Clear All</button>
                </div>
                ${s}
                <div class="bc-cart-footer">
                    <div class="bc-cart-warning"><i class="fa-solid fa-circle-info"></i> Not registered on blockchain yet</div>
                </div>
            </div>`}return`
        <div class="bc-cart-bar">
            ${p.cartVisible?o:""}
            <div class="bc-cart-summary" onclick="AgoraPage.toggleCart()">
                <div class="bc-cart-info">
                    <span class="bc-cart-badge">${e}</span>
                    <span class="bc-cart-label"><strong>${e} action${e!==1?"s":""}</strong> not on blockchain yet</span>
                </div>
                <div class="bc-cart-actions">
                    <button class="bc-cart-submit-btn" onclick="event.stopPropagation(); AgoraPage.submitCart()" ${p.cartSubmitting?"disabled":""}>
                        ${p.cartSubmitting?'<i class="fa-solid fa-spinner fa-spin"></i> Registering...':'<i class="fa-solid fa-link"></i> Register'}
                    </button>
                    <button class="bc-cart-toggle" onclick="event.stopPropagation(); AgoraPage.toggleCart()">
                        <i class="fa-solid fa-chevron-${p.cartVisible?"down":"up"}"></i>
                    </button>
                </div>
            </div>
        </div>`}function p2(){return u.isConnected?`<button class="bc-fab" onclick="AgoraPage.openCompose()" title="New Post">
        <i class="fa-solid fa-plus"></i>
    </button>`:""}function f2(){const e=document.getElementById("modal-compose");e&&e.classList.add("active")}function g2(){return`
        <div class="bc-modal-overlay" id="modal-compose" onclick="if(event.target===this) AgoraPage.closeModal('compose')">
            <div class="bc-modal-box" style="max-width:540px;width:95%;">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-pen-to-square" style="color:var(--bc-accent)"></i> New Post</span>
                    <button class="bc-modal-x" onclick="AgoraPage.closeModal('compose')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner" style="padding:0;">
                    ${ym()}
                </div>
            </div>
        </div>`}function qn(){L1(),c2();const e=document.getElementById("agora");e&&(e.innerHTML=`
        <div class="bc-shell">
            ${r2()}
            <div id="backchat-content" style="${p.actionCart.length>0?"padding-bottom:80px;":""}"></div>
        </div>
        ${p2()}
        ${km()}
        ${g2()}
        ${Mk()}`,ft(),$a(),jt())}function m2(){const e=window.location.hash,t=e.indexOf("?");if(t===-1)return;const a=e.substring(t+1);let n=null;const o=a.match(/^@[\w]+\/(\d+)/);o&&(n=o[1]),n||(n=new URLSearchParams(a).get("post")),n&&(window.history.replaceState(null,"",`${window.location.pathname}#agora`),p.postsById.has(n)?Yn("post-detail",{post:n}):(p.selectedPost=n,p.view="post-detail",qn()))}function b2(e){const t=document.getElementById("bc-char-counter");if(!t)return;const a=ra(),n=e.value.length;t.textContent=`${n.toLocaleString()}/${a.toLocaleString()}`,t.className="bc-char-count",n>a-50?t.classList.add("danger"):n>a*.9&&t.classList.add("warn"),e.style.height="auto",e.style.height=Math.min(e.scrollHeight,400)+"px";const o=document.querySelector(".bc-upgrade-hint");o&&(o.style.display=n>a*.8&&(!p.hasBadge||p.badgeTier<2)?"flex":"")}document.addEventListener("click",()=>{document.querySelectorAll(".bc-post-dropdown").forEach(e=>e.style.display="none")});function Ki(e,t){const a=document.querySelector(`[data-carousel="${e}"]`);if(!a)return;const n=parseInt(a.dataset.total)||1;let o=parseInt(a.dataset.current)||0;o=Math.max(0,Math.min(n-1,o+t)),a.dataset.current=o,a.querySelectorAll(".bc-carousel-slide").forEach((l,c)=>{l.style.display=c===o?"":"none"}),a.querySelectorAll(".bc-carousel-dot").forEach((l,c)=>{l.classList.toggle("active",c===o)});const s=a.querySelector(".bc-carousel-prev"),i=a.querySelector(".bc-carousel-next");s&&(s.style.display=o===0?"none":""),i&&(i.style.display=o===n-1?"none":"");const r=a.querySelector(".bc-carousel-counter");r&&(r.textContent=`${o+1}/${n}`),a.querySelectorAll("video").forEach((l,c)=>{c===o?l.play().catch(()=>{}):l.pause()})}function x2(){document.addEventListener("touchstart",e=>{const t=e.target.closest("[data-carousel]");t&&(t._touchStartX=e.touches[0].clientX)},{passive:!0}),document.addEventListener("touchend",e=>{const t=e.target.closest("[data-carousel]");if(!t||t._touchStartX==null)return;const a=e.changedTouches[0].clientX-t._touchStartX;t._touchStartX=null,!(Math.abs(a)<40)&&Ki(t.dataset.carousel,a<0?1:-1)},{passive:!0})}x2();function h2(e){const t=document.querySelector(`.bc-tiktok-caption[data-caption-id="${e}"]`);if(!t)return;t.classList.toggle("expanded");const a=t.querySelector(".bc-tiktok-more");a&&(a.textContent=t.classList.contains("expanded")?" less":" more")}function v2(e){const t=document.querySelector(`.bc-post-body[data-post-id="${e}"]`);if(!t)return;const a=p.postsById.get(e);a!=null&&a.content&&(t.innerHTML=bm(nt(a.content)))}const rs={async render(e){e&&(qn(),await Promise.all([Sc(),Hi(),Lc(),ji(),ot(),Wi(),Rc()]),await _c(),bk(),ft(),$a(),jt(),m2())},cleanup(){d2()},async update(e){await this.refresh(),ft(),$a(),jt()},async refresh(){await Promise.all([Sc(),Hi(),Lc(),ji(),ot(),Wi(),Rc()]),await _c()},setTab(e){p.activeTab=e,p.view=e,p.selectedTag=-1,p.feedPage=0,qn()},filterTag(e){p.selectedTag=e,p.feedPage=0,ft(),jt()},filterLanguage(e){p.selectedLanguage=e,p.feedPage=0,ft(),jt()},setFeedMode(e){p.feedMode=e,qn(),$a(),jt()},setWizLanguage(e){p.wizLanguage=e,ft()},setComposeTag(e){p.composeTag=e,ft()},goBack:_1,sharePost:kk,viewPost(e){Yn("post-detail",{post:e})},viewProfile(e){var t;(e==null?void 0:e.toLowerCase())===((t=u.userAddress)==null?void 0:t.toLowerCase())?(p.activeTab="profile",p.view="profile",qn()):Yn("user-profile",{profile:e})},openReply(e){Yn("post-detail",{post:e})},openProfileSetup(){p.wizStep=1,p.wizUsername="",p.wizDisplayName="",p.wizBio="",p.wizUsernameOk=null,p.wizFee=null,Yn("profile-setup")},openCompose:f2,createPost:R1,submitReply:F1,like:M1,follow:V1,unfollow:Y1,deletePost:H1,pinPost:K1,blockUser:W1,unblockUser:G1,handleImageSelect:ik,removeImage:rk,onWizUsernameInput:lk,closeModal:lt,togglePostMenu:Ek,openChangeTag:ak,selectNewTag:nk,confirmChangeTag:ok,openSuperLike:Ok,confirmSuperLike:Uk,openDownvote:Hk,confirmDownvote:jk,openRepostConfirm:n2,confirmRepost:o2,openBadge:Wk,confirmBadge:Gk,openBoost:Kk,confirmBoost:Vk,openEditProfile:s2,confirmEditProfile:i2,openReport:Yk,confirmReport:qk,openBoostPost:Xk,confirmBoostPost:Jk,openTip:Zk,confirmTip:Qk,previewAvatar:a2,openEditPost:e2,confirmEditPost:t2,removeFromCart:xk,clearCart:hk,toggleCart:vk,submitCart:wk,toggleCaption:h2,expandPost:v2,carouselPrev(e){Ki(e,-1)},carouselNext(e){Ki(e,1)},connectWallet(){ys()},disconnectWallet(){Sd()},goLive:ck,endLive:dk,watchLive:uk,leaveLive:pk,wizNext(){var e,t,a,n;p.wizStep===1&&!p.wizUsernameOk||(p.wizStep===1?p.wizStep=2:p.wizStep===2&&(p.wizDisplayName=((t=(e=document.getElementById("wiz-displayname-input"))==null?void 0:e.value)==null?void 0:t.trim())||"",p.wizBio=((n=(a=document.getElementById("wiz-bio-input"))==null?void 0:a.value)==null?void 0:n.trim())||"",p.wizStep=3),ft())},wizBack(){var e,t,a,n;p.wizStep>1&&(p.wizStep===2&&(p.wizDisplayName=((t=(e=document.getElementById("wiz-displayname-input"))==null?void 0:e.value)==null?void 0:t.trim())||"",p.wizBio=((n=(a=document.getElementById("wiz-bio-input"))==null?void 0:a.value)==null?void 0:n.trim())||""),p.wizStep--,ft())},wizConfirm:q1,_updateCharCount:b2};window.AgoraPage=rs;window.BackchatPage=rs;const $t=window.ethers,J={tutorCount:0,tutor:null,tutorLink:"",pendingEth:0n,isLoading:!1,isChangingTutor:!1,isWithdrawing:!1};function y2(){if(document.getElementById("tutor-styles"))return;const e=document.createElement("style");e.id="tutor-styles",e.textContent=`
        .tutor-hero-badge {
            animation: tutor-pulse 2s ease-in-out infinite;
        }
        @keyframes tutor-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(245, 158, 11, 0); }
        }
        .tutor-share-btn {
            transition: all 0.2s ease;
        }
        .tutor-share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .tutor-stat-card {
            background: linear-gradient(135deg, rgba(39,39,42,0.8), rgba(24,24,27,0.9));
            border: 1px solid rgba(63,63,70,0.5);
        }
        .tutor-link-box {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(63,63,70,0.5);
        }
        .tutor-copy-feedback {
            animation: tutor-check 0.3s ease;
        }
        @keyframes tutor-check {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    `,document.head.appendChild(e)}async function Em(){if(!(!u.isConnected||!u.userAddress)){J.isLoading=!0;try{const e=te.getProvider(),t=new $t.Contract(E.backchainEcosystem,Yt,e),[a,n,o]=await Promise.all([t.tutorCount(u.userAddress),t.tutorOf(u.userAddress),t.pendingEth(u.userAddress)]);J.tutorCount=Number(a),J.tutor=n!==$t.ZeroAddress?n:null,J.pendingEth=o,J.tutorLink=`${window.location.origin}/#dashboard?ref=${u.userAddress}`}catch(e){console.warn("[Tutor] Load failed:",e.message)}J.isLoading=!1}}function w2(e){y2();const t=document.getElementById("referral");if(!t)return;const a=u.isConnected&&u.userAddress;t.innerHTML=`
        <div class="max-w-3xl mx-auto px-4 pb-24">

        <!-- Hero -->
        <div class="text-center py-8 sm:py-12">
            <div class="tutor-hero-badge inline-flex items-center gap-2 bg-amber-500/10 border border-amber-500/30 rounded-full px-5 py-2 mb-5">
                <i class="fa-solid fa-graduation-cap text-amber-400 text-sm"></i>
                <span class="text-amber-400 text-sm font-bold">Tutor System</span>
            </div>
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white mb-4 leading-tight">
                Invite Friends,<br class="sm:hidden"> <span class="text-amber-400">Earn Forever</span>
            </h1>
            <p class="text-zinc-400 text-sm sm:text-base max-w-xl mx-auto leading-relaxed">
                Every user has one <strong class="text-white">tutor</strong>. When your friend uses the protocol,
                you automatically earn a cut of their fees â€” <strong class="text-amber-400">forever</strong>, enforced by smart contracts.
            </p>
        </div>

        <!-- Share Card -->
        <div class="mb-8">
            <div class="bg-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5 sm:p-6">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-link text-amber-400"></i> Your Tutor Link
                </h2>
                ${a?`
                    <div class="tutor-link-box flex items-center gap-2 rounded-xl px-4 py-3 mb-4">
                        <span id="tutor-link-text" class="flex-1 text-sm text-zinc-300 truncate font-mono">${J.tutorLink||`${window.location.origin}/#dashboard?ref=${u.userAddress}`}</span>
                        <button id="tutor-copy-btn" class="shrink-0 text-amber-400 hover:text-amber-300 transition-colors p-1" title="Copy">
                            <i class="fa-solid fa-copy text-lg"></i>
                        </button>
                    </div>
                    <div class="flex flex-wrap justify-center gap-3">
                        <button id="tutor-share-twitter" class="tutor-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-[#1DA1F2]/20 border border-zinc-600/50 hover:border-[#1DA1F2]/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-[#1DA1F2]">
                            <i class="fa-brands fa-x-twitter"></i> Twitter
                        </button>
                        <button id="tutor-share-telegram" class="tutor-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-[#0088cc]/20 border border-zinc-600/50 hover:border-[#0088cc]/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-[#0088cc]">
                            <i class="fa-brands fa-telegram"></i> Telegram
                        </button>
                        <button id="tutor-share-whatsapp" class="tutor-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-[#25D366]/20 border border-zinc-600/50 hover:border-[#25D366]/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-[#25D366]">
                            <i class="fa-brands fa-whatsapp"></i> WhatsApp
                        </button>
                        <button id="tutor-share-native" class="tutor-share-btn flex items-center gap-2 bg-zinc-700/50 hover:bg-amber-500/20 border border-zinc-600/50 hover:border-amber-500/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 hover:text-amber-400">
                            <i class="fa-solid fa-share-nodes"></i> Share
                        </button>
                    </div>
                `:`
                    <div class="text-center py-6">
                        <i class="fa-solid fa-wallet text-4xl text-zinc-600 mb-3"></i>
                        <p class="text-zinc-400">Connect your wallet to get your tutor link</p>
                    </div>
                `}
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-3 gap-3 mb-8">
            <div class="tutor-stat-card rounded-2xl p-4 text-center">
                <div class="text-2xl font-extrabold text-amber-400 mb-1" id="tutor-count">${J.tutorCount}</div>
                <div class="text-xs text-zinc-400">Tutters</div>
            </div>
            <div class="tutor-stat-card rounded-2xl p-4 text-center">
                <div class="text-sm font-bold text-white mb-1 truncate" id="tutor-current">${J.tutor?St(J.tutor):"None yet"}</div>
                <div class="text-xs text-zinc-400">Your Tutor</div>
            </div>
            <div class="tutor-stat-card rounded-2xl p-4 text-center">
                <div class="text-sm font-bold mb-1 ${J.tutor?"text-green-400":"text-zinc-500"}">${J.tutor?"Active":"No Tutor"}</div>
                <div class="text-xs text-zinc-400">Status</div>
            </div>
        </div>

        <!-- ====== TUTOR EARNINGS ====== -->
        ${a?`
        <div class="mb-8">
            <div class="bg-gradient-to-r from-amber-900/20 to-zinc-800/40 border border-amber-500/30 rounded-2xl p-5 sm:p-6">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-wallet text-amber-400"></i> Your Earnings
                </h2>
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <div class="text-3xl font-extrabold text-amber-400 mb-1" id="tutor-pending-eth">${$t.formatEther(J.pendingEth)} BNB</div>
                        <div class="text-xs text-zinc-400">Accumulated from tutter activity</div>
                    </div>
                    <button id="tutor-withdraw-btn" class="shrink-0 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl px-5 py-3 text-sm hover:shadow-lg hover:shadow-amber-500/30 transition-all disabled:opacity-40 disabled:cursor-not-allowed"
                        ${J.pendingEth===0n?"disabled":""}>
                        <i class="fa-solid fa-arrow-right-from-bracket mr-1"></i> Withdraw
                    </button>
                </div>
                ${J.pendingEth===0n&&J.tutorCount===0?`
                <div class="bg-black/20 rounded-xl p-3 flex items-start gap-2">
                    <i class="fa-solid fa-circle-info text-zinc-500 mt-0.5 text-xs"></i>
                    <p class="text-zinc-500 text-xs">Share your tutor link to start earning. You'll receive a cut of every fee your tutters pay.</p>
                </div>
                `:J.pendingEth===0n?`
                <div class="bg-black/20 rounded-xl p-3 flex items-start gap-2">
                    <i class="fa-solid fa-circle-info text-zinc-500 mt-0.5 text-xs"></i>
                    <p class="text-zinc-500 text-xs">Your tutters haven't generated fees yet. Earnings appear here automatically as they use the protocol.</p>
                </div>
                `:""}
            </div>
        </div>
        `:""}

        <!-- ====== HOW IT WORKS â€” Visual Steps ====== -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-2">
                <i class="fa-solid fa-route text-purple-400"></i> How It Works
            </h2>
            <div class="space-y-3">
                <div class="flex items-start gap-4 bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4">
                    <div class="w-10 h-10 rounded-xl bg-amber-500/15 border border-amber-500/30 flex items-center justify-center shrink-0">
                        <span class="text-amber-400 font-black text-sm">1</span>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Share your link</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">Send your unique URL to friends via social media, DMs, or anywhere. Your wallet address is embedded in the link.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4 bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4">
                    <div class="w-10 h-10 rounded-xl bg-purple-500/15 border border-purple-500/30 flex items-center justify-center shrink-0">
                        <span class="text-purple-400 font-black text-sm">2</span>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Friend connects wallet</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">When they click your link and connect MetaMask, our <strong class="text-zinc-300">server-side relayer</strong> automatically registers you as their tutor on-chain. They become your <strong class="text-amber-400">tutter</strong>. <strong class="text-green-400">Zero gas for both of you.</strong></p>
                    </div>
                </div>
                <div class="flex items-start gap-4 bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4">
                    <div class="w-10 h-10 rounded-xl bg-cyan-500/15 border border-cyan-500/30 flex items-center justify-center shrink-0">
                        <span class="text-cyan-400 font-black text-sm">3</span>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Tutter gets welcome bonus</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">Your new tutter receives <strong class="text-amber-400">free BKC tokens</strong> immediately as a welcome bonus + free BNB from the faucet to start using the platform.</p>
                    </div>
                </div>
                <div class="flex items-start gap-4 bg-gradient-to-r from-amber-900/20 to-zinc-800/40 border border-amber-500/30 rounded-xl p-4">
                    <div class="w-10 h-10 rounded-xl bg-green-500/15 border border-green-500/30 flex items-center justify-center shrink-0">
                        <span class="text-green-400 font-black text-sm">4</span>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">You earn rewards â€” forever</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">Every time your tutter pays any BNB fee on the platform, you earn <strong class="text-amber-400">10%</strong>. When they claim staking rewards, you earn <strong class="text-amber-400">5% BKC</strong>. This is <strong class="text-white">permanent and on-chain</strong> â€” no one can revoke it.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== DUAL REWARDS EXPLAINED ====== -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-2">
                <i class="fa-solid fa-coins text-amber-400"></i> What You Earn
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
                <!-- BNB Reward -->
                <div class="bg-zinc-800/40 border border-blue-500/30 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-lg bg-blue-500/15 flex items-center justify-center">
                            <i class="fa-solid fa-coins text-blue-400"></i>
                        </div>
                        <div>
                            <p class="text-white font-bold text-sm">10% BNB</p>
                            <p class="text-zinc-500 text-[10px]">On all protocol fees</p>
                        </div>
                    </div>
                    <p class="text-zinc-400 text-xs mb-3">Every BNB fee your tutter pays â€” Fortune bets, Notary certifications, NFT trades, Agora badges, post boosts â€” <strong class="text-white">10% goes directly to you</strong>.</p>
                    <div class="bg-black/30 rounded-lg p-3">
                        <p class="text-zinc-500 text-[10px] uppercase mb-2">Example</p>
                        <div class="space-y-1 text-xs">
                            <div class="flex justify-between"><span class="text-zinc-400">Tutter certifies a document</span><span class="text-zinc-300">0.0005 BNB</span></div>
                            <div class="flex justify-between"><span class="text-zinc-400">Tutter plays Fortune Tier 1</span><span class="text-zinc-300">0.0005 BNB</span></div>
                            <div class="flex justify-between"><span class="text-zinc-400">Tutter buys verified badge</span><span class="text-zinc-300">0.02 BNB</span></div>
                            <div class="border-t border-zinc-700 my-1.5"></div>
                            <div class="flex justify-between"><span class="text-zinc-300 font-bold">Total fees</span><span class="text-zinc-300 font-bold">0.021 BNB</span></div>
                            <div class="flex justify-between"><span class="text-amber-400 font-bold">Your 10% cut</span><span class="text-amber-400 font-bold">0.0021 BNB</span></div>
                        </div>
                    </div>
                </div>
                <!-- BKC Reward -->
                <div class="bg-zinc-800/40 border border-purple-500/30 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-lg bg-purple-500/15 flex items-center justify-center">
                            <i class="fa-solid fa-lock text-purple-400"></i>
                        </div>
                        <div>
                            <p class="text-white font-bold text-sm">5% BKC</p>
                            <p class="text-zinc-500 text-[10px]">On staking reward claims</p>
                        </div>
                    </div>
                    <p class="text-zinc-400 text-xs mb-3">When your tutter stakes BKC and claims mining rewards from the BuybackMiner, <strong class="text-white">5% of their claim goes to you</strong> in BKC tokens.</p>
                    <div class="bg-black/30 rounded-lg p-3">
                        <p class="text-zinc-500 text-[10px] uppercase mb-2">Example</p>
                        <div class="space-y-1 text-xs">
                            <div class="flex justify-between"><span class="text-zinc-400">Tutter claims rewards</span><span class="text-zinc-300">100 BKC</span></div>
                            <div class="border-t border-zinc-700 my-1.5"></div>
                            <div class="flex justify-between"><span class="text-purple-400 font-bold">Your 5% cut</span><span class="text-purple-400 font-bold">5 BKC</span></div>
                            <div class="flex justify-between"><span class="text-zinc-400">Tutter receives</span><span class="text-zinc-300">95 BKC</span></div>
                        </div>
                        <p class="text-zinc-600 text-[10px] mt-2">* NFT burn rate applied before tutor cut</p>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <p class="text-zinc-500 text-xs"><i class="fa-solid fa-infinity text-amber-400 mr-1"></i> Both reward streams are <strong class="text-zinc-300">permanent</strong> â€” they continue as long as your tutter uses the protocol</p>
            </div>
        </div>

        <!-- ====== WITH vs WITHOUT TUTOR ====== -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-2">
                <i class="fa-solid fa-scale-balanced text-cyan-400"></i> Why Have a Tutor?
            </h2>
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-red-900/10 border border-red-500/20 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <i class="fa-solid fa-xmark text-red-400"></i>
                        <p class="text-red-400 font-bold text-sm">No Tutor</p>
                    </div>
                    <div class="space-y-2 text-xs">
                        <div class="flex items-start gap-2">
                            <i class="fa-solid fa-fire text-red-400 mt-0.5 text-[10px]"></i>
                            <span class="text-zinc-400"><strong class="text-red-300">10% of staking rewards burned</strong> â€” destroyed permanently</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fa-solid fa-ban text-zinc-600 mt-0.5 text-[10px]"></i>
                            <span class="text-zinc-500">No welcome BKC bonus</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fa-solid fa-ban text-zinc-600 mt-0.5 text-[10px]"></i>
                            <span class="text-zinc-500">No tutor benefits from your activity</span>
                        </div>
                    </div>
                </div>
                <div class="bg-green-900/10 border border-green-500/20 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <i class="fa-solid fa-check text-green-400"></i>
                        <p class="text-green-400 font-bold text-sm">With Tutor</p>
                    </div>
                    <div class="space-y-2 text-xs">
                        <div class="flex items-start gap-2">
                            <i class="fa-solid fa-hand-holding-heart text-green-400 mt-0.5 text-[10px]"></i>
                            <span class="text-zinc-400"><strong class="text-green-300">5% to tutor, 0% burned</strong> â€” better for the ecosystem</span>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fa-solid fa-gift text-amber-400 mt-0.5 text-[10px]"></i>
                            <span class="text-zinc-400"><strong class="text-amber-300">Free BKC welcome bonus</strong></span>
                        </div>
                        <div class="flex items-start gap-2">
                            <i class="fa-solid fa-users text-cyan-400 mt-0.5 text-[10px]"></i>
                            <span class="text-zinc-400">Your tutor earns rewards from your activity</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== FEE FLOW DIAGRAM ====== -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-2">
                <i class="fa-solid fa-diagram-project text-emerald-400"></i> Fee Flow
            </h2>
            <div class="bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4">
                <div class="space-y-3">
                    <!-- Step 1 -->
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-blue-500/15 flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-user text-blue-400 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white text-sm font-medium">Tutter pays BNB fee</p>
                            <p class="text-zinc-500 text-[10px]">Any on-chain action: Fortune, Notary, Agora, NFT, etc.</p>
                        </div>
                    </div>
                    <div class="ml-4 border-l-2 border-zinc-700 pl-6 py-1">
                        <i class="fa-solid fa-arrow-down text-zinc-600 text-xs"></i>
                    </div>
                    <!-- Step 2 -->
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-amber-500/15 flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-graduation-cap text-amber-400 text-xs"></i>
                        </div>
                        <div class="flex-1 bg-amber-500/5 border border-amber-500/20 rounded-lg p-2">
                            <p class="text-amber-400 text-sm font-bold">10% to Tutor (you)</p>
                            <p class="text-zinc-500 text-[10px]">Deducted first, before any other split</p>
                        </div>
                    </div>
                    <div class="ml-4 border-l-2 border-zinc-700 pl-6 py-1">
                        <i class="fa-solid fa-arrow-down text-zinc-600 text-xs"></i>
                    </div>
                    <!-- Step 3 -->
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-zinc-700/50 flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-arrows-split-up-and-left text-zinc-400 text-xs"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white text-sm font-medium">Remaining 90% distributed</p>
                            <div class="flex flex-wrap gap-2 mt-1">
                                <span class="text-[10px] bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded-full">Buyback</span>
                                <span class="text-[10px] bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded-full">Treasury</span>
                                <span class="text-[10px] bg-amber-500/10 text-amber-400 px-2 py-0.5 rounded-full">Operator</span>
                                <span class="text-[10px] bg-purple-500/10 text-purple-400 px-2 py-0.5 rounded-full">Creator</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== CHANGE / SET TUTOR ====== -->
        ${a?`
        <div class="mb-8">
            <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5 sm:p-6">
                <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-pen text-amber-400"></i> ${J.tutor?"Change Tutor":"Set Your Tutor"}
                </h3>
                <p class="text-zinc-400 text-sm mb-4">
                    ${J.tutor?`Your current tutor is <strong class="text-white">${St(J.tutor)}</strong>. You can change your tutor by paying a small fee (0.0001 BNB).`:"Enter a tutor address or ask someone for their tutor link. First-time fee: 0.00002 BNB."}
                </p>
                <div class="flex gap-2">
                    <input id="tutor-address-input" type="text" placeholder="0x... tutor address"
                        class="flex-1 bg-zinc-900/50 border border-zinc-700/50 rounded-xl px-4 py-2.5 text-sm text-zinc-300 font-mono placeholder-zinc-600 focus:border-amber-500/50 focus:outline-none">
                    <button id="tutor-set-btn" class="shrink-0 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl px-5 py-2.5 text-sm hover:shadow-lg hover:shadow-amber-500/30 transition-all">
                        <i class="fa-solid fa-graduation-cap mr-1"></i> Set
                    </button>
                </div>
                <div id="tutor-set-status" class="mt-3 text-sm" style="display:none"></div>
            </div>
        </div>
        `:""}

        <!-- Tutter Network -->
        ${a&&J.tutorCount>0?`
        <div class="mb-8">
            <div class="rounded-2xl p-5 sm:p-6" style="background:rgba(39,39,42,0.5);border:1px solid rgba(63,63,70,0.5);">
                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-users" style="color:#f59e0b;"></i> Your Tutters
                </h3>
                <div id="tutor-student-list" class="space-y-2">
                    <div class="text-center text-zinc-500 text-sm py-4">
                        <div class="loader mx-auto mb-2"></div>
                        Loading tutters...
                    </div>
                </div>
            </div>
        </div>
        `:""}

        <!-- ====== ON-CHAIN GUARANTEES ====== -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-2">
                <i class="fa-solid fa-shield-halved text-green-400"></i> On-Chain Guarantees
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4 flex items-start gap-3">
                    <div class="w-8 h-8 rounded-lg bg-green-500/15 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-lock text-green-400 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">Immutable contract</p>
                        <p class="text-zinc-400 text-xs">The Ecosystem contract has no admin function to remove tutor rewards. Your earnings are guaranteed by code.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4 flex items-start gap-3">
                    <div class="w-8 h-8 rounded-lg bg-blue-500/15 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-clock text-blue-400 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">No expiration</p>
                        <p class="text-zinc-400 text-xs">Tutor relationships have no time limit. You earn for as long as the protocol exists and your tutter is active.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4 flex items-start gap-3">
                    <div class="w-8 h-8 rounded-lg bg-amber-500/15 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-wallet text-amber-400 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">Gasless onboarding</p>
                        <p class="text-zinc-400 text-xs">First-time tutor setup via link costs nothing. A server relayer pays the gas. Your friend doesn't even need BNB.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/40 border border-zinc-700/40 rounded-xl p-4 flex items-start gap-3">
                    <div class="w-8 h-8 rounded-lg bg-purple-500/15 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-repeat text-purple-400 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">Mutable by tutter</p>
                        <p class="text-zinc-400 text-xs">Tutters can change their tutor by paying 0.0001 BNB. This keeps tutors motivated to help their tutters.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ====== FAQ ====== -->
        <div class="mb-8">
            <h2 class="text-lg font-bold text-white mb-5 flex items-center gap-2">
                <i class="fa-solid fa-circle-question text-zinc-400"></i> FAQ
            </h2>
            <div class="space-y-2">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold text-sm mb-1">Which actions generate tutor rewards?</h4>
                    <p class="text-zinc-400 text-xs">Every action that charges a BNB fee: Fortune Pool bets, Notary certifications, Agora badges/boosts, NFT purchases, Charity donations, and more. The tutor cut (10%) is taken off-the-top from every tutter fee before any other split.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold text-sm mb-1">How do I withdraw my earnings?</h4>
                    <p class="text-zinc-400 text-xs">BNB rewards accumulate in the Ecosystem contract under your address. You can withdraw anytime via the Dashboard. BKC rewards from staking claims are sent directly to your wallet.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold text-sm mb-1">Is there a limit on tutters?</h4>
                    <p class="text-zinc-400 text-xs">No. You can have unlimited tutters. Each tutter independently generates rewards for you. The more tutters you onboard, the more you earn.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold text-sm mb-1">Can tutters change their tutor?</h4>
                    <p class="text-zinc-400 text-xs">Yes. Tutters can change their tutor by paying 0.0001 BNB. This means you should actively help your tutters â€” if you're a good tutor, they'll stay with you.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-xl p-4">
                    <h4 class="text-white font-semibold text-sm mb-1">What's the welcome BKC bonus?</h4>
                    <p class="text-zinc-400 text-xs">When a new user sets their first tutor (via link or manually), they receive free BKC tokens from the tutor bonus pool. This incentivizes new user onboarding.</p>
                </div>
            </div>
        </div>

        <div class="text-center py-6">
            <p class="text-zinc-600 text-xs">Tutor relationships are stored on-chain at <a href="https://sepolia.etherscan.io/address/${E.backchainEcosystem}" target="_blank" class="text-zinc-500 hover:text-amber-400 transition-colors">BackchainEcosystem</a></p>
        </div>

        </div><!-- max-w-3xl wrapper -->
    `,k2(),a&&Em().then(()=>{gl(),Cm()})}function gl(){const e=document.getElementById("tutor-count"),t=document.getElementById("tutor-current");e&&(e.textContent=J.tutorCount),t&&(t.textContent=J.tutor?St(J.tutor):"None yet")}function k2(){const e=document.getElementById("referral");e&&e.addEventListener("click",t=>{const a=t.target;if(a.closest("#tutor-copy-btn")){Tm();return}if(a.closest("#tutor-share-twitter")){C2();return}if(a.closest("#tutor-share-telegram")){B2();return}if(a.closest("#tutor-share-whatsapp")){A2();return}if(a.closest("#tutor-share-native")){I2();return}if(a.closest("#tutor-set-btn")){E2();return}if(a.closest("#tutor-withdraw-btn")){T2();return}})}async function E2(){const e=document.getElementById("tutor-address-input"),t=document.getElementById("tutor-set-status"),a=document.getElementById("tutor-set-btn");if(!e||!t||!a)return;const n=e.value.trim();if(!n||!$t.isAddress(n)){t.style.display="",t.innerHTML='<span class="text-red-400">Invalid address</span>';return}if(n.toLowerCase()===u.userAddress.toLowerCase()){t.style.display="",t.innerHTML='<span class="text-red-400">Cannot tutor yourself</span>';return}a.disabled=!0,a.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-1"></i> Setting...',t.style.display="",t.innerHTML='<span class="text-zinc-400">Sending transaction...</span>';try{const o=await new $t.BrowserProvider(window.ethereum).getSigner(),s=new $t.Contract(E.backchainEcosystem,Yt,o),i=!J.tutor,r=i?await s.tutorFee():await s.changeTutorFee(),l=await s.setTutor(n,{value:r});t.innerHTML='<span class="text-amber-400">Confirming on-chain...</span>',await l.wait(),J.tutor=n,gl(),t.innerHTML=`<span class="text-green-400"><i class="fa-solid fa-check mr-1"></i>Tutor ${i?"set":"changed"} successfully!</span>`,e.value="",x(`Tutor ${i?"set":"changed"} on-chain!`,"success")}catch(o){console.error("[Tutor] Set failed:",o);const s=o.reason||o.message||"Transaction failed";t.innerHTML=`<span class="text-red-400">${s.includes("user rejected")?"Transaction cancelled":s}</span>`}a.disabled=!1,a.innerHTML='<i class="fa-solid fa-graduation-cap mr-1"></i> Set'}async function T2(){if(J.pendingEth===0n){x("No earnings to withdraw","info");return}if(J.isWithdrawing)return;const e=document.getElementById("tutor-withdraw-btn");J.isWithdrawing=!0,e&&(e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-1"></i> Withdrawing...');try{const t=await new $t.BrowserProvider(window.ethereum).getSigner();await(await new $t.Contract(E.backchainEcosystem,Yt,t).withdrawEth()).wait();const o=$t.formatEther(J.pendingEth);J.pendingEth=0n,x(`Withdrew ${o} BNB!`,"success");const s=document.getElementById("tutor-pending-eth");s&&(s.textContent="0.0 BNB"),e&&(e.disabled=!0,e.innerHTML='<i class="fa-solid fa-check mr-1"></i> Withdrawn!')}catch(t){console.error("[Tutor] Withdraw failed:",t);const a=t.reason||t.message||"Withdraw failed";x(a.includes("user rejected")?"Transaction cancelled":a,"error"),e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-arrow-right-from-bracket mr-1"></i> Withdraw')}J.isWithdrawing=!1}function wo(){return u.userAddress?`${window.location.origin}/#dashboard?ref=${u.userAddress}`:""}function ei(){return"Join Backchain â€” I'll be your tutor! Stake BKC tokens and earn rewards. Use my link:"}function Tm(){const e=wo();e&&navigator.clipboard.writeText(e).then(()=>{x("Tutor link copied!","success");const t=document.getElementById("tutor-copy-btn");t&&(t.innerHTML='<i class="fa-solid fa-check text-lg tutor-copy-feedback"></i>',setTimeout(()=>{t.innerHTML='<i class="fa-solid fa-copy text-lg"></i>'},2e3))}).catch(()=>x("Failed to copy","error"))}function C2(){const e=wo();if(!e)return;const t=encodeURIComponent(`${ei()} ${e}

#Backchain #BKC #DeFi #opBNB #BNBChain`);window.open(`https://x.com/intent/tweet?text=${t}`,"_blank")}function B2(){const e=wo();if(!e)return;const t=encodeURIComponent(ei()),a=encodeURIComponent(e);window.open(`https://t.me/share/url?url=${a}&text=${t}`,"_blank")}function A2(){const e=wo();if(!e)return;const t=encodeURIComponent(`${ei()} ${e}`);window.open(`https://wa.me/?text=${t}`,"_blank")}function I2(){const e=wo();e&&(navigator.share?navigator.share({title:"Join Backchain â€” Tutor System",text:ei(),url:e}).catch(()=>{}):Tm())}async function Cm(){if(!(!u.isConnected||J.tutorCount===0))try{const e=te.getProvider(),t=new $t.Contract(E.backchainEcosystem,Yt,e),a=t.filters.TutorSet(null,u.userAddress),n=await t.queryFilter(a,10313523),o=document.getElementById("tutor-student-list");if(!o)return;if(n.length===0){o.innerHTML='<p class="text-zinc-500 text-sm text-center py-2">No tutters yet</p>';return}o.innerHTML=n.map((s,i)=>`
            <div class="flex items-center justify-between rounded-xl px-4 py-3" style="background:rgba(24,24,27,0.5);">
                <div class="flex items-center gap-3">
                    <span class="font-bold text-sm" style="color:#f59e0b;">#${i+1}</span>
                    <span class="text-zinc-300 font-mono text-sm">${St(s.args[0])}</span>
                </div>
                <a href="https://sepolia.etherscan.io/address/${s.args[0]}" target="_blank" rel="noopener" class="text-zinc-500 hover:text-zinc-300 text-xs">
                    <i class="fa-solid fa-external-link"></i>
                </a>
            </div>
        `).join("")}catch(e){console.warn("[Tutor] Failed to load tutter list:",e.message)}}function P2(e){e&&Em().then(()=>{gl(),Cm()})}function N2(){}const z2={render:w2,update:P2,cleanup:N2},ml=window.ethers,pe={pendingEth:0n,modules:[],currentOperator:null,isLoading:!1,isWithdrawing:!1};let Lo=null;function $2(){if(Lo)return Lo;const e=window.ethers;return Lo={[e.id("STAKING")]:{name:"Staking",icon:"fa-layer-group",color:"text-purple-400",bg:"bg-purple-500/10"},[e.id("NFT_POOL")]:{name:"NFT Market",icon:"fa-store",color:"text-pink-400",bg:"bg-pink-500/10"},[e.id("FORTUNE")]:{name:"Fortune Pool",icon:"fa-dice",color:"text-green-400",bg:"bg-green-500/10"},[e.id("AGORA")]:{name:"Agora",icon:"fa-landmark",color:"text-cyan-400",bg:"bg-cyan-500/10"},[e.id("NOTARY")]:{name:"Notary",icon:"fa-stamp",color:"text-slate-400",bg:"bg-slate-500/10"},[e.id("CHARITY")]:{name:"Charity",icon:"fa-hand-holding-heart",color:"text-red-400",bg:"bg-red-500/10"},[e.id("RENTAL")]:{name:"Rental Market",icon:"fa-rocket",color:"text-teal-400",bg:"bg-teal-500/10"}},Lo}function S2(){if(document.getElementById("operator-styles"))return;const e=document.createElement("style");e.id="operator-styles",e.textContent=`
        .op-hero-badge {
            animation: op-glow 2s ease-in-out infinite;
        }
        @keyframes op-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 0 12px rgba(16, 185, 129, 0); }
        }
        .op-earnings-card {
            background: linear-gradient(135deg, rgba(16,185,129,0.08), rgba(6,78,59,0.15));
            border: 1px solid rgba(16,185,129,0.2);
        }
        .op-module-row {
            transition: background-color 0.15s ease;
        }
        .op-module-row:hover {
            background-color: rgba(255,255,255,0.03);
        }
        .op-code-block {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(63,63,70,0.5);
            font-family: 'Fira Code', 'Cascadia Code', monospace;
        }
        .op-code-block code {
            color: #a78bfa;
        }
        .op-code-block .op-string { color: #4ade80; }
        .op-code-block .op-comment { color: #71717a; }
    `,document.head.appendChild(e)}async function Bm(){pe.isLoading=!0;try{const e=te.getProvider(),t=new ml.Contract(E.backchainEcosystem,Yt,e);u.isConnected&&u.userAddress&&(pe.pendingEth=await t.pendingEth(u.userAddress));const a=$2(),n=Object.keys(a),o=await Promise.all(n.map(s=>t.getModuleConfig(s)));pe.modules=n.map((s,i)=>({...a[s],moduleId:s,operatorBps:Number(o[i].operatorBps),treasuryBps:Number(o[i].treasuryBps),buybackBps:Number(o[i].buybackBps),customBps:Number(o[i].customBps),active:o[i].active})).filter(s=>s.active),pe.currentOperator=fo()}catch(e){console.warn("[Operator] Load failed:",e.message)}pe.isLoading=!1}function L2(e){S2();const t=document.getElementById("operator");if(!t)return;const a=u.isConnected&&u.userAddress,n=pe.pendingEth>0n?ml.formatEther(pe.pendingEth):"0.0",o=fo();t.innerHTML=`
    <div class="max-w-3xl mx-auto px-4 pb-24">

        <!-- Hero -->
        <div class="text-center py-8 sm:py-12">
            <div class="op-hero-badge inline-flex items-center gap-2 bg-emerald-500/10 border border-emerald-500/30 rounded-full px-5 py-2 mb-5">
                <i class="fa-solid fa-code text-emerald-400 text-sm"></i>
                <span class="text-emerald-400 text-sm font-bold">Permissionless Developer Program</span>
            </div>
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-white mb-4 leading-tight">
                Build on Backchain,<br class="sm:hidden"> <span class="text-emerald-400">Earn Forever</span>
            </h1>
            <p class="text-zinc-400 text-base sm:text-lg max-w-xl mx-auto leading-relaxed mb-6">
                Create your own frontend, bot, or integration. Every fee generated through your app sends <strong class="text-white">10-20% directly to your wallet</strong> â€” with no registration, no approval, and no middleman.
            </p>
            <div class="flex flex-wrap justify-center gap-3 text-xs">
                <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-300"><i class="fa-solid fa-infinity text-emerald-400 mr-1.5"></i>Perpetual revenue</span>
                <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-300"><i class="fa-solid fa-lock-open text-emerald-400 mr-1.5"></i>No registration</span>
                <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-300"><i class="fa-solid fa-file-contract text-emerald-400 mr-1.5"></i>On-chain guarantee</span>
            </div>
        </div>

        <!-- Earnings Dashboard -->
        ${a?`
        <div class="op-earnings-card rounded-2xl p-6 mb-10">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-center sm:text-left">
                    <p class="text-emerald-400/80 text-sm font-medium mb-1">Your Pending Earnings</p>
                    <p class="text-3xl sm:text-4xl font-extrabold text-white" id="op-pending">${n} <span class="text-lg text-zinc-400">BNB</span></p>
                </div>
                <button id="op-withdraw-btn"
                    class="bg-emerald-600 hover:bg-emerald-500 disabled:bg-zinc-700 disabled:text-zinc-500 text-white font-bold rounded-xl px-6 py-3 text-sm transition-colors flex items-center gap-2"
                    ${pe.pendingEth===0n?"disabled":""}>
                    <i class="fa-solid fa-wallet"></i> Withdraw BNB
                </button>
            </div>
        </div>
        `:`
        <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-6 mb-10 text-center">
            <i class="fa-solid fa-wallet text-4xl text-zinc-600 mb-3"></i>
            <p class="text-zinc-400">Connect your wallet to see your operator earnings</p>
        </div>
        `}

        <!-- What is an Operator? -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-2">What is a Backchain Operator?</h2>
            <p class="text-zinc-400 text-sm leading-relaxed mb-4">
                An Operator is any developer who builds an application on top of the Backchain protocol. By embedding your wallet address as the <code class="text-emerald-400 bg-zinc-800/60 px-1.5 py-0.5 rounded text-xs">operator</code> parameter in transactions, the smart contract automatically routes a percentage of every fee to you.
            </p>
            <p class="text-zinc-400 text-sm leading-relaxed">
                Think of it like an affiliate program â€” except it's <strong class="text-white">enforced by smart contract</strong>, not by a company. There's no signup form, no API key, and no way for anyone to revoke your earnings. If your app generates fees, you get paid. Period.
            </p>
        </div>

        <!-- How It Works â€” Detailed -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-6">How It Works</h2>
            <div class="space-y-4">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5 flex gap-4">
                    <div class="w-12 h-12 shrink-0 rounded-2xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center">
                        <i class="fa-solid fa-code text-xl text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">1. Build Your Application</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">Create a custom frontend, trading bot, Telegram bot, Discord integration, mobile app â€” anything that interacts with Backchain smart contracts. Set your wallet address as the <code class="text-emerald-400 bg-zinc-800/60 px-1 py-0.5 rounded">operator</code> in one line of code.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5 flex gap-4">
                    <div class="w-12 h-12 shrink-0 rounded-2xl bg-blue-500/10 border border-blue-500/30 flex items-center justify-center">
                        <i class="fa-solid fa-users text-xl text-blue-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">2. Users Interact Through Your App</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">Users stake BKC, buy NFTs, play Fortune Pool, certify documents, trade on Agora â€” any protocol action. Each action has a fee (gas-based or value-based), and your operator address travels with the transaction.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5 flex gap-4">
                    <div class="w-12 h-12 shrink-0 rounded-2xl bg-amber-500/10 border border-amber-500/30 flex items-center justify-center">
                        <i class="fa-solid fa-sitemap text-xl text-amber-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">3. Smart Contract Splits the Fee</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">The <code class="text-emerald-400 bg-zinc-800/60 px-1 py-0.5 rounded">BackchainEcosystem</code> contract receives every fee and splits it automatically: Operator share (10-20%), Buyback & Burn, Treasury, and module-specific pools. The split is per-module, immutable, and verifiable on-chain.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5 flex gap-4">
                    <div class="w-12 h-12 shrink-0 rounded-2xl bg-green-500/10 border border-green-500/30 flex items-center justify-center">
                        <i class="fa-solid fa-vault text-xl text-green-400"></i>
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">4. BNB Accumulates in Your Balance</h3>
                        <p class="text-zinc-400 text-xs leading-relaxed">Your operator BNB earnings are stored on-chain in <code class="text-emerald-400 bg-zinc-800/60 px-1 py-0.5 rounded">pendingEth[yourAddress]</code>. Withdraw anytime by calling <code class="text-emerald-400 bg-zinc-800/60 px-1 py-0.5 rounded">withdrawEth()</code> â€” no minimum, no cooldown, no admin approval.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fee Flow Diagram -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-4">Fee Flow</h2>
            <p class="text-zinc-400 text-sm mb-4">Every protocol action generates a fee. Here's where that fee goes:</p>
            <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5 space-y-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-blue-500/10 border border-blue-500/30 flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-user text-blue-400 text-sm"></i>
                    </div>
                    <div class="flex-1 text-sm text-white font-medium">User pays fee (BNB)</div>
                </div>
                <div class="ml-5 border-l-2 border-zinc-700 pl-5 py-1 text-xs text-zinc-500">
                    <i class="fa-solid fa-arrow-down mr-1"></i> Fee sent to BackchainEcosystem contract
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                    <div class="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-3 text-center">
                        <p class="text-emerald-400 text-lg font-extrabold">10-20%</p>
                        <p class="text-emerald-400/80 text-[10px] font-bold uppercase tracking-wider">Operator</p>
                        <p class="text-zinc-500 text-[10px]">Your wallet</p>
                    </div>
                    <div class="bg-amber-500/10 border border-amber-500/30 rounded-xl p-3 text-center">
                        <p class="text-amber-400 text-lg font-extrabold">30-50%</p>
                        <p class="text-amber-400/80 text-[10px] font-bold uppercase tracking-wider">Buyback</p>
                        <p class="text-zinc-500 text-[10px]">Buy + burn BKC</p>
                    </div>
                    <div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-3 text-center">
                        <p class="text-purple-400 text-lg font-extrabold">10-30%</p>
                        <p class="text-purple-400/80 text-[10px] font-bold uppercase tracking-wider">Treasury</p>
                        <p class="text-zinc-500 text-[10px]">Protocol growth</p>
                    </div>
                    <div class="bg-cyan-500/10 border border-cyan-500/30 rounded-xl p-3 text-center">
                        <p class="text-cyan-400 text-lg font-extrabold">10-30%</p>
                        <p class="text-cyan-400/80 text-[10px] font-bold uppercase tracking-wider">Custom</p>
                        <p class="text-zinc-500 text-[10px]">Module-specific</p>
                    </div>
                </div>
                <p class="text-zinc-500 text-[11px] text-center pt-1">Exact percentages vary by module â€” see Commission Rates below</p>
            </div>
        </div>

        <!-- Concrete Earning Examples -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-4">Earning Examples</h2>
            <p class="text-zinc-400 text-sm mb-4">Here's what you'd earn from real transactions through your app:</p>
            <div class="space-y-3">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex flex-col sm:flex-row sm:items-center gap-3">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-9 h-9 bg-purple-500/10 rounded-lg flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-layer-group text-purple-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">User stakes 10,000 BKC</p>
                            <p class="text-zinc-500 text-xs">Staking fee: ~0.005 BNB</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-emerald-400 font-bold">+0.001 BNB</p>
                        <p class="text-zinc-500 text-[10px]">20% operator</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex flex-col sm:flex-row sm:items-center gap-3">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-9 h-9 bg-pink-500/10 rounded-lg flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-store text-pink-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">User buys a Gold NFT</p>
                            <p class="text-zinc-500 text-xs">NFT price: ~0.03 BNB</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-emerald-400 font-bold">+0.003 BNB</p>
                        <p class="text-zinc-500 text-[10px]">10% operator</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex flex-col sm:flex-row sm:items-center gap-3">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-9 h-9 bg-green-500/10 rounded-lg flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-dice text-green-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">User plays Fortune Pool Tier 2</p>
                            <p class="text-zinc-500 text-xs">Entry: 0.05 BNB</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-emerald-400 font-bold">+0.005 BNB</p>
                        <p class="text-zinc-500 text-[10px]">10% operator</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex flex-col sm:flex-row sm:items-center gap-3">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-9 h-9 bg-slate-500/10 rounded-lg flex items-center justify-center shrink-0">
                            <i class="fa-solid fa-stamp text-slate-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">User certifies a document</p>
                            <p class="text-zinc-500 text-xs">Notary fee: ~0.002 BNB</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-emerald-400 font-bold">+0.0004 BNB</p>
                        <p class="text-zinc-500 text-[10px]">20% operator</p>
                    </div>
                </div>
            </div>
            <div class="bg-emerald-500/5 border border-emerald-500/20 rounded-xl p-4 mt-4 text-center">
                <p class="text-zinc-400 text-xs">If your app processes <strong class="text-white">100 transactions/day</strong> averaging 0.01 BNB in fees:</p>
                <p class="text-emerald-400 text-2xl font-extrabold mt-1">~0.15 BNB/day</p>
                <p class="text-zinc-500 text-xs mt-1">~4.5 BNB/month at 15% average operator rate</p>
            </div>
        </div>

        <!-- What You Can Build -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-4">What You Can Build</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-globe text-blue-400"></i>
                        <h3 class="text-white font-bold text-sm">Custom Frontend</h3>
                    </div>
                    <p class="text-zinc-500 text-xs leading-relaxed">Build your own version of backcoin.org with a different UI, different language, or specialized features for your community. All protocol actions earn you operator fees.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-brands fa-telegram text-sky-400"></i>
                        <h3 class="text-white font-bold text-sm">Telegram / Discord Bot</h3>
                    </div>
                    <p class="text-zinc-500 text-xs leading-relaxed">Let users stake, play Fortune Pool, or buy NFTs directly from chat. Every action includes your operator address and routes commissions to your wallet.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-robot text-amber-400"></i>
                        <h3 class="text-white font-bold text-sm">Trading / Automation Bot</h3>
                    </div>
                    <p class="text-zinc-500 text-xs leading-relaxed">Automated staking strategies, NFT arbitrage, or yield optimization. Users opt-in, your bot executes, and you earn fees on every automated transaction.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-mobile-screen text-green-400"></i>
                        <h3 class="text-white font-bold text-sm">Mobile App / PWA</h3>
                    </div>
                    <p class="text-zinc-500 text-xs leading-relaxed">Build a mobile-first experience using WalletConnect or embedded wallets. Same protocol, same fees, same commissions â€” just a better mobile UX.</p>
                </div>
            </div>
        </div>

        <!-- Commission Rates (Live from Contract) -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-2">Commission Rates</h2>
            <p class="text-zinc-400 text-sm mb-5">Live data from the <code class="text-emerald-400 bg-zinc-800/60 px-1.5 py-0.5 rounded text-xs">BackchainEcosystem</code> contract. Each module has its own fee distribution.</p>
            <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl overflow-hidden">
                <div class="grid grid-cols-3 gap-2 px-4 py-3 border-b border-zinc-700/30 text-xs text-zinc-500 font-bold uppercase tracking-wider">
                    <span>Module</span>
                    <span class="text-center">Operator %</span>
                    <span class="text-right">Full Split</span>
                </div>
                <div id="op-modules-list">
                    ${pe.modules.length>0?pe.modules.map(s=>`
                        <div class="op-module-row grid grid-cols-3 gap-2 px-4 py-3 border-b border-zinc-700/20 items-center">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 ${s.bg} rounded-lg flex items-center justify-center shrink-0">
                                    <i class="fa-solid ${s.icon} ${s.color} text-sm"></i>
                                </div>
                                <span class="text-white text-sm font-medium">${s.name}</span>
                            </div>
                            <div class="text-center">
                                <span class="text-emerald-400 font-bold text-lg">${(s.operatorBps/100).toFixed(0)}%</span>
                            </div>
                            <div class="text-right text-xs text-zinc-500 space-y-0.5">
                                <div>Custom ${(s.customBps/100).toFixed(0)}%</div>
                                <div>Treasury ${(s.treasuryBps/100).toFixed(0)}%</div>
                                <div>Buyback ${(s.buybackBps/100).toFixed(0)}%</div>
                            </div>
                        </div>
                    `).join(""):`
                        <div class="px-4 py-8 text-center text-zinc-500">
                            <i class="fa-solid fa-spinner fa-spin mr-2"></i> Loading module data...
                        </div>
                    `}
                </div>
            </div>
            <p class="text-zinc-600 text-[11px] mt-2 text-center">No operator = operator share is burned (sent to 0x0 dead address)</p>
        </div>

        <!-- On-Chain Guarantees -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-4">On-Chain Guarantees</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex gap-3">
                    <i class="fa-solid fa-lock-open text-emerald-400 text-lg mt-0.5"></i>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Permissionless</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">No registration, no API key, no approval process. Any wallet address can be an operator. Just set it and start earning.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex gap-3">
                    <i class="fa-solid fa-file-shield text-emerald-400 text-lg mt-0.5"></i>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Immutable Commissions</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">Fee percentages are set in the smart contract. No admin can change your commission rate or divert your earnings. Code is law.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex gap-3">
                    <i class="fa-solid fa-clock text-emerald-400 text-lg mt-0.5"></i>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">No Expiration</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">No time limit on earnings. As long as the Backchain protocol exists on opBNB, your operator commissions will keep accumulating.</p>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4 flex gap-3">
                    <i class="fa-solid fa-money-bill-transfer text-emerald-400 text-lg mt-0.5"></i>
                    <div>
                        <h3 class="text-white font-bold text-sm mb-1">Instant Withdrawal</h3>
                        <p class="text-zinc-500 text-xs leading-relaxed">Withdraw BNB earnings anytime. No minimum amount, no cooldown period, no vesting. One transaction and it's in your wallet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Integration Guide -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-2">Integration Guide</h2>
            <p class="text-zinc-400 text-sm mb-5">Three ways to set your operator address. Choose the one that fits your setup.</p>
            <div class="space-y-4">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5">
                    <h3 class="text-white font-semibold mb-1 text-sm flex items-center gap-2">
                        <span class="w-6 h-6 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center text-xs font-bold">1</span>
                        Global Variable (recommended for custom frontends)
                    </h3>
                    <p class="text-zinc-400 text-xs mb-3">Set before loading any Backchain modules. Works for full custom frontends.</p>
                    <div class="op-code-block rounded-xl px-4 py-3 text-sm overflow-x-auto">
                        <code><span class="op-comment">// Add this BEFORE importing Backchain modules</span>
window.BACKCHAIN_OPERATOR = <span class="op-string">"0xYOUR_WALLET"</span>;

<span class="op-comment">// Then import and use the protocol normally</span>
<span class="op-comment">// All transactions will include your operator address</span></code>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5">
                    <h3 class="text-white font-semibold mb-1 text-sm flex items-center gap-2">
                        <span class="w-6 h-6 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center text-xs font-bold">2</span>
                        localStorage (for dynamic / runtime configuration)
                    </h3>
                    <p class="text-zinc-400 text-xs mb-3">Good for bots and apps that configure operator at runtime.</p>
                    <div class="op-code-block rounded-xl px-4 py-3 text-sm overflow-x-auto">
                        <code>localStorage.setItem(<span class="op-string">'bkc_operator'</span>, <span class="op-string">'0xYOUR_WALLET'</span>);

<span class="op-comment">// To verify it's active:</span>
console.log(localStorage.getItem(<span class="op-string">'bkc_operator'</span>));</code>
                    </div>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-5">
                    <h3 class="text-white font-semibold mb-1 text-sm flex items-center gap-2">
                        <span class="w-6 h-6 rounded-full bg-emerald-500/20 text-emerald-400 flex items-center justify-center text-xs font-bold">3</span>
                        Per-Transaction (for bots and advanced integrations)
                    </h3>
                    <p class="text-zinc-400 text-xs mb-3">Pass operator directly in each contract call for maximum control.</p>
                    <div class="op-code-block rounded-xl px-4 py-3 text-sm overflow-x-auto">
                        <code><span class="op-comment">// Every Backchain contract function accepts an operator parameter</span>
<span class="op-comment">// Example: staking with operator</span>
stakingPool.delegate(amount, lockDays, <span class="op-string">OPERATOR_ADDR</span>);

<span class="op-comment">// Example: buying NFT with operator</span>
nftPool.buy(tier, quantity, <span class="op-string">OPERATOR_ADDR</span>, { value: price });</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- SDK Coming Soon -->
        <div class="mb-10">
            <div class="bg-gradient-to-r from-emerald-500/5 via-emerald-500/10 to-emerald-500/5 border border-emerald-500/20 rounded-2xl p-6 text-center">
                <div class="inline-flex items-center gap-2 bg-emerald-500/10 border border-emerald-500/30 rounded-full px-4 py-1.5 mb-4">
                    <i class="fa-solid fa-flask text-emerald-400 text-xs"></i>
                    <span class="text-emerald-400 text-xs font-bold uppercase tracking-wider">Coming Soon</span>
                </div>
                <h2 class="text-xl font-bold text-white mb-2">Backchain Developer SDK</h2>
                <p class="text-zinc-400 text-sm max-w-lg mx-auto leading-relaxed mb-4">
                    We're building an official SDK to make integration even easier. Pre-built components, TypeScript types, React hooks, and ready-to-use transaction helpers â€” so you can build on Backchain in minutes, not days.
                </p>
                <div class="flex flex-wrap justify-center gap-2 text-xs">
                    <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-400"><i class="fa-brands fa-npm text-red-400 mr-1"></i>npm package</span>
                    <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-400"><i class="fa-brands fa-js text-yellow-400 mr-1"></i>TypeScript</span>
                    <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-400"><i class="fa-brands fa-react text-cyan-400 mr-1"></i>React hooks</span>
                    <span class="bg-zinc-800/60 border border-zinc-700/40 rounded-full px-3 py-1.5 text-zinc-400"><i class="fa-solid fa-book text-emerald-400 mr-1"></i>Full docs</span>
                </div>
            </div>
        </div>

        <!-- FAQ -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-white mb-4">FAQ</h2>
            <div class="space-y-3">
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <h3 class="text-white font-bold text-sm mb-1">Do I need to register or apply?</h3>
                    <p class="text-zinc-500 text-xs leading-relaxed">No. The operator system is completely permissionless. Any valid wallet address works as an operator. There's no whitelist, no approval, and no KYC.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <h3 class="text-white font-bold text-sm mb-1">Which actions generate operator fees?</h3>
                    <p class="text-zinc-500 text-xs leading-relaxed">All protocol actions that pass through BackchainEcosystem: staking, unstaking, NFT buy/sell, Fortune Pool entries, Notary certification, Charity donations, Agora actions, and NFT rentals. Every module that collects fees supports operators.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <h3 class="text-white font-bold text-sm mb-1">What happens if no operator is set?</h3>
                    <p class="text-zinc-500 text-xs leading-relaxed">The operator share is sent to the zero address (0x000...0000) â€” effectively burned. This means transactions without an operator benefit the protocol by reducing supply, but no one earns the commission.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <h3 class="text-white font-bold text-sm mb-1">Can the admin change commission rates?</h3>
                    <p class="text-zinc-500 text-xs leading-relaxed">Module configs are set during deployment. The Backchain governance model is designed for progressive decentralization â€” commission rates follow the same immutability guarantees as the rest of the protocol.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <h3 class="text-white font-bold text-sm mb-1">Can multiple operators exist at the same time?</h3>
                    <p class="text-zinc-500 text-xs leading-relaxed">Yes. Each transaction specifies its own operator. If 10 different developers build 10 different frontends, each one earns commissions from the transactions that go through their app. There's no competition â€” the ecosystem grows with more operators.</p>
                </div>
                <div class="bg-zinc-800/30 border border-zinc-700/30 rounded-2xl p-4">
                    <h3 class="text-white font-bold text-sm mb-1">How do I track my earnings?</h3>
                    <p class="text-zinc-500 text-xs leading-relaxed">Connect your wallet on this page to see your pending BNB balance. You can also read <code class="text-emerald-400 bg-zinc-800/60 px-1 py-0.5 rounded">pendingEth(yourAddress)</code> directly from the BackchainEcosystem contract on Explorer.</p>
                </div>
            </div>
        </div>

        <!-- Test as Operator -->
        <div class="mb-10">
            <div class="bg-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5 sm:p-6">
                <h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2">
                    <i class="fa-solid fa-flask text-emerald-400"></i> Test as Operator
                </h3>
                <p class="text-zinc-400 text-sm mb-4">Set your wallet as the operator for this browser session. All transactions you make will credit fees to this address.</p>
                <div class="flex flex-col sm:flex-row gap-3 mb-3">
                    <input id="op-address-input" type="text" placeholder="0x..." value="${o.isSet?o.address:""}"
                        class="flex-1 bg-zinc-900/50 border border-zinc-700 rounded-xl px-4 py-3 text-white text-sm placeholder-zinc-600 focus:outline-none focus:border-emerald-500/50 font-mono" />
                    <div class="flex gap-2">
                        <button id="op-set-btn"
                            class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl px-5 py-3 text-sm transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-check"></i> Set
                        </button>
                        <button id="op-clear-btn"
                            class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold rounded-xl px-5 py-3 text-sm transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-xmark"></i> Clear
                        </button>
                    </div>
                </div>
                <div class="text-sm" id="op-current-display">
                    ${o.isSet?`<span class="text-emerald-400"><i class="fa-solid fa-circle-check mr-1"></i> Active: ${go(o.address)}</span> <span class="text-zinc-600">(source: ${o.source})</span>`:'<span class="text-zinc-500"><i class="fa-solid fa-circle-xmark mr-1"></i> No operator set</span>'}
                </div>
            </div>
        </div>

        <!-- Bottom CTA -->
        <div class="text-center py-4">
            <p class="text-zinc-500 text-xs">The Backchain Operator system is permissionless, on-chain, and unstoppable.</p>
            <p class="text-zinc-600 text-xs mt-1">Contracts verified on Explorer. Open source.</p>
        </div>

    </div><!-- /max-w-3xl -->
    `,_2(),pe.modules.length===0&&Bm().then(()=>{Am(),bl()})}function Am(){const e=document.getElementById("op-modules-list");!e||pe.modules.length===0||(e.innerHTML=pe.modules.map(t=>`
        <div class="op-module-row grid grid-cols-3 gap-2 px-4 py-3 border-b border-zinc-700/20 items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 ${t.bg} rounded-lg flex items-center justify-center shrink-0">
                    <i class="fa-solid ${t.icon} ${t.color} text-sm"></i>
                </div>
                <span class="text-white text-sm font-medium">${t.name}</span>
            </div>
            <div class="text-center">
                <span class="text-emerald-400 font-bold text-lg">${(t.operatorBps/100).toFixed(0)}%</span>
            </div>
            <div class="text-right text-xs text-zinc-500 space-y-0.5">
                <div>Custom ${(t.customBps/100).toFixed(0)}%</div>
                <div>Treasury ${(t.treasuryBps/100).toFixed(0)}%</div>
                <div>Buyback ${(t.buybackBps/100).toFixed(0)}%</div>
            </div>
        </div>
    `).join(""))}function bl(){const e=document.getElementById("op-pending");if(e){const a=pe.pendingEth>0n?ml.formatEther(pe.pendingEth):"0.0";e.innerHTML=`${a} <span class="text-lg text-zinc-400">BNB</span>`}const t=document.getElementById("op-withdraw-btn");t&&(t.disabled=pe.pendingEth===0n)}function Im(){const e=document.getElementById("op-current-display");if(!e)return;const t=fo();e.innerHTML=t.isSet?`<span class="text-emerald-400"><i class="fa-solid fa-circle-check mr-1"></i> Active: ${go(t.address)}</span> <span class="text-zinc-600">(source: ${t.source})</span>`:'<span class="text-zinc-500"><i class="fa-solid fa-circle-xmark mr-1"></i> No operator set</span>'}function _2(){const e=document.getElementById("operator");e&&e.addEventListener("click",t=>{const a=t.target;if(a.closest("#op-withdraw-btn")){R2();return}if(a.closest("#op-set-btn")){F2();return}if(a.closest("#op-clear-btn")){D2();return}})}async function R2(){if(pe.isWithdrawing||pe.pendingEth===0n)return;const e=document.getElementById("op-withdraw-btn");pe.isWithdrawing=!0,await M.execute({contract:u.ecosystemManagerContract,method:"withdrawEth",args:()=>[],description:"Withdraw Operator Earnings",skipSimulation:!0,fixedGasLimit:80000n,button:e,onSuccess:()=>{pe.isWithdrawing=!1,pe.pendingEth=0n,bl(),x("BNB withdrawn successfully!","success")},onError:t=>{pe.isWithdrawing=!1,console.error("[Operator] Withdraw failed:",t)}})}function F2(){const e=document.getElementById("op-address-input");if(!e)return;const t=e.value.trim();if(!t){x("Enter an address","error");return}lr(t)?(x(`Operator set to ${go(t)}`,"success"),Im()):x("Invalid address","error")}function D2(){Ts();const e=document.getElementById("op-address-input");e&&(e.value=""),x("Operator cleared","info"),Im()}function M2(e){e&&Bm().then(()=>{Am(),bl()})}function O2(){}const U2={render:L2,update:M2,cleanup:O2},ue=window.ethers,H2="https://sepolia.etherscan.io",j2=15e3,W2=1,ls=ue.parseEther("0.005"),G2=30;function ti(){return E==null?void 0:E.liquidityPool}function Pm(){return E==null?void 0:E.bkcToken}const uo=["function swapETHforBKC(uint256 minBkcOut) external payable returns (uint256 bkcOut)","function swapBKCforETH(uint256 bkcAmount, uint256 minEthOut) external returns (uint256 ethOut)","function getQuote(uint256 ethAmount) external view returns (uint256 bkcOut)","function getQuoteBKCtoETH(uint256 bkcAmount) external view returns (uint256 ethOut)","function currentPrice() external view returns (uint256)","function getPoolStats() external view returns (uint256 _ethReserve, uint256 _bkcReserve, uint256 _totalLPShares, uint64 _totalSwapCount, uint96 _totalEthVolume, uint96 _totalBkcVolume, uint256 _currentPrice)"],Nm=["function approve(address, uint256) returns (bool)","function allowance(address, address) view returns (uint256)","function balanceOf(address) view returns (uint256)"],P={direction:"buy",inputAmount:"",estimatedOutput:0n,estimatedOutputFormatted:"0",priceImpact:0,ethReserve:0n,bkcReserve:0n,priceBkcPerEth:0,priceEthPerBkc:0,totalSwapCount:0,totalEthVolume:0n,totalBkcVolume:0n,slippage:W2,showSettings:!1,isSwapping:!1,swapPhase:"",priceRefreshTimer:null,debounceTimer:null,ethBalance:0n,bkcBalance:0n,chartRange:"1H",priceHistory:[]},zm="bkc_price_history",Hc=5e3,$m={"1H":36e5,"4H":144e5,"24H":864e5,ALL:1/0};function K2(){if(document.getElementById("trade-page-styles"))return;const e=document.createElement("style");e.id="trade-page-styles",e.textContent=`
        .trade-shell {
            max-width: 480px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem 0.75rem;
        }
        .trade-header h3 { font-size: 1.15rem; font-weight: 600; color: #fff; margin: 0; }
        .trade-settings-btn {
            background: none; border: none; color: #98a1c0; cursor: pointer;
            font-size: 1.1rem; padding: 4px; transition: color 0.2s;
        }
        .trade-settings-btn:hover { color: #fff; }

        /* Settings panel */
        .trade-settings-panel {
            max-height: 0; overflow: hidden; transition: max-height 0.3s ease;
            padding: 0 1.5rem; background: #1a1b1f;
        }
        .trade-settings-panel.open { max-height: 120px; padding-bottom: 1rem; }
        .trade-slippage-row {
            display: flex; gap: 6px; align-items: center; margin-top: 8px;
        }
        .trade-slippage-row label { font-size: 0.8rem; color: #98a1c0; margin-right: auto; }
        .trade-slip-btn {
            padding: 5px 12px; border-radius: 12px; border: 1px solid #2c2f36;
            background: #212429; color: #98a1c0; font-size: 0.8rem; cursor: pointer;
            transition: all 0.15s;
        }
        .trade-slip-btn:hover { border-color: #4c82fb; color: #fff; }
        .trade-slip-btn.active { background: #4c82fb; color: #fff; border-color: #4c82fb; }
        .trade-slip-custom {
            width: 60px; padding: 5px 8px; border-radius: 12px; border: 1px solid #2c2f36;
            background: #212429; color: #fff; font-size: 0.8rem; text-align: center; outline: none;
        }
        .trade-slip-custom:focus { border-color: #4c82fb; }

        /* Balance + MAX row */
        .trade-bal-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-top: 6px; font-size: 0.8rem; color: #98a1c0;
        }
        .trade-max-btn {
            background: none; border: none; color: #f59e0b; cursor: pointer;
            font-size: 0.75rem; font-weight: 600; padding: 2px 6px;
            border-radius: 4px; transition: background 0.15s;
        }
        .trade-max-btn:hover { background: rgba(245,158,11,0.15); }

        /* Info section */
        .trade-info {
            padding: 0.75rem 1.5rem; display: flex; flex-direction: column; gap: 4px;
            font-size: 0.8rem; color: #98a1c0;
        }
        .trade-info-row { display: flex; justify-content: space-between; }
        .trade-impact-warn { color: #f59e0b; }
        .trade-impact-danger { color: #ef4444; }

        /* Pool info bar */
        .trade-pool-info {
            margin-top: 12px; padding: 12px 16px; border-radius: 16px;
            background: #212429; border: 1px solid #2c2f36;
            font-size: 0.75rem; color: #98a1c0;
            display: flex; flex-wrap: wrap; gap: 6px 16px; align-items: center;
        }
        .trade-pool-info a { color: #4c82fb; text-decoration: none; }
        .trade-pool-info a:hover { text-decoration: underline; }
        .trade-uni-badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 2px 8px; border-radius: 8px; background: rgba(245,158,11,0.1);
            color: #f59e0b; font-size: 0.7rem; font-weight: 600;
        }

        /* Swap button states */
        .execute-trade-btn.loading {
            background: #2c2f36; color: #98a1c0; cursor: wait;
        }
        .execute-trade-btn.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 12px rgba(245,158,11,0.3);
        }

        /* Price pulse */
        @keyframes trade-pulse { 0%,100% { opacity:1; } 50% { opacity:0.5; } }
        .trade-price-pulse { animation: trade-pulse 0.6s ease; }

        /* Output shimmer */
        .trade-output-loading {
            background: linear-gradient(90deg, #2c2f36 25%, #40444f 50%, #2c2f36 75%);
            background-size: 200% 100%; animation: trade-shimmer 1.5s infinite;
            border-radius: 8px; min-height: 2rem; min-width: 100px;
        }
        @keyframes trade-shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* â”€â”€ Price Chart â”€â”€ */
        .trade-chart-card {
            margin-top: 12px; border-radius: 16px; background: #131517;
            border: 1px solid #2c2f36; overflow: hidden;
        }
        .trade-chart-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            padding: 16px 20px 8px;
        }
        .trade-chart-price-block { display: flex; flex-direction: column; gap: 2px; }
        .trade-chart-label { font-size: 11px; color: #98a1c0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .trade-chart-current { font-size: 22px; font-weight: 700; color: #fff; font-variant-numeric: tabular-nums; }
        .trade-chart-change {
            font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 3px;
        }
        .trade-chart-change.up { color: #22c55e; }
        .trade-chart-change.down { color: #ef4444; }
        .trade-chart-change.flat { color: #98a1c0; }
        .trade-chart-ranges {
            display: flex; gap: 4px; padding-top: 4px;
        }
        .trade-chart-range-btn {
            padding: 4px 10px; border-radius: 8px; border: none;
            background: transparent; color: #98a1c0; font-size: 11px;
            font-weight: 600; cursor: pointer; transition: all 0.15s;
        }
        .trade-chart-range-btn:hover { color: #fff; background: rgba(76,130,251,0.1); }
        .trade-chart-range-btn.active { color: #fff; background: #4c82fb; }
        .trade-chart-canvas-wrap {
            position: relative; width: 100%; height: 180px; padding: 0 4px 8px;
        }
        .trade-chart-canvas-wrap canvas {
            width: 100%; height: 100%; display: block;
        }
        .trade-chart-empty {
            display: flex; align-items: center; justify-content: center;
            height: 180px; color: #98a1c0; font-size: 12px;
            flex-direction: column; gap: 6px;
        }
        .trade-chart-empty i { font-size: 24px; opacity: 0.3; }
        .trade-chart-tooltip {
            position: absolute; pointer-events: none;
            background: #1e2025; border: 1px solid #3c3f46;
            border-radius: 8px; padding: 6px 10px;
            font-size: 11px; color: #fff; white-space: nowrap;
            transform: translate(-50%, -100%); margin-top: -10px;
            z-index: 10; opacity: 0; transition: opacity 0.15s;
        }
        .trade-chart-tooltip.visible { opacity: 1; }
        .trade-chart-crosshair {
            position: absolute; top: 0; width: 1px; height: 100%;
            background: rgba(76,130,251,0.3); pointer-events: none;
            opacity: 0; transition: opacity 0.15s;
        }
        .trade-chart-crosshair.visible { opacity: 1; }
    `,document.head.appendChild(e)}function ai(){return u.publicProvider||(u.provider?u.provider:null)}async function xl(){const e=ai();if(!e)return;const t=ti();if(t)try{const n=await new ue.Contract(t,uo,e).getPoolStats();P.ethReserve=n._ethReserve,P.bkcReserve=n._bkcReserve,P.totalSwapCount=Number(n._totalSwapCount),P.totalEthVolume=n._totalEthVolume,P.totalBkcVolume=n._totalBkcVolume;const o=Number(ue.formatEther(P.ethReserve)),s=Number(ue.formatEther(P.bkcReserve));o>0&&(P.priceBkcPerEth=s/o,P.priceEthPerBkc=o/s),J2(),vl(),e5()}catch(a){console.error("[Trade] getPoolPrice failed:",a)}}function V2(){const e=parseFloat(P.inputAmount);if(!e||e<=0||P.ethReserve===0n||P.bkcReserve===0n){P.estimatedOutput=0n,P.estimatedOutputFormatted="0",P.priceImpact=0;return}const t=Number(ue.formatEther(P.ethReserve)),a=Number(ue.formatEther(P.bkcReserve));if(t===0||a===0)return;let n,o;P.direction==="buy"?(n=t,o=a):(n=a,o=t);const s=(1e4-G2)/1e4,i=e*s,r=i*o/(n+i);if(r<=0){P.estimatedOutput=0n,P.estimatedOutputFormatted="0",P.priceImpact=0;return}const l=o/n,c=r/e;P.priceImpact=Math.abs((l-c)/l)*100,P.estimatedOutput=ue.parseEther(r.toFixed(18)),P.estimatedOutputFormatted=Y2(r)}function Y2(e){return e<1e-4?e.toExponential(2):e<1?e.toFixed(6):e<1e3?e.toFixed(4):e<1e6?e.toLocaleString("en-US",{maximumFractionDigits:2}):(e/1e6).toFixed(2)+"M"}function Sm(e){return e===0?"--":e<1e-4?e.toExponential(4):e<1?e.toFixed(6):e.toLocaleString("en-US",{maximumFractionDigits:2})}async function ni(){if(!u.isConnected||!u.userAddress)return;const e=ai();if(!e)return;const t=Pm();if(t)try{const[a,n]=await Promise.all([e.getBalance(u.userAddress),new ue.Contract(t,Nm,e).balanceOf(u.userAddress)]);P.ethBalance=a,P.bkcBalance=n,hl()}catch(a){console.error("[Trade] loadBalances:",a)}}async function Vi(){const t=await(u.publicProvider||u.provider).getFeeData(),a=(t.maxFeePerGas||t.gasPrice||100000000n)*2n,n=(t.maxPriorityFeePerGas||0n)*2n||1n;return{maxFeePerGas:a,maxPriorityFeePerGas:n}}async function q2(e){if(!(P.isSwapping||!u.isConnected||!u.signer)){P.isSwapping=!0;try{const t=ue.parseEther(P.inputAmount);if(t===0n)throw new Error("Enter an amount");if(P.ethBalance<t+ls)throw new Error("Insufficient ETH (need amount + gas)");const a=ti();if(!a)throw new Error("Pool address not loaded");Ba(e,"Getting quote...",!0);const n=ai(),s=await new ue.Contract(a,uo,n).getQuote(t),i=BigInt(Math.floor(P.slippage*100)),r=s*(10000n-i)/10000n;console.log(`[Trade] Buy quote: real=${ue.formatEther(s)} BKC, min=${ue.formatEther(r)} BKC`),Ba(e,"Confirm in Wallet...",!0);const l=u.signer,c=new ue.Contract(a,uo,l),d=await Vi(),f=await c.swapETHforBKC(r,{value:t,...d});Ba(e,"Processing...",!0);const g=await f.wait();x("Swap successful! Bought BKC","success"),console.log(`[Trade] Buy TX: ${g.hash}`),_m()}catch(t){Lm(t)}finally{P.isSwapping=!1,Rm(e)}}}async function X2(e){if(!(P.isSwapping||!u.isConnected||!u.signer)){P.isSwapping=!0;try{const t=ue.parseEther(P.inputAmount);if(t===0n)throw new Error("Enter an amount");if(P.bkcBalance<t)throw new Error("Insufficient BKC");const a=ti(),n=Pm();if(!a||!n)throw new Error("Contract addresses not loaded");const o=u.signer,s=new ue.Contract(n,Nm,o),i=new ue.Contract(a,uo,o);if(Ba(e,"Approving BKC...",!0),await s.allowance(u.userAddress,a)<t){const y=await Vi();await(await s.approve(a,ue.MaxUint256,y)).wait()}Ba(e,"Getting quote...",!0);const l=ai(),d=await new ue.Contract(a,uo,l).getQuoteBKCtoETH(t),f=BigInt(Math.floor(P.slippage*100)),g=d*(10000n-f)/10000n;console.log(`[Trade] Sell quote: real=${ue.formatEther(d)} ETH, min=${ue.formatEther(g)} ETH`),Ba(e,"Confirm in Wallet...",!0);const m=await Vi(),h=await i.swapBKCforETH(t,g,m);Ba(e,"Processing...",!0);const w=await h.wait();x("Swap successful! Sold BKC for ETH","success"),console.log(`[Trade] Sell TX: ${w.hash}`),_m()}catch(t){Lm(t)}finally{P.isSwapping=!1,Rm(e)}}}function Lm(e){e.code==="ACTION_REJECTED"||e.code===4001?x("Transaction cancelled","info"):(console.error("[Trade] Swap failed:",e),x(`Swap failed: ${e.reason||e.shortMessage||e.message}`,"error"))}function _m(){P.inputAmount="",P.estimatedOutput=0n,P.estimatedOutputFormatted="0",P.priceImpact=0;const e=document.getElementById("trade-input");e&&(e.value=""),Fm(),oi(),ni(),xl()}function Ba(e,t,a){e&&(e.textContent=t,e.disabled=!0,e.classList.add("loading"))}function Rm(e){e&&(e.classList.remove("loading"),Ja())}function Ja(){const e=document.getElementById("trade-swap-btn");if(!e)return;if(!u.isConnected){e.textContent="Connect Wallet",e.disabled=!1,e.className="execute-trade-btn";return}const t=parseFloat(P.inputAmount);if(!t||t<=0){e.textContent="Enter amount",e.disabled=!0,e.className="execute-trade-btn";return}const a=ue.parseEther(P.inputAmount);if(P.direction==="buy"&&P.ethBalance<a+ls){e.textContent="Insufficient ETH",e.disabled=!0,e.className="execute-trade-btn";return}if(P.direction==="sell"&&P.bkcBalance<a){e.textContent="Insufficient BKC",e.disabled=!0,e.className="execute-trade-btn";return}if(P.priceImpact>5){e.textContent=`Swap (${P.priceImpact.toFixed(1)}% impact)`,e.disabled=!1,e.className="execute-trade-btn warning";return}e.textContent="Swap",e.disabled=!1,e.className="execute-trade-btn"}async function J2(){const e=document.getElementById("trade-price");if(!e)return;let t=`1 ETH = ${Sm(P.priceBkcPerEth)} BKC`;const a=u.publicProvider||u.provider;if(a&&P.priceEthPerBkc>0)try{const n=await Fr(a);n.bkcUsd>0&&(t+=`  Â·  1 BKC = ${Ds(n.bkcUsd)}`)}catch{}e.textContent=t,e.classList.remove("trade-price-pulse"),e.offsetWidth,e.classList.add("trade-price-pulse")}function Fm(){const e=document.getElementById("trade-output");e&&(e.textContent=P.estimatedOutputFormatted)}function oi(){const e=document.getElementById("trade-impact"),t=document.getElementById("trade-slip-display");if(e){const a=P.priceImpact.toFixed(2);e.textContent=`~${a}%`,e.className=P.priceImpact>15?"trade-impact-danger":P.priceImpact>5?"trade-impact-warn":""}t&&(t.textContent=`${P.slippage}%`)}function hl(){const e=document.getElementById("trade-from-bal"),t=document.getElementById("trade-to-bal");if(e){const a=P.direction==="buy"?P.ethBalance:P.bkcBalance,n=P.direction==="buy"?"ETH":"BKC";e.textContent=`Balance: ${jc(a)} ${n}`}if(t){const a=P.direction==="buy"?P.bkcBalance:P.ethBalance,n=P.direction==="buy"?"BKC":"ETH";t.textContent=`Balance: ${jc(a)} ${n}`}Ja()}function jc(e){if(!e||e===0n)return"0";const t=Number(ue.formatEther(e));return t<1e-4?"<0.0001":t<1?t.toFixed(4):t<1e6?t.toLocaleString("en-US",{maximumFractionDigits:4}):(t/1e6).toFixed(2)+"M"}function vl(){V2(),Fm(),oi(),Ja()}function Dm(){const e=document.getElementById("trade");if(!e)return;const t=ti()||"0x0000000000000000000000000000000000000000",a=P.direction==="buy"?"ETH":"BKC",n=P.direction==="buy"?"BKC":"ETH",o=P.direction==="buy"?'<i class="fa-brands fa-ethereum" style="font-size:20px;color:#627eea"></i>':'<img src="./assets/bkc_logo_3d.png" style="width:28px;height:28px;border-radius:50%">',s=P.direction==="buy"?'<img src="./assets/bkc_logo_3d.png" style="width:28px;height:28px;border-radius:50%">':'<i class="fa-brands fa-ethereum" style="font-size:20px;color:#627eea"></i>';e.innerHTML=`
    <div class="trade-shell">
        <div class="swap-box-container">
            <!-- Header -->
            <div class="trade-header">
                <h3>Trade</h3>
                <button class="trade-settings-btn" id="trade-settings-toggle" title="Slippage settings">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>

            <!-- Settings panel -->
            <div class="trade-settings-panel ${P.showSettings?"open":""}" id="trade-settings-panel">
                <div class="trade-slippage-row">
                    <label>Slippage</label>
                    <button class="trade-slip-btn ${P.slippage===.5?"active":""}" data-slip="0.5">0.5%</button>
                    <button class="trade-slip-btn ${P.slippage===1?"active":""}" data-slip="1">1%</button>
                    <button class="trade-slip-btn ${P.slippage===3?"active":""}" data-slip="3">3%</button>
                    <input type="text" class="trade-slip-custom" id="trade-slip-custom"
                           placeholder="Custom" value="${[.5,1,3].includes(P.slippage)?"":P.slippage}" />
                </div>
            </div>

            <!-- Swap content -->
            <div id="swap-box-content">
                <!-- FROM -->
                <div class="swap-panel">
                    <div class="swap-panel-header">
                        <span>From</span>
                    </div>
                    <div class="swap-panel-main">
                        <input type="text" class="swap-amount" id="trade-input"
                               placeholder="0" inputmode="decimal" autocomplete="off"
                               value="${P.inputAmount}" />
                        <div class="token-selector-btn">
                            ${o}
                            <span>${a}</span>
                        </div>
                    </div>
                    <div class="trade-bal-row">
                        <span id="trade-from-bal">Balance: --</span>
                        <button class="trade-max-btn" id="trade-max-btn">MAX</button>
                    </div>
                </div>

                <!-- Flip arrow -->
                <div class="swap-arrow-button-wrapper">
                    <button class="swap-arrow-btn" id="trade-flip-btn">
                        <i class="fa-solid fa-arrow-down"></i>
                    </button>
                </div>

                <!-- TO -->
                <div class="swap-panel">
                    <div class="swap-panel-header">
                        <span>To (estimated)</span>
                    </div>
                    <div class="swap-panel-main">
                        <span class="swap-amount" id="trade-output" style="color:#98a1c0">${P.estimatedOutputFormatted}</span>
                        <div class="token-selector-btn">
                            ${s}
                            <span>${n}</span>
                        </div>
                    </div>
                    <div class="trade-bal-row">
                        <span id="trade-to-bal">Balance: --</span>
                        <span></span>
                    </div>
                </div>
            </div>

            <!-- Info section -->
            <div class="trade-info" id="trade-info">
                <div class="trade-info-row">
                    <span>Price</span>
                    <span id="trade-price">${P.priceBkcPerEth?"1 ETH = "+Sm(P.priceBkcPerEth)+" BKC":"Loading..."}</span>
                </div>
                <div class="trade-info-row">
                    <span>Price Impact</span>
                    <span id="trade-impact">~0%</span>
                </div>
                <div class="trade-info-row">
                    <span>Max Slippage</span>
                    <span id="trade-slip-display">${P.slippage}%</span>
                </div>
            </div>

            <!-- Swap button -->
            <div id="swap-box-button-container">
                <button class="execute-trade-btn" id="trade-swap-btn" disabled>
                    ${u.isConnected?"Enter amount":"Connect Wallet"}
                </button>
            </div>
        </div>

        <!-- Pool info -->
        <div class="trade-pool-info">
            <span>Pool: <a href="${H2}/address/${t}" target="_blank" rel="noopener noreferrer">${t.slice(0,6)}...${t.slice(-4)}</a></span>
            <span>Fee: 0.3%</span>
            <span class="trade-uni-badge"><i class="fa-solid fa-droplet"></i> Backchain AMM</span>
        </div>

        <!-- Price Chart -->
        <div class="trade-chart-card">
            <div class="trade-chart-header">
                <div class="trade-chart-price-block">
                    <span class="trade-chart-label">BKC Price</span>
                    <span id="chart-current-price" class="trade-chart-current">--</span>
                    <span id="chart-change" class="trade-chart-change flat">--</span>
                </div>
                <div class="trade-chart-ranges">
                    ${Object.keys($m).map(i=>`<button class="trade-chart-range-btn ${i===P.chartRange?"active":""}" data-range="${i}">${i}</button>`).join("")}
                </div>
            </div>
            <div class="trade-chart-canvas-wrap" id="chart-wrap">
                <canvas id="trade-chart-canvas"></canvas>
                <div class="trade-chart-crosshair" id="chart-crosshair"></div>
                <div class="trade-chart-tooltip" id="chart-tooltip"></div>
            </div>
        </div>
    </div>`}function Z2(){try{const e=localStorage.getItem(zm);e&&(P.priceHistory=JSON.parse(e))}catch{P.priceHistory=[]}}function Q2(){try{P.priceHistory.length>Hc&&(P.priceHistory=P.priceHistory.slice(-Hc)),localStorage.setItem(zm,JSON.stringify(P.priceHistory))}catch{}}function e5(){const e=u.publicProvider||u.provider;!e||P.priceEthPerBkc<=0||Fr(e).then(t=>{const a=Date.now(),n=P.priceHistory[P.priceHistory.length-1];n&&a-n.t<1e4||(P.priceHistory.push({t:a,p:t.bkcUsd,e:t.bkcEth}),Q2(),yl())}).catch(()=>{})}function t5(){const e=$m[P.chartRange];if(e===1/0)return[...P.priceHistory];const t=Date.now()-e;return P.priceHistory.filter(a=>a.t>=t)}function yl(){const e=document.getElementById("trade-chart-canvas"),t=document.getElementById("chart-wrap");if(!e||!t)return;const a=e.getContext("2d"),n=window.devicePixelRatio||1,o=t.getBoundingClientRect(),s=o.width,i=o.height;e.width=s*n,e.height=i*n,a.scale(n,n),a.clearRect(0,0,s,i);const r=t5();if(a5(r),r.length<2){a.fillStyle="#98a1c0",a.font="12px system-ui, sans-serif",a.textAlign="center",a.fillText("Collecting price data...",s/2,i/2-8),a.font="11px system-ui, sans-serif",a.fillStyle="#6b7280",a.fillText("Chart updates every 15 seconds",s/2,i/2+12);return}const l=r.some(G=>G.p>0),c=r.map(G=>l?G.p:G.e),d=r.map(G=>G.t),f=Math.min(...c),g=Math.max(...c),m=g-f||g*.01||1e-4,h=8,w=10,y=22,k=s-h*2,v=i-w-y,T=G=>h+G/(r.length-1)*k,I=G=>w+(1-(G-f)/m)*v,N=c[c.length-1]>=c[0],S=N?"#22c55e":"#ef4444",$=N?"rgba(34,197,94,0.25)":"rgba(239,68,68,0.25)",F=N?"rgba(34,197,94,0)":"rgba(239,68,68,0)",V=a.createLinearGradient(0,w,0,i-y);V.addColorStop(0,$),V.addColorStop(1,F),a.beginPath(),a.moveTo(T(0),I(c[0]));for(let G=1;G<c.length;G++)a.lineTo(T(G),I(c[G]));a.lineTo(T(c.length-1),i-y),a.lineTo(T(0),i-y),a.closePath(),a.fillStyle=V,a.fill(),a.beginPath(),a.moveTo(T(0),I(c[0]));for(let G=1;G<c.length;G++)a.lineTo(T(G),I(c[G]));a.strokeStyle=S,a.lineWidth=1.8,a.lineJoin="round",a.stroke();const X=T(c.length-1),re=I(c[c.length-1]);a.beginPath(),a.arc(X,re,3.5,0,Math.PI*2),a.fillStyle=S,a.fill(),a.beginPath(),a.arc(X,re,6,0,Math.PI*2),a.strokeStyle=S,a.lineWidth=1,a.globalAlpha=.3,a.stroke(),a.globalAlpha=1,a.fillStyle="#6b7280",a.font="10px system-ui, sans-serif",a.textAlign="center";const le=Math.min(5,r.length);for(let G=0;G<le;G++){const Pe=Math.round(G*(r.length-1)/(le-1)),ct=new Date(d[Pe]),je=ct.getHours().toString().padStart(2,"0")+":"+ct.getMinutes().toString().padStart(2,"0");a.fillText(je,T(Pe),i-4)}a.textAlign="right",a.fillStyle="#4b5563",a.font="9px system-ui, sans-serif";const se=l?"$":"",ke=l?g<.01?6:4:8;a.fillText(se+g.toFixed(ke),s-h,w+10),a.fillText(se+f.toFixed(ke),s-h,i-y-4),e._chartMeta={data:r,prices:c,times:d,useUsd:l,toX:T,toY:I,padX:h,padTop:w,padBot:y,chartW:k,chartH:v,W:s,H:i}}function a5(e){const t=document.getElementById("chart-current-price"),a=document.getElementById("chart-change");if(!t||!a)return;if(e.length===0){t.textContent="--",a.textContent="--",a.className="trade-chart-change flat";return}const n=e[e.length-1],o=e.some(r=>r.p>0),s=o?n.p:n.e,i=o?e[0].p:e[0].e;if(o?t.textContent=Ds(s):t.textContent=s.toFixed(8)+" ETH",e.length>=2&&i>0){const r=(s-i)/i*100,l=r>=0?"â–²":"â–¼";a.textContent=`${l} ${Math.abs(r).toFixed(2)}% (${P.chartRange})`,a.className=`trade-chart-change ${r>0?"up":r<0?"down":"flat"}`}else a.textContent="--",a.className="trade-chart-change flat"}function n5(){var a;const e=document.getElementById("trade-chart-canvas"),t=document.getElementById("chart-wrap");!e||!t||((a=t.closest(".trade-chart-card"))==null||a.addEventListener("click",n=>{const o=n.target.closest("[data-range]");o&&(P.chartRange=o.dataset.range,t.closest(".trade-chart-card").querySelectorAll(".trade-chart-range-btn").forEach(s=>s.classList.remove("active")),o.classList.add("active"),yl())}),e.addEventListener("mousemove",n=>{const o=e._chartMeta;if(!o||o.data.length<2)return;const s=e.getBoundingClientRect(),r=(n.clientX-s.left-o.padX)/o.chartW,l=Math.round(r*(o.data.length-1));if(l<0||l>=o.data.length)return;const c=o.data[l],d=o.useUsd?c.p:c.e,f=o.useUsd?"$":"",g=o.useUsd?d<.01?6:4:8,m=o.useUsd?"":" ETH",w=new Date(c.t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),y=document.getElementById("chart-tooltip"),k=document.getElementById("chart-crosshair");y&&(y.textContent=`${f}${d.toFixed(g)}${m}  Â·  ${w}`,y.style.left=o.toX(l)+"px",y.style.top=o.toY(d)+"px",y.classList.add("visible")),k&&(k.style.left=o.toX(l)+"px",k.classList.add("visible"))}),e.addEventListener("mouseleave",()=>{const n=document.getElementById("chart-tooltip"),o=document.getElementById("chart-crosshair");n&&n.classList.remove("visible"),o&&o.classList.remove("visible")}))}function Mm(){const e=document.getElementById("trade");e&&(e.addEventListener("click",o5),e.addEventListener("input",s5))}function o5(e){const t=e.target;if(t.closest("#trade-settings-toggle")){P.showSettings=!P.showSettings;const n=document.getElementById("trade-settings-panel");n&&n.classList.toggle("open",P.showSettings);return}const a=t.closest("[data-slip]");if(a){P.slippage=parseFloat(a.dataset.slip);const n=document.getElementById("trade-slip-custom");n&&(n.value=""),document.querySelectorAll(".trade-slip-btn").forEach(o=>o.classList.remove("active")),a.classList.add("active"),oi(),Ja();return}if(t.closest("#trade-flip-btn")){P.direction=P.direction==="buy"?"sell":"buy",P.inputAmount="",P.estimatedOutput=0n,P.estimatedOutputFormatted="0",P.priceImpact=0,Dm(),Mm(),ni();return}if(t.closest("#trade-max-btn")){let n;if(P.direction==="buy"?n=P.ethBalance>ls?P.ethBalance-ls:0n:n=P.bkcBalance,n>0n){P.inputAmount=ue.formatEther(n);const o=document.getElementById("trade-input");o&&(o.value=P.inputAmount),vl()}return}if(t.closest("#trade-swap-btn")){if(!u.isConnected){ys();return}const n=document.getElementById("trade-swap-btn");P.direction==="buy"?q2(n):X2(n);return}}function s5(e){const t=e.target;if(t.id==="trade-input"){let a=t.value.replace(/[^0-9.]/g,"");a.split(".").length-1>1&&(a=a.slice(0,a.lastIndexOf("."))),t.value=a,P.inputAmount=a,clearTimeout(P.debounceTimer),P.debounceTimer=setTimeout(()=>vl(),200);return}if(t.id==="trade-slip-custom"){const a=parseFloat(t.value);a>=.1&&a<=50&&(P.slippage=a,document.querySelectorAll(".trade-slip-btn").forEach(n=>n.classList.remove("active")),oi(),Ja());return}}function i5(){Om(),P.priceRefreshTimer=setInterval(()=>{P.isSwapping||xl()},j2)}function Om(){P.priceRefreshTimer&&(clearInterval(P.priceRefreshTimer),P.priceRefreshTimer=null)}function r5(e){K2(),document.getElementById("trade")&&(e&&(Z2(),Dm(),Mm(),n5(),xl(),ni(),i5(),yl()),Ja(),hl())}function l5(e){ni(),Ja(),hl()}function c5(){Om(),clearTimeout(P.debounceTimer),P.isSwapping=!1}const d5={render:r5,update:l5,cleanup:c5},u5=window.inject||(()=>{console.warn("Dev Mode: Analytics disabled.")});if(window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1")try{u5()}catch(e){console.error("Analytics Error:",e)}const wl="".toLowerCase();window.__ADMIN_WALLET__=wl;wl&&console.log("âœ… Admin access granted");let Aa=null,Kn=null,vi=!1;const Re={dashboard:V0,staking:Wo,store:Ax,fortune:sc,charity:B1,agora:rs,notary:Mg,airdrop:av,tokenomics:Yv,about:Ph,admin:_v,rental:Vg,socials:Cw,tutorials:Xg,referral:z2,operator:U2,trade:d5,mine:Wo,rewards:Wo,actions:sc,backchat:rs};function Um(e){return!e||e.length<42?"...":`${e.slice(0,6)}...${e.slice(-4)}`}function p5(e){if(!e)return"0.00";const t=j(e);return t>=1e9?(t/1e9).toFixed(2)+"B":t>=1e6?(t/1e6).toFixed(2)+"M":t>=1e4?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function sa(e,t=!1){const a=document.querySelector("main > div.container"),n=document.querySelectorAll(".sidebar-link");if(!a){console.error("âŒ Page container not found");return}const o={rewards:"staking",mine:"staking",actions:"fortune",backchat:"agora"};o[e]&&(e=o[e],window.location.hash=e);const s=window.location.hash.includes("/");if(!(Aa!==e||t||s)){Re[e]&&typeof Re[e].update=="function"&&Re[e].update(u.isConnected);return}console.log(`ðŸ“ Navigating: ${Aa} â†’ ${e} (force: ${t})`),Kn&&typeof Kn=="function"&&(Kn(),Kn=null),Array.from(a.children).forEach(c=>{c.tagName==="SECTION"&&(c.classList.add("hidden"),c.classList.remove("active"))});const r=document.getElementById("charity-container");r&&e!=="charity"&&(r.innerHTML=""),n.forEach(c=>{c.classList.remove("active")});const l=document.getElementById(e);if(l&&Re[e]){l.classList.remove("hidden"),l.classList.add("active");const c=Aa!==e;Aa=e;const d=document.querySelector(`.sidebar-link[data-target="${e}"]`);d&&(d.classList.remove("text-zinc-400","hover:text-white","hover:bg-zinc-700"),d.classList.add("active")),document.querySelectorAll(".bottom-tab").forEach(g=>g.classList.remove("active"));const f=document.querySelector(`.bottom-tab[data-target="${e}"]`);f&&f.classList.add("active"),Re[e]&&typeof Re[e].render=="function"&&Re[e].render(c||t),typeof Re[e].cleanup=="function"&&(Kn=Re[e].cleanup),c&&window.scrollTo(0,0)}else e!=="dashboard"&&e!=="faucet"&&(console.warn(`Route '${e}' not found, redirecting to dashboard.`),sa("dashboard",!0))}window.navigateTo=sa;const Wc="wallet-btn text-xs font-mono text-center max-w-fit whitespace-nowrap relative font-bold py-2 px-4 rounded-md transition-colors";function kl(e=!1){vi||(vi=!0,requestAnimationFrame(()=>{f5(e),vi=!1}))}function f5(e){const t=document.getElementById("admin-link-container"),a=document.getElementById("statUserBalance"),n=document.getElementById("connectButtonDesktop"),o=document.getElementById("connectButtonMobile"),s=document.getElementById("mobileAppDisplay");let i=u.userAddress;const r=[n,o];if(u.isConnected&&i){const c=p5(u.currentUserBalance),f=`
            <div class="status-dot"></div>
            <span>${Um(i)}</span>
            <div class="balance-pill">
                ${c} BKC
            </div>
        `;if(r.forEach(g=>{g&&(g.innerHTML=f,g.className=Wc+" wallet-btn-connected")}),s&&(s.textContent="Backcoin.org",s.classList.add("text-white"),s.classList.remove("text-amber-400")),t){const g=i.toLowerCase()===wl;t.style.display=g?"block":"none"}a&&(a.textContent=c)}else{const c='<i class="fa-solid fa-plug"></i> Connect Wallet';r.forEach(d=>{d&&(d.innerHTML=c,d.className=Wc+" wallet-btn-disconnected")}),s&&(s.textContent="Backcoin.org",s.classList.add("text-amber-400"),s.classList.remove("text-white")),t&&(t.style.display="none"),a&&(a.textContent="--")}const l=Aa||"dashboard";e||!Aa?sa(l,!0):Re[l]&&typeof Re[l].update=="function"&&Re[l].update(u.isConnected)}function g5(e){const{isConnected:t,address:a,isNewConnection:n,wasConnected:o}=e,s=n||t!==o;u.isConnected=t,a&&(u.userAddress=a),kl(s),t&&n?(x(`Connected: ${Um(a)}`,"success"),localStorage.getItem("backchain_tutor")&&x5()):!t&&o&&x("Wallet disconnected.","info")}function m5(){const e=document.getElementById("testnet-banner"),t=document.getElementById("close-testnet-banner");if(!(!e||!t)){if(localStorage.getItem("hideTestnetBanner")==="true"){e.remove();return}e.style.transform="translateY(0)",t.addEventListener("click",()=>{e.style.transform="translateY(100%)",setTimeout(()=>e.remove(),500),localStorage.setItem("hideTestnetBanner","true")})}}function b5(){const e=document.querySelectorAll(".sidebar-link"),t=document.getElementById("menu-btn"),a=document.getElementById("sidebar"),n=document.getElementById("sidebar-backdrop"),o=document.getElementById("connectButtonDesktop"),s=document.getElementById("connectButtonMobile"),i=document.getElementById("shareProjectBtn");m5(),e.length>0&&e.forEach(m=>{m.addEventListener("click",async h=>{h.preventDefault();const w=m.dataset.target;if(w==="faucet"){x("Accessing Testnet Faucet...","info"),await rr(null)&&kl(!0);return}w&&(window.location.hash=w,sa(w,!0),a&&a.classList.contains("translate-x-0")&&(a.classList.remove("translate-x-0"),a.classList.add("-translate-x-full"),n&&n.classList.add("hidden")))})});const r=()=>{ys()};o&&o.addEventListener("click",r),s&&s.addEventListener("click",r),i&&i.addEventListener("click",()=>ab(u.userAddress)),t&&a&&n&&(t.addEventListener("click",()=>{a.classList.contains("translate-x-0")?(a.classList.add("-translate-x-full"),a.classList.remove("translate-x-0"),n.classList.add("hidden")):(a.classList.remove("-translate-x-full"),a.classList.add("translate-x-0"),n.classList.remove("hidden"))}),n.addEventListener("click",()=>{a.classList.add("-translate-x-full"),a.classList.remove("translate-x-0"),n.classList.add("hidden")})),document.querySelectorAll(".bottom-tab[data-target]").forEach(m=>{m.addEventListener("click",()=>{const h=m.dataset.target;window.location.hash=h,sa(h,!0)})});const c=document.getElementById("more-tab-btn"),d=document.getElementById("more-drawer"),f=document.getElementById("more-drawer-backdrop");c&&d&&f&&(c.addEventListener("click",()=>{!d.classList.contains("translate-y-full")?(d.classList.add("translate-y-full"),f.classList.add("hidden")):(d.classList.remove("translate-y-full"),f.classList.remove("hidden"))}),f.addEventListener("click",()=>{d.classList.add("translate-y-full"),f.classList.add("hidden")})),document.querySelectorAll(".more-drawer-item[data-target]").forEach(m=>{m.addEventListener("click",()=>{const h=m.dataset.target;window.location.hash=h,sa(h,!0),d&&d.classList.add("translate-y-full"),f&&f.classList.add("hidden")})})}function Hm(){const e=window.location.hash.replace("#","");if(!e)return"dashboard";const t=e.split(/[/?]/)[0];return Re[t]?t:"dashboard"}function jm(){try{const e=window.location.hash,t=e.indexOf("?");if(t===-1)return;const n=new URLSearchParams(e.substring(t)).get("ref");n&&/^0x[a-fA-F0-9]{40}$/.test(n)&&(localStorage.getItem("backchain_tutor")||(localStorage.setItem("backchain_tutor",n),console.log("[Tutor] Captured tutor from URL:",n)))}catch(e){console.warn("[Tutor] Failed to parse tutor param:",e.message)}}async function x5(){const e=localStorage.getItem("backchain_tutor");if(!(!e||!u.isConnected||!u.userAddress)){if(e.toLowerCase()===u.userAddress.toLowerCase()){localStorage.removeItem("backchain_tutor");return}try{const a=await(await fetch("/api/referral",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAddress:u.userAddress,referrerAddress:e})})).json();a.success?(localStorage.removeItem("backchain_tutor"),a.referrerSet&&x("Tutor registered! You are now earning referral rewards.","success"),a.faucetClaimed&&x(`Welcome bonus: ${a.ethAmount||"0.01"} ETH sent to your wallet!`,"success")):(localStorage.removeItem("backchain_tutor"),a.error&&x(a.error,"warning"))}catch(t){console.warn("[Tutor] API call failed:",t.message),x("Tutor setup failed. You can set it manually on the Tutor page.","warning")}}}window.addEventListener("load",async()=>{console.log("ðŸš€ App Initializing..."),ht.earn||(ht.earn=document.getElementById("staking"));try{if(!await Zc())throw new Error("Failed to load contract addresses")}catch(n){console.error("âŒ Critical Initialization Error:",n),x("Initialization failed. Please refresh.","error");return}b5(),await Fb(),Db(g5),jm();const e=document.getElementById("initial-loader-container");e&&e.remove();const t=document.getElementById("welcome-splash");t&&(t.addEventListener("click",()=>Cl()),setTimeout(()=>Cl(),2500));const a=Hm();console.log("ðŸ“ Initial page from URL:",a,"Hash:",window.location.hash),sa(a,!0),console.log("âœ… App Ready.")});window.addEventListener("hashchange",()=>{jm();const e=Hm(),t=window.location.hash;console.log("ðŸ”„ Hash changed to:",e,"Full hash:",t),e!==Aa?sa(e,!0):e==="charity"&&Re[e]&&typeof Re[e].render=="function"&&Re[e].render(!0)});window.StakingPage=Wo;window.openConnectModal=ys;window.disconnectWallet=Sd;window.updateUIState=kl;
