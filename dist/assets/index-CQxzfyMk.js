import{defaultConfig as au,createWeb3Modal as nu}from"https://esm.sh/@web3modal/ethers@5.1.11?bundle";import{initializeApp as iu}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getAuth as ru,onAuthStateChanged as su,signInAnonymously as ou}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import{getFirestore as lu,collection as at,query as Rt,where as xn,orderBy as sa,getDocs as gt,doc as oe,getDoc as Re,limit as cu,serverTimestamp as xt,writeBatch as Nn,updateDoc as $n,increment as Ke,setDoc as Sn,Timestamp as Ur,addDoc as du,deleteDoc as uu}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();const _e={sidebar:document.getElementById("sidebar"),sidebarBackdrop:document.getElementById("sidebar-backdrop"),menuBtn:document.getElementById("menu-btn"),navLinks:document.getElementById("nav-links"),mainContentSections:document.querySelectorAll("main section"),connectButtonDesktop:document.getElementById("connectButtonDesktop"),connectButtonMobile:document.getElementById("connectButtonMobile"),mobileAppDisplay:document.getElementById("mobileAppDisplay"),desktopDisconnected:document.getElementById("desktopDisconnected"),desktopConnectedInfo:document.getElementById("desktopConnectedInfo"),desktopUserAddress:document.getElementById("desktopUserAddress"),desktopUserBalance:document.getElementById("desktopUserBalance"),modalContainer:document.getElementById("modal-container"),toastContainer:document.getElementById("toast-container"),dashboard:document.getElementById("dashboard"),earn:document.getElementById("mine"),store:document.getElementById("store"),rental:document.getElementById("rental"),rewards:document.getElementById("rewards"),actions:document.getElementById("actions"),presale:document.getElementById("presale"),faucet:document.getElementById("faucet"),airdrop:document.getElementById("airdrop"),dao:document.getElementById("dao"),about:document.getElementById("about"),admin:document.getElementById("admin"),tokenomics:document.getElementById("tokenomics"),notary:document.getElementById("notary"),statTotalSupply:document.getElementById("statTotalSupply"),statValidators:document.getElementById("statValidators"),statTotalPStake:document.getElementById("statTotalPStake"),statScarcity:document.getElementById("statScarcity"),statLockedPercentage:document.getElementById("statLockedPercentage"),statUserBalance:document.getElementById("statUserBalance"),statUserPStake:document.getElementById("statUserPStake"),statUserRewards:document.getElementById("statUserRewards")},pu={provider:null,publicProvider:null,web3Provider:null,signer:null,userAddress:null,isConnected:!1,bkcTokenContract:null,delegationManagerContract:null,rewardBoosterContract:null,nftLiquidityPoolContract:null,actionsManagerContract:null,fortunePoolContract:null,faucetContract:null,decentralizedNotaryContract:null,ecosystemManagerContract:null,publicSaleContract:null,rentalManagerContract:null,bkcTokenContractPublic:null,delegationManagerContractPublic:null,faucetContractPublic:null,fortunePoolContractPublic:null,rentalManagerContractPublic:null,ecosystemManagerContractPublic:null,actionsManagerContractPublic:null,currentUserBalance:0n,currentUserNativeBalance:0n,userTotalPStake:0n,userDelegations:[],myBoosters:[],activityHistory:[],totalNetworkPStake:0n,allValidatorsData:[],systemFees:{},systemPStakes:{},boosterDiscounts:{},notaryFee:void 0,notaryMinPStake:void 0},mu={set(e,t,a){const n=e[t];if(e[t]=a,["currentUserBalance","isConnected","userTotalPStake","totalNetworkPStake"].includes(t)){if(n===a)return!0;window.updateUIState&&window.updateUIState()}return!0}},d=new Proxy(pu,mu);let jr=!1;const h=(e,t="info",a=null)=>{if(!_e.toastContainer)return;const n={success:{icon:"fa-check-circle",color:"bg-green-600",border:"border-green-400"},error:{icon:"fa-exclamation-triangle",color:"bg-red-600",border:"border-red-400"},info:{icon:"fa-info-circle",color:"bg-blue-600",border:"border-blue-400"},warning:{icon:"fa-exclamation-circle",color:"bg-yellow-600",border:"border-yellow-400"}},i=n[t]||n.info,r=document.createElement("div");r.className=`flex items-center w-full max-w-xs p-4 text-white rounded-lg shadow-lg transition-all duration-500 ease-out 
                       transform translate-x-full opacity-0 
                       ${i.color} border-l-4 ${i.border} mb-3`;let s=`
        <div class="flex items-center flex-1">
            <i class="fa-solid ${i.icon} text-xl mr-3"></i>
            <div class="text-sm font-medium leading-tight">${e}</div>
        </div>
    `;if(a){const o=`https://sepolia.arbiscan.io/tx/${a}`;s+=`<a href="${o}" target="_blank" title="View on Arbiscan" class="ml-3 flex-shrink-0 text-white/80 hover:text-white transition-colors">
                        <i class="fa-solid fa-arrow-up-right-from-square text-sm"></i>
                      </a>`}s+=`<button class="ml-3 text-white/80 hover:text-white transition-colors focus:outline-none" onclick="this.closest('.shadow-lg').remove()">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>`,r.innerHTML=s,_e.toastContainer.appendChild(r),requestAnimationFrame(()=>{r.classList.remove("translate-x-full","opacity-0"),r.classList.add("translate-x-0","opacity-100")}),setTimeout(()=>{r.classList.remove("translate-x-0","opacity-100"),r.classList.add("translate-x-full","opacity-0"),setTimeout(()=>r.remove(),500)},5e3)},Ie=()=>{if(!_e.modalContainer)return;const e=document.getElementById("modal-backdrop");if(e){const t=document.getElementById("modal-content");t&&(t.classList.remove("animate-fade-in-up"),t.classList.add("animate-fade-out-down")),e.classList.remove("opacity-100"),e.classList.add("opacity-0"),setTimeout(()=>{_e.modalContainer.innerHTML=""},300)}},Na=(e,t="max-w-md",a=!0)=>{var r,s;if(!_e.modalContainer)return;const i=`
        <div id="modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 transition-opacity duration-300 opacity-0">
            <div id="modal-content" class="bg-zinc-900 border border-zinc-700 rounded-2xl p-6 w-full ${t} shadow-2xl animate-fade-in-up max-h-[90vh] overflow-y-auto relative">
                <button class="closeModalBtn absolute top-4 right-4 text-zinc-500 hover:text-white text-xl transition-colors focus:outline-none"><i class="fa-solid fa-xmark"></i></button>
                ${e}
            </div>
        </div>
        <style>@keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }@keyframes fade-out-down { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }.animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }.animate-fade-out-down { animation: fade-out-down 0.3s ease-in forwards; }.pulse-gold { animation: pulse-gold 2s infinite; }@keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); } 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); } }@keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }.animate-glow { animation: glow 2s ease-in-out infinite; }@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }.animate-float { animation: float 3s ease-in-out infinite; }@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }.animate-shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }</style>
    `;_e.modalContainer.innerHTML=i,requestAnimationFrame(()=>{const o=document.getElementById("modal-backdrop");o&&o.classList.remove("opacity-0"),o&&o.classList.add("opacity-100")}),(r=document.getElementById("modal-backdrop"))==null||r.addEventListener("click",o=>{a&&o.target.id==="modal-backdrop"&&Ie()}),(s=document.getElementById("modal-content"))==null||s.querySelectorAll(".closeModalBtn").forEach(o=>{o.addEventListener("click",Ie)})};async function fu(e,t){if(!window.ethereum){h("MetaMask not detected","error");return}try{await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:"0xf2EA307686267dC674859da28C58CBb7a5866BCf",tokenId:e.toString()}}})?h(`${t} NFT #${e} added to wallet!`,"success"):h("NFT not added to wallet","info")}catch(a){console.error("Error adding NFT to wallet:",a),h("Failed to add NFT to wallet","error")}}function bu(){const e=window.location.origin,t=encodeURIComponent("Check out Backcoin - The Unstoppable DeFi Protocol on Arbitrum! Build your own business. Be Your Own CEO. ðŸš€ #Backcoin #DeFi #Arbitrum #BeYourOwnCEO"),a=`
        <div class="text-center py-2">
            <div class="mb-4">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-full mb-3">
                    <i class="fa-solid fa-share-nodes text-3xl text-amber-400"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">Spread the Word</h2>
                <p class="text-zinc-400 text-sm">Help us grow the unstoppable community!</p>
            </div>

            <!-- Social Share Grid -->
            <div class="grid grid-cols-4 gap-3 mb-5">
                <a href="https://twitter.com/intent/tweet?text=${t}&url=${encodeURIComponent(e)}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-sky-600 border border-zinc-700 hover:border-sky-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-x-twitter text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">Twitter</span>
                </a>
                <a href="https://t.me/share/url?url=${encodeURIComponent(e)}&text=${t}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-blue-600 border border-zinc-700 hover:border-blue-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-telegram text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">Telegram</span>
                </a>
                <a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(e)}&title=Backcoin%20Protocol&summary=${t}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-blue-700 border border-zinc-700 hover:border-blue-600 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-linkedin-in text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">LinkedIn</span>
                </a>
                <a href="https://wa.me/?text=${t}%20${encodeURIComponent(e)}" target="_blank" class="flex flex-col items-center justify-center bg-zinc-800 hover:bg-green-600 border border-zinc-700 hover:border-green-500 rounded-xl p-3 transition-all duration-300 group">
                    <i class="fa-brands fa-whatsapp text-xl text-zinc-400 group-hover:text-white transition-colors mb-1"></i>
                    <span class="text-[10px] text-zinc-500 group-hover:text-white">WhatsApp</span>
                </a>
            </div>

            <!-- Copy Link Section -->
            <div class="flex items-center gap-2 bg-zinc-800/70 border border-zinc-700 rounded-xl p-2">
                <div class="flex-1 px-3 py-2 bg-black/30 rounded-lg overflow-hidden">
                    <p id="share-url-text" class="text-xs font-mono text-zinc-400 truncate">${e}</p>
                </div>
                <button id="copy-link-btn" onclick="navigator.clipboard.writeText('${e}').then(() => { 
                            document.getElementById('copy-link-btn').innerHTML = '<i class=\\'fa-solid fa-check\\'></i>'; 
                            document.getElementById('copy-link-btn').classList.add('bg-green-600', 'border-green-500');
                            document.getElementById('copy-link-btn').classList.remove('bg-amber-600', 'border-amber-500', 'hover:bg-amber-500');
                            setTimeout(() => { 
                                document.getElementById('copy-link-btn').innerHTML = '<i class=\\'fa-solid fa-copy\\'></i>'; 
                                document.getElementById('copy-link-btn').classList.remove('bg-green-600', 'border-green-500');
                                document.getElementById('copy-link-btn').classList.add('bg-amber-600', 'border-amber-500', 'hover:bg-amber-500');
                            }, 2000); 
                        })" 
                        class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-amber-600 hover:bg-amber-500 border border-amber-500 rounded-lg text-white transition-all duration-300">
                    <i class="fa-solid fa-copy"></i>
                </button>
            </div>

            <!-- Footer -->
            <p class="mt-4 text-[11px] text-zinc-600">
                <i class="fa-solid fa-heart text-red-500 mr-1"></i>
                Thank you for supporting Backcoin!
            </p>
        </div>
    `;Na(a,"max-w-md")}const Wr=e=>{window.navigateTo?window.navigateTo(e):console.error("navigateTo function not found."),Ie()};function gu(){var i,r,s,o,l,c;if(jr)return;jr=!0;const e="https://t.me/BackCoinorg",t="https://github.com/backcoin-org/backchain-dapp";Na(`
        <div class="text-center pt-2 pb-4">
            
            <!-- Voltaire Quote Banner -->
            <div class="relative bg-gradient-to-r from-zinc-800/80 via-zinc-900 to-zinc-800/80 border border-zinc-700/50 rounded-xl p-3 mb-5 overflow-hidden">
                <div class="absolute inset-0 animate-shimmer"></div>
                <p class="text-[11px] text-zinc-400 italic relative z-10">
                    "I may not agree with what you say, but I will defend to the death your right to say it."
                </p>
                <p class="text-[10px] text-amber-500/80 font-semibold mt-1 relative z-10">â€” Voltaire</p>
            </div>

            <!-- Network Badge -->
            <div class="inline-flex items-center gap-2 bg-zinc-800 border border-zinc-700 rounded-full px-4 py-1.5 mb-5 shadow-sm">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                </span>
                <span class="text-xs font-mono text-zinc-400 uppercase tracking-wider">NETWORK: <span class="text-emerald-400 font-bold">ARBITRUM SEPOLIA</span></span>
            </div>

            <!-- Logo with Glow -->
            <div class="mb-4 relative inline-block animate-float">
                <div class="absolute inset-0 bg-amber-500/30 rounded-full blur-2xl animate-glow"></div>
                <img src="/assets/bkc_logo_3d.png" alt="Backcoin Logo" class="h-24 w-24 mx-auto rounded-full relative z-10 shadow-2xl ring-2 ring-amber-500/30">
            </div>
            
            <!-- Title -->
            <h2 class="text-3xl font-black text-white mb-1 uppercase tracking-wide">
                Backchain Protocol
            </h2>
            
            <!-- Unstoppable Badge -->
            <div class="inline-flex items-center gap-2 bg-gradient-to-r from-red-600/20 via-amber-600/20 to-red-600/20 border border-amber-500/30 rounded-full px-4 py-1.5 mb-4">
                <i class="fa-solid fa-shield-halved text-amber-400 text-sm"></i>
                <span class="text-[11px] font-black text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-400 uppercase tracking-wider">UNSTOPPABLE â€¢ PERMISSIONLESS â€¢ IMMUTABLE</span>
            </div>

            <!-- Main Description -->
            <p class="text-zinc-300 mb-4 text-sm leading-relaxed px-2">
                DeFi infrastructure that <strong class="text-amber-400">no one can stop</strong>. 
                No admin keys. No pause functions. No blacklists.
            </p>

            <!-- CEO Box -->
            <div class="bg-gradient-to-br from-amber-600/10 via-zinc-800/50 to-orange-600/10 border border-amber-500/20 rounded-xl p-4 mb-5">
                <div class="flex items-center justify-center gap-2 mb-2">
                    <i class="fa-solid fa-crown text-amber-400"></i>
                    <span class="text-base font-black text-white uppercase tracking-wide">Be Your Own CEO</span>
                </div>
                <p class="text-xs text-zinc-400 leading-relaxed mb-3">
                    Build an interface to Backchain and <strong class="text-amber-400">earn commissions</strong> from every transaction. 
                    No permission needed. No registration. <strong class="text-white">You are the CEO.</strong>
                </p>
                <div class="grid grid-cols-3 gap-2 text-center">
                    <div class="bg-black/30 rounded-lg p-2">
                        <i class="fa-solid fa-code text-purple-400 text-lg mb-1"></i>
                        <p class="text-[10px] text-zinc-500">Build</p>
                    </div>
                    <div class="bg-black/30 rounded-lg p-2">
                        <i class="fa-solid fa-users text-blue-400 text-lg mb-1"></i>
                        <p class="text-[10px] text-zinc-500">Attract Users</p>
                    </div>
                    <div class="bg-black/30 rounded-lg p-2">
                        <i class="fa-solid fa-coins text-amber-400 text-lg mb-1"></i>
                        <p class="text-[10px] text-zinc-500">Earn BKC+ETH</p>
                    </div>
                </div>
            </div>

            <!-- Community Badge -->
            <div class="inline-flex items-center gap-2 bg-zinc-800/70 border border-zinc-700 rounded-full px-4 py-2 mb-5">
                <i class="fa-solid fa-users text-zinc-500"></i>
                <span class="text-[10px] font-semibold text-zinc-500 uppercase tracking-wider">100% Community â€¢ 0% VCs â€¢ 0% Team Allocation</span>
            </div>

            <div class="flex flex-col gap-3">
                
                <!-- Airdrop Button (Principal) -->
                <button id="btnAirdrop" class="group relative w-full bg-gradient-to-r from-amber-600 via-orange-500 to-amber-600 bg-[length:200%_auto] hover:bg-right transition-all duration-500 text-white font-black py-4 px-5 rounded-xl text-lg shadow-xl shadow-amber-500/20 pulse-gold border border-amber-400/50 flex items-center justify-center gap-3 overflow-hidden transform hover:scale-[1.02]">
                    <div class="absolute inset-0 bg-white/10 group-hover:bg-transparent transition-colors"></div>
                    <i class="fa-solid fa-gift text-2xl"></i> 
                    <div class="flex flex-col items-start leading-none z-10">
                        <span class="text-[10px] font-bold opacity-80 uppercase tracking-wider mb-0.5">Phase 1 Active</span>
                        <span class="text-lg">CLAIM FREE AIRDROP</span>
                    </div>
                    <div class="ml-auto flex items-center gap-1 bg-black/20 px-2 py-1 rounded-lg">
                        <span class="text-xs font-bold">7M BKC</span>
                    </div>
                </button>

                <!-- Two columns: Explore & Be CEO -->
                <div class="grid grid-cols-2 gap-3">
                    <!-- Explore dApp Button -->
                    <button id="btnExplore" class="bg-zinc-800 hover:bg-zinc-700 border border-zinc-600 hover:border-emerald-500 text-white font-bold py-3 px-4 rounded-xl text-sm transition-all duration-300 flex items-center justify-center gap-2 group">
                        <i class="fa-solid fa-compass text-emerald-400 group-hover:rotate-12 transition-transform"></i>
                        <span>Explore dApp</span>
                    </button>

                    <!-- Be a CEO Button -->
                    <button id="btnCEO" class="bg-zinc-800 hover:bg-zinc-700 border border-zinc-600 hover:border-amber-500 text-white font-bold py-3 px-4 rounded-xl text-sm transition-all duration-300 flex items-center justify-center gap-2 group">
                        <i class="fa-solid fa-crown text-amber-400 group-hover:scale-110 transition-transform"></i>
                        <span>Be a CEO</span>
                    </button>
                </div>

                <!-- Two columns: Docs & Telegram -->
                <div class="grid grid-cols-2 gap-3">
                    <!-- Docs Button -->
                    <button id="btnDocs" class="bg-zinc-800/70 hover:bg-zinc-700 border border-zinc-700 hover:border-purple-500 text-white font-semibold py-3 px-4 rounded-xl text-sm transition-all duration-300 flex items-center justify-center gap-2 group">
                        <i class="fa-solid fa-book text-purple-400 group-hover:scale-110 transition-transform"></i>
                        <span>Docs</span>
                    </button>

                    <!-- Telegram Button -->
                    <button id="btnTelegram" class="bg-zinc-800/70 hover:bg-zinc-700 border border-zinc-700 hover:border-blue-500 text-white font-semibold py-3 px-4 rounded-xl text-sm transition-all duration-300 flex items-center justify-center gap-2 group">
                        <i class="fa-brands fa-telegram text-blue-400 group-hover:scale-110 transition-transform"></i>
                        <span>Telegram</span>
                    </button>
                </div>

                <!-- Community Button -->
                <button id="btnSocials" class="w-full bg-zinc-800/50 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 text-white font-semibold py-3 px-4 rounded-xl text-sm transition-all duration-300 flex items-center justify-center gap-2 group">
                    <i class="fa-solid fa-share-nodes text-zinc-400 group-hover:text-amber-400 group-hover:scale-110 transition-all"></i>
                    <span>Community & Socials</span>
                </button>
            </div>
            
            <!-- Footer with Unstoppable Message -->
            <div class="mt-5 pt-4 border-t border-zinc-800">
                <div class="flex items-center justify-center gap-2 mb-2">
                    <div class="h-px flex-1 bg-gradient-to-r from-transparent to-amber-500/30"></div>
                    <i class="fa-solid fa-infinity text-amber-500/50 text-xs"></i>
                    <div class="h-px flex-1 bg-gradient-to-l from-transparent to-amber-500/30"></div>
                </div>
                <p class="text-[10px] text-zinc-600 uppercase tracking-widest mb-1">
                    No one can freeze it â€¢ No one can censor it â€¢ No one can stop it
                </p>
                <p class="text-[9px] text-zinc-700 font-mono">
                    THE PROTOCOL IS UNSTOPPABLE
                </p>
            </div>
        </div>
    `,"max-w-sm",!1);const n=document.getElementById("modal-content");n&&((i=n.querySelector("#btnAirdrop"))==null||i.addEventListener("click",()=>{Wr("airdrop")}),(r=n.querySelector("#btnExplore"))==null||r.addEventListener("click",()=>{Ie()}),(s=n.querySelector("#btnCEO"))==null||s.addEventListener("click",()=>{window.open(t+"/blob/main/docs/BE_YOUR_OWN_CEO.md","_blank")}),(o=n.querySelector("#btnDocs"))==null||o.addEventListener("click",()=>{window.open(t,"_blank")}),(l=n.querySelector("#btnSocials"))==null||l.addEventListener("click",()=>{Wr("socials")}),(c=n.querySelector("#btnTelegram"))==null||c.addEventListener("click",()=>{window.open(e,"_blank")}))}const xu=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1";console.log(`Environment: ${xu?"DEVELOPMENT":"PRODUCTION"}`);const Ui="ZWla0YY4A0Hw7e_rwyOXB",Ae={chainId:"0x66eee",chainIdDecimal:421614,chainName:"Arbitrum Sepolia",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.arbiscan.io"],rpcUrls:[`https://arb-sepolia.g.alchemy.com/v2/${Ui}`,"https://arbitrum-sepolia.blockpi.network/v1/rpc/public","https://arbitrum-sepolia-rpc.publicnode.com"]},It=[{name:"Alchemy",url:`https://arb-sepolia.g.alchemy.com/v2/${Ui}`,priority:1,isPublic:!1,corsCompatible:!0},{name:"BlockPI",url:"https://arbitrum-sepolia.blockpi.network/v1/rpc/public",priority:2,isPublic:!0,corsCompatible:!0},{name:"PublicNode",url:"https://arbitrum-sepolia-rpc.publicnode.com",priority:3,isPublic:!0,corsCompatible:!0},{name:"Arbitrum Official",url:"https://sepolia-rollup.arbitrum.io/rpc",priority:4,isPublic:!0,corsCompatible:!1}].filter(e=>e.url!==null),qs=`https://arb-sepolia.g.alchemy.com/v2/${Ui}`;let Ge=0,$a=new Map;function Sa(){var e;return((e=It[Ge])==null?void 0:e.url)||qs}function Xs(){const e=Ge;do{Ge=(Ge+1)%It.length;const a=It[Ge];if(!a.corsCompatible){console.warn(`â­ï¸ Skipping ${a.name} (CORS incompatible)`);continue}if(Ge===e)return console.warn("âš ï¸ All RPCs have been tried. Resetting to primary."),Ge=0,It[0].url}while($a.get(It[Ge].url)==="unhealthy");const t=It[Ge];return console.log(`ðŸ”„ Switched to RPC: ${t.name}`),t.url}function hu(e){$a.set(e,"unhealthy"),console.warn(`âŒ RPC marked unhealthy: ${e}`),setTimeout(()=>{$a.delete(e),console.log(`â™»ï¸ RPC health reset: ${e}`)},6e4)}function vu(e){$a.set(e,"healthy")}function wu(){Ge=0,$a.clear(),console.log(`âœ… Reset to primary RPC: ${It[0].name}`)}const yu="https://white-defensive-eel-240.mypinata.cloud/ipfs/",yi=["https://dweb.link/ipfs/","https://w3s.link/ipfs/","https://nftstorage.link/ipfs/","https://cloudflare-ipfs.com/ipfs/","https://ipfs.io/ipfs/"],w={},L={bkcToken:null,ecosystemManager:null,delegationManager:null,rewardBoosterNFT:null,rentalManager:null,nftLiquidityPoolFactory:null,fortunePool:null,fortunePoolV2:null,backchainRandomness:null,publicSale:null,decentralizedNotary:null,faucet:null,miningManager:null,charityPool:null,backchat:null,operator:null};async function ku(){try{const e=await fetch(`./deployment-addresses.json?t=${Date.now()}`);if(!e.ok)throw new Error(`Failed to fetch deployment-addresses.json: ${e.status}`);const t=await e.json(),n=["bkcToken","delegationManager","ecosystemManager","miningManager"].filter(i=>!t[i]);if(n.length>0)throw new Error(`Missing required addresses: ${n.join(", ")}`);return Object.assign(w,t),w.fortunePoolV2=t.fortunePoolV2||t.fortunePool,w.fortunePool=t.fortunePool,w.actionsManager=t.fortunePool,w.rentalManager=t.rentalManager||t.RentalManager||t.rental_manager||null,w.decentralizedNotary=t.decentralizedNotary||t.notary||t.Notary||null,w.bkcDexPoolAddress=t.bkcDexPoolAddress||"#",w.backchainRandomness=t.backchainRandomness||null,w.charityPool=t.charityPool||t.CharityPool||null,w.backchat=t.backchat||t.Backchat||null,w.operator=t.operator||t.treasuryWallet||null,Object.assign(L,t),console.log("âœ… Contract addresses loaded"),console.log("   FortunePool V2:",w.fortunePoolV2),console.log("   CharityPool:",w.charityPool),console.log("   Backchat:",w.backchat),console.log("   Operator:",w.operator),!0}catch(e){return console.error("âŒ Failed to load contract addresses:",e),!1}}const he=[{name:"Diamond",boostBips:5e3,burnRate:0,keepRate:100,color:"text-cyan-400",emoji:"ðŸ’Ž",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq",borderColor:"border-cyan-400/50",glowColor:"bg-cyan-500/10",bgGradient:"from-cyan-500/20 to-blue-500/20"},{name:"Gold",boostBips:4e3,burnRate:10,keepRate:90,color:"text-amber-400",emoji:"ðŸ¥‡",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44",borderColor:"border-amber-400/50",glowColor:"bg-amber-500/10",bgGradient:"from-amber-500/20 to-yellow-500/20"},{name:"Silver",boostBips:2500,burnRate:25,keepRate:75,color:"text-gray-300",emoji:"ðŸ¥ˆ",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4",borderColor:"border-gray-400/50",glowColor:"bg-gray-500/10",bgGradient:"from-gray-400/20 to-zinc-500/20"},{name:"Bronze",boostBips:1e3,burnRate:40,keepRate:60,color:"text-yellow-600",emoji:"ðŸ¥‰",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m",borderColor:"border-yellow-600/50",glowColor:"bg-yellow-600/10",bgGradient:"from-yellow-600/20 to-orange-600/20"}];function Eu(e){const t=[...he].sort((a,n)=>n.boostBips-a.boostBips);for(const a of t)if(e>=a.boostBips)return a;return null}function Tu(e){return e>=5e3?0:e>=4e3?10:e>=2500?25:e>=1e3?40:50}function ht(e){return 100-Tu(e)}const ji=["function name() view returns (string)","function symbol() view returns (string)","function decimals() view returns (uint8)","function totalSupply() view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)","function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function transferFrom(address from, address to, uint256 amount) returns (bool)","function MAX_SUPPLY() view returns (uint256)","function TGE_SUPPLY() view returns (uint256)","function remainingMintableSupply() view returns (uint256)","event Transfer(address indexed from, address indexed to, uint256 value)","event Approval(address indexed owner, address indexed spender, uint256 value)"],Wi=["function totalNetworkPStake() view returns (uint256)","function userTotalPStake(address _user) view returns (uint256)","function pendingRewards(address _user) view returns (uint256)","function MIN_LOCK_DURATION() view returns (uint256)","function MAX_LOCK_DURATION() view returns (uint256)","function getDelegationsOf(address _user) view returns (tuple(uint256 amount, uint64 unlockTime, uint64 lockDuration)[])","function delegate(uint256 _amount, uint256 _lockDuration, address _operator) external","function unstake(uint256 _delegationIndex, address _operator) external","function forceUnstake(uint256 _delegationIndex, address _operator) external","function claimReward(address _operator) external payable","function claimEthFee() view returns (uint256)","function getUserBestBoost(address _user) view returns (uint256)","function getBurnRateForBoost(uint256 _boost) view returns (uint256)","function previewClaim(address _user) view returns (uint256 totalRewards, uint256 burnAmount, uint256 userReceives, uint256 burnRateBips, uint256 userBoost)","event Delegated(address indexed user, address indexed operator, uint256 amount, uint256 lockDuration, uint256 pStake)","event Unstaked(address indexed user, address indexed operator, uint256 amount, uint256 pStakeReduced)","event ForceUnstaked(address indexed user, address indexed operator, uint256 amount, uint256 penaltyAmount)","event RewardClaimed(address indexed user, address indexed operator, uint256 grossAmount, uint256 burnedAmount, uint256 userReceived, uint256 boostUsed)"],Cu=["function balanceOf(address owner) view returns (uint256)","function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)","function ownerOf(uint256 tokenId) view returns (address)","function approve(address to, uint256 tokenId)","function setApprovalForAll(address operator, bool approved)","function safeTransferFrom(address from, address to, uint256 tokenId)","function boostBips(uint256 _tokenId) view returns (uint256)","function tokenURI(uint256 tokenId) view returns (string)","function totalSupply() view returns (uint256)","event Transfer(address indexed from, address indexed to, uint256 indexed tokenId)","event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId)"],ja=["function listNFT(uint256 _tokenId, uint256 _pricePerHour, uint256 _minHours, uint256 _maxHours) external","function updateListing(uint256 _tokenId, uint256 _newPricePerHour, uint256 _newMinHours, uint256 _newMaxHours) external","function withdrawNFT(uint256 _tokenId) external","function rentNFT(uint256 _tokenId, uint256 _hours) external","function getListing(uint256 _tokenId) view returns (tuple(address owner, uint256 pricePerHour, uint256 minHours, uint256 maxHours, bool isActive, uint256 totalEarnings, uint256 rentalCount))","function getRental(uint256 _tokenId) view returns (tuple(address tenant, uint256 startTime, uint256 endTime, uint256 paidAmount))","function isRented(uint256 _tokenId) view returns (bool)","function hasRentalRights(uint256 _tokenId, address _user) view returns (bool)","function getRemainingRentalTime(uint256 _tokenId) view returns (uint256)","function getAllListedTokenIds() view returns (uint256[])","function getListingCount() view returns (uint256)","function getRentalCost(uint256 _tokenId, uint256 _hours) view returns (uint256 totalCost, uint256 protocolFee, uint256 ownerPayout)","function getMarketplaceStats() view returns (uint256 activeListings, uint256 totalVol, uint256 totalFees, uint256 rentals)","event NFTListed(uint256 indexed tokenId, address indexed owner, uint256 pricePerHour, uint256 minHours, uint256 maxHours)","event NFTRented(uint256 indexed tokenId, address indexed tenant, address indexed owner, uint256 hours_, uint256 totalCost, uint256 protocolFee, uint256 ownerPayout, uint256 endTime)","event NFTWithdrawn(uint256 indexed tokenId, address indexed owner)","event RentalExpired(uint256 indexed tokenId, address indexed tenant)"],Js=["function buyNFT(uint256 _maxPrice, address _operator) external payable returns (uint256 tokenId)","function buySpecificNFT(uint256 _tokenId, uint256 _maxPrice, address _operator) external payable","function buyNFTWithSlippage(uint256 _maxPrice, address _operator) external payable returns (uint256 tokenId)","function sellNFT(uint256 _tokenId, uint256 _minPayout, address _operator) external payable","function getBuyPrice() view returns (uint256)","function getBuyPriceWithTax() view returns (uint256)","function getSellPrice() view returns (uint256)","function getSellPriceAfterTax() view returns (uint256)","function getTotalBuyCost() view returns (uint256 bkcCost, uint256 ethCost)","function getTotalSellInfo() view returns (uint256 bkcPayout, uint256 ethCost)","function getSpread() view returns (uint256 spread, uint256 spreadBips)","function getPoolInfo() view returns (uint256 bkcBalance, uint256 nftCount, uint256 k, bool initialized)","function getAvailableNFTs() view returns (uint256[])","function getNFTBalance() view returns (uint256)","function getBKCBalance() view returns (uint256)","function isNFTInPool(uint256 _tokenId) view returns (bool)","function boostBips() view returns (uint256)","function getTierName() view returns (string)","function buyEthFee() view returns (uint256)","function sellEthFee() view returns (uint256)","function getEthFeeConfig() view returns (uint256 buyFee, uint256 sellFee, uint256 totalCollected)","function totalETHCollected() view returns (uint256)","function getTradingStats() view returns (uint256 volume, uint256 taxes, uint256 buys, uint256 sells)","function totalVolume() view returns (uint256)","function totalTaxesCollected() view returns (uint256)","function totalBuys() view returns (uint256)","function totalSells() view returns (uint256)","event NFTPurchased(address indexed buyer, uint256 indexed tokenId, uint256 price, uint256 tax, uint256 newBkcBalance, uint256 newNftCount, address operator)","event NFTSold(address indexed seller, uint256 indexed tokenId, uint256 payout, uint256 tax, uint256 newBkcBalance, uint256 newNftCount, address operator)"],Gi=["function participate(uint256 _wagerAmount, uint256[] calldata _guesses, bool _isCumulative) external payable","function oracleFee() view returns (uint256)","function gameFeeBips() view returns (uint256)","function getRequiredOracleFee(bool _isCumulative) view returns (uint256)","function activeTierCount() view returns (uint256)","function gameCounter() view returns (uint256)","function prizePoolBalance() view returns (uint256)","function getExpectedGuessCount(bool _isCumulative) view returns (uint256)","function isGameFulfilled(uint256 _gameId) view returns (bool)","function getGameResults(uint256 _gameId) view returns (uint256[])","function getJackpotTierId() view returns (uint256)","function getJackpotTier() view returns (uint256 tierId, uint128 maxRange, uint64 multiplierBips, bool active)","function getAllTiers() view returns (uint128[] ranges, uint64[] multipliers)","function prizeTiers(uint256 tierId) view returns (uint128 maxRange, uint64 multiplierBips, bool active)","function calculatePotentialWinnings(uint256 _wagerAmount, bool _isCumulative) view returns (uint256 maxPrize, uint256 netWager)","event GameRequested(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint256[] guesses, bool isCumulative, uint256 targetTier)","event GameFulfilled(uint256 indexed gameId, address indexed player, uint256 prizeWon, uint256[] rolls, uint256[] guesses, bool isCumulative)"],Ki=["function commitPlay(bytes32 _commitmentHash, uint256 _wagerAmount, bool _isCumulative, address _operator) external payable","function revealPlay(uint256 _gameId, uint256[] calldata _guesses, bytes32 _userSecret) external returns (uint256 prizeWon)","function generateCommitmentHash(uint256[] calldata _guesses, bytes32 _userSecret) external pure returns (bytes32 hash)","function claimExpiredGame(uint256 _gameId) external","function getCommitmentStatus(uint256 _gameId) view returns (uint8 status, bool canReveal, bool isExpired, uint256 blocksUntilReveal, uint256 blocksUntilExpiry)","function getCommitment(uint256 _gameId) view returns (address player, uint64 commitBlock, bool isCumulative, uint8 status, uint256 wagerAmount, uint256 ethPaid)","function commitmentMeta(uint256 _gameId) view returns (bytes32 hash, address operator, uint96 tierNonce)","function revealDelay() view returns (uint256)","function revealWindow() view returns (uint256)","function serviceFee() view returns (uint256)","function getRequiredServiceFee(bool _isCumulative) view returns (uint256)","function gameFeeBips() view returns (uint256)","function activeTierCount() view returns (uint256)","function prizeTiers(uint256 tierId) view returns (uint128 maxRange, uint64 multiplierBips, bool active)","function getTier(uint256 _tierId) view returns (uint256 maxRange, uint256 multiplierBips, bool active)","function getAllTiers() view returns (uint128[] ranges, uint64[] multipliers)","function getExpectedGuessCount(bool _isCumulative) view returns (uint256)","function calculatePotentialWinnings(uint256 _wagerAmount, bool _isCumulative) view returns (uint256 maxPrize, uint256 netWager)","function gameCounter() view returns (uint256)","function prizePoolBalance() view returns (uint256)","function getGameResult(uint256 _gameId) view returns (address player, uint256 wagerAmount, uint256 prizeWon, uint256[] guesses, uint256[] rolls, bool isCumulative, uint8 matchCount, uint256 timestamp)","function getPlayerStats(address _player) view returns (uint256 gamesPlayed, uint256 totalWagered, uint256 totalWon, int256 netProfit)","function getPoolStats() view returns (uint256 poolBalance, uint256 gamesPlayed, uint256 wageredAllTime, uint256 paidOutAllTime, uint256 winsAllTime, uint256 ethCollected, uint256 bkcFees, uint256 expiredGames)","function totalWageredAllTime() view returns (uint256)","function totalPaidOutAllTime() view returns (uint256)","function totalWinsAllTime() view returns (uint256)","function totalETHCollected() view returns (uint256)","function totalBKCFees() view returns (uint256)","function totalExpiredGames() view returns (uint256)","event GameCommitted(uint256 indexed gameId, address indexed player, uint256 wagerAmount, bool isCumulative, address operator)","event GameRevealed(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint256 prizeWon, bool isCumulative, uint8 matchCount, address operator)","event GameDetails(uint256 indexed gameId, uint256[] guesses, uint256[] rolls, bool[] matches)","event JackpotWon(uint256 indexed gameId, address indexed player, uint256 prizeAmount, uint256 tier)","event GameExpired(uint256 indexed gameId, address indexed player, uint256 forfeitedAmount)"],Iu=["function tiers(uint256 tierId) view returns (uint256 priceInWei, uint64 maxSupply, uint64 mintedCount, uint16 boostBips, bool isConfigured, bool isActive, string metadataFile, string name)","function buyNFT(uint256 _tierId) external payable","function buyMultipleNFTs(uint256 _tierId, uint256 _quantity) external payable","function getTierPrice(uint256 _tierId) view returns (uint256)","function getTierSupply(uint256 _tierId) view returns (uint64 maxSupply, uint64 mintedCount)","function isTierActive(uint256 _tierId) view returns (bool)","event NFTSold(address indexed buyer, uint256 indexed tierId, uint256 indexed tokenId, uint256 price)"],Au=["function balanceOf(address owner) view returns (uint256)","function tokenURI(uint256 tokenId) view returns (string)","function ownerOf(uint256 tokenId) view returns (address)","function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)","function totalSupply() view returns (uint256)","function getDocument(uint256 tokenId) view returns (tuple(string ipfsCid, string description, bytes32 contentHash, uint256 timestamp))","function documents(uint256 tokenId) view returns (string ipfsCid, string description, bytes32 contentHash, uint256 timestamp)","function bkcFee() view returns (uint256)","function ethFee() view returns (uint256)","function notarize(string _ipfsCid, string _description, bytes32 _contentHash, address _operator) external payable returns (uint256)","event DocumentNotarized(uint256 indexed tokenId, address indexed owner, address indexed operator, string ipfsCid, bytes32 contentHash, uint256 bkcFeePaid, uint256 ethFeePaid)"],Yi=["function canClaim(address _user) view returns (bool)","function getCooldownRemaining(address _user) view returns (uint256)","function getUserInfo(address _user) view returns (uint256 lastClaimTime, uint256 totalClaimed)","function getFaucetStatus() view returns (uint256 bkcBalance, uint256 ethBalance, bool isActive)","function COOLDOWN_PERIOD() view returns (uint256)","function TOKEN_AMOUNT() view returns (uint256)","function ETH_AMOUNT() view returns (uint256)","event TokensDistributed(address indexed recipient, uint256 tokenAmount, uint256 ethAmount, address indexed relayer)"],Vi=["function getServiceRequirements(bytes32 _serviceKey) view returns (uint256 fee, uint256 pStake)","function getFee(bytes32 _serviceKey) view returns (uint256)","function getBoosterDiscount(uint256 _boostBips) view returns (uint256)","function getMiningDistributionBips() view returns (uint256 stakingBips, uint256 minerBips, uint256 treasuryBips)","function getFeeDistributionBips() view returns (uint256 burnBips, uint256 treasuryBips, uint256 poolBips)","function getTreasuryAddress() view returns (address)","function getDelegationManagerAddress() view returns (address)","function getBKCTokenAddress() view returns (address)","function getBoosterAddress() view returns (address)","function getNFTLiquidityPoolFactoryAddress() view returns (address)","function getMiningManagerAddress() view returns (address)","function getFortunePoolAddress() view returns (address)","function getNotaryAddress() view returns (address)","function getRentalManagerAddress() view returns (address)","function getPublicSaleAddress() view returns (address)","function isInitialized() view returns (bool)","function owner() view returns (address)"],Zs=["function createProfile(string username, string displayName, string bio, address operator) external payable","function updateProfile(string displayName, string bio) external","function createPost(string content, string mediaCID, address operator) external payable returns (uint256 postId)","function createReply(uint256 parentId, string content, string mediaCID, address operator, uint256 tipBkc) external payable returns (uint256 postId)","function createRepost(uint256 originalPostId, address operator, uint256 tipBkc) external payable returns (uint256 postId)","function like(uint256 postId, address operator, uint256 tipBkc) external payable","function superLike(uint256 postId, address operator, uint256 tipBkc) external payable","function follow(address toFollow, address operator, uint256 tipBkc) external payable","function unfollow(address toUnfollow) external","function boostProfile(address operator) external payable","function obtainBadge(address operator) external payable","function setReferrer(address _referrer) external","function getReferralStats(address referrer) external view returns (uint256 totalReferred, uint256 totalEarned)","function referredBy(address user) external view returns (address)","function referralCount(address referrer) external view returns (uint256)","function referralEarnings(address referrer) external view returns (uint256)","function withdraw() external","function calculateFee(uint256 gasEstimate) view returns (uint256)","function getCurrentFees() view returns (uint256 postFee, uint256 replyFee, uint256 likeFee, uint256 followFee, uint256 repostFee, uint256 superLikeMin, uint256 boostMin, uint256 badgeFee_)","function getUsernameFee(uint256 length) pure returns (uint256)","function postCounter() view returns (uint256)","function postAuthor(uint256 postId) view returns (address)","function pendingEth(address user) view returns (uint256)","function usernameOwner(bytes32 usernameHash) view returns (address)","function hasLiked(uint256 postId, address user) view returns (bool)","function boostExpiry(address user) view returns (uint256)","function badgeExpiry(address user) view returns (uint256)","function isProfileBoosted(address user) view returns (bool)","function hasTrustBadge(address user) view returns (bool)","function hasUserLiked(uint256 postId, address user) view returns (bool)","function getPendingBalance(address user) view returns (uint256)","function isUsernameAvailable(string username) view returns (bool)","function getUsernameOwner(string username) view returns (address)","function version() pure returns (string)","function bkcToken() view returns (address)","function ecosystemManager() view returns (address)","event ProfileCreated(address indexed user, bytes32 indexed usernameHash, string username, string displayName, string bio, uint256 ethPaid, address indexed operator)","event ProfileUpdated(address indexed user, string displayName, string bio)","event PostCreated(uint256 indexed postId, address indexed author, string content, string mediaCID, address indexed operator)","event ReplyCreated(uint256 indexed postId, uint256 indexed parentId, address indexed author, string content, string mediaCID, uint256 tipBkc, address operator)","event RepostCreated(uint256 indexed newPostId, uint256 indexed originalPostId, address indexed reposter, uint256 tipBkc, address operator)","event Liked(uint256 indexed postId, address indexed user, uint256 tipBkc, address indexed operator)","event SuperLiked(uint256 indexed postId, address indexed user, uint256 ethAmount, uint256 tipBkc, address indexed operator)","event Followed(address indexed follower, address indexed followed, uint256 tipBkc, address indexed operator)","event Unfollowed(address indexed follower, address indexed followed)","event ProfileBoosted(address indexed user, uint256 amount, uint256 expiresAt, address indexed operator)","event BadgeObtained(address indexed user, uint256 expiresAt, address indexed operator)","event Withdrawal(address indexed user, uint256 amount)","event TipProcessed(address indexed from, address indexed creator, uint256 totalBkc, uint256 creatorShare, uint256 miningShare, address indexed operator)","event ReferrerSet(address indexed user, address indexed referrer)"];let Gr=0;const Bu=5e3;async function zu(){try{return window.ethereum?await window.ethereum.request({method:"eth_chainId"})===Ae.chainId:!1}catch(e){return console.warn("Network check failed:",e.message),!1}}async function Zt(){if(!window.ethereum)return console.warn("MetaMask not detected"),!1;try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:Ae.chainId,chainName:Ae.chainName,nativeCurrency:Ae.nativeCurrency,rpcUrls:Ae.rpcUrls,blockExplorerUrls:Ae.blockExplorerUrls}]}),console.log("âœ… MetaMask network config updated"),!0}catch(e){return e.code===4001?(console.log("User rejected network update"),!1):(console.warn("Could not update MetaMask network:",e.message),!1)}}async function Pu(){if(!window.ethereum)return console.warn("MetaMask not detected"),!1;try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:Ae.chainId}]}),console.log("âœ… Switched to Arbitrum Sepolia"),!0}catch(e){return e.code===4902?(console.log("ðŸ”„ Network not found, adding..."),await Zt()):e.code===4001?(console.log("User rejected network switch"),!1):(console.error("Network switch error:",e),!1)}}async function La(){var e;if(!window.ethereum)return{healthy:!1,reason:"no_provider"};try{const t=new window.ethers.BrowserProvider(window.ethereum),a=new Promise((i,r)=>setTimeout(()=>r(new Error("timeout")),5e3)),n=t.getBlockNumber();return await Promise.race([n,a]),{healthy:!0}}catch(t){const a=((e=t==null?void 0:t.message)==null?void 0:e.toLowerCase())||"";return a.includes("timeout")?{healthy:!1,reason:"timeout"}:a.includes("too many")||a.includes("rate limit")||a.includes("-32002")?{healthy:!1,reason:"rate_limited"}:a.includes("failed to fetch")||a.includes("network")?{healthy:!1,reason:"network_error"}:{healthy:!1,reason:"unknown",error:a}}}async function Nu(){const e=Date.now();if(e-Gr<Bu)return{success:!0,skipped:!0};if(Gr=e,!window.ethereum)return{success:!1,error:"MetaMask not detected"};try{if(!await zu()&&(console.log("ðŸ”„ Wrong network detected, switching..."),!await Pu()))return{success:!1,error:"Please switch to Arbitrum Sepolia network"};const a=await La();if(!a.healthy&&(console.log(`âš ï¸ RPC unhealthy (${a.reason}), updating MetaMask config...`),await Zt())){await new Promise(r=>setTimeout(r,1e3));const i=await La();return i.healthy?{success:!0,fixed:!0}:{success:!1,error:"Network is congested. Please try again in a moment.",rpcReason:i.reason}}return{success:!0}}catch(t){return console.error("Network config error:",t),{success:!1,error:t.message}}}function $u(e){window.ethereum&&window.ethereum.on("chainChanged",async t=>{console.log("ðŸ”„ Network changed to:",t);const a=t===Ae.chainId;e&&e({chainId:t,isCorrectNetwork:a,needsSwitch:!a})})}const Su=window.ethers,Lu=5e3,Ru=6e4,_u=15e3,Fu=3e4,Mu=3e4;let Jn=null,Kr=0;const Yr=new Map,Zn=new Map,Vr=new Map,qr=e=>new Promise(t=>setTimeout(t,e));async function Ln(e,t){const a=new AbortController,n=setTimeout(()=>a.abort(),t);try{const i=await fetch(e,{signal:a.signal});return clearTimeout(n),i}catch(i){throw clearTimeout(n),i.name==="AbortError"?new Error("API request timed out."):i}}const ze={getHistory:"https://gethistory-4wvdcuoouq-uc.a.run.app",getBoosters:"https://getboosters-4wvdcuoouq-uc.a.run.app",getSystemData:"https://getsystemdata-4wvdcuoouq-uc.a.run.app",getNotaryHistory:"https://getnotaryhistory-4wvdcuoouq-uc.a.run.app",getRentalListings:"https://getrentallistings-4wvdcuoouq-uc.a.run.app",getUserRentals:"https://getuserrentals-4wvdcuoouq-uc.a.run.app",fortuneGames:"https://getfortunegames-4wvdcuoouq-uc.a.run.app",uploadFileToIPFS:"/api/upload",claimAirdrop:"https://us-central1-airdropbackchainnew.cloudfunctions.net/claimAirdrop"};function Qs(e){var t;return((t=e==null?void 0:e.error)==null?void 0:t.code)===429||(e==null?void 0:e.code)===429||e.message&&(e.message.includes("429")||e.message.includes("Too Many Requests")||e.message.includes("rate limit"))}function eo(e){var a,n;const t=((a=e==null?void 0:e.error)==null?void 0:a.code)||(e==null?void 0:e.code);return t===-32603||t===-32e3||((n=e.message)==null?void 0:n.includes("Internal JSON-RPC"))}function Rn(e,t,a){if(a)return a;if(!e||!d.publicProvider)return null;try{return new Su.Contract(e,t,d.publicProvider)}catch{return null}}const ce=async(e,t,a=[],n=0n,i=2,r=!1)=>{if(!e)return n;const s=e.target||e.address,o=JSON.stringify(a,(f,p)=>typeof p=="bigint"?p.toString():p),l=`${s}-${t}-${o}`,c=Date.now(),u=["getPoolInfo","getBuyPrice","getSellPrice","getAvailableTokenIds","getAllListedTokenIds","tokenURI","boostBips","getListing","balanceOf","totalSupply","totalNetworkPStake","MAX_SUPPLY","TGE_SUPPLY","userTotalPStake","pendingRewards","isRented","getRental","ownerOf","getDelegationsOf","allowance","prizeTiers","activeTierCount","prizePoolBalance"];if(!r&&u.includes(t)){const f=Yr.get(l);if(f&&c-f.timestamp<_u)return f.value}for(let f=0;f<=i;f++)try{const p=await e[t](...a);return u.includes(t)&&Yr.set(l,{value:p,timestamp:c}),p}catch(p){if(Qs(p)&&f<i){const b=Math.floor(Math.random()*1e3),m=1e3*Math.pow(2,f)+b;await qr(m);continue}if(eo(p)&&f<i){await qr(500);continue}break}return n},Du=async(e,t,a=!1)=>{const n=`balance-${(e==null?void 0:e.target)||(e==null?void 0:e.address)}-${t}`,i=Date.now();if(!a){const s=Vr.get(n);if(s&&i-s.timestamp<Mu)return s.value}const r=await ce(e,"balanceOf",[t],0n,2,a);return Vr.set(n,{value:r,timestamp:i}),r};async function to(){d.systemFees||(d.systemFees={}),d.systemPStakes||(d.systemPStakes={}),d.boosterDiscounts||(d.boosterDiscounts={});const e=Date.now();if(Jn&&e-Kr<Ru)return Xr(Jn),!0;try{const t=await Ln(ze.getSystemData,Lu);if(!t.ok)throw new Error(`API Status: ${t.status}`);const a=await t.json();return Xr(a),Jn=a,Kr=e,!0}catch{return d.systemFees.NOTARY_SERVICE||(d.systemFees.NOTARY_SERVICE=100n),d.systemFees.CLAIM_REWARD_FEE_BIPS||(d.systemFees.CLAIM_REWARD_FEE_BIPS=500n),!1}}function Xr(e){if(e.fees)for(const t in e.fees)try{d.systemFees[t]=BigInt(e.fees[t])}catch{d.systemFees[t]=0n}if(e.pStakeRequirements)for(const t in e.pStakeRequirements)try{d.systemPStakes[t]=BigInt(e.pStakeRequirements[t])}catch{d.systemPStakes[t]=0n}if(e.discounts)for(const t in e.discounts)try{d.boosterDiscounts[t]=BigInt(e.discounts[t])}catch{d.boosterDiscounts[t]=0n}if(e.oracleFeeInWei){d.systemData=d.systemData||{};try{d.systemData.oracleFeeInWei=BigInt(e.oracleFeeInWei)}catch{d.systemData.oracleFeeInWei=0n}}}async function ao(){!d.publicProvider||!d.bkcTokenContractPublic||await Promise.allSettled([ce(d.bkcTokenContractPublic,"totalSupply",[],0n),to()])}async function Wa(e=!1){var t,a,n;if(!(!d.isConnected||!d.userAddress))try{const i=(a=(t=d.bkcTokenContractPublic)==null?void 0:t.runner)==null?void 0:a.provider,[r,s]=await Promise.allSettled([Du(d.bkcTokenContractPublic||d.bkcTokenContract,d.userAddress,e),(n=i||d.provider)==null?void 0:n.getBalance(d.userAddress)]);r.status==="fulfilled"&&(d.currentUserBalance=r.value),s.status==="fulfilled"&&(d.currentUserNativeBalance=s.value),await zt(e);const o=d.delegationManagerContractPublic||d.delegationManagerContract;if(o){const l=await ce(o,"userTotalPStake",[d.userAddress],0n,2,e);d.userTotalPStake=l}}catch(i){console.error("Error loading user data:",i)}}async function Ou(e=!1){if(!d.isConnected||!d.delegationManagerContract)return[];try{const t=await ce(d.delegationManagerContract,"getDelegationsOf",[d.userAddress],[],2,e);return d.userDelegations=t.map((a,n)=>({amount:a[0]||a.amount||0n,unlockTime:BigInt(a[1]||a.unlockTime||0),lockDuration:BigInt(a[2]||a.lockDuration||0),index:n})),d.userDelegations}catch(t){return console.error("Error loading delegations:",t),[]}}async function no(e=!1){let t=[];try{const n=await Ln(ze.getRentalListings,4e3);n.ok&&(t=await n.json())}catch{}if(t&&t.length>0){const n=t.map(i=>{var s,o,l,c,u;const r=he.find(f=>f.boostBips===Number(i.boostBips||0));return{...i,tokenId:((s=i.tokenId)==null?void 0:s.toString())||((o=i.id)==null?void 0:o.toString()),pricePerHour:((l=i.pricePerHour)==null?void 0:l.toString())||((c=i.price)==null?void 0:c.toString())||"0",totalEarnings:((u=i.totalEarnings)==null?void 0:u.toString())||"0",rentalCount:Number(i.rentalCount||0),img:(r==null?void 0:r.img)||"./assets/nft.png",name:(r==null?void 0:r.name)||"Booster NFT"}});return d.rentalListings=n,n}const a=Rn(w.rentalManager,ja,d.rentalManagerContractPublic);if(!a)return d.rentalListings=[],[];try{const n=await ce(a,"getAllListedTokenIds",[],[],2,!0);if(!n||n.length===0)return d.rentalListings=[],[];const r=n.slice(0,30).map(async l=>{var c,u,f,p,b,m;try{const x=await ce(a,"getListing",[l],null,1,!0);if(x&&x.isActive){const y=await ce(a,"getRental",[l],null,1,!0),C=await io(l),A=Math.floor(Date.now()/1e3),N=y&&BigInt(y.endTime||0)>BigInt(A);return{tokenId:l.toString(),owner:x.owner,pricePerHour:((c=x.pricePerHour)==null?void 0:c.toString())||((u=x.price)==null?void 0:u.toString())||"0",minHours:((f=x.minHours)==null?void 0:f.toString())||"1",maxHours:((p=x.maxHours)==null?void 0:p.toString())||"1",totalEarnings:((b=x.totalEarnings)==null?void 0:b.toString())||"0",rentalCount:Number(x.rentalCount||0),boostBips:C.boostBips,img:C.img||"./assets/nft.png",name:C.name,isRented:N,currentTenant:N?y.tenant:null,rentalEndTime:N?(m=y.endTime)==null?void 0:m.toString():null}}}catch{}return null}),o=(await Promise.all(r)).filter(l=>l!==null);return d.rentalListings=o,o}catch{return d.rentalListings=[],[]}}async function Hu(e=!1){var a,n,i,r;if(!d.userAddress)return d.myRentals=[],[];try{const s=await Ln(`${ze.getUserRentals}/${d.userAddress}`,4e3);if(s.ok){const l=(await s.json()).map(c=>{const u=he.find(f=>f.boostBips===Number(c.boostBips||0));return{...c,img:(u==null?void 0:u.img)||"./assets/nft.png",name:(u==null?void 0:u.name)||"Booster NFT"}});return d.myRentals=l,l}}catch{}const t=Rn(w.rentalManager,ja,d.rentalManagerContractPublic);if(!t)return d.myRentals=[],[];try{const s=await ce(t,"getAllListedTokenIds",[],[],2,e),o=[],l=Math.floor(Date.now()/1e3);for(const c of s.slice(0,30))try{const u=await ce(t,"getRental",[c],null,1,e);if(u&&((a=u.tenant)==null?void 0:a.toLowerCase())===d.userAddress.toLowerCase()&&BigInt(u.endTime||0)>BigInt(l)){const f=await io(c);o.push({tokenId:c.toString(),tenant:u.tenant,startTime:((n=u.startTime)==null?void 0:n.toString())||"0",endTime:((i=u.endTime)==null?void 0:i.toString())||"0",paidAmount:((r=u.paidAmount)==null?void 0:r.toString())||"0",boostBips:f.boostBips,img:f.img,name:f.name})}}catch{}return d.myRentals=o,o}catch{return d.myRentals=[],[]}}let nn=null,Jr=0;const Uu=3e4;async function Qt(e=!1){const t=Date.now();if(!e&&nn&&t-Jr<Uu)return nn;await zt(e);let a=0,n=null,i="none";if(d.myBoosters&&d.myBoosters.length>0){const l=d.myBoosters.reduce((c,u)=>u.boostBips>c.boostBips?u:c,d.myBoosters[0]);l.boostBips>a&&(a=l.boostBips,n=l.tokenId,i="owned")}if(d.myRentals&&d.myRentals.length>0){const l=d.myRentals.reduce((c,u)=>u.boostBips>c.boostBips?u:c,d.myRentals[0]);l.boostBips>a&&(a=l.boostBips,n=l.tokenId,i="rented")}const r=he.find(l=>l.boostBips===a),s=(r==null?void 0:r.image)||(r==null?void 0:r.realImg)||(r==null?void 0:r.img)||"assets/bkc_logo_3d.png",o=r!=null&&r.name?`${r.name} Booster`:i!=="none"?"Booster NFT":"None";return nn={highestBoost:a,boostName:o,imageUrl:s,tokenId:n?n.toString():null,source:i},Jr=Date.now(),nn}async function io(e){const t=["function boostBips(uint256) view returns (uint256)"],a=Rn(w.rewardBoosterNFT,t,d.rewardBoosterContractPublic);if(!a)return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"};try{const n=await ce(a,"boostBips",[e],0n),i=Number(n),r=he.find(s=>s.boostBips===i);return{boostBips:i,img:(r==null?void 0:r.img)||"./assets/nft.png",name:(r==null?void 0:r.name)||`Booster #${e}`}}catch{return{boostBips:0,img:"assets/bkc_logo_3d.png",name:"Unknown"}}}async function oa(){if(!d.isConnected||!d.delegationManagerContract)return{stakingRewards:0n,minerRewards:0n,totalRewards:0n};try{const e=await ce(d.delegationManagerContract,"pendingRewards",[d.userAddress],0n);return{stakingRewards:e,minerRewards:0n,totalRewards:e}}catch{return{stakingRewards:0n,minerRewards:0n,totalRewards:0n}}}async function ju(){var l,c;if(!d.delegationManagerContract||!d.userAddress)return{netClaimAmount:0n,feeAmount:0n,discountPercent:0,totalRewards:0n,baseFeeBips:0n,finalFeeBips:0n};const{totalRewards:e}=await oa();if(e===0n)return{netClaimAmount:0n,feeAmount:0n,discountPercent:0,totalRewards:0n,baseFeeBips:0n,finalFeeBips:0n};let t=((l=d.systemFees)==null?void 0:l.CLAIM_REWARD_FEE_BIPS)||100n;const a=await Qt(),n=BigInt(a.highestBoost||0);let i=((c=d.boosterDiscounts)==null?void 0:c[a.highestBoost])||n;const r=t*i/10000n,s=t>r?t-r:0n,o=e*s/10000n;return console.log("[Data] Claim calculation:",{totalRewards:Number(e)/1e18,baseFeeBips:Number(t),boostBips:Number(n),discountBips:Number(i),discountAmount:Number(r),finalFeeBips:Number(s),feeAmount:Number(o)/1e18,netAmount:Number(e-o)/1e18}),{netClaimAmount:e-o,feeAmount:o,discountPercent:Number(i)/100,totalRewards:e,baseFeeBips:Number(t),finalFeeBips:Number(s)}}let Qn=!1,ei=0,rn=0;const Wu=3e4,Gu=3,Ku=12e4;async function zt(e=!1){if(!d.userAddress)return[];const t=Date.now();if(Qn)return d.myBoosters||[];if(!e&&t-ei<Wu)return d.myBoosters||[];if(rn>=Gu){if(t-ei<Ku)return d.myBoosters||[];rn=0}Qn=!0,ei=t;try{const a=await Ln(`${ze.getBoosters}/${d.userAddress}`,5e3);if(!a.ok)throw new Error(`API Error: ${a.status}`);let n=await a.json();const i=["function ownerOf(uint256) view returns (address)","function boostBips(uint256) view returns (uint256)"],r=Rn(w.rewardBoosterNFT,i,d.rewardBoosterContractPublic);if(r&&n.length>0){const s=await Promise.all(n.slice(0,50).map(async o=>{const l=BigInt(o.tokenId),c=`ownerOf-${l}`,u=Date.now();let f=Number(o.boostBips||o.boost||0);if(f===0)try{const p=await r.boostBips(l);f=Number(p)}catch{}if(!e&&Zn.has(c)){const p=Zn.get(c);if(u-p.timestamp<Fu)return p.owner.toLowerCase()===d.userAddress.toLowerCase()?{tokenId:l,boostBips:f,imageUrl:o.imageUrl||o.image||null}:null}try{const p=await r.ownerOf(l);return Zn.set(c,{owner:p,timestamp:u}),p.toLowerCase()===d.userAddress.toLowerCase()?{tokenId:l,boostBips:f,imageUrl:o.imageUrl||o.image||null}:null}catch(p){return Qs(p)||eo(p)?{tokenId:l,boostBips:f,imageUrl:o.imageUrl||o.image||null}:null}}));d.myBoosters=s.filter(o=>o!==null)}else d.myBoosters=n.map(s=>({tokenId:BigInt(s.tokenId),boostBips:Number(s.boostBips||s.boost||0),imageUrl:s.imageUrl||s.image||null}));return rn=0,d.myBoosters}catch{return rn++,d.myBoosters||(d.myBoosters=[]),d.myBoosters}finally{Qn=!1}}const Yu={apiKey:"AIzaSyDKhF2_--fKtot96YPS8twuD0UoCpS-3T4",authDomain:"airdropbackchainnew.firebaseapp.com",projectId:"airdropbackchainnew",storageBucket:"airdropbackchainnew.appspot.com",messagingSenderId:"108371799661",appId:"1:108371799661:web:d126fcbd0ba56263561964",measurementId:"G-QD9EBZ0Y09"},ro=iu(Yu),sn=ru(ro),j=lu(ro);let ct=null,Pe=null,on=null;async function so(e){if(!e)throw new Error("Wallet address is required for Firebase sign-in.");const t=e.toLowerCase();return Pe=t,ct?(on=await ya(t),ct):sn.currentUser?(ct=sn.currentUser,on=await ya(t),ct):new Promise((a,n)=>{const i=su(sn,async r=>{if(i(),r){ct=r;try{on=await ya(t),a(r)}catch(s){console.error("Error linking airdrop user profile:",s),n(s)}}else ou(sn).then(async s=>{ct=s.user,on=await ya(t),a(ct)}).catch(s=>{console.error("Firebase Anonymous sign-in failed:",s),n(s)})},r=>{console.error("Firebase Auth state change error:",r),i(),n(r)})})}function rt(){if(!ct)throw new Error("User not authenticated with Firebase. Please sign-in first.");if(!Pe)throw new Error("Wallet address not set. Please connect wallet first.")}async function qi(){const e=oe(j,"airdrop_public_data","data_v1"),t=await Re(e);if(t.exists()){const a=t.data(),n=(a.dailyTasks||[]).map(s=>{var c,u;const o=(c=s.startDate)!=null&&c.toDate?s.startDate.toDate():s.startDate?new Date(s.startDate):null,l=(u=s.endDate)!=null&&u.toDate?s.endDate.toDate():s.endDate?new Date(s.endDate):null;return{...s,id:s.id||null,startDate:o instanceof Date&&!isNaN(o)?o:null,endDate:l instanceof Date&&!isNaN(l)?l:null}}).filter(s=>s.id),i=Date.now(),r=n.filter(s=>{const o=s.startDate?s.startDate.getTime():0,l=s.endDate?s.endDate.getTime():1/0;return o<=i&&i<l});return{config:a.config||{ugcBasePoints:{}},leaderboards:a.leaderboards||{top100ByPoints:[],top100ByPosts:[],lastUpdated:null},dailyTasks:r,platformUsageConfig:a.platformUsageConfig||null}}else return console.warn("Public airdrop data document 'airdrop_public_data/data_v1' not found. Returning defaults."),{config:{isActive:!1,roundName:"Loading...",ugcBasePoints:{}},leaderboards:{top100ByPoints:[],top100ByPosts:[],lastUpdated:null},dailyTasks:[],platformUsageConfig:null}}function Zr(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let a=0;a<6;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function hn(e){return e>=100?10:e>=90?9:e>=80?8:e>=70?7:e>=60?6:e>=50?5:e>=40?4:e>=30?3:e>=20?2:1}async function ya(e){rt(),e||(e=Pe);const t=e.toLowerCase(),a=oe(j,"airdrop_users",t),n=await Re(a);if(n.exists()){const i=n.data(),r={};if(i.referralCode||(r.referralCode=Zr()),typeof i.approvedSubmissionsCount!="number"&&(r.approvedSubmissionsCount=0),typeof i.rejectedCount!="number"&&(r.rejectedCount=0),typeof i.isBanned!="boolean"&&(r.isBanned=!1),typeof i.totalPoints!="number"&&(r.totalPoints=0),typeof i.pointsMultiplier!="number"&&(r.pointsMultiplier=1),i.walletAddress!==t&&(r.walletAddress=t),Object.keys(r).length>0)try{return await $n(a,r),{id:n.id,...i,...r}}catch(s){return console.error("Error updating user default fields:",s),{id:n.id,...i}}return{id:n.id,...i}}else{const i=Zr(),r={walletAddress:t,referralCode:i,totalPoints:0,pointsMultiplier:1,approvedSubmissionsCount:0,rejectedCount:0,isBanned:!1,createdAt:xt()};return await Sn(a,r),{id:a.id,...r,createdAt:new Date}}}async function oo(e,t){if(rt(),!e||typeof e!="string"||e.trim()==="")return console.warn(`isTaskEligible called with invalid taskId: ${e}`),{eligible:!1,timeLeft:0};const a=oe(j,"airdrop_users",Pe,"task_claims",e),n=await Re(a),i=t*60*60*1e3;if(!n.exists())return{eligible:!0,timeLeft:0};const r=n.data(),s=r==null?void 0:r.timestamp;if(typeof s!="string"||s.trim()==="")return console.warn(`Missing/invalid timestamp for task ${e}. Allowing claim.`),{eligible:!0,timeLeft:0};try{const o=new Date(s);if(isNaN(o.getTime()))return console.warn(`Invalid timestamp format for task ${e}:`,s,". Allowing claim."),{eligible:!0,timeLeft:0};const l=o.getTime(),u=Date.now()-l;return u>=i?{eligible:!0,timeLeft:0}:{eligible:!1,timeLeft:i-u}}catch(o){return console.error(`Error parsing timestamp string for task ${e}:`,s,o),{eligible:!0,timeLeft:0}}}async function Vu(e,t){if(rt(),!e||!e.id)throw new Error("Invalid task data provided.");if(!(await oo(e.id,e.cooldownHours)).eligible)throw new Error("Cooldown period is still active for this task.");const n=oe(j,"airdrop_users",Pe),i=Math.round(e.points);if(isNaN(i)||i<0)throw new Error("Invalid points value for the task.");await $n(n,{totalPoints:Ke(i)});const r=oe(j,"airdrop_users",Pe,"task_claims",e.id);return await Sn(r,{timestamp:new Date().toISOString(),points:i}),i}async function qu(e){var o;const t=e.trim().toLowerCase();let a="Other",n=!0;if(t.includes("youtube.com/shorts/")){a="YouTube Shorts";const l=t.match(/\/shorts\/([a-zA-Z0-9_-]+)/);if(!l||!l[1])throw n=!1,new Error("Invalid YouTube Shorts URL: Video ID not found or incorrect format.")}else if(t.includes("youtube.com/watch?v=")||t.includes("youtu.be/")){a="YouTube";const l=t.match(/(?:v=|\/)([a-zA-Z0-9_-]{11})(?:[?&]|$)/);if(!l||l[1].length!==11)throw n=!1,new Error("Invalid YouTube URL: Video ID not found or incorrect format.")}else{if(t.includes("youtube.com/"))throw a="YouTube",n=!1,new Error("Invalid YouTube URL: Only video links (youtube.com/watch?v=... or youtu.be/...) or Shorts links are accepted.");if(t.includes("instagram.com/p/")||t.includes("instagram.com/reel/")){a="Instagram";const l=t.match(/\/(?:p|reel)\/([a-zA-Z0-9_.-]+)/);(!l||!l[1])&&(n=!1)}else t.includes("twitter.com/")||t.includes("x.com/")?t.match(/(\w+)\/(?:status|statuses)\/(\d+)/)&&(a="X/Twitter"):t.includes("facebook.com/")&&t.includes("/posts/")?a="Facebook":t.includes("t.me/")||t.includes("telegram.org/")?a="Telegram":t.includes("tiktok.com/")?a="TikTok":t.includes("reddit.com/r/")?a="Reddit":t.includes("linkedin.com/posts/")&&(a="LinkedIn")}const r=((o=(await qi()).config)==null?void 0:o.ugcBasePoints)||{},s=r[a]||r.Other||1e3;if(isNaN(s)||s<0)throw new Error(`Invalid base points configured for platform: ${a}. Please contact admin.`);return{platform:a,basePoints:s,isValid:n,normalizedUrl:t}}async function Xu(e){var pe;rt();const t=oe(j,"airdrop_users",Pe),a=at(j,"airdrop_users",Pe,"submissions"),n=at(j,"all_submissions_log"),i=e.trim();if(!i||!i.toLowerCase().startsWith("http://")&&!i.toLowerCase().startsWith("https://"))throw new Error("The provided URL must start with http:// or https://.");let r;try{r=await qu(i)}catch(Ee){throw Ee}const{platform:s,basePoints:o,isValid:l,normalizedUrl:c}=r;if(!l)throw new Error(`The provided URL for ${s} does not appear valid for submission.`);const u=Rt(a,sa("submittedAt","desc"),cu(1)),f=await gt(u);if(!f.empty){const le=(pe=f.docs[0].data().submittedAt)==null?void 0:pe.toDate();if(le){const ae=new Date,H=5*60*1e3,Z=ae.getTime()-le.getTime();if(Z<H){const Te=H-Z,Q=Math.ceil(Te/6e4);throw new Error(`We're building a strong community, and we value quality over quantity. To prevent spam, please wait ${Q} more minute(s) before submitting another post. We appreciate your thoughtful contribution!`)}}}const p=Rt(n,xn("normalizedUrl","==",c),xn("status","in",["pending","approved","auditing","flagged_suspicious"]));if(!(await gt(p)).empty)throw new Error("This content link has already been submitted. Repeatedly submitting duplicate or fraudulent content may lead to account suspension.");const m=await Re(t);if(!m.exists())throw new Error("User profile not found.");const x=m.data(),y=x.approvedSubmissionsCount||0,C=hn(y),A=Math.round(o*C),N=xt(),P={url:i,platform:s,status:"pending",basePoints:o,_pointsCalculated:A,_multiplierApplied:C,pointsAwarded:0,submittedAt:N,resolvedAt:null},z={userId:Pe,walletAddress:x.walletAddress,normalizedUrl:c,platform:s,status:"pending",basePoints:o,submittedAt:N,resolvedAt:null},I=Nn(j),F=oe(a);I.set(F,P);const K=oe(n,F.id);I.set(K,z),await I.commit()}async function Ju(){rt();const e=at(j,"airdrop_users",Pe,"submissions"),t=Rt(e,sa("submittedAt","desc"));return(await gt(t)).docs.map(n=>{var r,s;const i=n.data();return{submissionId:n.id,...i,submittedAt:(r=i.submittedAt)!=null&&r.toDate?i.submittedAt.toDate():null,resolvedAt:(s=i.resolvedAt)!=null&&s.toDate?i.resolvedAt.toDate():null}})}async function Zu(e){rt();const t=Pe,a=oe(j,"airdrop_users",t),n=oe(j,"airdrop_users",t,"submissions",e),i=oe(j,"all_submissions_log",e),r=await Re(n);if(!r.exists())throw new Error("Cannot confirm submission: Document not found or already processed.");const s=r.data(),o=s.status;if(o==="approved"||o==="rejected")throw new Error(`Submission is already in status: ${o}.`);let l=s._pointsCalculated,c=s._multiplierApplied;if(typeof l!="number"||isNaN(l)||l<=0){console.warn(`[ConfirmSubmission] Legacy/Invalid submission ${e} missing/invalid _pointsCalculated. Recalculating...`);const f=s.basePoints||0,p=await Re(a);if(!p.exists())throw new Error("User profile not found for recalculation.");const m=p.data().approvedSubmissionsCount||0;c=hn(m),l=Math.round(f*c),(isNaN(l)||l<=0)&&(console.warn(`[ConfirmSubmission] Recalculation failed (basePoints: ${f}). Using fallback 1000.`),l=Math.round(1e3*c))}const u=Nn(j);u.update(a,{totalPoints:Ke(l),approvedSubmissionsCount:Ke(1)}),u.update(n,{status:"approved",pointsAwarded:l,_pointsCalculated:l,_multiplierApplied:c,resolvedAt:xt()}),await Re(i).then(f=>f.exists())&&u.update(i,{status:"approved",resolvedAt:xt()}),await u.commit()}async function lo(e){rt();const a=oe(j,"airdrop_users",Pe,"submissions",e),n=oe(j,"all_submissions_log",e),i=await Re(a);if(!i.exists())return console.warn(`Delete submission skipped: Document ${e} not found.`);const r=i.data().status;if(r==="approved"||r==="rejected")throw new Error(`This submission was already ${r} and cannot be deleted.`);if(r==="flagged_suspicious")throw new Error("Flagged submissions must be resolved, not deleted.");const s=Nn(j);s.update(a,{status:"deleted_by_user",resolvedAt:xt()}),await Re(n).then(o=>o.exists())&&s.update(n,{status:"deleted_by_user",resolvedAt:xt(),pointsAwarded:0}),await s.commit()}async function Qu(e){const t=oe(j,"airdrop_public_data","data_v1");await Sn(t,{config:{ugcBasePoints:e}},{merge:!0})}async function ep(){const e=at(j,"daily_tasks"),t=Rt(e,sa("endDate","asc"));return(await gt(t)).docs.map(n=>{var i,r;return{id:n.id,...n.data(),startDate:(i=n.data().startDate)!=null&&i.toDate?n.data().startDate.toDate():null,endDate:(r=n.data().endDate)!=null&&r.toDate?n.data().endDate.toDate():null}})}async function tp(e){const t={...e};t.startDate instanceof Date&&(t.startDate=Ur.fromDate(t.startDate)),t.endDate instanceof Date&&(t.endDate=Ur.fromDate(t.endDate));const a=e.id;if(!a)delete t.id,await du(at(j,"daily_tasks"),t);else{const n=oe(j,"daily_tasks",a);delete t.id,await Sn(n,t,{merge:!0})}}async function ap(e){if(!e)throw new Error("Task ID is required for deletion.");await uu(oe(j,"daily_tasks",e))}async function np(){const e=at(j,"all_submissions_log"),t=Rt(e,xn("status","in",["pending","auditing","flagged_suspicious"]),sa("submittedAt","desc"));return(await gt(t)).docs.map(n=>{var r,s;const i=n.data();return{userId:i.userId,walletAddress:i.walletAddress,submissionId:n.id,...i,submittedAt:(r=i.submittedAt)!=null&&r.toDate?i.submittedAt.toDate():null,resolvedAt:(s=i.resolvedAt)!=null&&s.toDate?i.resolvedAt.toDate():null}})}async function co(e,t,a){var C,A,N;if(!e)throw new Error("User ID (walletAddress) is required.");const n=e.toLowerCase(),i=oe(j,"airdrop_users",n),r=oe(j,"airdrop_users",n,"submissions",t),s=oe(j,"all_submissions_log",t),[o,l,c]=await Promise.all([Re(i),Re(r),Re(s)]);if(!l.exists())throw new Error("Submission not found in user collection.");if(!o.exists())throw new Error("User profile not found.");c.exists()||console.warn(`Log entry ${t} not found. Log will not be updated.`);const u=l.data(),f=o.data(),p=u.status;if(p===a){console.warn(`Admin action ignored: Submission ${t} already has status ${a}.`);return}const b=Nn(j),m={};let x=0,y=u._multiplierApplied||0;if(a==="approved"){let P=u._pointsCalculated;if(typeof P!="number"||isNaN(P)||P<=0){console.warn(`[Admin] Legacy/Invalid submission ${t} missing/invalid _pointsCalculated. Recalculating...`);const z=u.basePoints||0,I=f.approvedSubmissionsCount||0,F=hn(I);if(P=Math.round(z*F),isNaN(P)||P<=0){console.warn(`[Admin] Recalculation failed (basePoints: ${z}). Using fallback 1000.`);const K=hn(I);P=Math.round(1e3*K)}y=F}x=P,m.totalPoints=Ke(P),m.approvedSubmissionsCount=Ke(1),p==="rejected"&&(m.rejectedCount=Ke(-1))}else if(a==="rejected"){if(p!=="rejected"){const P=f.rejectedCount||0;m.rejectedCount=Ke(1),P+1>=3&&(m.isBanned=!0)}else if(p==="approved"){const P=u.pointsAwarded||0;m.totalPoints=Ke(-P),m.approvedSubmissionsCount=Ke(-1);const z=f.rejectedCount||0;m.rejectedCount=Ke(1),z+1>=3&&(m.isBanned=!0)}x=0}if(((C=m.approvedSubmissionsCount)==null?void 0:C.operand)<0&&(f.approvedSubmissionsCount||0)<=0&&(m.approvedSubmissionsCount=0),((A=m.rejectedCount)==null?void 0:A.operand)<0&&(f.rejectedCount||0)<=0&&(m.rejectedCount=0),((N=m.totalPoints)==null?void 0:N.operand)<0){const P=f.totalPoints||0,z=Math.abs(m.totalPoints.operand);P<z&&(m.totalPoints=0)}Object.keys(m).length>0&&b.update(i,m),b.update(r,{status:a,pointsAwarded:x,_pointsCalculated:a==="approved"?x:u._pointsCalculated||0,_multiplierApplied:y,resolvedAt:xt()}),c.exists()&&b.update(s,{status:a,resolvedAt:xt()}),await b.commit()}async function ip(){const e=at(j,"airdrop_users"),t=Rt(e,sa("totalPoints","desc"));return(await gt(t)).docs.map(n=>({id:n.id,...n.data()}))}async function rp(e,t){if(!e)throw new Error("User ID is required.");const a=e.toLowerCase(),n=at(j,"airdrop_users",a,"submissions"),i=Rt(n,xn("status","==",t),sa("resolvedAt","desc"));return(await gt(i)).docs.map(s=>{var o,l;return{submissionId:s.id,userId:a,...s.data(),submittedAt:(o=s.data().submittedAt)!=null&&o.toDate?s.data().submittedAt.toDate():null,resolvedAt:(l=s.data().resolvedAt)!=null&&l.toDate?s.data().resolvedAt.toDate():null}})}async function uo(e,t){if(!e)throw new Error("User ID is required.");const a=e.toLowerCase(),n=oe(j,"airdrop_users",a),i={isBanned:t};t===!1&&(i.rejectedCount=0),await $n(n,i)}async function Qr(){rt();try{const e=at(j,"airdrop_users",Pe,"platform_usage"),t=await gt(e),a={};return t.forEach(n=>{a[n.id]=n.data()}),a}catch(e){return console.error("Error fetching platform usage:",e),{}}}async function po(e){rt();const t=oe(j,"airdrop_public_data","data_v1");await $n(t,{platformUsageConfig:e}),console.log("âœ… Platform usage config saved:",e)}const G=window.ethers,mo=421614,sp="0x66eee";let Oe=null,es=0,dt=0;const op=5e3,ts=3,lp=3e4;let Xi=0;const cp=3;let fo=null;const dp="cd4bdedee7a7e909ebd3df8bbc502aed",up={chainId:Ae.chainIdDecimal,name:Ae.chainName,currency:Ae.nativeCurrency.symbol,explorerUrl:Ae.blockExplorerUrls[0],rpcUrl:Ae.rpcUrls[0]},pp={name:"Backcoin Protocol",description:"DeFi Ecosystem",url:window.location.origin,icons:[window.location.origin+"/assets/bkc_logo_3d.png"]},mp=au({metadata:pp,enableEIP6963:!0,enableInjected:!0,enableCoinbase:!1,rpcUrl:qs,defaultChainId:mo,enableEmail:!0,enableEns:!1,auth:{email:!0,showWallets:!0,walletFeatures:!0}}),At=nu({ethersConfig:mp,chains:[up],projectId:dp,enableAnalytics:!0,themeMode:"dark",themeVariables:{"--w3m-accent":"#f59e0b","--w3m-border-radius-master":"1px","--w3m-z-index":100}});function fp(e){var n,i;const t=((n=e==null?void 0:e.message)==null?void 0:n.toLowerCase())||"",a=(e==null?void 0:e.code)||((i=e==null?void 0:e.error)==null?void 0:i.code);return a===-32603||a===-32e3||a===429||t.includes("failed to fetch")||t.includes("network error")||t.includes("timeout")||t.includes("rate limit")||t.includes("too many requests")||t.includes("internal json-rpc")||t.includes("unexpected token")||t.includes("<html")}function ki(e){return new G.JsonRpcProvider(e||Sa())}async function bo(e,t=cp){var n;let a=null;for(let i=0;i<t;i++)try{const r=await e();return vu(Sa()),Xi=0,r}catch(r){if(a=r,fp(r)){console.warn(`âš ï¸ RPC error (attempt ${i+1}/${t}):`,(n=r.message)==null?void 0:n.slice(0,80)),hu(Sa());const s=Xs();console.log(`ðŸ”„ Switching to: ${s}`),await Ra(),await new Promise(o=>setTimeout(o,500*(i+1)))}else throw r}throw console.error("âŒ All RPC attempts failed"),a}async function Ra(){const e=Sa();try{d.publicProvider=ki(e),fo=d.publicProvider,te(w.bkcToken)&&(d.bkcTokenContractPublic=new G.Contract(w.bkcToken,ji,d.publicProvider)),te(w.delegationManager)&&(d.delegationManagerContractPublic=new G.Contract(w.delegationManager,Wi,d.publicProvider)),te(w.faucet)&&(d.faucetContractPublic=new G.Contract(w.faucet,Yi,d.publicProvider)),te(w.rentalManager)&&(d.rentalManagerContractPublic=new G.Contract(w.rentalManager,ja,d.publicProvider)),te(w.ecosystemManager)&&(d.ecosystemManagerContractPublic=new G.Contract(w.ecosystemManager,Vi,d.publicProvider)),te(w.actionsManager)&&(d.actionsManagerContractPublic=new G.Contract(w.actionsManager,Gi,d.publicProvider));const t=w.fortunePoolV2||w.fortunePool;te(t)&&(d.fortunePoolContractPublic=new G.Contract(t,Ki,d.publicProvider)),console.log(`âœ… Public provider recreated with: ${e.slice(0,50)}...`)}catch(t){console.error("Failed to recreate public provider:",t)}}function bp(e){if(!e)return!1;try{return G.isAddress(e)}catch{return!1}}function te(e){return e&&e!==G.ZeroAddress&&!e.startsWith("0x...")}function gp(e){if(!e)return;const t=localStorage.getItem(`balance_${e.toLowerCase()}`);if(t)try{d.currentUserBalance=BigInt(t),window.updateUIState&&window.updateUIState()}catch{}}function xp(e){try{te(w.bkcToken)&&(d.bkcTokenContract=new G.Contract(w.bkcToken,ji,e)),te(w.delegationManager)&&(d.delegationManagerContract=new G.Contract(w.delegationManager,Wi,e)),te(w.rewardBoosterNFT)&&(d.rewardBoosterContract=new G.Contract(w.rewardBoosterNFT,Cu,e)),te(w.publicSale)&&(d.publicSaleContract=new G.Contract(w.publicSale,Iu,e)),te(w.faucet)&&(d.faucetContract=new G.Contract(w.faucet,Yi,e)),te(w.rentalManager)&&(d.rentalManagerContract=new G.Contract(w.rentalManager,ja,e)),te(w.actionsManager)&&(d.actionsManagerContract=new G.Contract(w.actionsManager,Gi,e)),te(w.decentralizedNotary)&&(d.decentralizedNotaryContract=new G.Contract(w.decentralizedNotary,Au,e)),te(w.ecosystemManager)&&(d.ecosystemManagerContract=new G.Contract(w.ecosystemManager,Vi,e));const t=w.fortunePoolV2||w.fortunePool;te(t)&&(d.fortunePoolContract=new G.Contract(t,Ki,e))}catch{console.warn("Contract init partial failure")}}function go(){if(Oe&&(clearInterval(Oe),Oe=null),!d.bkcTokenContractPublic||!d.userAddress){console.warn("Cannot start balance polling: missing contract or address");return}dt=0,Xi=0,setTimeout(()=>{as()},1e3),Oe=setInterval(as,lp),console.log("âœ… Balance polling started (30s interval)")}async function as(){var t;if(document.hidden||!d.isConnected||!d.userAddress||!d.bkcTokenContractPublic)return;const e=Date.now();try{const a=await bo(async()=>await d.bkcTokenContractPublic.balanceOf(d.userAddress),2);dt=0;const n=d.currentUserBalance||0n;a.toString()!==n.toString()&&(d.currentUserBalance=a,localStorage.setItem(`balance_${d.userAddress.toLowerCase()}`,a.toString()),e-es>op&&(es=e,window.updateUIState&&window.updateUIState(!1)))}catch(a){dt++,dt<=3&&console.warn(`âš ï¸ Balance check failed (${dt}/${ts}):`,(t=a.message)==null?void 0:t.slice(0,50)),dt>=ts&&(console.warn("âŒ Too many balance check errors. Stopping polling temporarily."),Oe&&(clearInterval(Oe),Oe=null),setTimeout(()=>{console.log("ðŸ”„ Attempting to restart balance polling with primary RPC..."),wu(),Ra().then(()=>{dt=0,go()})},6e4))}}async function hp(e){try{const t=await e.getNetwork();if(Number(t.chainId)===mo)return!0;try{return await e.send("wallet_switchEthereumChain",[{chainId:sp}]),!0}catch{return!0}}catch{return!0}}async function ns(e,t){try{if(!bp(t))return!1;await hp(e),d.provider=e;try{d.signer=await e.getSigner()}catch(a){d.signer=e,console.warn(`Could not get standard Signer. Using Provider as read-only. Warning: ${a.message}`)}d.userAddress=t,d.isConnected=!0,gp(t),xp(d.signer);try{so(d.userAddress)}catch{}return Wa().then(()=>{window.updateUIState&&window.updateUIState(!1)}).catch(()=>{}),go(),!0}catch(a){return console.error("Setup warning:",a),!!t}}async function vp(){try{if(window.ethereum){const a=await Nu();a.fixed?console.log("âœ… MetaMask network config was auto-fixed"):!a.success&&!a.skipped&&console.warn("Initial network config check:",a.error)}const e=Sa();console.log(`ðŸŒ Initializing public provider with: ${e.slice(0,50)}...`),d.publicProvider=ki(e),fo=d.publicProvider,te(w.bkcToken)&&(d.bkcTokenContractPublic=new G.Contract(w.bkcToken,ji,d.publicProvider)),te(w.delegationManager)&&(d.delegationManagerContractPublic=new G.Contract(w.delegationManager,Wi,d.publicProvider)),te(w.faucet)&&(d.faucetContractPublic=new G.Contract(w.faucet,Yi,d.publicProvider)),te(w.rentalManager)&&(d.rentalManagerContractPublic=new G.Contract(w.rentalManager,ja,d.publicProvider)),te(w.ecosystemManager)&&(d.ecosystemManagerContractPublic=new G.Contract(w.ecosystemManager,Vi,d.publicProvider)),te(w.actionsManager)&&(d.actionsManagerContractPublic=new G.Contract(w.actionsManager,Gi,d.publicProvider));const t=w.fortunePoolV2||w.fortunePool;te(t)&&(d.fortunePoolContractPublic=new G.Contract(t,Ki,d.publicProvider),console.log("âœ… FortunePool V2 contract initialized:",t));try{await bo(async()=>{await ao()})}catch{console.warn("Initial public data load failed, will retry on user interaction")}$u(async a=>{a.isCorrectNetwork?(await La()).healthy||(console.log("âš ï¸ RPC issues after network change, updating..."),await Zt(),await Ra()):(console.log("âš ï¸ User switched to wrong network"),h("Please switch back to Arbitrum Sepolia","warning"))}),kp(),window.updateUIState&&window.updateUIState(),console.log("âœ… Public provider initialized")}catch(e){console.error("Public provider error:",e),window.ethereum&&await Zt();const t=Xs();console.log(`ðŸ”„ Retrying with: ${t}`);try{d.publicProvider=ki(t),console.log("âœ… Public provider initialized with fallback RPC")}catch{console.error("âŒ All RPC endpoints failed")}}}function wp(e){let t=At.getAddress();if(At.getIsConnected()&&t){const n=At.getWalletProvider();if(n){const i=new G.BrowserProvider(n);d.web3Provider=n,e({isConnected:!0,address:t,isNewConnection:!1}),ns(i,t)}}const a=async({provider:n,address:i,chainId:r,isConnected:s})=>{try{if(s){let o=i||At.getAddress();if(!o&&n)try{o=await(await new G.BrowserProvider(n).getSigner()).getAddress()}catch{}if(o){const l=new G.BrowserProvider(n);d.web3Provider=n,e({isConnected:!0,address:o,chainId:r,isNewConnection:!0}),await ns(l,o)}else Oe&&clearInterval(Oe),d.isConnected=!1,d.userAddress=null,d.signer=null,e({isConnected:!1})}else Oe&&clearInterval(Oe),d.isConnected=!1,d.userAddress=null,d.signer=null,e({isConnected:!1})}catch{}};At.subscribeProvider(a)}function xo(){At.open()}async function yp(){await At.disconnect()}let ti=null;function kp(){ti&&clearInterval(ti);let e=0;ti=setInterval(async()=>{if(document.hidden||!d.isConnected)return;const t=await La();if(!t.healthy){const a=Date.now();if(a-e<3e5)return;e=a,console.log(`âš ï¸ RPC health check failed (${t.reason}), attempting fix...`),await Zt()&&(console.log("âœ… MetaMask RPCs updated via health monitor"),await Ra(),dt=0,Xi=0)}},6e4),document.addEventListener("visibilitychange",async()=>{if(!document.hidden&&d.isConnected){const t=Date.now();if(t-e<3e5)return;(await La()).healthy||(e=t,console.log("âš ï¸ RPC unhealthy on tab focus, fixing..."),await Zt(),await Ra())}}),console.log("âœ… RPC health monitoring started (30s interval)")}const Ep=window.ethers,M=(e,t=18)=>{if(e===null||typeof e>"u")return 0;if(typeof e=="number")return e;if(typeof e=="string")return parseFloat(e);try{const a=BigInt(e);return parseFloat(Ep.formatUnits(a,t))}catch{return 0}},la=e=>!e||typeof e!="string"||!e.startsWith("0x")?"...":`${e.substring(0,6)}...${e.substring(e.length-4)}`,ea=e=>{try{if(e==null)return"0";const t=typeof e=="bigint"?e:BigInt(e);if(t<1000n)return t.toString();const a=Number(t);if(!isFinite(a))return t.toLocaleString("en-US");const n=["","k","M","B","T"],i=Math.floor((""+Math.floor(a)).length/3);let r=parseFloat((i!==0?a/Math.pow(1e3,i):a).toPrecision(3));return r%1!==0&&(r=r.toFixed(2)),r+n[i]}catch{return"0"}},Tp=(e="Loading...")=>`<div class="flex items-center justify-center p-4 text-zinc-400"><div class="loader inline-block mr-2"></div> ${e}</div>`,Cp=(e="An error occurred.")=>`<div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-center text-red-400 text-sm">${e}</div>`,Ip=(e="No data available.")=>`<div class="text-center p-8 bg-zinc-900/30 border border-dashed border-zinc-800 rounded-lg col-span-full">
                <i class="fa-regular fa-folder-open text-2xl text-zinc-600 mb-2"></i>
                <p class="text-zinc-500 italic text-sm">${e}</p>
            </div>`;function Ji(e,t,a,n){if(!e)return;if(a<=1){e.innerHTML="";return}const i=`
        <div class="flex items-center justify-center gap-3 mt-4">
            <button class="pagination-btn prev-page-btn w-8 h-8 flex items-center justify-center rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed" 
                data-page="${t-1}" ${t===1?"disabled":""}>
                <i class="fa-solid fa-chevron-left text-xs"></i>
            </button>
            <span class="text-xs text-zinc-400 font-mono bg-zinc-900 px-3 py-1 rounded border border-zinc-800">
                ${t} / ${a}
            </span>
            <button class="pagination-btn next-page-btn w-8 h-8 flex items-center justify-center rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed" 
                data-page="${t+1}" ${t===a?"disabled":""}>
                <i class="fa-solid fa-chevron-right text-xs"></i>
            </button>
        </div>
    `;e.innerHTML=i,e.querySelectorAll(".pagination-btn").forEach(r=>{r.addEventListener("click",()=>{r.hasAttribute("disabled")||n(parseInt(r.dataset.page))})})}const Ap="modulepreload",Bp=function(e){return"/"+e},is={},W=function(t,a,n){let i=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.allSettled(a.map(l=>{if(l=Bp(l),l in is)return;is[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Ap,c||(f.as="script"),f.crossOrigin="",f.href=l,o&&f.setAttribute("nonce",o),document.head.appendChild(f),c)return new Promise((p,b)=>{f.addEventListener("load",p),f.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&r(o.reason);return t().catch(r)})},ho="https://faucet-4wvdcuoouq-uc.a.run.app";function _n(){var e;return(w==null?void 0:w.faucet)||(L==null?void 0:L.faucet)||((e=window.contractAddresses)==null?void 0:e.faucet)||null}const vn=["function claim() external","function canClaim(address user) view returns (bool)","function lastClaimTime(address user) view returns (uint256)","function claimCooldown() view returns (uint256)","function claimAmountBKC() view returns (uint256)","function claimAmountETH() view returns (uint256)","event TokensClaimed(address indexed user, uint256 bkcAmount, uint256 ethAmount)"];function zp(){var e,t;return typeof State<"u"&&(State!=null&&State.userAddress)?State.userAddress:(e=window.State)!=null&&e.userAddress?window.State.userAddress:window.userAddress?window.userAddress:(t=window.ethereum)!=null&&t.selectedAddress?window.ethereum.selectedAddress:null}function Pt(e,t="info"){if(typeof window.showToast=="function"){window.showToast(e,t);return}(t==="error"?console.error:console.log)(`[Faucet] ${e}`)}async function vo(){if(typeof window.loadUserData=="function"){await window.loadUserData();return}if(typeof window.refreshBalances=="function"){await window.refreshBalances();return}console.log("[Faucet] No refresh function available")}async function Zi({button:e=null,address:t=null,onSuccess:a=null,onError:n=null}={}){const i=t||zp();if(!i){const o="Please connect wallet first";return Pt(o,"error"),n&&n(new Error(o)),{success:!1,error:o}}const r=(e==null?void 0:e.innerHTML)||"Claim",s=(e==null?void 0:e.disabled)||!1;e&&(e.innerHTML='<div class="loader inline-block"></div> Claiming...',e.disabled=!0);try{const o=await fetch(`${ho}?address=${i}`,{method:"GET",headers:{Accept:"application/json"}}),l=await o.json();if(o.ok&&l.success){Pt("âœ… Tokens received!","success"),await vo();const c={success:!0,txHash:l.txHash,bkcAmount:l.bkcAmount,ethAmount:l.ethAmount};return a&&a(c),c}else{const c=l.error||l.message||"Faucet unavailable";Pt(c,"error");const u=new Error(c);return n&&n(u),{success:!1,error:c}}}catch(o){return console.error("Faucet error:",o),Pt("Faucet unavailable","error"),n&&n(o),{success:!1,error:o.message}}finally{e&&(e.innerHTML=r,e.disabled=s)}}const Qi=async e=>await Zi({button:e});async function wo({button:e=null,onSuccess:t=null,onError:a=null}={}){const n=_n();if(!n){const r="Faucet contract address not configured";return Pt(r,"error"),a&&a(new Error(r)),{success:!1,error:r}}const{txEngine:i}=await W(async()=>{const{txEngine:r}=await import("./index-Jv5HScoX.js");return{txEngine:r}},[]);return await i.execute({name:"FaucetClaim",button:e,getContract:async r=>{const s=window.ethers;return new s.Contract(n,vn,r)},method:"claim",args:[],validate:async(r,s)=>{const o=window.ethers,l=new o.Contract(n,vn,r);if(!await l.canClaim(s)){const u=await l.lastClaimTime(s),f=await l.claimCooldown(),p=Number(u)+Number(f),b=Math.floor(Date.now()/1e3);if(p>b){const m=Math.ceil((p-b)/60);throw new Error(`Please wait ${m} minutes before claiming again`)}}},onSuccess:async r=>{Pt("âœ… Tokens received!","success"),await vo(),t&&t(r)},onError:r=>{Pt(r.message||"Claim failed","error"),a&&a(r)}})}async function yo(e){const t=_n();if(!t)return{canClaim:!1,error:"Faucet not configured"};try{const a=window.ethers,{NetworkManager:n}=await W(async()=>{const{NetworkManager:f}=await import("./index-Jv5HScoX.js");return{NetworkManager:f}},[]),i=n.getProvider(),r=new a.Contract(t,vn,i),[s,o,l]=await Promise.all([r.canClaim(e),r.lastClaimTime(e),r.claimCooldown()]),c=Number(o)+Number(l),u=Math.floor(Date.now()/1e3);return{canClaim:s,lastClaimTime:Number(o),cooldownSeconds:Number(l),nextClaimTime:c,waitSeconds:s?0:Math.max(0,c-u)}}catch(a){return console.error("Error checking claim status:",a),{canClaim:!1,error:a.message}}}async function ko(){const e=_n();if(!e)return{error:"Faucet not configured"};try{const t=window.ethers,{NetworkManager:a}=await W(async()=>{const{NetworkManager:l}=await import("./index-Jv5HScoX.js");return{NetworkManager:l}},[]),n=a.getProvider(),i=new t.Contract(e,vn,n),[r,s,o]=await Promise.all([i.claimAmountBKC(),i.claimAmountETH(),i.claimCooldown()]);return{bkcAmount:r,ethAmount:s,cooldownSeconds:Number(o),cooldownMinutes:Number(o)/60,bkcAmountFormatted:t.formatEther(r),ethAmountFormatted:t.formatEther(s)}}catch(t){return console.error("Error getting faucet info:",t),{error:t.message}}}const Pp={claim:Zi,claimOnChain:wo,executeFaucetClaim:Qi,canClaim:yo,getFaucetInfo:ko,getFaucetAddress:_n,FAUCET_API_URL:ho},Np=Object.freeze(Object.defineProperty({__proto__:null,FaucetTx:Pp,canClaim:yo,claim:Zi,claimOnChain:wo,executeFaucetClaim:Qi,getFaucetInfo:ko},Symbol.toStringTag,{value:"Module"})),ai={BALANCE:1e4,ALLOWANCE:3e4},Ce=new Map,de={hits:0,misses:0,sets:0,invalidations:0},St={get(e){const t=Ce.get(e);if(!t){de.misses++;return}if(Date.now()>t.expiresAt){Ce.delete(e),de.misses++;return}return de.hits++,t.value},set(e,t,a){t!=null&&(Ce.set(e,{value:t,expiresAt:Date.now()+a,createdAt:Date.now()}),de.sets++)},delete(e){Ce.delete(e)},clear(e){if(!e){Ce.clear(),de.invalidations++;return}for(const t of Ce.keys())t.includes(e)&&Ce.delete(t);de.invalidations++},async getOrFetch(e,t,a){const n=this.get(e);if(n!==void 0)return n;try{const i=await t();return i!=null&&this.set(e,i,a),i}catch(i){throw console.warn(`[Cache] Error fetching ${e}:`,i.message),i}},has(e){return this.get(e)!==void 0},getTTL(e){const t=Ce.get(e);if(!t)return 0;const a=t.expiresAt-Date.now();return a>0?a:0},invalidateByTx(e){const a={CreateCampaign:["campaign-","charity-stats","user-campaigns-","campaign-list"],Donate:["campaign-","charity-stats","token-balance-","allowance-"],CancelCampaign:["campaign-","charity-stats","user-campaigns-"],Withdraw:["campaign-","charity-stats","token-balance-"],Delegate:["delegation-","token-balance-","allowance-","user-pstake-","pending-rewards-","network-pstake"],Unstake:["delegation-","token-balance-","user-pstake-","pending-rewards-","network-pstake"],ForceUnstake:["delegation-","token-balance-","user-pstake-","pending-rewards-","network-pstake"],ClaimReward:["pending-rewards-","token-balance-","saved-rewards-"],BuyNFT:["pool-info-","pool-nfts-","token-balance-","allowance-","user-nfts-","buy-price-","sell-price-"],SellNFT:["pool-info-","pool-nfts-","token-balance-","user-nfts-","buy-price-","sell-price-"],PlayGame:["fortune-pool-","fortune-stats-","token-balance-","allowance-","user-fortune-history-"],ListNFT:["rental-listings-","rental-listing-","user-nfts-"],RentNFT:["rental-listing-","rental-active-","token-balance-","allowance-"],WithdrawNFT:["rental-listing-","rental-listings-","user-nfts-"],UpdateListing:["rental-listing-"],Notarize:["notary-","token-balance-","allowance-","user-documents-"],TokenTransfer:["token-balance-","allowance-"],Approval:["allowance-"]}[e];if(!a){console.warn(`[Cache] Unknown transaction type: ${e}`);return}a.forEach(n=>{this.clear(n)}),console.log(`[Cache] Invalidated patterns for ${e}:`,a)},getStats(){const e=Ce.size,t=de.hits+de.misses>0?(de.hits/(de.hits+de.misses)*100).toFixed(1):0;return{entries:e,hits:de.hits,misses:de.misses,sets:de.sets,invalidations:de.invalidations,hitRate:`${t}%`}},keys(){return Array.from(Ce.keys())},size(){return Ce.size},cleanup(){const e=Date.now();let t=0;for(const[a,n]of Ce.entries())e>n.expiresAt&&(Ce.delete(a),t++);return t>0&&console.log(`[Cache] Cleanup removed ${t} expired entries`),t},resetMetrics(){de.hits=0,de.misses=0,de.sets=0,de.invalidations=0}},ni={tokenBalance:(e,t)=>`token-balance-${e.toLowerCase()}-${t.toLowerCase()}`,ethBalance:e=>`eth-balance-${e.toLowerCase()}`,allowance:(e,t,a)=>`allowance-${e.toLowerCase()}-${t.toLowerCase()}-${a.toLowerCase()}`,campaign:e=>`campaign-${e}`,campaignList:()=>"campaign-list",charityStats:()=>"charity-stats",userCampaigns:e=>`user-campaigns-${e.toLowerCase()}`,delegation:(e,t)=>`delegation-${e.toLowerCase()}-${t}`,delegations:e=>`delegation-list-${e.toLowerCase()}`,userPStake:e=>`user-pstake-${e.toLowerCase()}`,pendingRewards:e=>`pending-rewards-${e.toLowerCase()}`,networkPStake:()=>"network-pstake",poolInfo:e=>`pool-info-${e.toLowerCase()}`,poolNfts:e=>`pool-nfts-${e.toLowerCase()}`,buyPrice:e=>`buy-price-${e.toLowerCase()}`,sellPrice:e=>`sell-price-${e.toLowerCase()}`,userNfts:e=>`user-nfts-${e.toLowerCase()}`,fortunePool:()=>"fortune-pool",fortuneTiers:()=>"fortune-tiers",fortuneStats:()=>"fortune-stats",userFortuneHistory:e=>`user-fortune-history-${e.toLowerCase()}`,rentalListings:()=>"rental-listings",rentalListing:e=>`rental-listing-${e}`,rentalActive:e=>`rental-active-${e}`,notaryDocument:e=>`notary-doc-${e}`,userDocuments:e=>`user-documents-${e.toLowerCase()}`,feeConfig:e=>`fee-config-${e}`,protocolConfig:()=>"protocol-config"},v={WRONG_NETWORK:"wrong_network",RPC_UNHEALTHY:"rpc_unhealthy",RPC_RATE_LIMITED:"rpc_rate_limited",NETWORK_ERROR:"network_error",WALLET_NOT_CONNECTED:"wallet_not_connected",WALLET_LOCKED:"wallet_locked",INSUFFICIENT_ETH:"insufficient_eth",INSUFFICIENT_TOKEN:"insufficient_token",INSUFFICIENT_ALLOWANCE:"insufficient_allowance",SIMULATION_REVERTED:"simulation_reverted",GAS_ESTIMATION_FAILED:"gas_estimation_failed",USER_REJECTED:"user_rejected",TX_REVERTED:"tx_reverted",TX_TIMEOUT:"tx_timeout",TX_REPLACED:"tx_replaced",TX_UNDERPRICED:"tx_underpriced",NONCE_ERROR:"nonce_error",CAMPAIGN_NOT_FOUND:"campaign_not_found",CAMPAIGN_NOT_ACTIVE:"campaign_not_active",CAMPAIGN_STILL_ACTIVE:"campaign_still_active",NOT_CAMPAIGN_CREATOR:"not_campaign_creator",DONATION_TOO_SMALL:"donation_too_small",MAX_CAMPAIGNS_REACHED:"max_campaigns_reached",INSUFFICIENT_ETH_FEE:"insufficient_eth_fee",LOCK_PERIOD_ACTIVE:"lock_period_active",LOCK_PERIOD_EXPIRED:"lock_period_expired",NO_REWARDS:"no_rewards",INVALID_DURATION:"invalid_duration",INVALID_DELEGATION_INDEX:"invalid_delegation_index",NFT_NOT_IN_POOL:"nft_not_in_pool",POOL_NOT_INITIALIZED:"pool_not_initialized",INSUFFICIENT_POOL_LIQUIDITY:"insufficient_pool_liquidity",SLIPPAGE_EXCEEDED:"slippage_exceeded",NFT_BOOST_MISMATCH:"nft_boost_mismatch",NOT_NFT_OWNER:"not_nft_owner",NO_ACTIVE_TIERS:"no_active_tiers",INVALID_GUESS_COUNT:"invalid_guess_count",INVALID_GUESS_RANGE:"invalid_guess_range",INSUFFICIENT_SERVICE_FEE:"insufficient_service_fee",RENTAL_STILL_ACTIVE:"rental_still_active",NFT_NOT_LISTED:"nft_not_listed",NFT_ALREADY_LISTED:"nft_already_listed",NOT_LISTING_OWNER:"not_listing_owner",MARKETPLACE_PAUSED:"marketplace_paused",EMPTY_METADATA:"empty_metadata",CONTRACT_ERROR:"contract_error",UNKNOWN:"unknown"},ii={[v.WRONG_NETWORK]:"Please switch to Arbitrum Sepolia network",[v.RPC_UNHEALTHY]:"Network connection issue. Retrying...",[v.RPC_RATE_LIMITED]:"Network is busy. Please wait a moment...",[v.NETWORK_ERROR]:"Network error. Please check your connection",[v.WALLET_NOT_CONNECTED]:"Please connect your wallet",[v.WALLET_LOCKED]:"Please unlock your wallet",[v.INSUFFICIENT_ETH]:"Insufficient ETH for gas fees",[v.INSUFFICIENT_TOKEN]:"Insufficient BKC balance",[v.INSUFFICIENT_ALLOWANCE]:"Token approval required",[v.SIMULATION_REVERTED]:"Transaction would fail. Please check your inputs",[v.GAS_ESTIMATION_FAILED]:"Could not estimate gas. Transaction may fail",[v.USER_REJECTED]:"Transaction cancelled",[v.TX_REVERTED]:"Transaction failed on blockchain",[v.TX_TIMEOUT]:"Transaction is taking too long. Please check your wallet",[v.TX_REPLACED]:"Transaction was replaced",[v.TX_UNDERPRICED]:"Gas price too low. Please try again",[v.NONCE_ERROR]:"Transaction sequence error. Please refresh and try again",[v.CAMPAIGN_NOT_FOUND]:"Campaign not found",[v.CAMPAIGN_NOT_ACTIVE]:"This campaign is no longer accepting donations",[v.CAMPAIGN_STILL_ACTIVE]:"Campaign is still active. Please wait until the deadline",[v.NOT_CAMPAIGN_CREATOR]:"Only the campaign creator can perform this action",[v.DONATION_TOO_SMALL]:"Donation amount is below the minimum required",[v.MAX_CAMPAIGNS_REACHED]:"You have reached the maximum number of active campaigns",[v.INSUFFICIENT_ETH_FEE]:"Insufficient ETH for withdrawal fee",[v.LOCK_PERIOD_ACTIVE]:"Your tokens are still locked",[v.LOCK_PERIOD_EXPIRED]:"Lock period has expired. Use normal unstake",[v.NO_REWARDS]:"No rewards available to claim",[v.INVALID_DURATION]:"Lock duration must be between 1 day and 10 years",[v.INVALID_DELEGATION_INDEX]:"Delegation not found",[v.NFT_NOT_IN_POOL]:"This NFT is not available in the pool",[v.POOL_NOT_INITIALIZED]:"Pool is not active yet",[v.INSUFFICIENT_POOL_LIQUIDITY]:"Insufficient liquidity in pool",[v.SLIPPAGE_EXCEEDED]:"Price changed too much. Please try again",[v.NFT_BOOST_MISMATCH]:"NFT tier does not match this pool",[v.NOT_NFT_OWNER]:"You do not own this NFT",[v.NO_ACTIVE_TIERS]:"No active prize tiers available",[v.INVALID_GUESS_COUNT]:"Invalid number of guesses provided",[v.INVALID_GUESS_RANGE]:"Your guess is outside the valid range",[v.INSUFFICIENT_SERVICE_FEE]:"Incorrect service fee amount",[v.RENTAL_STILL_ACTIVE]:"This NFT is currently being rented",[v.NFT_NOT_LISTED]:"This NFT is not listed for rent",[v.NFT_ALREADY_LISTED]:"This NFT is already listed",[v.NOT_LISTING_OWNER]:"Only the listing owner can perform this action",[v.MARKETPLACE_PAUSED]:"Marketplace is temporarily paused",[v.EMPTY_METADATA]:"Document metadata cannot be empty",[v.CONTRACT_ERROR]:"Transaction cannot be completed. Please check your inputs and try again",[v.UNKNOWN]:"An unexpected error occurred. Please try again"},Et={[v.WRONG_NETWORK]:{layer:1,retry:!1,action:"switch_network"},[v.RPC_UNHEALTHY]:{layer:1,retry:!0,waitMs:2e3,action:"switch_rpc"},[v.RPC_RATE_LIMITED]:{layer:1,retry:!0,waitMs:"extract",action:"switch_rpc"},[v.NETWORK_ERROR]:{layer:1,retry:!0,waitMs:3e3,action:"switch_rpc"},[v.WALLET_NOT_CONNECTED]:{layer:2,retry:!1,action:"connect_wallet"},[v.WALLET_LOCKED]:{layer:2,retry:!1,action:"unlock_wallet"},[v.INSUFFICIENT_ETH]:{layer:3,retry:!1,action:"show_faucet"},[v.INSUFFICIENT_TOKEN]:{layer:3,retry:!1},[v.INSUFFICIENT_ALLOWANCE]:{layer:3,retry:!1},[v.SIMULATION_REVERTED]:{layer:4,retry:!1},[v.GAS_ESTIMATION_FAILED]:{layer:4,retry:!0,waitMs:2e3},[v.USER_REJECTED]:{layer:5,retry:!1},[v.TX_REVERTED]:{layer:5,retry:!1},[v.TX_TIMEOUT]:{layer:5,retry:!0,waitMs:5e3},[v.TX_REPLACED]:{layer:5,retry:!1},[v.TX_UNDERPRICED]:{layer:5,retry:!0,waitMs:1e3},[v.NONCE_ERROR]:{layer:5,retry:!0,waitMs:2e3},[v.CAMPAIGN_NOT_FOUND]:{layer:4,retry:!1},[v.CAMPAIGN_NOT_ACTIVE]:{layer:4,retry:!1},[v.CAMPAIGN_STILL_ACTIVE]:{layer:4,retry:!1},[v.NOT_CAMPAIGN_CREATOR]:{layer:4,retry:!1},[v.DONATION_TOO_SMALL]:{layer:4,retry:!1},[v.MAX_CAMPAIGNS_REACHED]:{layer:4,retry:!1},[v.INSUFFICIENT_ETH_FEE]:{layer:3,retry:!1},[v.LOCK_PERIOD_ACTIVE]:{layer:4,retry:!1},[v.LOCK_PERIOD_EXPIRED]:{layer:4,retry:!1},[v.NO_REWARDS]:{layer:4,retry:!1},[v.INVALID_DURATION]:{layer:4,retry:!1},[v.INVALID_DELEGATION_INDEX]:{layer:4,retry:!1},[v.NFT_NOT_IN_POOL]:{layer:4,retry:!1},[v.POOL_NOT_INITIALIZED]:{layer:4,retry:!1},[v.INSUFFICIENT_POOL_LIQUIDITY]:{layer:4,retry:!1},[v.SLIPPAGE_EXCEEDED]:{layer:4,retry:!0,waitMs:1e3},[v.NFT_BOOST_MISMATCH]:{layer:4,retry:!1},[v.NOT_NFT_OWNER]:{layer:4,retry:!1},[v.NO_ACTIVE_TIERS]:{layer:4,retry:!1},[v.INVALID_GUESS_COUNT]:{layer:4,retry:!1},[v.INVALID_GUESS_RANGE]:{layer:4,retry:!1},[v.INSUFFICIENT_SERVICE_FEE]:{layer:4,retry:!1},[v.RENTAL_STILL_ACTIVE]:{layer:4,retry:!1},[v.NFT_NOT_LISTED]:{layer:4,retry:!1},[v.NFT_ALREADY_LISTED]:{layer:4,retry:!1},[v.NOT_LISTING_OWNER]:{layer:4,retry:!1},[v.MARKETPLACE_PAUSED]:{layer:4,retry:!1},[v.EMPTY_METADATA]:{layer:4,retry:!1},[v.CONTRACT_ERROR]:{layer:4,retry:!1},[v.UNKNOWN]:{layer:5,retry:!1}},rs=[{pattern:/user rejected/i,type:v.USER_REJECTED},{pattern:/user denied/i,type:v.USER_REJECTED},{pattern:/user cancel/i,type:v.USER_REJECTED},{pattern:/rejected by user/i,type:v.USER_REJECTED},{pattern:/cancelled/i,type:v.USER_REJECTED},{pattern:/canceled/i,type:v.USER_REJECTED},{pattern:/action_rejected/i,type:v.USER_REJECTED},{pattern:/too many errors/i,type:v.RPC_RATE_LIMITED},{pattern:/rate limit/i,type:v.RPC_RATE_LIMITED},{pattern:/retrying in/i,type:v.RPC_RATE_LIMITED},{pattern:/429/i,type:v.RPC_RATE_LIMITED},{pattern:/internal json-rpc/i,type:v.RPC_UNHEALTHY},{pattern:/-32603/i,type:v.RPC_UNHEALTHY},{pattern:/-32002/i,type:v.RPC_RATE_LIMITED},{pattern:/failed to fetch/i,type:v.NETWORK_ERROR},{pattern:/network error/i,type:v.NETWORK_ERROR},{pattern:/timeout/i,type:v.TX_TIMEOUT},{pattern:/insufficient funds/i,type:v.INSUFFICIENT_ETH},{pattern:/exceeds the balance/i,type:v.INSUFFICIENT_ETH},{pattern:/insufficient balance/i,type:v.INSUFFICIENT_TOKEN},{pattern:/transfer amount exceeds balance/i,type:v.INSUFFICIENT_TOKEN},{pattern:/exceeds balance/i,type:v.INSUFFICIENT_TOKEN},{pattern:/nonce/i,type:v.NONCE_ERROR},{pattern:/replacement.*underpriced/i,type:v.TX_UNDERPRICED},{pattern:/transaction underpriced/i,type:v.TX_UNDERPRICED},{pattern:/gas too low/i,type:v.TX_UNDERPRICED},{pattern:/reverted/i,type:v.TX_REVERTED},{pattern:/revert/i,type:v.TX_REVERTED},{pattern:/campaignnotfound/i,type:v.CAMPAIGN_NOT_FOUND},{pattern:/campaign not found/i,type:v.CAMPAIGN_NOT_FOUND},{pattern:/campaignnotactive/i,type:v.CAMPAIGN_NOT_ACTIVE},{pattern:/campaign.*not.*active/i,type:v.CAMPAIGN_NOT_ACTIVE},{pattern:/campaignstillactive/i,type:v.CAMPAIGN_STILL_ACTIVE},{pattern:/notcampaigncreator/i,type:v.NOT_CAMPAIGN_CREATOR},{pattern:/donationtoosmall/i,type:v.DONATION_TOO_SMALL},{pattern:/maxactivecampaignsreached/i,type:v.MAX_CAMPAIGNS_REACHED},{pattern:/insufficientethfee/i,type:v.INSUFFICIENT_ETH_FEE},{pattern:/lockperiodactive/i,type:v.LOCK_PERIOD_ACTIVE},{pattern:/lock.*period.*active/i,type:v.LOCK_PERIOD_ACTIVE},{pattern:/still.*locked/i,type:v.LOCK_PERIOD_ACTIVE},{pattern:/lockperiodexpired/i,type:v.LOCK_PERIOD_EXPIRED},{pattern:/norewardstoclaim/i,type:v.NO_REWARDS},{pattern:/no.*rewards/i,type:v.NO_REWARDS},{pattern:/invalidduration/i,type:v.INVALID_DURATION},{pattern:/invalidindex/i,type:v.INVALID_DELEGATION_INDEX},{pattern:/nftnotinpool/i,type:v.NFT_NOT_IN_POOL},{pattern:/poolnotinitialized/i,type:v.POOL_NOT_INITIALIZED},{pattern:/insufficientliquidity/i,type:v.INSUFFICIENT_POOL_LIQUIDITY},{pattern:/insufficientnfts/i,type:v.INSUFFICIENT_POOL_LIQUIDITY},{pattern:/slippageexceeded/i,type:v.SLIPPAGE_EXCEEDED},{pattern:/slippage/i,type:v.SLIPPAGE_EXCEEDED},{pattern:/nftboostmismatch/i,type:v.NFT_BOOST_MISMATCH},{pattern:/notnftowner/i,type:v.NOT_NFT_OWNER},{pattern:/noactivetiers/i,type:v.NO_ACTIVE_TIERS},{pattern:/invalidguesscount/i,type:v.INVALID_GUESS_COUNT},{pattern:/invalidguessrange/i,type:v.INVALID_GUESS_RANGE},{pattern:/insufficientservicefee/i,type:v.INSUFFICIENT_SERVICE_FEE},{pattern:/rentalstillactive/i,type:v.RENTAL_STILL_ACTIVE},{pattern:/nftnotlisted/i,type:v.NFT_NOT_LISTED},{pattern:/nftalreadylisted/i,type:v.NFT_ALREADY_LISTED},{pattern:/notlistingowner/i,type:v.NOT_LISTING_OWNER},{pattern:/marketplaceispaused/i,type:v.MARKETPLACE_PAUSED},{pattern:/emptymetadata/i,type:v.EMPTY_METADATA}],X={classify(e){var n;if(e!=null&&e.errorType&&Object.values(v).includes(e.errorType))return e.errorType;const t=this._extractMessage(e),a=(e==null?void 0:e.code)||((n=e==null?void 0:e.error)==null?void 0:n.code);if(a===4001||a==="ACTION_REJECTED")return v.USER_REJECTED;if(a===-32002)return v.RPC_RATE_LIMITED;if(a===-32603||a==="CALL_EXCEPTION"){if(t.includes("revert")||t.includes("require")||t.includes("execution failed")||t.includes("call_exception")||(e==null?void 0:e.code)==="CALL_EXCEPTION"){for(const{pattern:i,type:r}of rs)if(i.test(t))return r;return v.CONTRACT_ERROR}return v.RPC_UNHEALTHY}for(const{pattern:i,type:r}of rs)if(i.test(t))return r;return v.UNKNOWN},_extractMessage(e){var a,n,i;return e?typeof e=="string"?e:[e.message,e.reason,(a=e.error)==null?void 0:a.message,(n=e.error)==null?void 0:n.reason,(i=e.data)==null?void 0:i.message,e.shortMessage,this._safeStringify(e)].filter(Boolean).join(" ").toLowerCase():""},_safeStringify(e){try{return JSON.stringify(e,(t,a)=>typeof a=="bigint"?a.toString():a)}catch{return""}},isUserRejection(e){return this.classify(e)===v.USER_REJECTED},isRetryable(e){var a;const t=this.classify(e);return((a=Et[t])==null?void 0:a.retry)||!1},getWaitTime(e){const t=this.classify(e),a=Et[t];return a?a.waitMs==="extract"?this._extractWaitTime(e):a.waitMs||2e3:2e3},_extractWaitTime(e){const t=this._extractMessage(e),a=t.match(/retrying in (\d+[,.]?\d*)\s*minutes?/i);if(a){const i=parseFloat(a[1].replace(",","."));return Math.ceil(i*60*1e3)+5e3}const n=t.match(/wait (\d+)\s*seconds?/i);return n?parseInt(n[1])*1e3+2e3:3e4},getMessage(e){const t=this.classify(e);return ii[t]||ii[v.UNKNOWN]},getConfig(e){const t=this.classify(e);return Et[t]||Et[v.UNKNOWN]},getLayer(e){var a;const t=this.classify(e);return((a=Et[t])==null?void 0:a.layer)||5},handle(e,t="Transaction"){const a=this.classify(e),n=Et[a]||{},i=this.getMessage(e);return console.error(`[${t}] Error:`,{type:a,layer:n.layer,retry:n.retry,message:i,original:e}),{type:a,message:i,retry:n.retry||!1,waitMs:n.retry?this.getWaitTime(e):0,layer:n.layer||5,action:n.action||null,original:e,context:t}},async handleWithRpcSwitch(e,t="Transaction"){const a=this.handle(e,t);if(a.action==="switch_rpc")try{const{NetworkManager:n}=await W(async()=>{const{NetworkManager:r}=await Promise.resolve().then(()=>Fp);return{NetworkManager:r}},void 0);console.log("[ErrorHandler] Switching RPC due to network error...");const i=n.switchToNextRpc();try{await n.updateMetaMaskRpcs(),console.log("[ErrorHandler] MetaMask RPC updated")}catch(r){console.warn("[ErrorHandler] Could not update MetaMask:",r.message)}a.rpcSwitched=!0,a.newRpc=i,a.waitMs=Math.min(a.waitMs,2e3)}catch(n){console.warn("[ErrorHandler] Could not switch RPC:",n.message),a.rpcSwitched=!1}return a},parseSimulationError(e,t){var s;const a=this.classify(e);let n=this.getMessage(e);const r=(s={donate:{[v.CAMPAIGN_NOT_ACTIVE]:"This campaign has ended and is no longer accepting donations",[v.DONATION_TOO_SMALL]:"Minimum donation is 1 BKC"},delegate:{[v.INVALID_DURATION]:"Lock period must be between 1 day and 10 years"},playGame:{[v.INVALID_GUESS_RANGE]:"Your guess must be within the valid range for this tier"},withdraw:{[v.CAMPAIGN_STILL_ACTIVE]:"You can withdraw after the campaign deadline"},unstake:{[v.LOCK_PERIOD_ACTIVE]:"Your tokens are still locked. Use force unstake to withdraw early (penalty applies)"},claimRewards:{[v.CONTRACT_ERROR]:"No rewards available to claim",[v.NO_REWARDS]:"No rewards available to claim"}}[t])==null?void 0:s[a];return r&&(n=r),{type:a,message:n,original:e,method:t,isSimulation:!0}},create(e,t={}){const a=ii[e]||"An error occurred",n=new Error(a);return n.errorType=e,n.extra=t,n},getAction(e){var a;const t=this.classify(e);return((a=Et[t])==null?void 0:a.action)||null}},re={chainId:421614,chainIdHex:"0x66eee",name:"Arbitrum Sepolia",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},blockExplorer:"https://sepolia.arbiscan.io"};function Qe(){const e="ZWla0YY4A0Hw7e_rwyOXB";return e?`https://arb-sepolia.g.alchemy.com/v2/${e}`:null}const $p=[{name:"Alchemy",getUrl:Qe,priority:1,isPublic:!1,isPaid:!0},{name:"Arbitrum Official",getUrl:()=>"https://sepolia-rollup.arbitrum.io/rpc",priority:2,isPublic:!0,isPaid:!1},{name:"PublicNode",getUrl:()=>"https://arbitrum-sepolia-rpc.publicnode.com",priority:3,isPublic:!0,isPaid:!1},{name:"Ankr",getUrl:()=>"https://rpc.ankr.com/arbitrum_sepolia",priority:4,isPublic:!0,isPaid:!1}];let lt=0,Kt=null,Tt=null,ln=0,cn=0,Yt=!0;const Sp=3,Lp=3e4,Rp=5e3,ss=6e4,_p=2e3,ue={getCurrentRpcUrl(){const e=Qe();if(e&&Yt)return e;const t=this.getAvailableEndpoints();if(t.length===0)throw new Error("No RPC endpoints available");return t[lt%t.length].getUrl()},getPrimaryRpcUrl(){return Qe()},getAvailableEndpoints(){return $p.filter(e=>e.getUrl()!==null).sort((e,t)=>e.priority-t.priority)},getRpcUrlsForMetaMask(){const e=Qe(),t=this.getAvailableEndpoints().filter(a=>a.isPublic).map(a=>a.getUrl()).filter(Boolean);return e?[e,...t]:t},switchToNextRpc(e=!0){const t=this.getAvailableEndpoints();if(Yt&&Qe()){Yt=!1,lt=0;const i=t.find(r=>r.isPublic);if(i)return console.log(`[Network] Alchemy temporarily unavailable, using: ${i.name}`),e&&setTimeout(()=>{console.log("[Network] Retrying Alchemy..."),Yt=!0,lt=0},_p),i.getUrl()}const a=t.filter(i=>i.isPublic);if(a.length<=1)return console.warn("[Network] No alternative RPCs available"),this.getCurrentRpcUrl();lt=(lt+1)%a.length;const n=a[lt];return console.log(`[Network] Switched to RPC: ${n.name}`),n.getUrl()},resetToAlchemy(){Qe()&&(Yt=!0,lt=0,console.log("[Network] Reset to Alchemy RPC"))},isRateLimitError(e){var n;const t=((n=e==null?void 0:e.message)==null?void 0:n.toLowerCase())||"",a=e==null?void 0:e.code;return a===-32002||a===-32005||t.includes("rate limit")||t.includes("too many")||t.includes("exceeded")||t.includes("throttled")||t.includes("429")},async handleRateLimit(e){const t=this.getCurrentRpcUrl(),a=Qe();if(a&&t===a)return console.warn("[Network] Alchemy rate limited (check your plan limits)"),await new Promise(s=>setTimeout(s,1e3)),a;console.warn("[Network] Public RPC rate limited, switching...");const i=this.switchToNextRpc(),r=Date.now();if(r-cn>ss)try{await this.updateMetaMaskRpcs(),cn=r}catch(s){console.warn("[Network] Could not update MetaMask:",s.message)}return i},async getWorkingProvider(){const e=window.ethers,t=Qe();if(t)try{const n=new e.JsonRpcProvider(t);return await Promise.race([n.getBlockNumber(),new Promise((i,r)=>setTimeout(()=>r(new Error("timeout")),3e3))]),Yt=!0,n}catch(n){console.warn("[Network] Alchemy temporarily unavailable:",n.message)}const a=this.getAvailableEndpoints().filter(n=>n.isPublic);for(const n of a)try{const i=n.getUrl(),r=new e.JsonRpcProvider(i);return await Promise.race([r.getBlockNumber(),new Promise((s,o)=>setTimeout(()=>o(new Error("timeout")),3e3))]),console.log(`[Network] Using fallback RPC: ${n.name}`),r}catch{console.warn(`[Network] RPC ${n.name} failed, trying next...`)}if(t)return new e.JsonRpcProvider(t);throw new Error("No working RPC endpoints available")},async isCorrectNetwork(){if(!window.ethereum)return!1;try{const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)===re.chainId}catch(e){return console.error("[Network] Error checking network:",e),!1}},async getCurrentChainId(){if(!window.ethereum)return null;try{const e=await window.ethereum.request({method:"eth_chainId"});return parseInt(e,16)}catch{return null}},async checkRpcHealth(){const e=Date.now(),t=this.getCurrentRpcUrl();try{const a=new AbortController,n=setTimeout(()=>a.abort(),Rp),i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"eth_blockNumber",params:[],id:1}),signal:a.signal});if(clearTimeout(n),!i.ok)throw new Error(`HTTP ${i.status}`);const r=await i.json();if(r.error)throw new Error(r.error.message||"RPC error");const s=Date.now()-e;return ln=0,Tt={healthy:!0,latency:s,blockNumber:parseInt(r.result,16),timestamp:Date.now()},Tt}catch(a){ln++;const n={healthy:!1,latency:Date.now()-e,error:a.message,timestamp:Date.now()};return Tt=n,ln>=Sp&&(console.warn("[Network] Too many RPC failures, switching..."),this.switchToNextRpc(),ln=0),n}},getLastHealthCheck(){return Tt},async isRpcHealthy(e=1e4){return Tt&&Date.now()-Tt.timestamp<e?Tt.healthy:(await this.checkRpcHealth()).healthy},async switchNetwork(){if(!window.ethereum)throw X.create(v.WALLET_NOT_CONNECTED);try{return await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:re.chainIdHex}]}),console.log("[Network] Switched to",re.name),!0}catch(e){if(e.code===4902)return await this.addNetwork();throw e.code===4001?X.create(v.USER_REJECTED):e}},async addNetwork(){if(!window.ethereum)throw X.create(v.WALLET_NOT_CONNECTED);const e=this.getRpcUrlsForMetaMask();try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:re.chainIdHex,chainName:re.name,nativeCurrency:re.nativeCurrency,rpcUrls:e,blockExplorerUrls:[re.blockExplorer]}]}),console.log("[Network] Added network:",re.name),!0}catch(t){throw t.code===4001?X.create(v.USER_REJECTED):t}},async updateMetaMaskRpcs(){if(!window.ethereum)return!1;const e=Date.now();if(e-cn<ss)return console.log("[Network] MetaMask update on cooldown, skipping..."),!1;if(!await this.isCorrectNetwork())return console.log("[Network] Not on correct network, skipping RPC update"),!1;const a=this.getRpcUrlsForMetaMask();try{return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:re.chainIdHex,chainName:re.name,nativeCurrency:re.nativeCurrency,rpcUrls:a,blockExplorerUrls:[re.blockExplorer]}]}),cn=e,console.log("[Network] MetaMask RPCs updated with:",a[0]),!0}catch(n){return console.warn("[Network] Could not update MetaMask RPCs:",n.message),!1}},async forceResetMetaMaskRpc(){if(!window.ethereum)return!1;const e=Qe();if(!e)return console.warn("[Network] Alchemy not configured"),!1;try{try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x1"}]})}catch{}return await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:re.chainIdHex,chainName:re.name+" (Alchemy)",nativeCurrency:re.nativeCurrency,rpcUrls:[e],blockExplorerUrls:[re.blockExplorer]}]}),console.log("[Network] MetaMask reset to Alchemy RPC"),!0}catch(t){return console.error("[Network] Failed to reset MetaMask:",t.message),!1}},getProvider(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");return new e.JsonRpcProvider(this.getCurrentRpcUrl())},getBrowserProvider(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");if(!window.ethereum)throw X.create(v.WALLET_NOT_CONNECTED);return new e.BrowserProvider(window.ethereum)},async getSigner(){var t,a;const e=this.getBrowserProvider();try{return await e.getSigner()}catch(n){if((t=n.message)!=null&&t.includes("ENS")||n.code==="UNSUPPORTED_OPERATION")try{const i=await window.ethereum.request({method:"eth_accounts"});if(i&&i.length>0)return await e.getSigner(i[0])}catch(i){console.warn("Signer fallback failed:",i)}throw n.code===4001||(a=n.message)!=null&&a.includes("user rejected")?X.create(v.USER_REJECTED):X.create(v.WALLET_NOT_CONNECTED)}},async getConnectedAddress(){if(!window.ethereum)return null;try{return(await window.ethereum.request({method:"eth_accounts"}))[0]||null}catch{return null}},async requestConnection(){if(!window.ethereum)throw X.create(v.WALLET_NOT_CONNECTED);try{const e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e||e.length===0)throw X.create(v.WALLET_NOT_CONNECTED);return e[0]}catch(e){throw e.code===4001?X.create(v.USER_REJECTED):e}},startHealthMonitoring(e=Lp){Kt&&this.stopHealthMonitoring(),this.checkRpcHealth(),Kt=setInterval(()=>{this.checkRpcHealth()},e),console.log("[Network] Health monitoring started")},stopHealthMonitoring(){Kt&&(clearInterval(Kt),Kt=null,console.log("[Network] Health monitoring stopped"))},isMonitoring(){return Kt!==null},formatAddress(e,t=4){return e?`${e.slice(0,t+2)}...${e.slice(-t)}`:""},getAddressExplorerUrl(e){return`${re.blockExplorer}/address/${e}`},getTxExplorerUrl(e){return`${re.blockExplorer}/tx/${e}`},isMetaMaskInstalled(){return typeof window.ethereum<"u"&&window.ethereum.isMetaMask},async getStatus(){var n;const[e,t,a]=await Promise.all([this.isCorrectNetwork(),this.getConnectedAddress(),this.checkRpcHealth()]);return{isConnected:!!t,address:t,isCorrectNetwork:e,currentChainId:await this.getCurrentChainId(),targetChainId:re.chainId,rpcHealthy:a.healthy,rpcLatency:a.latency,currentRpc:((n=this.getAvailableEndpoints()[lt])==null?void 0:n.name)||"Unknown"}}},Fp=Object.freeze(Object.defineProperty({__proto__:null,NETWORK_CONFIG:re,NetworkManager:ue},Symbol.toStringTag,{value:"Module"})),qe={SAFETY_MARGIN_PERCENT:20,MIN_GAS_LIMITS:{transfer:21000n,erc20Transfer:65000n,erc20Approve:50000n,contractCall:100000n,complexCall:300000n},MAX_GAS_LIMIT:15000000n,MIN_GAS_PRICE_GWEI:.01,MAX_GAS_PRICE_GWEI:100,GAS_PRICE_CACHE_TTL:15e3},Mp={async estimateGas(e,t,a=[],n={}){try{return await e[t].estimateGas(...a,n)}catch(i){throw i}},async estimateGasWithMargin(e,t,a=[],n={}){const i=await this.estimateGas(e,t,a,n);return this.addSafetyMargin(i)},addSafetyMargin(e,t=qe.SAFETY_MARGIN_PERCENT){const a=BigInt(e),n=a*BigInt(t)/100n;let i=a+n;return i>qe.MAX_GAS_LIMIT&&(console.warn("[Gas] Estimate exceeds max limit, capping"),i=qe.MAX_GAS_LIMIT),i},getMinGasLimit(e="contractCall"){return qe.MIN_GAS_LIMITS[e]||qe.MIN_GAS_LIMITS.contractCall},async getGasPrice(){return await St.getOrFetch("gas-price-current",async()=>(await ue.getProvider().getFeeData()).gasPrice||0n,qe.GAS_PRICE_CACHE_TTL)},async getFeeData(){return await St.getOrFetch("gas-fee-data",async()=>{const a=await ue.getProvider().getFeeData();return{gasPrice:a.gasPrice||0n,maxFeePerGas:a.maxFeePerGas||0n,maxPriorityFeePerGas:a.maxPriorityFeePerGas||0n}},qe.GAS_PRICE_CACHE_TTL)},async getGasPriceGwei(){const e=window.ethers,t=await this.getGasPrice();return parseFloat(e.formatUnits(t,"gwei"))},async calculateCost(e,t=null){const a=window.ethers;t||(t=await this.getGasPrice());const n=BigInt(e)*BigInt(t),i=a.formatEther(n);return{wei:n,eth:parseFloat(i),formatted:this.formatEth(i)}},async estimateTransactionCost(e,t,a=[],n={}){const i=await this.estimateGas(e,t,a,n),r=this.addSafetyMargin(i),s=await this.getGasPrice(),o=await this.calculateCost(r,s);return{gasEstimate:i,gasWithMargin:r,gasPrice:s,...o}},async validateGasBalance(e,t,a=null){const n=window.ethers,i=ue.getProvider();a||(a=await this.getGasPrice());const r=await i.getBalance(e),s=BigInt(t)*BigInt(a),o=r>=s;return{sufficient:o,balance:r,required:s,shortage:o?0n:s-r,balanceFormatted:n.formatEther(r),requiredFormatted:n.formatEther(s)}},async hasMinimumGas(e,t=null){const a=window.ethers,i=await ue.getProvider().getBalance(e),r=t||a.parseEther("0.001");return i>=r},formatEth(e,t=6){const a=parseFloat(e);return a===0?"0 ETH":a<1e-6?"< 0.000001 ETH":`${a.toFixed(t).replace(/\.?0+$/,"")} ETH`},formatGasPrice(e){const t=window.ethers,a=parseFloat(t.formatUnits(e,"gwei"));return a<.01?"< 0.01 gwei":a<1?`${a.toFixed(2)} gwei`:`${a.toFixed(1)} gwei`},formatGasLimit(e){return Number(e).toLocaleString()},formatGasSummary(e){return`~${e.formatted} (${this.formatGasLimit(e.gasWithMargin||0n)} gas)`},compareEstimates(e,t){const a=BigInt(e),n=BigInt(t);if(n===0n)return 0;const i=a>n?a-n:n-a;return Number(i*100n/n)},isGasPriceReasonable(e){const t=window.ethers,a=parseFloat(t.formatUnits(e,"gwei"));return a<qe.MIN_GAS_PRICE_GWEI?{reasonable:!1,warning:"Gas price unusually low, transaction may be slow"}:a>qe.MAX_GAS_PRICE_GWEI?{reasonable:!1,warning:"Gas price unusually high, consider waiting"}:{reasonable:!0,warning:null}},async getRecommendedSettings(e){const t=await this.getFeeData();return{gasLimit:this.addSafetyMargin(e),maxFeePerGas:t.maxFeePerGas,maxPriorityFeePerGas:t.maxPriorityFeePerGas}},async createTxOverrides(e,t={}){return{gasLimit:(await this.getRecommendedSettings(e)).gasLimit,...t}}},os=500000000000000n,ls=["function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)"],ee={async validateNetwork(){if(!await ue.isCorrectNetwork()){const t=await ue.getCurrentChainId();throw X.create(v.WRONG_NETWORK,{currentChainId:t,expectedChainId:re.chainId})}},async validateRpcHealth(){const e=await ue.checkRpcHealth();if(!e.healthy&&(ue.switchToNextRpc(),!(await ue.checkRpcHealth()).healthy))throw X.create(v.RPC_UNHEALTHY,{error:e.error})},async validateWalletConnected(e=null){if(!window.ethereum)throw X.create(v.WALLET_NOT_CONNECTED);const t=e||await ue.getConnectedAddress();if(!t)throw X.create(v.WALLET_NOT_CONNECTED);return t},async validatePreTransaction(){return await this.validateNetwork(),await this.validateRpcHealth(),await this.validateWalletConnected()},async validateEthForGas(e,t=os){const a=window.ethers,n=ni.ethBalance(e),i=await St.getOrFetch(n,async()=>await ue.getProvider().getBalance(e),ai.BALANCE);if(i<t)throw X.create(v.INSUFFICIENT_ETH,{balance:a.formatEther(i),required:a.formatEther(t)});return i},async validateTokenBalance(e,t,a){const n=window.ethers,i=ni.tokenBalance(e,a),r=await St.getOrFetch(i,async()=>{const s=ue.getProvider();return await new n.Contract(e,ls,s).balanceOf(a)},ai.BALANCE);if(r<t)throw X.create(v.INSUFFICIENT_TOKEN,{balance:n.formatEther(r),required:n.formatEther(t)});return r},async needsApproval(e,t,a,n){const i=window.ethers,r=ni.allowance(e,n,t);return await St.getOrFetch(r,async()=>{const o=ue.getProvider();return await new i.Contract(e,ls,o).allowance(n,t)},ai.ALLOWANCE)<a},async validateAllowance(e,t,a,n){if(await this.needsApproval(e,t,a,n))throw X.create(v.INSUFFICIENT_ALLOWANCE,{token:e,spender:t,required:a.toString()})},async validateBalances({userAddress:e,tokenAddress:t=null,tokenAmount:a=null,spenderAddress:n=null,ethAmount:i=os}){await this.validateEthForGas(e,i),t&&a&&await this.validateTokenBalance(t,a,e)},validatePositive(e,t="Amount"){if(BigInt(e)<=0n)throw new Error(`${t} must be greater than zero`)},validateRange(e,t,a,n="Value"){const i=BigInt(e),r=BigInt(t),s=BigInt(a);if(i<r||i>s)throw new Error(`${n} must be between ${t} and ${a}`)},validateNotEmpty(e,t="Field"){if(!e||e.trim().length===0)throw new Error(`${t} cannot be empty`)},validateAddress(e,t="Address"){const a=window.ethers;if(!e||!a.isAddress(e))throw new Error(`Invalid ${t}`)},charity:{validateCreateCampaign({title:e,description:t,goalAmount:a,durationDays:n}){ee.validateNotEmpty(e,"Title"),ee.validateNotEmpty(t,"Description"),ee.validatePositive(a,"Goal amount"),ee.validateRange(n,1,180,"Duration")},validateDonate({campaignId:e,amount:t}){if(e==null)throw new Error("Campaign ID is required");ee.validatePositive(t,"Donation amount")}},staking:{validateDelegate({amount:e,lockDays:t}){ee.validatePositive(e,"Stake amount"),ee.validateRange(t,1,3650,"Lock duration")},validateUnstake({delegationIndex:e}){if(e==null||e<0)throw new Error("Invalid delegation index")}},nftPool:{validateBuy({maxPrice:e}){e!=null&&ee.validatePositive(e,"Max price")},validateSell({tokenId:e,minPayout:t}){if(e==null)throw new Error("Token ID is required");t!=null&&ee.validatePositive(t,"Min payout")}},fortune:{validatePlay({wagerAmount:e,guesses:t,isCumulative:a}){if(ee.validatePositive(e,"Wager amount"),!Array.isArray(t)||t.length===0)throw new Error("At least one guess is required");t.forEach((n,i)=>{if(typeof n!="number"||n<1)throw new Error(`Invalid guess at position ${i+1}`)})}},rental:{validateList({tokenId:e,pricePerHour:t,minHours:a,maxHours:n}){if(e==null)throw new Error("Token ID is required");ee.validatePositive(t,"Price per hour"),ee.validateRange(a,1,720,"Minimum hours"),ee.validateRange(n,a,720,"Maximum hours")},validateRent({tokenId:e,hours:t}){if(e==null)throw new Error("Token ID is required");ee.validatePositive(t,"Rental hours")}},notary:{validateNotarize({ipfsCid:e,description:t,contentHash:a}){if(ee.validateNotEmpty(e,"IPFS CID"),a&&(a.startsWith("0x")?a.slice(2):a).length!==64)throw new Error("Content hash must be 32 bytes")}}},dn={DEFAULT_MAX_RETRIES:2,RETRY_BASE_DELAY:2e3,APPROVAL_MULTIPLIER:10n,APPROVAL_WAIT_TIME:1500,CONFIRMATION_TIMEOUT:6e4,CONFIRMATION_RETRY_DELAY:3e3,GAS_SAFETY_MARGIN:20,DEFAULT_GAS_LIMIT:500000n},cs=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)"];class Dp{constructor(t,a,n=!0){this.button=t,this.txName=a,this.showToasts=n,this.originalContent=null,this.originalDisabled=!1,this.button&&(this.originalContent=this.button.innerHTML,this.originalDisabled=this.button.disabled)}setPhase(t){if(!this.button)return;const n={validating:{text:"Validating...",icon:"ðŸ”"},approving:{text:"Approving...",icon:"âœ…"},simulating:{text:"Simulating...",icon:"ðŸ§ª"},confirming:{text:"Confirm in Wallet",icon:"ðŸ‘›"},waiting:{text:"Processing...",icon:"â³"},success:{text:"Success!",icon:"ðŸŽ‰"},error:{text:"Failed",icon:"âŒ"}}[t]||{text:t,icon:"â³"};this.button.disabled=!0,this.button.innerHTML=`
            <span class="tx-status">
                <span class="tx-icon">${n.icon}</span>
                <span class="tx-text">${n.text}</span>
            </span>
        `}setRetry(t,a){this.button&&(this.button.innerHTML=`
            <span class="tx-status">
                <span class="tx-icon">ðŸ”„</span>
                <span class="tx-text">Retry ${t}/${a}...</span>
            </span>
        `)}cleanup(){this.button&&(this.button.innerHTML=this.originalContent,this.button.disabled=this.originalDisabled)}showSuccess(t=2e3){this.setPhase("success"),setTimeout(()=>this.cleanup(),t)}showError(t=2e3){this.setPhase("error"),setTimeout(()=>this.cleanup(),t)}}class Op{constructor(){this.pendingTxIds=new Set}_resolveArgs(t){return typeof t=="function"?t():t||[]}_resolveApproval(t){return t?typeof t=="object"?{token:t.token,spender:t.spender,amount:t.amount}:t:null}_validateContractMethod(t,a){if(!t)throw new Error("Contract instance is null or undefined");if(typeof t[a]!="function"){const n=Object.keys(t).filter(i=>typeof t[i]=="function").filter(i=>!i.startsWith("_")&&!["on","once","emit","removeListener"].includes(i)).slice(0,15);throw console.error(`[TX] Contract method "${a}" not found!`),console.error("[TX] Available methods:",n),new Error(`Contract method "${a}" not found. This usually means the ABI doesn't match the contract. Available methods: ${n.join(", ")}`)}return typeof t[a].estimateGas!="function"&&console.warn(`[TX] Method ${a} exists but estimateGas is not available`),!0}async execute(t){var N,P;const{name:a,txId:n=null,button:i=null,showToasts:r=!0,getContract:s,method:o,args:l=[],approval:c=null,validate:u=null,onSuccess:f=null,onError:p=null,maxRetries:b=dn.DEFAULT_MAX_RETRIES,invalidateCache:m=!0,skipSimulation:x=!1,fixedGasLimit:y=dn.DEFAULT_GAS_LIMIT}=t,C=n||`${a}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;if(this.pendingTxIds.has(C))return console.warn(`[TX] Transaction ${C} already in progress`),{success:!1,reason:"DUPLICATE_TX",message:"Transaction already in progress"};this.pendingTxIds.add(C);const A=new Dp(i,a,r);try{A.setPhase("validating"),console.log(`[TX] Starting: ${a}`),await ee.validateNetwork(),await ee.validateRpcHealth();const z=await ee.validateWalletConnected();console.log(`[TX] User address: ${z}`);const I=await ue.getSigner();console.log("[TX] Signer obtained");try{await ee.validateEthForGas(z)}catch(q){console.warn("[TX] ETH gas validation failed, continuing anyway:",q.message)}const F=this._resolveApproval(c);F&&F.amount>0n&&await ee.validateTokenBalance(F.token,F.amount,z),u&&(console.log("[TX] Running custom validation..."),await u(I,z));const K=this._resolveApproval(t.approval);K&&K.amount>0n&&await ee.needsApproval(K.token,K.spender,K.amount,z)&&(A.setPhase("approving"),console.log("[TX] Requesting token approval..."),await this._executeApproval(K,I,z),St.clear("allowance-")),console.log("[TX] Getting contract instance...");const pe=await s(I);this._validateContractMethod(pe,o),console.log(`[TX] Contract method "${o}" validated`);const Ee=t.value;Ee&&console.log("[TX] Transaction value (ETH):",Ee.toString());const le=Ee?{value:Ee}:{},ae=this._resolveArgs(l);console.log("[TX] Args resolved:",ae.map(q=>typeof q=="bigint"?q.toString():typeof q=="string"&&q.length>50?q.substring(0,50)+"...":q));let H;if(x)console.log(`[TX] Skipping simulation, using fixed gas limit: ${y}`),H=y;else{A.setPhase("simulating"),console.log("[TX] Simulating transaction...");try{if(!pe[o]||typeof pe[o].estimateGas!="function")throw new Error(`estimateGas not available for method "${o}"`);H=await pe[o].estimateGas(...ae,le),console.log(`[TX] Gas estimate: ${H.toString()}`)}catch(q){if(console.error("[TX] Simulation failed:",q.message),(N=q.message)!=null&&N.includes("not found")||(P=q.message)!=null&&P.includes("undefined"))throw new Error(`Contract method "${o}" is not callable. Check that the ABI matches the deployed contract.`);const ga=X.parseSimulationError(q,o);throw X.create(ga.type,{message:ga.message,original:q})}}A.setPhase("confirming"),console.log("[TX] Requesting signature...");const Z=Mp.addSafetyMargin(H),Te={...le,gasLimit:Z};try{const q=await I.provider.getFeeData();q.maxFeePerGas&&(Te.maxFeePerGas=q.maxFeePerGas*120n/100n,Te.maxPriorityFeePerGas=q.maxPriorityFeePerGas||0n)}catch{}const Q=this._resolveArgs(l),me=await this._executeWithRetry(()=>pe[o](...Q,Te),{maxRetries:b,ui:A,signer:I,name:a});console.log(`[TX] Transaction submitted: ${me.hash}`),A.setPhase("waiting"),console.log("[TX] Waiting for confirmation...");const ne=await this._waitForConfirmation(me,I.provider);if(console.log(`[TX] Confirmed in block ${ne.blockNumber}`),A.showSuccess(),m&&St.invalidateByTx(a),f)try{await f(ne)}catch(q){console.warn("[TX] onSuccess callback error:",q)}return{success:!0,receipt:ne,txHash:ne.hash||me.hash,blockNumber:ne.blockNumber}}catch(z){console.error("[TX] Error:",(z==null?void 0:z.message)||z),i&&(console.log("[TX] Restoring button..."),i.disabled=!1,A.originalContent&&(i.innerHTML=A.originalContent));let I;try{I=await X.handleWithRpcSwitch(z,a),I.rpcSwitched&&console.log(`[TX] RPC switched to: ${I.newRpc}`)}catch(F){console.warn("[TX] Error in handleWithRpcSwitch:",F),I=X.handle(z,a)}if(I.type!==v.USER_REJECTED&&i&&!p){const F=A.originalContent;i.innerHTML='<span style="display:flex;align-items:center;justify-content:center;gap:8px"><span>âŒ</span><span>Failed</span></span>',setTimeout(()=>{i&&(i.innerHTML=F)},1500)}if(p)try{p(I)}catch(F){console.warn("[TX] onError callback error:",F)}return{success:!1,error:I,message:I.message,cancelled:I.type===v.USER_REJECTED}}finally{this.pendingTxIds.delete(C),setTimeout(()=>{i&&i.disabled&&(console.log("[TX] Safety cleanup triggered"),A.cleanup())},5e3)}}async _executeApproval(t,a,n){const i=window.ethers,{token:r,spender:s,amount:o}=t;console.log(`[TX] Approving ${i.formatEther(o)} tokens...`);const l=new i.Contract(r,cs,a),c=o*dn.APPROVAL_MULTIPLIER;try{let u={};try{const y=await a.provider.getFeeData();y.maxFeePerGas&&(u.maxFeePerGas=y.maxFeePerGas*120n/100n,u.maxPriorityFeePerGas=y.maxPriorityFeePerGas||0n)}catch{}const f=await l.approve(s,c,u),p=ue.getProvider();let b=null;for(let y=0;y<30&&(await new Promise(C=>setTimeout(C,1500)),b=await p.getTransactionReceipt(f.hash),!b);y++);if(b||(b=await f.wait()),b.status===0)throw new Error("Approval transaction reverted");if(console.log("[TX] Approval confirmed"),await new Promise(y=>setTimeout(y,dn.APPROVAL_WAIT_TIME)),await new i.Contract(r,cs,p).allowance(n,s)<o)throw new Error("Approval not reflected on-chain")}catch(u){throw X.isUserRejection(u)?X.create(v.USER_REJECTED):u}}async _executeWithRetry(t,{maxRetries:a,ui:n,signer:i,name:r}){let s;for(let o=1;o<=a+1;o++)try{return o>1&&(n.setRetry(o,a+1),console.log(`[TX] Retry ${o}/${a+1}`),(await ue.checkRpcHealth()).healthy||(console.log("[TX] RPC unhealthy, switching..."),ue.switchToNextRpc(),await new Promise(c=>setTimeout(c,2e3)))),await t()}catch(l){if(s=l,X.isUserRejection(l)||!X.isRetryable(l)||o===a+1)throw l;const c=X.getWaitTime(l);console.log(`[TX] Waiting ${c}ms before retry...`),await new Promise(u=>setTimeout(u,c))}throw s}async _waitForConfirmation(t,a){const n=ue.getProvider();try{const i=await Promise.race([t.wait(),new Promise((r,s)=>setTimeout(()=>s(new Error("wait_timeout")),1e4))]);if(i.status===1)return i;if(i.status===0)throw new Error("Transaction reverted on-chain");return i}catch(i){console.warn("[TX] tx.wait() issue, using Alchemy to check:",i.message);for(let r=0;r<20;r++){await new Promise(o=>setTimeout(o,1500));const s=await n.getTransactionReceipt(t.hash);if(s&&s.status===1)return console.log("[TX] Confirmed via Alchemy"),s;if(s&&s.status===0)throw new Error("Transaction reverted on-chain")}return console.warn("[TX] Could not verify receipt, assuming success"),{hash:t.hash,status:1,blockNumber:0}}}isPending(t){return this.pendingTxIds.has(t)}getPendingCount(){return this.pendingTxIds.size}clearPending(){this.pendingTxIds.clear()}}const O=new Op,Fn="bkc_operator",Ot="0x0000000000000000000000000000000000000000";function er(){var t;const e=window.ethers;try{const a=localStorage.getItem(Fn);if(a&&tt(a))return Xt(a);if(window.BACKCHAIN_OPERATOR&&tt(window.BACKCHAIN_OPERATOR))return Xt(window.BACKCHAIN_OPERATOR);if((t=window.addresses)!=null&&t.operator&&tt(window.addresses.operator))return Xt(window.addresses.operator)}catch(a){console.warn("[Operator] Error getting operator:",a)}return(e==null?void 0:e.ZeroAddress)||Ot}function V(e){const t=window.ethers,a=(t==null?void 0:t.ZeroAddress)||Ot;return e===null?a:e&&tt(e)?Xt(e):er()}function Hp(e){if(!e)return Eo(),!0;if(!tt(e))return console.warn("[Operator] Invalid address:",e),!1;try{const t=Xt(e);return localStorage.setItem(Fn,t),window.BACKCHAIN_OPERATOR=t,window.dispatchEvent(new CustomEvent("operatorChanged",{detail:{address:t}})),console.log("[Operator] Set to:",t),!0}catch(t){return console.error("[Operator] Error setting:",t),!1}}function Eo(){try{localStorage.removeItem(Fn),delete window.BACKCHAIN_OPERATOR,window.dispatchEvent(new CustomEvent("operatorChanged",{detail:{address:null}})),console.log("[Operator] Cleared")}catch(e){console.warn("[Operator] Error clearing:",e)}}function Up(){const e=window.ethers,t=(e==null?void 0:e.ZeroAddress)||Ot,a=er();return a&&a!==t}function jp(){var n;const e=window.ethers,t=(e==null?void 0:e.ZeroAddress)||Ot,a=localStorage.getItem(Fn);return a&&tt(a)?{address:a,source:"localStorage",isSet:!0}:window.BACKCHAIN_OPERATOR&&tt(window.BACKCHAIN_OPERATOR)?{address:window.BACKCHAIN_OPERATOR,source:"global",isSet:!0}:(n=window.addresses)!=null&&n.operator&&tt(window.addresses.operator)?{address:window.addresses.operator,source:"config",isSet:!0}:{address:t,source:"none",isSet:!1}}function tt(e){const t=window.ethers;return!e||typeof e!="string"||!e.match(/^0x[a-fA-F0-9]{40}$/)?!1:t!=null&&t.isAddress?t.isAddress(e):!0}function Xt(e){const t=window.ethers;if(!e)return(t==null?void 0:t.ZeroAddress)||Ot;try{if(t!=null&&t.getAddress)return t.getAddress(e)}catch{}return e}function Wp(e){const t=window.ethers,a=(t==null?void 0:t.ZeroAddress)||Ot;return!e||e===a?"None":`${e.slice(0,6)}...${e.slice(-4)}`}const Gp={get:er,set:Hp,clear:Eo,has:Up,resolve:V,info:jp,isValid:tt,normalize:Xt,short:Wp,ZERO:Ot};window.Operator=Gp;function Ga(){var a,n;const e=(w==null?void 0:w.charityPool)||(L==null?void 0:L.charityPool)||((a=window.contractAddresses)==null?void 0:a.charityPool),t=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw console.error("âŒ CharityPool address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,CHARITY_POOL:e}}const Ka=["function createCampaign(string calldata _title, string calldata _description, uint96 _goalAmount, uint256 _durationDays, address _operator) external returns (uint256 campaignId)","function donate(uint256 _campaignId, address _operator) external payable","function cancelCampaign(uint256 _campaignId) external","function withdraw(uint256 _campaignId, address _operator) external","function boostCampaign(uint256 _campaignId, address _operator) external payable","function campaigns(uint256 campaignId) view returns (address creator, uint96 goalAmount, uint96 raisedAmount, uint32 donationCount, uint64 deadline, uint64 createdAt, uint96 boostAmount, uint64 boostTime, uint8 status)","function campaignTitles(uint256 campaignId) view returns (string)","function campaignDescriptions(uint256 campaignId) view returns (string)","function getCampaign(uint256 _campaignId) view returns (address creator, string title, string description, uint96 goalAmount, uint96 raisedAmount, uint32 donationCount, uint64 deadline, uint64 createdAt, uint96 boostAmount, uint64 boostTime, uint8 status, bool goalReached)","function donations(uint256 donationId) view returns (address donor, uint64 campaignId, uint96 grossAmount, uint96 netAmount, uint64 timestamp)","function getDonation(uint256 _donationId) view returns (tuple(address donor, uint64 campaignId, uint96 grossAmount, uint96 netAmount, uint64 timestamp))","function getCampaignDonations(uint256 _campaignId) view returns (uint256[])","function getUserDonations(address _user) view returns (uint256[])","function getUserCampaigns(address _user) view returns (uint256[])","function userActiveCampaigns(address user) view returns (uint8)","function maxActiveCampaigns() view returns (uint8)","function createCostBkc() view returns (uint96)","function withdrawCostBkc() view returns (uint96)","function donationFeeBips() view returns (uint16)","function boostCostBkc() view returns (uint96)","function boostCostEth() view returns (uint96)","function getFeeConfig() view returns (uint96 createBkc, uint96 withdrawBkc, uint16 donationBips, uint96 boostBkc, uint96 boostEth)","function campaignCounter() view returns (uint64)","function donationCounter() view returns (uint64)","function totalRaisedAllTime() view returns (uint256)","function totalDonationsAllTime() view returns (uint256)","function totalFeesCollected() view returns (uint256)","function getStats() view returns (uint64 totalCampaigns, uint256 totalRaised, uint256 totalDonations, uint256 totalFees)","function previewDonation(uint256 _amount) view returns (uint256 netToCampaign, uint256 feeToProtocol)","function canWithdraw(uint256 _campaignId) view returns (bool allowed, string reason)","function isBoosted(uint256 _campaignId) view returns (bool)","function version() view returns (string)","event CampaignCreated(uint256 indexed campaignId, address indexed creator, uint96 goalAmount, uint64 deadline, address operator)","event DonationMade(uint256 indexed campaignId, uint256 indexed donationId, address indexed donor, uint96 grossAmount, uint96 netAmount, uint96 feeAmount, address operator)","event CampaignBoosted(uint256 indexed campaignId, address indexed booster, uint96 bkcAmount, uint96 ethAmount, address operator)","event CampaignCancelled(uint256 indexed campaignId, address indexed creator, uint96 raisedAmount)","event FundsWithdrawn(uint256 indexed campaignId, address indexed creator, uint96 amount, address operator)","event ConfigUpdated()"],ca={ACTIVE:0,COMPLETED:1,CANCELLED:2,WITHDRAWN:3};function Ve(e){const t=window.ethers,a=Ga();return new t.Contract(a.CHARITY_POOL,Ka,e)}async function ve(){const e=window.ethers,{NetworkManager:t}=await W(async()=>{const{NetworkManager:i}=await import("./index-Jv5HScoX.js");return{NetworkManager:i}},[]),a=t.getProvider(),n=Ga();return new e.Contract(n.CHARITY_POOL,Ka,a)}async function To({title:e,description:t,goalAmount:a,durationDays:n,operator:i,button:r=null,onSuccess:s=null,onError:o=null}){const l=window.ethers;if(!e||e.trim().length===0)throw new Error("Title is required");if(e.length>100)throw new Error("Title must be 100 characters or less");if(t&&t.length>1e3)throw new Error("Description must be 1000 characters or less");if(n<1||n>180)throw new Error("Duration must be between 1 and 180 days");const c=BigInt(a);if(c<=0n)throw new Error("Goal amount must be greater than 0");let u=e,f=t||"",p=i,b=0n;return await O.execute({name:"CreateCampaign",button:r,getContract:async m=>Ve(m),method:"createCampaign",args:()=>[u,f,c,BigInt(n),V(p)],get approval(){if(b>0n){const m=Ga();return{token:m.BKC_TOKEN,spender:m.CHARITY_POOL,amount:b}}return null},validate:async(m,x)=>{const y=Ve(m);try{const C=await y.userActiveCampaigns(x),A=await y.maxActiveCampaigns();if(Number(C)>=Number(A))throw new Error(`Maximum active campaigns reached (${A})`)}catch(C){if(C.message.includes("Maximum"))throw C}try{b=await y.createCostBkc()}catch{b=l.parseEther("1")}},onSuccess:async m=>{let x=null;try{const y=new l.Interface(Ka);for(const C of m.logs)try{const A=y.parseLog(C);if(A.name==="CampaignCreated"){x=Number(A.args.campaignId);break}}catch{}}catch{}s&&s(m,x)},onError:o})}async function Co({campaignId:e,amount:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers;if(e==null)throw new Error("Campaign ID is required");const o=BigInt(t);if(o<=0n)throw new Error("Donation amount must be greater than 0");let l=e,c=a;return await O.execute({name:"Donate",button:n,getContract:async u=>Ve(u),method:"donate",args:()=>[l,V(c)],value:o,validate:async(u,f)=>{const p=Ve(u);try{const b=await p.getCampaign(l);if(b.creator===s.ZeroAddress)throw new Error("Campaign not found");if(Number(b.status)!==ca.ACTIVE)throw new Error("Campaign is not active");const m=Math.floor(Date.now()/1e3);if(Number(b.deadline)<=m)throw new Error("Campaign has ended")}catch(b){if(b.message.includes("Campaign")||b.message.includes("active")||b.message.includes("ended"))throw b}},onSuccess:async u=>{let f=null;try{const p=new s.Interface(Ka);for(const b of u.logs)try{const m=p.parseLog(b);if(m.name==="DonationMade"){f={donationId:Number(m.args.donationId),grossAmount:m.args.grossAmount,netAmount:m.args.netAmount,feeAmount:m.args.feeAmount};break}}catch{}}catch{}i&&i(u,f)},onError:r})}async function Io({campaignId:e,button:t=null,onSuccess:a=null,onError:n=null}){const i=window.ethers;if(e==null)throw new Error("Campaign ID is required");let r=e;return await O.execute({name:"CancelCampaign",button:t,getContract:async s=>Ve(s),method:"cancelCampaign",args:[r],validate:async(s,o)=>{const l=Ve(s);try{const c=await l.getCampaign(r);if(c.creator===i.ZeroAddress)throw new Error("Campaign not found");if(c.creator.toLowerCase()!==o.toLowerCase())throw new Error("Only the campaign creator can cancel");if(Number(c.status)!==ca.ACTIVE)throw new Error("Campaign is not active")}catch(c){if(c.message.includes("Campaign")||c.message.includes("creator")||c.message.includes("active"))throw c}},onSuccess:a,onError:n})}async function Ao({campaignId:e,operator:t,button:a=null,onSuccess:n=null,onError:i=null}){const r=window.ethers;if(e==null)throw new Error("Campaign ID is required");let s=e,o=t,l=0n;return await O.execute({name:"Withdraw",button:a,getContract:async c=>Ve(c),method:"withdraw",args:()=>[s,V(o)],get approval(){if(l>0n){const c=Ga();return{token:c.BKC_TOKEN,spender:c.CHARITY_POOL,amount:l}}return null},validate:async(c,u)=>{const f=Ve(c);try{const p=await f.getCampaign(s);if(p.creator===r.ZeroAddress)throw new Error("Campaign not found");if(p.creator.toLowerCase()!==u.toLowerCase())throw new Error("Only the campaign creator can withdraw");if(Number(p.status)===ca.WITHDRAWN)throw new Error("Funds already withdrawn");const[b,m]=await f.canWithdraw(s);if(!b)throw new Error(m||"Cannot withdraw yet")}catch(p){if(p.message)throw p}try{l=await f.withdrawCostBkc()}catch{l=r.parseEther("0.5")}},onSuccess:async c=>{let u=null;try{const f=new r.Interface(Ka);for(const p of c.logs)try{const b=f.parseLog(p);if(b.name==="FundsWithdrawn"){u={amount:b.args.amount};break}}catch{}}catch{}n&&n(c,u)},onError:i})}async function Bo({campaignId:e,ethAmount:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers;if(e==null)throw new Error("Campaign ID is required");let o=e,l=a,c=0n,u=t?BigInt(t):0n;return await O.execute({name:"BoostCampaign",button:n,getContract:async f=>Ve(f),method:"boostCampaign",args:()=>[o,V(l)],get value(){return u},get approval(){if(c>0n){const f=Ga();return{token:f.BKC_TOKEN,spender:f.CHARITY_POOL,amount:c}}return null},validate:async(f,p)=>{const b=Ve(f);try{const m=await b.getCampaign(o);if(m.creator===s.ZeroAddress)throw new Error("Campaign not found");if(Number(m.status)!==ca.ACTIVE)throw new Error("Campaign is not active")}catch(m){if(m.message.includes("Campaign")||m.message.includes("active"))throw m}try{c=await b.boostCostBkc(),t||(u=await b.boostCostEth())}catch{c=s.parseEther("0.5"),t||(u=s.parseEther("0.001"))}},onSuccess:i,onError:r})}async function zo(e){const a=await(await ve()).getCampaign(e),n=Math.floor(Date.now()/1e3);return{id:e,creator:a.creator,title:a.title,description:a.description,goalAmount:a.goalAmount,raisedAmount:a.raisedAmount,donationCount:Number(a.donationCount),deadline:Number(a.deadline),createdAt:Number(a.createdAt),boostAmount:a.boostAmount,boostTime:Number(a.boostTime),status:Number(a.status),statusName:["ACTIVE","COMPLETED","CANCELLED","WITHDRAWN"][Number(a.status)]||"UNKNOWN",goalReached:a.goalReached,progress:a.goalAmount>0n?Number(a.raisedAmount*100n/a.goalAmount):0,isEnded:Number(a.deadline)<n,isActive:Number(a.status)===ca.ACTIVE&&Number(a.deadline)>n,isBoosted:a.boostTime>0&&n-Number(a.boostTime)<86400}}async function Po(e){const t=window.ethers,n=await(await ve()).getDonation(e);return{id:e,donor:n.donor,campaignId:Number(n.campaignId),grossAmount:n.grossAmount,netAmount:n.netAmount,timestamp:Number(n.timestamp),grossFormatted:t.formatEther(n.grossAmount),netFormatted:t.formatEther(n.netAmount)}}async function No(){const e=await ve();return Number(await e.campaignCounter())}async function $o(){const e=await ve();return Number(await e.donationCounter())}async function So(e){const t=await ve();return Number(await t.userActiveCampaigns(e))}async function Lo(){const e=await ve();return Number(await e.maxActiveCampaigns())}async function Ro(e){return(await(await ve()).getUserCampaigns(e)).map(n=>Number(n))}async function _o(e){return(await(await ve()).getUserDonations(e)).map(n=>Number(n))}async function Fo(e){return(await(await ve()).getCampaignDonations(e)).map(n=>Number(n))}async function Mo(e){const t=window.ethers,n=await(await ve()).previewDonation(e);return{netToCampaign:n.netToCampaign,feeToProtocol:n.feeToProtocol,netFormatted:t.formatEther(n.netToCampaign),feeFormatted:t.formatEther(n.feeToProtocol)}}async function Do(e){const t=await ve(),[a,n]=await t.canWithdraw(e);return{allowed:a,reason:n}}async function Oo(e){return await(await ve()).isBoosted(e)}async function Ho(){const e=window.ethers,a=await(await ve()).getFeeConfig();return{createCostBkc:a.createBkc,createCostFormatted:e.formatEther(a.createBkc),withdrawCostBkc:a.withdrawBkc,withdrawCostFormatted:e.formatEther(a.withdrawBkc),donationFeeBips:Number(a.donationBips),donationFeePercent:Number(a.donationBips)/100,boostCostBkc:a.boostBkc,boostCostBkcFormatted:e.formatEther(a.boostBkc),boostCostEth:a.boostEth,boostCostEthFormatted:e.formatEther(a.boostEth)}}async function Uo(){const e=window.ethers,a=await(await ve()).getStats();return{totalCampaigns:Number(a.totalCampaigns),totalRaised:a.totalRaised,totalRaisedFormatted:e.formatEther(a.totalRaised),totalDonations:Number(a.totalDonations),totalFees:a.totalFees,totalFeesFormatted:e.formatEther(a.totalFees)}}async function jo(){const e=await ve();try{return await e.withdrawCostBkc()}catch{return 0n}}async function Wo(){const e=await ve();try{return await e.createCostBkc()}catch{return 0n}}const Ht={createCampaign:To,donate:Co,cancelCampaign:Io,withdraw:Ao,boostCampaign:Bo,getCampaign:zo,getCampaignCount:No,getCampaignDonations:Fo,canWithdraw:Do,isBoosted:Oo,getDonation:Po,getDonationCount:$o,previewDonation:Mo,getUserActiveCampaigns:So,getMaxActiveCampaigns:Lo,getUserCampaigns:Ro,getUserDonations:_o,getFeeConfig:Ho,getStats:Uo,getWithdrawalFee:jo,getCreateFee:Wo,CampaignStatus:ca},Kp=Object.freeze(Object.defineProperty({__proto__:null,CharityTx:Ht,boostCampaign:Bo,canWithdraw:Do,cancelCampaign:Io,createCampaign:To,donate:Co,getCampaign:zo,getCampaignCount:No,getCampaignDonations:Fo,getCreateFee:Wo,getDonation:Po,getDonationCount:$o,getFeeConfig:Ho,getMaxActiveCampaigns:Lo,getStats:Uo,getUserActiveCampaigns:So,getUserCampaigns:Ro,getUserDonations:_o,getWithdrawalFee:jo,isBoosted:Oo,previewDonation:Mo,withdraw:Ao},Symbol.toStringTag,{value:"Module"}));function tr(){var a,n;const e=(w==null?void 0:w.delegationManager)||(L==null?void 0:L.delegationManager)||((a=window.contractAddresses)==null?void 0:a.delegationManager),t=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw console.error("âŒ DelegationManager address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");if(!t)throw console.error("âŒ BKC Token address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,DELEGATION_MANAGER:e}}const Go=["function delegate(uint256 amount, uint256 lockDuration, address operator) external","function unstake(uint256 delegationIndex, address operator) external","function forceUnstake(uint256 delegationIndex, address operator) external","function claimReward(address operator) external payable","function getDelegationsOf(address user) view returns (tuple(uint256 amount, uint64 unlockTime, uint64 lockDuration)[])","function pendingRewards(address user) view returns (uint256)","function userTotalPStake(address user) view returns (uint256)","function totalNetworkPStake() view returns (uint256)","function MIN_LOCK_DURATION() view returns (uint256)","function MAX_LOCK_DURATION() view returns (uint256)","function claimEthFee() view returns (uint256)","function getUserBestBoost(address user) view returns (uint256)","function getBurnRateForBoost(uint256 boost) view returns (uint256)","function previewClaim(address user) view returns (uint256 totalRewards, uint256 burnAmount, uint256 userReceives, uint256 burnRateBips, uint256 nftBoost)","event Delegated(address indexed user, uint256 indexed delegationIndex, uint256 amount, uint256 pStake, uint256 feePaid, address operator)","event Unstaked(address indexed user, uint256 indexed delegationIndex, uint256 amountReceived, uint256 feePaid, address operator)","event RewardClaimed(address indexed user, uint256 amountReceived, uint256 burnedAmount, uint256 ethFeePaid, uint256 nftBoostUsed, address operator)"];function _t(e){const t=window.ethers,a=tr();return new t.Contract(a.DELEGATION_MANAGER,Go,e)}async function Ya(){const e=window.ethers,{NetworkManager:t}=await W(async()=>{const{NetworkManager:i}=await import("./index-Jv5HScoX.js");return{NetworkManager:i}},[]),a=t.getProvider(),n=tr();return new e.Contract(n.DELEGATION_MANAGER,Go,a)}function Yp(e){return BigInt(e)*24n*60n*60n}async function Ko({amount:e,lockDays:t,lockDuration:a,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){let o;if(a!=null){o=BigInt(a);const u=Number(o)/86400;if(u<1||u>3650)throw new Error("Lock duration must be between 1 and 3650 days")}else if(t!=null)ee.staking.validateDelegate({amount:e,lockDays:t}),o=Yp(t);else throw new Error("Either lockDays or lockDuration must be provided");const l=BigInt(e);let c=n;return await O.execute({name:"Delegate",button:i,getContract:async u=>_t(u),method:"delegate",args:()=>[l,o,V(c)],approval:(()=>{const u=tr();return{token:u.BKC_TOKEN,spender:u.DELEGATION_MANAGER,amount:l}})(),onSuccess:r,onError:s})}async function Yo({delegationIndex:e,operator:t,button:a=null,onSuccess:n=null,onError:i=null}){ee.staking.validateUnstake({delegationIndex:e});let r=e,s=t;return await O.execute({name:"Unstake",button:a,getContract:async o=>_t(o),method:"unstake",args:()=>[r,V(s)],validate:async(o,l)=>{const u=await _t(o).getDelegationsOf(l);if(r>=u.length)throw new Error("Delegation not found");const f=u[r],p=Math.floor(Date.now()/1e3);if(Number(f.unlockTime)>p){const b=Math.ceil((Number(f.unlockTime)-p)/86400);throw new Error(`Lock period still active. ${b} day(s) remaining. Use Force Unstake if needed.`)}},onSuccess:n,onError:i})}async function Vo({delegationIndex:e,operator:t,button:a=null,onSuccess:n=null,onError:i=null}){ee.staking.validateUnstake({delegationIndex:e});let r=e,s=t;return await O.execute({name:"ForceUnstake",button:a,getContract:async o=>_t(o),method:"forceUnstake",args:()=>[r,V(s)],validate:async(o,l)=>{const u=await _t(o).getDelegationsOf(l);if(r>=u.length)throw new Error("Delegation not found");const f=u[r],p=Math.floor(Date.now()/1e3);if(Number(f.unlockTime)<=p)throw new Error("Lock period has ended. Use normal Unstake to avoid penalty.")},onSuccess:n,onError:i})}async function qo({operator:e,button:t=null,onSuccess:a=null,onError:n=null}={}){let i=e,r=0n;return await O.execute({name:"ClaimReward",button:t,getContract:async s=>_t(s),method:"claimReward",args:()=>[V(i)],get value(){return r},validate:async(s,o)=>{const l=_t(s);if(await l.pendingRewards(o)<=0n)throw new Error("No rewards available to claim");try{r=await l.claimEthFee()}catch{r=0n}},onSuccess:a,onError:n})}async function Xo(e){const a=await(await Ya()).getDelegationsOf(e),n=Math.floor(Date.now()/1e3);return a.map((i,r)=>({index:r,amount:i.amount,unlockTime:Number(i.unlockTime),lockDuration:Number(i.lockDuration),isUnlocked:Number(i.unlockTime)<=n,daysRemaining:Number(i.unlockTime)>n?Math.ceil((Number(i.unlockTime)-n)/86400):0}))}async function Jo(e){return await(await Ya()).pendingRewards(e)}async function Zo(e){return await(await Ya()).userTotalPStake(e)}async function Qo(){return await(await Ya()).totalNetworkPStake()}async function el(){return 50}async function tl(){const e=await Ya(),[t,a]=await Promise.all([e.MIN_LOCK_DURATION(),e.MAX_LOCK_DURATION()]);return{minLockDays:Number(t)/86400,maxLockDays:Number(a)/86400,minLockSeconds:Number(t),maxLockSeconds:Number(a),penaltyPercent:50,penaltyBips:5e3}}const Ft={delegate:Ko,unstake:Yo,forceUnstake:Vo,claimRewards:qo,getUserDelegations:Xo,getPendingRewards:Jo,getUserPStake:Zo,getTotalPStake:Qo,getEarlyUnstakePenalty:el,getStakingConfig:tl},Vp=Object.freeze(Object.defineProperty({__proto__:null,StakingTx:Ft,claimRewards:qo,delegate:Ko,forceUnstake:Vo,getEarlyUnstakePenalty:el,getPendingRewards:Jo,getStakingConfig:tl,getTotalPStake:Qo,getUserDelegations:Xo,getUserPStake:Zo,unstake:Yo},Symbol.toStringTag,{value:"Module"})),al=["diamond","gold","silver","bronze"];function Va(e=null){var i,r,s;const t=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((i=window.contractAddresses)==null?void 0:i.bkcToken),a=(w==null?void 0:w.rewardBoosterNFT)||(L==null?void 0:L.rewardBoosterNFT)||((r=window.contractAddresses)==null?void 0:r.rewardBoosterNFT);let n=null;if(e){const o=`pool_${e.toLowerCase()}`;n=(w==null?void 0:w[o])||(L==null?void 0:L[o])||((s=window.contractAddresses)==null?void 0:s[o])}if(!t||!a)throw new Error("Contract addresses not loaded");return{BKC_TOKEN:t,NFT_CONTRACT:a,NFT_POOL:n}}function Ut(e){var a;const t=`pool_${e.toLowerCase()}`;return(w==null?void 0:w[t])||(L==null?void 0:L[t])||((a=window.contractAddresses)==null?void 0:a[t])||null}function qp(){const e={};for(const t of al){const a=Ut(t);a&&(e[t]=a)}return e}const Mn=["function buyNFT(uint256 _maxPrice, address _operator) external payable returns (uint256 tokenId)","function buySpecificNFT(uint256 _tokenId, uint256 _maxPrice, address _operator) external payable","function buyNFTWithSlippage(uint256 _maxPrice, address _operator) external payable returns (uint256 tokenId)","function sellNFT(uint256 _tokenId, uint256 _minPayout, address _operator) external payable","function getBuyPrice() view returns (uint256)","function getBuyPriceWithTax() view returns (uint256)","function getSellPrice() view returns (uint256)","function getSellPriceAfterTax() view returns (uint256)","function getTotalBuyCost() view returns (uint256 bkcCost, uint256 ethCost)","function getTotalSellInfo() view returns (uint256 bkcPayout, uint256 ethCost)","function getSpread() view returns (uint256 spread, uint256 spreadBips)","function getPoolInfo() view returns (uint256 bkcBalance, uint256 nftCount, uint256 k, bool initialized)","function getAvailableNFTs() view returns (uint256[])","function getNFTBalance() view returns (uint256)","function getBKCBalance() view returns (uint256)","function isNFTInPool(uint256 _tokenId) view returns (bool)","function boostBips() view returns (uint256)","function getTierName() view returns (string)","function buyEthFee() view returns (uint256)","function sellEthFee() view returns (uint256)","function getEthFeeConfig() view returns (uint256 buyFee, uint256 sellFee, uint256 totalCollected)","function totalETHCollected() view returns (uint256)","function getTradingStats() view returns (uint256 volume, uint256 taxes, uint256 buys, uint256 sells)","function totalVolume() view returns (uint256)","function totalTaxesCollected() view returns (uint256)","function totalBuys() view returns (uint256)","function totalSells() view returns (uint256)","event NFTPurchased(address indexed buyer, uint256 indexed tokenId, uint256 price, uint256 tax, uint256 newBkcBalance, uint256 newNftCount, address operator)","event NFTSold(address indexed seller, uint256 indexed tokenId, uint256 payout, uint256 tax, uint256 newBkcBalance, uint256 newNftCount, address operator)"],nl=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function ownerOf(uint256 tokenId) view returns (address)","function balanceOf(address owner) view returns (uint256)","function boostBips(uint256 tokenId) view returns (uint256)"];function vt(e,t){return new window.ethers.Contract(t,Mn,e)}async function Ne(e){const{NetworkManager:t}=await W(async()=>{const{NetworkManager:a}=await import("./index-Jv5HScoX.js");return{NetworkManager:a}},[]);return new window.ethers.Contract(e,Mn,t.getProvider())}function Ei(e){const t=Va();return new window.ethers.Contract(t.NFT_CONTRACT,nl,e)}async function Xp(){const{NetworkManager:e}=await W(async()=>{const{NetworkManager:a}=await import("./index-Jv5HScoX.js");return{NetworkManager:a}},[]),t=Va();return new window.ethers.Contract(t.NFT_CONTRACT,nl,e.getProvider())}async function ar({poolAddress:e,poolTier:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers,o=Va(),l=e||Ut(t);if(!l)throw new Error("Pool address or valid pool tier is required");let c=a,u=0n,f=0n;return await O.execute({name:"BuyNFT",button:n,getContract:async p=>vt(p,l),method:"buyNFT",args:()=>[u,V(c)],get value(){return f},get approval(){return u>0n?{token:o.BKC_TOKEN,spender:l,amount:u}:null},validate:async(p,b)=>{const m=vt(p,l);if(await m.getNFTBalance()===0n)throw new Error("No NFTs available in pool");try{const[z,I]=await m.getTotalBuyCost();u=z,f=I}catch{u=await m.getBuyPriceWithTax(),f=await m.buyEthFee().catch(()=>0n)}const{NetworkManager:y}=await W(async()=>{const{NetworkManager:z}=await import("./index-Jv5HScoX.js");return{NetworkManager:z}},[]),C=y.getProvider();if(await new s.Contract(o.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],C).balanceOf(b)<u)throw new Error(`Insufficient BKC. Need ${s.formatEther(u)} BKC`);if(await C.getBalance(b)<f+s.parseEther("0.001"))throw new Error("Insufficient ETH for fee + gas")},onSuccess:async p=>{let b=null;try{const m=new s.Interface(Mn);for(const x of p.logs)try{const y=m.parseLog(x);if((y==null?void 0:y.name)==="NFTPurchased"){b=Number(y.args.tokenId);break}}catch{}}catch{}i&&i(p,b)},onError:r})}async function il({poolAddress:e,poolTier:t,tokenId:a,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=window.ethers,l=Va(),c=e||Ut(t);if(!c)throw new Error("Pool address or valid pool tier is required");if(a===void 0)throw new Error("Token ID is required");let u=n,f=0n,p=0n;return await O.execute({name:"BuySpecificNFT",button:i,getContract:async b=>vt(b,c),method:"buySpecificNFT",args:()=>[a,f,V(u)],get value(){return p},get approval(){return f>0n?{token:l.BKC_TOKEN,spender:c,amount:f}:null},validate:async(b,m)=>{const x=vt(b,c);if(!await x.isNFTInPool(a))throw new Error("NFT is not in pool");try{const[N,P]=await x.getTotalBuyCost();f=N,p=P}catch{f=await x.getBuyPriceWithTax(),p=await x.buyEthFee().catch(()=>0n)}const{NetworkManager:y}=await W(async()=>{const{NetworkManager:N}=await import("./index-Jv5HScoX.js");return{NetworkManager:N}},[]),C=y.getProvider();if(await new o.Contract(l.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],C).balanceOf(m)<f)throw new Error("Insufficient BKC");if(await C.getBalance(m)<p+o.parseEther("0.001"))throw new Error("Insufficient ETH")},onSuccess:r,onError:s})}async function rl({poolAddress:e,poolTier:t,maxPrice:a,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=window.ethers,l=Va(),c=e||Ut(t);if(!c)throw new Error("Pool address or valid pool tier is required");const u=BigInt(a);let f=n,p=0n;return await O.execute({name:"BuyNFTWithSlippage",button:i,getContract:async b=>vt(b,c),method:"buyNFTWithSlippage",args:()=>[u,V(f)],get value(){return p},approval:{token:l.BKC_TOKEN,spender:c,amount:u},validate:async(b,m)=>{const x=vt(b,c);if(await x.getNFTBalance()===0n)throw new Error("No NFTs available");if(await x.getBuyPriceWithTax()>u)throw new Error("Price exceeds max");p=await x.buyEthFee().catch(()=>0n);const{NetworkManager:C}=await W(async()=>{const{NetworkManager:P}=await import("./index-Jv5HScoX.js");return{NetworkManager:P}},[]),A=C.getProvider();if(await new o.Contract(l.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],A).balanceOf(m)<u)throw new Error("Insufficient BKC");if(await A.getBalance(m)<p+o.parseEther("0.001"))throw new Error("Insufficient ETH")},onSuccess:async b=>{let m=null;try{const x=new o.Interface(Mn);for(const y of b.logs)try{const C=x.parseLog(y);if((C==null?void 0:C.name)==="NFTPurchased"){m=Number(C.args.tokenId);break}}catch{}}catch{}r&&r(b,m)},onError:s})}async function nr({poolAddress:e,poolTier:t,tokenId:a,minPayout:n,operator:i,button:r=null,onSuccess:s=null,onError:o=null}){const l=window.ethers,c=e||Ut(t);if(!c)throw new Error("Pool address or valid pool tier is required");if(a===void 0)throw new Error("Token ID is required");let u=i,f=0n,p=0n;return await O.execute({name:"SellNFT",button:r,getContract:async b=>vt(b,c),method:"sellNFT",args:()=>[a,f,V(u)],get value(){return p},validate:async(b,m)=>{const x=vt(b,c),y=Ei(b);if((await y.ownerOf(a)).toLowerCase()!==m.toLowerCase())throw new Error("You do not own this NFT");const A=await x.boostBips(),N=await y.boostBips(a);if(A!==N)throw new Error("NFT tier does not match pool tier");try{const[I,F]=await x.getTotalSellInfo();f=n?BigInt(n):I*95n/100n,p=F}catch{const I=await x.getSellPriceAfterTax();f=n?BigInt(n):I*95n/100n,p=await x.sellEthFee().catch(()=>0n)}const{NetworkManager:P}=await W(async()=>{const{NetworkManager:I}=await import("./index-Jv5HScoX.js");return{NetworkManager:I}},[]);if(await P.getProvider().getBalance(m)<p+l.parseEther("0.001"))throw new Error("Insufficient ETH");await y.isApprovedForAll(m,c)||await(await y.setApprovalForAll(c,!0)).wait()},onSuccess:s,onError:o})}async function sl({poolAddress:e,poolTier:t,button:a=null,onSuccess:n=null,onError:i=null}){const r=e||Ut(t);if(!r)throw new Error("Pool address or valid pool tier is required");return await O.execute({name:"ApproveAllNFTs",button:a,getContract:async s=>Ei(s),method:"setApprovalForAll",args:[r,!0],validate:async(s,o)=>{if(await Ei(s).isApprovedForAll(o,r))throw new Error("Already approved")},onSuccess:n,onError:i})}async function ol(e){return await(await Ne(e)).getBuyPrice()}async function ll(e){return await(await Ne(e)).getBuyPriceWithTax()}async function cl(e){return await(await Ne(e)).getSellPrice()}async function dl(e){return await(await Ne(e)).getSellPriceAfterTax()}async function ul(e){const t=window.ethers,a=await Ne(e);try{const[n,i]=await a.getTotalBuyCost();return{bkcCost:n,bkcFormatted:t.formatEther(n),ethCost:i,ethFormatted:t.formatEther(i)}}catch{const n=await a.getBuyPriceWithTax(),i=await a.buyEthFee().catch(()=>0n);return{bkcCost:n,bkcFormatted:t.formatEther(n),ethCost:i,ethFormatted:t.formatEther(i)}}}async function pl(e){const t=window.ethers,a=await Ne(e);try{const[n,i]=await a.getTotalSellInfo();return{bkcPayout:n,bkcFormatted:t.formatEther(n),ethCost:i,ethFormatted:t.formatEther(i)}}catch{const n=await a.getSellPriceAfterTax(),i=await a.sellEthFee().catch(()=>0n);return{bkcPayout:n,bkcFormatted:t.formatEther(n),ethCost:i,ethFormatted:t.formatEther(i)}}}async function ml(e){const t=window.ethers,a=await Ne(e),[n,i,r,s]=await Promise.all([a.getPoolInfo(),a.getBuyPrice().catch(()=>0n),a.getSellPrice().catch(()=>0n),a.boostBips()]);return{bkcBalance:n.bkcBalance,nftCount:Number(n.nftCount),k:n.k,initialized:n.initialized,boostBips:Number(s),buyPrice:i,buyPriceFormatted:t.formatEther(i),sellPrice:r,sellPriceFormatted:t.formatEther(r)}}async function fl(e){return(await(await Ne(e)).getAvailableNFTs()).map(a=>Number(a))}async function bl(e){const t=window.ethers,a=await Ne(e);try{const n=await a.getEthFeeConfig();return{buyFee:n.buyFee,buyFeeFormatted:t.formatEther(n.buyFee),sellFee:n.sellFee,sellFeeFormatted:t.formatEther(n.sellFee),totalCollected:n.totalCollected,totalCollectedFormatted:t.formatEther(n.totalCollected)}}catch{const[n,i,r]=await Promise.all([a.buyEthFee().catch(()=>0n),a.sellEthFee().catch(()=>0n),a.totalETHCollected().catch(()=>0n)]);return{buyFee:n,buyFeeFormatted:t.formatEther(n),sellFee:i,sellFeeFormatted:t.formatEther(i),totalCollected:r,totalCollectedFormatted:t.formatEther(r)}}}async function gl(e){const t=window.ethers,a=await Ne(e);try{const n=await a.getTradingStats();return{volume:n.volume,volumeFormatted:t.formatEther(n.volume),taxes:n.taxes,taxesFormatted:t.formatEther(n.taxes),buys:Number(n.buys),sells:Number(n.sells)}}catch{const[n,i,r,s]=await Promise.all([a.totalVolume().catch(()=>0n),a.totalTaxesCollected().catch(()=>0n),a.totalBuys().catch(()=>0n),a.totalSells().catch(()=>0n)]);return{volume:n,volumeFormatted:t.formatEther(n),taxes:i,taxesFormatted:t.formatEther(i),buys:Number(r),sells:Number(s)}}}async function xl(e){const t=await Ne(e);try{return await t.getTierName()}catch{const a=await t.boostBips();return{5e3:"Diamond",4e3:"Gold",2500:"Silver",1e3:"Bronze"}[Number(a)]||"Unknown"}}async function hl(e){const t=window.ethers,a=await Ne(e);try{const n=await a.getSpread();return{spread:n.spread,spreadFormatted:t.formatEther(n.spread),spreadBips:Number(n.spreadBips),spreadPercent:Number(n.spreadBips)/100}}catch{const[n,i]=await Promise.all([a.getBuyPrice().catch(()=>0n),a.getSellPrice().catch(()=>0n)]),r=n>i?n-i:0n,s=i>0n?Number(r*10000n/i):0;return{spread:r,spreadFormatted:t.formatEther(r),spreadBips:s,spreadPercent:s/100}}}async function vl(e,t){return await(await Ne(e)).isNFTInPool(t)}async function wl(e,t){return await(await Xp()).isApprovedForAll(e,t)}const yl=ar,kl=nr,Ti={buyNft:ar,buySpecificNft:il,buyNftWithSlippage:rl,sellNft:nr,approveAllNfts:sl,buyFromPool:yl,sellToPool:kl,getBuyPrice:ol,getBuyPriceWithTax:ll,getSellPrice:cl,getSellPriceAfterTax:dl,getTotalBuyCost:ul,getTotalSellInfo:pl,getEthFeeConfig:bl,getPoolInfo:ml,getAvailableNfts:fl,isNFTInPool:vl,isApprovedForAll:wl,getTradingStats:gl,getTierName:xl,getSpread:hl,getPoolAddress:Ut,getAllPools:qp,POOL_TIERS:al},Jp=Object.freeze(Object.defineProperty({__proto__:null,NftTx:Ti,approveAllNfts:sl,buyFromPool:yl,buyNft:ar,buyNftWithSlippage:rl,buySpecificNft:il,getAvailableNfts:fl,getBuyPrice:ol,getBuyPriceWithTax:ll,getEthFeeConfig:bl,getPoolInfo:ml,getSellPrice:cl,getSellPriceAfterTax:dl,getSpread:hl,getTierName:xl,getTotalBuyCost:ul,getTotalSellInfo:pl,getTradingStats:gl,isApprovedForAll:wl,isNFTInPool:vl,sellNft:nr,sellToPool:kl},Symbol.toStringTag,{value:"Module"}));function ir(){var a,n,i;const e=(w==null?void 0:w.fortunePoolV2)||(w==null?void 0:w.fortunePool)||(L==null?void 0:L.fortunePoolV2)||(L==null?void 0:L.fortunePool)||((a=window.contractAddresses)==null?void 0:a.fortunePoolV2)||((n=window.contractAddresses)==null?void 0:n.fortunePool),t=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((i=window.contractAddresses)==null?void 0:i.bkcToken);if(!e)throw console.error("âŒ FortunePool address not found!",{addresses:w,contractAddresses:L}),new Error("Contract addresses not loaded. Please refresh the page.");if(!t)throw console.error("âŒ BKC Token address not found!"),new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:t,FORTUNE_POOL:e}}const Dn=["function commitPlay(bytes32 _commitmentHash, uint256 _wagerAmount, bool _isCumulative, address _operator) external payable returns (uint256 gameId)","function revealPlay(uint256 _gameId, uint256[] calldata _guesses, bytes32 _userSecret) external returns (uint256 prizeWon)","function generateCommitmentHash(uint256[] calldata _guesses, bytes32 _userSecret) external pure returns (bytes32 hash)","function claimExpiredGame(uint256 _gameId) external","function activeTierCount() view returns (uint256)","function prizeTiers(uint256 tierId) view returns (uint128 maxRange, uint64 multiplierBips, bool active)","function getAllTiers() view returns (uint128[] ranges, uint64[] multipliers)","function serviceFee() view returns (uint256)","function getRequiredServiceFee(bool _isCumulative) view returns (uint256)","function gameFeeBips() view returns (uint256)","function gameCounter() view returns (uint256)","function prizePoolBalance() view returns (uint256)","function revealDelay() view returns (uint256)","function revealWindow() view returns (uint256)","function getCommitment(uint256 _gameId) view returns (address player, uint64 commitBlock, bool isCumulative, uint8 status, uint256 wagerAmount, uint256 ethPaid)","function getCommitmentStatus(uint256 _gameId) view returns (uint8 status, bool canReveal, bool isExpired, uint256 blocksUntilReveal, uint256 blocksUntilExpiry)","function commitmentMeta(uint256 _gameId) view returns (bytes32 hash, address operator, uint96 tierNonce)","function getGameResult(uint256 _gameId) view returns (address player, uint256 wagerAmount, uint256 prizeWon, uint256[] guesses, uint256[] rolls, bool isCumulative, uint8 matchCount, uint256 timestamp)","function totalWageredAllTime() view returns (uint256)","function totalPaidOutAllTime() view returns (uint256)","function totalWinsAllTime() view returns (uint256)","function totalETHCollected() view returns (uint256)","function totalBKCFees() view returns (uint256)","function totalExpiredGames() view returns (uint256)","function getPoolStats() view returns (uint256 poolBalance, uint256 gamesPlayed, uint256 wageredAllTime, uint256 paidOutAllTime, uint256 winsAllTime, uint256 ethCollected, uint256 bkcFees, uint256 expiredGames)","function calculatePotentialWinnings(uint256 _wagerAmount, bool _isCumulative) view returns (uint256 maxPrize, uint256 netWager)","function getExpectedGuessCount(bool _isCumulative) view returns (uint256)","event GameCommitted(uint256 indexed gameId, address indexed player, uint256 wagerAmount, bool isCumulative, address operator)","event GameRevealed(uint256 indexed gameId, address indexed player, uint256 wagerAmount, uint256 prizeWon, bool isCumulative, uint8 matchCount, address operator)","event GameDetails(uint256 indexed gameId, uint256[] guesses, uint256[] rolls, bool[] matches)","event JackpotWon(uint256 indexed gameId, address indexed player, uint256 prizeAmount, uint256 tier)","event GameExpired(uint256 indexed gameId, address indexed player, uint256 forfeitedAmount)"];function El(e){const t=window.ethers,a=ir();return new t.Contract(a.FORTUNE_POOL,Dn,e)}async function Fe(){const e=window.ethers,{NetworkManager:t}=await W(async()=>{const{NetworkManager:i}=await import("./index-Jv5HScoX.js");return{NetworkManager:i}},[]),a=t.getProvider(),n=ir();return new e.Contract(n.FORTUNE_POOL,Dn,a)}const rr="fortune_pending_games";function On(){try{return JSON.parse(localStorage.getItem(rr)||"{}")}catch{return{}}}function Zp(e,t){const a=On();a[e]={...t,savedAt:Date.now()},localStorage.setItem(rr,JSON.stringify(a))}function Qp(e){const t=On();delete t[e],localStorage.setItem(rr,JSON.stringify(t))}function sr(e,t){const a=window.ethers,n=a.solidityPacked(["uint256[]","bytes32"],[e.map(i=>BigInt(i)),t]);return a.keccak256(n)}function Tl(){const e=window.ethers;return e.hexlify(e.randomBytes(32))}async function or({commitmentHash:e,wagerAmount:t,isCumulative:a=!1,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=window.ethers,l=ir(),c=BigInt(t);let u=e,f=a,p=n,b=0n;try{b=await(await Fe()).getRequiredServiceFee(a),console.log("[FortuneTx] Service fee:",o.formatEther(b),"ETH")}catch(m){throw console.error("[FortuneTx] Could not fetch service fee:",m.message),new Error("Could not fetch service fee from contract")}return await O.execute({name:"CommitPlay",button:i,getContract:async m=>El(m),method:"commitPlay",args:()=>[u,c,f,V(p)],value:b,approval:{token:l.BKC_TOKEN,spender:l.FORTUNE_POOL,amount:c},validate:async(m,x)=>{const{NetworkManager:y}=await W(async()=>{const{NetworkManager:z}=await import("./index-Jv5HScoX.js");return{NetworkManager:z}},[]),C=y.getProvider(),A=await Fe(),N=await C.getBalance(x);if(b>0n&&N<b)throw new Error(`Insufficient ETH for service fee (${o.formatEther(b)} ETH required)`);if(Number(await A.activeTierCount())===0)throw new Error("No active tiers available");if(c<=0n)throw new Error("Wager amount must be greater than 0")},onSuccess:async m=>{let x=null;try{const y=new o.Interface(Dn);for(const C of m.logs)try{const A=y.parseLog(C);if(A.name==="GameCommitted"){x=Number(A.args.gameId);break}}catch{}}catch{}r&&r({gameId:x,txHash:m.hash,commitBlock:m.blockNumber})},onError:s})}async function lr({gameId:e,guesses:t,userSecret:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers,o=t.map(l=>BigInt(l));return await O.execute({name:"RevealPlay",button:n,getContract:async l=>El(l),method:"revealPlay",args:[e,o,a],validate:async(l,c)=>{const u=await Fe(),f=await u.getCommitmentStatus(e);if(f.isExpired)throw new Error("Game has expired. You can no longer reveal.");if(!f.canReveal)throw f.blocksUntilReveal>0?new Error(`Must wait ${f.blocksUntilReveal} more blocks before reveal`):new Error("Cannot reveal this game");if((await u.getCommitment(e)).player.toLowerCase()!==c.toLowerCase())throw new Error("You are not the owner of this game");const b=await u.commitmentMeta(e),m=sr(t,a);if(b.hash.toLowerCase()!==m.toLowerCase())throw new Error("Hash mismatch - guesses or secret do not match commitment")},onSuccess:async l=>{let c=null;try{const u=new s.Interface(Dn);for(const f of l.logs)try{const p=u.parseLog(f);p.name==="GameRevealed"&&(c={gameId:Number(p.args.gameId),wagerAmount:p.args.wagerAmount,prizeWon:p.args.prizeWon,isCumulative:p.args.isCumulative,matchCount:Number(p.args.matchCount),won:p.args.prizeWon>0n}),p.name==="GameDetails"&&c&&(c.guesses=p.args.guesses.map(b=>Number(b)),c.rolls=p.args.rolls.map(b=>Number(b)),c.matches=p.args.matches),p.name==="JackpotWon"&&c&&(c.jackpot=!0,c.jackpotTier=Number(p.args.tier))}catch{}}catch{}Qp(e),i&&i(l,c)},onError:r})}async function Cl({wagerAmount:e,guess:t,guesses:a,isCumulative:n=!1,operator:i,button:r=null,onSuccess:s=null,onError:o=null}){let l=[];if(n)if(a&&Array.isArray(a)&&a.length>0)l=a.map(b=>Number(b));else if(t!==void 0)l=[Number(Array.isArray(t)?t[0]:t)];else throw new Error("Guesses array is required for cumulative mode");else{let b;if(t!==void 0)b=Array.isArray(t)?t[0]:t;else if(a&&a.length>0)b=a[a.length-1];else throw new Error("Guess is required");l=[Number(b)]}const c=await Fe(),u=Number(await c.activeTierCount());if(u===0)throw new Error("No active tiers available");if(n){if(l.length!==u)throw new Error(`Cumulative mode requires ${u} guesses (one per tier), got ${l.length}`);for(let b=0;b<u;b++){const m=await c.prizeTiers(b+1),x=Number(m.maxRange);if(l[b]<1||l[b]>x)throw new Error(`Tier ${b+1} guess must be between 1 and ${x}`)}}else{if(l.length!==1)throw new Error("Jackpot mode requires exactly 1 guess");const b=await c.prizeTiers(u),m=Number(b.maxRange);if(l[0]<1||l[0]>m)throw new Error(`Jackpot guess must be between 1 and ${m}`)}const f=Tl(),p=sr(l,f);return console.log("[FortuneTx] Generated commitment:",{guesses:l,userSecret:f.slice(0,10)+"...",commitmentHash:p.slice(0,10)+"..."}),await or({commitmentHash:p,wagerAmount:e,isCumulative:n,operator:i,button:r,onSuccess:b=>{Zp(b.gameId,{guesses:l,userSecret:f,isCumulative:n,wagerAmount:e.toString(),commitmentHash:p}),console.log("[FortuneTx] Game committed, stored for reveal:",b.gameId),s&&s({...b,guesses:l,userSecret:f,isCumulative:n})},onError:o})}async function Il(){const e=await Fe(),t=Number(await e.activeTierCount()),a=[];for(let n=1;n<=t;n++)try{const i=await e.prizeTiers(n);i.active&&a.push({tierId:n,maxRange:Number(i.maxRange),multiplierBips:Number(i.multiplierBips),multiplier:Number(i.multiplierBips)/1e4,active:i.active})}catch{break}return a}async function Al(e){const t=await Fe();try{const a=await t.prizeTiers(e);if(a.active)return{tierId:e,maxRange:Number(a.maxRange),multiplierBips:Number(a.multiplierBips),multiplier:Number(a.multiplierBips)/1e4,active:a.active}}catch{}return null}async function Bl(e=!1){const t=await Fe();try{return await t.getRequiredServiceFee(e)}catch{try{const n=await t.serviceFee();return e?n*5n:n}catch{return console.warn("[FortuneTx] Could not fetch service fee"),0n}}}async function zl(){const e=window.ethers,t=await Fe();try{const a=await t.getPoolStats();return{prizePoolBalance:a.poolBalance,prizePoolFormatted:e.formatEther(a.poolBalance),gameCounter:Number(a.gamesPlayed),totalWageredAllTime:a.wageredAllTime,totalWageredFormatted:e.formatEther(a.wageredAllTime),totalPaidOutAllTime:a.paidOutAllTime,totalPaidOutFormatted:e.formatEther(a.paidOutAllTime),totalWinsAllTime:Number(a.winsAllTime),totalETHCollected:a.ethCollected,totalBKCFees:a.bkcFees,totalExpiredGames:Number(a.expiredGames)}}catch{const[a,n,i,r,s]=await Promise.all([t.gameCounter().catch(()=>0n),t.prizePoolBalance().catch(()=>0n),t.totalWageredAllTime().catch(()=>0n),t.totalPaidOutAllTime().catch(()=>0n),t.totalWinsAllTime().catch(()=>0n)]);return{gameCounter:Number(a),prizePoolBalance:n,prizePoolFormatted:e.formatEther(n),totalWageredAllTime:i,totalWageredFormatted:e.formatEther(i),totalPaidOutAllTime:r,totalPaidOutFormatted:e.formatEther(r),totalWinsAllTime:Number(s)}}}async function Pl(){const e=await Fe();return Number(await e.activeTierCount())}async function Nl(e,t=!1){const a=window.ethers,n=await Fe();try{const i=await n.calculatePotentialWinnings(e,t);return{maxPrize:i.maxPrize,maxPrizeFormatted:a.formatEther(i.maxPrize),netWager:i.netWager,netWagerFormatted:a.formatEther(i.netWager)}}catch{return{maxPrize:0n,netWager:0n}}}async function $l(e){const t=await Fe();try{const a=await t.getGameResult(e);return{player:a.player,wagerAmount:a.wagerAmount,prizeWon:a.prizeWon,guesses:a.guesses.map(n=>Number(n)),rolls:a.rolls.map(n=>Number(n)),isCumulative:a.isCumulative,matchCount:Number(a.matchCount),timestamp:Number(a.timestamp),won:a.prizeWon>0n}}catch{return null}}async function Sl(e){const t=await Fe();try{const a=await t.getCommitmentStatus(e);return{status:Number(a.status),statusName:["NONE","COMMITTED","REVEALED","EXPIRED"][Number(a.status)]||"UNKNOWN",canReveal:a.canReveal,isExpired:a.isExpired,blocksUntilReveal:Number(a.blocksUntilReveal),blocksUntilExpiry:Number(a.blocksUntilExpiry)}}catch{return null}}function Ll(){return On()}function cr(e){return On()[e]||null}async function Rl(e,t={}){const a=cr(e);if(!a)throw new Error(`No pending game found with ID ${e}`);return await lr({gameId:e,guesses:a.guesses,userSecret:a.userSecret,...t})}const dr={commitPlay:or,revealPlay:lr,playGame:Cl,revealPendingGame:Rl,getPendingGamesForReveal:Ll,getPendingGame:cr,generateCommitmentHashLocal:sr,generateSecret:Tl,getActiveTiers:Il,getTierById:Al,getServiceFee:Bl,getPoolStats:zl,getActiveTierCount:Pl,calculatePotentialWin:Nl,getGameResult:$l,getCommitmentStatus:Sl},e0=Object.freeze(Object.defineProperty({__proto__:null,FortuneTx:dr,calculatePotentialWin:Nl,commitPlay:or,getActiveTierCount:Pl,getActiveTiers:Il,getCommitmentStatus:Sl,getGameResult:$l,getPendingGame:cr,getPendingGamesForReveal:Ll,getPoolStats:zl,getServiceFee:Bl,getTierById:Al,playGame:Cl,revealPendingGame:Rl,revealPlay:lr},Symbol.toStringTag,{value:"Module"}));function da(){var n,i,r;const e=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken),t=(w==null?void 0:w.rentalManager)||(L==null?void 0:L.rentalManager)||((i=window.contractAddresses)==null?void 0:i.rentalManager),a=(w==null?void 0:w.rewardBoosterNFT)||(L==null?void 0:L.rewardBoosterNFT)||((r=window.contractAddresses)==null?void 0:r.rewardBoosterNFT);if(!e||!t||!a)throw new Error("Contract addresses not loaded. Please refresh the page.");return{BKC_TOKEN:e,RENTAL_MARKETPLACE:t,NFT_CONTRACT:a}}const ur=["function listNFT(uint256 _tokenId, uint256 _pricePerHour, uint256 _minHours, uint256 _maxHours) external","function updateListing(uint256 _tokenId, uint256 _pricePerHour, uint256 _minHours, uint256 _maxHours) external","function withdrawNFT(uint256 _tokenId) external","function rentNFT(uint256 _tokenId, uint256 _hours, address _operator) external","function rentNFTSimple(uint256 _tokenId, address _operator) external","function spotlightListing(uint256 _tokenId, address _operator) external payable","function getListing(uint256 _tokenId) view returns (tuple(address owner, uint256 pricePerHour, uint256 minHours, uint256 maxHours, bool isActive, uint256 totalEarnings, uint256 rentalCount))","function getAllListedTokenIds() view returns (uint256[])","function getListingCount() view returns (uint256)","function getRental(uint256 _tokenId) view returns (tuple(address tenant, uint256 startTime, uint256 endTime, uint256 paidAmount))","function isRented(uint256 _tokenId) view returns (bool)","function getRemainingRentalTime(uint256 _tokenId) view returns (uint256)","function hasRentalRights(uint256 _tokenId, address _user) view returns (bool)","function getRentalCost(uint256 _tokenId, uint256 _hours) view returns (uint256 totalCost, uint256 protocolFee, uint256 ownerPayout)","function listingSpotlight(uint256 tokenId) view returns (uint256 totalAmount, uint256 lastSpotlightTime)","function getEffectiveSpotlight(uint256 _tokenId) view returns (uint256 effectiveAmount, uint256 daysPassed)","function getSpotlightedListingsPaginated(uint256 _offset, uint256 _limit) view returns (uint256[] tokenIds, uint256[] effectiveSpotlights, uint256 total)","function getSpotlightConfig() view returns (uint256 decayPerDayBips, uint256 minAmount, uint256 maxDays, uint256 totalSpotlightedListings, uint256 totalCollected)","function minSpotlightAmount() view returns (uint256)","function hasActiveRental(address _user) view returns (bool)","function getUserActiveRentals(address _user) view returns (uint256[] tokenIds, uint256[] endTimes)","function paused() view returns (bool)","function rentalFeeBips() view returns (uint256)","function getFeeConfig() view returns (uint256 miningFeeBips, uint256 burnFeeBips, uint256 totalFeeBips)","function getMarketplaceStats() view returns (uint256 activeListings, uint256 totalVol, uint256 totalFees, uint256 rentals, uint256 spotlightTotal, uint256 ethCollected, uint256 bkcFees)","event NFTListed(uint256 indexed tokenId, address indexed owner, uint256 pricePerHour, uint256 minHours, uint256 maxHours)","event NFTRented(uint256 indexed tokenId, address indexed tenant, address indexed owner, uint256 hours_, uint256 totalCost, uint256 protocolFee, uint256 ownerPayout, uint256 endTime, address operator)","event ListingSpotlighted(uint256 indexed tokenId, address indexed owner, uint256 amount, uint256 newTotal, uint256 timestamp, address operator)"],t0=["function setApprovalForAll(address operator, bool approved) external","function isApprovedForAll(address owner, address operator) view returns (bool)","function ownerOf(uint256 tokenId) view returns (address)"];function Me(e){const t=window.ethers,a=da();return new t.Contract(a.RENTAL_MARKETPLACE,ur,e)}async function we(){const e=window.ethers,{NetworkManager:t}=await W(async()=>{const{NetworkManager:i}=await import("./index-Jv5HScoX.js");return{NetworkManager:i}},[]),a=t.getProvider(),n=da();return new e.Contract(n.RENTAL_MARKETPLACE,ur,a)}function a0(e){const t=window.ethers,a=da();return new t.Contract(a.NFT_CONTRACT,t0,e)}async function pr({tokenId:e,pricePerHour:t,minHours:a,maxHours:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=da(),l=BigInt(t);return await O.execute({name:"ListNFT",button:i,getContract:async c=>Me(c),method:"listNFT",args:[e,l,a,n],validate:async(c,u)=>{const f=a0(c);if((await f.ownerOf(e)).toLowerCase()!==u.toLowerCase())throw new Error("You do not own this NFT");if(await Me(c).paused())throw new Error("Marketplace is currently paused");await f.isApprovedForAll(u,o.RENTAL_MARKETPLACE)||await(await f.setApprovalForAll(o.RENTAL_MARKETPLACE,!0)).wait()},onSuccess:r,onError:s})}async function mr({tokenId:e,hours:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers,o=da();let l=a,c=0n;return await O.execute({name:"RentNFT",button:n,getContract:async u=>Me(u),method:"rentNFT",args:()=>[e,t,V(l)],get approval(){return c>0n?{token:o.BKC_TOKEN,spender:o.RENTAL_MARKETPLACE,amount:c}:null},validate:async(u,f)=>{const p=Me(u);if(await p.paused())throw new Error("Marketplace is currently paused");const b=await p.getListing(e);if(!b.isActive)throw new Error("NFT is not listed for rent");if(t<Number(b.minHours)||t>Number(b.maxHours))throw new Error(`Hours must be between ${b.minHours} and ${b.maxHours}`);if(await p.isRented(e))throw new Error("NFT is currently rented");c=(await p.getRentalCost(e,t)).totalCost;const{NetworkManager:x}=await W(async()=>{const{NetworkManager:P}=await import("./index-Jv5HScoX.js");return{NetworkManager:P}},[]),y=x.getProvider(),C=["function balanceOf(address) view returns (uint256)"];if(await new s.Contract(o.BKC_TOKEN,C,y).balanceOf(f)<c)throw new Error(`Insufficient BKC. Need ${s.formatEther(c)} BKC`)},onSuccess:async u=>{let f=null;try{const p=new s.Interface(ur);for(const b of u.logs)try{const m=p.parseLog(b);if((m==null?void 0:m.name)==="NFTRented"){f={endTime:Number(m.args.endTime),totalCost:m.args.totalCost,protocolFee:m.args.protocolFee,ownerPayout:m.args.ownerPayout};break}}catch{}}catch{}i&&i(u,f)},onError:r})}async function _l({tokenId:e,operator:t,button:a=null,onSuccess:n=null,onError:i=null}){const r=window.ethers,s=da();let o=t,l=0n;return await O.execute({name:"RentNFTSimple",button:a,getContract:async c=>Me(c),method:"rentNFTSimple",args:()=>[e,V(o)],get approval(){return l>0n?{token:s.BKC_TOKEN,spender:s.RENTAL_MARKETPLACE,amount:l}:null},validate:async(c,u)=>{const f=Me(c);if(await f.paused())throw new Error("Marketplace is currently paused");const p=await f.getListing(e);if(!p.isActive)throw new Error("NFT is not listed for rent");if(await f.isRented(e))throw new Error("NFT is currently rented");l=p.pricePerHour;const{NetworkManager:b}=await W(async()=>{const{NetworkManager:A}=await import("./index-Jv5HScoX.js");return{NetworkManager:A}},[]),m=b.getProvider(),x=["function balanceOf(address) view returns (uint256)"];if(await new r.Contract(s.BKC_TOKEN,x,m).balanceOf(u)<l)throw new Error(`Insufficient BKC. Need ${r.formatEther(l)} BKC`)},onSuccess:n,onError:i})}async function fr({tokenId:e,button:t=null,onSuccess:a=null,onError:n=null}){return await O.execute({name:"WithdrawNFT",button:t,getContract:async i=>Me(i),method:"withdrawNFT",args:[e],validate:async(i,r)=>{const s=Me(i),o=await s.getListing(e);if(!o.isActive)throw new Error("NFT is not listed");if(o.owner.toLowerCase()!==r.toLowerCase())throw new Error("Only the owner can withdraw");if(await s.isRented(e))throw new Error("Cannot withdraw while NFT is rented")},onSuccess:a,onError:n})}async function Fl({tokenId:e,pricePerHour:t,minHours:a,maxHours:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=BigInt(t);return await O.execute({name:"UpdateListing",button:i,getContract:async l=>Me(l),method:"updateListing",args:[e,o,a,n],validate:async(l,c)=>{const f=await Me(l).getListing(e);if(!f.isActive)throw new Error("NFT is not listed");if(f.owner.toLowerCase()!==c.toLowerCase())throw new Error("Only the owner can update")},onSuccess:r,onError:s})}async function qa({tokenId:e,amount:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers,o=BigInt(t);let l=a;return await O.execute({name:"SpotlightListing",button:n,getContract:async c=>Me(c),method:"spotlightListing",args:()=>[e,V(l)],value:o,validate:async(c,u)=>{const f=Me(c);if(await f.paused())throw new Error("Marketplace is currently paused");if(!(await f.getListing(e)).isActive)throw new Error("NFT is not listed");try{const m=await f.minSpotlightAmount();if(o<m)throw new Error(`Minimum spotlight is ${s.formatEther(m)} ETH`)}catch(m){if(m.message.includes("Minimum"))throw m}if(await c.provider.getBalance(u)<o+s.parseEther("0.001"))throw new Error("Insufficient ETH")},onSuccess:i,onError:r})}async function Ml(e){const t=window.ethers,n=await(await we()).getListing(e);return{owner:n.owner,pricePerHour:n.pricePerHour,pricePerHourFormatted:t.formatEther(n.pricePerHour),minHours:Number(n.minHours),maxHours:Number(n.maxHours),isActive:n.isActive,totalEarnings:n.totalEarnings,totalEarningsFormatted:t.formatEther(n.totalEarnings),rentalCount:Number(n.rentalCount)}}async function Dl(e){const t=window.ethers,n=await(await we()).getRental(e),i=Math.floor(Date.now()/1e3),r=Number(n.endTime),s=r>i;return{tenant:n.tenant,startTime:Number(n.startTime),endTime:r,paidAmount:n.paidAmount,paidAmountFormatted:t.formatEther(n.paidAmount),isActive:s,hoursRemaining:s?Math.max(0,Math.ceil((r-i)/3600)):0}}async function Ol(){return(await(await we()).getAllListedTokenIds()).map(a=>Number(a))}async function Hl(){const e=await we();return Number(await e.getListingCount())}async function Ul(e,t){const a=window.ethers,i=await(await we()).getRentalCost(e,t);return{totalCost:i.totalCost,totalCostFormatted:a.formatEther(i.totalCost),protocolFee:i.protocolFee,protocolFeeFormatted:a.formatEther(i.protocolFee),ownerPayout:i.ownerPayout,ownerPayoutFormatted:a.formatEther(i.ownerPayout)}}async function jl(e){return await(await we()).isRented(e)}async function Wl(e){const t=await we();return Number(await t.getRemainingRentalTime(e))}async function Gl(e,t){return await(await we()).hasRentalRights(e,t)}async function Kl(e){const t=window.ethers,a=await we();try{const n=await a.getEffectiveSpotlight(e);return{effectiveAmount:n.effectiveAmount,effectiveAmountFormatted:t.formatEther(n.effectiveAmount),daysPassed:Number(n.daysPassed)}}catch{return{effectiveAmount:0n,effectiveAmountFormatted:"0",daysPassed:0}}}async function Yl(e=0,t=20){const a=window.ethers,n=await we();try{const i=await n.getSpotlightedListingsPaginated(e,t);return{tokenIds:i.tokenIds.map(r=>Number(r)),effectiveSpotlights:i.effectiveSpotlights.map(r=>({amount:r,formatted:a.formatEther(r)})),total:Number(i.total)}}catch{return{tokenIds:[],effectiveSpotlights:[],total:0}}}async function Vl(){const e=window.ethers,t=await we();try{const a=await t.getSpotlightConfig();return{decayPerDayBips:Number(a.decayPerDayBips),decayPerDayPercent:Number(a.decayPerDayBips)/100,minAmount:a.minAmount,minAmountFormatted:e.formatEther(a.minAmount),maxDays:Number(a.maxDays),totalSpotlightedListings:Number(a.totalSpotlightedListings),totalCollected:a.totalCollected,totalCollectedFormatted:e.formatEther(a.totalCollected)}}catch{return{decayPerDayBips:100,decayPerDayPercent:1,minAmount:0n,minAmountFormatted:"0",maxDays:100,totalSpotlightedListings:0,totalCollected:0n,totalCollectedFormatted:"0"}}}async function ql(){const e=await we();try{const t=await e.getFeeConfig();return{miningFeeBips:Number(t.miningFeeBips),miningFeePercent:Number(t.miningFeeBips)/100,burnFeeBips:Number(t.burnFeeBips),burnFeePercent:Number(t.burnFeeBips)/100,totalFeeBips:Number(t.totalFeeBips),totalFeePercent:Number(t.totalFeeBips)/100}}catch{const t=await e.rentalFeeBips().catch(()=>1e3);return{miningFeeBips:Number(t),miningFeePercent:Number(t)/100,burnFeeBips:0,burnFeePercent:0,totalFeeBips:Number(t),totalFeePercent:Number(t)/100}}}async function Xl(){const e=window.ethers,t=await we();try{const a=await t.getMarketplaceStats();return{activeListings:Number(a.activeListings),totalVolume:a.totalVol,totalVolumeFormatted:e.formatEther(a.totalVol),totalFees:a.totalFees,totalFeesFormatted:e.formatEther(a.totalFees),totalRentals:Number(a.rentals),totalSpotlight:a.spotlightTotal,totalSpotlightFormatted:e.formatEther(a.spotlightTotal),totalETHCollected:a.ethCollected,totalETHFormatted:e.formatEther(a.ethCollected),totalBKCFees:a.bkcFees,totalBKCFormatted:e.formatEther(a.bkcFees)}}catch{return{activeListings:0,totalVolume:0n,totalVolumeFormatted:"0",totalFees:0n,totalFeesFormatted:"0",totalRentals:0,totalSpotlight:0n,totalSpotlightFormatted:"0",totalETHCollected:0n,totalETHFormatted:"0",totalBKCFees:0n,totalBKCFormatted:"0"}}}async function Jl(){return await(await we()).paused()}async function Zl(e){const t=await we();try{return await t.hasActiveRental(e)}catch{return!1}}async function Ql(e){const t=await we();try{const a=await t.getUserActiveRentals(e);return a.tokenIds.map((n,i)=>({tokenId:Number(n),endTime:Number(a.endTimes[i]),hoursRemaining:Math.max(0,Math.ceil((Number(a.endTimes[i])-Math.floor(Date.now()/1e3))/3600))}))}catch{return[]}}const ec=pr,tc=mr,ac=fr,nc=qa,ic=qa,rc=qa,Xa={listNft:pr,rentNft:mr,rentNftSimple:_l,withdrawNft:fr,updateListing:Fl,spotlightListing:qa,list:ec,rent:tc,withdraw:ac,spotlight:nc,promote:rc,promoteListing:ic,getListing:Ml,getAllListedTokenIds:Ol,getListingCount:Hl,getRentalCost:Ul,getRental:Dl,isRented:jl,getRemainingRentalTime:Wl,hasRentalRights:Gl,getEffectiveSpotlight:Kl,getSpotlightedListings:Yl,getSpotlightConfig:Vl,hasActiveRental:Zl,getUserActiveRentals:Ql,getFeeConfig:ql,getMarketplaceStats:Xl,isMarketplacePaused:Jl},n0=Object.freeze(Object.defineProperty({__proto__:null,RentalTx:Xa,getAllListedTokenIds:Ol,getEffectiveSpotlight:Kl,getFeeConfig:ql,getListing:Ml,getListingCount:Hl,getMarketplaceStats:Xl,getRemainingRentalTime:Wl,getRental:Dl,getRentalCost:Ul,getSpotlightConfig:Vl,getSpotlightedListings:Yl,getUserActiveRentals:Ql,hasActiveRental:Zl,hasRentalRights:Gl,isMarketplacePaused:Jl,isRented:jl,list:ec,listNft:pr,promote:rc,promoteListing:ic,rent:tc,rentNft:mr,rentNftSimple:_l,spotlight:nc,spotlightListing:qa,updateListing:Fl,withdraw:ac,withdrawNft:fr},Symbol.toStringTag,{value:"Module"}));function br(){var a,n,i;const e=(w==null?void 0:w.decentralizedNotary)||(L==null?void 0:L.decentralizedNotary)||((a=window.contractAddresses)==null?void 0:a.decentralizedNotary)||(w==null?void 0:w.notary)||(L==null?void 0:L.notary)||((n=window.contractAddresses)==null?void 0:n.notary),t=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((i=window.contractAddresses)==null?void 0:i.bkcToken);if(!e)throw console.error("âŒ Notary address not found!",{addresses:w,contractAddresses:L}),new Error("Contract addresses not loaded. Please refresh the page.");return{NOTARY:e,BKC_TOKEN:t}}const gr=["function notarize(string calldata _ipfsCid, string calldata _description, bytes32 _contentHash, address _operator) external payable returns (uint256 tokenId)","function documents(uint256 tokenId) view returns (string ipfsCid, string description, bytes32 contentHash, uint256 timestamp)","function getDocument(uint256 _tokenId) view returns (tuple(string ipfsCid, string description, bytes32 contentHash, uint256 timestamp))","function notarizationFeePaid(uint256 tokenId) view returns (uint256)","function verifyByHash(bytes32 _contentHash) view returns (bool exists, uint256 tokenId, address owner, uint256 timestamp)","function hashToTokenId(bytes32 hash) view returns (uint256)","function getFee() view returns (uint256 bkcFee, uint256 ethFee)","function notarizationFeeETH() view returns (uint256)","function SERVICE_KEY() view returns (bytes32)","function totalSupply() view returns (uint256)","function totalNotarizations() view returns (uint256)","function totalBKCCollected() view returns (uint256)","function totalETHCollected() view returns (uint256)","function getStats() view returns (uint256 notarizations, uint256 bkcCollected, uint256 ethCollected)","function ownerOf(uint256 tokenId) view returns (address)","function balanceOf(address owner) view returns (uint256)","function tokenURI(uint256 _tokenId) view returns (string)","function name() view returns (string)","function symbol() view returns (string)","event DocumentNotarized(uint256 indexed tokenId, address indexed owner, string ipfsCid, bytes32 indexed contentHash, uint256 bkcFeePaid, uint256 ethFeePaid, address operator)","event ETHFeeUpdated(uint256 oldFee, uint256 newFee)"];function ds(e){const t=window.ethers;if(!t)throw new Error("ethers.js not loaded");if(!e)throw new Error("Signer is required for write operations");const a=br();return new t.Contract(a.NOTARY,gr,e)}async function st(){const e=window.ethers;if(!e)throw new Error("ethers.js not loaded");const{NetworkManager:t}=await W(async()=>{const{NetworkManager:i}=await import("./index-Jv5HScoX.js");return{NetworkManager:i}},[]),a=t.getProvider();if(!a)throw new Error("Provider not available");const n=br();return new e.Contract(n.NOTARY,gr,a)}function i0(e){if(!e)return!1;const t=e.startsWith("0x")?e:`0x${e}`;return/^0x[a-fA-F0-9]{64}$/.test(t)}async function sc({ipfsCid:e,description:t="",contentHash:a,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=window.ethers,l=br();if(!e||e.trim().length===0)throw new Error("IPFS CID is required");if(!a)throw new Error("Content hash is required");const c=a.startsWith("0x")?a:`0x${a}`;if(!i0(c))throw new Error("Invalid content hash format. Must be a valid bytes32 (64 hex characters)");let u=n,f=0n,p=0n;return await O.execute({name:"Notarize",button:i,getContract:async b=>ds(b),method:"notarize",args:()=>[e,t||"",c,V(u)],get value(){return p},get approval(){return f>0n&&l.BKC_TOKEN?{token:l.BKC_TOKEN,spender:l.NOTARY,amount:f}:null},validate:async(b,m)=>{const x=ds(b);try{const[P,z]=await x.getFee();f=P,p=z,console.log("[NotaryTx] Fees:",{bkcFee:o.formatEther(P)+" BKC",ethFee:o.formatEther(z)+" ETH"})}catch{try{p=await x.notarizationFeeETH()}catch{p=o.parseEther("0.0001")}f=o.parseEther("1")}const{NetworkManager:y}=await W(async()=>{const{NetworkManager:P}=await import("./index-Jv5HScoX.js");return{NetworkManager:P}},[]),C=y.getProvider(),A=await C.getBalance(m),N=p+o.parseEther("0.001");if(A<N)throw new Error(`Insufficient ETH. Need ~${o.formatEther(N)} ETH for fee + gas`);if(f>0n&&l.BKC_TOKEN){const P=["function balanceOf(address) view returns (uint256)"];if(await new o.Contract(l.BKC_TOKEN,P,C).balanceOf(m)<f)throw new Error(`Insufficient BKC. Need ${o.formatEther(f)} BKC`)}},onSuccess:async b=>{let m=null,x={bkc:0n,eth:0n};try{const y=new o.Interface(gr);for(const C of b.logs)try{const A=y.parseLog(C);if(A&&A.name==="DocumentNotarized"){m=Number(A.args.tokenId),x={bkc:A.args.bkcFeePaid,eth:A.args.ethFeePaid};break}}catch{}}catch{}r&&r(b,m,x)},onError:b=>{console.error("[NotaryTx] Notarization failed:",b),s&&s(b)}})}async function oc(e){const t=await st();try{const a=await t.getDocument(e),n=await t.ownerOf(e),i=await t.notarizationFeePaid(e).catch(()=>0n);return{id:e,owner:n,ipfsCid:a.ipfsCid,description:a.description,contentHash:a.contentHash,timestamp:Number(a.timestamp),date:new Date(Number(a.timestamp)*1e3),feePaid:i}}catch{return null}}async function xr(e){const t=await st(),a=e.startsWith("0x")?e:`0x${e}`;try{const n=await t.verifyByHash(a);return{exists:n.exists,tokenId:n.exists?Number(n.tokenId):null,owner:n.exists?n.owner:null,timestamp:n.exists?Number(n.timestamp):null,date:n.exists?new Date(Number(n.timestamp)*1e3):null}}catch(n){return console.error("[NotaryTx] verifyByHash error:",n),{exists:!1,tokenId:null,owner:null,timestamp:null,date:null}}}async function lc(e){const t=await st(),a=e.startsWith("0x")?e:`0x${e}`;try{const n=await t.hashToTokenId(a);return Number(n)>0?Number(n):null}catch{return null}}async function cc(){const e=window.ethers,t=await st();try{const[a,n]=await t.getFee();return{bkcFee:a,ethFee:n,bkcFormatted:e.formatEther(a)+" BKC",ethFormatted:e.formatEther(n)+" ETH",totalInEth:n}}catch{const a=await t.notarizationFeeETH().catch(()=>e.parseEther("0.0001"));return{bkcFee:e.parseEther("1"),ethFee:a,bkcFormatted:"1 BKC",ethFormatted:e.formatEther(a)+" ETH",totalInEth:a}}}async function dc(){const e=await st();try{return await e.notarizationFeeETH()}catch{return window.ethers.parseEther("0.0001")}}async function uc(){const e=await st();return Number(await e.totalSupply())}async function pc(){const e=window.ethers,t=await st();try{const a=await t.getStats();return{totalNotarizations:Number(a.notarizations),totalBKCCollected:a.bkcCollected,totalBKCFormatted:e.formatEther(a.bkcCollected),totalETHCollected:a.ethCollected,totalETHFormatted:e.formatEther(a.ethCollected)}}catch{const[a,n,i]=await Promise.all([t.totalNotarizations().catch(()=>0n),t.totalBKCCollected().catch(()=>0n),t.totalETHCollected().catch(()=>0n)]);return{totalNotarizations:Number(a),totalBKCCollected:n,totalBKCFormatted:e.formatEther(n),totalETHCollected:i,totalETHFormatted:e.formatEther(i)}}}async function mc(e){const t=await st();return Number(await t.balanceOf(e))}async function fc(e){return await(await st()).tokenURI(e)}async function Hn(e){let t;if(e instanceof ArrayBuffer)t=e;else if(e instanceof Blob||e instanceof File)t=await e.arrayBuffer();else throw new Error("Invalid file type. Expected File, Blob, or ArrayBuffer");const a=await crypto.subtle.digest("SHA-256",t);return"0x"+Array.from(new Uint8Array(a)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function hr(e,t){const a=await Hn(e),n=t.toLowerCase(),i=a.toLowerCase();return n===i}async function bc(e,t){const a=t||await Hn(e),n=await xr(a);let i=!0;return t&&(i=await hr(e,t)),{contentHash:a,hashMatches:i,existsOnChain:n.exists,tokenId:n.tokenId,owner:n.owner,timestamp:n.timestamp,date:n.date,isVerified:i&&n.exists}}const nt={notarize:sc,getDocument:oc,getTotalDocuments:uc,getUserDocumentCount:mc,getTokenURI:fc,verifyByHash:xr,getTokenIdByHash:lc,getFee:cc,getNotarizationFeeETH:dc,getStats:pc,calculateFileHash:Hn,verifyDocumentHash:hr,verifyDocumentOnChain:bc},r0=Object.freeze(Object.defineProperty({__proto__:null,NotaryTx:nt,calculateFileHash:Hn,getDocument:oc,getFee:cc,getNotarizationFeeETH:dc,getStats:pc,getTokenIdByHash:lc,getTokenURI:fc,getTotalDocuments:uc,getUserDocumentCount:mc,notarize:sc,verifyByHash:xr,verifyDocumentHash:hr,verifyDocumentOnChain:bc},Symbol.toStringTag,{value:"Module"}));function jt(){var a,n;const e=(w==null?void 0:w.backchat)||(L==null?void 0:L.backchat)||((a=window.contractAddresses)==null?void 0:a.backchat),t=(w==null?void 0:w.bkcToken)||(L==null?void 0:L.bkcToken)||((n=window.contractAddresses)==null?void 0:n.bkcToken);if(!e)throw new Error("Backchat contract address not loaded");return{BACKCHAT:e,BKC_TOKEN:t}}const Un=Zs;function $e(e){return new window.ethers.Contract(jt().BACKCHAT,Un,e)}async function J(){const{NetworkManager:e}=await W(async()=>{const{NetworkManager:t}=await import("./index-Jv5HScoX.js");return{NetworkManager:t}},[]);return new window.ethers.Contract(jt().BACKCHAT,Un,e.getProvider())}async function ua(e,t){var n;const a=window.ethers;try{const i=(n=e.runner)==null?void 0:n.provider;if(i){const r=await i.getFeeData(),s=r.gasPrice||r.maxFeePerGas||100000000n,o=await e.calculateFee(t,{gasPrice:s});if(o&&o>0n)return o}}catch(i){console.warn("[Backchat] Fee estimation fallback:",i.message)}return a.parseEther("0.0001")}async function gc({username:e,displayName:t,bio:a,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=window.ethers;let l=n,c=0n;return await O.execute({name:"CreateProfile",button:i,skipSimulation:!0,fixedGasLimit:300000n,getContract:async u=>$e(u),method:"createProfile",args:()=>[e,t||"",a||"",V(l)],get value(){return c},validate:async(u,f)=>{const p=await J();if(!e||e.length<1||e.length>15)throw new Error("Username must be 1-15 characters");if(!/^[a-z0-9_]+$/.test(e))throw new Error("Username can only contain lowercase letters, numbers, and underscores");if(!await p.isUsernameAvailable(e))throw new Error("Username is already taken");c=await p.getUsernameFee(e.length),console.log("[Backchat] Username fee:",o.formatEther(c),"ETH");const{NetworkManager:m}=await W(async()=>{const{NetworkManager:y}=await import("./index-Jv5HScoX.js");return{NetworkManager:y}},[]);if(await m.getProvider().getBalance(f)<c+o.parseEther("0.001"))throw new Error(`Insufficient ETH. Need ~${o.formatEther(c+o.parseEther("0.001"))} ETH`)},onSuccess:r,onError:s})}async function xc({displayName:e,bio:t,button:a=null,onSuccess:n=null,onError:i=null}){return await O.execute({name:"UpdateProfile",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async r=>$e(r),method:"updateProfile",args:[e||"",t||""],validate:async()=>{if(e&&e.length>30)throw new Error("Display name max 30 chars");if(t&&t.length>160)throw new Error("Bio max 160 chars")},onSuccess:n,onError:i})}async function hc({content:e,mediaCID:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=window.ethers;let o=a,l=0n;return await O.execute({name:"CreatePost",button:n,skipSimulation:!0,fixedGasLimit:300000n,getContract:async c=>$e(c),method:"createPost",args:()=>[e,t||"",V(o)],get value(){return l},validate:async(c,u)=>{if(!e||e.length===0)throw new Error("Content is required");if(e.length>500)throw new Error("Content max 500 chars");const f=await J();if(l=(await f.getCurrentFees()).postFee,(!l||l===0n)&&(l=await ua(f,1e5)),await f.runner.provider.getBalance(u)<l+s.parseEther("0.001"))throw new Error("Insufficient ETH")},onSuccess:async c=>{let u=null;try{const f=new s.Interface(Un);for(const p of c.logs)try{const b=f.parseLog(p);if((b==null?void 0:b.name)==="PostCreated"){u=Number(b.args.postId);break}}catch{}}catch{}i&&i(c,u)},onError:r})}async function vc({parentId:e,content:t,mediaCID:a,tipBkc:n,operator:i,button:r=null,onSuccess:s=null,onError:o=null}){const l=window.ethers,c=jt();let u=i,f=0n;const p=n?BigInt(n):0n;return await O.execute({name:"CreateReply",button:r,skipSimulation:!0,fixedGasLimit:350000n,getContract:async b=>$e(b),method:"createReply",args:()=>[e,t,a||"",V(u),p],get value(){return f},get approval(){return p>0n?{token:c.BKC_TOKEN,spender:c.BACKCHAT,amount:p}:null},validate:async(b,m)=>{if(!t)throw new Error("Content is required");if(t.length>500)throw new Error("Content max 500 chars");const x=await J(),y=x.runner.provider;if(await x.postAuthor(e)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");if(f=(await x.getCurrentFees()).replyFee,(!f||f===0n)&&(f=await ua(x,12e4)),await y.getBalance(m)<f+l.parseEther("0.001"))throw new Error("Insufficient ETH");if(p>0n&&await new l.Contract(c.BKC_TOKEN,["function balanceOf(address) view returns (uint256)"],y).balanceOf(m)<p)throw new Error("Insufficient BKC for tip")},onSuccess:async b=>{let m=null;try{const x=new l.Interface(Un);for(const y of b.logs)try{const C=x.parseLog(y);if((C==null?void 0:C.name)==="ReplyCreated"){m=Number(C.args.postId);break}}catch{}}catch{}s&&s(b,m)},onError:o})}async function wc({originalPostId:e,tipBkc:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=jt();let o=a,l=0n;const c=t?BigInt(t):0n;return await O.execute({name:"CreateRepost",button:n,skipSimulation:!0,fixedGasLimit:250000n,getContract:async u=>$e(u),method:"createRepost",args:()=>[e,V(o),c],get value(){return l},get approval(){return c>0n?{token:s.BKC_TOKEN,spender:s.BACKCHAT,amount:c}:null},validate:async(u,f)=>{const p=await J();if(await p.postAuthor(e)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");l=(await p.getCurrentFees()).repostFee,(!l||l===0n)&&(l=await ua(p,8e4))},onSuccess:i,onError:r})}async function yc({postId:e,tipBkc:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=jt();let o=a,l=0n;const c=t?BigInt(t):0n;return await O.execute({name:"Like",button:n,skipSimulation:!0,fixedGasLimit:200000n,getContract:async u=>$e(u),method:"like",args:()=>[e,V(o),c],get value(){return l},get approval(){return c>0n?{token:s.BKC_TOKEN,spender:s.BACKCHAT,amount:c}:null},validate:async(u,f)=>{const p=await J();if(await p.postAuthor(e)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");if(await p.hasUserLiked(e,f))throw new Error("Already liked this post");l=(await p.getCurrentFees()).likeFee,(!l||l===0n)&&(l=await ua(p,55e3))},onSuccess:i,onError:r})}async function kc({postId:e,ethAmount:t,tipBkc:a,operator:n,button:i=null,onSuccess:r=null,onError:s=null}){const o=window.ethers,l=jt();let c=n;const u=BigInt(t),f=a?BigInt(a):0n;return await O.execute({name:"SuperLike",button:i,skipSimulation:!0,fixedGasLimit:250000n,getContract:async p=>$e(p),method:"superLike",args:()=>[e,V(c),f],value:u,get approval(){return f>0n?{token:l.BKC_TOKEN,spender:l.BACKCHAT,amount:f}:null},validate:async(p,b)=>{const m=await J();if(await m.postAuthor(e)==="0x0000000000000000000000000000000000000000")throw new Error("Post not found");const y=await m.getCurrentFees();if(u<y.superLikeMin)throw new Error(`Minimum super like is ${o.formatEther(y.superLikeMin)} ETH`)},onSuccess:r,onError:s})}async function Ec({toFollow:e,tipBkc:t,operator:a,button:n=null,onSuccess:i=null,onError:r=null}){const s=jt();let o=a,l=0n;const c=t?BigInt(t):0n;return await O.execute({name:"Follow",button:n,skipSimulation:!0,fixedGasLimit:200000n,getContract:async u=>$e(u),method:"follow",args:()=>[e,V(o),c],get value(){return l},get approval(){return c>0n?{token:s.BKC_TOKEN,spender:s.BACKCHAT,amount:c}:null},validate:async(u,f)=>{if(!e||e==="0x0000000000000000000000000000000000000000")throw new Error("Invalid address");if(e.toLowerCase()===f.toLowerCase())throw new Error("Cannot follow yourself");const p=await J();l=(await p.getCurrentFees()).followFee,(!l||l===0n)&&(l=await ua(p,45e3))},onSuccess:i,onError:r})}async function Tc({toUnfollow:e,button:t=null,onSuccess:a=null,onError:n=null}){return await O.execute({name:"Unfollow",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async i=>$e(i),method:"unfollow",args:[e],onSuccess:a,onError:n})}async function Cc({ethAmount:e,operator:t,button:a=null,onSuccess:n=null,onError:i=null}){const r=window.ethers;let s=t;const o=BigInt(e);return await O.execute({name:"BoostProfile",button:a,skipSimulation:!0,fixedGasLimit:200000n,getContract:async l=>$e(l),method:"boostProfile",args:()=>[V(s)],value:o,validate:async l=>{const u=await(await J()).getCurrentFees();if(o<u.boostMin)throw new Error(`Minimum boost is ${r.formatEther(u.boostMin)} ETH`)},onSuccess:n,onError:i})}async function Ic({operator:e,button:t=null,onSuccess:a=null,onError:n=null}){let i=e,r=0n;return await O.execute({name:"ObtainBadge",button:t,skipSimulation:!0,fixedGasLimit:250000n,getContract:async s=>$e(s),method:"obtainBadge",args:()=>[V(i)],get value(){return r},validate:async s=>{const o=await J();r=(await o.getCurrentFees()).badgeFee_,(!r||r===0n)&&(r=await ua(o,2e5))},onSuccess:a,onError:n})}async function Ac({button:e=null,onSuccess:t=null,onError:a=null}){const n=window.ethers;return await O.execute({name:"Withdraw",button:e,skipSimulation:!0,fixedGasLimit:200000n,getContract:async i=>$e(i),method:"withdraw",args:[],validate:async(i,r)=>{const o=await(await J()).getPendingBalance(r);if(o===0n)throw new Error("Nothing to withdraw");console.log("[Backchat] Withdrawing:",n.formatEther(o),"ETH")},onSuccess:t,onError:a})}async function Bc({referrer:e,button:t=null,onSuccess:a=null,onError:n=null}){return await O.execute({name:"SetReferrer",button:t,skipSimulation:!0,fixedGasLimit:150000n,getContract:async i=>$e(i),method:"setReferrer",args:[e],validate:async(i,r)=>{if(!e||e==="0x0000000000000000000000000000000000000000")throw new Error("Invalid referrer address");if(e.toLowerCase()===r.toLowerCase())throw new Error("Cannot refer yourself");if(await(await J()).referredBy(r)!=="0x0000000000000000000000000000000000000000")throw new Error("Referrer already set (immutable)")},onSuccess:a,onError:n})}async function zc(e){const t=window.ethers,n=await(await J()).getReferralStats(e);return{totalReferred:Number(n.totalReferred),totalEarned:n.totalEarned,totalEarnedFormatted:t.formatEther(n.totalEarned)}}async function Pc(e){return await(await J()).referredBy(e)}async function Nc(){const e=window.ethers,a=await(await J()).getCurrentFees();return{postFee:a.postFee,postFeeFormatted:e.formatEther(a.postFee),replyFee:a.replyFee,replyFeeFormatted:e.formatEther(a.replyFee),likeFee:a.likeFee,likeFeeFormatted:e.formatEther(a.likeFee),followFee:a.followFee,followFeeFormatted:e.formatEther(a.followFee),repostFee:a.repostFee,repostFeeFormatted:e.formatEther(a.repostFee),superLikeMin:a.superLikeMin,superLikeMinFormatted:e.formatEther(a.superLikeMin),boostMin:a.boostMin,boostMinFormatted:e.formatEther(a.boostMin),badgeFee:a.badgeFee_,badgeFeeFormatted:e.formatEther(a.badgeFee_)}}async function $c(e){const t=window.ethers,n=await(await J()).getUsernameFee(e);return{fee:n,formatted:t.formatEther(n)}}async function Sc(e){return await(await J()).postAuthor(e)}async function Lc(){const e=await J();return Number(await e.postCounter())}async function Rc(e){const t=window.ethers,n=await(await J()).getPendingBalance(e);return{balance:n,formatted:t.formatEther(n)}}async function _c(e){return await(await J()).isUsernameAvailable(e)}async function Fc(e){return await(await J()).getUsernameOwner(e)}async function Mc(e,t){return await(await J()).hasUserLiked(e,t)}async function Dc(e){return await(await J()).isProfileBoosted(e)}async function Oc(e){return await(await J()).hasTrustBadge(e)}async function Hc(e){const t=await J();return Number(await t.boostExpiry(e))}async function Uc(e){const t=await J();return Number(await t.badgeExpiry(e))}async function jc(){return await(await J()).version()}const ke={createProfile:gc,updateProfile:xc,createPost:hc,createReply:vc,createRepost:wc,like:yc,superLike:kc,follow:Ec,unfollow:Tc,boostProfile:Cc,obtainBadge:Ic,withdraw:Ac,setReferrer:Bc,getReferralStats:zc,getReferredBy:Pc,getCurrentFees:Nc,getUsernameFee:$c,getPostAuthor:Sc,getPostCount:Lc,getPendingBalance:Rc,isUsernameAvailable:_c,getUsernameOwner:Fc,hasUserLiked:Mc,isProfileBoosted:Dc,hasTrustBadge:Oc,getBoostExpiry:Hc,getBadgeExpiry:Uc,getVersion:jc},s0=Object.freeze(Object.defineProperty({__proto__:null,BackchatTx:ke,boostProfile:Cc,createPost:hc,createProfile:gc,createReply:vc,createRepost:wc,follow:Ec,getBadgeExpiry:Uc,getBoostExpiry:Hc,getCurrentFees:Nc,getPendingBalance:Rc,getPostAuthor:Sc,getPostCount:Lc,getReferralStats:zc,getReferredBy:Pc,getUsernameFee:$c,getUsernameOwner:Fc,getVersion:jc,hasTrustBadge:Oc,hasUserLiked:Mc,isProfileBoosted:Dc,isUsernameAvailable:_c,like:yc,obtainBadge:Ic,setReferrer:Bc,superLike:kc,unfollow:Tc,updateProfile:xc,withdraw:Ac},Symbol.toStringTag,{value:"Module"}));(async()=>(await W(async()=>{const{CharityTx:e}=await Promise.resolve().then(()=>Kp);return{CharityTx:e}},void 0)).CharityTx)(),(async()=>(await W(async()=>{const{StakingTx:e}=await Promise.resolve().then(()=>Vp);return{StakingTx:e}},void 0)).StakingTx)(),(async()=>(await W(async()=>{const{NftTx:e}=await Promise.resolve().then(()=>Jp);return{NftTx:e}},void 0)).NftTx)(),(async()=>(await W(async()=>{const{FortuneTx:e}=await Promise.resolve().then(()=>e0);return{FortuneTx:e}},void 0)).FortuneTx)(),(async()=>(await W(async()=>{const{RentalTx:e}=await Promise.resolve().then(()=>n0);return{RentalTx:e}},void 0)).RentalTx)(),(async()=>(await W(async()=>{const{NotaryTx:e}=await Promise.resolve().then(()=>r0);return{NotaryTx:e}},void 0)).NotaryTx)(),(async()=>(await W(async()=>{const{FaucetTx:e}=await Promise.resolve().then(()=>Np);return{FaucetTx:e}},void 0)).FaucetTx)(),(async()=>(await W(async()=>{const{BackchatTx:e}=await Promise.resolve().then(()=>s0);return{BackchatTx:e}},void 0)).BackchatTx)();const ta=window.ethers,R={hasRenderedOnce:!1,lastUpdate:0,activities:[],networkActivities:[],filteredActivities:[],userProfile:null,pagination:{currentPage:1,itemsPerPage:8},filters:{type:"ALL",sort:"NEWEST"},metricsCache:{},economicData:null,isLoadingNetworkActivity:!1,networkActivitiesTimestamp:0,faucet:{canClaim:!0,cooldownEnd:null,isLoading:!1,lastCheck:0}},us="https://sepolia.arbiscan.io/tx/",o0="https://sepolia.arbiscan.io/address/",l0="https://faucet-4wvdcuoouq-uc.a.run.app",c0="https://getrecentactivity-4wvdcuoouq-uc.a.run.app",d0="https://getsystemdata-4wvdcuoouq-uc.a.run.app",Ci="1,000",Ii="0.01",u0=ta.parseUnits("100",18),D={STAKING:{icon:"fa-lock",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”’ Staked",emoji:"ðŸ”’"},UNSTAKING:{icon:"fa-unlock",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ”“ Unstaked",emoji:"ðŸ”“"},FORCE_UNSTAKE:{icon:"fa-bolt",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"âš¡ Force Unstaked",emoji:"âš¡"},CLAIM:{icon:"fa-coins",color:"#fbbf24",bg:"rgba(245,158,11,0.15)",label:"ðŸª™ Rewards Claimed",emoji:"ðŸª™"},NFT_BUY:{icon:"fa-bag-shopping",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ›ï¸ Bought NFT",emoji:"ðŸ›ï¸"},NFT_SELL:{icon:"fa-hand-holding-dollar",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"ðŸ’° Sold NFT",emoji:"ðŸ’°"},NFT_MINT:{icon:"fa-gem",color:"#fde047",bg:"rgba(234,179,8,0.15)",label:"ðŸ’Ž Minted Booster",emoji:"ðŸ’Ž"},NFT_TRANSFER:{icon:"fa-arrow-right-arrow-left",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"â†”ï¸ Transfer",emoji:"â†”ï¸"},RENTAL_LIST:{icon:"fa-tag",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ·ï¸ Listed NFT",emoji:"ðŸ·ï¸"},RENTAL_RENT:{icon:"fa-clock",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"â° Rented NFT",emoji:"â°"},RENTAL_WITHDRAW:{icon:"fa-rotate-left",color:"#fb923c",bg:"rgba(249,115,22,0.15)",label:"â†©ï¸ Withdrawn",emoji:"â†©ï¸"},RENTAL_PROMOTE:{icon:"fa-bullhorn",color:"#fbbf24",bg:"rgba(251,191,36,0.2)",label:"ðŸ“¢ Promoted NFT",emoji:"ðŸ“¢"},FORTUNE_COMMIT:{icon:"fa-lock",color:"#a855f7",bg:"rgba(168,85,247,0.2)",label:"ðŸ” Game Committed",emoji:"ðŸ”"},FORTUNE_REVEAL:{icon:"fa-dice",color:"#f97316",bg:"rgba(249,115,22,0.2)",label:"ðŸŽ² Game Revealed",emoji:"ðŸŽ²"},FORTUNE_BET:{icon:"fa-paw",color:"#f97316",bg:"rgba(249,115,22,0.2)",label:"ðŸ¯ Fortune Bet",emoji:"ðŸ¯"},FORTUNE_COMBO:{icon:"fa-rocket",color:"#a855f7",bg:"rgba(168,85,247,0.2)",label:"ðŸš€ Combo Mode",emoji:"ðŸš€"},FORTUNE_WIN:{icon:"fa-trophy",color:"#facc15",bg:"rgba(234,179,8,0.25)",label:"ðŸ† Winner!",emoji:"ðŸ†"},NOTARY:{icon:"fa-stamp",color:"#818cf8",bg:"rgba(99,102,241,0.15)",label:"ðŸ“œ Notarized",emoji:"ðŸ“œ"},BACKCHAT_POST:{icon:"fa-comment",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ’¬ Posted",emoji:"ðŸ’¬"},BACKCHAT_LIKE:{icon:"fa-heart",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"â¤ï¸ Liked",emoji:"â¤ï¸"},BACKCHAT_REPLY:{icon:"fa-reply",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"â†©ï¸ Replied",emoji:"â†©ï¸"},BACKCHAT_SUPERLIKE:{icon:"fa-star",color:"#fbbf24",bg:"rgba(251,191,36,0.2)",label:"â­ Super Liked",emoji:"â­"},BACKCHAT_REPOST:{icon:"fa-retweet",color:"#4ade80",bg:"rgba(34,197,94,0.15)",label:"ðŸ”„ Reposted",emoji:"ðŸ”„"},BACKCHAT_FOLLOW:{icon:"fa-user-plus",color:"#a78bfa",bg:"rgba(167,139,250,0.15)",label:"ðŸ‘¥ Followed",emoji:"ðŸ‘¥"},BACKCHAT_PROFILE:{icon:"fa-user",color:"#60a5fa",bg:"rgba(59,130,246,0.15)",label:"ðŸ‘¤ Profile Created",emoji:"ðŸ‘¤"},BACKCHAT_BOOST:{icon:"fa-rocket",color:"#f97316",bg:"rgba(249,115,22,0.15)",label:"ðŸš€ Profile Boosted",emoji:"ðŸš€"},BACKCHAT_BADGE:{icon:"fa-circle-check",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"âœ… Badge Activated",emoji:"âœ…"},BACKCHAT_TIP:{icon:"fa-coins",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"ðŸ’° Tipped BKC",emoji:"ðŸ’°"},BACKCHAT_WITHDRAW:{icon:"fa-wallet",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ’¸ ETH Withdrawn",emoji:"ðŸ’¸"},CHARITY_DONATE:{icon:"fa-heart",color:"#ec4899",bg:"rgba(236,72,153,0.15)",label:"ðŸ’ Donated",emoji:"ðŸ’"},CHARITY_CREATE:{icon:"fa-hand-holding-heart",color:"#10b981",bg:"rgba(16,185,129,0.15)",label:"ðŸŒ± Campaign Created",emoji:"ðŸŒ±"},CHARITY_CANCEL:{icon:"fa-heart-crack",color:"#ef4444",bg:"rgba(239,68,68,0.15)",label:"ðŸ’” Campaign Cancelled",emoji:"ðŸ’”"},CHARITY_WITHDRAW:{icon:"fa-hand-holding-dollar",color:"#8b5cf6",bg:"rgba(139,92,246,0.15)",label:"ðŸ’° Funds Withdrawn",emoji:"ðŸ’°"},CHARITY_GOAL_REACHED:{icon:"fa-trophy",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",label:"ðŸ† Goal Reached!",emoji:"ðŸ†"},FAUCET:{icon:"fa-droplet",color:"#22d3ee",bg:"rgba(6,182,212,0.15)",label:"ðŸ’§ Faucet Claim",emoji:"ðŸ’§"},DEFAULT:{icon:"fa-circle",color:"#71717a",bg:"rgba(39,39,42,0.5)",label:"Activity",emoji:"ðŸ“‹"}};function p0(e){if(!e)return"Just now";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3,a=new Date(t*1e3),i=new Date-a,r=Math.floor(i/6e4),s=Math.floor(i/36e5),o=Math.floor(i/864e5);return r<1?"Just now":r<60?`${r}m ago`:s<24?`${s}h ago`:o<7?`${o}d ago`:a.toLocaleDateString()}catch{return"Recent"}}function m0(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function ri(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toFixed(0)}function f0(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function b0(e){if(!e)return"";const t=Date.now(),n=new Date(e).getTime()-t;if(n<=0)return"";const i=Math.floor(n/36e5),r=Math.floor(n%36e5/6e4);return i>0?`${i}h ${r}m`:`${r}m`}function g0(e,t={}){const a=(e||"").toUpperCase().trim();return a==="STAKING"||a==="STAKED"||a==="STAKE"||a==="DELEGATED"||a==="DELEGATION"||a.includes("DELEGAT")?D.STAKING:a==="UNSTAKING"||a==="UNSTAKED"||a==="UNSTAKE"||a==="UNDELEGATED"?D.UNSTAKING:a==="FORCE_UNSTAKE"||a==="FORCEUNSTAKE"||a==="FORCE_UNSTAKED"?D.FORCE_UNSTAKE:a==="CLAIM"||a==="CLAIMED"||a==="REWARD"||a==="REWARDS"||a==="REWARD_CLAIMED"||a==="REWARDCLAIMED"?D.CLAIM:a==="NFT_BUY"||a==="NFTBUY"||a==="BOOSTER_BUY"||a==="BOOSTERBUY"||a==="BOOSTERBOUGHT"||a.includes("BUY")&&(a.includes("NFT")||a.includes("BOOSTER"))?D.NFT_BUY:a==="NFT_SELL"||a==="NFTSELL"||a==="BOOSTER_SELL"||a==="BOOSTERSELL"||a==="BOOSTERSOLD"||a.includes("SELL")&&(a.includes("NFT")||a.includes("BOOSTER"))?D.NFT_SELL:a==="NFT_MINT"||a==="NFTMINT"||a==="BOOSTER_MINT"||a==="BOOSTERMINT"||a==="MINTED"||a==="BOOSTERMINTED"?D.NFT_MINT:a==="NFT_TRANSFER"||a==="NFTTRANSFER"||a==="BOOSTER_TRANSFER"||a==="BOOSTERTRANSFER"||a==="TRANSFER"?D.NFT_TRANSFER:a==="RENTAL_LIST"||a==="RENTALLISTED"||a==="RENTAL_LISTED"||a==="LISTED"||a.includes("LIST")&&a.includes("RENTAL")?D.RENTAL_LIST:a==="RENTAL_RENT"||a==="RENTALRENTED"||a==="RENTAL_RENTED"||a==="RENTED"||a.includes("RENT")&&!a.includes("LIST")?D.RENTAL_RENT:a==="RENTAL_WITHDRAW"||a==="RENTALWITHDRAWN"||a==="RENTAL_WITHDRAWN"?D.RENTAL_WITHDRAW:a==="RENTAL_PROMOTE"||a==="RENTALPROMOTED"||a==="RENTAL_PROMOTED"||a.includes("PROMOT")||a.includes("ADS")||a.includes("ADVERTIS")?D.RENTAL_PROMOTE:a==="FORTUNE_COMMIT"||a==="GAMECOMMITTED"||a==="GAME_COMMITTED"||a==="COMMITTED"?D.FORTUNE_COMMIT:a==="FORTUNE_REVEAL"||a==="GAMEREVEALED"||a==="GAME_REVEALED"||a==="REVEALED"?D.FORTUNE_REVEAL:a.includes("GAME")||a.includes("FORTUNE")||a.includes("REQUEST")||a.includes("FULFILLED")||a.includes("RESULT")?(t==null?void 0:t.isWin)||(t==null?void 0:t.prizeWon)&&BigInt(t.prizeWon||0)>0n?D.FORTUNE_WIN:(t==null?void 0:t.isCumulative)?D.FORTUNE_COMBO:D.FORTUNE_BET:a==="POSTCREATED"||a==="POST_CREATED"||a==="POSTED"||a==="BACKCHAT_POST"||a.includes("POST")&&!a.includes("REPOST")?D.BACKCHAT_POST:a==="SUPERLIKED"||a==="SUPER_LIKED"||a.includes("SUPERLIKE")?D.BACKCHAT_SUPERLIKE:a==="LIKED"||a==="POSTLIKED"||a==="POST_LIKED"||a.includes("LIKE")&&!a.includes("SUPER")?D.BACKCHAT_LIKE:a==="REPLYCREATED"||a==="REPLY_CREATED"||a.includes("REPLY")?D.BACKCHAT_REPLY:a==="REPOSTCREATED"||a==="REPOST_CREATED"||a.includes("REPOST")?D.BACKCHAT_REPOST:a==="FOLLOWED"||a==="USER_FOLLOWED"||a.includes("FOLLOW")?D.BACKCHAT_FOLLOW:a==="PROFILECREATED"||a==="PROFILE_CREATED"||a.includes("PROFILE")&&a.includes("CREAT")?D.BACKCHAT_PROFILE:a==="PROFILEBOOSTED"||a==="PROFILE_BOOSTED"||a==="BOOSTED"||a.includes("BOOST")&&!a.includes("NFT")?D.BACKCHAT_BOOST:a==="BADGEACTIVATED"||a==="BADGE_ACTIVATED"||a.includes("BADGE")?D.BACKCHAT_BADGE:a==="TIPPROCESSED"||a==="TIP_PROCESSED"||a==="TIPPED"||a.includes("TIP")?D.BACKCHAT_TIP:a==="ETHWITHDRAWN"||a==="ETH_WITHDRAWN"||a==="BACKCHAT_WITHDRAW"?D.BACKCHAT_WITHDRAW:a==="CHARITYDONATION"||a==="DONATIONMADE"||a==="CHARITY_DONATE"||a==="DONATED"||a==="DONATION"||a.includes("DONATION")?D.CHARITY_DONATE:a==="CHARITYCAMPAIGNCREATED"||a==="CAMPAIGNCREATED"||a==="CHARITY_CREATE"||a==="CAMPAIGN_CREATED"||a.includes("CAMPAIGNCREATED")?D.CHARITY_CREATE:a==="CHARITYCAMPAIGNCANCELLED"||a==="CAMPAIGNCANCELLED"||a==="CHARITY_CANCEL"||a==="CAMPAIGN_CANCELLED"||a.includes("CANCELLED")?D.CHARITY_CANCEL:a==="CHARITYFUNDSWITHDRAWN"||a==="FUNDSWITHDRAWN"||a==="CHARITY_WITHDRAW"||a==="CAMPAIGN_WITHDRAW"||a.includes("WITHDRAWN")?D.CHARITY_WITHDRAW:a==="CHARITYGOALREACHED"||a==="GOALREACHED"||a==="CHARITY_GOAL"||a==="CAMPAIGN_COMPLETED"?D.CHARITY_GOAL_REACHED:a==="NOTARYREGISTER"||a==="NOTARIZED"||a.includes("NOTARY")||a.includes("DOCUMENT")?D.NOTARY:a==="FAUCETCLAIM"||a.includes("FAUCET")||a.includes("DISTRIBUTED")?D.FAUCET:D.DEFAULT}let si=null,Ct=0n;function Wc(e){const t=document.getElementById("dash-user-rewards");if(!t||!d.isConnected){si&&cancelAnimationFrame(si);return}const a=e-Ct;a>-1000000000n&&a<1000000000n?Ct=e:Ct+=a/8n,Ct<0n&&(Ct=0n),t.innerHTML=`${M(Ct).toFixed(4)} <span class="dash-reward-suffix">BKC</span>`,Ct!==e&&(si=requestAnimationFrame(()=>Wc(e)))}async function ps(e){if(!d.isConnected||!d.userAddress)return h("Connect wallet first","error");const t=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Sending...',R.faucet.isLoading=!0;try{const a=await fetch(`${l0}?address=${d.userAddress}`,{method:"GET",headers:{Accept:"application/json"}}),n=await a.json();if(a.ok&&n.success)h(`Faucet Sent! ${Ci} BKC + ${Ii} ETH`,"success"),R.faucet.canClaim=!1,R.faucet.cooldownEnd=new Date(Date.now()+24*60*60*1e3).toISOString(),Ai(),setTimeout(()=>{Yc.update(!0)},4e3);else{const i=n.error||n.message||"Faucet unavailable";if(i.toLowerCase().includes("cooldown")||i.toLowerCase().includes("wait")||i.toLowerCase().includes("hour")){h(`${i}`,"warning");const r=i.match(/(\d+)\s*hour/i);r&&(R.faucet.canClaim=!1,R.faucet.cooldownEnd=new Date(Date.now()+parseInt(r[1])*36e5).toISOString(),Ai())}else h(`${i}`,"error")}}catch(a){console.error("Faucet error:",a),h("Faucet Offline - Try again later","error")}finally{R.faucet.isLoading=!1,e.disabled=!1,e.innerHTML=t}}function x0(){return d.isConnected?(d.currentUserBalance||d.bkcBalance||0n)<u0:!1}function Ai(){const e=document.getElementById("dashboard-faucet-widget");if(!e)return;if(!x0()){e.classList.add("hidden");return}e.classList.remove("hidden");const t=d.currentUserBalance||d.bkcBalance||0n,a=t===0n,n=b0(R.faucet.cooldownEnd),i=R.faucet.canClaim&&!n,r=document.getElementById("faucet-title"),s=document.getElementById("faucet-desc"),o=document.getElementById("faucet-status"),l=document.getElementById("faucet-action-btn");if(!i&&n)e.className="dash-faucet-banner dash-faucet-cooldown",r&&(r.innerText="Faucet Cooldown"),s&&(s.innerText="Come back when the timer ends"),o&&(o.classList.remove("hidden"),o.innerHTML=`<i class="fa-solid fa-clock mr-1"></i> ${n} remaining`),l&&(l.className="dash-btn-secondary",l.innerHTML='<i class="fa-solid fa-hourglass-half mr-2"></i> On Cooldown',l.disabled=!0);else if(a)e.className="dash-faucet-banner dash-faucet-welcome",r&&(r.innerText="Welcome to BackCoin!"),s&&(s.innerText=`Claim your free starter pack: ${Ci} BKC + ${Ii} ETH for gas`),o&&o.classList.add("hidden"),l&&(l.className="dash-btn-primary dash-btn-green",l.innerHTML='<i class="fa-solid fa-gift mr-2"></i> Claim Starter Pack',l.disabled=!1);else{const c=M(t).toFixed(2);e.className="dash-faucet-banner dash-faucet-refill",r&&(r.innerText="Need More BKC?"),s&&(s.innerText=`Balance: ${c} BKC â€” Get ${Ci} BKC + ${Ii} ETH`),o&&o.classList.add("hidden"),l&&(l.className="dash-btn-primary dash-btn-cyan",l.innerHTML='<i class="fa-solid fa-faucet mr-2"></i> Request Tokens',l.disabled=!1)}}async function h0(){try{if(await d.provider.getBalance(d.userAddress)<ta.parseEther("0.002")){const t=document.getElementById("no-gas-modal-dash");return t&&(t.classList.remove("hidden"),t.classList.add("flex")),!1}return!0}catch{return!0}}function v0(){if(document.getElementById("dash-styles-v69"))return;const e=document.createElement("style");e.id="dash-styles-v69",e.textContent=`
        /* â”€â”€ CSS Variables â”€â”€ */
        .dash-shell {
            --dash-bg: #0c0c0e;
            --dash-surface: #141417;
            --dash-surface-2: #1c1c21;
            --dash-surface-3: #222228;
            --dash-border: rgba(255,255,255,0.06);
            --dash-border-h: rgba(255,255,255,0.12);
            --dash-text: #f0f0f2;
            --dash-text-2: #a0a0ab;
            --dash-text-3: #5c5c68;
            --dash-accent: #f59e0b;
            --dash-green: #4ade80;
            --dash-purple: #a78bfa;
            --dash-cyan: #22d3ee;
            --dash-radius: 16px;
            --dash-radius-sm: 10px;
            --dash-tr: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* â”€â”€ Animations â”€â”€ */
        @keyframes dash-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes dash-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes dash-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes dash-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
        @keyframes dash-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes dash-pulse-ring { 0% { transform: scale(0.9); opacity: 0.6; } 100% { transform: scale(1.4); opacity: 0; } }

        /* â”€â”€ Shell â”€â”€ */
        .dash-shell { max-width: 1200px; margin: 0 auto; padding: 0 16px 40px; animation: dash-fadeIn 0.4s ease-out; }

        /* â”€â”€ Hero Section â”€â”€ */
        .dash-hero {
            position: relative;
            background: linear-gradient(135deg, rgba(20,20,23,0.95), rgba(12,12,14,0.98));
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius);
            padding: 28px 24px;
            overflow: hidden;
            animation: dash-scaleIn 0.5s ease-out;
        }
        .dash-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(245,158,11,0.06) 0%, transparent 70%);
            pointer-events: none;
            animation: dash-glow 4s ease-in-out infinite;
        }
        .dash-hero-inner { display: flex; gap: 24px; position: relative; z-index: 1; }
        .dash-hero-left { flex: 1.2; min-width: 0; }
        .dash-hero-right { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
        .dash-hero-label { font-size: 11px; color: var(--dash-text-3); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; margin-bottom: 4px; }
        .dash-reward-value {
            font-size: clamp(28px, 5vw, 40px);
            font-weight: 800;
            color: var(--dash-green);
            font-variant-numeric: tabular-nums;
            line-height: 1.1;
            text-shadow: 0 0 30px rgba(74,222,128,0.2);
        }
        .dash-reward-suffix { font-size: 14px; color: rgba(74,222,128,0.6); font-weight: 600; }
        .dash-hero-pstake { display: flex; align-items: center; gap: 12px; margin-top: 16px; padding-top: 14px; border-top: 1px solid var(--dash-border); }
        .dash-hero-pstake-label { font-size: 10px; color: var(--dash-text-3); text-transform: uppercase; }
        .dash-hero-pstake-value { font-size: 18px; font-weight: 700; color: var(--dash-purple); font-family: 'SF Mono', monospace; }
        .dash-hero-ghost {
            position: absolute;
            top: 12px;
            right: 16px;
            width: 64px;
            height: 64px;
            opacity: 0.06;
            animation: dash-float 6s ease-in-out infinite;
            pointer-events: none;
        }

        /* â”€â”€ Claim Button â”€â”€ */
        .dash-claim-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            padding: 10px 24px;
            background: linear-gradient(135deg, #22c55e, #10b981);
            color: white;
            font-weight: 700;
            font-size: 14px;
            border-radius: var(--dash-radius-sm);
            border: none;
            cursor: pointer;
            transition: all var(--dash-tr);
            box-shadow: 0 4px 20px rgba(34,197,94,0.25);
        }
        .dash-claim-btn:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 28px rgba(34,197,94,0.35); }
        .dash-claim-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
        .dash-stake-link {
            font-size: 12px; color: var(--dash-purple); font-weight: 600; cursor: pointer;
            transition: color var(--dash-tr); margin-left: auto;
        }
        .dash-stake-link:hover { color: var(--dash-text); }

        /* â”€â”€ Gain Upsell â”€â”€ */
        .dash-gain-area {
            display: none;
            margin-top: 10px;
            padding: 6px 10px;
            background: linear-gradient(90deg, rgba(245,158,11,0.08), rgba(74,222,128,0.08));
            border: 1px solid rgba(245,158,11,0.2);
            border-radius: 8px;
            font-size: 10px;
            color: var(--dash-accent);
            font-weight: 700;
        }
        .dash-gain-area.visible { display: inline-block; }

        /* â”€â”€ Faucet Banner â”€â”€ */
        .dash-faucet-banner {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 14px 18px;
            border-radius: var(--dash-radius-sm);
            border: 1px solid var(--dash-border);
            background: var(--dash-surface);
            animation: dash-fadeIn 0.4s ease-out;
        }
        .dash-faucet-welcome { border-left: 3px solid #22c55e; }
        .dash-faucet-refill { border-left: 3px solid var(--dash-cyan); }
        .dash-faucet-cooldown { border-left: 3px solid #71717a; }
        .dash-faucet-banner h3 { font-size: 13px; font-weight: 700; color: var(--dash-text); margin: 0; }
        .dash-faucet-banner p { font-size: 11px; color: var(--dash-text-2); margin: 2px 0 0; }
        .dash-faucet-banner .faucet-status-text { font-size: 11px; color: var(--dash-accent); font-family: monospace; }

        /* â”€â”€ Quick Actions Grid â”€â”€ */
        .dash-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .dash-action-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            cursor: pointer;
            transition: all var(--dash-tr);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        .dash-action-card::before {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity var(--dash-tr);
            pointer-events: none;
        }
        .dash-action-card:hover { border-color: var(--dash-border-h); transform: translateY(-2px); }
        .dash-action-card:hover::before { opacity: 1; }
        .dash-action-icon {
            width: 38px; height: 38px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .dash-action-text h4 { font-size: 13px; font-weight: 700; color: var(--dash-text); margin: 0; }
        .dash-action-text p { font-size: 10px; color: var(--dash-text-3); margin: 2px 0 0; }
        .dash-action-arrow { font-size: 10px; color: var(--dash-text-3); margin-left: auto; transition: transform var(--dash-tr); }
        .dash-action-card:hover .dash-action-arrow { transform: translateX(3px); color: var(--dash-text-2); }

        /* Action card themes */
        .dash-action-card.backchat::before { background: linear-gradient(135deg, rgba(6,182,212,0.06), transparent); }
        .dash-action-card.backchat:hover { border-color: rgba(6,182,212,0.3); }
        .dash-action-card.stake::before { background: linear-gradient(135deg, rgba(167,139,250,0.06), transparent); }
        .dash-action-card.stake:hover { border-color: rgba(167,139,250,0.3); }
        .dash-action-card.fortune::before { background: linear-gradient(135deg, rgba(249,115,22,0.06), transparent); }
        .dash-action-card.fortune:hover { border-color: rgba(249,115,22,0.3); }
        .dash-action-card.notary::before { background: linear-gradient(135deg, rgba(129,140,248,0.06), transparent); }
        .dash-action-card.notary:hover { border-color: rgba(129,140,248,0.3); }
        .dash-action-card.charity::before { background: linear-gradient(135deg, rgba(236,72,153,0.06), transparent); }
        .dash-action-card.charity:hover { border-color: rgba(236,72,153,0.3); }
        .dash-action-card.nft::before { background: linear-gradient(135deg, rgba(245,158,11,0.06), transparent); }
        .dash-action-card.nft:hover { border-color: rgba(245,158,11,0.3); }

        /* â”€â”€ Metrics Bar â”€â”€ */
        .dash-metrics-bar {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }
        .dash-metric-pill {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 10px 12px;
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            transition: border-color var(--dash-tr);
        }
        .dash-metric-pill:hover { border-color: var(--dash-border-h); }
        .dash-metric-pill-label { font-size: 9px; color: var(--dash-text-3); text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .dash-metric-pill-label i { font-size: 9px; }
        .dash-metric-pill-value { font-size: 14px; font-weight: 700; color: var(--dash-text); font-variant-numeric: tabular-nums; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* â”€â”€ Content Layout â”€â”€ */
        .dash-content { display: grid; grid-template-columns: 1fr 300px; gap: 16px; }

        /* â”€â”€ Activity Panel â”€â”€ */
        .dash-activity-panel {
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius);
            padding: 16px;
            animation: dash-fadeIn 0.5s ease-out 0.1s both;
        }
        .dash-activity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .dash-activity-title { font-size: 13px; font-weight: 700; color: var(--dash-text); display: flex; align-items: center; gap: 8px; }
        .dash-activity-title i { color: var(--dash-text-3); font-size: 12px; }
        .dash-sort-btn {
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            color: var(--dash-text-3);
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--dash-tr);
        }
        .dash-sort-btn:hover { color: var(--dash-text); border-color: var(--dash-border-h); }

        /* â”€â”€ Filter Chips â”€â”€ */
        .dash-filter-chips { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .dash-chip {
            padding: 4px 10px;
            font-size: 10px;
            font-weight: 600;
            color: var(--dash-text-3);
            background: var(--dash-surface-2);
            border: 1px solid var(--dash-border);
            border-radius: 20px;
            cursor: pointer;
            transition: all var(--dash-tr);
            white-space: nowrap;
        }
        .dash-chip:hover { color: var(--dash-text-2); border-color: var(--dash-border-h); }
        .dash-chip.active { color: var(--dash-accent); background: rgba(245,158,11,0.1); border-color: rgba(245,158,11,0.3); }

        /* â”€â”€ Activity List â”€â”€ */
        .dash-activity-list { display: flex; flex-direction: column; gap: 6px; min-height: 150px; max-height: 520px; overflow-y: auto; }
        .dash-activity-list::-webkit-scrollbar { width: 4px; }
        .dash-activity-list::-webkit-scrollbar-track { background: transparent; }
        .dash-activity-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 4px; }

        .dash-activity-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--dash-surface-2);
            border: 1px solid transparent;
            border-radius: 8px;
            transition: all var(--dash-tr);
            text-decoration: none;
            gap: 10px;
        }
        .dash-activity-item:hover { background: var(--dash-surface-3); border-color: var(--dash-border-h); }
        .dash-activity-item-icon {
            width: 32px; height: 32px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
            font-size: 12px;
        }
        .dash-activity-item-info { flex: 1; min-width: 0; }
        .dash-activity-item-label { font-size: 12px; font-weight: 600; color: var(--dash-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dash-activity-item-meta { font-size: 10px; color: var(--dash-text-3); margin-top: 1px; }
        .dash-activity-item-amount { font-size: 12px; font-weight: 600; color: var(--dash-text); font-family: 'SF Mono', monospace; text-align: right; white-space: nowrap; }
        .dash-activity-item-amount .unit { font-size: 10px; color: var(--dash-text-3); }
        .dash-activity-item-link { font-size: 9px; color: var(--dash-text-3); transition: color var(--dash-tr); }
        .dash-activity-item:hover .dash-activity-item-link { color: #60a5fa; }

        /* Fortune special item */
        .dash-fortune-item {
            display: block;
            padding: 10px 12px;
            background: var(--dash-surface-2);
            border: 1px solid transparent;
            border-radius: 8px;
            text-decoration: none;
            transition: all var(--dash-tr);
        }
        .dash-fortune-item:hover { background: var(--dash-surface-3); border-color: var(--dash-border-h); }

        /* â”€â”€ Pagination â”€â”€ */
        .dash-pagination { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--dash-border); }
        .dash-page-btn {
            font-size: 11px; color: var(--dash-text-3); background: none; border: none; cursor: pointer;
            transition: color var(--dash-tr); padding: 4px 0;
        }
        .dash-page-btn:hover:not(:disabled) { color: var(--dash-text); }
        .dash-page-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .dash-page-indicator { font-size: 10px; color: var(--dash-text-3); font-family: monospace; }

        /* â”€â”€ Sidebar â”€â”€ */
        .dash-sidebar { display: flex; flex-direction: column; gap: 12px; animation: dash-fadeIn 0.5s ease-out 0.15s both; }
        .dash-sidebar-card {
            background: var(--dash-surface);
            border: 1px solid var(--dash-border);
            border-radius: var(--dash-radius-sm);
            padding: 14px;
            transition: border-color var(--dash-tr);
        }
        .dash-sidebar-card:hover { border-color: var(--dash-border-h); }
        .dash-sidebar-card h3 { font-size: 13px; font-weight: 700; color: var(--dash-text); margin: 0 0 8px; }
        .dash-sidebar-row { display: flex; justify-content: space-between; align-items: center; font-size: 11px; padding: 3px 0; }
        .dash-sidebar-row-label { color: var(--dash-text-3); }
        .dash-sidebar-row-value { color: var(--dash-text); font-weight: 600; }
        .dash-network-badge {
            font-size: 9px; padding: 2px 8px;
            background: rgba(74,222,128,0.1); color: var(--dash-green);
            border: 1px solid rgba(74,222,128,0.2); border-radius: 20px;
            display: flex; align-items: center; gap: 4px;
        }
        .dash-network-dot { width: 5px; height: 5px; background: var(--dash-green); border-radius: 50%; animation: dash-glow 2s infinite; }

        /* â”€â”€ Buttons â”€â”€ */
        .dash-btn-primary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; font-size: 12px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--dash-tr); color: white;
        }
        .dash-btn-primary:disabled { opacity: 0.35; cursor: not-allowed; }
        .dash-btn-green { background: linear-gradient(135deg, #22c55e, #10b981); }
        .dash-btn-green:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .dash-btn-cyan:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .dash-btn-purple:hover:not(:disabled) { filter: brightness(1.1); }
        .dash-btn-secondary {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 16px; font-size: 12px; font-weight: 600;
            background: var(--dash-surface-2); color: var(--dash-text-2);
            border: 1px solid var(--dash-border); border-radius: 8px;
            cursor: pointer; transition: all var(--dash-tr);
        }
        .dash-btn-secondary:hover:not(:disabled) { color: var(--dash-text); border-color: var(--dash-border-h); }
        .dash-btn-secondary:disabled { opacity: 0.35; cursor: not-allowed; }
        .dash-sidebar-action-btn {
            width: 100%; padding: 9px; font-size: 12px; font-weight: 700;
            border-radius: 8px; border: none; cursor: pointer;
            transition: all var(--dash-tr); color: white; text-align: center;
        }
        .dash-sidebar-action-btn:hover { filter: brightness(1.1); transform: translateY(-1px); }

        /* â”€â”€ Modals â”€â”€ */
        .dash-modal-overlay {
            position: fixed; inset: 0; z-index: 50;
            display: none; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            padding: 16px; opacity: 0; transition: opacity 0.3s;
        }
        .dash-modal-overlay.visible { display: flex; opacity: 1; }
        .dash-modal {
            background: var(--dash-surface); border: 1px solid var(--dash-border-h);
            border-radius: var(--dash-radius); max-width: 360px; width: 100%;
            padding: 20px; position: relative;
            transform: scale(0.95); transition: transform 0.3s;
        }
        .dash-modal-overlay.visible .dash-modal { transform: scale(1); }

        /* â”€â”€ Portfolio â”€â”€ */
        .dash-portfolio-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .dash-portfolio-item {
            background: var(--dash-surface-2); border-radius: 8px; padding: 8px;
            border: 1px solid var(--dash-border);
        }
        .dash-portfolio-item-label { font-size: 9px; color: var(--dash-text-3); text-transform: uppercase; }
        .dash-portfolio-item-value { font-size: 13px; font-weight: 700; color: var(--dash-text); }

        /* â”€â”€ Loading / Empty â”€â”€ */
        .dash-loading {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 32px 16px; gap: 12px;
        }
        .dash-loading-logo { width: 40px; height: 40px; opacity: 0.4; animation: dash-float 2s ease-in-out infinite; }
        .dash-loading-text { font-size: 11px; color: var(--dash-text-3); }
        .dash-empty-text { font-size: 12px; color: var(--dash-text-3); text-align: center; padding: 24px 16px; }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 900px) {
            .dash-content { grid-template-columns: 1fr; }
            .dash-metrics-bar { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 640px) {
            .dash-shell { padding: 0 10px 30px; }
            .dash-hero { padding: 20px 16px; }
            .dash-hero-inner { flex-direction: column; gap: 16px; }
            .dash-hero-right { border-top: 1px solid var(--dash-border); padding-top: 16px; }
            .dash-actions-grid { grid-template-columns: repeat(2, 1fr); }
            .dash-metrics-bar { grid-template-columns: repeat(2, 1fr); }
            .dash-reward-value { font-size: 28px; }
        }
    `,document.head.appendChild(e)}function w0(){if(!_e.dashboard)return;v0();const e=w.ecosystemManager||"",t=e?`${o0}${e}`:"#";_e.dashboard.innerHTML=`
        <div class="dash-shell">

            <!-- HERO SECTION -->
            <div class="dash-hero" style="margin-bottom: 14px;">
                <img src="./assets/bkc_logo_3d.png" class="dash-hero-ghost" alt="">
                <div class="dash-hero-inner">
                    <div class="dash-hero-left">
                        <div class="dash-hero-label">You Will Receive</div>
                        <div id="dash-user-rewards" class="dash-reward-value">--</div>

                        <div id="dash-user-gain-area" class="dash-gain-area">
                            <i class="fa-solid fa-rocket" style="margin-right:4px"></i>
                            Earn +<span id="dash-user-potential-gain">0</span> BKC more with NFT!
                        </div>

                        <button id="dashboardClaimBtn" class="dash-claim-btn" disabled>
                            <i class="fa-solid fa-coins"></i> Claim Rewards
                        </button>

                        <div class="dash-hero-pstake">
                            <div>
                                <div class="dash-hero-pstake-label">Your pStake</div>
                                <div id="dash-user-pstake" class="dash-hero-pstake-value">--</div>
                            </div>
                            <span class="dash-stake-link delegate-link"><i class="fa-solid fa-plus" style="margin-right:3px"></i> Stake More</span>
                        </div>
                    </div>

                    <div class="dash-hero-right">
                        <div id="dash-booster-area" style="min-height: 120px; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align:center;">
                                <img src="./assets/bkc_logo_3d.png" style="width:32px;height:32px;opacity:0.3;animation:dash-float 2s infinite" alt="">
                                <p style="font-size:11px;color:var(--dash-text-3);margin-top:8px">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAUCET WIDGET -->
            <div id="dashboard-faucet-widget" class="dash-faucet-banner hidden" style="margin-bottom: 14px;">
                <div style="flex:1; min-width: 200px;">
                    <h3 id="faucet-title"></h3>
                    <p id="faucet-desc"></p>
                    <p id="faucet-status" class="faucet-status-text hidden"></p>
                </div>
                <button id="faucet-action-btn" class="dash-btn-primary dash-btn-green"></button>
            </div>

            <!-- QUICK ACTIONS GRID -->
            <div class="dash-actions-grid" style="margin-bottom: 14px;">
                <div class="dash-action-card backchat go-to-backchat">
                    <div class="dash-action-icon" style="background:rgba(6,182,212,0.12); color:#22d3ee;">
                        <i class="fa-solid fa-comment-dots"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Backchat</h4>
                        <p>Post & earn BKC tips</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card stake delegate-link">
                    <div class="dash-action-icon" style="background:rgba(167,139,250,0.12); color:#a78bfa;">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Stake BKC</h4>
                        <p>Earn while you sleep</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card fortune go-to-fortune">
                    <div class="dash-action-icon" style="background:rgba(249,115,22,0.12); color:#f97316;">
                        <i class="fa-solid fa-paw"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Fortune Pool</h4>
                        <p id="dash-fortune-prize-text">Win up to 100x</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card notary go-to-notary">
                    <div class="dash-action-icon" style="background:rgba(129,140,248,0.12); color:#818cf8;">
                        <i class="fa-solid fa-stamp"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Notarize</h4>
                        <p id="dash-notary-count-text">Certify on blockchain</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card charity go-to-charity">
                    <div class="dash-action-icon" style="background:rgba(236,72,153,0.12); color:#ec4899;">
                        <i class="fa-solid fa-heart"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>Charity Pool</h4>
                        <p>Donate & burn tokens</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>

                <div class="dash-action-card nft go-to-store">
                    <div class="dash-action-icon" style="background:rgba(245,158,11,0.12); color:#f59e0b;">
                        <i class="fa-solid fa-gem"></i>
                    </div>
                    <div class="dash-action-text">
                        <h4>NFT Market</h4>
                        <p>2x your rewards</p>
                    </div>
                    <i class="fa-solid fa-chevron-right dash-action-arrow"></i>
                </div>
            </div>

            <!-- VIRAL BANNER -->
            <div id="dash-viral-banner" style="display:flex;align-items:center;gap:12px;padding:12px 16px;background:linear-gradient(135deg,rgba(245,158,11,0.08),rgba(239,68,68,0.05));border:1px solid rgba(245,158,11,0.15);border-radius:var(--dash-radius-sm);margin-bottom:14px;animation:dash-fadeIn 0.6s ease-out 0.2s both">
                <div style="width:36px;height:36px;background:rgba(245,158,11,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;animation:dash-glow 3s infinite">
                    <i class="fa-solid fa-fire-flame-curved" style="color:#f59e0b;font-size:16px"></i>
                </div>
                <div style="flex:1;min-width:0">
                    <p style="font-size:12px;font-weight:700;color:var(--dash-text);margin:0">Every claim without an NFT burns your BKC forever</p>
                    <p style="font-size:10px;color:var(--dash-text-3);margin:2px 0 0">Diamond holders keep 100% â€” Others lose up to 50%. <span style="color:var(--dash-accent);cursor:pointer" class="go-to-store">Get your NFT now</span></p>
                </div>
            </div>

            <!-- METRICS BAR -->
            <div class="dash-metrics-bar" style="margin-bottom: 16px;">
                <div class="dash-metric-pill" title="Total BKC tokens in circulation">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-coins" style="color:#f59e0b"></i> Supply</div>
                    <div id="dash-metric-supply" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Total staking power on network">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-layer-group" style="color:#a78bfa"></i> pStake</div>
                    <div id="dash-metric-pstake" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="BKC permanently removed from supply">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-fire" style="color:#ef4444"></i> Burned</div>
                    <div id="dash-metric-burned" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Total fees generated by the ecosystem">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-receipt" style="color:#fb923c"></i> Fees</div>
                    <div id="dash-metric-fees" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Percentage of supply locked in contracts">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-lock" style="color:#60a5fa"></i> TVL</div>
                    <div id="dash-metric-tvl" class="dash-metric-pill-value">--</div>
                </div>
                <div class="dash-metric-pill" title="Your BKC balance" style="border-color: rgba(245,158,11,0.2);">
                    <div class="dash-metric-pill-label"><i class="fa-solid fa-wallet" style="color:#f59e0b"></i> Balance</div>
                    <div id="dash-metric-balance" class="dash-metric-pill-value" style="color:#f59e0b">--</div>
                </div>
            </div>

            <!-- MAIN CONTENT: Activity + Sidebar -->
            <div class="dash-content">

                <!-- ACTIVITY PANEL -->
                <div class="dash-activity-panel">
                    <div class="dash-activity-header">
                        <div class="dash-activity-title">
                            <i class="fa-solid fa-clock-rotate-left"></i>
                            <span id="activity-title">Activity</span>
                        </div>
                        <div style="display:flex; gap:6px; align-items:center;">
                            <button id="manual-refresh-btn" class="dash-sort-btn" title="Sync">
                                <i class="fa-solid fa-rotate"></i>
                            </button>
                            <button id="activity-sort-toggle" class="dash-sort-btn" title="Sort">
                                <i class="fa-solid fa-arrow-down-wide-short"></i>
                            </button>
                        </div>
                    </div>

                    <div class="dash-filter-chips">
                        <button class="dash-chip active" data-filter="ALL">All</button>
                        <button class="dash-chip" data-filter="STAKE">Staking</button>
                        <button class="dash-chip" data-filter="CLAIM">Claims</button>
                        <button class="dash-chip" data-filter="NFT">NFT</button>
                        <button class="dash-chip" data-filter="GAME">Fortune</button>
                        <button class="dash-chip" data-filter="CHARITY">Charity</button>
                        <button class="dash-chip" data-filter="NOTARY">Notary</button>
                        <button class="dash-chip" data-filter="BACKCHAT">Backchat</button>
                        <button class="dash-chip" data-filter="FAUCET">Faucet</button>
                    </div>

                    <div id="dash-activity-list" class="dash-activity-list">
                        <div class="dash-loading">
                            <img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt="">
                            <span class="dash-loading-text">Loading activity...</span>
                        </div>
                    </div>

                    <div id="dash-pagination-controls" class="dash-pagination" style="display:none">
                        <button class="dash-page-btn" id="page-prev"><i class="fa-solid fa-chevron-left"></i> Prev</button>
                        <span class="dash-page-indicator" id="page-indicator">1/1</span>
                        <button class="dash-page-btn" id="page-next">Next <i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                </div>

                <!-- SIDEBAR -->
                <div class="dash-sidebar">

                    <!-- Network Status -->
                    <div class="dash-sidebar-card">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <h3 style="margin:0">Network</h3>
                            <span class="dash-network-badge"><span class="dash-network-dot"></span> Live</span>
                        </div>
                        <div class="dash-sidebar-row">
                            <span class="dash-sidebar-row-label">Chain</span>
                            <span class="dash-sidebar-row-value" style="font-family:monospace; font-size:11px">Arbitrum Sepolia</span>
                        </div>
                        <div class="dash-sidebar-row">
                            <span class="dash-sidebar-row-label">Contracts</span>
                            <span style="color:var(--dash-green); font-size:11px; font-weight:600">Synced</span>
                        </div>
                        <a href="${t}" target="_blank" class="dash-sidebar-row" style="text-decoration:none; margin-top:4px; padding:4px 0; border-radius:4px;">
                            <span class="dash-sidebar-row-label">Main Contract</span>
                            <span style="color:#60a5fa; font-size:11px; display:flex; align-items:center; gap:4px;">View <i class="fa-solid fa-external-link" style="font-size:8px"></i></span>
                        </a>
                    </div>

                    <!-- Boost Rewards -->
                    <div class="dash-sidebar-card">
                        <h3><i class="fa-solid fa-rocket" style="color:var(--dash-cyan); margin-right:6px; font-size:12px"></i>Boost Rewards</h3>
                        <p style="font-size:11px; color:var(--dash-text-3); margin-bottom:10px">Rent an NFT by the hour</p>
                        <button class="dash-sidebar-action-btn go-to-rental" style="background:linear-gradient(135deg, #06b6d4, #0891b2)">
                            AirBNFT Market <i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                        </button>
                    </div>

                    <!-- Portfolio Stats -->
                    <div id="dash-presale-stats" class="dash-sidebar-card hidden" style="border-color: rgba(245,158,11,0.15);">
                        <h3 style="font-size:11px; color:var(--dash-accent); text-transform:uppercase; letter-spacing:0.05em;">
                            <i class="fa-solid fa-wallet" style="margin-right:4px"></i> Portfolio
                        </h3>
                        <div class="dash-portfolio-grid">
                            <div class="dash-portfolio-item">
                                <div class="dash-portfolio-item-label">Spent</div>
                                <div id="stats-total-spent" class="dash-portfolio-item-value">0 ETH</div>
                            </div>
                            <div class="dash-portfolio-item">
                                <div class="dash-portfolio-item-label">NFTs</div>
                                <div id="stats-total-boosters" class="dash-portfolio-item-value">0</div>
                            </div>
                        </div>
                        <div id="stats-tier-badges" style="display:flex; gap:4px; flex-wrap:wrap; margin-top:8px"></div>
                    </div>
                </div>
            </div>
        </div>

        ${y0()}
        ${k0()}
    `,A0()}function y0(){return`
        <div id="booster-info-modal" class="dash-modal-overlay">
            <div class="dash-modal">
                <button id="close-booster-modal" style="position:absolute;top:12px;right:12px;background:none;border:none;color:var(--dash-text-3);cursor:pointer;font-size:16px"><i class="fa-solid fa-xmark"></i></button>
                <div style="text-align:center; margin-bottom:16px">
                    <div style="display:inline-flex;align-items:center;justify-content:center;width:48px;height:48px;background:rgba(245,158,11,0.15);border-radius:50%;margin-bottom:8px">
                        <i class="fa-solid fa-rocket" style="font-size:22px;color:var(--dash-accent)"></i>
                    </div>
                    <h3 style="font-size:18px;font-weight:700;color:var(--dash-text);margin:0">Boost Efficiency</h3>
                    <p style="font-size:11px;color:var(--dash-text-2);margin-top:4px">NFT holders earn up to 2x more</p>
                </div>
                <div style="background:var(--dash-surface-2);border-radius:8px;padding:10px;display:flex;flex-direction:column;gap:6px">
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-text-2)">No NFT:</span><span style="color:var(--dash-text-3);font-weight:700">50%</span></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-text-2)">Bronze:</span><span style="color:#fde047;font-weight:700">80%</span></div>
                    <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--dash-accent)">Diamond:</span><span style="color:var(--dash-green);font-weight:700">100%</span></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px">
                    <button class="dash-sidebar-action-btn go-to-store" style="background:linear-gradient(135deg,#d97706,#b45309)">Buy NFT</button>
                    <button class="dash-sidebar-action-btn go-to-rental" style="background:linear-gradient(135deg,#06b6d4,#0891b2)">Rent NFT</button>
                </div>
            </div>
        </div>
    `}function k0(){return`
        <div id="no-gas-modal-dash" class="dash-modal-overlay">
            <div class="dash-modal" style="text-align:center;max-width:300px">
                <div style="width:48px;height:48px;background:rgba(239,68,68,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;border:1px solid rgba(239,68,68,0.2)">
                    <i class="fa-solid fa-gas-pump" style="font-size:18px;color:#ef4444"></i>
                </div>
                <h3 style="font-size:16px;font-weight:700;color:var(--dash-text);margin:0 0 4px">No Gas</h3>
                <p style="font-size:11px;color:var(--dash-text-2);margin-bottom:14px">You need Arbitrum Sepolia ETH</p>
                <button id="emergency-faucet-btn" class="dash-btn-primary dash-btn-green" style="width:100%;justify-content:center;margin-bottom:10px">
                    <i class="fa-solid fa-hand-holding-medical"></i> Get Free Gas + BKC
                </button>
                <button id="close-gas-modal-dash" style="background:none;border:none;color:var(--dash-text-3);cursor:pointer;font-size:11px">Close</button>
            </div>
        </div>
    `}async function E0(){try{const e=await fetch(d0);if(e.ok){const t=await e.json();return R.economicData=t,t}}catch{}return null}async function Bi(){var e,t,a,n,i,r,s,o,l,c,u,f,p,b;try{const m=await E0();let x=0n,y=0n,C=0n,A=0n,N=0n,P=0,z=0n;if(m){if((e=m.economy)!=null&&e.totalSupply&&(x=BigInt(m.economy.totalSupply)),(t=m.economy)!=null&&t.totalPStake&&(y=BigInt(m.economy.totalPStake)),(a=m.economy)!=null&&a.totalTVL&&(C=BigInt(m.economy.totalTVL)),(n=m.economy)!=null&&n.totalFeesCollected&&(N=BigInt(m.economy.totalFeesCollected)),(i=m.economy)!=null&&i.fortunePoolBalance&&(z=BigInt(m.economy.fortunePoolBalance)),(r=m.stats)!=null&&r.notarizedDocuments&&(P=m.stats.notarizedDocuments),(s=m.burn)!=null&&s.totalBurned&&BigInt(m.burn.totalBurned)>0n)A=BigInt(m.burn.totalBurned);else if((o=m.economy)!=null&&o.totalBurned&&BigInt(m.economy.totalBurned)>0n)A=BigInt(m.economy.totalBurned);else if((l=m.burn)!=null&&l.sources){let Q=0n;for(const me of Object.values(m.burn.sources))me!=null&&me.total&&(Q+=BigInt(me.total));A=Q}else(c=m.rental)!=null&&c.totalBurned&&(A=BigInt(m.rental.totalBurned));if(A===0n){let Q=0n;(u=m.rental)!=null&&u.totalBurned&&(Q+=BigInt(m.rental.totalBurned)),(f=m.charity)!=null&&f.totalBurned&&(Q+=BigInt(m.charity.totalBurned)),(p=m.fortune)!=null&&p.totalBurned&&(Q+=BigInt(m.fortune.totalBurned)),(b=m.staking)!=null&&b.totalBurned&&(Q+=BigInt(m.staking.totalBurned)),Q>0n&&(A=Q)}}if(d.bkcTokenContractPublic&&(x===0n&&(x=await ce(d.bkcTokenContractPublic,"totalSupply",[],0n)),y===0n&&d.delegationManagerContractPublic&&(y=await ce(d.delegationManagerContractPublic,"totalNetworkPStake",[],0n)),C===0n)){const Q=[w.delegationManager,w.fortunePool,w.rentalManager,w.miningManager,w.decentralizedNotary,w.nftLiquidityPoolFactory,w.pool_diamond,w.pool_platinum,w.pool_gold,w.pool_silver,w.pool_bronze,w.pool_iron,w.pool_crystal].filter(ne=>ne&&ne!==ta.ZeroAddress),me=await Promise.all(Q.map(ne=>ce(d.bkcTokenContractPublic,"balanceOf",[ne],0n)));if(me.forEach(ne=>{C+=ne}),w.fortunePool&&z===0n){const ne=Q.indexOf(w.fortunePool);ne>=0&&(z=me[ne])}}const I=M(x),F=M(A),K=M(N),pe=M(z),Ee=Q=>Q.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1});let le=0;x>0n&&(le=Number(C*10000n/x)/100),le>100&&(le=100);const ae=(Q,me)=>{const ne=document.getElementById(Q);ne&&(ne.innerHTML=me)};ae("dash-metric-supply",`${Ee(I)} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`),ae("dash-metric-pstake",ea(y)),ae("dash-metric-burned",F>0?`<span style="color:#ef4444">${ri(F)}</span> <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`:'<span style="color:var(--dash-text-3)">0 BKC</span>'),ae("dash-metric-fees",`${ri(K)} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`);const H=le>30?"var(--dash-green)":le>10?"#fbbf24":"#60a5fa";ae("dash-metric-tvl",`<span style="color:${H}">${le.toFixed(1)}%</span>`),Gc();const Z=document.getElementById("dash-fortune-prize-text");Z&&(Z.innerText=pe>0?`Prize: ${ri(pe)} BKC`:"Play to win");const Te=document.getElementById("dash-notary-count-text");Te&&(Te.innerText=P>0?`${P} docs certified`:"Certify documents"),R.metricsCache={supply:I,burned:F,fees:K,timestamp:Date.now()}}catch(m){console.error("Metrics Error",m)}}function Gc(){const e=document.getElementById("dash-metric-balance");if(!e)return;const t=d.currentUserBalance||d.bkcBalance||0n;if(!d.isConnected){e.innerHTML='<span style="font-size:11px;color:var(--dash-text-3)">Connect Wallet</span>';return}if(t===0n)e.innerHTML='0.00 <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>';else{const a=M(t);e.innerHTML=`${a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} <span style="font-size:10px;color:var(--dash-text-3)">BKC</span>`}}async function T0(){if(d.userAddress)try{const e=await fetch(`https://getuserprofile-4wvdcuoouq-uc.a.run.app/${d.userAddress}`);e.ok&&(R.userProfile=await e.json(),C0(R.userProfile))}catch{}}function C0(e){const t=document.getElementById("dash-presale-stats");if(!t||!e||!e.presale||!e.presale.totalBoosters||e.presale.totalBoosters===0)return;t.classList.remove("hidden");const a=e.presale.totalSpentWei||0,n=parseFloat(ta.formatEther(BigInt(a))).toFixed(4);document.getElementById("stats-total-spent").innerText=`${n} ETH`,document.getElementById("stats-total-boosters").innerText=e.presale.totalBoosters||0;const i=document.getElementById("stats-tier-badges");if(i&&e.presale.tiersOwned){let r="";Object.entries(e.presale.tiersOwned).forEach(([s,o])=>{const l=he[Number(s)-1],c=l?l.name:`T${s}`;r+=`<span style="font-size:9px;background:var(--dash-surface-2);color:var(--dash-text-2);padding:2px 6px;border-radius:4px">${o}x ${c}</span>`}),r&&(i.innerHTML=r)}}async function Vt(e=!1){var t,a;if(!d.isConnected){const n=document.getElementById("dash-booster-area");n&&(n.innerHTML=`
                <div style="text-align:center">
                    <p style="font-size:11px;color:var(--dash-text-3);margin-bottom:8px">Connect wallet to view</p>
                    <button onclick="window.openConnectModal()" class="dash-btn-secondary" style="font-size:11px">Connect</button>
                </div>`);return}try{const n=document.getElementById("dash-user-rewards");e&&n&&(n.style.opacity="0.6");const[,i,r]=await Promise.all([Wa(),ju(),Qt()]),s=(i==null?void 0:i.netClaimAmount)||0n;Wc(s),n&&(n.style.opacity="1");const o=document.getElementById("dashboardClaimBtn");o&&(o.disabled=s<=0n);const l=document.getElementById("dash-user-pstake");if(l){let c=((t=d.userData)==null?void 0:t.pStake)||((a=d.userData)==null?void 0:a.userTotalPStake)||d.userTotalPStake||0n;if(c===0n&&d.delegationManagerContractPublic&&d.userAddress)try{c=await ce(d.delegationManagerContractPublic,"userTotalPStake",[d.userAddress],0n)}catch{}l.innerText=ea(c)}Gc(),I0(r,i),T0(),Ai()}catch(n){console.error("User Hub Error:",n)}}function I0(e,t){var P,z;const a=document.getElementById("dash-booster-area");if(!a)return;const n=(e==null?void 0:e.highestBoost)||0,i=ht(n),r=(t==null?void 0:t.totalRewards)||0n,s=r*BigInt(i)/100n,l=r-s,c=Eu(n),u=(e==null?void 0:e.imageUrl)||(c==null?void 0:c.image)||"./assets/bkc_logo_3d.png",f=he.find(I=>I.name==="Diamond"),p=(f==null?void 0:f.image)||"./assets/bkc_logo_3d.png";if(n===0){const I=l;if(l>0n){const F=document.getElementById("dash-user-gain-area");F&&(F.classList.add("visible"),document.getElementById("dash-user-potential-gain").innerText=M(l).toFixed(2))}a.innerHTML=`
            <div style="text-align:center;width:100%">
                <!-- Diamond NFT preview image -->
                <div style="position:relative;margin:0 auto 10px;width:72px;height:72px">
                    <div style="position:absolute;inset:-4px;background:linear-gradient(135deg,rgba(6,182,212,0.3),rgba(99,102,241,0.3));border-radius:14px;animation:dash-glow 3s infinite"></div>
                    <img src="${p}" style="position:relative;width:72px;height:72px;border-radius:12px;object-fit:cover;border:2px solid rgba(6,182,212,0.4)" alt="Diamond NFT" onerror="this.src='./assets/bkc_logo_3d.png'">
                </div>

                <p style="color:#ef4444;font-size:12px;font-weight:800;margin:0 0 4px">
                    <i class="fa-solid fa-fire" style="margin-right:3px"></i>You're losing ${i===50?"50%":100-i+"%"} of your rewards!
                </p>

                <div style="width:100%;background:var(--dash-surface-2);border-radius:20px;height:8px;overflow:hidden;margin-bottom:6px;position:relative">
                    <div style="background:linear-gradient(90deg,#ef4444,#f59e0b);height:100%;border-radius:20px;width:${i}%"></div>
                    <div style="position:absolute;right:0;top:0;height:100%;width:${100-i}%;background:repeating-linear-gradient(45deg,transparent,transparent 3px,rgba(239,68,68,0.15) 3px,rgba(239,68,68,0.15) 6px);border-radius:0 20px 20px 0"></div>
                </div>
                <p style="font-size:10px;color:var(--dash-text-3);margin-bottom:8px">
                    You keep <span style="color:var(--dash-accent);font-weight:700">${i}%</span> â€” Diamond holders keep <span style="color:var(--dash-green);font-weight:700">100%</span>
                </p>

                ${r>0n?`
                <div style="background:linear-gradient(135deg,rgba(239,68,68,0.08),rgba(245,158,11,0.08));border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:8px;text-align:left;margin-bottom:8px">
                    <div style="display:flex;justify-content:space-between;font-size:11px">
                        <span style="color:var(--dash-text-2)">You'll receive:</span>
                        <span style="color:var(--dash-accent);font-weight:700">${M(s).toFixed(4)} BKC</span>
                    </div>
                    ${I>0n?`
                    <div style="display:flex;justify-content:space-between;font-size:11px;margin-top:3px">
                        <span style="color:#ef4444;font-weight:600"><i class="fa-solid fa-fire" style="margin-right:2px"></i>Burned forever:</span>
                        <span style="color:#ef4444;font-weight:700">-${M(I).toFixed(4)} BKC</span>
                    </div>
                    <div style="display:flex;justify-content:space-between;font-size:11px;margin-top:3px">
                        <span style="color:var(--dash-green)"><i class="fa-solid fa-diamond" style="margin-right:2px"></i>With Diamond:</span>
                        <span style="color:var(--dash-green);font-weight:700">${M(r).toFixed(4)} BKC</span>
                    </div>
                    `:""}
                </div>`:""}

                <p style="font-size:11px;font-weight:700;color:var(--dash-cyan);margin-bottom:8px;animation:dash-glow 2s infinite">
                    <i class="fa-solid fa-bolt" style="margin-right:3px"></i>Stop burning BKC â€” Get an NFT now!
                </p>

                <div style="display:flex;gap:6px;justify-content:center">
                    <button class="dash-btn-primary go-to-store" style="background:linear-gradient(135deg,#d97706,#b45309);font-size:11px;padding:8px 14px;flex:1">
                        <i class="fa-solid fa-gem" style="margin-right:3px"></i>Buy NFT
                    </button>
                    <button class="dash-btn-primary go-to-rental" style="background:linear-gradient(135deg,#06b6d4,#0891b2);font-size:11px;padding:8px 14px;flex:1">
                        <i class="fa-solid fa-clock" style="margin-right:3px"></i>Rent by Hour
                    </button>
                </div>
                <button id="open-booster-info" style="font-size:10px;color:var(--dash-text-3);background:none;border:none;cursor:pointer;margin-top:6px"><i class="fa-solid fa-circle-info" style="margin-right:3px"></i> How does it work?</button>
            </div>
        `;return}const b=e.source==="rented",m=b?"background:rgba(6,182,212,0.15);color:#67e8f9":"background:rgba(74,222,128,0.15);color:#86efac",x=b?"Rented":"Owned",y=(c==null?void 0:c.name)||((P=e.boostName)==null?void 0:P.replace(" Booster","").replace("Booster","").trim())||"Booster",C=(c==null?void 0:c.color)||"color:var(--dash-accent)",A=r*50n/100n,N=s-A;(z=c==null?void 0:c.borderColor)!=null&&z.replace("border-","").replace("/50",""),a.innerHTML=`
        <div class="nft-clickable-image" data-address="${w.rewardBoosterNFT}" data-tokenid="${e.tokenId}" style="display:flex;align-items:center;gap:12px;background:var(--dash-surface-2);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:12px;cursor:pointer;transition:all 0.2s;width:100%">
            <div style="position:relative;width:56px;height:56px;flex-shrink:0">
                <img src="${u}" style="width:56px;height:56px;border-radius:10px;object-fit:cover;border:2px solid rgba(255,255,255,0.1)" alt="${y}" onerror="this.src='./assets/bkc_logo_3d.png'">
                <div style="position:absolute;top:-5px;left:-5px;background:var(--dash-green);color:#000;font-weight:800;font-size:9px;padding:2px 6px;border-radius:5px">${i}%</div>
            </div>
            <div style="flex:1;min-width:0">
                <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px">
                    <span style="font-size:9px;font-weight:700;${m};padding:1px 6px;border-radius:4px;text-transform:uppercase">${x}</span>
                    <span style="font-size:9px;color:var(--dash-text-3)">#${e.tokenId}</span>
                </div>
                <h4 style="${C};font-weight:700;font-size:13px;margin:0">${y} Booster</h4>
                <p style="font-size:10px;color:var(--dash-green);margin:2px 0 0"><i class="fa-solid fa-shield-check" style="margin-right:3px"></i>Keeping ${i}% of rewards</p>
                ${r>0n?`<p style="font-size:11px;color:var(--dash-text);margin:3px 0 0;font-weight:600">Net: <span style="color:var(--dash-green);font-weight:700">${M(s).toFixed(4)} BKC</span></p>`:""}
                ${N>0n?`<p style="font-size:9px;color:#34d399;margin:2px 0 0"><i class="fa-solid fa-arrow-trend-up" style="margin-right:2px"></i>+${M(N).toFixed(2)} BKC saved vs no NFT</p>`:""}
                ${i<100?'<p style="font-size:9px;color:var(--dash-accent);margin:2px 0 0"><i class="fa-solid fa-arrow-up" style="margin-right:2px"></i>Upgrade to Diamond for 100%!</p>':""}
            </div>
        </div>
    `}async function wn(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("activity-title");try{if(d.isConnected){if(R.activities.length===0){e&&(e.innerHTML='<div class="dash-loading"><img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt=""><span class="dash-loading-text">Loading your activity...</span></div>');const a=await fetch(`${ze.getHistory}/${d.userAddress}`);a.ok&&(R.activities=await a.json())}if(R.activities.length>0){t&&(t.textContent="Your Activity"),zi();return}}t&&(t.textContent="Network Activity"),await ms()}catch(a){console.error("Activity fetch error:",a),t&&(t.textContent="Network Activity"),await ms()}}async function ms(){const e=document.getElementById("dash-activity-list");if(!e||R.isLoadingNetworkActivity)return;const t=Date.now()-R.networkActivitiesTimestamp;if(R.networkActivities.length>0&&t<3e5){fs();return}R.isLoadingNetworkActivity=!0,e.innerHTML='<div class="dash-loading"><img src="./assets/bkc_logo_3d.png" class="dash-loading-logo" alt=""><span class="dash-loading-text">Loading network activity...</span></div>';try{const a=await fetch(`${c0}?limit=30`);if(a.ok){const n=await a.json();R.networkActivities=Array.isArray(n)?n:n.activities||[],R.networkActivitiesTimestamp=Date.now()}else R.networkActivities=[]}catch{R.networkActivities=[]}finally{R.isLoadingNetworkActivity=!1}fs()}function fs(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("dash-pagination-controls");if(e){if(R.networkActivities.length===0){e.innerHTML='<div class="dash-empty-text">No network activity yet. Be the first!</div>',t&&(t.style.display="none");return}e.innerHTML=R.networkActivities.slice(0,15).map(a=>Kc(a,!0)).join(""),t&&(t.style.display="none")}}function zi(){let e=[...R.activities];const t=R.filters.type,a=n=>(n||"").toUpperCase();t!=="ALL"&&(e=e.filter(n=>{const i=a(n.type);return t==="STAKE"?i.includes("DELEGATION")||i.includes("DELEGAT")||i.includes("STAKE")||i.includes("UNSTAKE"):t==="CLAIM"?i.includes("REWARD")||i.includes("CLAIM"):t==="NFT"?i.includes("BOOSTER")||i.includes("RENT")||i.includes("NFT")||i.includes("TRANSFER"):t==="GAME"?i.includes("FORTUNE")||i.includes("GAME")||i.includes("REQUEST")||i.includes("RESULT")||i.includes("FULFILLED"):t==="CHARITY"?i.includes("CHARITY")||i.includes("CAMPAIGN")||i.includes("DONATION")||i.includes("DONATE"):t==="NOTARY"?i.includes("NOTARY")||i.includes("NOTARIZED")||i.includes("DOCUMENT"):t==="BACKCHAT"?i.includes("POST")||i.includes("LIKE")||i.includes("REPLY")||i.includes("REPOST")||i.includes("FOLLOW")||i.includes("PROFILE")||i.includes("BOOST")||i.includes("BADGE")||i.includes("TIP")||i.includes("BACKCHAT"):t==="FAUCET"?i.includes("FAUCET"):!0})),e.sort((n,i)=>{const r=s=>s.timestamp&&s.timestamp._seconds?s.timestamp._seconds:s.createdAt&&s.createdAt._seconds?s.createdAt._seconds:s.timestamp?new Date(s.timestamp).getTime()/1e3:0;return R.filters.sort==="NEWEST"?r(i)-r(n):r(n)-r(i)}),R.filteredActivities=e,R.pagination.currentPage=1,Pi()}function Pi(){const e=document.getElementById("dash-activity-list"),t=document.getElementById("dash-pagination-controls");if(!e)return;if(R.filteredActivities.length===0){e.innerHTML='<div class="dash-empty-text">No activity yet. Start staking, trading or playing!</div>',t&&(t.style.display="none");return}const a=(R.pagination.currentPage-1)*R.pagination.itemsPerPage,n=R.filteredActivities.slice(a,a+R.pagination.itemsPerPage);if(e.innerHTML=n.map(i=>Kc(i,!1)).join(""),t){const i=Math.ceil(R.filteredActivities.length/R.pagination.itemsPerPage);i>1?(t.style.display="flex",document.getElementById("page-indicator").innerText=`${R.pagination.currentPage}/${i}`,document.getElementById("page-prev").disabled=R.pagination.currentPage===1,document.getElementById("page-next").disabled=R.pagination.currentPage>=i):t.style.display="none"}}function Kc(e,t=!1){const a=p0(e.timestamp||e.createdAt),n=m0(e.timestamp||e.createdAt),i=e.user||e.userAddress||e.from||"",r=f0(i),s=g0(e.type,e.details);let o="";const l=(e.type||"").toUpperCase().trim(),c=e.details||{};if(l.includes("GAME")||l.includes("FORTUNE")||l.includes("REQUEST")||l.includes("FULFILLED")||l.includes("RESULT")){const x=c.rolls||e.rolls||[],y=c.guesses||e.guesses||[],C=c.isWin||c.prizeWon&&BigInt(c.prizeWon||0)>0n,A=c.isCumulative!==void 0?c.isCumulative:y.length>1,N=A?"Combo":"Jackpot",P=A?"background:rgba(168,85,247,0.15);color:#c084fc":"background:rgba(245,158,11,0.15);color:#fbbf24",z=c.wagerAmount||c.amount,I=c.prizeWon,F=z?M(BigInt(z)).toFixed(0):"0";let K='<span style="color:var(--dash-text-3)">No win</span>';C&&I&&BigInt(I)>0n&&(K=`<span style="color:var(--dash-green);font-weight:700">+${M(BigInt(I)).toFixed(0)} BKC</span>`);let pe="";return x.length>0&&(pe=`<div style="display:flex;gap:3px">${x.map((le,ae)=>{const H=y[ae],Z=H!==void 0&&Number(H)===Number(le);return`<div style="width:24px;height:24px;border-radius:4px;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;border:1px solid ${Z?"rgba(52,211,153,0.4)":"var(--dash-border)"};background:${Z?"rgba(52,211,153,0.1)":"var(--dash-surface-2)"};color:${Z?"#34d399":"var(--dash-text-3)"}">${le}</div>`}).join("")}</div>`),`
            <a href="${e.txHash?`${us}${e.txHash}`:"#"}" target="_blank" class="dash-fortune-item" title="${n}">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
                    <div style="display:flex;align-items:center;gap:8px">
                        <div style="width:28px;height:28px;border-radius:6px;background:var(--dash-surface-3);display:flex;align-items:center;justify-content:center"><i class="fa-solid fa-dice" style="color:var(--dash-text-3);font-size:11px"></i></div>
                        <span style="color:var(--dash-text);font-size:12px;font-weight:600">${t?r:"You"}</span>
                        <span style="font-size:9px;font-weight:700;${P};padding:1px 6px;border-radius:4px">${N}</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--dash-text-3)">
                        <span>${a}</span>
                        <i class="fa-solid fa-external-link dash-activity-item-link"></i>
                    </div>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between">
                    <div style="font-size:11px"><span style="color:var(--dash-text-3)">Bet: ${F}</span><span style="margin:0 6px;color:var(--dash-text-3)">â†’</span>${K}</div>
                    ${pe}
                </div>
            </a>
        `}if(l.includes("NOTARY")){const x=c.ipfsCid;x&&(o=`<span style="margin-left:4px;font-size:9px;color:#818cf8;font-family:monospace">${x.replace("ipfs://","").slice(0,12)}...</span>`)}if(l.includes("STAKING")||l.includes("DELEGAT")){const x=c.pStakeGenerated;x&&(o=`<span style="font-size:10px;color:var(--dash-purple)">+${M(BigInt(x)).toFixed(0)} pStake</span>`)}if(l.includes("DONATION")||l.includes("CHARITY")){const x=c.netAmount||c.amount,y=c.campaignId;x&&BigInt(x)>0n&&(o=`<span style="color:#ec4899;font-weight:700">${M(BigInt(x)).toFixed(2)} BKC</span>`,y&&(o+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">Campaign #${y}</span>`))}if(l.includes("CLAIM")||l.includes("REWARD")){const x=c.amount||e.amount;x&&(o=`<span style="color:var(--dash-accent);font-weight:700">+${M(BigInt(x)).toFixed(2)} BKC</span>`);const y=c.feePaid;y&&BigInt(y)>0n&&(o+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">(fee: ${M(BigInt(y)).toFixed(2)})</span>`)}const f=l.includes("PROMOT")||l.includes("ADS")||l.includes("ADVERTIS");if(f){const x=c.promotionFee||c.amount||e.amount;x&&BigInt(x)>0n&&(o=`<span style="color:#fbbf24;font-weight:700">${parseFloat(ta.formatEther(BigInt(x))).toFixed(4)} ETH</span>`);const y=c.tokenId||e.tokenId;y&&(o+=`<span style="margin-left:4px;font-size:9px;color:var(--dash-text-3)">NFT #${y}</span>`)}const p=e.txHash?`${us}${e.txHash}`:"#";let b="";if(f){const x=c.promotionFee||c.amount||e.amount;x&&BigInt(x)>0n&&(b=parseFloat(ta.formatEther(BigInt(x))).toFixed(4))}else{let x=e.amount||c.netAmount||c.amount||c.wagerAmount||c.prizeWon||"0";const y=M(BigInt(x));b=y>.001?y.toFixed(2):""}const m=f?"ETH":"BKC";return`
        <a href="${p}" target="_blank" class="dash-activity-item" title="${n}">
            <div class="dash-activity-item-icon" style="background:${s.bg};border:1px solid transparent">
                <i class="fa-solid ${s.icon}" style="color:${s.color}"></i>
            </div>
            <div class="dash-activity-item-info">
                <div class="dash-activity-item-label">${s.label}${o?` ${o}`:""}</div>
                <div class="dash-activity-item-meta">${t?r+" Â· ":""}${a}</div>
            </div>
            <div style="display:flex;align-items:center;gap:6px">
                ${b?`<div class="dash-activity-item-amount">${b} <span class="unit">${m}</span></div>`:""}
                <i class="fa-solid fa-arrow-up-right-from-square dash-activity-item-link"></i>
            </div>
        </a>
    `}function A0(){_e.dashboard&&_e.dashboard.addEventListener("click",async e=>{const t=e.target;if(t.closest("#manual-refresh-btn")){const r=t.closest("#manual-refresh-btn");r.disabled=!0,r.innerHTML='<i class="fa-solid fa-rotate fa-spin"></i>',await Vt(!0),await Bi(),R.activities=[],R.networkActivities=[],R.networkActivitiesTimestamp=0,R.faucet.lastCheck=0,await wn(),setTimeout(()=>{r.innerHTML='<i class="fa-solid fa-rotate"></i>',r.disabled=!1},1e3)}if(t.closest("#faucet-action-btn")){const r=t.closest("#faucet-action-btn");r.disabled||await ps(r)}if(t.closest("#emergency-faucet-btn")&&await ps(t.closest("#emergency-faucet-btn")),t.closest(".delegate-link")&&(e.preventDefault(),window.navigateTo("mine")),t.closest(".go-to-store")&&(e.preventDefault(),window.navigateTo("store")),t.closest(".go-to-rental")&&(e.preventDefault(),window.navigateTo("rental")),t.closest(".go-to-fortune")&&(e.preventDefault(),window.navigateTo("actions")),t.closest(".go-to-notary")&&(e.preventDefault(),window.navigateTo("notary")),t.closest(".go-to-charity")&&(e.preventDefault(),window.navigateTo("charity")),t.closest(".go-to-backchat")&&(e.preventDefault(),window.navigateTo("backchat")),t.closest("#open-booster-info")){const r=document.getElementById("booster-info-modal");r&&r.classList.add("visible")}if(t.closest("#close-booster-modal")||t.id==="booster-info-modal"){const r=document.getElementById("booster-info-modal");r&&r.classList.remove("visible")}if(t.closest("#close-gas-modal-dash")||t.id==="no-gas-modal-dash"){const r=document.getElementById("no-gas-modal-dash");r&&r.classList.remove("visible")}const a=t.closest(".nft-clickable-image");if(a){const r=a.dataset.address,s=a.dataset.tokenid;r&&s&&fu(r,s)}const n=t.closest("#dashboardClaimBtn");if(n&&!n.disabled)try{if(n.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>',n.disabled=!0,!await h0()){n.innerHTML='<i class="fa-solid fa-coins" style="margin-right:6px"></i> Claim Rewards',n.disabled=!1;return}const{stakingRewards:s,minerRewards:o}=await oa();(s>0n||o>0n)&&await Ft.claimRewards({button:n,onSuccess:async()=>{h("Rewards claimed!","success"),await Vt(!0),R.activities=[],wn()},onError:l=>{l.cancelled||h("Claim failed","error")}})}catch{h("Claim failed","error")}finally{n.innerHTML='<i class="fa-solid fa-coins" style="margin-right:6px"></i> Claim Rewards',n.disabled=!1}if(t.closest("#page-prev")&&R.pagination.currentPage>1&&(R.pagination.currentPage--,Pi()),t.closest("#page-next")){const r=Math.ceil(R.filteredActivities.length/R.pagination.itemsPerPage);R.pagination.currentPage<r&&(R.pagination.currentPage++,Pi())}t.closest("#activity-sort-toggle")&&(R.filters.sort=R.filters.sort==="NEWEST"?"OLDEST":"NEWEST",zi());const i=t.closest(".dash-chip");i&&(document.querySelectorAll(".dash-chip").forEach(r=>r.classList.remove("active")),i.classList.add("active"),R.filters.type=i.dataset.filter,zi())})}const Yc={async render(e){w0(),Bi(),wn(),d.isConnected?await Vt(!1):(setTimeout(async()=>{d.isConnected&&await Vt(!1)},500),setTimeout(async()=>{d.isConnected&&await Vt(!1)},1500))},update(e){const t=Date.now();t-R.lastUpdate>1e4&&(R.lastUpdate=t,Bi(),e&&Vt(!1),wn())}},Ta=window.ethers,B0="https://sepolia.arbiscan.io/tx/",xa={NONE:{boost:0,burnRate:50,userGets:50,color:"#71717a",name:"None",icon:"â—‹"},BRONZE:{boost:1e3,burnRate:40,userGets:60,color:"#cd7f32",name:"Bronze",icon:"ðŸ¥‰"},SILVER:{boost:2500,burnRate:25,userGets:75,color:"#c0c0c0",name:"Silver",icon:"ðŸ¥ˆ"},GOLD:{boost:4e3,burnRate:10,userGets:90,color:"#ffd700",name:"Gold",icon:"ðŸ¥‡"},DIAMOND:{boost:5e3,burnRate:0,userGets:100,color:"#b9f2ff",name:"Diamond",icon:"ðŸ’Ž"}};let Jt=!1,_a=0,vr=3650,Ye=!1,Ni=[],Ca=0n,Nt=null,ka="ALL",et=0,Fa=50,Vc="none",qt=null;function qc(e){if(e<=0)return"Ready";const t=Math.floor(e/86400),a=Math.floor(e%86400/3600),n=Math.floor(e%3600/60);if(t>365){const i=Math.floor(t/365),r=t%365;return`${i}y ${r}d`}return t>0?`${t}d ${a}h`:a>0?`${a}h ${n}m`:`${n}m`}function z0(e){if(e>=365){const t=e/365;return t>=2?`${Math.floor(t)} Years`:`${t.toFixed(1)} Year`}return e>=30?`${Math.floor(e/30)} Month${e>=60?"s":""}`:`${e} Day${e>1?"s":""}`}function Xc(e,t){try{const a=BigInt(e),n=BigInt(t);return a*(n/86400n)/10n**18n}catch{return 0n}}function P0(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function Jc(e){return e>=5e3?xa.DIAMOND:e>=4e3?xa.GOLD:e>=2500?xa.SILVER:e>=1e3?xa.BRONZE:xa.NONE}function N0(){if(document.getElementById("staking-styles-v6"))return;const e=document.createElement("style");e.id="staking-styles-v6",e.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V6.9 Network Staking Styles - Clean & Functional
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        @keyframes float { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-6px); } 
        }
        @keyframes pulse-glow { 
            0%, 100% { box-shadow: 0 0 20px rgba(139,92,246,0.2); } 
            50% { box-shadow: 0 0 40px rgba(139,92,246,0.4); } 
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes burn-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .float-animation { animation: float 4s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 3s ease-in-out infinite; }
        
        .card-base {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .card-base:hover { 
            border-color: rgba(139,92,246,0.3);
            transform: translateY(-2px);
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.7) 0%, rgba(24,24,27,0.8) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 12px;
        }
        
        /* Duration Chips */
        .duration-chip {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .duration-chip:hover { 
            transform: scale(1.02);
            border-color: rgba(139,92,246,0.5);
        }
        .duration-chip.selected {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%) !important;
            border-color: #8b5cf6 !important;
            color: white !important;
            box-shadow: 0 4px 15px rgba(124,58,237,0.3);
        }
        .duration-chip.recommended::before {
            content: 'â˜…';
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(245,158,11,0.4);
        }
        
        /* NFT Tier Badge */
        .nft-tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            border: 1px solid;
            transition: all 0.3s ease;
        }
        .nft-tier-badge:hover { transform: scale(1.05); }
        
        .tier-none { background: rgba(113,113,122,0.15); border-color: rgba(113,113,122,0.3); color: #a1a1aa; }
        .tier-bronze { background: rgba(205,127,50,0.15); border-color: rgba(205,127,50,0.4); color: #cd7f32; }
        .tier-silver { background: rgba(192,192,192,0.15); border-color: rgba(192,192,192,0.4); color: #e5e5e5; }
        .tier-gold { background: rgba(255,215,0,0.15); border-color: rgba(255,215,0,0.4); color: #ffd700; }
        .tier-diamond { background: rgba(185,242,255,0.15); border-color: rgba(185,242,255,0.4); color: #b9f2ff; }
        
        /* Burn Rate Indicator */
        .burn-indicator {
            position: relative;
            height: 8px;
            background: rgba(239,68,68,0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        .burn-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f87171);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .receive-fill {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #4ade80);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Claim Preview Card */
        .claim-preview {
            background: linear-gradient(145deg, rgba(22,163,74,0.1) 0%, rgba(21,128,61,0.05) 100%);
            border: 1px solid rgba(34,197,94,0.3);
            border-radius: 12px;
        }
        .claim-preview.has-burn {
            background: linear-gradient(145deg, rgba(245,158,11,0.1) 0%, rgba(217,119,6,0.05) 100%);
            border-color: rgba(245,158,11,0.3);
        }
        
        /* Delegation Item */
        .delegation-item {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        .delegation-item:hover { 
            background: rgba(63,63,70,0.4);
            transform: translateX(4px);
            border-color: rgba(139,92,246,0.3);
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124,58,237,0.3);
        }
        .btn-primary:disabled { 
            opacity: 0.5; 
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-claim {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
        }
        .btn-claim:hover:not(:disabled) {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow: 0 8px 25px rgba(245,158,11,0.3);
        }
        
        /* History Tabs */
        .history-tab {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
            border: 1px solid rgba(63,63,70,0.5);
            background: rgba(39,39,42,0.5);
            color: #a1a1aa;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .history-tab:hover { background: rgba(63,63,70,0.6); }
        .history-tab.active {
            background: rgba(139,92,246,0.2);
            border-color: rgba(139,92,246,0.5);
            color: #a78bfa;
        }
        
        /* Input Styling */
        .input-amount {
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            color: white;
            font-size: 24px;
            font-family: 'JetBrains Mono', monospace;
            padding: 16px;
            width: 100%;
            outline: none;
            transition: all 0.2s ease;
        }
        .input-amount:focus {
            border-color: rgba(139,92,246,0.6);
            box-shadow: 0 0 20px rgba(139,92,246,0.1);
        }
        .input-amount.error { border-color: rgba(239,68,68,0.6); }
        
        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(39,39,42,0.5); border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(113,113,122,0.5); border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(139,92,246,0.5); }
    `,document.head.appendChild(e)}function $0(){const e=document.getElementById("mine");e&&(N0(),e.innerHTML=`
        <div class="max-w-5xl mx-auto px-4 py-6">
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 HEADER
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500/20 to-violet-600/20 border border-purple-500/30 flex items-center justify-center float-animation">
                        <i class="fa-solid fa-layer-group text-2xl text-purple-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Network Staking</h1>
                        <p class="text-sm text-zinc-500">Delegate BKC â€¢ Earn Rewards â€¢ Reduce Burn</p>
                    </div>
                </div>
                <button id="refresh-btn" class="w-10 h-10 rounded-xl bg-zinc-800/50 hover:bg-zinc-700 border border-zinc-700/50 flex items-center justify-center transition-all hover:scale-105">
                    <i class="fa-solid fa-rotate text-zinc-400"></i>
                </button>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 NFT BOOST STATUS CARD (V6 Feature)
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div id="nft-boost-card" class="card-base p-4 mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <div id="nft-tier-icon" class="w-12 h-12 rounded-xl bg-zinc-800 flex items-center justify-center text-2xl">
                            â—‹
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span id="nft-tier-badge" class="nft-tier-badge tier-none">
                                    <span>No NFT</span>
                                </span>
                                <span id="nft-source" class="text-[10px] text-zinc-600 bg-zinc-800 px-2 py-0.5 rounded hidden">
                                    owned
                                </span>
                            </div>
                            <p class="text-xs text-zinc-500">
                                <span id="burn-rate-text">50% of rewards will be burned on claim</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-6">
                        <div class="text-center">
                            <p class="text-[10px] text-zinc-500 uppercase mb-1">Burn Rate</p>
                            <p id="burn-rate-value" class="text-xl font-bold text-red-400 font-mono">50%</p>
                        </div>
                        <div class="text-center">
                            <p class="text-[10px] text-zinc-500 uppercase mb-1">You Keep</p>
                            <p id="keep-rate-value" class="text-xl font-bold text-green-400 font-mono">50%</p>
                        </div>
                        <a href="#/marketplace" class="text-xs text-purple-400 hover:text-purple-300 flex items-center gap-1 transition-colors">
                            <i class="fa-solid fa-store"></i>
                            <span>Get NFT</span>
                        </a>
                    </div>
                </div>
                <!-- Burn Rate Bar -->
                <div class="mt-4">
                    <div class="burn-indicator">
                        <div id="burn-fill" class="burn-fill" style="width: 50%"></div>
                        <div id="receive-fill" class="receive-fill" style="width: 50%"></div>
                    </div>
                    <div class="flex justify-between mt-1">
                        <span class="text-[9px] text-red-400/70">ðŸ”¥ Burned</span>
                        <span class="text-[9px] text-green-400/70">âœ“ You Receive</span>
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 STATS ROW
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
                <div class="stat-card p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-globe text-purple-400 text-sm"></i>
                        <span class="text-[10px] text-zinc-500 uppercase">Network</span>
                    </div>
                    <p id="stat-network" class="text-lg font-bold text-white font-mono">--</p>
                    <p class="text-[10px] text-zinc-600">Total pStake</p>
                </div>
                
                <div class="stat-card p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-lock text-blue-400 text-sm"></i>
                        <span class="text-[10px] text-zinc-500 uppercase">Your Power</span>
                    </div>
                    <p id="stat-pstake" class="text-lg font-bold text-white font-mono">--</p>
                    <p id="stat-pstake-percent" class="text-[10px] text-zinc-600">--% of network</p>
                </div>
                
                <div class="stat-card p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-coins text-amber-400 text-sm"></i>
                        <span class="text-[10px] text-zinc-500 uppercase">Pending</span>
                    </div>
                    <p id="stat-rewards" class="text-lg font-bold text-amber-400 font-mono">--</p>
                    <p class="text-[10px] text-zinc-600">BKC Rewards</p>
                </div>
                
                <div class="stat-card p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-layer-group text-green-400 text-sm"></i>
                        <span class="text-[10px] text-zinc-500 uppercase">Delegations</span>
                    </div>
                    <p id="stat-delegations" class="text-lg font-bold text-white font-mono">0</p>
                    <p class="text-[10px] text-zinc-600">Active Locks</p>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 CLAIM REWARDS SECTION (V6 with Burn Preview)
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div id="claim-section" class="claim-preview p-4 mb-6 hidden">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                    <div class="flex-1">
                        <h3 class="text-sm font-bold text-white mb-3 flex items-center gap-2">
                            <i class="fa-solid fa-gift text-amber-400"></i>
                            Claim Your Rewards
                        </h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <p class="text-[10px] text-zinc-500 uppercase mb-1">Total Earned</p>
                                <p id="claim-total" class="text-lg font-bold text-white font-mono">0.00</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-red-400 uppercase mb-1">ðŸ”¥ Burned</p>
                                <p id="claim-burn" class="text-lg font-bold text-red-400 font-mono">0.00</p>
                            </div>
                            <div>
                                <p class="text-[10px] text-green-400 uppercase mb-1">âœ“ You Get</p>
                                <p id="claim-receive" class="text-lg font-bold text-green-400 font-mono">0.00</p>
                            </div>
                        </div>
                    </div>
                    <button id="claim-btn" class="btn-primary btn-claim px-6 py-3 text-sm font-bold flex items-center gap-2">
                        <i class="fa-solid fa-hand-holding-dollar"></i>
                        <span>Claim Rewards</span>
                    </button>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 MAIN CONTENT GRID
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                
                <!-- DELEGATE CARD -->
                <div class="card-base p-5">
                    <div class="flex items-center gap-3 mb-5">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-plus text-purple-400"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-bold text-white">Delegate BKC</h2>
                            <p class="text-xs text-zinc-500">Lock tokens to earn network rewards</p>
                        </div>
                    </div>

                    <!-- Amount Input -->
                    <div class="mb-5">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs text-zinc-400 font-medium">Amount</label>
                            <span class="text-xs text-zinc-500">
                                Balance: <span id="balance-display" class="text-white font-mono">0.00</span> BKC
                            </span>
                        </div>
                        <div class="relative">
                            <input type="number" id="amount-input" placeholder="0.00" 
                                   class="input-amount pr-20">
                            <button id="max-btn" class="absolute right-3 top-1/2 -translate-y-1/2 text-xs font-bold bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 px-3 py-1.5 rounded-lg transition-colors">
                                MAX
                            </button>
                        </div>
                    </div>

                    <!-- Lock Duration -->
                    <div class="mb-5">
                        <div class="flex justify-between items-center mb-3">
                            <label class="text-xs text-zinc-400 font-medium">Lock Duration</label>
                            <span class="text-[10px] text-amber-400 flex items-center gap-1">
                                <i class="fa-solid fa-star"></i> 10Y = Maximum Rewards
                            </span>
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <button class="duration-chip relative py-3 bg-zinc-800/80 border border-zinc-700 rounded-xl text-sm font-bold text-zinc-400" data-days="30">
                                1M
                            </button>
                            <button class="duration-chip relative py-3 bg-zinc-800/80 border border-zinc-700 rounded-xl text-sm font-bold text-zinc-400" data-days="365">
                                1Y
                            </button>
                            <button class="duration-chip relative py-3 bg-zinc-800/80 border border-zinc-700 rounded-xl text-sm font-bold text-zinc-400" data-days="1825">
                                5Y
                            </button>
                            <button class="duration-chip recommended relative py-3 bg-zinc-800/80 border border-zinc-700 rounded-xl text-sm font-bold text-zinc-400 selected" data-days="3650">
                                10Y
                            </button>
                        </div>
                    </div>

                    <!-- Preview -->
                    <div class="bg-black/30 rounded-xl p-4 mb-5 border border-zinc-800">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-[10px] text-zinc-500 uppercase mb-1">You'll Generate</p>
                                <p id="preview-pstake" class="text-2xl font-bold text-purple-400 font-mono">0</p>
                                <p class="text-[10px] text-zinc-500">pStake Power</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[10px] text-zinc-500 uppercase mb-1">After Fee</p>
                                <p id="preview-net" class="text-sm text-white font-mono">0.00 BKC</p>
                                <p id="fee-info" class="text-[10px] text-zinc-600">0.5% protocol fee</p>
                            </div>
                        </div>
                    </div>

                    <!-- Delegate Button -->
                    <button id="stake-btn" disabled class="btn-primary w-full py-4 text-base flex items-center justify-center gap-2">
                        <span id="stake-btn-text">Delegate BKC</span>
                        <i id="stake-btn-icon" class="fa-solid fa-lock"></i>
                    </button>
                </div>

                <!-- ACTIVE DELEGATIONS -->
                <div class="card-base p-5">
                    <div class="flex items-center justify-between mb-5">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-zinc-700/50 flex items-center justify-center">
                                <i class="fa-solid fa-list text-zinc-400"></i>
                            </div>
                            <div>
                                <h2 class="text-lg font-bold text-white">Active Delegations</h2>
                                <p class="text-xs text-zinc-500">Your locked positions</p>
                            </div>
                        </div>
                        <span id="delegation-count" class="text-xs text-zinc-500 bg-zinc-800 px-3 py-1 rounded-lg font-mono">0</span>
                    </div>

                    <div id="delegations-list" class="space-y-2 max-h-[350px] overflow-y-auto custom-scrollbar pr-1">
                        ${Tp()}
                    </div>
                </div>
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 STAKING HISTORY
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="card-base p-5 mt-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-5">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center">
                            <i class="fa-solid fa-clock-rotate-left text-purple-400"></i>
                        </div>
                        <h2 class="text-lg font-bold text-white">Staking History</h2>
                    </div>
                    <div class="flex gap-2">
                        <button class="history-tab active" data-filter="ALL">All</button>
                        <button class="history-tab" data-filter="STAKE">Stakes</button>
                        <button class="history-tab" data-filter="UNSTAKE">Unstakes</button>
                        <button class="history-tab" data-filter="CLAIM">Claims</button>
                    </div>
                </div>
                <div id="staking-history-list" class="space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar pr-1">
                    <div class="text-center py-8">
                        <i class="fa-solid fa-spinner fa-spin text-2xl text-zinc-600 mb-3"></i>
                        <p class="text-zinc-600 text-sm">Loading history...</p>
                    </div>
                </div>
            </div>
        </div>
    `,U0(),d.isConnected?pa(!0):wr())}async function pa(e=!1){var a;if(!d.isConnected){wr();return}const t=Date.now();if(!(!e&&Jt)&&!(!e&&t-_a<1e4)){Jt=!0,_a=t;try{await S0();try{const n=await fetch("https://getsystemdata-4wvdcuoouq-uc.a.run.app");if(n.ok){const i=await n.json();(a=i==null?void 0:i.economy)!=null&&a.totalPStake&&(Ca=BigInt(i.economy.totalPStake))}}catch{console.log("Firebase unavailable, using blockchain")}if(Ca===0n){const n=d.delegationManagerContractPublic||d.delegationManagerContract;n&&(Ca=await ce(n,"totalNetworkPStake",[],0n))}await Promise.all([Wa(!0),Ou(!0),ao()]),await L0(),_0(),Zc(),Ia(),D0()}catch(n){console.error("Staking load error:",n)}finally{Jt=!1}}}async function S0(){try{const e=d.delegationManagerContract||d.delegationManagerContractPublic;if(e&&d.userAddress)try{const a=await e.getUserBestBoost(d.userAddress);et=Number(a)}catch{const a=await Qt();et=(a==null?void 0:a.boost)||0}else{const a=await Qt();et=(a==null?void 0:a.boost)||0}Fa=Jc(et).burnRate,Vc=et>0?"active":"none",R0()}catch(e){console.error("Error loading NFT boost:",e),et=0,Fa=50}}async function L0(){try{const e=d.delegationManagerContract||d.delegationManagerContractPublic;if(e&&d.userAddress)try{const t=await e.previewClaim(d.userAddress);qt={totalRewards:t.totalRewards||t[0],burnAmount:t.burnAmount||t[1],userReceives:t.userReceives||t[2],burnRateBips:t.burnRateBips||t[3],nftBoost:t.nftBoost||t[4]}}catch{const{stakingRewards:t,minerRewards:a}=await oa(),n=t+a,i=n*BigInt(Fa)/100n;qt={totalRewards:n,burnAmount:i,userReceives:n-i,burnRateBips:BigInt(Fa*100),nftBoost:BigInt(et)}}}catch(e){console.error("Error loading claim preview:",e)}}function R0(){const e=Jc(et),t=document.getElementById("nft-tier-icon");t&&(t.textContent=e.icon,t.style.background=`${e.color}20`);const a=document.getElementById("nft-tier-badge");a&&(a.className=`nft-tier-badge tier-${e.name.toLowerCase()}`,a.innerHTML=`<span>${e.icon} ${e.name}</span>`);const n=document.getElementById("nft-source");n&&(et>0?(n.classList.remove("hidden"),n.textContent=Vc):n.classList.add("hidden"));const i=document.getElementById("burn-rate-text");i&&(e.burnRate===0?i.innerHTML='<span class="text-green-400">No burn! You keep 100% of rewards</span>':i.textContent=`${e.burnRate}% of rewards will be burned on claim`);const r=document.getElementById("burn-rate-value"),s=document.getElementById("keep-rate-value");r&&(r.textContent=`${e.burnRate}%`),s&&(s.textContent=`${e.userGets}%`);const o=document.getElementById("burn-fill"),l=document.getElementById("receive-fill");o&&(o.style.width=`${e.burnRate}%`),l&&(l.style.width=`${e.userGets}%`)}function _0(){var s;const e=(o,l)=>{const c=document.getElementById(o);c&&(c.textContent=l)};e("stat-network",ea(Ca||d.totalNetworkPStake||0n)),e("stat-pstake",ea(d.userTotalPStake||0n)),e("balance-display",M(d.currentUserBalance||0n).toFixed(2)),e("stat-delegations",(d.userDelegations||[]).length.toString());const t=d.userTotalPStake||0n,a=Ca||d.totalNetworkPStake||0n;let n=0;a>0n&&t>0n&&(n=Number(t*10000n/a)/100),e("stat-pstake-percent",n>0?`${n.toFixed(2)}% of network`:"0% of network");const i=((s=d.systemFees)==null?void 0:s.DELEGATION_FEE_BIPS)||50n,r=Number(i)/100;e("fee-info",`${r}% protocol fee`),F0()}async function F0(){const e=document.getElementById("claim-section");if(!e)return;const{stakingRewards:t,minerRewards:a}=await oa(),n=t+a,i=(r,s)=>{const o=document.getElementById(r);o&&(o.textContent=s)};if(i("stat-rewards",M(n).toFixed(4)),n>0n){e.classList.remove("hidden");let r,s;qt&&qt.totalRewards>0n?(r=qt.burnAmount,s=qt.userReceives):(r=n*BigInt(Fa)/100n,s=n-r),i("claim-total",M(n).toFixed(4)),i("claim-burn",M(r).toFixed(4)),i("claim-receive",M(s).toFixed(4)),r>0n?e.classList.add("has-burn"):e.classList.remove("has-burn");const o=document.getElementById("claim-btn");o&&(o.onclick=()=>H0(t,a,o))}else e.classList.add("hidden")}function wr(){const e=(i,r)=>{const s=document.getElementById(i);s&&(s.textContent=r)};e("stat-network","--"),e("stat-pstake","--"),e("stat-rewards","--"),e("stat-delegations","0"),e("balance-display","0.00"),e("stat-pstake-percent","--% of network");const t=document.getElementById("delegations-list");t&&(t.innerHTML=`
            <div class="text-center py-12">
                <div class="w-14 h-14 bg-zinc-800/50 rounded-2xl flex items-center justify-center mx-auto mb-3">
                    <i class="fa-solid fa-wallet text-xl text-zinc-600"></i>
                </div>
                <p class="text-zinc-500 text-sm">Connect wallet to view</p>
            </div>
        `);const a=document.getElementById("staking-history-list");a&&(a.innerHTML=`
            <div class="text-center py-12">
                <i class="fa-solid fa-clock-rotate-left text-2xl text-zinc-700 mb-3"></i>
                <p class="text-zinc-500 text-sm">Connect wallet to view history</p>
            </div>
        `);const n=document.getElementById("claim-section");n&&n.classList.add("hidden")}function Zc(){const e=document.getElementById("delegations-list");if(!e)return;Nt&&(clearInterval(Nt),Nt=null);const t=d.userDelegations||[],a=document.getElementById("delegation-count");a&&(a.textContent=t.length.toString());const n=document.getElementById("stat-delegations");if(n&&(n.textContent=t.length.toString()),t.length===0){e.innerHTML=`
            <div class="text-center py-12">
                <div class="w-14 h-14 bg-purple-500/10 rounded-2xl flex items-center justify-center mx-auto mb-3">
                    <i class="fa-solid fa-layer-group text-xl text-purple-400/50"></i>
                </div>
                <p class="text-zinc-500 text-sm mb-1">No active delegations</p>
                <p class="text-zinc-600 text-xs">Delegate BKC to start earning rewards</p>
            </div>
        `;return}const i=[...t].sort((r,s)=>Number(r.unlockTime)-Number(s.unlockTime));e.innerHTML=i.map(r=>M0(r)).join(""),bs(),Nt=setInterval(bs,6e4),e.querySelectorAll(".unstake-btn").forEach(r=>{r.addEventListener("click",()=>gs(r.dataset.index,!1))}),e.querySelectorAll(".force-unstake-btn").forEach(r=>{r.addEventListener("click",()=>{confirm(`âš ï¸ Force Unstake will apply a 50% penalty!

Are you sure?`)&&gs(r.dataset.index,!0)})})}function M0(e){const t=M(e.amount).toFixed(2),a=ea(Xc(e.amount,e.lockDuration)),n=Number(e.unlockTime),i=Math.floor(Date.now()/1e3),r=n>i,s=r?n-i:0,o=Math.floor(Number(e.lockDuration)/86400);return`
        <div class="delegation-item p-3">
            <div class="flex items-center justify-between gap-3">
                <div class="flex items-center gap-3 min-w-0">
                    <div class="w-11 h-11 rounded-xl ${r?"bg-amber-500/10 border border-amber-500/20":"bg-green-500/10 border border-green-500/20"} flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid ${r?"fa-lock text-amber-400":"fa-lock-open text-green-400"}"></i>
                    </div>
                    <div class="min-w-0">
                        <p class="text-white font-bold text-sm">${t} <span class="text-zinc-500 text-xs font-normal">BKC</span></p>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span class="text-purple-400 text-[10px] font-mono">${a} pS</span>
                            <span class="text-zinc-600 text-[10px]">â€¢</span>
                            <span class="text-zinc-500 text-[10px]">${z0(o)}</span>
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-2 flex-shrink-0">
                    ${r?`
                        <div class="countdown-timer text-[10px] font-mono bg-amber-500/10 text-amber-400 px-2.5 py-1.5 rounded-lg border border-amber-500/20" 
                             data-unlock-time="${n}">
                            ${qc(s)}
                        </div>
                        <button class="force-unstake-btn w-9 h-9 rounded-lg bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 flex items-center justify-center transition-all hover:scale-105" 
                                data-index="${e.index}" title="Force unstake (50% penalty)">
                            <i class="fa-solid fa-bolt text-red-400 text-xs"></i>
                        </button>
                    `:`
                        <span class="text-[10px] font-mono bg-green-500/10 text-green-400 px-2.5 py-1.5 rounded-lg border border-green-500/20">
                            âœ“ Ready
                        </span>
                        <button class="unstake-btn bg-white hover:bg-zinc-100 text-black text-[10px] font-bold px-4 py-2 rounded-lg transition-all hover:scale-105" 
                                data-index="${e.index}">
                            Unstake
                        </button>
                    `}
                </div>
            </div>
        </div>
    `}function bs(){const e=document.querySelectorAll(".countdown-timer"),t=Math.floor(Date.now()/1e3);e.forEach(a=>{const n=parseInt(a.dataset.unlockTime);a.textContent=qc(n-t)})}async function D0(){if(d.userAddress)try{const e=ze.getHistory||"https://gethistory-4wvdcuoouq-uc.a.run.app",t=await fetch(`${e}/${d.userAddress}`);t.ok&&(Ni=(await t.json()||[]).filter(n=>{const i=(n.type||"").toUpperCase();return i.includes("DELEGAT")||i.includes("STAKE")||i.includes("UNDELEGAT")||i.includes("CLAIM")||i.includes("REWARD")||i.includes("FORCE")}),Qc())}catch(e){console.error("History load error:",e)}}function Qc(){const e=document.getElementById("staking-history-list");if(!e)return;let t=Ni;if(ka!=="ALL"&&(t=Ni.filter(a=>{const n=(a.type||"").toUpperCase();switch(ka){case"STAKE":return(n.includes("DELEGAT")||n.includes("STAKE"))&&!n.includes("UNSTAKE")&&!n.includes("UNDELEGAT")&&!n.includes("FORCE");case"UNSTAKE":return n.includes("UNSTAKE")||n.includes("UNDELEGAT")||n.includes("FORCE");case"CLAIM":return n.includes("CLAIM")||n.includes("REWARD");default:return!0}})),t.length===0){e.innerHTML=`
            <div class="text-center py-12">
                <i class="fa-solid fa-inbox text-3xl text-zinc-700 mb-3"></i>
                <p class="text-zinc-500 text-sm">No ${ka==="ALL"?"staking":ka.toLowerCase()} history yet</p>
            </div>
        `;return}e.innerHTML=t.slice(0,25).map(a=>{const n=(a.type||"").toUpperCase(),i=a.details||{},r=P0(a.timestamp||a.createdAt);let s,o,l,c,u="";n.includes("FORCE")?(s="fa-bolt",o="bg-red-500/15",l="text-red-400",c="Force Unstaked",i.feePaid&&BigInt(i.feePaid)>0n&&(u=`<span class="text-red-400">-${M(BigInt(i.feePaid)).toFixed(2)} penalty</span>`)):(n.includes("DELEGAT")||n.includes("STAKE"))&&!n.includes("UNSTAKE")?(s="fa-lock",o="bg-green-500/15",l="text-green-400",c="Delegated",i.pStakeGenerated&&(u=`<span class="text-purple-400">+${M(BigInt(i.pStakeGenerated)).toFixed(0)} pS</span>`)):n.includes("UNSTAKE")||n.includes("UNDELEGAT")?(s="fa-unlock",o="bg-orange-500/15",l="text-orange-400",c="Unstaked"):n.includes("CLAIM")||n.includes("REWARD")?(s="fa-coins",o="bg-amber-500/15",l="text-amber-400",c="Claimed",i.amountReceived&&BigInt(i.amountReceived)>0n&&(u=`<span class="text-green-400">+${M(BigInt(i.amountReceived)).toFixed(2)}</span>`)):(s="fa-circle",o="bg-zinc-500/15",l="text-zinc-400",c=a.type||"Activity");const f=a.txHash?`${B0}${a.txHash}`:"#",p=a.amount||i.amount||i.amountReceived||"0",b=M(BigInt(p)),m=b>.001?b.toFixed(2):"";return`
            <a href="${f}" target="_blank" class="delegation-item flex items-center justify-between p-3 group">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-lg ${o} flex items-center justify-center">
                        <i class="fa-solid ${s} text-sm ${l}"></i>
                    </div>
                    <div>
                        <div class="flex items-center gap-2">
                            <p class="text-white text-xs font-medium">${c}</p>
                            ${u?`<span class="text-[10px]">${u}</span>`:""}
                        </div>
                        <p class="text-zinc-600 text-[10px]">${r}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    ${m?`<span class="text-xs font-mono font-medium text-white">${m} <span class="text-zinc-500">BKC</span></span>`:""}
                    <i class="fa-solid fa-arrow-up-right-from-square text-zinc-600 group-hover:text-purple-400 text-[10px] transition-colors"></i>
                </div>
            </a>
        `}).join("")}function Ia(){var n;const e=document.getElementById("amount-input"),t=document.getElementById("stake-btn");if(!e)return;const a=e.value;if(!a||parseFloat(a)<=0){document.getElementById("preview-pstake").textContent="0",document.getElementById("preview-net").textContent="0.00 BKC",t&&(t.disabled=!0);return}try{const i=Ta.parseUnits(a,18),r=((n=d.systemFees)==null?void 0:n.DELEGATION_FEE_BIPS)||50n,s=i*BigInt(r)/10000n,o=i-s,l=BigInt(vr)*86400n,c=Xc(o,l);document.getElementById("preview-pstake").textContent=ea(c),document.getElementById("preview-net").textContent=`${M(o).toFixed(4)} BKC`;const u=d.currentUserBalance||0n;i>u?(e.classList.add("error"),t&&(t.disabled=!0)):(e.classList.remove("error"),t&&(t.disabled=Ye))}catch{t&&(t.disabled=!0)}}async function O0(){if(Ye)return;const e=document.getElementById("amount-input"),t=document.getElementById("stake-btn");if(document.getElementById("stake-btn-text"),document.getElementById("stake-btn-icon"),!e||!t)return;const a=e.value;if(!a||parseFloat(a)<=0){h("Enter an amount","warning");return}const n=d.currentUserBalance||0n;let i;try{if(i=Ta.parseUnits(a,18),i>n){h("Insufficient BKC balance","error");return}}catch{h("Invalid amount","error");return}try{if(await new Ta.BrowserProvider(window.ethereum).getBalance(d.userAddress)<Ta.parseEther("0.001")){h("Insufficient ETH for gas","error");return}}catch{}Ye=!0;const r=BigInt(vr)*86400n;try{await Ft.delegate({amount:i,lockDuration:r,button:t,onSuccess:async()=>{e.value="",h("ðŸ”’ Delegation successful!","success"),Jt=!1,_a=0,await pa(!0)},onError:s=>{s.cancelled||h("Delegation failed: "+(s.reason||s.message||"Unknown error"),"error")}})}catch(s){h("Delegation failed: "+(s.reason||s.message||"Unknown error"),"error")}finally{Ye=!1,Ia()}}async function gs(e,t){if(Ye)return;const a=document.querySelector(t?`.force-unstake-btn[data-index='${e}']`:`.unstake-btn[data-index='${e}']`);Ye=!0;try{const n=BigInt(e);await(t?Ft.forceUnstake:Ft.unstake)({delegationIndex:n,button:a,onSuccess:async()=>{h(t?"âš¡ Force unstaked (50% penalty applied)":"ðŸ”“ Unstaked successfully!",t?"warning":"success"),Jt=!1,_a=0,await pa(!0)},onError:r=>{r.cancelled||h("Unstake failed: "+(r.reason||r.message||"Unknown error"),"error")}})}catch(n){h("Unstake failed: "+(n.reason||n.message||"Unknown error"),"error")}finally{Ye=!1,Zc()}}async function H0(e,t,a){if(!Ye){Ye=!0;try{await Ft.claimRewards({button:a,onSuccess:async()=>{h("ðŸª™ Rewards claimed!","success"),Jt=!1,_a=0,await pa(!0)},onError:n=>{n.cancelled||h("Claim failed: "+(n.reason||n.message||"Unknown error"),"error")}})}catch(n){h("Claim failed: "+(n.reason||n.message||"Unknown error"),"error")}finally{Ye=!1}}}function U0(){const e=document.getElementById("amount-input"),t=document.getElementById("max-btn"),a=document.getElementById("stake-btn"),n=document.getElementById("refresh-btn"),i=document.querySelectorAll(".duration-chip"),r=document.querySelectorAll(".history-tab");e==null||e.addEventListener("input",Ia),t==null||t.addEventListener("click",()=>{const s=d.currentUserBalance||0n;e&&(e.value=Ta.formatUnits(s,18),Ia())}),i.forEach(s=>{s.addEventListener("click",()=>{i.forEach(o=>o.classList.remove("selected")),s.classList.add("selected"),vr=parseInt(s.dataset.days),Ia()})}),r.forEach(s=>{s.addEventListener("click",()=>{r.forEach(o=>o.classList.remove("active")),s.classList.add("active"),ka=s.dataset.filter,Qc()})}),a==null||a.addEventListener("click",O0),n==null||n.addEventListener("click",()=>{const s=n.querySelector("i");s==null||s.classList.add("fa-spin"),pa(!0).then(()=>{setTimeout(()=>s==null?void 0:s.classList.remove("fa-spin"),500)})})}function j0(){Nt&&(clearInterval(Nt),Nt=null)}function W0(e){e?pa():wr()}const ed={render:$0,update:W0,cleanup:j0},Se=window.ethers,G0="https://sepolia.arbiscan.io/tx/",K0=3e4,$i={Diamond:{color:"#22d3ee",gradient:"from-cyan-500/20 to-blue-500/20",border:"border-cyan-500/40",text:"text-cyan-400",glow:"shadow-cyan-500/30",icon:"ðŸ’Ž",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq",keepRate:100,burnRate:0},Gold:{color:"#fbbf24",gradient:"from-yellow-500/20 to-amber-500/20",border:"border-yellow-500/40",text:"text-yellow-400",glow:"shadow-yellow-500/30",icon:"ðŸ¥‡",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44",keepRate:90,burnRate:10},Silver:{color:"#9ca3af",gradient:"from-gray-400/20 to-slate-400/20",border:"border-gray-400/40",text:"text-gray-300",glow:"shadow-gray-400/30",icon:"ðŸ¥ˆ",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4",keepRate:75,burnRate:25},Bronze:{color:"#f97316",gradient:"from-orange-600/20 to-amber-700/20",border:"border-orange-600/40",text:"text-orange-400",glow:"shadow-orange-500/30",icon:"ðŸ¥‰",image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m",keepRate:60,burnRate:40}};function jn(e){return $i[e]||$i.Bronze}const S={tradeDirection:"buy",selectedPoolBoostBips:null,buyPrice:0n,sellPrice:0n,netSellPrice:0n,poolNFTCount:0,userBalanceOfSelectedNFT:0,availableToSellCount:0,firstAvailableTokenId:null,firstAvailableTokenIdForBuy:null,bestBoosterTokenId:0n,bestBoosterBips:0,isDataLoading:!1,tradeHistory:[]},yn=new Map,yr=new Map;let un=!1,Bt=null;const Y0=["function getPoolAddress(uint256 boostBips) view returns (address)","function isPool(address) view returns (bool)"];function V0(e){if(!e)return"";try{const t=e.seconds||e._seconds||new Date(e).getTime()/1e3;return new Date(t*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return""}}function q0(e){const t=yr.get(e);return t&&Date.now()-t.timestamp<K0?t.data:null}function td(e,t){yr.set(e,{data:t,timestamp:Date.now()})}function oi(e){yr.delete(e)}function X0(){if(document.getElementById("swap-styles-v9"))return;const e=document.createElement("style");e.id="swap-styles-v9",e.textContent=`
        /* Trade Image Animations */
        @keyframes trade-float {
            0%, 100% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-8px) rotate(1deg); }
        }
        @keyframes trade-pulse {
            0%, 100% { filter: drop-shadow(0 0 15px rgba(34,197,94,0.3)); }
            50% { filter: drop-shadow(0 0 30px rgba(34,197,94,0.6)); }
        }
        @keyframes trade-buy {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(34,197,94,0.4)); transform: scale(1); }
            50% { filter: drop-shadow(0 0 40px rgba(34,197,94,0.7)); transform: scale(1.05); }
        }
        @keyframes trade-sell {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(239,68,68,0.4)); transform: scale(1); }
            50% { filter: drop-shadow(0 0 40px rgba(239,68,68,0.7)); transform: scale(1.05); }
        }
        @keyframes trade-spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        @keyframes trade-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); filter: drop-shadow(0 0 50px rgba(34,197,94,0.9)); }
            100% { transform: scale(1); }
        }
        .trade-float { animation: trade-float 4s ease-in-out infinite; }
        .trade-pulse { animation: trade-pulse 2s ease-in-out infinite; }
        .trade-buy { animation: trade-buy 2s ease-in-out infinite; }
        .trade-sell { animation: trade-sell 2s ease-in-out infinite; }
        .trade-spin { animation: trade-spin 1.5s ease-in-out; }
        .trade-success { animation: trade-success 0.8s ease-out; }
        
        .swap-container {
            font-family: 'Inter', -apple-system, sans-serif;
        }
        
        .swap-card {
            background: linear-gradient(180deg, rgba(24,24,27,0.95) 0%, rgba(9,9,11,0.98) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            backdrop-filter: blur(20px);
        }
        
        .tier-chip {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tier-chip:hover {
            transform: translateY(-2px);
        }
        
        .tier-chip.active {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(139,92,246,0.3);
        }
        
        .swap-input-box {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.4);
            transition: all 0.2s ease;
        }
        
        .swap-input-box:hover {
            border-color: rgba(113,113,122,0.5);
        }
        
        .swap-input-box.active {
            border-color: rgba(245,158,11,0.5);
            background: rgba(39,39,42,0.7);
        }
        
        .swap-arrow-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .swap-arrow-btn:hover {
            transform: rotate(180deg);
            background: rgba(63,63,70,0.8);
        }
        
        .swap-btn {
            transition: all 0.2s ease;
        }
        
        .swap-btn:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 40px -10px currentColor;
        }
        
        .swap-btn:not(:disabled):active {
            transform: translateY(0);
        }
        
        .token-selector {
            background: rgba(39,39,42,0.8);
            border: 1px solid rgba(63,63,70,0.5);
            transition: all 0.2s ease;
        }
        
        .token-selector:hover {
            background: rgba(63,63,70,0.8);
            border-color: rgba(113,113,122,0.5);
        }
        
        .inventory-item {
            transition: all 0.2s ease;
        }
        
        .inventory-item:hover {
            transform: scale(1.05);
            border-color: rgba(245,158,11,0.5);
        }
        
        .history-item {
            transition: all 0.2s ease;
        }
        
        .history-item:hover {
            background: rgba(63,63,70,0.5) !important;
            transform: translateX(4px);
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .skeleton {
            background: linear-gradient(90deg, rgba(39,39,42,0.5) 25%, rgba(63,63,70,0.5) 50%, rgba(39,39,42,0.5) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(39,39,42,0.3);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(113,113,122,0.5);
            border-radius: 2px;
        }
        
        /* Tier Grid - Responsive */
        .tier-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        @media (max-width: 400px) {
            .tier-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    `,document.head.appendChild(e)}function J0(){return`
        <div class="flex flex-col items-center justify-center py-12">
            <div class="relative w-16 h-16">
                <div class="absolute inset-0 rounded-full border-2 border-zinc-700"></div>
                <div class="absolute inset-0 rounded-full border-2 border-transparent border-t-purple-500 animate-spin"></div>
                <div class="absolute inset-2 rounded-full bg-zinc-800 flex items-center justify-center">
                    <i class="fa-solid fa-gem text-xl text-purple-400"></i>
                </div>
            </div>
            <p class="text-zinc-500 text-xs mt-4">Loading pool...</p>
        </div>
    `}const Z0={async render(e){X0(),await to();const t=document.getElementById("store");t&&((t.innerHTML.trim()===""||e)&&(t.innerHTML=`
                <div class="swap-container max-w-lg mx-auto py-6 px-4">
                    
                    <!-- Header with NFT Icon -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden"
                                 id="trade-mascot">
                                <img src="${$i.Diamond.image}" alt="NFT" class="w-full h-full object-contain" onerror="this.outerHTML='<span class=\\'text-3xl\\'>ðŸ’Ž</span>'">
                            </div>
                            <div>
                                <h1 class="text-lg font-semibold text-white">NFT Market</h1>
                                <p class="text-xs text-zinc-500">Keep up to 100% of rewards</p>
                            </div>
                        </div>
                        <button id="refresh-btn" class="w-8 h-8 rounded-lg bg-zinc-800/50 hover:bg-zinc-700 flex items-center justify-center text-zinc-400 hover:text-white transition-colors">
                            <i class="fa-solid fa-rotate text-xs"></i>
                        </button>
                    </div>
                    
                    <!-- Main Swap Card -->
                    <div class="swap-card rounded-2xl p-4 mb-4">
                        
                        <!-- Tier Selector - GRID Layout V6.8 -->
                        <div class="mb-4">
                            <p class="text-xs text-zinc-500 mb-2">Select NFT Tier (Higher = Keep More Rewards)</p>
                            <div id="tier-selector" class="tier-grid">
                                ${Q0()}
                            </div>
                        </div>
                        
                        <!-- Swap Interface -->
                        <div id="swap-interface">
                            ${J0()}
                        </div>
                        
                    </div>
                    
                    <!-- My NFTs (Collapsible) -->
                    <div class="swap-card rounded-2xl overflow-hidden mb-4">
                        <button id="inventory-toggle" class="w-full flex justify-between items-center p-4 hover:bg-zinc-800/30 transition-colors">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-wallet text-amber-500 text-sm"></i>
                                <span class="text-sm font-medium text-white">My NFTs</span>
                                <span id="nft-count" class="text-xs bg-zinc-700 px-2 py-0.5 rounded-full text-zinc-300">0</span>
                            </div>
                            <i id="inventory-chevron" class="fa-solid fa-chevron-down text-zinc-500 text-xs transition-transform"></i>
                        </button>
                        <div id="inventory-panel" class="hidden border-t border-zinc-800">
                            <div id="inventory-grid" class="p-4 grid grid-cols-4 gap-2 max-h-[200px] overflow-y-auto custom-scroll">
                                ${Ip("No NFTs")}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trade History (Collapsible) - OPEN by default -->
                    <div class="swap-card rounded-2xl overflow-hidden">
                        <button id="history-toggle" class="w-full flex justify-between items-center p-4 hover:bg-zinc-800/30 transition-colors">
                            <div class="flex items-center gap-2">
                                <i class="fa-solid fa-clock-rotate-left text-green-500 text-sm"></i>
                                <span class="text-sm font-medium text-white">Trade History</span>
                                <span id="history-count" class="text-xs bg-zinc-700 px-2 py-0.5 rounded-full text-zinc-300">0</span>
                            </div>
                            <i id="history-chevron" class="fa-solid fa-chevron-down text-zinc-500 text-xs transition-transform" style="transform: rotate(180deg)"></i>
                        </button>
                        <div id="history-panel" class="border-t border-zinc-800">
                            <div id="history-list" class="p-4 space-y-2 max-h-[300px] overflow-y-auto custom-scroll">
                                <div class="text-center py-4 text-xs text-zinc-600">Loading history...</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            `,nm()),S.selectedPoolBoostBips===null&&he.length>0&&(S.selectedPoolBoostBips=he[0].boostBips),await ut(),await Ea())},async update(){S.selectedPoolBoostBips!==null&&!S.isDataLoading&&document.getElementById("store")&&!document.hidden&&await ut()}};async function Ea(){const e=document.getElementById("history-list");if(!d.userAddress){e&&(e.innerHTML='<div class="text-center py-4 text-xs text-zinc-600">Connect wallet to view history</div>');return}try{const t=ze.getHistory||"https://gethistory-4wvdcuoouq-uc.a.run.app",a=await fetch(`${t}/${d.userAddress}`);if(!a.ok)throw new Error(`HTTP ${a.status}`);const n=await a.json();console.log("All history types:",[...new Set((n||[]).map(r=>r.type))]),S.tradeHistory=(n||[]).filter(r=>{const s=(r.type||"").toUpperCase();return s==="NFTBOUGHT"||s==="NFTSOLD"||s==="NFT_BOUGHT"||s==="NFT_SOLD"||s==="NFTPURCHASED"||s==="NFT_PURCHASED"||s.includes("NFTBOUGHT")||s.includes("NFTSOLD")||s.includes("NFTPURCHASED")}),console.log("NFT trade history:",S.tradeHistory.length,"items");const i=document.getElementById("history-count");i&&(i.textContent=S.tradeHistory.length),xs()}catch(t){console.error("History load error:",t),S.tradeHistory=[],xs()}}function xs(){const e=document.getElementById("history-list");if(e){if(!d.isConnected){e.innerHTML='<div class="text-center py-4 text-xs text-zinc-600">Connect wallet to view history</div>';return}if(S.tradeHistory.length===0){e.innerHTML=`
            <div class="text-center py-6">
                <div class="w-12 h-12 mx-auto rounded-full bg-zinc-800/50 flex items-center justify-center mb-2">
                    <i class="fa-solid fa-receipt text-zinc-600 text-lg"></i>
                </div>
                <p class="text-zinc-600 text-xs">No NFT trades yet</p>
                <p class="text-zinc-700 text-[10px] mt-1">Buy or sell NFTs to see history</p>
            </div>
        `;return}e.innerHTML=S.tradeHistory.slice(0,20).map(t=>{const a=(t.type||"").toUpperCase(),n=t.details||{},i=V0(t.timestamp||t.createdAt),r=a.includes("BOUGHT")||a.includes("PURCHASED"),s=r?"fa-cart-plus":"fa-money-bill-transfer",o=r?"#22c55e":"#f59e0b",l=r?"rgba(34,197,94,0.15)":"rgba(245,158,11,0.15)",c=r?"ðŸ›’ Bought NFT":"ðŸ’° Sold NFT",u=r?"-":"+",f=t.txHash?`${G0}${t.txHash}`:"#";let p="";try{let x=t.amount||n.amount||n.price||n.payout||"0";if(typeof x=="string"&&x!=="0"){const y=M(BigInt(x));y>.001&&(p=y.toFixed(2))}}catch{}const b=n.tokenId||"",m=n.boostBips||n.boost||"";return`
            <a href="${f}" target="_blank" class="history-item flex items-center justify-between p-3 hover:bg-zinc-800/60 border border-zinc-700/30 rounded-lg transition-all group bg-zinc-800/20">
                <div class="flex items-center gap-3">
                    <div class="w-9 h-9 rounded-lg flex items-center justify-center border border-zinc-700/30" style="background: ${l}">
                        <i class="fa-solid ${s} text-sm" style="color: ${o}"></i>
                    </div>
                    <div>
                        <p class="text-white text-xs font-medium">
                            ${c}
                            ${b?`<span class="ml-1 text-[10px] text-amber-400 font-mono">#${b}</span>`:""}
                            ${m?`<span class="ml-1 text-[9px] text-purple-400">+${Number(m)/100}%</span>`:""}
                        </p>
                        <p class="text-zinc-600 text-[10px]">${i}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    ${p?`<span class="text-xs font-mono font-bold ${r?"text-white":"text-green-400"}">${u}${p} <span class="text-zinc-500">BKC</span></span>`:""}
                    <i class="fa-solid fa-arrow-up-right-from-square text-zinc-600 group-hover:text-blue-400 text-[9px]"></i>
                </div>
            </a>
        `}).join("")}}function Q0(){return he.map((e,t)=>{const a=jn(e.name),n=t===0,i=ht(e.boostBips),r=a.icon||e.emoji||"ðŸ’Ž";return`
            <button class="tier-chip flex flex-col items-center gap-1 p-2 rounded-xl border transition-all
                ${n?`bg-gradient-to-br ${a.gradient} ${a.border} ${a.text} active`:"bg-zinc-800/50 border-zinc-700/50 text-zinc-400 hover:border-zinc-600"}"
                data-boost="${e.boostBips}"
                data-tier="${e.name}">
                <div class="w-8 h-8 flex items-center justify-center">
                    ${a.image?`<img src="${a.image}" alt="${e.name}" class="w-full h-full object-contain rounded" onerror="this.outerHTML='<span class=\\'text-2xl\\'>${r}</span>'">`:`<span class="text-2xl">${r}</span>`}
                </div>
                <span class="text-[10px] font-medium truncate w-full text-center">${e.name}</span>
                <span class="text-[9px] ${i===100?"text-green-400 font-bold":"opacity-70"}">Keep ${i}%</span>
            </button>
        `}).join("")}function hs(e){document.querySelectorAll(".tier-chip").forEach(t=>{const a=Number(t.dataset.boost)===e,n=t.dataset.tier,i=jn(n);t.className=`tier-chip flex flex-col items-center gap-1 p-2 rounded-xl border transition-all ${a?`bg-gradient-to-br ${i.gradient} ${i.border} ${i.text} active`:"bg-zinc-800/50 border-zinc-700/50 text-zinc-400 hover:border-zinc-600"}`})}function kn(){const e=document.getElementById("swap-interface");if(!e)return;const t=he.find(m=>m.boostBips===S.selectedPoolBoostBips),a=jn(t==null?void 0:t.name),n=S.tradeDirection==="buy";tm(n);const i=n?S.buyPrice:S.netSellPrice,r=M(i).toFixed(2),s=M(d.currentUserBalance||0n).toFixed(2),o=n&&S.firstAvailableTokenIdForBuy===null,l=!n&&S.availableToSellCount===0,c=!n&&S.userBalanceOfSelectedNFT>S.availableToSellCount,u=n&&S.buyPrice>(d.currentUserBalance||0n),f=n?"":c?`<span class="${l?"text-red-400":"text-zinc-400"}">${S.availableToSellCount}</span>/<span class="text-zinc-500">${S.userBalanceOfSelectedNFT}</span> <span class="text-[9px] text-blue-400">(${S.userBalanceOfSelectedNFT-S.availableToSellCount} rented)</span>`:`<span class="${l?"text-red-400":"text-zinc-400"}">${S.userBalanceOfSelectedNFT}</span>`,p=a.icon||(t==null?void 0:t.emoji)||"ðŸ’Ž",b=a.image||"";ht((t==null?void 0:t.boostBips)||0),e.innerHTML=`
        <div class="fade-in">
            
            <!-- From Section -->
            <div class="swap-input-box rounded-2xl p-4 mb-1">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-zinc-500">${n?"You pay":"You sell"}</span>
                    <span class="text-xs text-zinc-600">
                        ${n?`Balance: <span class="${u?"text-red-400":"text-zinc-400"}">${s}</span>`:`Available: ${f}`}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-semibold ${u&&n?"text-red-400":"text-white"}">
                        ${n?r:"1"}
                        ${!n&&S.firstAvailableTokenId?`<span class="text-sm text-amber-400 ml-2">#${S.firstAvailableTokenId.toString()}</span>`:""}
                    </span>
                    <div class="token-selector flex items-center gap-2 px-3 py-2 rounded-xl cursor-default">
                        ${n?'<img src="./assets/bkc_logo_3d.png" class="w-6 h-6 rounded">':b?`<img src="${b}" alt="${t==null?void 0:t.name}" class="w-6 h-6 object-contain rounded" onerror="this.outerHTML='<span class=\\'text-xl\\'>${p}</span>'">`:`<span class="text-xl">${p}</span>`}
                        <span class="text-white text-sm font-medium">${n?"BKC":(t==null?void 0:t.name)||"NFT"}</span>
                    </div>
                </div>
            </div>
            
            <!-- Swap Arrow -->
            <div class="flex justify-center -my-3 relative z-10">
                <button id="swap-direction-btn" class="swap-arrow-btn w-10 h-10 rounded-xl bg-zinc-800 border-4 border-zinc-900 flex items-center justify-center text-zinc-400 hover:text-white">
                    <i class="fa-solid fa-arrow-down"></i>
                </button>
            </div>
            
            <!-- To Section -->
            <div class="swap-input-box rounded-2xl p-4 mt-1 mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-zinc-500">You receive</span>
                    <span class="text-xs text-zinc-600">
                        ${n?`In pool: <span class="${o?"text-red-400":"text-green-400"}">${S.poolNFTCount}</span>`:"Net after fee"}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-semibold text-white">${n?"1":M(S.netSellPrice).toFixed(2)}</span>
                    <div class="token-selector flex items-center gap-2 px-3 py-2 rounded-xl cursor-default">
                        ${n?b?`<img src="${b}" alt="${t==null?void 0:t.name}" class="w-6 h-6 object-contain rounded" onerror="this.outerHTML='<span class=\\'text-xl\\'>${p}</span>'">`:`<span class="text-xl">${p}</span>`:'<img src="./assets/bkc_logo_3d.png" class="w-6 h-6 rounded">'}
                        <span class="text-white text-sm font-medium">${n?(t==null?void 0:t.name)||"NFT":"BKC"}</span>
                    </div>
                </div>
            </div>
            
            <!-- Pool Info - V6.8 -->
            <div class="flex justify-between items-center text-[10px] text-zinc-600 mb-4 px-1">
                <span class="flex items-center gap-1">
                    ${b?`<img src="${b}" alt="${t==null?void 0:t.name}" class="w-4 h-4 object-contain" onerror="this.outerHTML='<span>${p}</span>'">`:`<span>${p}</span>`}
                    <span>${(t==null?void 0:t.name)||"Unknown"} Pool</span>
                </span>
                <span class="text-green-400">Keep ${ht((t==null?void 0:t.boostBips)||0)}% of rewards</span>
            </div>
            
            <!-- Execute Button -->
            ${em(n,o,l,u,c)}
        </div>
    `}function em(e,t,a,n,i=!1){return d.isConnected?e?t?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-zinc-500 bg-zinc-800 cursor-not-allowed">
                    <i class="fa-solid fa-box-open mr-2"></i> Sold Out
                </button>
            `:n?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-red-400 bg-red-950/30 cursor-not-allowed border border-red-500/30">
                    <i class="fa-solid fa-coins mr-2"></i> Insufficient BKC
                </button>
            `:`
            <button id="execute-btn" data-action="buy" class="swap-btn w-full py-4 rounded-2xl font-semibold text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500">
                <i class="fa-solid fa-cart-plus mr-2"></i> Buy NFT
            </button>
        `:a&&i?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-blue-400 bg-blue-950/30 cursor-not-allowed border border-blue-500/30">
                    <i class="fa-solid fa-key mr-2"></i> All NFTs Rented
                </button>
            `:a?`
                <button disabled class="w-full py-4 rounded-2xl font-semibold text-zinc-500 bg-zinc-800 cursor-not-allowed">
                    <i class="fa-solid fa-gem mr-2"></i> No NFT to Sell
                </button>
            `:`
            <button id="execute-btn" data-action="sell" class="swap-btn w-full py-4 rounded-2xl font-semibold text-white bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500">
                <i class="fa-solid fa-money-bill-transfer mr-2"></i> Sell NFT
            </button>
        `:`
            <button id="execute-btn" data-action="connect" class="swap-btn w-full py-4 rounded-2xl font-semibold text-white bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500">
                <i class="fa-solid fa-wallet mr-2"></i> Connect Wallet
            </button>
        `}function tm(e){const t=document.getElementById("trade-mascot");t&&(t.className=`w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden ${e?"trade-buy":"trade-sell"}`)}function vs(){const e=document.getElementById("inventory-grid"),t=document.getElementById("nft-count");if(!e)return;const a=d.myBoosters||[];if(t&&(t.textContent=a.length),!d.isConnected){e.innerHTML='<div class="col-span-4 text-center py-4 text-xs text-zinc-600">Connect wallet</div>';return}if(a.length===0){e.innerHTML=`
            <div class="col-span-4 text-center py-4">
                <p class="text-zinc-600 text-xs">No NFTs owned</p>
                <p class="text-zinc-700 text-[10px] mt-1">Buy from pool to get started</p>
            </div>
        `;return}const n=d.rentalListings||[],i=new Set(n.map(s=>{var o;return(o=s.tokenId)==null?void 0:o.toString()})),r=Math.floor(Date.now()/1e3);e.innerHTML=a.map(s=>{var A;const o=he.find(N=>N.boostBips===Number(s.boostBips)),l=jn(o==null?void 0:o.name),c=ht(Number(s.boostBips)),u=l.icon||(o==null?void 0:o.emoji)||"ðŸ’Ž",f=S.firstAvailableTokenId&&BigInt(s.tokenId)===S.firstAvailableTokenId,p=(A=s.tokenId)==null?void 0:A.toString(),b=i.has(p),m=n.find(N=>{var P;return((P=N.tokenId)==null?void 0:P.toString())===p}),x=m&&m.rentalEndTime&&Number(m.rentalEndTime)>r,y=b||x;let C="";return x?C='<span class="absolute top-1 right-1 bg-blue-500 text-white text-[7px] px-1.5 py-0.5 rounded-full font-bold">ðŸ”‘</span>':b&&(C='<span class="absolute top-1 right-1 bg-green-500 text-white text-[7px] px-1.5 py-0.5 rounded-full font-bold">ðŸ“‹</span>'),`
            <div class="inventory-item ${y?"opacity-50 cursor-not-allowed":"cursor-pointer"} rounded-xl p-2 border ${f&&!y?"border-amber-500 ring-2 ring-amber-500/50 bg-amber-500/10":"border-zinc-700/50 bg-zinc-800/30"} hover:bg-zinc-800/50 transition-all relative"
                 data-boost="${s.boostBips}" 
                 data-tokenid="${s.tokenId}"
                 data-unavailable="${y}">
                ${C}
                <div class="w-full aspect-square rounded-lg bg-gradient-to-br ${l.gradient} border ${l.border} flex items-center justify-center overflow-hidden ${y?"grayscale":""}">
                    ${l.image?`<img src="${l.image}" alt="${o==null?void 0:o.name}" class="w-full h-full object-contain p-1" onerror="this.outerHTML='<span class=\\'text-3xl\\'>${u}</span>'">`:`<span class="text-3xl">${u}</span>`}
                </div>
                <p class="text-[9px] text-center mt-1 ${l.text} truncate">${(o==null?void 0:o.name)||"NFT"}</p>
                <p class="text-[8px] text-center ${c===100?"text-green-400":"text-zinc-500"}">Keep ${c}%</p>
                <p class="text-[7px] text-center ${f&&!y?"text-amber-400 font-bold":"text-zinc-600"}">#${s.tokenId}</p>
            </div>
        `}).join("")}async function ut(e=!1){var n,i;if(S.selectedPoolBoostBips===null)return;const t=S.selectedPoolBoostBips,a=Date.now();if(Bt=a,!e){const r=q0(t);if(r){Si(r),kn(),vs(),am(t,a);return}}S.isDataLoading=!0;try{const r=d.myBoosters||[],s=d.rentalListings||[],o=new Set(s.map(H=>{var Z;return(Z=H.tokenId)==null?void 0:Z.toString()})),l=Math.floor(Date.now()/1e3),c=r.filter(H=>Number(H.boostBips)===t),u=c.filter(H=>{var ne;const Z=(ne=H.tokenId)==null?void 0:ne.toString(),Te=s.find(q=>{var ga;return((ga=q.tokenId)==null?void 0:ga.toString())===Z}),Q=o.has(Z),me=Te&&Te.rentalEndTime&&Number(Te.rentalEndTime)>l;return!Q&&!me}),f=he.find(H=>H.boostBips===t);if(!f){console.warn("Tier not found for boostBips:",t);return}const p=`pool_${f.name.toLowerCase()}`;let b=w[p]||yn.get(t);if(!b){const H=w.nftLiquidityPoolFactory;if(H&&d.publicProvider)try{b=await new Se.Contract(H,Y0,d.publicProvider).getPoolAddress(t),b&&b!==Se.ZeroAddress&&yn.set(t,b)}catch(Z){console.warn("Factory lookup failed:",Z.message)}}if(Bt!==a)return;if(!b||b===Se.ZeroAddress){const H=document.getElementById("swap-interface");H&&(H.innerHTML=`
                    <div class="text-center py-12">
                        <div class="w-12 h-12 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fa-solid fa-store-slash text-zinc-600"></i>
                        </div>
                        <p class="text-zinc-400 text-sm">Pool not available</p>
                        <p class="text-zinc-600 text-xs mt-1">${f.name} pool coming soon</p>
                    </div>
                `);return}const m=new Se.Contract(b,Js,d.publicProvider),[x,y,C]=await Promise.all([ce(m,"getBuyPrice",[],Se.MaxUint256).catch(()=>Se.MaxUint256),ce(m,"getSellPrice",[],0n).catch(()=>0n),m.getAvailableNFTs().catch(()=>[])]);if(Bt!==a)return;const A=Array.isArray(C)?[...C]:[],N=x===Se.MaxUint256?0n:x,P=y;let z=((n=d.systemFees)==null?void 0:n.NFT_POOL_SELL_TAX_BIPS)||1000n,I=BigInt(((i=d.boosterDiscounts)==null?void 0:i[S.bestBoosterBips])||0);const F=typeof z=="bigint"?z:BigInt(z),K=typeof I=="bigint"?I:BigInt(I),pe=F>K?F-K:0n,Ee=P*pe/10000n,le=P-Ee,ae={buyPrice:N,sellPrice:P,netSellPrice:le,poolNFTCount:A.length,firstAvailableTokenIdForBuy:A.length>0?BigInt(A[A.length-1]):null,userBalanceOfSelectedNFT:c.length,availableToSellCount:u.length,availableNFTsOfTier:u};td(t,ae),Si(ae,t)}catch(r){if(console.warn("Store Data Warning:",r.message),Bt===a){const s=document.getElementById("swap-interface");s&&(s.innerHTML=`
                    <div class="text-center py-12">
                        <div class="w-12 h-12 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fa-solid fa-exclamation-triangle text-amber-500"></i>
                        </div>
                        <p class="text-zinc-400 text-sm">Pool unavailable</p>
                        <p class="text-zinc-600 text-xs mt-1">${r.message}</p>
                    </div>
                `)}return}finally{Bt===a&&(S.isDataLoading=!1,kn(),vs())}}async function am(e,t){var a,n;try{const i=d.myBoosters||[],r=d.rentalListings||[],s=new Set(r.map(ae=>{var H;return(H=ae.tokenId)==null?void 0:H.toString()})),o=Math.floor(Date.now()/1e3),l=i.filter(ae=>Number(ae.boostBips)===e),c=l.filter(ae=>{var me;const H=(me=ae.tokenId)==null?void 0:me.toString(),Z=r.find(ne=>{var q;return((q=ne.tokenId)==null?void 0:q.toString())===H}),Te=s.has(H),Q=Z&&Z.rentalEndTime&&Number(Z.rentalEndTime)>o;return!Te&&!Q}),u=he.find(ae=>ae.boostBips===e);if(!u)return;const f=`pool_${u.name.toLowerCase()}`;let p=w[f]||yn.get(e);if(!p||p===Se.ZeroAddress)return;const b=new Se.Contract(p,Js,d.publicProvider),[m,x,y]=await Promise.all([ce(b,"getBuyPrice",[],Se.MaxUint256).catch(()=>Se.MaxUint256),ce(b,"getSellPrice",[],0n).catch(()=>0n),b.getAvailableNFTs().catch(()=>[])]);if(Bt!==t)return;const C=Array.isArray(y)?[...y]:[],A=m===Se.MaxUint256?0n:m,N=x;let P=((a=d.systemFees)==null?void 0:a.NFT_POOL_SELL_TAX_BIPS)||1000n,z=BigInt(((n=d.boosterDiscounts)==null?void 0:n[S.bestBoosterBips])||0);const I=typeof P=="bigint"?P:BigInt(P),F=typeof z=="bigint"?z:BigInt(z),K=I>F?I-F:0n,pe=N*K/10000n,Ee=N-pe,le={buyPrice:A,sellPrice:N,netSellPrice:Ee,poolNFTCount:C.length,firstAvailableTokenIdForBuy:C.length>0?BigInt(C[C.length-1]):null,userBalanceOfSelectedNFT:l.length,availableToSellCount:c.length,availableNFTsOfTier:c};td(e,le),S.selectedPoolBoostBips===e&&Bt===t&&(Si(le,e),kn())}catch(i){console.warn("Background refresh failed:",i.message)}}function Si(e,t){var i,r,s;S.buyPrice=e.buyPrice,S.sellPrice=e.sellPrice,S.netSellPrice=e.netSellPrice,S.poolNFTCount=e.poolNFTCount,S.firstAvailableTokenIdForBuy=e.firstAvailableTokenIdForBuy,S.userBalanceOfSelectedNFT=e.userBalanceOfSelectedNFT,S.availableToSellCount=e.availableToSellCount;const a=S.firstAvailableTokenId;!(a&&((i=e.availableNFTsOfTier)==null?void 0:i.some(o=>BigInt(o.tokenId)===a)))&&((r=e.availableNFTsOfTier)==null?void 0:r.length)>0?S.firstAvailableTokenId=BigInt(e.availableNFTsOfTier[0].tokenId):(s=e.availableNFTsOfTier)!=null&&s.length||(S.firstAvailableTokenId=null)}function nm(){const e=document.getElementById("store");e&&e.addEventListener("click",async t=>{if(t.target.closest("#refresh-btn")){const s=t.target.closest("#refresh-btn").querySelector("i");s.classList.add("fa-spin"),oi(S.selectedPoolBoostBips),await Promise.all([zt(!0),no()]),await ut(!0),Ea(),s.classList.remove("fa-spin");return}const a=t.target.closest(".tier-chip");if(a){const r=Number(a.dataset.boost);S.selectedPoolBoostBips!==r&&(S.selectedPoolBoostBips=r,S.firstAvailableTokenId=null,hs(r),await ut());return}if(t.target.closest("#swap-direction-btn")){S.tradeDirection=S.tradeDirection==="buy"?"sell":"buy",kn();return}if(t.target.closest("#inventory-toggle")){const r=document.getElementById("inventory-panel"),s=document.getElementById("inventory-chevron");r&&s&&(r.classList.toggle("hidden"),s.style.transform=r.classList.contains("hidden")?"":"rotate(180deg)");return}if(t.target.closest("#history-toggle")){const r=document.getElementById("history-panel"),s=document.getElementById("history-chevron");r&&s&&(r.classList.toggle("hidden"),s.style.transform=r.classList.contains("hidden")?"":"rotate(180deg)");return}const n=t.target.closest(".inventory-item");if(n){if(n.dataset.unavailable==="true"){h("This NFT is listed for rental and cannot be sold","warning");return}const s=Number(n.dataset.boost),o=n.dataset.tokenid;S.selectedPoolBoostBips=s,S.tradeDirection="sell",o&&(S.firstAvailableTokenId=BigInt(o),console.log("User selected NFT #"+o+" for sale")),hs(s),await ut();return}const i=t.target.closest("#execute-btn");if(i){if(t.preventDefault(),t.stopPropagation(),un||i.disabled)return;const r=i.dataset.action,s=document.getElementById("trade-mascot");if(r==="connect"){window.openConnectModal();return}const o=he.find(u=>u.boostBips===S.selectedPoolBoostBips);if(!o)return;const l=`pool_${o.name.toLowerCase()}`,c=w[l]||yn.get(o.boostBips);if(!c){h("Pool address not found","error");return}un=!0,s&&(s.className="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden trade-spin");try{if(S.tradeDirection==="buy")await Ti.buyFromPool({poolAddress:c,button:i,onSuccess:async u=>{s&&(s.className="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden trade-success"),h("ðŸŸ¢ NFT Purchased!","success"),oi(S.selectedPoolBoostBips),await Promise.all([zt(!0),ut(!0)]),Ea()},onError:u=>{if(!u.cancelled&&u.type!=="user_rejected"){const f=u.message||u.reason||"Transaction failed";h("Buy failed: "+f,"error")}}});else{if(!S.firstAvailableTokenId){h("No NFT selected for sale","error"),un=!1;return}await Ti.sellToPool({poolAddress:c,tokenId:S.firstAvailableTokenId,button:i,onSuccess:async u=>{s&&(s.className="w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden trade-success"),h("ðŸ”´ NFT Sold!","success"),oi(S.selectedPoolBoostBips),await Promise.all([zt(!0),ut(!0)]),Ea()},onError:u=>{if(!u.cancelled&&u.type!=="user_rejected"){const f=u.message||u.reason||"Transaction failed";h("Sell failed: "+f,"error")}}})}}finally{un=!1,setTimeout(async()=>{try{await Promise.all([zt(!0),ut(!0)]),Ea()}catch(u){console.warn("[Store] Post-transaction refresh failed:",u.message)}},2e3),s&&setTimeout(()=>{const u=S.tradeDirection==="buy";s.className=`w-14 h-14 rounded-2xl flex items-center justify-center overflow-hidden ${u?"trade-buy":"trade-sell"}`},800)}}})}const im="https://sepolia.arbiscan.io/tx/",ha={NONE:{boost:0,burnRate:50,keepRate:50,color:"#71717a",name:"None",icon:"â—‹",emoji:"âŒ",class:"tier-none"},BRONZE:{boost:1e3,burnRate:40,keepRate:60,color:"#cd7f32",name:"Bronze",icon:"ðŸ¥‰",emoji:"ðŸ¥‰",class:"tier-bronze"},SILVER:{boost:2500,burnRate:25,keepRate:75,color:"#c0c0c0",name:"Silver",icon:"ðŸ¥ˆ",emoji:"ðŸ¥ˆ",class:"tier-silver"},GOLD:{boost:4e3,burnRate:10,keepRate:90,color:"#ffd700",name:"Gold",icon:"ðŸ¥‡",emoji:"ðŸ¥‡",class:"tier-gold"},DIAMOND:{boost:5e3,burnRate:0,keepRate:100,color:"#b9f2ff",name:"Diamond",icon:"ðŸ’Ž",emoji:"ðŸ’Ž",class:"tier-diamond"}};let li=0,ci=!1,gn=!1,Ma=[],Da=null,ye=0,aa=50,En="none",Tn=0n,Xe=null,pn=0;const ws=3e4;window.handleRewardsClaim=async function(){gn||await mm()};function ad(e){return e>=5e3?ha.DIAMOND:e>=4e3?ha.GOLD:e>=2500?ha.SILVER:e>=1e3?ha.BRONZE:ha.NONE}function rm(e){const t=Math.floor((new Date-e)/1e3);return t<60?"Just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:e.toLocaleDateString()}function sm(){if(document.getElementById("rewards-styles-v6"))return;const e=document.createElement("style");e.id="rewards-styles-v6",e.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V6.9 Rewards Page Styles
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        @keyframes float { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-8px); } 
        }
        @keyframes pulse-glow { 
            0%, 100% { box-shadow: 0 0 30px rgba(34,197,94,0.2); } 
            50% { box-shadow: 0 0 50px rgba(34,197,94,0.4); } 
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .float-animation { animation: float 3s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .celebrate { animation: celebrate 0.6s ease-out; }
        
        .rewards-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.95) 0%, rgba(24,24,27,0.98) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .rewards-card:hover { 
            border-color: rgba(34,197,94,0.3);
        }
        
        /* NFT Tier Badges */
        .tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 24px;
            font-weight: 600;
            font-size: 13px;
            border: 1px solid;
            transition: all 0.3s ease;
        }
        .tier-none { background: rgba(113,113,122,0.15); border-color: rgba(113,113,122,0.3); color: #a1a1aa; }
        .tier-bronze { background: rgba(205,127,50,0.15); border-color: rgba(205,127,50,0.4); color: #cd7f32; }
        .tier-silver { background: rgba(192,192,192,0.15); border-color: rgba(192,192,192,0.4); color: #e5e5e5; }
        .tier-gold { background: rgba(255,215,0,0.15); border-color: rgba(255,215,0,0.4); color: #ffd700; }
        .tier-diamond { background: rgba(185,242,255,0.15); border-color: rgba(185,242,255,0.4); color: #b9f2ff; }
        
        /* Burn Rate Bar */
        .burn-bar {
            height: 10px;
            background: rgba(239,68,68,0.2);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        .burn-bar-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f87171);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        .keep-bar-fill {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #4ade80);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        /* Claim Button */
        .claim-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            font-weight: 700;
            border: none;
            border-radius: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .claim-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(34,197,94,0.3);
        }
        .claim-btn:disabled { 
            background: rgba(63,63,70,0.8);
            color: #71717a;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .claim-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        .claim-btn:hover:not(:disabled)::after {
            left: 100%;
        }
        
        /* History Items */
        .history-item {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        .history-item:hover { 
            background: rgba(63,63,70,0.5);
            transform: translateX(4px);
            border-color: rgba(34,197,94,0.3);
        }
        
        /* Comparison Card */
        .comparison-card {
            background: linear-gradient(145deg, rgba(34,197,94,0.05) 0%, rgba(22,163,74,0.02) 100%);
            border: 1px dashed rgba(34,197,94,0.3);
            border-radius: 12px;
        }
        
        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(39,39,42,0.5); border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(113,113,122,0.5); border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(34,197,94,0.5); }
    `,document.head.appendChild(e)}const Cn={async render(e){sm();const t=document.getElementById("rewards");t&&((t.innerHTML.trim()===""||e)&&(t.innerHTML=dm()),d.isConnected?(Xe&&Date.now()-pn<ws?mn(Xe):um(),this.update(e)):ys())},async update(e=!1){if(!d.isConnected){ys();return}const t=Date.now();if(!e&&Xe&&t-pn<ws){mn(Xe);return}if(!(!e&&ci)){if(!e&&t-li<6e4){Xe&&mn(Xe);return}ci=!0;try{await Wa(),await om(),await lm();const a=await oa();await cm(),Xe={grossRewards:a,claimPreview:Da,userNftBoost:ye,userBurnRate:aa,nftSource:En,claimEthFee:Tn},pn=t,mn(Xe),li=t}catch(a){console.error("Rewards Error:",a)}finally{ci=!1}}},clearCache(){Xe=null,pn=0,li=0,Da=null}};async function om(){try{const e=d.delegationManagerContract||d.delegationManagerContractPublic;if(e&&d.userAddress)try{const a=await e.getUserBestBoost(d.userAddress);ye=Number(a)}catch{const a=await Qt();ye=(a==null?void 0:a.highestBoost)||0,En=(a==null?void 0:a.source)||"none"}else{const a=await Qt();ye=(a==null?void 0:a.highestBoost)||0,En=(a==null?void 0:a.source)||"none"}aa=ad(ye).burnRate}catch(e){console.error("Error loading NFT boost:",e),ye=0,aa=50}}async function lm(){try{const e=d.delegationManagerContract||d.delegationManagerContractPublic;if(e&&d.userAddress){try{const t=await e.previewClaim(d.userAddress);Da={totalRewards:t.totalRewards||t[0]||0n,burnAmount:t.burnAmount||t[1]||0n,userReceives:t.userReceives||t[2]||0n,burnRateBips:t.burnRateBips||t[3]||0n,nftBoost:t.nftBoost||t[4]||0n}}catch{const{stakingRewards:t,minerRewards:a}=await oa(),n=(t||0n)+(a||0n),i=n*BigInt(aa)/100n;Da={totalRewards:n,burnAmount:i,userReceives:n-i,burnRateBips:BigInt(aa*100),nftBoost:BigInt(ye)}}try{Tn=await e.claimEthFee()}catch{Tn=0n}}}catch(e){console.error("Error loading claim preview:",e)}}async function cm(){if(d.userAddress)try{const e=(ze==null?void 0:ze.getHistory)||"https://gethistory-4wvdcuoouq-uc.a.run.app",t=await fetch(`${e}/${d.userAddress}`);if(!t.ok)return;Ma=(await t.json()).filter(n=>n.type==="ClaimReward"||(n.type||"").toUpperCase().includes("CLAIM")).slice(0,10).map(n=>{var i,r,s,o;return{amount:n.amount||((i=n.details)==null?void 0:i.amountReceived)||((r=n.details)==null?void 0:r.amount)||"0",burnedAmount:((s=n.details)==null?void 0:s.burnedAmount)||"0",timestamp:(o=n.timestamp)!=null&&o._seconds?new Date(n.timestamp._seconds*1e3):n.timestamp?new Date(n.timestamp):new Date,txHash:n.txHash||""}})}catch(e){console.warn("Failed to load claim history:",e.message),Ma=[]}}function dm(){return`
        <div class="max-w-lg mx-auto px-4 py-6">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-green-500/20 to-emerald-600/20 border border-green-500/30 flex items-center justify-center">
                        <i class="fa-solid fa-gift text-green-400 text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Rewards</h1>
                        <p class="text-xs text-zinc-500">Claim your staking earnings</p>
                    </div>
                </div>
                <button id="rewards-refresh" onclick="window.RewardsPage.update(true)" 
                        class="w-10 h-10 rounded-xl bg-zinc-800/50 hover:bg-zinc-700 border border-zinc-700/50 flex items-center justify-center transition-all hover:scale-105">
                    <i class="fa-solid fa-rotate text-zinc-400"></i>
                </button>
            </div>
            <div id="rewards-content"></div>
        </div>
    `}function ys(){const e=document.getElementById("rewards-content");e&&(e.innerHTML=`
        <div class="rewards-card flex flex-col items-center justify-center py-16 px-6">
            <div class="w-16 h-16 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-wallet text-2xl text-zinc-600"></i>
            </div>
            <p class="text-zinc-400 font-medium mb-1">Wallet not connected</p>
            <p class="text-zinc-600 text-sm mb-5">Connect to view your rewards</p>
            <button onclick="window.openConnectModal()" 
                class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold text-sm rounded-xl hover:shadow-lg hover:shadow-green-500/25 transition-all">
                <i class="fa-solid fa-wallet mr-2"></i>Connect Wallet
            </button>
        </div>
    `)}function um(){const e=document.getElementById("rewards-content");e&&(e.innerHTML=`
        <div class="rewards-card flex flex-col items-center justify-center py-16">
            <div class="w-14 h-14 rounded-full border-3 border-green-500 border-t-transparent animate-spin mb-4"></div>
            <p class="text-zinc-500 text-sm">Loading rewards...</p>
        </div>
    `)}function mn(e){const t=document.getElementById("rewards-content");if(!t)return;const{grossRewards:a}=e||{},n=(a==null?void 0:a.stakingRewards)||0n,i=(a==null?void 0:a.minerRewards)||0n,r=Da||{},s=r.totalRewards||n+i,o=r.burnAmount||s*BigInt(aa)/100n,l=r.userReceives||s-o,c=Number(s)/1e18,u=Number(o)/1e18,f=Number(l)/1e18,p=Number(n)/1e18,b=Number(i)/1e18,m=Number(Tn)/1e18,x=s>0n,y=ad(ye),C=c,A=c*(y.keepRate/100),N=C-A;t.innerHTML=`
        <div class="space-y-4">
            
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 MAIN CLAIM CARD
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="rewards-card overflow-hidden ${x?"pulse-glow":""}">
                
                <!-- Hero Section -->
                <div class="relative pt-8 pb-6 px-6">
                    <!-- Background glow -->
                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden">
                        <div class="w-64 h-64 ${x?"bg-green-500/10":"bg-zinc-500/5"} rounded-full blur-3xl"></div>
                    </div>
                    
                    <!-- Tier Icon -->
                    <div class="relative flex justify-center mb-5">
                        <div class="text-7xl float-animation">${x?"ðŸŽ":"ðŸ“­"}</div>
                    </div>
                    
                    <!-- Amount Display -->
                    <div class="text-center relative">
                        <p class="text-xs text-zinc-500 uppercase tracking-widest mb-2">You Will Receive</p>
                        <div class="flex items-baseline justify-center gap-2 mb-3">
                            <span class="text-5xl font-black ${x?"text-green-400":"text-zinc-600"}">${f.toFixed(4)}</span>
                            <span class="text-lg font-bold ${x?"text-green-500":"text-zinc-600"}">BKC</span>
                        </div>
                        
                        <!-- Tier Badge -->
                        <div class="tier-badge ${y.class}">
                            <span class="text-lg">${y.emoji}</span>
                            <span>${y.name}</span>
                            <span class="opacity-70">â€¢</span>
                            <span>Keep ${y.keepRate}%</span>
                        </div>
                        
                        ${x&&ye===0&&N>1e-4?`
                        <div class="mt-4 comparison-card p-3">
                            <p class="text-xs text-green-400">
                                <i class="fa-solid fa-lightbulb mr-1 text-amber-400"></i>
                                With ðŸ’Ž Diamond NFT: <span class="font-bold">+${N.toFixed(4)} BKC</span> more!
                            </p>
                        </div>
                        `:""}
                    </div>
                </div>

                <!-- Claim Button -->
                <div class="px-5 pb-5">
                    <button id="claim-btn" onclick="${x?"window.handleRewardsClaim()":""}" 
                        class="claim-btn w-full py-4 text-base flex items-center justify-center gap-2" 
                        ${x?"":"disabled"}>
                        <i id="claim-btn-icon" class="fa-solid ${x?"fa-hand-holding-dollar":"fa-clock"}"></i>
                        <span id="claim-btn-text">${x?"Claim Rewards":"No Rewards Yet"}</span>
                    </button>
                    ${x&&m>0?`
                    <p class="text-center text-[10px] text-zinc-600 mt-2">
                        <i class="fa-brands fa-ethereum mr-1"></i>Claim fee: ${m.toFixed(6)} ETH
                    </p>
                    `:""}
                </div>
            </div>

            ${x?`
            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 BREAKDOWN CARD
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="rewards-card p-5">
                <h3 class="text-sm font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-chart-pie text-zinc-500"></i>
                    Reward Breakdown
                </h3>
                
                <!-- Sources -->
                <div class="space-y-3 mb-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-7 h-7 rounded-lg bg-purple-500/15 flex items-center justify-center">
                                <i class="fa-solid fa-layer-group text-purple-400 text-xs"></i>
                            </div>
                            <span class="text-sm text-zinc-400">Staking Rewards</span>
                        </div>
                        <span class="font-mono text-white">${p.toFixed(4)} BKC</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-7 h-7 rounded-lg bg-amber-500/15 flex items-center justify-center">
                                <i class="fa-solid fa-coins text-amber-400 text-xs"></i>
                            </div>
                            <span class="text-sm text-zinc-400">Miner Rewards</span>
                        </div>
                        <span class="font-mono text-white">${b.toFixed(4)} BKC</span>
                    </div>
                </div>
                
                <div class="border-t border-zinc-800 pt-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-zinc-500">Total Earned</span>
                        <span class="font-mono text-white font-bold">${c.toFixed(4)} BKC</span>
                    </div>
                    
                    <!-- Burn Rate Bar -->
                    <div class="burn-bar my-3">
                        <div class="burn-bar-fill" style="width: ${y.burnRate}%"></div>
                        <div class="keep-bar-fill" style="width: ${y.keepRate}%"></div>
                    </div>
                    <div class="flex justify-between text-[10px] mb-4">
                        <span class="text-red-400/70 flex items-center gap-1">
                            <i class="fa-solid fa-fire"></i> Burned ${y.burnRate}%
                        </span>
                        <span class="text-green-400/70 flex items-center gap-1">
                            <i class="fa-solid fa-check"></i> You Keep ${y.keepRate}%
                        </span>
                    </div>
                    
                    <div class="space-y-2">
                        ${u>0?`
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-red-400/70 flex items-center gap-1.5">
                                <i class="fa-solid fa-fire text-[10px]"></i>
                                Burn Amount
                            </span>
                            <span class="font-mono text-red-400/70">-${u.toFixed(4)} BKC</span>
                        </div>
                        `:""}
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-green-400 font-medium flex items-center gap-1.5">
                                <i class="fa-solid fa-wallet text-[10px]"></i>
                                You Receive
                            </span>
                            <span class="font-mono text-green-400 font-bold">${f.toFixed(4)} BKC</span>
                        </div>
                    </div>
                </div>
            </div>
            `:`
            <!-- Empty State -->
            <div class="rewards-card p-6 text-center">
                <i class="fa-solid fa-seedling text-3xl text-zinc-700 mb-3"></i>
                <p class="text-zinc-500 text-sm mb-2">No rewards to claim yet</p>
                <p class="text-zinc-600 text-xs">
                    <a href="#mine" onclick="window.navigateTo('mine')" class="text-green-400 hover:text-green-300">
                        Stake BKC
                    </a> to start earning rewards
                </p>
            </div>
            `}

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 NFT STATUS
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <div class="rewards-card p-5">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-xl ${ye>0?`bg-gradient-to-br from-${y.class==="tier-diamond"?"cyan":y.class==="tier-gold"?"amber":y.class==="tier-silver"?"gray":y.class==="tier-bronze"?"yellow":"zinc"}-500/20`:"bg-zinc-800"} border border-zinc-700/50 flex items-center justify-center text-2xl">
                            ${y.emoji}
                        </div>
                        <div>
                            <p class="text-white font-semibold">${ye>0?`${y.name} Booster`:"No Booster"}</p>
                            <p class="text-xs text-zinc-500">
                                ${ye>0?`${En==="rented"?"Rented":"Active"} â€¢ Keep ${y.keepRate}%`:"Keep up to 100% with NFT"}
                            </p>
                        </div>
                    </div>
                    
                    ${ye===0?`
                    <a href="#store" onclick="window.navigateTo('store')"
                       class="px-4 py-2 text-xs font-bold bg-gradient-to-r from-amber-500 to-orange-500 text-black rounded-lg hover:shadow-lg hover:shadow-amber-500/25 transition-all">
                        Get NFT
                    </a>
                    `:`
                    <div class="px-3 py-1.5 bg-green-500/10 border border-green-500/20 rounded-full">
                        <span class="text-[10px] text-green-400 font-bold flex items-center gap-1">
                            <i class="fa-solid fa-check"></i> ACTIVE
                        </span>
                    </div>
                    `}
                </div>
                
                ${ye>0&&ye<5e3?`
                <div class="mt-4 pt-4 border-t border-zinc-800">
                    <p class="text-[11px] text-zinc-500">
                        <i class="fa-solid fa-arrow-up text-cyan-400 mr-1"></i>
                        Upgrade to ðŸ’Ž Diamond to keep 100% of rewards (0% burn)
                    </p>
                </div>
                `:""}
            </div>

            <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                 CLAIM HISTORY
                 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
            <details class="rewards-card overflow-hidden group">
                <summary class="p-4 flex items-center justify-between cursor-pointer hover:bg-zinc-800/30 transition-colors">
                    <span class="text-sm text-zinc-400 flex items-center gap-2">
                        <i class="fa-solid fa-clock-rotate-left text-xs"></i>
                        Claim History
                    </span>
                    <i class="fa-solid fa-chevron-down text-zinc-600 text-xs transition-transform group-open:rotate-180"></i>
                </summary>
                <div class="px-4 pb-4 space-y-2 max-h-[250px] overflow-y-auto custom-scrollbar">
                    ${pm()}
                </div>
            </details>
        </div>
    `}function pm(){return Ma.length===0?`
            <div class="text-center py-8">
                <i class="fa-solid fa-inbox text-zinc-700 text-2xl mb-3"></i>
                <p class="text-zinc-600 text-xs">No claims yet</p>
            </div>
        `:Ma.map(e=>{const t=e.amount?(Number(e.amount)/1e18).toFixed(4):"0",a=e.burnedAmount&&Number(e.burnedAmount)>0?(Number(e.burnedAmount)/1e18).toFixed(2):null,n=e.timestamp?rm(new Date(e.timestamp)):"";return`
            <a href="${im}${e.txHash}" target="_blank" 
               class="history-item flex items-center gap-3 p-3">
                <div class="w-9 h-9 rounded-lg bg-green-500/15 flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-gift text-green-400 text-sm"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm text-white font-medium">Claimed Rewards</p>
                    <p class="text-[10px] text-zinc-500">${n}</p>
                </div>
                <div class="text-right flex-shrink-0">
                    <p class="text-sm font-mono font-bold text-green-400">+${t}</p>
                    ${a?`<p class="text-[9px] text-red-400/60">ðŸ”¥ -${a}</p>`:""}
                </div>
                <i class="fa-solid fa-arrow-up-right-from-square text-zinc-600 text-[10px] flex-shrink-0"></i>
            </a>
        `}).join("")}async function mm(){if(gn)return;const e=document.getElementById("claim-btn");if(e){gn=!0;try{await Ft.claimRewards({button:e,onSuccess:t=>{h("ðŸŽ Rewards claimed successfully!","success"),setTimeout(()=>{Cn.clearCache(),Ma=[],Cn.update(!0)},2500)},onError:t=>{t&&!t.cancelled&&t.type!=="user_rejected"&&h(t.message||"Claim failed","error")}})}catch(t){console.error("Claim error:",t),h(t.message||"Claim failed","error")}finally{gn=!1}}}window.RewardsPage=Cn;const kr="https://sepolia.arbiscan.io/tx/",Li="https://sepolia.arbiscan.io/address/",nd="0x16346f5a45f9615f1c894414989f0891c54ef07b",fm=(w==null?void 0:w.fortunePool)||"0x277dB00d533Bbc0fc267bbD954640aDA38ee6B37",In="./assets/fortune.png",Ri=1e3,ks={pt:{title:"Compartilhe & Ganhe!",subtitle:"+1000 pontos para o Airdrop",later:"Talvez depois"},en:{title:"Share & Earn!",subtitle:"+1000 points for Airdrop",later:"Maybe later"},es:{title:"Â¡Comparte y Gana!",subtitle:"+1000 puntos para el Airdrop",later:"QuizÃ¡s despuÃ©s"}},bm={pt:{win:e=>`ðŸŽ‰ Ganhei ${e.toLocaleString()} BKC no Fortune Pool!

ðŸ¯ Loteria on-chain com resultados instantÃ¢neos!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #Arbitrum`,lose:`ðŸ¯ Jogando Fortune Pool no @backcoin!

Loteria on-chain verificÃ¡vel com Oracle seguro!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #Arbitrum`},en:{win:e=>`ðŸŽ‰ Just won ${e.toLocaleString()} BKC on Fortune Pool!

ðŸ¯ On-chain lottery with instant results!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #Arbitrum`,lose:`ðŸ¯ Playing Fortune Pool on @backcoin!

Verifiable on-chain lottery with secure Oracle!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #Arbitrum`},es:{win:e=>`ðŸŽ‰ Â¡GanÃ© ${e.toLocaleString()} BKC en Fortune Pool!

ðŸ¯ Â¡LoterÃ­a on-chain con resultados instantÃ¡neos!

ðŸ‘‰ https://backcoin.org

@backcoin #Backcoin #Web3 #Arbitrum`,lose:`ðŸ¯ Â¡Jugando Fortune Pool en @backcoin!

LoterÃ­a on-chain verificable con Oracle seguro!

ðŸ‘‰ https://backcoin.org

#Backcoin #Web3 #Arbitrum`}},di={pt:"./assets/pt.png",en:"./assets/en.png",es:"./assets/es.png"};let Je="en";const ge=[{id:1,name:"Easy",emoji:"ðŸ€",range:3,multiplier:2,chance:"33%",color:"emerald",hex:"#10b981",bgFrom:"from-emerald-500/20",bgTo:"to-green-600/10",borderColor:"border-emerald-500/50",textColor:"text-emerald-400"},{id:2,name:"Medium",emoji:"âš¡",range:10,multiplier:5,chance:"10%",color:"violet",hex:"#8b5cf6",bgFrom:"from-violet-500/20",bgTo:"to-purple-600/10",borderColor:"border-violet-500/50",textColor:"text-violet-400"},{id:3,name:"Hard",emoji:"ðŸ‘‘",range:100,multiplier:50,chance:"1%",color:"amber",hex:"#f59e0b",bgFrom:"from-amber-500/20",bgTo:"to-orange-600/10",borderColor:"border-amber-500/50",textColor:"text-amber-400"}],id=57,k={mode:null,phase:"select",guess:50,guesses:[2,5,50],comboStep:0,wager:10,gameId:null,result:null,txHash:null,poolStatus:null,history:[],serviceFee:0n,serviceFee1x:0n,serviceFee5x:0n,tiersData:null,commitment:{hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:2,waitStartTime:null,canReveal:!1}};let De=null;const gm=3e3,rd=250;function xm(){if(document.getElementById("fortune-styles-v2"))return;const e=document.createElement("style");e.id="fortune-styles-v2",e.textContent=`
        /* Tiger Mascot Animations */
        @keyframes tiger-float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-12px) rotate(2deg); }
        }
        @keyframes tiger-pulse {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(249,115,22,0.3)); }
            50% { filter: drop-shadow(0 0 40px rgba(249,115,22,0.6)); }
        }
        @keyframes tiger-spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        @keyframes tiger-celebrate {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(10deg); }
            75% { transform: scale(1.15) rotate(-5deg); }
        }
        .tiger-float { animation: tiger-float 4s ease-in-out infinite; }
        .tiger-pulse { animation: tiger-pulse 2s ease-in-out infinite; }
        .tiger-spin { animation: tiger-spin 1s linear infinite; }
        .tiger-celebrate { animation: tiger-celebrate 0.8s ease-out infinite; }
        
        /* Hide number input arrows */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Wager box subtle glow animation */
        @keyframes wager-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(245, 158, 11, 0.15); }
            50% { box-shadow: 0 0 25px rgba(245, 158, 11, 0.3); }
        }
        .wager-box-glow { animation: wager-glow 2s ease-in-out infinite; }
        
        /* Processing Animation */
        @keyframes processing-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.98); }
        }
        .processing-pulse { animation: processing-pulse 1.5s ease-in-out infinite; }
        
        /* Slot Machine Numbers */
        @keyframes slot-spin {
            0% { transform: translateY(-100%); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        .slot-spin { animation: slot-spin 0.1s linear infinite; }
        
        /* Number Reveal */
        @keyframes number-reveal {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(10deg); }
            70% { transform: scale(0.9) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .number-reveal { animation: number-reveal 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; }
        
        /* Match/Miss Animations */
        @keyframes match-pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        .match-pulse { animation: match-pulse 0.8s ease-out 3; }
        
        @keyframes miss-shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .miss-shake { animation: miss-shake 0.5s ease-out; }
        
        /* Glow Effects */
        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px var(--glow-color, rgba(249,115,22,0.3)); }
            50% { box-shadow: 0 0 40px var(--glow-color, rgba(249,115,22,0.6)); }
        }
        .glow-pulse { animation: glow-pulse 1s ease-in-out infinite; }
        
        /* Confetti */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .confetti { 
            position: fixed; 
            pointer-events: none; 
            animation: confetti-fall 3s ease-out forwards;
            z-index: 9999;
        }
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        
        /* Coin Rain */
        @keyframes coin-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .coin {
            position: fixed;
            font-size: 24px;
            pointer-events: none;
            animation: coin-fall 3s ease-out forwards;
            z-index: 9999;
        }
        
        /* Slider Styles */
        .fortune-slider {
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #27272a;
        }
        .fortune-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }
        .fortune-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            cursor: pointer;
            border: none;
        }
        
        /* Waiting Dots */
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .waiting-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        
        /* V2 Badge */
        .v2-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        /* V6.8: Waiting Phase - Countdown Animation */
        @keyframes countdown-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .countdown-pulse { animation: countdown-pulse 1s ease-in-out infinite; }
        
        @keyframes waiting-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        .waiting-glow { animation: waiting-glow 2s ease-in-out infinite; }
        
        @keyframes progress-fill {
            from { width: 0%; }
            to { width: 100%; }
        }
        
        @keyframes block-tick {
            0% { transform: translateY(0); }
            25% { transform: translateY(-2px); }
            50% { transform: translateY(0); }
        }
        .block-tick { animation: block-tick 0.5s ease-out; }
        
        /* Hourglass rotation */
        @keyframes hourglass-spin {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
            100% { transform: rotate(360deg); }
        }
        .hourglass-spin { animation: hourglass-spin 2s ease-in-out infinite; }
    `,document.head.appendChild(e)}function hm(){xm();const e=document.getElementById("actions");if(!e){console.error("âŒ FortunePool: Container #actions not found!");return}e.innerHTML=`
        <div class="max-w-md mx-auto px-4 py-6">
            <!-- Header -->
            <div class="text-center mb-6">
                <div class="relative inline-block">
                    <img id="tiger-mascot" src="${In}" 
                         class="w-28 h-28 object-contain mx-auto tiger-float tiger-pulse" 
                         alt="Fortune Tiger"
                         onerror="this.style.display='none'; document.getElementById('tiger-fallback').style.display='flex';">
                    <div id="tiger-fallback" class="hidden items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-orange-500/20 to-amber-600/10 border border-orange-500/30 mx-auto">
                        <span class="text-5xl">ðŸ¯</span>
                    </div>
                </div>
                <div class="flex items-center justify-center gap-2 mt-2">
                    <h1 class="text-2xl font-bold text-white">Fortune Pool</h1>
                </div>
                <p class="text-zinc-500 text-sm mt-1">ðŸŽ° Instant Results â€¢ Verifiable Randomness</p>
                
                <!-- Contract Verification Links -->
                <div class="flex items-center justify-center gap-2 mt-3 flex-wrap">
                    <a href="${Li}${nd}" target="_blank" rel="noopener" 
                       class="inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-emerald-500/10 border border-emerald-500/30 rounded-full hover:bg-emerald-500/20 transition-colors">
                        <i class="fa-solid fa-shield-halved text-emerald-400 text-[10px]"></i>
                        <span class="text-emerald-400 text-[10px] font-medium">Oracle</span>
                        <i class="fa-solid fa-external-link text-emerald-400/50 text-[8px]"></i>
                    </a>
                    <a href="${Li}${fm}" target="_blank" rel="noopener" 
                       class="inline-flex items-center gap-1.5 px-2.5 py-1.5 bg-amber-500/10 border border-amber-500/30 rounded-full hover:bg-amber-500/20 transition-colors">
                        <i class="fa-solid fa-file-contract text-amber-400 text-[10px]"></i>
                        <span class="text-amber-400 text-[10px] font-medium">Game Contract</span>
                        <i class="fa-solid fa-external-link text-amber-400/50 text-[8px]"></i>
                    </a>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-3 gap-2 mb-6">
                <div class="bg-zinc-900/60 backdrop-blur border border-zinc-800/50 rounded-xl p-3 text-center">
                    <p class="text-[10px] text-zinc-500 uppercase mb-0.5">ðŸ† Prize Pool</p>
                    <p id="prize-pool" class="text-orange-400 font-bold">--</p>
                </div>
                <div class="bg-zinc-900/60 backdrop-blur border border-zinc-800/50 rounded-xl p-3 text-center">
                    <p class="text-[10px] text-zinc-500 uppercase mb-0.5">ðŸ’° Balance</p>
                    <p id="user-balance" class="text-white font-bold">--</p>
                </div>
                <div class="bg-zinc-900/60 backdrop-blur border border-zinc-800/50 rounded-xl p-3 text-center">
                    <p class="text-[10px] text-zinc-500 uppercase mb-0.5">ðŸŽ® Games</p>
                    <p id="total-games" class="text-zinc-300 font-bold">--</p>
                </div>
            </div>

            <!-- Game Area -->
            <div id="game-area" class="mb-6"></div>

            <!-- History -->
            <div class="bg-zinc-900/50 border border-zinc-800/50 rounded-2xl overflow-hidden">
                <div class="flex items-center justify-between p-3 border-b border-zinc-800/50">
                    <span class="text-sm font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-paw text-orange-500 text-xs"></i>
                        Recent Games
                    </span>
                    <span id="win-rate" class="text-xs text-zinc-500"></span>
                </div>
                <div id="history-list" class="max-h-[300px] overflow-y-auto p-2">
                    <div class="p-6 text-center text-zinc-600 text-sm">
                        <img src="${In}" class="w-12 h-12 mx-auto opacity-30 animate-pulse mb-2" onerror="this.style.display='none'">
                        Loading...
                    </div>
                </div>
            </div>
        </div>
    `,Tr(),fe()}function vm(){De&&(clearInterval(De),De=null),k.phase="select",k.result=null,k.commitment={hash:null,userSecret:null,commitBlock:null,commitTxHash:null,revealDelay:k.commitment.revealDelay||2,waitStartTime:null,canReveal:!1}}function fe(){const e=document.getElementById("game-area");if(e)switch(wm(k.phase),k.phase){case"select":Es(e);break;case"pick":ym(e);break;case"wager":Tm(e);break;case"processing":Im(e);break;case"waiting":Am(e);break;case"result":$m(e);break;default:Es(e)}}function wm(e){var a;const t=document.getElementById("tiger-mascot");if(t)switch(t.className="w-28 h-28 object-contain mx-auto",t.style.filter="",e){case"select":t.classList.add("tiger-float","tiger-pulse");break;case"pick":case"wager":t.classList.add("tiger-float");break;case"processing":t.classList.add("tiger-spin");break;case"waiting":t.classList.add("tiger-float"),t.style.filter="hue-rotate(270deg)";break;case"result":((a=k.result)==null?void 0:a.prizeWon)>0?t.classList.add("tiger-celebrate"):(t.style.filter="grayscale(0.5)",t.classList.add("tiger-float"));break}}function Es(e){var i,r;const t=k.serviceFee1x>0n?(Number(k.serviceFee1x)/1e18).toFixed(6):"0",a=k.serviceFee5x>0n?(Number(k.serviceFee5x)/1e18).toFixed(6):"0",n=k.serviceFee1x>0n||k.serviceFee5x>0n;e.innerHTML=`
        <div class="space-y-4">
            <!-- JACKPOT MODE -->
            <button id="btn-jackpot" class="game-mode-card w-full text-left p-5 bg-gradient-to-br from-zinc-900 via-zinc-900 to-amber-950/20 border-2 border-zinc-700/50 rounded-2xl hover:border-amber-500/50 transition-all">
                <div class="flex items-start gap-4">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-500/30 to-orange-600/20 border border-amber-500/30 flex items-center justify-center flex-shrink-0">
                        <span class="text-4xl">ðŸ‘‘</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-1">
                            <h3 class="text-xl font-bold text-white">Jackpot</h3>
                            <span class="px-2.5 py-1 rounded-full bg-amber-500/20 border border-amber-500/40 text-amber-400 text-sm font-black">5000x</span>
                        </div>
                        <p class="text-zinc-400 text-sm mb-3">Pick 1 number from 1-100</p>
                        <div class="flex items-center gap-2 flex-wrap">
                            <div class="flex items-center gap-1.5 px-2.5 py-1 bg-zinc-800/80 rounded-lg">
                                <div class="w-2 h-2 rounded-full bg-amber-500"></div>
                                <span class="text-xs text-zinc-400">1% chance</span>
                            </div>
                            <div class="flex items-center gap-1.5 px-2.5 py-1 bg-zinc-800/80 rounded-lg">
                                <i class="fa-solid fa-bolt text-amber-400 text-[10px]"></i>
                                <span class="text-xs text-amber-400">Big Win</span>
                            </div>
                            ${n?`
                            <div class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                <i class="fa-brands fa-ethereum text-blue-400 text-[10px]"></i>
                                <span class="text-xs text-blue-400">${t} ETH</span>
                            </div>
                            `:""}
                        </div>
                    </div>
                </div>
            </button>

            <!-- COMBO MODE -->
            <button id="btn-combo" class="game-mode-card w-full text-left p-5 bg-gradient-to-br from-zinc-900 via-zinc-900 to-violet-950/20 border-2 border-zinc-700/50 rounded-2xl hover:border-violet-500/50 transition-all">
                <div class="flex items-start gap-4">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-violet-500/30 to-purple-600/20 border border-violet-500/30 flex items-center justify-center flex-shrink-0">
                        <span class="text-4xl">ðŸš€</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-1">
                            <h3 class="text-xl font-bold text-white">Combo</h3>
                            <span class="px-2.5 py-1 rounded-full bg-violet-500/20 border border-violet-500/40 text-violet-400 text-sm font-black">${id}x</span>
                        </div>
                        <p class="text-zinc-400 text-sm mb-3">Pick 3 numbers, win on each match</p>
                        <div class="flex items-center gap-2 flex-wrap">
                            ${ge.map(s=>`
                                <div class="flex items-center gap-1.5 px-2.5 py-1 bg-zinc-800/80 rounded-lg">
                                    <span>${s.emoji}</span>
                                    <span class="text-xs ${s.textColor} font-bold">${s.multiplier}x</span>
                                    <span class="text-xs text-zinc-500">${s.chance}</span>
                                </div>
                            `).join("")}
                            ${n?`
                            <div class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                <i class="fa-brands fa-ethereum text-blue-400 text-[10px]"></i>
                                <span class="text-xs text-blue-400">${a} ETH</span>
                            </div>
                            `:""}
                        </div>
                    </div>
                </div>
            </button>

            ${d.isConnected?"":`
                <div class="p-4 bg-zinc-800/30 rounded-xl border border-zinc-700/50 text-center">
                    <i class="fa-solid fa-wallet text-zinc-600 text-xl mb-2"></i>
                    <p class="text-zinc-500 text-sm">Connect wallet to play</p>
                </div>
            `}
            
            <!-- Oracle Security Info -->
            <div class="p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-xl">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fa-solid fa-shield-halved text-emerald-400"></i>
                    <span class="text-emerald-400 text-sm font-medium">Provably Fair Gaming</span>
                </div>
                <p class="text-zinc-400 text-xs">Results generated by on-chain Oracle. 100% verifiable and tamper-proof.</p>
                <a href="${Li}${nd}" target="_blank" rel="noopener" 
                   class="inline-flex items-center gap-1 text-emerald-400/80 text-xs mt-2 hover:text-emerald-400">
                    <i class="fa-solid fa-external-link text-[10px]"></i>
                    Verify Oracle on Arbiscan
                </a>
            </div>
        </div>
    `,(i=document.getElementById("btn-jackpot"))==null||i.addEventListener("click",()=>{if(!d.isConnected)return h("Connect wallet first","warning");k.mode="jackpot",k.guess=50,k.phase="pick",fe()}),(r=document.getElementById("btn-combo"))==null||r.addEventListener("click",()=>{if(!d.isConnected)return h("Connect wallet first","warning");k.mode="combo",k.guesses=[2,5,50],k.comboStep=0,k.phase="pick",fe()})}function ym(e){k.mode==="jackpot"?km(e):Em(e)}function km(e){var o,l,c,u,f,p,b;const t=ge[2],a=k.guess;e.innerHTML=`
        <div class="bg-gradient-to-br from-zinc-900 to-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5">
            <div class="text-center mb-4">
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r ${t.bgFrom} ${t.bgTo} border ${t.borderColor} rounded-full mb-2">
                    <span class="text-2xl">${t.emoji}</span>
                    <span class="${t.textColor} font-bold">Jackpot Mode</span>
                </div>
                <p class="text-zinc-400 text-sm">Choose your lucky number!</p>
                <p class="text-xs text-zinc-500 mt-1">Range <span class="text-white font-bold">1-100</span> â€¢ Chance <span class="text-emerald-400">1%</span> â€¢ Win <span class="${t.textColor} font-bold">5000x</span></p>
            </div>

            <!-- Number Input with +/- buttons -->
            <div class="flex items-center justify-center gap-3 mb-4">
                <button id="btn-minus-10" class="w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-sm transition-all border border-zinc-700">
                    -10
                </button>
                <button id="btn-minus" class="w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xl transition-all border border-zinc-700">
                    âˆ’
                </button>
                
                <!-- Input com fundo sÃ³lido amber para melhor contraste -->
                <input type="number" id="number-input" min="1" max="100" value="${a}" 
                    class="w-20 h-20 text-center text-3xl font-black rounded-2xl bg-amber-500 border-2 border-amber-400 text-zinc-900 focus:outline-none focus:ring-2 focus:ring-amber-300 appearance-none shadow-lg shadow-amber-500/30"
                    style="-moz-appearance: textfield;">
                
                <button id="btn-plus" class="w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xl transition-all border border-zinc-700">
                    +
                </button>
                <button id="btn-plus-10" class="w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-sm transition-all border border-zinc-700">
                    +10
                </button>
            </div>

            <!-- Slider -->
            <div class="mb-4 px-2">
                <input type="range" id="number-slider" min="1" max="100" value="${a}" 
                    class="fortune-slider w-full h-3 rounded-full appearance-none cursor-pointer"
                    style="background: linear-gradient(to right, ${t.hex} 0%, ${t.hex} ${a}%, #27272a ${a}%, #27272a 100%)">
                <div class="flex justify-between text-xs text-zinc-500 mt-2 px-1">
                    <span>1</span><span>25</span><span>50</span><span>75</span><span>100</span>
                </div>
            </div>
            
            <!-- Quick Select -->
            <div class="flex justify-center gap-2 mb-4 flex-wrap">
                <button class="quick-pick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-number="7">7</button>
                <button class="quick-pick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-number="13">13</button>
                <button class="quick-pick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-number="21">21</button>
                <button class="quick-pick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-number="50">50</button>
                <button class="quick-pick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-number="77">77</button>
                <button class="quick-pick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-number="99">99</button>
                <button id="btn-random" class="px-2.5 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 text-xs rounded-lg border border-amber-500/30 transition-all">
                    <i class="fa-solid fa-dice mr-1"></i>Random
                </button>
            </div>

            <div class="flex gap-3">
                <button id="btn-back" class="flex-1 py-3.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-xl transition-colors">
                    <i class="fa-solid fa-arrow-left mr-2"></i>Previous
                </button>
                <button id="btn-next" class="flex-1 py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black font-bold rounded-xl transition-all">
                    Continue<i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    `;const n=document.getElementById("number-input"),i=document.getElementById("number-slider"),r=ge[2],s=m=>{m=Math.max(1,Math.min(100,m)),k.guess=m,n&&(n.value=m),i&&(i.value=m,i.style.background=`linear-gradient(to right, ${r.hex} 0%, ${r.hex} ${m}%, #27272a ${m}%, #27272a 100%)`)};n==null||n.addEventListener("input",m=>s(parseInt(m.target.value)||1)),n==null||n.addEventListener("blur",m=>s(parseInt(m.target.value)||1)),i==null||i.addEventListener("input",m=>s(parseInt(m.target.value))),(o=document.getElementById("btn-minus"))==null||o.addEventListener("click",()=>s(k.guess-1)),(l=document.getElementById("btn-plus"))==null||l.addEventListener("click",()=>s(k.guess+1)),(c=document.getElementById("btn-minus-10"))==null||c.addEventListener("click",()=>s(k.guess-10)),(u=document.getElementById("btn-plus-10"))==null||u.addEventListener("click",()=>s(k.guess+10)),document.querySelectorAll(".quick-pick").forEach(m=>{m.addEventListener("click",()=>s(parseInt(m.dataset.number)))}),(f=document.getElementById("btn-random"))==null||f.addEventListener("click",()=>{s(Math.floor(Math.random()*100)+1)}),(p=document.getElementById("btn-back"))==null||p.addEventListener("click",()=>{k.phase="select",fe()}),(b=document.getElementById("btn-next"))==null||b.addEventListener("click",()=>{k.phase="wager",fe()})}function Em(e){var r,s,o,l,c,u,f;const t=ge[k.comboStep],a=k.guesses[k.comboStep],n=t.range===100;if(e.innerHTML=`
        <div class="bg-gradient-to-br from-zinc-900 to-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5">
            <!-- Progress Pills -->
            <div class="flex justify-center gap-2 sm:gap-3 mb-5">
                ${ge.map((p,b)=>{const m=b===k.comboStep,x=b<k.comboStep;return`
                        <div class="flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-xl border ${m?`bg-gradient-to-br ${p.bgFrom} ${p.bgTo} ${p.borderColor}`:x?"bg-emerald-500/10 border-emerald-500/50":"bg-zinc-800/50 border-zinc-700/50"}">
                            <span class="text-lg sm:text-xl">${x?"âœ“":p.emoji}</span>
                            <div class="text-left">
                                <p class="text-[10px] sm:text-xs font-bold ${m?p.textColor:x?"text-emerald-400":"text-zinc-500"}">${p.name}</p>
                                <p class="text-[8px] sm:text-[10px] ${x?"text-emerald-400 font-bold":"text-zinc-600"}">${x?k.guesses[b]:p.multiplier+"x"}</p>
                            </div>
                        </div>
                    `}).join("")}
            </div>

            <div class="text-center mb-4">
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r ${t.bgFrom} ${t.bgTo} border ${t.borderColor} rounded-full mb-2">
                    <span class="text-2xl">${t.emoji}</span>
                    <span class="${t.textColor} font-bold">${t.name} Tier</span>
                </div>
                <p class="text-zinc-400 text-sm">Pick <span class="text-white font-bold">1-${t.range}</span> â€¢ <span class="text-emerald-400">${t.chance}</span> â€¢ <span class="${t.textColor} font-bold">${t.multiplier}x</span></p>
            </div>

            ${n?`
                <!-- Hard Tier: Input + Slider (like Jackpot) -->
                <div class="flex items-center justify-center gap-3 mb-4">
                    <button class="combo-minus-10 w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-sm transition-all border border-zinc-700">
                        -10
                    </button>
                    <button class="combo-minus w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xl transition-all border border-zinc-700">
                        âˆ’
                    </button>
                    
                    <!-- Input com fundo sÃ³lido amber para melhor contraste -->
                    <input type="number" id="combo-number-input" min="1" max="100" value="${a}" 
                        class="w-20 h-20 text-center text-3xl font-black rounded-2xl bg-amber-500 border-2 border-amber-400 text-zinc-900 focus:outline-none focus:ring-2 focus:ring-amber-300 appearance-none shadow-lg shadow-amber-500/30"
                        style="-moz-appearance: textfield;">
                    
                    <button class="combo-plus w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-xl transition-all border border-zinc-700">
                        +
                    </button>
                    <button class="combo-plus-10 w-10 h-10 rounded-xl bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white font-bold text-sm transition-all border border-zinc-700">
                        +10
                    </button>
                </div>
                
                <!-- Slider for Hard tier -->
                <div class="mb-4 px-2">
                    <input type="range" id="combo-slider" min="1" max="100" value="${a}" 
                        class="fortune-slider w-full h-3 rounded-full appearance-none cursor-pointer"
                        style="background: linear-gradient(to right, ${t.hex} 0%, ${t.hex} ${a}%, #27272a ${a}%, #27272a 100%)">
                    <div class="flex justify-between text-xs text-zinc-500 mt-2 px-1">
                        <span>1</span><span>25</span><span>50</span><span>75</span><span>100</span>
                    </div>
                </div>
                
                <!-- Quick picks for Hard tier -->
                <div class="flex justify-center gap-2 mb-4 flex-wrap">
                    <button class="combo-quick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="7">7</button>
                    <button class="combo-quick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="13">13</button>
                    <button class="combo-quick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="50">50</button>
                    <button class="combo-quick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="77">77</button>
                    <button class="combo-quick px-2.5 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-400 hover:text-white text-xs rounded-lg transition-all" data-num="99">99</button>
                    <button class="combo-random px-2.5 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 text-amber-400 text-xs rounded-lg border border-amber-500/30 transition-all">
                        <i class="fa-solid fa-dice mr-1"></i>Random
                    </button>
                </div>
            `:`
                <!-- Easy/Medium Tier: Simple number buttons -->
                <div class="flex justify-center gap-2 mb-5 flex-wrap">
                    ${Array.from({length:t.range},(p,b)=>b+1).map(p=>`
                        <button class="num-btn w-12 h-12 rounded-xl font-bold text-lg transition-all ${p===a?`bg-gradient-to-br ${t.bgFrom} ${t.bgTo} border-2 ${t.borderColor} ${t.textColor}`:"bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-zinc-600"}" data-num="${p}">
                            ${p}
                        </button>
                    `).join("")}
                </div>
            `}

            <div class="flex gap-3">
                <button id="btn-back" class="flex-1 py-3.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-xl transition-colors">
                    <i class="fa-solid fa-arrow-left mr-2"></i>${k.comboStep>0?"Previous":"Back"}
                </button>
                <button id="btn-next" class="flex-1 py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black font-bold rounded-xl transition-all">
                    ${k.comboStep<2?"Next":"Continue"}<i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    `,t.range===100){const p=document.getElementById("combo-number-input"),b=document.getElementById("combo-slider"),m=x=>{x=Math.max(1,Math.min(100,x)),k.guesses[k.comboStep]=x,p&&(p.value=x),b&&(b.value=x,b.style.background=`linear-gradient(to right, ${t.hex} 0%, ${t.hex} ${x}%, #27272a ${x}%, #27272a 100%)`)};p==null||p.addEventListener("input",x=>m(parseInt(x.target.value)||1)),p==null||p.addEventListener("blur",x=>m(parseInt(x.target.value)||1)),b==null||b.addEventListener("input",x=>m(parseInt(x.target.value))),(r=document.querySelector(".combo-minus"))==null||r.addEventListener("click",()=>m(k.guesses[k.comboStep]-1)),(s=document.querySelector(".combo-plus"))==null||s.addEventListener("click",()=>m(k.guesses[k.comboStep]+1)),(o=document.querySelector(".combo-minus-10"))==null||o.addEventListener("click",()=>m(k.guesses[k.comboStep]-10)),(l=document.querySelector(".combo-plus-10"))==null||l.addEventListener("click",()=>m(k.guesses[k.comboStep]+10)),document.querySelectorAll(".combo-quick").forEach(x=>{x.addEventListener("click",()=>m(parseInt(x.dataset.num)))}),(c=document.querySelector(".combo-random"))==null||c.addEventListener("click",()=>{m(Math.floor(Math.random()*100)+1)})}else document.querySelectorAll(".num-btn").forEach(p=>{p.addEventListener("click",()=>{const b=parseInt(p.dataset.num);k.guesses[k.comboStep]=b,document.querySelectorAll(".num-btn").forEach(m=>{parseInt(m.dataset.num)===b?m.className=`num-btn w-12 h-12 rounded-xl font-bold text-lg transition-all bg-gradient-to-br ${t.bgFrom} ${t.bgTo} border-2 ${t.borderColor} ${t.textColor}`:m.className="num-btn w-12 h-12 rounded-xl font-bold text-lg transition-all bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-zinc-600"})})});(u=document.getElementById("btn-back"))==null||u.addEventListener("click",()=>{k.comboStep>0?(k.comboStep--,fe()):(k.phase="select",fe())}),(f=document.getElementById("btn-next"))==null||f.addEventListener("click",()=>{k.comboStep<2?(k.comboStep++,fe()):(k.phase="wager",fe())})}function Tm(e){const t=k.mode==="jackpot",a=t?[k.guess]:k.guesses,n=t?50:id,i=M(d.currentUserBalance||0n),r=i>=1,s=t?k.serviceFee1x:k.serviceFee5x,o=s>0n?Number(s)/1e18:0,l=s>0n;e.innerHTML=`
        <div class="bg-gradient-to-br from-zinc-900 to-zinc-800/50 border border-zinc-700/50 rounded-2xl p-5">
            <div class="text-center mb-5">
                <h2 class="text-xl font-bold text-white mb-2">ðŸŽ° Your Selection</h2>
                <div class="flex justify-center gap-3">
                    ${(t?[{tier:ge[2],pick:a[0]}]:a.map((c,u)=>({tier:ge[u],pick:c}))).map(({tier:c,pick:u})=>`
                        <div class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r ${c.bgFrom} ${c.bgTo} border ${c.borderColor} rounded-xl">
                            <span class="text-xl">${c.emoji}</span>
                            <span class="text-2xl font-black ${c.textColor}">${u}</span>
                        </div>
                    `).join("")}
                </div>
            </div>

            <!-- Wager Input - ENHANCED UX -->
            <div class="mb-5">
                <div class="flex items-center justify-between mb-3">
                    <label class="text-sm text-zinc-400 flex items-center gap-2">
                        <i class="fa-solid fa-coins text-amber-400"></i>
                        Wager Amount
                    </label>
                    <span class="text-xs text-zinc-500">Balance: <span class="text-amber-400 font-bold">${i.toFixed(2)}</span> BKC</span>
                </div>
                
                <!-- Main Input with +/- Buttons -->
                <div class="relative p-4 bg-gradient-to-br from-amber-500/10 to-orange-500/5 border-2 border-amber-500/40 rounded-2xl mb-3 hover:border-amber-500/60 transition-all group">
                    <div class="absolute -top-2.5 left-4 px-2 bg-zinc-900">
                        <span class="text-[10px] text-amber-400 font-bold uppercase tracking-wider animate-pulse">âœ¨ Adjust your bet</span>
                    </div>
                    
                    <div class="flex items-center justify-center gap-3">
                        <button id="wager-minus-10" class="w-11 h-11 rounded-xl bg-zinc-800 hover:bg-red-500/20 border border-zinc-700 hover:border-red-500/50 text-zinc-400 hover:text-red-400 font-bold text-sm transition-all active:scale-95">
                            -10
                        </button>
                        <button id="wager-minus" class="w-11 h-11 rounded-xl bg-zinc-800 hover:bg-red-500/20 border border-zinc-700 hover:border-red-500/50 text-zinc-400 hover:text-red-400 font-bold text-2xl transition-all active:scale-95">
                            âˆ’
                        </button>
                        
                        <div class="relative">
                            <input type="number" id="custom-wager" value="${k.wager}" min="1" max="${Math.floor(i)}"
                                class="w-28 h-16 text-center text-3xl font-black rounded-xl bg-zinc-900/80 border-2 border-amber-500/50 text-amber-400 focus:outline-none focus:border-amber-400 focus:ring-2 focus:ring-amber-400/30 transition-all appearance-none"
                                style="-moz-appearance: textfield;">
                            <span class="absolute -bottom-1 left-1/2 -translate-x-1/2 text-[10px] text-zinc-500 bg-zinc-900 px-1">BKC</span>
                        </div>
                        
                        <button id="wager-plus" class="w-11 h-11 rounded-xl bg-zinc-800 hover:bg-emerald-500/20 border border-zinc-700 hover:border-emerald-500/50 text-zinc-400 hover:text-emerald-400 font-bold text-2xl transition-all active:scale-95">
                            +
                        </button>
                        <button id="wager-plus-10" class="w-11 h-11 rounded-xl bg-zinc-800 hover:bg-emerald-500/20 border border-zinc-700 hover:border-emerald-500/50 text-zinc-400 hover:text-emerald-400 font-bold text-sm transition-all active:scale-95">
                            +10
                        </button>
                    </div>
                </div>
                
                <!-- Quick Amount Buttons -->
                <div class="grid grid-cols-5 gap-2">
                    ${[10,25,50,100,Math.floor(i)].map(c=>`
                        <button class="percent-btn py-2.5 text-sm font-bold rounded-xl transition-all ${k.wager===c?"bg-gradient-to-r from-amber-500/30 to-orange-500/20 border-2 border-amber-500/60 text-amber-400 shadow-lg shadow-amber-500/20":"bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-amber-500/30 hover:text-amber-300"}" data-value="${c}">
                            ${c===Math.floor(i)?'<i class="fa-solid fa-fire text-orange-400"></i> MAX':c}
                        </button>
                    `).join("")}
                </div>
            </div>

            <!-- Potential Win -->
            <div class="p-4 bg-gradient-to-r from-emerald-900/20 to-green-900/10 border border-emerald-500/30 rounded-xl mb-4">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs text-zinc-400 mb-1">ðŸ† Max Potential Win</p>
                        <p class="text-3xl font-black text-emerald-400" id="potential-win">${(k.wager*n).toLocaleString()}</p>
                        <p class="text-xs text-emerald-400/60">BKC</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-zinc-400 mb-1">Multiplier</p>
                        <p class="text-2xl font-bold text-white">${n}x</p>
                        <p class="text-[10px] text-zinc-500">${t?"if you match!":"if all match!"}</p>
                    </div>
                </div>
            </div>

            ${l?`
            <!-- Service Fee Info -->
            <div class="p-3 bg-blue-500/10 border border-blue-500/30 rounded-xl mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i class="fa-brands fa-ethereum text-blue-400"></i>
                        <span class="text-sm text-zinc-300">Game Fee</span>
                    </div>
                    <div class="text-right">
                        <span class="text-blue-400 font-bold">${o.toFixed(6)} ETH</span>
                        <p class="text-[10px] text-zinc-500">${t?"1x mode":"5x mode"}</p>
                    </div>
                </div>
            </div>
            `:""}

            ${r?"":`
                <div class="p-3 bg-red-500/10 border border-red-500/30 rounded-xl mb-4 text-center">
                    <p class="text-red-400 text-sm">Insufficient BKC balance</p>
                    <button id="btn-faucet" class="mt-2 px-4 py-2 bg-amber-500/20 border border-amber-500/50 rounded-lg text-amber-400 text-sm font-bold hover:bg-amber-500/30 transition-colors">
                        <i class="fa-solid fa-faucet mr-2"></i>Get Test Tokens
                    </button>
                </div>
            `}

            <div class="flex gap-3">
                <button id="btn-back" class="flex-1 py-3.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-xl transition-colors">
                    <i class="fa-solid fa-arrow-left mr-2"></i>Back
                </button>
                <button id="btn-play" class="flex-1 py-3.5 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black font-bold rounded-xl transition-all ${r?"":"opacity-50 cursor-not-allowed"}" ${r?"":"disabled"}>
                    <i class="fa-solid fa-paw mr-2"></i>Play Now
                </button>
            </div>
        </div>
    `,Cm(n,i)}function Cm(e,t){var n,i,r,s,o,l,c,u;const a=f=>{k.wager=Math.max(1,Math.min(Math.floor(f),Math.floor(t)));const p=document.getElementById("custom-wager"),b=document.getElementById("potential-win");p&&(p.value=k.wager),b&&(b.textContent=(k.wager*e).toLocaleString()),document.querySelectorAll(".percent-btn").forEach(m=>{const x=parseInt(m.dataset.value);k.wager===x?m.className="percent-btn py-2.5 text-sm font-bold rounded-xl transition-all bg-gradient-to-r from-amber-500/30 to-orange-500/20 border-2 border-amber-500/60 text-amber-400 shadow-lg shadow-amber-500/20":m.className="percent-btn py-2.5 text-sm font-bold rounded-xl transition-all bg-zinc-800/60 border border-zinc-700/50 text-zinc-400 hover:border-amber-500/30 hover:text-amber-300"})};document.querySelectorAll(".percent-btn").forEach(f=>{f.addEventListener("click",()=>{a(parseInt(f.dataset.value)||1)})}),(n=document.getElementById("custom-wager"))==null||n.addEventListener("input",f=>{a(parseInt(f.target.value)||1)}),(i=document.getElementById("wager-minus"))==null||i.addEventListener("click",()=>{a(k.wager-1)}),(r=document.getElementById("wager-plus"))==null||r.addEventListener("click",()=>{a(k.wager+1)}),(s=document.getElementById("wager-minus-10"))==null||s.addEventListener("click",()=>{a(k.wager-10)}),(o=document.getElementById("wager-plus-10"))==null||o.addEventListener("click",()=>{a(k.wager+10)}),(l=document.getElementById("btn-faucet"))==null||l.addEventListener("click",async()=>{h("Requesting tokens...","info");try{const p=await(await fetch(`https://faucet-4wvdcuoouq-uc.a.run.app?address=${d.userAddress}`)).json();p.success?(h("ðŸŽ‰ Tokens received!","success"),await Wa(),fe()):h(p.error||"Error","error")}catch{h("Faucet error","error")}}),(c=document.getElementById("btn-back"))==null||c.addEventListener("click",()=>{k.phase="pick",k.mode==="combo"&&(k.comboStep=2),fe()}),(u=document.getElementById("btn-play"))==null||u.addEventListener("click",async()=>{if(k.wager<1)return h("Min: 1 BKC","warning");k.phase="processing",fe();try{const f=k.mode==="jackpot"?[k.guess]:k.guesses,p=k.mode==="combo",b=window.ethers.parseEther(k.wager.toString());await dr.playGame({wagerAmount:b,guesses:f,isCumulative:p,button:document.getElementById("btn-play"),onSuccess:m=>{k.gameId=(m==null?void 0:m.gameId)||Date.now(),k.commitment={hash:null,userSecret:(m==null?void 0:m.userSecret)||null,commitBlock:(m==null?void 0:m.commitBlock)||null,commitTxHash:(m==null?void 0:m.txHash)||null,revealDelay:k.commitment.revealDelay||2,waitStartTime:Date.now(),canReveal:!1},k.txHash=(m==null?void 0:m.txHash)||null,console.log("ðŸ” Game committed:",k.gameId,"Block:",k.commitment.commitBlock),k.phase="waiting",fe(),Bm()},onError:m=>{m.cancelled||h(m.message||"Commit failed","error"),k.phase="wager",fe()}})}catch(f){console.error("Commit error:",f);const p=f.message||f.reason||"Transaction failed";h("Error: "+p,"error"),k.phase="wager",fe()}})}function Im(e){const t=k.mode==="jackpot",a=t?[k.guess]:k.guesses,n=t?[ge[2]]:ge;e.innerHTML=`
        <div class="bg-gradient-to-br from-zinc-900 to-zinc-800/50 border border-zinc-700/50 rounded-2xl p-6 processing-pulse">
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center">
                    <i class="fa-solid fa-dice text-3xl text-amber-400 animate-bounce"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">ðŸŽ° Rolling<span class="waiting-dots"></span></h2>
                <p class="text-zinc-400 text-sm">Transaction processing...</p>
            </div>
            
            <!-- Animated Numbers -->
            <div class="flex justify-center gap-4 mb-6">
                ${n.map((i,r)=>`
                    <div class="text-center">
                        <p class="text-xs text-zinc-500 mb-2">${i.emoji} ${i.name}</p>
                        <div class="w-20 h-24 rounded-2xl bg-gradient-to-br ${i.bgFrom} ${i.bgTo} border-2 ${i.borderColor} flex items-center justify-center overflow-hidden glow-pulse" style="--glow-color: ${i.hex}50">
                            <span class="text-4xl font-black ${i.textColor} slot-spin" id="spin-${r}">?</span>
                        </div>
                    </div>
                `).join("")}
            </div>
            
            <!-- Your Picks -->
            <div class="border-t border-zinc-700/50 pt-5">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">ðŸŽ¯ Your Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((i,r)=>{const s=t?a[0]:a[r];return`
                            <div class="text-center">
                                <div class="w-16 h-16 rounded-xl bg-gradient-to-br ${i.bgFrom} ${i.bgTo} border-2 ${i.borderColor} flex items-center justify-center">
                                    <span class="text-2xl font-black ${i.textColor}">${s}</span>
                                </div>
                            </div>
                        `}).join("")}
                </div>
            </div>
            
            <p class="text-xs text-zinc-500 mt-6 text-center">
                <i class="fa-solid fa-bolt text-emerald-400 mr-1"></i>
                V2: Instant resolution in progress...
            </p>
        </div>
    `,n.forEach((i,r)=>{const s=document.getElementById(`spin-${r}`);if(!s)return;setInterval(()=>{s.textContent=Math.floor(Math.random()*i.range)+1},80)})}function Am(e){var l;const t=k.mode==="jackpot",a=t?[k.guess]:k.guesses,n=t?[ge[2]]:ge,i=Date.now()-(k.commitment.waitStartTime||Date.now()),r=k.commitment.revealDelay*rd,s=Math.max(0,r-i),o=Math.ceil(s/1e3);e.innerHTML=`
        <div class="bg-gradient-to-br from-violet-900/30 to-purple-900/20 border border-violet-500/30 rounded-2xl p-6 waiting-glow">
            
            <!-- Header -->
            <div class="text-center mb-6">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-violet-500/20 to-purple-600/20 border border-violet-500/30 flex items-center justify-center">
                    <i class="fa-solid fa-hourglass-half text-3xl text-violet-400 hourglass-spin"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-1">ðŸ” Commitment Locked</h2>
                <p class="text-violet-300 text-sm">Waiting for blockchain confirmation...</p>
            </div>
            
            <!-- Countdown Display -->
            <div class="bg-zinc-900/50 rounded-xl p-4 mb-4 border border-violet-500/20">
                <div class="text-center">
                    <p class="text-xs text-zinc-500 uppercase mb-2">Time to Reveal</p>
                    <div class="flex items-center justify-center gap-2">
                        <span id="countdown-timer" class="text-4xl font-black text-violet-400 countdown-pulse">~${o}s</span>
                    </div>
                    <div class="mt-3 w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                        <div id="progress-bar" class="h-full bg-gradient-to-r from-violet-500 to-purple-500 rounded-full transition-all duration-1000" 
                             style="width: ${Math.min(100,i/r*100)}%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Block Info -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center border border-zinc-700/50">
                    <p class="text-[10px] text-zinc-500 uppercase mb-1">Commit Block</p>
                    <p class="text-sm font-mono text-white">#${k.commitment.commitBlock||"..."}</p>
                </div>
                <div class="bg-zinc-800/50 rounded-xl p-3 text-center border border-zinc-700/50">
                    <p class="text-[10px] text-zinc-500 uppercase mb-1">Reveal After</p>
                    <p class="text-sm font-mono text-violet-400">#${(k.commitment.commitBlock||0)+k.commitment.revealDelay}</p>
                </div>
            </div>
            
            <!-- Your Locked Numbers -->
            <div class="border-t border-violet-500/20 pt-4 mb-4">
                <p class="text-center text-xs text-zinc-500 uppercase mb-3">ðŸ”’ Your Locked Numbers</p>
                <div class="flex justify-center gap-4">
                    ${n.map((c,u)=>{const f=t?a[0]:a[u];return`
                            <div class="text-center">
                                <div class="w-14 h-14 rounded-xl bg-gradient-to-br ${c.bgFrom} ${c.bgTo} border-2 ${c.borderColor} flex items-center justify-center relative">
                                    <span class="text-xl font-black ${c.textColor}">${f}</span>
                                    <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-violet-500 flex items-center justify-center">
                                        <i class="fa-solid fa-lock text-[8px] text-white"></i>
                                    </div>
                                </div>
                            </div>
                        `}).join("")}
                </div>
            </div>
            
            <!-- Reveal Button (initially disabled) -->
            <button id="btn-reveal" 
                class="w-full py-3 rounded-xl font-bold transition-all ${k.commitment.canReveal?"bg-gradient-to-r from-emerald-500 to-green-500 text-white hover:shadow-lg hover:shadow-emerald-500/30":"bg-zinc-800 text-zinc-500 cursor-not-allowed"}" 
                ${k.commitment.canReveal?"":"disabled"}>
                <i class="fa-solid ${k.commitment.canReveal?"fa-spinner fa-spin":"fa-lock"} mr-2"></i>
                <span id="reveal-btn-text">${k.commitment.canReveal?"Auto-revealing...":"Waiting for blocks..."}</span>
            </button>
            
            <!-- Info -->
            <div class="mt-4 p-3 bg-violet-500/10 rounded-lg border border-violet-500/20">
                <p class="text-[10px] text-violet-300 text-center">
                    <i class="fa-solid fa-shield-halved mr-1"></i>
                    Commit-reveal prevents manipulation. Reveal triggers automatically.
                </p>
            </div>
            
            ${k.commitment.commitTxHash?`
                <div class="text-center mt-3">
                    <a href="${kr}${k.commitment.commitTxHash}" target="_blank" 
                       class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-zinc-400">
                        <i class="fa-solid fa-external-link"></i>
                        View Commit TX
                    </a>
                </div>
            `:""}
        </div>
    `,(l=document.getElementById("btn-reveal"))==null||l.addEventListener("click",()=>{k.commitment.canReveal&&_i()}),Er()}function Er(){if(k.phase!=="waiting")return;const e=document.getElementById("countdown-timer"),t=document.getElementById("progress-bar");if(document.getElementById("btn-reveal"),document.getElementById("reveal-btn-text"),!e)return;const a=Date.now()-(k.commitment.waitStartTime||Date.now()),n=k.commitment.revealDelay*rd,i=Math.max(0,n-a),r=Math.ceil(i/1e3);if(r>0?e.textContent=`~${r}s`:k.commitment.canReveal?e.textContent="Ready!":e.textContent="Verifying on chain...",t){const s=Math.min(100,a/n*100);t.style.width=`${s}%`}k.phase==="waiting"&&setTimeout(Er,1e3)}function Bm(){De&&clearInterval(De),setTimeout(Er,100),De=setInterval(async()=>{if(k.phase!=="waiting"){clearInterval(De);return}try{await Nm()&&!k.commitment.canReveal&&(k.commitment.canReveal=!0,clearInterval(De),De=null,console.log("[FortunePool] canReveal=true, starting auto-reveal..."),zm())}catch(e){console.warn("Reveal check error:",e)}},gm)}async function zm(){if(k.phase!=="waiting")return;const e=document.getElementById("countdown-timer"),t=document.getElementById("btn-reveal"),a=document.getElementById("reveal-btn-text");e&&(e.textContent="Revealing..."),t&&(t.disabled=!0,t.classList.remove("bg-zinc-800","text-zinc-500","cursor-not-allowed"),t.classList.add("bg-gradient-to-r","from-amber-500","to-yellow-500","text-white")),a&&(a.textContent="Auto-revealing...");const n=k.mode==="jackpot"?[k.guess]:k.guesses,i=5,r=2e3;await new Promise(s=>setTimeout(s,3e3));for(let s=1;s<=i;s++){if(k.phase!=="waiting")return;try{const o=d.fortunePoolContractPublic;o&&await o.revealPlay.staticCall(k.gameId,n,k.commitment.userSecret,{from:d.userAddress}),console.log(`[FortunePool] Pre-simulation passed (attempt ${s})`),_i();return}catch(o){const l=o.message||"",c=l.includes("0x92555c0e")||l.includes("BlockhashUnavailable");if(c&&s<i)console.log(`[FortunePool] BlockhashUnavailable, retry in ${r}ms (${s}/${i})`),e&&(e.textContent="Syncing block data..."),await new Promise(u=>setTimeout(u,r));else if(c){console.warn("[FortunePool] Pre-sim retries exhausted, enabling manual button"),Pm();return}else{console.log("[FortunePool] Pre-sim error (non-blockhash), trying direct reveal:",l),_i();return}}}}function Pm(){const e=document.getElementById("btn-reveal"),t=document.getElementById("reveal-btn-text"),a=document.getElementById("countdown-timer");a&&(a.textContent="Ready!"),e&&(e.disabled=!1,e.classList.remove("bg-zinc-800","text-zinc-500","cursor-not-allowed","from-amber-500","to-yellow-500"),e.classList.add("bg-gradient-to-r","from-emerald-500","to-green-500","text-white")),t&&(t.textContent="Reveal & Get Result!")}async function Nm(){if(!d.fortunePoolContractPublic||!k.gameId)return!1;try{const e=await d.fortunePoolContractPublic.getCommitmentStatus(k.gameId);if(!k.commitment.commitBlock)try{const t=await d.fortunePoolContractPublic.getCommitment(k.gameId),a=Number(t.commitBlock);a>0&&(k.commitment.commitBlock=a)}catch{}return e.canReveal===!0}catch{return Date.now()-(k.commitment.waitStartTime||Date.now())>=3e4}}async function _i(){if(!k.commitment.canReveal){h("Not ready to reveal yet!","warning");return}const e=document.getElementById("btn-reveal");try{const t=k.mode==="jackpot"?[k.guess]:k.guesses;await dr.revealPlay({gameId:k.gameId,guesses:t,userSecret:k.commitment.userSecret,button:e,onSuccess:(a,n)=>{De&&clearInterval(De),k.txHash=a.hash,k.result={rolls:(n==null?void 0:n.rolls)||[],prizeWon:(n==null?void 0:n.prizeWon)||0n,matches:(n==null?void 0:n.matches)||[],matchCount:(n==null?void 0:n.matchCount)||0},console.log("ðŸŽ² Game revealed:",k.result),k.phase="result",fe(),Tr()},onError:a=>{if(!a.cancelled){const n=a.message||"";n.includes("0x92555c0e")||n.includes("BlockhashUnavailable")?h("Block data not available yet. RPC will retry automatically.","warning"):h(n||"Reveal failed","error")}e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-dice mr-2"></i>Try Again')}})}catch(t){console.error("Reveal error:",t),h("Reveal failed: "+(t.message||"Unknown error"),"error"),e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-dice mr-2"></i>Try Again')}}function $m(e){var f,p;const t=k.result;if(!t)return fe();const a=k.mode==="jackpot",n=a?[k.guess]:k.guesses,i=t.rolls||[],r=a?[ge[2]]:ge,s=n.map((b,m)=>{const x=i[m]!==void 0?Number(i[m]):null;return x!==null&&x===b}),o=s.filter(b=>b).length,l=t.prizeWon>0||o>0;let c=0;t.prizeWon&&t.prizeWon>0n?c=M(BigInt(t.prizeWon)):o>0&&s.forEach((b,m)=>{if(b){const x=a?ge[2]:ge[m];c+=k.wager*x.multiplier}});const u=typeof c=="number"?c.toLocaleString(void 0,{maximumFractionDigits:2}):c.toLocaleString();e.innerHTML=`
        <div class="bg-gradient-to-br ${l?"from-emerald-900/30 to-green-900/10 border-emerald-500/30":"from-zinc-900 to-zinc-800/50 border-zinc-700/50"} border rounded-2xl p-4 sm:p-6 relative overflow-hidden" id="result-container">
            
            <!-- Result Header -->
            <div class="text-center mb-4">
                ${l?`
                    <div class="text-5xl mb-2">ðŸŽ‰</div>
                    <h2 class="text-2xl font-black text-emerald-400 mb-1">YOU WON!</h2>
                    <p class="text-3xl font-black text-white">${u} BKC</p>
                `:`
                    <div class="text-5xl mb-2">ðŸ˜”</div>
                    <h2 class="text-xl font-bold text-zinc-400 mb-1">No Match</h2>
                    <p class="text-zinc-500 text-sm">Better luck next time!</p>
                `}
            </div>
            
            <!-- Results Grid - Responsive -->
            <div class="grid ${a?"grid-cols-1 max-w-[200px] mx-auto":"grid-cols-3"} gap-2 sm:gap-3 mb-4">
                ${r.map((b,m)=>{const x=a?n[0]:n[m],y=i[m],C=s[m];return`
                        <div class="text-center p-2 sm:p-3 rounded-xl ${C?"bg-emerald-500/20 border border-emerald-500/50":"bg-zinc-800/50 border border-zinc-700/50"}">
                            <p class="text-[10px] text-zinc-500 mb-1">${b.emoji} ${b.name}</p>
                            <div class="flex items-center justify-center gap-2">
                                <div class="text-center">
                                    <p class="text-[8px] text-zinc-600 mb-0.5">YOU</p>
                                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg bg-gradient-to-br ${b.bgFrom} ${b.bgTo} border ${b.borderColor} flex items-center justify-center">
                                        <span class="text-lg sm:text-xl font-black ${b.textColor}">${x}</span>
                                    </div>
                                </div>
                                <span class="text-xl ${C?"text-emerald-400":"text-red-400"}">${C?"=":"â‰ "}</span>
                                <div class="text-center">
                                    <p class="text-[8px] text-zinc-600 mb-0.5">ROLL</p>
                                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg ${C?"bg-emerald-500/30 border-emerald-500":"bg-zinc-700/50 border-zinc-600"} border flex items-center justify-center">
                                        <span class="text-lg sm:text-xl font-black ${C?"text-emerald-400":"text-zinc-300"}">${y!==void 0?y:"?"}</span>
                                    </div>
                                </div>
                            </div>
                            ${C?`<p class="text-emerald-400 text-xs font-bold mt-1">+${b.multiplier}x</p>`:""}
                        </div>
                    `}).join("")}
            </div>
            
            <!-- TX Link -->
            ${k.txHash?`
                <div class="text-center mb-3">
                    <a href="${kr}${k.txHash}" target="_blank" class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-zinc-400">
                        <i class="fa-solid fa-external-link"></i>
                        View Transaction
                    </a>
                </div>
            `:""}
            
            <!-- Share Section (ALWAYS SHOW - win and lose) -->
            <div class="bg-gradient-to-r ${l?"from-amber-500/10 to-orange-500/10 border-amber-500/30":"from-zinc-800/50 to-zinc-700/30 border-zinc-600/30"} border rounded-xl p-3 mb-3">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-9 h-9 rounded-full ${l?"bg-amber-500/20":"bg-zinc-700/50"} flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-gift ${l?"text-amber-400":"text-zinc-400"}"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">${l?"Share Your Win!":"Share & Try Again!"}</p>
                        <p class="text-amber-400 text-xs font-medium">+${Ri} Airdrop Points</p>
                    </div>
                </div>
                <button id="btn-share" class="w-full py-2.5 ${l?"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black":"bg-zinc-700 hover:bg-zinc-600 text-white border border-zinc-600"} font-bold rounded-xl transition-all text-sm">
                    <i class="fa-solid fa-share-nodes mr-2"></i>${l?"Share Now":"Share Anyway"}
                </button>
            </div>
            
            <button id="btn-new-game" class="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-black font-bold rounded-xl transition-all">
                <i class="fa-solid fa-paw mr-2"></i>Play Again
            </button>
        </div>
    `,l&&(Sm(),c>k.wager*10&&Lm()),(f=document.getElementById("btn-new-game"))==null||f.addEventListener("click",()=>{k.phase="select",k.result=null,k.txHash=null,k.gameId=null,fe(),Tr()}),(p=document.getElementById("btn-share"))==null||p.addEventListener("click",()=>{Rm(l,c)})}function Sm(){const e=document.createElement("div");e.className="confetti-container",document.body.appendChild(e);const t=["#f59e0b","#10b981","#8b5cf6","#ec4899","#06b6d4"],a=["â—","â– ","â˜…","ðŸ¯","ðŸŽ‰"];for(let n=0;n<60;n++){const i=document.createElement("div");i.className="confetti",i.style.cssText=`
            left: ${Math.random()*100}%;
            color: ${t[n%t.length]};
            font-size: ${8+Math.random()*12}px;
            animation-delay: ${Math.random()*2}s;
            animation-duration: ${2+Math.random()*2}s;
        `,i.textContent=a[n%a.length],e.appendChild(i)}setTimeout(()=>e.remove(),5e3)}function Lm(){const e=["ðŸª™","ðŸ’°","âœ¨","â­","ðŸŽ‰"];for(let t=0;t<30;t++)setTimeout(()=>{const a=document.createElement("div");a.className="coin",a.textContent=e[Math.floor(Math.random()*e.length)],a.style.left=`${Math.random()*100}%`,a.style.animationDelay=`${Math.random()*.5}s`,a.style.animationDuration=`${2+Math.random()*2}s`,document.body.appendChild(a),setTimeout(()=>a.remove(),4e3)},t*100)}function Rm(e,t){var l,c,u,f,p,b;const a=ks[Je],n=()=>{const m=bm[Je];return e?m.win(t):m.lose},i=`
        <div class="text-center">
            <img src="${In}" class="w-16 h-16 mx-auto mb-2" alt="Fortune Pool" onerror="this.style.display='none'">
            <h3 id="share-modal-title" class="text-lg font-bold text-white">${a.title}</h3>
            <p id="share-modal-subtitle" class="text-amber-400 text-sm font-medium mb-3">${a.subtitle}</p>
            
            <!-- Language Selector with Flag Images -->
            <div class="flex justify-center gap-2 mb-4">
                <button class="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Je==="pt"?"bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50":"bg-zinc-800 border-zinc-700 hover:border-zinc-500"} border" data-lang="pt">
                    <img src="${di.pt}" class="w-5 h-5 rounded-full object-cover" alt="PT">
                    <span class="${Je==="pt"?"text-amber-400":"text-zinc-400"}">PT</span>
                </button>
                <button class="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Je==="en"?"bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50":"bg-zinc-800 border-zinc-700 hover:border-zinc-500"} border" data-lang="en">
                    <img src="${di.en}" class="w-5 h-5 rounded-full object-cover" alt="EN">
                    <span class="${Je==="en"?"text-amber-400":"text-zinc-400"}">EN</span>
                </button>
                <button class="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${Je==="es"?"bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50":"bg-zinc-800 border-zinc-700 hover:border-zinc-500"} border" data-lang="es">
                    <img src="${di.es}" class="w-5 h-5 rounded-full object-cover" alt="ES">
                    <span class="${Je==="es"?"text-amber-400":"text-zinc-400"}">ES</span>
                </button>
            </div>
            
            <!-- Share Buttons -->
            <div class="grid grid-cols-5 gap-2 mb-4">
                <button id="share-twitter" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 rounded-xl transition-all">
                    <i class="fa-brands fa-x-twitter text-lg text-white mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Twitter</span>
                </button>
                <button id="share-telegram" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#0088cc]/20 border border-zinc-700 hover:border-[#0088cc]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-telegram text-lg text-[#0088cc] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Telegram</span>
                </button>
                <button id="share-whatsapp" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#25D366]/20 border border-zinc-700 hover:border-[#25D366]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-whatsapp text-lg text-[#25D366] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">WhatsApp</span>
                </button>
                <button id="share-instagram" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-[#E4405F]/20 border border-zinc-700 hover:border-[#E4405F]/50 rounded-xl transition-all">
                    <i class="fa-brands fa-instagram text-lg text-[#E4405F] mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Instagram</span>
                </button>
                <button id="share-copy" class="flex flex-col items-center justify-center p-2.5 bg-zinc-800/80 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-500 rounded-xl transition-all">
                    <i class="fa-solid fa-copy text-lg text-zinc-400 mb-1"></i>
                    <span class="text-[9px] text-zinc-500">Copy</span>
                </button>
            </div>
            
            <button id="btn-close-share" class="text-zinc-500 hover:text-zinc-300 text-xs">${a.later}</button>
        </div>
    `;Na(i,"max-w-xs");const r=m=>{Je=m;const x=ks[m],y=document.getElementById("share-modal-title"),C=document.getElementById("share-modal-subtitle"),A=document.getElementById("btn-close-share");y&&(y.textContent=x.title),C&&(C.textContent=x.subtitle),A&&(A.textContent=x.later),document.querySelectorAll(".lang-btn").forEach(N=>{const P=N.dataset.lang,z=N.querySelector("span");P===m?(N.className="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all bg-amber-500/20 border-amber-500 ring-1 ring-amber-500/50 border",z&&(z.className="text-amber-400")):(N.className="lang-btn flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-all bg-zinc-800 border-zinc-700 hover:border-zinc-500 border",z&&(z.className="text-zinc-400"))})};document.querySelectorAll(".lang-btn").forEach(m=>{m.addEventListener("click",()=>r(m.dataset.lang))});const s=async m=>{if(!d.userAddress)return!1;try{const y=await(await fetch("https://us-central1-backchain-backand.cloudfunctions.net/trackShare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:d.userAddress,gameId:k.gameId||Date.now(),type:"fortune",platform:m})})).json();return y.success?(h(`ðŸŽ‰ +${y.pointsAwarded||Ri} Airdrop Points!`,"success"),!0):(y.reason==="already_shared"&&console.log("Already shared this game"),!1)}catch(x){return console.error("Share tracking error:",x),h(`ðŸŽ‰ +${Ri} Airdrop Points!`,"success"),!0}},o=async(m,x)=>{await s(m),window.open(x,"_blank"),Ie()};(l=document.getElementById("share-twitter"))==null||l.addEventListener("click",()=>{const m=n();o("twitter",`https://twitter.com/intent/tweet?text=${encodeURIComponent(m)}`)}),(c=document.getElementById("share-telegram"))==null||c.addEventListener("click",()=>{const m=n();o("telegram",`https://t.me/share/url?url=https://backcoin.org&text=${encodeURIComponent(m)}`)}),(u=document.getElementById("share-whatsapp"))==null||u.addEventListener("click",()=>{const m=n();o("whatsapp",`https://wa.me/?text=${encodeURIComponent(m)}`)}),(f=document.getElementById("share-instagram"))==null||f.addEventListener("click",async()=>{const m=n();try{await navigator.clipboard.writeText(m),await s("instagram");const x=`
                <div class="text-center p-2">
                    <i class="fa-brands fa-instagram text-4xl text-[#E4405F] mb-3"></i>
                    <h3 class="text-lg font-bold text-white mb-2">Text Copied!</h3>
                    <p class="text-zinc-400 text-sm mb-4">Now paste it in your Instagram story or post!</p>
                    <div class="bg-zinc-800/50 rounded-xl p-3 mb-4 text-left">
                        <p class="text-zinc-500 text-xs mb-2">Your message:</p>
                        <p class="text-zinc-300 text-xs break-words">${m.slice(0,100)}...</p>
                    </div>
                    <button id="btn-open-instagram" class="w-full py-3 bg-gradient-to-r from-[#833AB4] via-[#E4405F] to-[#FCAF45] text-white font-bold rounded-xl mb-2">
                        <i class="fa-brands fa-instagram mr-2"></i>Open Instagram
                    </button>
                    <button id="btn-close-ig-modal" class="text-zinc-500 hover:text-zinc-300 text-xs">Close</button>
                </div>
            `;Ie(),setTimeout(()=>{var y,C;Na(x,"max-w-xs"),(y=document.getElementById("btn-open-instagram"))==null||y.addEventListener("click",()=>{window.open("https://www.instagram.com/backcoin.bkc/","_blank"),Ie()}),(C=document.getElementById("btn-close-ig-modal"))==null||C.addEventListener("click",Ie)},100)}catch{h("Could not copy text","error"),Ie()}}),(p=document.getElementById("share-copy"))==null||p.addEventListener("click",async()=>{const m=n();try{await navigator.clipboard.writeText(m),h("ðŸ“‹ Copied!","success"),await s("copy")}catch{h("Copy failed","error")}Ie()}),(b=document.getElementById("btn-close-share"))==null||b.addEventListener("click",Ie)}async function _m(){const e=d.fortunePoolContract||d.fortunePoolContractPublic;if(!e)return console.log("No fortune contract available"),null;try{const[t,a,n]=await Promise.all([e.prizePoolBalance().catch(()=>0n),e.gameCounter().catch(()=>0),e.activeTierCount().catch(()=>3)]);let i=0n,r=0n,s=0n;try{i=await e.getRequiredServiceFee(!1),r=await e.getRequiredServiceFee(!0),s=i,console.log(`Service fees: 1x=${Number(i)/1e18} ETH, 5x=${Number(r)/1e18} ETH`)}catch(o){console.log("getRequiredServiceFee failed, using fallback:",o.message);try{s=await e.serviceFee(),i=s,r=s*5n}catch{console.log("Could not fetch service fee")}}k.serviceFee=s,k.serviceFee1x=i,k.serviceFee5x=r;try{const o=await e.revealDelay();k.commitment.revealDelay=Number(o)||2,console.log("revealDelay from contract:",k.commitment.revealDelay)}catch{console.log("Using default revealDelay:",k.commitment.revealDelay)}try{const[o,l]=await e.getAllTiers();k.tiersData=o.map((c,u)=>({range:Number(c),multiplier:Number(l[u])/1e4})),console.log("Tiers from contract:",k.tiersData)}catch{console.log("Using default tiers")}return{prizePool:t||0n,gameCounter:Number(a)||0,serviceFee:s,serviceFee1x:i,serviceFee5x:r,tierCount:Number(n)||3}}catch(t){return console.error("getFortunePoolStatus error:",t),{prizePool:0n,gameCounter:0,serviceFee:0n}}}async function Tr(){try{const e=await _m();if(e){const a=document.getElementById("prize-pool"),n=document.getElementById("total-games");a&&(a.textContent=M(e.prizePool||0n).toFixed(2)+" BKC"),n&&(n.textContent=(e.gameCounter||0).toLocaleString())}const t=document.getElementById("user-balance");t&&(t.textContent=M(d.currentUserBalance||0n).toFixed(2)+" BKC"),Fm()}catch(e){console.error("Pool error:",e)}}async function Fm(){var e;try{const t=ze.fortuneGames||"https://getfortunegames-4wvdcuoouq-uc.a.run.app",a=d.userAddress?`${t}?player=${d.userAddress}&limit=15`:`${t}?limit=15`,i=await(await fetch(a)).json();if(((e=i.games)==null?void 0:e.length)>0){Mm(i.games);const r=i.games.filter(o=>o.isWin||o.prizeWon&&BigInt(o.prizeWon)>0n).length,s=document.getElementById("win-rate");s&&(s.textContent=`ðŸ† ${r}/${i.games.length} wins`)}else{const r=document.getElementById("history-list");r&&(r.innerHTML=`
                <div class="p-8 text-center">
                    <img src="${In}" class="w-16 h-16 mx-auto opacity-20 mb-3" onerror="this.style.display='none'">
                    <p class="text-zinc-500 text-sm">No games yet</p>
                    <p class="text-zinc-600 text-xs mt-1">Be the first to play!</p>
                </div>
            `)}}catch(t){console.error("loadHistory error:",t)}}function Mm(e){const t=document.getElementById("history-list");t&&(t.innerHTML=e.map(a=>{var m;const n=a.isWin||a.prizeWon&&BigInt(a.prizeWon)>0n,i=a.prizeWon?M(BigInt(a.prizeWon)):0,r=a.wagerAmount?M(BigInt(a.wagerAmount)):0,s=a.isCumulative,o=a.rolls||[],l=a.guesses||[],c=a.txHash||a.transactionHash,u=Dm(a.timestamp||a.createdAt),f=a.player?`${a.player.slice(0,6)}...${a.player.slice(-4)}`:"???",p=d.userAddress&&((m=a.player)==null?void 0:m.toLowerCase())===d.userAddress.toLowerCase(),b=c?`${kr}${c}`:null;return`
            <a href="${b||"#"}" target="${b?"_blank":"_self"}" rel="noopener" 
               class="block p-3 rounded-xl mb-2 ${n?"bg-emerald-500/10 border border-emerald-500/30":"bg-zinc-800/30 border border-zinc-700/30"} transition-all hover:scale-[1.01] ${b?"cursor-pointer hover:border-zinc-500":""}" 
               ${b?"":'onclick="return false;"'}>
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">${n?"ðŸ†":"ðŸŽ²"}</span>
                        <span class="text-xs ${p?"text-amber-400 font-bold":"text-zinc-500"}">${p?"You":f}</span>
                        <span class="text-[10px] px-2 py-0.5 rounded-full ${s?"bg-violet-500/20 text-violet-400":"bg-amber-500/20 text-amber-400"}">${s?"Combo":"Jackpot"}</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <span class="text-[10px] text-zinc-600">${u}</span>
                        ${b?'<i class="fa-solid fa-external-link text-[8px] text-zinc-600"></i>':""}
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-zinc-500">Bet: ${r.toFixed(0)}</span>
                        <span class="text-zinc-700">â†’</span>
                        <span class="text-xs ${n?"text-emerald-400 font-bold":"text-zinc-500"}">
                            ${n?`+${i.toFixed(0)} BKC`:"No win"}
                        </span>
                    </div>
                    <div class="flex gap-1">
                        ${(s?ge:[ge[2]]).map((x,y)=>{const C=l[y],A=o[y];return`
                                <div class="w-6 h-6 rounded text-[10px] font-bold flex items-center justify-center ${C!==void 0&&A!==void 0&&Number(C)===Number(A)?"bg-emerald-500/30 text-emerald-400":"bg-zinc-700/50 text-zinc-500"}">
                                    ${A??"?"}
                                </div>
                            `}).join("")}
                    </div>
                </div>
            </a>
        `}).join(""))}function Dm(e){if(!e)return"N/A";try{const t=Date.now();let a;if(typeof e=="number"?a=e>1e12?e:e*1e3:typeof e=="string"?a=new Date(e).getTime():e._seconds?a=e._seconds*1e3:e.seconds?a=e.seconds*1e3:a=new Date(e).getTime(),isNaN(a))return"N/A";const n=t-a;if(n<0)return"Just now";const i=Math.floor(n/6e4),r=Math.floor(n/36e5),s=Math.floor(n/864e5);return i<1?"Just now":i<60?`${i}m ago`:r<24?`${r}h ago`:s<7?`${s}d ago`:new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch(t){return console.error("getTimeAgo error:",t),"N/A"}}const Om={render:hm,cleanup:vm},Hm=()=>{if(document.getElementById("about-styles-v4"))return;const e=document.createElement("style");e.id="about-styles-v4",e.innerHTML=`
        @keyframes pulse-hub {
            0%, 100% { box-shadow: 0 0 20px rgba(251,191,36,0.3), 0 0 40px rgba(251,191,36,0.1); }
            50% { box-shadow: 0 0 40px rgba(251,191,36,0.5), 0 0 80px rgba(251,191,36,0.2); }
        }
        
        @keyframes flow-down {
            0% { transform: translateY(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(100%); opacity: 0; }
        }
        
        @keyframes rotate-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes expand-ring {
            0% { transform: scale(0.8); opacity: 0.8; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .ab-fade-up { animation: fade-in-up 0.6s ease-out forwards; }
        .ab-pulse-hub { animation: pulse-hub 3s ease-in-out infinite; }
        .ab-rotate { animation: rotate-slow 30s linear infinite; }
        
        .ab-section {
            background: linear-gradient(180deg, rgba(24,24,27,0.8) 0%, rgba(9,9,11,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.3);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .ab-card {
            background: rgba(39,39,42,0.5);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .ab-card:hover {
            border-color: rgba(251,191,36,0.4);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .ab-hub {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(251,191,36,0.2) 0%, rgba(9,9,11,1) 70%);
            border: 3px solid #f59e0b;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
        }
        
        .ab-spoke {
            position: relative;
            padding-left: 20px;
        }
        
        .ab-spoke::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 12px;
            height: 2px;
            background: linear-gradient(90deg, #f59e0b, transparent);
        }
        
        .ab-flow-line {
            position: relative;
            height: 40px;
            width: 2px;
            background: rgba(63,63,70,0.5);
            overflow: hidden;
        }
        
        .ab-flow-line::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(180deg, transparent, #f59e0b, transparent);
            animation: flow-down 1.5s linear infinite;
        }
        
        .ab-icon-box {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .ab-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .ab-gradient-text {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .ab-orbit-container {
            position: relative;
            width: 280px;
            height: 280px;
        }
        
        .ab-orbit-ring {
            position: absolute;
            border: 1px dashed rgba(251,191,36,0.3);
            border-radius: 50%;
        }
        
        .ab-orbit-item {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(24,24,27,0.9);
            border: 2px solid;
        }
    `,document.head.appendChild(e)};function Um(){return`
        <div class="text-center mb-8 ab-fade-up">
            <div class="relative inline-block mb-6">
                <div class="absolute inset-0 bg-amber-500/20 rounded-full blur-2xl"></div>
                <img src="./assets/bkc_logo_3d.png" class="w-24 h-24 relative z-10" alt="Backcoin">
            </div>
            
            <h1 class="text-3xl md:text-4xl font-black text-white mb-3">
                The <span class="ab-gradient-text">Backcoin</span> Ecosystem
            </h1>
            
            <p class="text-zinc-400 text-sm max-w-lg mx-auto leading-relaxed mb-4">
                A decentralized economy built on <span class="text-amber-400 font-medium">perpetual growth</span>, 
                where every action creates value and rewards flow back to the community.
            </p>
            
            <div class="flex items-center justify-center gap-3 flex-wrap">
                <span class="ab-badge bg-amber-500/20 text-amber-400">
                    <i class="fa-solid fa-users mr-1"></i>Community-Owned
                </span>
                <span class="ab-badge bg-emerald-500/20 text-emerald-400">
                    <i class="fa-solid fa-infinity mr-1"></i>Self-Sustaining
                </span>
                <span class="ab-badge bg-purple-500/20 text-purple-400">
                    <i class="fa-solid fa-code mr-1"></i>Open Source
                </span>
            </div>
        </div>
    `}function jm(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.1s">
            <div class="absolute top-0 right-0 w-64 h-64 bg-amber-500/5 rounded-full blur-3xl"></div>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-sitemap text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Hub & Spoke Architecture</h2>
                    <p class="text-zinc-500 text-xs">Modular design for infinite scalability</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <!-- Explanation -->
                <div>
                    <p class="text-zinc-400 text-sm leading-relaxed mb-4">
                        Unlike monolithic systems, Backcoin uses a <strong class="text-white">modular architecture</strong>. 
                        The <span class="text-amber-400 font-medium">Hub</span> is the immutable core that manages 
                        fees, rewards, and economy rules. The <span class="text-emerald-400 font-medium">Spokes</span> 
                        are independent services that plug into the Hub.
                    </p>
                    
                    <div class="ab-card bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/30 mb-4">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-brain text-amber-400"></i>
                            <span class="text-white font-bold text-sm">The Hub (EcosystemManager)</span>
                        </div>
                        <ul class="text-zinc-400 text-xs space-y-1">
                            <li>â€¢ Manages all fee configurations</li>
                            <li>â€¢ Controls reward distribution (70/30)</li>
                            <li>â€¢ Handles booster discounts</li>
                            <li>â€¢ Immutable core rules</li>
                        </ul>
                    </div>
                    
                    <div class="ab-card bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border-emerald-500/30">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fa-solid fa-puzzle-piece text-emerald-400"></i>
                            <span class="text-white font-bold text-sm">The Spokes (Services)</span>
                        </div>
                        <ul class="text-zinc-400 text-xs space-y-1">
                            <li>â€¢ Fortune Pool, Notary, NFT Market...</li>
                            <li>â€¢ Each spoke generates fees</li>
                            <li>â€¢ New spokes can be added anytime</li>
                            <li>â€¢ More spokes = More value</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Visual Diagram -->
                <div class="flex justify-center">
                    <div class="ab-orbit-container">
                        <!-- Orbit Rings -->
                        <div class="ab-orbit-ring ab-rotate" style="width: 100%; height: 100%; top: 0; left: 0;"></div>
                        <div class="ab-orbit-ring" style="width: 70%; height: 70%; top: 15%; left: 15%;"></div>
                        
                        <!-- Central Hub -->
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                            <div class="ab-hub ab-pulse-hub">
                                <i class="fa-solid fa-brain text-3xl text-amber-400 mb-1"></i>
                                <span class="text-[10px] font-bold text-white">HUB</span>
                            </div>
                        </div>
                        
                        <!-- Spoke Items -->
                        <div class="ab-orbit-item border-purple-500 bg-purple-500/10" style="top: 5%; left: 50%; transform: translateX(-50%);">
                            <i class="fa-solid fa-clover text-purple-400"></i>
                        </div>
                        <div class="ab-orbit-item border-cyan-500 bg-cyan-500/10" style="top: 50%; right: 5%; transform: translateY(-50%);">
                            <i class="fa-solid fa-stamp text-cyan-400"></i>
                        </div>
                        <div class="ab-orbit-item border-emerald-500 bg-emerald-500/10" style="bottom: 5%; left: 50%; transform: translateX(-50%);">
                            <i class="fa-solid fa-store text-emerald-400"></i>
                        </div>
                        <div class="ab-orbit-item border-blue-500 bg-blue-500/10" style="top: 50%; left: 5%; transform: translateY(-50%);">
                            <i class="fa-solid fa-lock text-blue-400"></i>
                        </div>
                        
                        <!-- Labels -->
                        <span class="absolute text-[9px] text-purple-400 font-medium" style="top: -5px; left: 50%; transform: translateX(-50%);">Fortune</span>
                        <span class="absolute text-[9px] text-cyan-400 font-medium" style="top: 50%; right: -10px; transform: translateY(-50%) rotate(90deg);">Notary</span>
                        <span class="absolute text-[9px] text-emerald-400 font-medium" style="bottom: -5px; left: 50%; transform: translateX(-50%);">Market</span>
                        <span class="absolute text-[9px] text-blue-400 font-medium" style="top: 50%; left: -15px; transform: translateY(-50%) rotate(-90deg);">Staking</span>
                    </div>
                </div>
            </div>
            
            <!-- Growth Promise -->
            <div class="mt-6 p-4 bg-zinc-900/50 rounded-xl border border-zinc-800">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-arrow-trend-up text-emerald-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold text-sm">Perpetual Growth Model</p>
                        <p class="text-zinc-500 text-xs">
                            Every new spoke added to the ecosystem generates more fees, which means more rewards 
                            for stakers. The more the ecosystem grows, the more valuable your stake becomes.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `}function Wm(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.2s">
            <div class="absolute bottom-0 left-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl"></div>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-emerald-500/20">
                    <i class="fa-solid fa-hammer text-emerald-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Mining by Purchase</h2>
                    <p class="text-zinc-500 text-xs">Proof-of-Purchase: Using = Mining</p>
                </div>
            </div>
            
            <p class="text-zinc-400 text-sm leading-relaxed mb-6">
                In Backcoin, <strong class="text-white">using the platform IS mining</strong>. When you buy an NFT Booster, 
                new BKC tokens are minted and distributed. This creates a self-sustaining economy where 
                activity generates real value.
            </p>
            
            <!-- Mining Flow -->
            <div class="ab-card mb-6">
                <p class="text-zinc-500 text-[10px] uppercase font-bold mb-4">How Mining Works</p>
                
                <div class="space-y-4">
                    <!-- Step 1 -->
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-blue-400 font-bold">1</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">You Buy an NFT Booster</p>
                            <p class="text-zinc-500 text-xs">From any liquidity pool (Crystal, Diamond, Gold...)</p>
                        </div>
                        <div class="ab-badge bg-blue-500/20 text-blue-400">
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <div class="ab-flow-line"></div>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-emerald-400 font-bold">2</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">New BKC Tokens Are Minted</p>
                            <p class="text-zinc-500 text-xs">Fresh tokens created from your purchase activity</p>
                        </div>
                        <div class="ab-badge bg-emerald-500/20 text-emerald-400">
                            <i class="fa-solid fa-coins"></i>
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <div class="ab-flow-line"></div>
                    </div>
                    
                    <!-- Step 3 -->
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                            <span class="text-purple-400 font-bold">3</span>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium text-sm">Rewards Distributed</p>
                            <p class="text-zinc-500 text-xs">70% to stakers, 30% to treasury for development</p>
                        </div>
                        <div class="ab-badge bg-purple-500/20 text-purple-400">
                            <i class="fa-solid fa-gift"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Distribution Cards -->
            <div class="grid grid-cols-2 gap-4">
                <div class="ab-card text-center bg-gradient-to-br from-purple-500/10 to-violet-500/10 border-purple-500/30">
                    <div class="text-4xl font-black text-purple-400 mb-2">70%</div>
                    <p class="text-white font-bold text-sm">Staker Rewards</p>
                    <p class="text-zinc-500 text-[10px]">Distributed to all delegators based on pStake</p>
                </div>
                <div class="ab-card text-center bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border-blue-500/30">
                    <div class="text-4xl font-black text-blue-400 mb-2">30%</div>
                    <p class="text-white font-bold text-sm">Treasury</p>
                    <p class="text-zinc-500 text-[10px]">Funds development and ecosystem growth</p>
                </div>
            </div>
            
            <!-- Key Insight -->
            <div class="mt-4 p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl">
                <div class="flex items-start gap-3">
                    <i class="fa-solid fa-lightbulb text-amber-400 mt-0.5"></i>
                    <div>
                        <p class="text-amber-400 font-bold text-sm">The Flywheel Effect</p>
                        <p class="text-zinc-400 text-xs">
                            More users buying NFTs â†’ More mining â†’ More rewards for stakers â†’ 
                            Higher APY attracts more stakers â†’ More demand for BKC â†’ Cycle repeats!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `}function Gm(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.3s">
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-cyan-500/20">
                    <i class="fa-solid fa-arrows-split-up-and-left text-cyan-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Fee Distribution</h2>
                    <p class="text-zinc-500 text-xs">Every fee benefits the community</p>
                </div>
            </div>
            
            <p class="text-zinc-400 text-sm leading-relaxed mb-6">
                All platform fees are split between <span class="text-purple-400 font-medium">stakers</span> and 
                the <span class="text-blue-400 font-medium">treasury</span>. This means using the platform 
                directly rewards those who secure it.
            </p>
            
            <!-- Fee Sources -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-lock text-purple-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">Staking Fees</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Entry, unstake, claim</p>
                </div>
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-store text-emerald-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">NFT Trading</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Buy & sell taxes</p>
                </div>
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-clover text-green-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">Fortune Pool</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Game participation</p>
                </div>
                <div class="ab-card p-3">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fa-solid fa-stamp text-violet-400 text-sm"></i>
                        <span class="text-white text-xs font-medium">Notarization</span>
                    </div>
                    <p class="text-zinc-500 text-[10px]">Document fees</p>
                </div>
            </div>
            
            <!-- Flow Diagram -->
            <div class="ab-card bg-zinc-900/50">
                <div class="flex items-center justify-between">
                    <div class="text-center flex-1">
                        <div class="w-12 h-12 mx-auto rounded-full bg-amber-500/20 flex items-center justify-center mb-2">
                            <i class="fa-solid fa-coins text-amber-400"></i>
                        </div>
                        <p class="text-white text-xs font-medium">All Fees</p>
                        <p class="text-zinc-600 text-[10px]">100%</p>
                    </div>
                    
                    <div class="flex-1 flex flex-col items-center">
                        <div class="w-full h-0.5 bg-gradient-to-r from-amber-500 via-zinc-600 to-purple-500"></div>
                        <i class="fa-solid fa-arrow-right text-zinc-600 my-2"></i>
                    </div>
                    
                    <div class="flex-1 space-y-2">
                        <div class="flex items-center gap-2 p-2 bg-purple-500/10 rounded-lg">
                            <div class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-users text-purple-400 text-xs"></i>
                            </div>
                            <div>
                                <p class="text-purple-400 text-xs font-bold">70%</p>
                                <p class="text-zinc-500 text-[10px]">Stakers</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-blue-500/10 rounded-lg">
                            <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-building-columns text-blue-400 text-xs"></i>
                            </div>
                            <div>
                                <p class="text-blue-400 text-xs font-bold">30%</p>
                                <p class="text-zinc-500 text-[10px]">Treasury</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `}function Km(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.4s">
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-violet-500/20">
                    <i class="fa-solid fa-rocket text-violet-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Infinite Growth Potential</h2>
                    <p class="text-zinc-500 text-xs">The ecosystem expands forever</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Current Spokes -->
                <div class="ab-card">
                    <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3">Current Spokes</p>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">Staking & Delegation</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">NFT Marketplace</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">Fortune Pool (Lottery)</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">Decentralized Notary</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-emerald-500/10 rounded-lg">
                            <i class="fa-solid fa-check-circle text-emerald-400"></i>
                            <span class="text-white text-xs">NFT Rental (AirBNFT)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Future Spokes -->
                <div class="ab-card">
                    <p class="text-zinc-500 text-[10px] uppercase font-bold mb-3">Future Possibilities</p>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">Prediction Markets</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">Lending Protocol</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">DAO Governance</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg">
                            <i class="fa-solid fa-clock text-amber-400"></i>
                            <span class="text-white text-xs">Launchpad</span>
                        </div>
                        <div class="flex items-center gap-2 p-2 bg-zinc-700/30 rounded-lg border border-dashed border-zinc-600">
                            <i class="fa-solid fa-plus text-zinc-500"></i>
                            <span class="text-zinc-500 text-xs">Your Idea Here...</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Open for Developers -->
            <div class="ab-card bg-gradient-to-r from-violet-500/10 to-purple-500/10 border-violet-500/30">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-12 h-12 rounded-xl bg-violet-500/20 flex items-center justify-center">
                        <i class="fa-solid fa-code text-violet-400 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-white font-bold">Open for Developers</p>
                        <p class="text-zinc-500 text-xs">Build your own spoke and earn from it</p>
                    </div>
                </div>
                <p class="text-zinc-400 text-xs leading-relaxed">
                    Anyone can propose and build new spokes for the Backcoin ecosystem. 
                    Your spoke generates fees, which benefit both you and all stakers. 
                    The more useful your service, the more the entire ecosystem grows.
                </p>
            </div>
        </div>
    `}function Ym(){return`
        <div class="ab-section ab-fade-up" style="animation-delay: 0.5s">
            <div class="flex items-center gap-3 mb-6">
                <div class="ab-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-star text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold text-xl">Why Backcoin?</h2>
                    <p class="text-zinc-500 text-xs">What makes us different</p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="ab-card text-center">
                    <div class="text-4xl mb-3">ðŸ›ï¸</div>
                    <h3 class="text-white font-bold mb-2">No VCs, No Pre-mine</h3>
                    <p class="text-zinc-500 text-xs">
                        35% of TGE goes directly to the community via airdrop. 
                        No investors dumping on you.
                    </p>
                </div>
                
                <div class="ab-card text-center">
                    <div class="text-4xl mb-3">âš¡</div>
                    <h3 class="text-white font-bold mb-2">Real Utility</h3>
                    <p class="text-zinc-500 text-xs">
                        Not just another token. Notarize documents, play games, 
                        rent NFTs - actual use cases.
                    </p>
                </div>
                
                <div class="ab-card text-center">
                    <div class="text-4xl mb-3">â™¾ï¸</div>
                    <h3 class="text-white font-bold mb-2">Sustainable APY</h3>
                    <p class="text-zinc-500 text-xs">
                        Rewards come from real fees, not inflation. 
                        The more the ecosystem is used, the higher the APY.
                    </p>
                </div>
            </div>
        </div>
    `}function Vm(){return`
        <div class="ab-section ab-fade-up text-center bg-gradient-to-b from-amber-500/5 to-transparent" style="animation-delay: 0.6s">
            <img src="./assets/bkc_logo_3d.png" class="w-16 h-16 mx-auto mb-4 opacity-80" alt="BKC">
            
            <h2 class="text-2xl font-bold text-white mb-2">Ready to Join?</h2>
            <p class="text-zinc-400 text-sm mb-6 max-w-md mx-auto">
                Start earning airdrop points today. Every action counts towards the upcoming distribution.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <button onclick="window.navigateTo && window.navigateTo('staking')" 
                    class="px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-black font-bold rounded-xl hover:scale-105 transition-transform">
                    <i class="fa-solid fa-lock mr-2"></i>Start Staking
                </button>
                <button id="openWhitepaperBtn" 
                    class="px-6 py-3 bg-zinc-800 text-white font-bold rounded-xl border border-zinc-700 hover:border-amber-500/50 transition-colors">
                    <i class="fa-solid fa-file-lines mr-2"></i>Read Whitepaper
                </button>
            </div>
        </div>
    `}function qm(){return`
        <div id="whitepaperModal" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
            <div class="ab-card bg-zinc-900 border-zinc-700 w-full max-w-md transform scale-95 transition-transform duration-300">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-white">Documentation</h3>
                    <button id="closeWhitepaperBtn" class="text-zinc-500 hover:text-white transition-colors">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-3">
                    <a href="./assets/Backchain ($BKC) en V2.pdf" target="_blank" 
                        class="flex items-center gap-4 p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-amber-500/50 transition-all group">
                        <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-coins text-amber-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm group-hover:text-amber-400 transition-colors">Tokenomics Paper</p>
                            <p class="text-zinc-500 text-xs">Distribution & Economics</p>
                        </div>
                        <i class="fa-solid fa-download text-zinc-600 group-hover:text-white"></i>
                    </a>
                    
                    <a href="./assets/whitepaper_bkc_ecosystem_english.pdf" target="_blank" 
                        class="flex items-center gap-4 p-4 rounded-xl bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-cyan-500/50 transition-all group">
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                            <i class="fa-solid fa-network-wired text-cyan-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold text-sm group-hover:text-cyan-400 transition-colors">Technical Whitepaper</p>
                            <p class="text-zinc-500 text-xs">Architecture & Smart Contracts</p>
                        </div>
                        <i class="fa-solid fa-download text-zinc-600 group-hover:text-white"></i>
                    </a>
                </div>
            </div>
        </div>
    `}function Fi(){const e=document.getElementById("openWhitepaperBtn"),t=document.getElementById("closeWhitepaperBtn"),a=document.getElementById("whitepaperModal");if(!a)return;const n=()=>{a.classList.remove("hidden"),setTimeout(()=>{a.classList.remove("opacity-0"),a.querySelector(".ab-card").classList.remove("scale-95"),a.querySelector(".ab-card").classList.add("scale-100")},10)},i=()=>{a.classList.add("opacity-0"),a.querySelector(".ab-card").classList.remove("scale-100"),a.querySelector(".ab-card").classList.add("scale-95"),setTimeout(()=>a.classList.add("hidden"),300)};e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",i),a==null||a.addEventListener("click",r=>{r.target===a&&i()})}function Xm(){const e=document.getElementById("about");e&&(Hm(),e.innerHTML=`
        <div class="max-w-3xl mx-auto px-4 py-8 pb-24">
            ${Um()}
            ${jm()}
            ${Wm()}
            ${Gm()}
            ${Km()}
            ${Ym()}
            ${Vm()}
            ${qm()}
            
            <!-- Footer -->
            <div class="text-center py-6 text-zinc-600 text-xs">
                <p>Built by the community, for the community</p>
                <p class="mt-1">BACKCOIN Â© 2024-2025</p>
            </div>
        </div>
    `,Fi(),e.scrollIntoView({behavior:"smooth",block:"start"}))}const Jm={render:Xm,init:Fi,update:Fi},Mi="#BKC #Backcoin #Airdrop",sd=2,od={faucet:{icon:"ðŸš°",label:"Claim Faucet",points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{icon:"ðŸ“Š",label:"Delegate BKC",points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{icon:"ðŸŽ°",label:"Play Fortune",points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{icon:"ðŸ›’",label:"Buy NFT",points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{icon:"ðŸ’°",label:"Sell NFT",points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{icon:"ðŸ·ï¸",label:"List for Rent",points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{icon:"â°",label:"Rent NFT",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{icon:"ðŸ“œ",label:"Notarize Doc",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{icon:"ðŸ’¸",label:"Claim Rewards",points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{icon:"â†©ï¸",label:"Unstake",points:500,maxCount:10,cooldownHours:0,enabled:!0}},Zm={faucet:"faucet",delegation:"tokenomics",fortune:"fortune",buyNFT:"marketplace",sellNFT:"marketplace",listRental:"rentals",rentNFT:"rentals",notarize:"notary",claimReward:"tokenomics",unstake:"tokenomics"},pt=[{name:"Diamond",icon:"ðŸ’Ž",ranks:"#1 â€“ #5",count:5,color:"cyan",burn:"0%",receive:"100%",gradient:"from-cyan-500/20 to-cyan-900/10",border:"border-cyan-500/30",text:"text-cyan-300"},{name:"Gold",icon:"ðŸ¥‡",ranks:"#6 â€“ #25",count:20,color:"yellow",burn:"10%",receive:"90%",gradient:"from-yellow-500/20 to-yellow-900/10",border:"border-yellow-500/30",text:"text-yellow-400"},{name:"Silver",icon:"ðŸ¥ˆ",ranks:"#26 â€“ #75",count:50,color:"gray",burn:"25%",receive:"75%",gradient:"from-gray-400/20 to-gray-800/10",border:"border-gray-400/30",text:"text-gray-300"},{name:"Bronze",icon:"ðŸ¥‰",ranks:"#76 â€“ #200",count:125,color:"amber",burn:"40%",receive:"60%",gradient:"from-amber-600/20 to-amber-900/10",border:"border-amber-600/30",text:"text-amber-500"}],na=200;function Qm(e){if(!e||e<=0)return"Ready";const t=Math.floor(e/(1e3*60*60)),a=Math.floor(e%(1e3*60*60)/(1e3*60));return t>0?`${t}h ${a}m`:`${a}m`}const Ts=[{title:"ðŸš€ Share & Earn!",subtitle:"Post on social media and win exclusive NFT Boosters"},{title:"ðŸ’Ž Top 5 Get Diamond NFTs!",subtitle:"0% burn rate â€” keep 100% of your mining rewards"},{title:"ðŸ“± Post. Share. Earn.",subtitle:"It's that simple â€” spread the word and climb the ranks"},{title:"ðŸ”¥ Go Viral, Get Rewarded!",subtitle:"The more you post, the higher your tier"},{title:"ðŸŽ¯ 200 NFTs Up For Grabs!",subtitle:"Diamond, Gold, Silver & Bronze â€” every post counts"},{title:"ðŸ† 4 Tiers of NFT Rewards!",subtitle:"From Bronze (60% rewards) to Diamond (100% rewards)"},{title:"ðŸ“ˆ Your Posts = Your Rewards!",subtitle:"Each submission brings you closer to the top"},{title:"â­ Be a Backcoin Ambassador!",subtitle:"Share our vision and earn exclusive NFT boosters"}];function ef(){return Ts[Math.floor(Math.random()*Ts.length)]}function tf(e){return e>=100?10:e>=90?9:e>=80?8:e>=70?7:e>=60?6:e>=50?5:e>=40?4:e>=30?3:e>=20?2:1}let $={isConnected:!1,systemConfig:null,platformUsageConfig:null,basePoints:null,leaderboards:null,user:null,dailyTasks:[],userSubmissions:[],platformUsage:{},isBanned:!1,activeTab:"earn",activeEarnTab:"post",activeRanking:"points",isGuideOpen:!1};function af(){if(document.getElementById("airdrop-custom-styles"))return;const e=document.createElement("style");e.id="airdrop-custom-styles",e.textContent=`
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }
        
        @keyframes float-slow {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.02); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.2); }
            50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.4); }
        }
        
        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes fade-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        @keyframes slide-in {
            from { opacity: 0; transform: translateX(-12px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes count-up {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes glow-pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
        
        .airdrop-float { animation: float 4s ease-in-out infinite; }
        .airdrop-float-slow { animation: float-slow 3s ease-in-out infinite; }
        .airdrop-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .airdrop-bounce { animation: bounce-gentle 2s ease-in-out infinite; }
        .airdrop-spin { animation: spin-slow 20s linear infinite; }
        .airdrop-fade-up { animation: fade-up 0.5s ease-out forwards; }
        .airdrop-pulse-ring { animation: pulse-ring 2s infinite; }
        .airdrop-slide-in { animation: slide-in 0.4s ease-out forwards; }
        .airdrop-glow { animation: glow-pulse 2s ease-in-out infinite; }
        
        .airdrop-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
            background-size: 200% 100%;
            animation: shimmer 2.5s infinite;
        }
        
        .airdrop-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .airdrop-card:hover {
            transform: translateY(-3px);
        }
        
        .airdrop-tab-active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-weight: 700;
        }
        
        .airdrop-gradient-text {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .social-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .social-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .social-btn:active {
            transform: scale(0.95);
        }
        
        .cta-mega {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.25);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .cta-mega:hover {
            box-shadow: 0 12px 40px rgba(245, 158, 11, 0.35);
            transform: translateY(-2px);
        }
        
        .earn-tab-btn { transition: all 0.2s ease; }
        .earn-tab-btn.active {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border-color: #f59e0b;
        }
        
        .platform-action-card { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .platform-action-card:hover:not(.completed) { transform: translateY(-3px); border-color: #f59e0b; box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .platform-action-card.completed { opacity: 0.5; cursor: default; }
        
        .progress-bar-bg { background: rgba(63, 63, 70, 0.5); }
        .progress-bar-fill {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .scroll-area::-webkit-scrollbar { width: 4px; }
        .scroll-area::-webkit-scrollbar-track { background: transparent; }
        .scroll-area::-webkit-scrollbar-thumb { background: rgba(113, 113, 122, 0.5); border-radius: 2px; }

        /* V5.0: Tier card hover effects */
        .tier-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .tier-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.03) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .tier-card:hover::before { opacity: 1; }
        .tier-card:hover { transform: translateY(-2px) scale(1.01); }

        /* V5.0: Stat counter animation */
        .stat-value {
            animation: count-up 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* V5.0: Rank badge */
        .rank-badge {
            position: relative;
            overflow: hidden;
        }
        .rank-badge::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(transparent, rgba(255,255,255,0.1), transparent);
            animation: spin-slow 8s linear infinite;
        }

        /* V5.0: Step indicator */
        .step-connector {
            position: absolute;
            left: 13px;
            top: 28px;
            bottom: -12px;
            width: 2px;
            background: linear-gradient(to bottom, #f59e0b, rgba(245,158,11,0.1));
        }
    `,document.head.appendChild(e)}async function ma(){var e;$.isConnected=d.isConnected,$.user=null,$.userSubmissions=[],$.platformUsage={},$.isBanned=!1;try{const t=await qi();if($.systemConfig=t.config,$.leaderboards=t.leaderboards,$.dailyTasks=t.dailyTasks||[],$.platformUsageConfig=t.platformUsageConfig||od,$.isConnected&&d.userAddress){const[a,n]=await Promise.all([ya(d.userAddress),Ju()]);if($.user=a,$.userSubmissions=n,a&&a.isBanned){$.isBanned=!0;return}try{typeof Qr=="function"&&($.platformUsage=await Qr()||{})}catch(i){console.warn("Could not load platform usage:",i),$.platformUsage={}}$.dailyTasks.length>0&&($.dailyTasks=await Promise.all($.dailyTasks.map(async i=>{try{if(!i.id)return{...i,eligible:!1,timeLeftMs:0};const r=await oo(i.id,i.cooldownHours);return{...i,eligible:r.eligible,timeLeftMs:r.timeLeft}}catch{return{...i,eligible:!1,timeLeftMs:0}}})))}}catch(t){if(console.error("Airdrop Data Load Error:",t),t.code==="permission-denied"||(e=t.message)!=null&&e.includes("permission")){console.warn("Firebase permissions issue - user may need to connect wallet or sign in"),$.systemConfig=$.systemConfig||{},$.leaderboards=$.leaderboards||{top100ByPoints:[],top100ByPosts:[]},$.dailyTasks=$.dailyTasks||[];return}h("Error loading data. Please refresh.","error")}}function nf(e){if(!$.user||!e||e.length===0)return null;const t=e.findIndex(a=>{var n,i;return((n=a.walletAddress)==null?void 0:n.toLowerCase())===((i=$.user.walletAddress)==null?void 0:i.toLowerCase())});return t>=0?t+1:null}function rf(e){return e?e<=5?pt[0]:e<=25?pt[1]:e<=75?pt[2]:e<=200?pt[3]:null:null}function ld(){var l;const{user:e}=$,t=(e==null?void 0:e.totalPoints)||0,a=(e==null?void 0:e.platformUsagePoints)||0,n=(e==null?void 0:e.approvedSubmissionsCount)||0,i=tf(n),r=((l=$.leaderboards)==null?void 0:l.top100ByPosts)||[],s=nf(r),o=rf(s);return`
        <!-- Mobile Header -->
        <div class="md:hidden px-4 pt-4 pb-2">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 airdrop-float-slow">
                        <img src="./assets/airdrop.png" alt="Airdrop" class="w-full h-full object-contain drop-shadow-lg">
                    </div>
                    <div>
                        <h1 class="text-lg font-black text-white leading-none">Airdrop</h1>
                        <span class="text-[9px] text-zinc-500">${na} NFTs â€¢ 4 Tiers</span>
                    </div>
                </div>
                <a href="https://t.me/BackCoinorg" target="_blank" 
                   class="w-8 h-8 rounded-full bg-sky-500/10 border border-sky-500/30 flex items-center justify-center text-sky-400 text-sm">
                    <i class="fa-brands fa-telegram"></i>
                </a>
            </div>
            
            ${$.isConnected?`
            <!-- Stats Row Mobile â€” V5.0 Compact -->
            <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-2.5 mb-3">
                <div class="grid grid-cols-4 gap-2">
                    <div class="text-center">
                        <span class="text-sm font-bold text-amber-400 stat-value">${t.toLocaleString()}</span>
                        <p class="text-[7px] text-zinc-500 uppercase tracking-wider">Points</p>
                    </div>
                    <div class="text-center">
                        <span class="text-sm font-bold text-green-400 stat-value">${n}</span>
                        <p class="text-[7px] text-zinc-500 uppercase tracking-wider">Posts</p>
                    </div>
                    <div class="text-center">
                        <span class="text-sm font-bold text-purple-400 stat-value">${i.toFixed(1)}x</span>
                        <p class="text-[7px] text-zinc-500 uppercase tracking-wider">Boost</p>
                    </div>
                    <div class="text-center">
                        ${o?`
                            <span class="text-sm font-bold ${o.text} stat-value">${o.icon}</span>
                            <p class="text-[7px] text-zinc-500 uppercase tracking-wider">#${s}</p>
                        `:`
                            <span class="text-sm font-bold text-zinc-600 stat-value">â€”</span>
                            <p class="text-[7px] text-zinc-500 uppercase tracking-wider">Rank</p>
                        `}
                    </div>
                </div>
            </div>
            `:""}
            
            <!-- Mobile Navigation -->
            <div class="flex gap-1 bg-zinc-900/80 p-1 rounded-2xl border border-zinc-800">
                ${ui("earn","fa-coins","Earn")}
                ${ui("history","fa-clock-rotate-left","History")}
                ${ui("leaderboard","fa-trophy","Ranking")}
            </div>
        </div>

        <!-- Desktop Header â€” V5.0 Redesign -->
        <div class="hidden md:block px-4 pt-6 pb-4">
            <div class="flex items-center justify-between mb-5">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 airdrop-float relative">
                        <img src="./assets/airdrop.png" alt="Airdrop" class="w-full h-full object-contain drop-shadow-lg">
                    </div>
                    <div>
                        <h1 class="text-2xl font-black text-white">Airdrop <span class="airdrop-gradient-text">Campaign</span></h1>
                        <p class="text-zinc-500 text-sm">${na} NFT Boosters â€¢ 4 Reward Tiers</p>
                    </div>
                </div>
                
                <a href="https://t.me/BackCoinorg" target="_blank" 
                   class="flex items-center gap-2 bg-sky-500/10 hover:bg-sky-500/20 border border-sky-500/30 text-sky-400 px-4 py-2 rounded-full transition-all hover:scale-105">
                    <i class="fa-brands fa-telegram"></i>
                    <span class="text-sm font-bold">Community</span>
                </a>
            </div>

            ${$.isConnected?`
            <!-- Stats Row Desktop â€” V5.0 with Tier indicator -->
            <div class="grid grid-cols-5 gap-3 mb-4">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-xl font-bold text-amber-400">${t.toLocaleString()}</span>
                    <p class="text-[10px] text-zinc-500 uppercase">Total Points</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-xl font-bold text-green-400">${n}</span>
                    <p class="text-[10px] text-zinc-500 uppercase">Approved Posts</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-xl font-bold text-purple-400">${i.toFixed(1)}x</span>
                    <p class="text-[10px] text-zinc-500 uppercase">Multiplier</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-xl font-bold text-cyan-400">${a.toLocaleString()}</span>
                    <p class="text-[10px] text-zinc-500 uppercase">Platform Usage</p>
                </div>
                <div class="bg-zinc-900/80 border ${o?o.border:"border-zinc-800"} rounded-xl p-3 text-center relative overflow-hidden">
                    ${o?`
                        <div class="absolute inset-0 bg-gradient-to-br ${o.gradient} opacity-30"></div>
                        <span class="text-xl font-bold ${o.text} relative z-10">${o.icon} #${s}</span>
                        <p class="text-[10px] text-zinc-500 uppercase relative z-10">${o.name} Tier</p>
                    `:`
                        <span class="text-xl font-bold text-zinc-600">â€”</span>
                        <p class="text-[10px] text-zinc-500 uppercase">Your Rank</p>
                    `}
                </div>
            </div>
            `:""}

            <!-- Desktop Navigation -->
            <div class="flex justify-center">
                <div class="bg-zinc-900/80 p-1.5 rounded-full border border-zinc-800 inline-flex gap-1">
                    ${pi("earn","fa-coins","Earn Points")}
                    ${pi("history","fa-clock-rotate-left","My History")}
                    ${pi("leaderboard","fa-trophy","Ranking")}
                </div>
            </div>
        </div>
    `}function ui(e,t,a){const n=$.activeTab===e;return`
        <button data-target="${e}" 
                class="nav-pill-btn flex-1 py-2.5 rounded-xl text-xs font-bold transition-all flex flex-col items-center gap-1
                       ${n?"airdrop-tab-active shadow-lg":"text-zinc-500 hover:text-zinc-300"}">
            <i class="fa-solid ${t} text-sm"></i>
            <span>${a}</span>
        </button>
    `}function pi(e,t,a){const n=$.activeTab===e;return`
        <button data-target="${e}" 
                class="nav-pill-btn px-5 py-2.5 rounded-full text-sm transition-all flex items-center gap-2 cursor-pointer
                       ${n?"airdrop-tab-active shadow-lg shadow-amber-500/20":"text-zinc-400 hover:text-white hover:bg-zinc-800"}">
            <i class="fa-solid ${t}"></i> ${a}
        </button>
    `}function mi(){return $.isConnected?`
        <div class="px-4 airdrop-fade-up">
            <!-- Earn Sub-Navigation -->
            <div class="flex gap-2 mb-4">
                <button data-earn-tab="post" class="earn-tab-btn flex-1 py-2 px-3 rounded-lg text-xs font-medium border border-zinc-700 flex items-center justify-center gap-1.5 ${$.activeEarnTab==="post"?"active":"text-zinc-400"}">
                    <i class="fa-solid fa-share-nodes"></i> Post & Share
                </button>
                <button data-earn-tab="platform" class="earn-tab-btn flex-1 py-2 px-3 rounded-lg text-xs font-medium border border-zinc-700 flex items-center justify-center gap-1.5 ${$.activeEarnTab==="platform"?"active":"text-zinc-400"}">
                    <i class="fa-solid fa-gamepad"></i> Use Platform
                </button>
                <button data-earn-tab="tasks" class="earn-tab-btn flex-1 py-2 px-3 rounded-lg text-xs font-medium border border-zinc-700 flex items-center justify-center gap-1.5 ${$.activeEarnTab==="tasks"?"active":"text-zinc-400"}">
                    <i class="fa-solid fa-bolt"></i> Tasks
                </button>
            </div>

            <!-- Sub-tab Content -->
            <div id="earn-content">
                ${$.activeEarnTab==="post"?sf():""}
                ${$.activeEarnTab==="platform"?of():""}
                ${$.activeEarnTab==="tasks"?lf():""}
            </div>
        </div>
    `:`
            <div class="text-center px-4 py-12 airdrop-fade-up">
                <div class="w-24 h-24 mx-auto mb-6 airdrop-float">
                    <img src="./assets/airdrop.png" alt="Connect" class="w-full h-full object-contain opacity-50">
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Connect Your Wallet</h3>
                <p class="text-zinc-500 text-sm max-w-xs mx-auto mb-4">Connect to start earning points and win NFT rewards.</p>
                
                <!-- V5.0: Mini tier preview for non-connected users -->
                <div class="max-w-xs mx-auto bg-zinc-900/60 border border-zinc-800 rounded-xl p-3">
                    <p class="text-zinc-500 text-[10px] uppercase tracking-wider mb-2">Win 1 of ${na} NFT Boosters</p>
                    <div class="flex justify-center gap-3 text-lg">
                        ${pt.map(e=>`<span title="${e.name}">${e.icon}</span>`).join("")}
                    </div>
                </div>
            </div>
        `}function sf(){const{user:e}=$,a=`https://backcoin.org/?ref=${(e==null?void 0:e.referralCode)||"CODE"}`;return`
        <div class="space-y-4">
            <!-- V5.0: Priority Banner with tier info -->
            <div class="bg-gradient-to-r from-amber-500/10 via-amber-500/5 to-transparent border border-amber-500/20 rounded-xl p-3">
                <div class="flex items-center gap-2 text-amber-400 text-xs font-medium">
                    <i class="fa-solid fa-fire"></i>
                    <span>Highest rewards! Post on social media to climb the ranking and win NFTs.</span>
                </div>
            </div>

            <!-- V5.0: Steps Card â€” Redesigned with connected flow -->
            <div class="bg-zinc-900/80 border border-zinc-800 rounded-2xl p-5 relative overflow-hidden">
                <div class="absolute top-3 right-3 w-14 h-14 opacity-10 airdrop-float">
                    <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                </div>
                
                <h2 class="text-base font-bold text-white mb-5 flex items-center gap-2">
                    <i class="fa-solid fa-rocket text-amber-400"></i> 3 Simple Steps
                </h2>
                
                <div class="space-y-5">
                    <!-- Step 1 -->
                    <div class="flex gap-3 items-start relative">
                        <div class="flex flex-col items-center">
                            <div class="w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center shrink-0 text-black font-bold text-xs relative z-10">1</div>
                            <div class="w-0.5 h-full bg-gradient-to-b from-amber-500/50 to-transparent mt-1 min-h-[20px]"></div>
                        </div>
                        <div class="flex-1 pb-2">
                            <p class="text-white text-sm font-medium mb-2">Copy your referral link</p>
                            <div class="bg-black/40 p-2.5 rounded-lg border border-zinc-700/50 mb-2">
                                <p class="text-xs font-mono text-amber-400 break-all">${a}</p>
                                <p class="text-xs font-mono text-zinc-600 mt-1">${Mi}</p>
                            </div>
                            <button id="copy-viral-btn" class="w-full cta-mega text-black font-bold py-2.5 px-4 rounded-xl text-sm flex items-center justify-center gap-2">
                                <i class="fa-solid fa-copy"></i> Copy Link & Tags
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2 -->
                    <div class="flex gap-3 items-start relative">
                        <div class="flex flex-col items-center">
                            <div class="w-7 h-7 rounded-full bg-zinc-700 flex items-center justify-center shrink-0 text-white font-bold text-xs relative z-10">2</div>
                            <div class="w-0.5 h-full bg-gradient-to-b from-zinc-600/50 to-transparent mt-1 min-h-[20px]"></div>
                        </div>
                        <div class="flex-1 pb-2">
                            <p class="text-white text-sm font-medium mb-2">Post on social media</p>
                            <div class="grid grid-cols-4 gap-2">
                                <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(a+" "+Mi)}" target="_blank" 
                                   class="social-btn flex flex-col items-center gap-1 p-2.5 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500">
                                    <i class="fa-brands fa-x-twitter text-white text-base"></i>
                                    <span class="text-[9px] text-zinc-400">X</span>
                                </a>
                                <a href="https://www.tiktok.com" target="_blank" 
                                   class="social-btn flex flex-col items-center gap-1 p-2.5 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500">
                                    <i class="fa-brands fa-tiktok text-white text-base"></i>
                                    <span class="text-[9px] text-zinc-400">TikTok</span>
                                </a>
                                <a href="https://www.instagram.com" target="_blank" 
                                   class="social-btn flex flex-col items-center gap-1 p-2.5 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500">
                                    <i class="fa-brands fa-instagram text-pink-400 text-base"></i>
                                    <span class="text-[9px] text-zinc-400">Insta</span>
                                </a>
                                <a href="https://www.youtube.com" target="_blank" 
                                   class="social-btn flex flex-col items-center gap-1 p-2.5 rounded-lg bg-black/60 border border-zinc-700 hover:border-zinc-500">
                                    <i class="fa-brands fa-youtube text-red-500 text-base"></i>
                                    <span class="text-[9px] text-zinc-400">YouTube</span>
                                </a>
                            </div>
                            <p class="text-amber-400/70 text-[10px] mt-2 flex items-center gap-1">
                                <i class="fa-solid fa-exclamation-circle"></i> Post must be PUBLIC
                            </p>
                        </div>
                    </div>
                    
                    <!-- Step 3 -->
                    <div class="flex gap-3 items-start">
                        <div class="w-7 h-7 rounded-full bg-zinc-700 flex items-center justify-center shrink-0 text-white font-bold text-xs">3</div>
                        <div class="flex-1">
                            <p class="text-white text-sm font-medium mb-2">Submit your post link</p>
                            <div class="relative">
                                <input type="url" id="content-url-input" 
                                       placeholder="Paste your post URL here..."
                                       class="w-full bg-black/50 border border-zinc-600 rounded-xl pl-3 pr-20 py-3 text-white text-sm focus:border-amber-500 focus:ring-1 focus:ring-amber-500 outline-none transition-all placeholder:text-zinc-600">
                                <button id="submit-content-btn" 
                                        class="absolute right-1.5 top-1.5 bottom-1.5 bg-green-600 hover:bg-green-500 text-white font-bold px-3 rounded-lg transition-all text-sm">
                                    Submit
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- V5.0: NFT Tier Preview Card (compact) -->
            <div class="bg-zinc-900/60 border border-zinc-800 rounded-xl p-4">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs font-bold text-zinc-400 uppercase tracking-wider flex items-center gap-1.5">
                        <i class="fa-solid fa-gem text-amber-500 text-[10px]"></i> NFT Reward Tiers
                    </h3>
                    <span class="text-[10px] text-zinc-600">${na} total</span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    ${pt.map(n=>`
                        <div class="tier-card flex items-center gap-2.5 p-2 rounded-lg bg-gradient-to-r ${n.gradient} border ${n.border}">
                            <span class="text-lg">${n.icon}</span>
                            <div class="min-w-0">
                                <span class="${n.text} font-bold text-xs">${n.name}</span>
                                <div class="flex items-center gap-1.5">
                                    <span class="text-zinc-400 text-[10px]">${n.ranks}</span>
                                    <span class="text-zinc-600 text-[10px]">â€¢</span>
                                    <span class="text-green-400/80 text-[10px]">${n.receive}</span>
                                </div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>
        </div>
    `}function of(){var s;const e=$.platformUsageConfig||od,t=$.platformUsage||{};let a=0,n=0;Object.keys(e).forEach(o=>{var l;e[o].enabled!==!1&&e[o].maxCount&&(a+=e[o].maxCount,n+=Math.min(((l=t[o])==null?void 0:l.count)||0,e[o].maxCount))});const i=a>0?n/a*100:0,r=((s=$.user)==null?void 0:s.platformUsagePoints)||0;return`
        <div class="space-y-4">
            <!-- Info Banner -->
            <div class="bg-gradient-to-r from-purple-500/10 to-transparent border border-purple-500/20 rounded-xl p-3">
                <div class="flex items-center gap-2 text-purple-400 text-xs font-medium">
                    <i class="fa-solid fa-gamepad"></i>
                    <span>Earn points by using Backcoin features! Each action counts.</span>
                </div>
            </div>

            <!-- Progress Card -->
            <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white text-sm font-medium">Platform Mastery</span>
                    <span class="text-amber-400 text-xs font-bold">${n}/${a}</span>
                </div>
                <div class="progress-bar-bg h-2 rounded-full">
                    <div class="progress-bar-fill h-full rounded-full" style="width: ${i}%"></div>
                </div>
                <div class="flex justify-between mt-2">
                    <p class="text-zinc-500 text-[10px]">Complete actions to earn points</p>
                    <p class="text-cyan-400 text-[10px] font-bold">${r.toLocaleString()} pts earned</p>
                </div>
            </div>

            <!-- Actions Grid -->
            <div class="grid grid-cols-2 gap-2" id="platform-actions-grid">
                ${Object.entries(e).filter(([o,l])=>l.enabled!==!1).map(([o,l])=>{const c=t[o]||{count:0},u=c.count>=l.maxCount,f=Math.max(0,l.maxCount-c.count),p=c.count/l.maxCount*100,b=Zm[o]||"";return`
                        <div class="platform-action-card bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 ${u?"completed opacity-60":"cursor-pointer hover:border-amber-500/50 hover:bg-zinc-800/80"} transition-all" 
                             data-platform-action="${o}"
                             data-target-page="${b}">
                            <div class="flex items-start justify-between mb-1.5">
                                <span class="text-lg">${l.icon}</span>
                                ${u?'<span class="text-green-400 text-xs"><i class="fa-solid fa-check-circle"></i></span>':`<span class="text-amber-400 text-[10px] font-bold">+${l.points}</span>`}
                            </div>
                            <p class="text-white text-xs font-medium mb-1">${l.label}</p>
                            <div class="flex items-center justify-between mb-1.5">
                                <span class="text-zinc-500 text-[10px]">${c.count}/${l.maxCount}</span>
                                ${!u&&f>0?`<span class="text-zinc-600 text-[10px]">${f} left</span>`:""}
                            </div>
                            <div class="progress-bar-bg h-1 rounded-full">
                                <div class="progress-bar-fill h-full rounded-full" style="width: ${p}%"></div>
                            </div>
                            ${!u&&b?`
                                <div class="mt-2 text-center">
                                    <span class="text-amber-400/70 text-[9px]"><i class="fa-solid fa-arrow-right mr-1"></i>Tap to go</span>
                                </div>
                            `:""}
                        </div>
                    `}).join("")}
            </div>

            <!-- Help Text -->
            <div class="text-center">
                <p class="text-zinc-500 text-[10px]">
                    <i class="fa-solid fa-info-circle mr-1"></i>
                    Points are automatically awarded when you use platform features
                </p>
            </div>
        </div>
    `}function lf(){const e=$.dailyTasks||[],t=e.filter(n=>n.eligible),a=e.filter(n=>!n.eligible&&n.timeLeftMs>0);return`
        <div class="space-y-4">
            <!-- Info Banner -->
            <div class="bg-gradient-to-r from-yellow-500/10 to-transparent border border-yellow-500/20 rounded-xl p-3">
                <div class="flex items-center gap-2 text-yellow-400 text-xs font-medium">
                    <i class="fa-solid fa-bolt"></i>
                    <span>Complete daily tasks for bonus points!</span>
                </div>
            </div>

            ${t.length>0?`
                <div>
                    <h3 class="text-white text-sm font-medium mb-2">Available Tasks</h3>
                    <div class="space-y-2">
                        ${t.map(n=>`
                            <div class="task-card bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 cursor-pointer hover:border-amber-500/50 transition-colors"
                                 data-id="${n.id}" data-url="${n.url||""}">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center">
                                            <i class="fa-solid fa-star text-yellow-400 text-xs"></i>
                                        </div>
                                        <div>
                                            <p class="text-white text-sm font-medium">${n.title}</p>
                                            ${n.description?`<p class="text-zinc-500 text-[10px]">${n.description}</p>`:""}
                                        </div>
                                    </div>
                                    <span class="text-green-400 text-sm font-bold">+${Math.round(n.points)}</span>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `:""}

            ${a.length>0?`
                <div>
                    <h3 class="text-zinc-500 text-sm font-medium mb-2">On Cooldown</h3>
                    <div class="space-y-2">
                        ${a.map(n=>`
                            <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 opacity-50">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center">
                                            <i class="fa-solid fa-clock text-zinc-500 text-xs"></i>
                                        </div>
                                        <p class="text-zinc-400 text-sm">${n.title}</p>
                                    </div>
                                    <span class="text-zinc-600 text-xs">${Qm(n.timeLeftMs)}</span>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `:""}

            ${e.length===0?`
                <div class="text-center py-8">
                    <i class="fa-solid fa-check-circle text-zinc-600 text-3xl mb-3"></i>
                    <p class="text-zinc-500 text-sm">No tasks available right now</p>
                    <p class="text-zinc-600 text-xs mt-1">Check back later!</p>
                </div>
            `:""}
        </div>
    `}function cf(){const{user:e,userSubmissions:t}=$;if(!$.isConnected)return`
            <div class="text-center px-4 py-12 airdrop-fade-up">
                <div class="w-20 h-20 mx-auto mb-4 opacity-50">
                    <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                </div>
                <h3 class="text-lg font-bold text-white mb-2">Connect Your Wallet</h3>
                <p class="text-zinc-500 text-sm">Connect to view your submission history.</p>
            </div>
        `;const a=Date.now(),n=sd*60*60*1e3,i=t.filter(l=>["pending","auditing"].includes(l.status)&&l.submittedAt&&a-l.submittedAt.getTime()>=n),r=(e==null?void 0:e.approvedSubmissionsCount)||0,s=t.filter(l=>["pending","auditing"].includes(l.status)).length,o=t.filter(l=>l.status==="rejected").length;return`
        <div class="px-4 space-y-4 airdrop-fade-up">
            
            <!-- Stats -->
            <div class="grid grid-cols-3 gap-3">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-2xl font-black text-green-400">${r}</span>
                    <p class="text-[10px] text-zinc-500">Approved</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-2xl font-black text-amber-400">${s}</span>
                    <p class="text-[10px] text-zinc-500">Pending</p>
                </div>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl p-3 text-center">
                    <span class="text-2xl font-black text-red-400">${o}</span>
                    <p class="text-[10px] text-zinc-500">Rejected</p>
                </div>
            </div>

            <!-- Action Required -->
            ${i.length>0?`
                <div class="space-y-3">
                    <h3 class="text-sm font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-bell text-amber-500 airdrop-bounce"></i> Ready to Verify (${i.length})
                    </h3>
                    ${i.map(l=>`
                        <div class="bg-gradient-to-r from-green-900/20 to-zinc-900 border border-green-500/30 rounded-xl p-4 relative overflow-hidden">
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-green-500"></div>
                            <div class="flex items-start gap-3 mb-3">
                                <div class="bg-green-500/20 w-10 h-10 rounded-full flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-check-circle text-green-400"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <p class="text-white font-bold text-sm">Ready for Verification!</p>
                                    <a href="${l.url}" target="_blank" class="text-blue-400 text-xs truncate block hover:underline mt-1">${l.url}</a>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button data-action="delete" data-id="${l.submissionId}" 
                                        class="action-btn flex-1 text-red-400 text-xs font-medium py-2 rounded-lg border border-red-500/30 hover:bg-red-500/10 transition-colors">
                                    Cancel
                                </button>
                                <button data-action="confirm" data-id="${l.submissionId}" 
                                        class="action-btn flex-1 bg-green-600 hover:bg-green-500 text-white text-xs font-bold py-2 rounded-lg transition-colors">
                                    Confirm & Earn âœ“
                                </button>
                            </div>
                        </div>
                    `).join("")}
                </div>
            `:""}

            <!-- Recent Submissions -->
            <div>
                <h3 class="text-sm font-bold text-white mb-3">Submission History</h3>
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    ${t.length===0?`<div class="p-8 text-center">
                            <i class="fa-solid fa-inbox text-zinc-600 text-3xl mb-3"></i>
                            <p class="text-zinc-500 text-sm">No submissions yet</p>
                            <p class="text-zinc-600 text-xs mt-1">Create your first post to get started!</p>
                        </div>`:t.slice(0,10).map((l,c)=>{const u=c===Math.min(t.length,10)-1;["pending","auditing"].includes(l.status);const f=l.status==="approved",p=l.status==="rejected";let b,m,x;f?(b='<i class="fa-solid fa-check-circle text-green-400"></i>',m="",x=""):p?(b='<i class="fa-solid fa-times-circle text-red-400"></i>',m="",x=""):(b='<i class="fa-solid fa-shield-halved text-amber-400 animate-pulse"></i>',m="bg-amber-900/10",x=`
                                    <div class="mt-2 flex items-center gap-2 text-amber-400/80">
                                        <i class="fa-solid fa-magnifying-glass text-[10px] animate-pulse"></i>
                                        <span class="text-[10px] font-medium">Under security audit...</span>
                                    </div>
                                `);const y=l.pointsAwarded?`+${l.pointsAwarded}`:"-";return`
                                <div class="p-3 ${u?"":"border-b border-zinc-800"} ${m}">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-3 overflow-hidden">
                                            ${b}
                                            <a href="${l.url}" target="_blank" class="text-zinc-400 text-xs truncate hover:text-blue-400 max-w-[180px] md:max-w-[300px]">${l.url}</a>
                                        </div>
                                        <span class="font-mono font-bold ${l.pointsAwarded?"text-green-400":"text-zinc-600"} text-sm shrink-0">${y}</span>
                                    </div>
                                    ${x}
                                </div>
                            `}).join("")}
                </div>
            </div>
        </div>
    `}function df(){var u,f;const e=((u=$.leaderboards)==null?void 0:u.top100ByPosts)||[],t=((f=$.leaderboards)==null?void 0:f.top100ByPoints)||[],a=$.activeRanking||"posts";function n(p,b,m){var z,I;const x=$.user&&((z=p.walletAddress)==null?void 0:z.toLowerCase())===((I=$.user.walletAddress)==null?void 0:I.toLowerCase()),y=uf(b+1),C=m==="posts"?"bg-amber-500/10":"bg-green-500/10",A=m==="posts"?"text-amber-400":"text-green-400",N=m==="posts"?"text-white":"text-green-400",P=m==="posts"?"posts":"pts";return`
            <div class="flex items-center justify-between p-3 ${x?C:"hover:bg-zinc-800/50"} transition-colors">
                <div class="flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full ${y.bg} flex items-center justify-center text-xs font-bold">${y.icon||b+1}</span>
                    <div class="flex flex-col">
                        <span class="font-mono text-xs ${x?A+" font-bold":"text-zinc-400"}">
                            ${la(p.walletAddress)}${x?" (You)":""}
                        </span>
                        ${y.tierName?`<span class="text-[9px] ${y.tierTextColor}">${y.tierName}</span>`:""}
                    </div>
                </div>
                <span class="font-bold ${N} text-sm">${(p.value||0).toLocaleString()} <span class="text-zinc-500 text-xs">${P}</span></span>
            </div>
        `}const i=a==="posts"?"bg-gradient-to-r from-amber-500 to-orange-500 text-black shadow-lg shadow-amber-500/20":"bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700",r=a==="points"?"bg-gradient-to-r from-green-500 to-emerald-500 text-black shadow-lg shadow-green-500/20":"bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700",s=a==="posts"?"":"hidden",o=a==="points"?"":"hidden",l=e.length===0?'<p class="p-6 text-center text-zinc-500 text-sm">No data yet - be the first!</p>':e.slice(0,50).map((p,b)=>n(p,b,"posts")).join(""),c=t.length===0?'<p class="p-6 text-center text-zinc-500 text-sm">No data yet - be the first!</p>':t.slice(0,50).map((p,b)=>n(p,b,"points")).join("");return`
        <div class="px-4 airdrop-fade-up">

            <!-- V5.0: NFT Rewards Banner â€” 4 Tiers with detailed info -->
            <div class="bg-gradient-to-br from-zinc-900 to-zinc-900 border border-amber-500/20 rounded-xl p-4 mb-5 relative overflow-hidden">
                <div class="absolute top-2 right-2 w-14 h-14 airdrop-float opacity-20">
                    <img src="./assets/airdrop.png" alt="Prize" class="w-full h-full object-contain">
                </div>
                
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-bold text-white text-sm flex items-center gap-2">
                        <i class="fa-solid fa-trophy text-amber-400"></i> NFT Booster Rewards
                    </h3>
                    <span class="text-[10px] text-zinc-500 bg-zinc-800 px-2 py-0.5 rounded-full">${na} NFTs</span>
                </div>
                
                <div class="space-y-2">
                    ${pt.map(p=>`
                        <div class="tier-card flex items-center justify-between p-2.5 rounded-lg bg-gradient-to-r ${p.gradient} border ${p.border}">
                            <div class="flex items-center gap-2.5">
                                <span class="text-lg">${p.icon}</span>
                                <div>
                                    <span class="${p.text} font-bold text-xs">${p.name}</span>
                                    <div class="text-zinc-500 text-[10px]">${p.count} NFTs</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="text-white font-bold text-xs">${p.ranks}</span>
                                <div class="flex items-center gap-1">
                                    <span class="text-green-400/80 text-[10px]">${p.burn} burn</span>
                                    <span class="text-zinc-600 text-[10px]">â€¢</span>
                                    <span class="text-green-400 text-[10px] font-medium">${p.receive} rewards</span>
                                </div>
                            </div>
                        </div>
                    `).join("")}
                </div>
                
                <p class="text-amber-400/60 text-[10px] mt-3 flex items-center gap-1">
                    <i class="fa-solid fa-info-circle"></i>
                    NFT Boosters reduce token burn when claiming mining rewards
                </p>
            </div>

            <!-- Ranking Toggle Tabs -->
            <div class="flex gap-2 mb-4">
                <button data-ranking="posts" class="ranking-tab-btn flex-1 py-2.5 px-4 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${i}">
                    <i class="fa-solid fa-share-nodes"></i> By Posts
                </button>
                <button data-ranking="points" class="ranking-tab-btn flex-1 py-2.5 px-4 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${r}">
                    <i class="fa-solid fa-star"></i> By Points
                </button>
            </div>

            <!-- Posts Ranking -->
            <div id="ranking-posts" class="${s}">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                        <h3 class="font-bold text-white text-sm flex items-center gap-2">
                            <i class="fa-solid fa-crown text-yellow-500"></i> Top Content Creators
                        </h3>
                        <span class="text-zinc-500 text-xs">${e.length} creators</span>
                    </div>
                    <div class="divide-y divide-zinc-800/50 max-h-[400px] overflow-y-auto scroll-area">
                        ${l}
                    </div>
                </div>
            </div>

            <!-- Points Ranking -->
            <div id="ranking-points" class="${o}">
                <div class="bg-zinc-900/80 border border-zinc-800 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                        <h3 class="font-bold text-white text-sm flex items-center gap-2">
                            <i class="fa-solid fa-star text-green-500"></i> Top Points Earners
                        </h3>
                        <span class="text-zinc-500 text-xs">${t.length} earners</span>
                    </div>
                    <div class="divide-y divide-zinc-800/50 max-h-[400px] overflow-y-auto scroll-area">
                        ${c}
                    </div>
                </div>
            </div>
        </div>
    `}function uf(e){return e<=5?{icon:"ðŸ’Ž",bg:"bg-cyan-500/20 text-cyan-300",tierName:"Diamond",tierTextColor:"text-cyan-400/70"}:e<=25?{icon:"ðŸ¥‡",bg:"bg-yellow-500/20 text-yellow-400",tierName:"Gold",tierTextColor:"text-yellow-400/70"}:e<=75?{icon:"ðŸ¥ˆ",bg:"bg-gray-400/20 text-gray-300",tierName:"Silver",tierTextColor:"text-gray-400/70"}:e<=200?{icon:"ðŸ¥‰",bg:"bg-amber-600/20 text-amber-500",tierName:"Bronze",tierTextColor:"text-amber-500/70"}:{icon:null,bg:"bg-zinc-800 text-zinc-400",tierName:null,tierTextColor:""}}function je(){const e=document.getElementById("main-content"),t=document.getElementById("airdrop-header");if(e){if(t&&(t.innerHTML=ld()),$.isBanned){e.innerHTML=`
            <div class="px-4 py-12 text-center">
                <i class="fa-solid fa-ban text-red-500 text-4xl mb-4"></i>
                <h2 class="text-red-500 font-bold text-xl mb-2">Account Suspended</h2>
                <p class="text-zinc-400 text-sm">Contact support on Telegram.</p>
            </div>
        `;return}switch(document.querySelectorAll(".nav-pill-btn").forEach(a=>{const n=a.dataset.target;a.closest(".md\\:hidden")?n===$.activeTab?(a.classList.add("airdrop-tab-active","shadow-lg"),a.classList.remove("text-zinc-500")):(a.classList.remove("airdrop-tab-active","shadow-lg"),a.classList.add("text-zinc-500")):n===$.activeTab?(a.classList.remove("text-zinc-400","hover:text-white","hover:bg-zinc-800"),a.classList.add("airdrop-tab-active","shadow-lg","shadow-amber-500/20")):(a.classList.add("text-zinc-400","hover:text-white","hover:bg-zinc-800"),a.classList.remove("airdrop-tab-active","shadow-lg","shadow-amber-500/20"))}),$.activeTab){case"earn":e.innerHTML=mi();break;case"post":e.innerHTML=mi();break;case"history":e.innerHTML=cf();break;case"leaderboard":e.innerHTML=df();break;default:e.innerHTML=mi()}}}function pf(){var a;const e=((a=$.user)==null?void 0:a.referralCode)||"CODE",t=`${e!=="CODE"?`https://backcoin.org/?ref=${e}`:"https://backcoin.org"} ${Mi}`;navigator.clipboard.writeText(t).then(()=>{h("Copied! Now paste it in your post.","success");const n=document.getElementById("copy-viral-btn");if(n){const i=n.innerHTML;n.innerHTML='<i class="fa-solid fa-check"></i> Copied!',n.classList.remove("cta-mega"),n.classList.add("bg-green-600"),setTimeout(()=>{n.innerHTML=i,n.classList.add("cta-mega"),n.classList.remove("bg-green-600")},2e3)}}).catch(()=>h("Failed to copy.","error"))}function Cs(e){const t=e.target.closest(".nav-pill-btn");t&&($.activeTab=t.dataset.target,je())}function mf(e){const t=e.target.closest(".earn-tab-btn");t&&t.dataset.earnTab&&($.activeEarnTab=t.dataset.earnTab,je())}function ff(e){const t=e.target.closest(".ranking-tab-btn");t&&t.dataset.ranking&&($.activeRanking=t.dataset.ranking,je())}function bf(){$.isGuideOpen=!$.isGuideOpen,je()}function cd(e){var i;const t=`
        <div class="text-center">
            <!-- Imagem de CAUTION -->
            <div class="w-32 h-32 mx-auto mb-4">
                <img src="./assets/caution.png" alt="Caution" class="w-full h-full object-contain">
            </div>
            
            <!-- TÃ­tulo com alerta -->
            <h3 class="text-xl font-bold text-red-400 mb-2">âš ï¸ FINAL VERIFICATION</h3>
            
            <!-- Aviso de auditoria -->
            <div class="bg-red-900/30 border border-red-500/50 rounded-xl p-4 mb-4">
                <p class="text-red-300 text-sm font-bold mb-2">
                    <i class="fa-solid fa-shield-halved mr-1"></i>
                    All posts are AUDITED
                </p>
                <p class="text-zinc-400 text-xs leading-relaxed">
                    Our security team reviews every submission. 
                    <span class="text-red-400 font-bold">Fake or fraudulent links will result in PERMANENT BAN</span> 
                    from the airdrop campaign.
                </p>
            </div>
            
            <!-- URL sendo confirmada -->
            <div class="bg-zinc-800/80 border border-zinc-700 rounded-xl p-3 mb-4">
                <p class="text-zinc-500 text-[10px] uppercase mb-1">Post being verified:</p>
                <a href="${e.url}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm truncate block">${e.url}</a>
            </div>
            
            <!-- Checkbox de confirmaÃ§Ã£o -->
            <label class="flex items-start gap-3 text-left bg-zinc-900/80 border border-zinc-700 rounded-xl p-3 mb-4 cursor-pointer hover:border-amber-500/50 transition-colors">
                <input type="checkbox" id="confirmCheckbox" class="mt-1 w-4 h-4 accent-amber-500">
                <span class="text-xs text-zinc-300">
                    I confirm this is <span class="text-white font-bold">my authentic public post</span> and I understand that 
                    <span class="text-red-400 font-bold">submitting fake content will result in permanent ban</span>.
                </span>
            </label>
            
            <!-- BotÃµes -->
            <div class="flex gap-3">
                <button id="deletePostBtn" data-submission-id="${e.submissionId}" 
                        class="flex-1 bg-red-900/50 hover:bg-red-800 text-red-300 hover:text-white py-3 rounded-xl font-medium text-sm transition-colors border border-red-500/30">
                    <i class="fa-solid fa-trash mr-1"></i> Delete Post
                </button>
                <button id="finalConfirmBtn" data-submission-id="${e.submissionId}" 
                        class="flex-1 bg-green-600/50 text-green-200 py-3 rounded-xl font-bold text-sm cursor-not-allowed transition-colors" 
                        disabled>
                    <i class="fa-solid fa-lock mr-1"></i> Confirm & Earn
                </button>
            </div>
            
            <!-- RodapÃ© de aviso -->
            <p class="text-zinc-600 text-[10px] mt-4">
                <i class="fa-solid fa-info-circle mr-1"></i>
                By confirming, you agree to our audit process and anti-fraud policies.
            </p>
        </div>
    `;Na(t,"max-w-md"),(i=document.getElementById("deletePostBtn"))==null||i.addEventListener("click",async r=>{const s=r.currentTarget,o=s.dataset.submissionId;s.disabled=!0,s.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-1"></i> Deleting...';try{await lo(o),h("Post deleted. No penalty applied.","info"),Ie(),await ma(),je()}catch(l){h(l.message,"error"),s.disabled=!1,s.innerHTML='<i class="fa-solid fa-trash mr-1"></i> Delete Post'}});const a=document.getElementById("confirmCheckbox"),n=document.getElementById("finalConfirmBtn");a==null||a.addEventListener("change",()=>{a.checked?(n.disabled=!1,n.className="flex-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold text-sm transition-colors cursor-pointer",n.innerHTML='<i class="fa-solid fa-check mr-1"></i> Confirm & Earn âœ“'):(n.disabled=!0,n.className="flex-1 bg-green-600/50 text-green-200 py-3 rounded-xl font-bold text-sm cursor-not-allowed transition-colors",n.innerHTML='<i class="fa-solid fa-lock mr-1"></i> Confirm & Earn')}),n==null||n.addEventListener("click",gf)}async function gf(e){const t=e.currentTarget,a=t.dataset.submissionId;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Verifying...';try{await Zu(a),h("Success! Points added.","success"),Ie(),await ma(),je()}catch{h("Verification failed.","error"),t.disabled=!1,t.innerHTML="Try Again"}}async function xf(e){const t=e.target.closest(".action-btn");if(!t)return;const a=t.dataset.action,n=t.dataset.id;if(a==="confirm"){const i=$.userSubmissions.find(r=>r.submissionId===n);i&&cd(i)}else if(a==="delete"){if(!confirm("Remove this submission?"))return;try{await lo(n),h("Removed.","info"),await ma(),je()}catch(i){h(i.message,"error")}}}async function hf(e){const t=e.target.closest("#submit-content-btn");if(!t)return;const a=document.getElementById("content-url-input"),n=a==null?void 0:a.value.trim();if(!n||!n.startsWith("http"))return h("Enter a valid URL.","warning");const i=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>';try{await Xu(n),h("ðŸ“‹ Submitted! Your post is now under security audit.","info"),a.value="",await ma(),$.activeTab="history",je()}catch(r){h(r.message,"error")}finally{t.disabled=!1,t.innerHTML=i}}async function vf(e){const t=e.target.closest(".task-card");if(!t)return;const a=t.dataset.id,n=t.dataset.url;n&&window.open(n,"_blank");const i=$.dailyTasks.find(r=>r.id===a);if(!(!i||!i.eligible))try{await Vu(i,$.user.pointsMultiplier),h(`Task completed! +${i.points} pts`,"success"),await ma(),je()}catch(r){r.message.includes("Cooldown")||h(r.message,"error")}}function wf(){const e=Date.now(),t=sd*60*60*1e3,a=$.userSubmissions.filter(n=>["pending","auditing"].includes(n.status)&&n.submittedAt&&e-n.submittedAt.getTime()>=t);a.length>0&&($.activeTab="history",je(),setTimeout(()=>{cd(a[0])},500))}const yf={async render(e){const t=document.getElementById("airdrop");if(!t)return;af();const a=ef();(t.innerHTML.trim()===""||e)&&(t.innerHTML=`
                <div id="loading-state" class="fixed inset-0 z-50 bg-gradient-to-b from-zinc-900 via-zinc-900 to-black flex flex-col items-center justify-center px-6 overflow-y-auto py-8">
                    <!-- Floating coins effect -->
                    <div class="absolute inset-0 overflow-hidden pointer-events-none">
                        <div class="absolute top-[10%] left-[10%] w-6 h-6 opacity-20 airdrop-float" style="animation-delay: 0s;">
                            <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                        </div>
                        <div class="absolute top-[20%] right-[15%] w-8 h-8 opacity-15 airdrop-float" style="animation-delay: 0.5s;">
                            <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                        </div>
                        <div class="absolute bottom-[30%] left-[5%] w-5 h-5 opacity-10 airdrop-float" style="animation-delay: 1s;">
                            <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                        </div>
                        <div class="absolute bottom-[20%] right-[10%] w-7 h-7 opacity-15 airdrop-float" style="animation-delay: 1.5s;">
                            <img src="./assets/airdrop.png" alt="" class="w-full h-full object-contain">
                        </div>
                    </div>
                    
                    <!-- Main content -->
                    <div class="relative z-10 text-center max-w-sm w-full">
                        <!-- Large airdrop icon -->
                        <div class="w-32 h-32 md:w-40 md:h-40 mx-auto mb-6 airdrop-float-slow">
                            <img src="./assets/airdrop.png" alt="Airdrop" class="w-full h-full object-contain drop-shadow-2xl">
                        </div>
                        
                        <!-- Motivational message -->
                        <h2 class="text-xl md:text-2xl font-black text-white mb-2 leading-tight">${a.title}</h2>
                        <p class="text-zinc-400 text-sm mb-6">${a.subtitle}</p>
                        
                        <!-- V5.0: NFT Tiers Preview â€” 4 Tiers -->
                        <div class="bg-zinc-900/50 border border-zinc-800 rounded-xl p-4 mb-6 text-left">
                            <p class="text-zinc-500 text-[10px] uppercase tracking-wider mb-3 text-center">
                                ${na} NFT Booster Rewards â€¢ 4 Tiers
                            </p>
                            <div class="space-y-1.5">
                                ${pt.map(n=>`
                                    <div class="flex items-center justify-between p-1.5 rounded-lg">
                                        <div class="flex items-center gap-2">
                                            <span class="text-base">${n.icon}</span>
                                            <span class="${n.text} font-bold text-xs">${n.name}</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-zinc-500 text-[10px]">${n.ranks}</span>
                                            <span class="text-green-400/60 text-[10px]">${n.receive}</span>
                                        </div>
                                    </div>
                                `).join("")}
                            </div>
                        </div>
                        
                        <!-- Loading indicator -->
                        <div class="flex items-center justify-center gap-2 text-amber-500">
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0s;"></div>
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0.1s;"></div>
                            <div class="w-2 h-2 rounded-full bg-amber-500 animate-bounce" style="animation-delay: 0.2s;"></div>
                        </div>
                        <p class="text-zinc-600 text-xs mt-3">Loading...</p>
                    </div>
                </div>
                
                <div id="airdrop-main" class="hidden">
                    <div id="airdrop-header">${ld()}</div>
                    <div id="airdrop-body" class="max-w-2xl mx-auto pb-24">
                        <div id="main-content"></div>
                    </div>
                </div>
            `,this.attachListeners());try{const n=new Promise(o=>setTimeout(o,4e3));await Promise.all([ma(),n]);const i=document.getElementById("loading-state"),r=document.getElementById("airdrop-main"),s=document.getElementById("main-content");i&&(i.style.transition="opacity 0.5s ease-out",i.style.opacity="0",await new Promise(o=>setTimeout(o,500)),i.classList.add("hidden")),r&&r.classList.remove("hidden"),s&&(s.classList.remove("hidden"),je()),wf()}catch(n){console.error(n)}},attachListeners(){const e=document.getElementById("airdrop-body"),t=document.getElementById("airdrop-header");t==null||t.addEventListener("click",Cs),e==null||e.addEventListener("click",a=>{a.target.closest("#guide-toggle-btn")&&bf(),a.target.closest("#submit-content-btn")&&hf(a),a.target.closest(".task-card")&&vf(a),a.target.closest(".action-btn")&&xf(a),a.target.closest("#copy-viral-btn")&&pf(),a.target.closest(".ranking-tab-btn")&&ff(a),a.target.closest(".earn-tab-btn")&&mf(a),a.target.closest(".nav-pill-btn")&&Cs(a);const n=a.target.closest(".platform-action-card");if(n&&!n.classList.contains("completed")){const i=n.dataset.targetPage;i&&(console.log("ðŸŽ¯ Navigating to:",i),kf(i))}})},update(e){$.isConnected!==e&&this.render(!0)}};function kf(e){console.log("ðŸŽ¯ Platform card clicked, navigating to:",e);const t=document.querySelector(`a[data-target="${e}"]`)||document.querySelector(`[data-target="${e}"]`);if(t){console.log("âœ… Found menu link, clicking..."),t.click();const i=document.getElementById("sidebar");i&&window.innerWidth<768&&i.classList.add("hidden");return}const a=document.querySelectorAll("main > section"),n=document.getElementById(e);if(n){console.log("âœ… Found section, showing directly..."),a.forEach(r=>r.classList.add("hidden")),n.classList.remove("hidden"),document.querySelectorAll(".sidebar-link").forEach(r=>{r.classList.remove("active","bg-zinc-700","text-white"),r.classList.add("text-zinc-400")});const i=document.querySelector(`[data-target="${e}"]`);i&&(i.classList.add("active","bg-zinc-700","text-white"),i.classList.remove("text-zinc-400"));return}console.warn("âš ï¸ Could not navigate to:",e)}const dd=window.ethers,An="".toLowerCase(),Ef="",ud="bkc_admin_auth_v3";window.__ADMIN_WALLET__=An;setTimeout(()=>{document.dispatchEvent(new CustomEvent("adminConfigReady")),console.log("âœ… Admin config ready, wallet:",An?"configured":"not set")},100);function Is(){return sessionStorage.getItem(ud)==="true"}function Tf(){sessionStorage.setItem(ud,"true")}function Cf(){return!d.isConnected||!d.userAddress||!An?!1:d.userAddress.toLowerCase()===An}const As={pending:{text:"Pending Review",color:"text-amber-400",bgColor:"bg-amber-900/50",icon:"fa-clock"},auditing:{text:"Auditing",color:"text-blue-400",bgColor:"bg-blue-900/50",icon:"fa-magnifying-glass"},approved:{text:"Approved",color:"text-green-400",bgColor:"bg-green-900/50",icon:"fa-check-circle"},rejected:{text:"Rejected",color:"text-red-400",bgColor:"bg-red-900/50",icon:"fa-times-circle"},flagged_suspicious:{text:"Flagged",color:"text-red-300",bgColor:"bg-red-800/60",icon:"fa-flag"}},Wn={faucet:{icon:"ðŸš°",label:"Claim Faucet",points:1e3,maxCount:1,cooldownHours:0,enabled:!0},delegation:{icon:"ðŸ“Š",label:"Delegate BKC",points:2e3,maxCount:10,cooldownHours:24,enabled:!0},fortune:{icon:"ðŸŽ°",label:"Play Fortune",points:1500,maxCount:10,cooldownHours:1,enabled:!0},buyNFT:{icon:"ðŸ›’",label:"Buy NFT",points:2500,maxCount:10,cooldownHours:0,enabled:!0},sellNFT:{icon:"ðŸ’°",label:"Sell NFT",points:1500,maxCount:10,cooldownHours:0,enabled:!0},listRental:{icon:"ðŸ·ï¸",label:"List for Rent",points:1e3,maxCount:10,cooldownHours:0,enabled:!0},rentNFT:{icon:"â°",label:"Rent NFT",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},notarize:{icon:"ðŸ“œ",label:"Notarize Doc",points:2e3,maxCount:10,cooldownHours:0,enabled:!0},claimReward:{icon:"ðŸ’¸",label:"Claim Rewards",points:1e3,maxCount:10,cooldownHours:24,enabled:!0},unstake:{icon:"â†©ï¸",label:"Unstake",points:500,maxCount:10,cooldownHours:0,enabled:!0}};let B={allSubmissions:[],dailyTasks:[],ugcBasePoints:null,platformUsageConfig:null,editingTask:null,activeTab:"review-submissions",allUsers:[],selectedUserSubmissions:[],isSubmissionsModalOpen:!1,selectedWallet:null,usersFilter:"all",usersSearch:"",usersPage:1,usersPerPage:100,submissionsPage:1,submissionsPerPage:100,tasksPage:1,tasksPerPage:100};const Aa=async()=>{var t;const e=document.getElementById("admin-content-wrapper");if(e){const a=document.createElement("div");e.innerHTML=a.innerHTML}try{d.userAddress&&(await so(d.userAddress),console.log("âœ… Firebase Auth: Admin authenticated"));const[a,n,i,r]=await Promise.all([np(),ep(),qi(),ip()]);B.allSubmissions=a,B.dailyTasks=n,B.allUsers=r,B.ugcBasePoints=((t=i.config)==null?void 0:t.ugcBasePoints)||{YouTube:5e3,"YouTube Shorts":2500,Instagram:3e3,"X/Twitter":1500,Facebook:2e3,Telegram:1e3,TikTok:3500,Reddit:1800,LinkedIn:2200,Other:1e3},B.platformUsageConfig=i.platformUsageConfig||Wn,B.editingTask&&(B.editingTask=n.find(s=>s.id===B.editingTask.id)||null),Yf()}catch(a){if(console.error("Error loading admin data:",a),e){const n=document.createElement("div");Cp(n,`Failed to load admin data: ${a.message}`),e.innerHTML=n.innerHTML}else h("Failed to load admin data.","error")}},Cr=async()=>{const e=document.getElementById("presale-balance-amount");if(e){e.innerHTML='<span class="loader !w-5 !h-5 inline-block"></span>';try{if(!d.signer||!d.signer.provider)throw new Error("Admin provider not found.");if(!w.publicSale)throw new Error("PublicSale address not configured.");const t=await d.signer.provider.getBalance(w.publicSale),a=dd.formatEther(t);e.textContent=`${parseFloat(a).toFixed(6)} ETH/BNB`}catch(t){console.error("Error loading presale balance:",t),e.textContent="Error"}}},If=async e=>{if(!d.signer){h("Por favor, conecte a carteira do Owner primeiro.","error");return}if(!window.confirm("Are you sure you want to withdraw ALL funds from the Presale contract to the Treasury wallet?"))return;const t=["function withdrawFunds() external"],a=w.publicSale,n=new dd.Contract(a,t,d.signer),i=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-2"></i> Withdrawing...';try{console.log(`Calling withdrawFunds() on ${a}...`);const r=await n.withdrawFunds();h("Transaction sent. Awaiting confirmation...","info");const s=await r.wait();console.log("Funds withdrawn successfully!",s.hash),h("Funds withdrawn successfully!","success",s.hash),Cr()}catch(r){console.error("Error withdrawing funds:",r);const s=r.reason||r.message||"Transaction failed.";h(`Error: ${s}`,"error")}finally{e.disabled=!1,e.innerHTML=i}},Af=async e=>{const t=e.target.closest("button[data-action]");if(!t||t.disabled)return;const a=t.dataset.action,n=t.dataset.submissionId,i=t.dataset.userId;if(!a||!n||!i){console.warn("Missing data attributes for admin action:",t.dataset);return}const r=t.closest("tr"),s=t.closest("td").querySelectorAll("button");r?(r.style.opacity="0.5",r.style.pointerEvents="none"):s.forEach(o=>o.disabled=!0);try{(a==="approved"||a==="rejected")&&(await co(i,n,a),h(`Submission ${a==="approved"?"APPROVED":"REJECTED"}!`,"success"),B.allSubmissions=B.allSubmissions.filter(o=>o.submissionId!==n),Bn())}catch(o){h(`Failed to ${a} submission: ${o.message}`,"error"),console.error(o),r&&(r.style.opacity="1",r.style.pointerEvents="auto")}},Bf=async e=>{const t=e.target.closest(".ban-user-btn");if(!t||t.disabled)return;const a=t.dataset.userId,n=t.dataset.action==="ban";if(!a)return;const i=n?`Are you sure you want to PERMANENTLY BAN this user?
(This is reversible)`:`Are you sure you want to UNBAN this user?
(This will reset their rejection count to 0)`;if(!window.confirm(i))return;const r=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>';try{await uo(a,n),h(`User ${n?"BANNED":"UNBANNED"}.`,"success");const s=B.allUsers.findIndex(o=>o.id===a);s>-1&&(B.allUsers[s].isBanned=n,B.allUsers[s].hasPendingAppeal=!1,n===!1&&(B.allUsers[s].rejectedCount=0)),wt()}catch(s){h(`Failed: ${s.message}`,"error"),t.disabled=!1,t.innerHTML=r}},zf=async e=>{const t=e.target.closest(".resolve-appeal-btn");if(!t||t.disabled)return;const a=t.dataset.userId,i=t.dataset.action==="approve";if(!a)return;const r=i?"Are you sure you want to APPROVE this appeal and UNBAN the user?":"Are you sure you want to DENY this appeal? The user will remain banned.";if(!window.confirm(r))return;const s=t.closest("td").querySelectorAll("button"),o=new Map;s.forEach(l=>{o.set(l,l.innerHTML),l.disabled=!0,l.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>'});try{i&&await uo(a,!1),h(`Appeal ${i?"APPROVED":"DENIED"}.`,"success");const l=B.allUsers.findIndex(c=>c.id===a);l>-1&&(B.allUsers[l].hasPendingAppeal=!1,i&&(B.allUsers[l].isBanned=!1,B.allUsers[l].rejectedCount=0)),wt()}catch(l){h(`Failed: ${l.message}`,"error"),s.forEach(c=>{c.disabled=!1,c.innerHTML=o.get(c)})}},Pf=async e=>{const t=e.target.closest(".re-approve-btn");if(!t||t.disabled)return;const a=t.dataset.submissionId,n=t.dataset.userId;if(!a||!n)return;const i=t.closest("tr");i&&(i.style.opacity="0.5"),t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i>';try{await co(n,a,"approved"),h("Submission re-approved!","success"),B.selectedUserSubmissions=B.selectedUserSubmissions.filter(s=>s.submissionId!==a),i&&i.remove();const r=B.allUsers.findIndex(s=>s.id===n);if(r>-1){const s=B.allUsers[r];s.rejectedCount=Math.max(0,(s.rejectedCount||0)-1),wt()}if(B.selectedUserSubmissions.length===0){const s=document.querySelector("#admin-user-modal .p-6");s&&(s.innerHTML='<p class="text-zinc-400 text-center p-8">This user has no rejected submissions.</p>')}}catch(r){h(`Failed to re-approve: ${r.message}`,"error"),i&&(i.style.opacity="1"),t.disabled=!1,t.innerHTML='<i class="fa-solid fa-check"></i> Re-Approve'}},Nf=async e=>{const t=e.target.closest(".view-rejected-btn");if(!t||t.disabled)return;const a=t.dataset.userId,n=t.dataset.wallet;if(a){B.selectedWallet=n,B.isSubmissionsModalOpen=!0,fi(!0,[]);try{const i=await rp(a,"rejected");B.selectedUserSubmissions=i,fi(!1,i)}catch(i){h(`Error fetching user submissions: ${i.message}`,"error"),fi(!1,[],!0)}}},$f=()=>{B.isSubmissionsModalOpen=!1,B.selectedUserSubmissions=[],B.selectedWallet=null;const e=document.getElementById("admin-user-modal");e&&e.remove(),document.body.style.overflow="auto"},Sf=e=>{const t=e.target.closest(".user-profile-link");if(!t)return;e.preventDefault();const a=t.dataset.userId;if(!a)return;const n=B.allUsers.find(i=>i.id===a);if(!n){h("Error: Could not find user data.","error");return}Df(n)},Lf=()=>{const e=document.getElementById("admin-user-profile-modal");e&&e.remove(),document.body.style.overflow="auto"},Rf=async e=>{e.preventDefault();const t=e.target;let a,n;try{if(a=new Date(t.startDate.value+"T00:00:00Z"),n=new Date(t.endDate.value+"T23:59:59Z"),isNaN(a.getTime())||isNaN(n.getTime()))throw new Error("Invalid date format.");if(a>=n)throw new Error("Start Date must be before End Date.")}catch(l){h(l.message,"error");return}const i={title:t.title.value.trim(),url:t.url.value.trim(),description:t.description.value.trim(),points:parseInt(t.points.value,10),cooldownHours:parseInt(t.cooldown.value,10),startDate:a,endDate:n};if(!i.title||!i.description){h("Please fill in Title and Description.","error");return}if(i.points<=0||i.cooldownHours<=0){h("Points and Cooldown must be positive numbers.","error");return}if(i.url&&!i.url.startsWith("http")){h("URL must start with http:// or https://","error");return}B.editingTask&&B.editingTask.id&&(i.id=B.editingTask.id);const r=t.querySelector('button[type="submit"]'),s=r.innerHTML;r.disabled=!0;const o=document.createElement("span");o.classList.add("inline-block"),r.innerHTML="",r.appendChild(o);try{await tp(i),h(`Task ${i.id?"updated":"created"} successfully!`,"success"),t.reset(),B.editingTask=null,Aa()}catch(l){h(`Failed to save task: ${l.message}`,"error"),console.error(l),r.disabled=!1,r.innerHTML=s}},_f=async e=>{e.preventDefault();const t=e.target,a={YouTube:parseInt(t.youtubePoints.value,10),"YouTube Shorts":parseInt(t.youtubeShortsPoints.value,10),Instagram:parseInt(t.instagramPoints.value,10),"X/Twitter":parseInt(t.xTwitterPoints.value,10),Facebook:parseInt(t.facebookPoints.value,10),Telegram:parseInt(t.telegramPoints.value,10),TikTok:parseInt(t.tiktokPoints.value,10),Reddit:parseInt(t.redditPoints.value,10),LinkedIn:parseInt(t.linkedinPoints.value,10),Other:parseInt(t.otherPoints.value,10)};if(Object.values(a).some(s=>isNaN(s)||s<0)){h("All points must be positive numbers (or 0).","error");return}const n=t.querySelector('button[type="submit"]'),i=n.innerHTML;n.disabled=!0;const r=document.createElement("span");r.classList.add("inline-block"),n.innerHTML="",n.appendChild(r);try{await Qu(a),h("UGC Base Points updated successfully!","success"),B.ugcBasePoints=a}catch(s){h(`Failed to update points: ${s.message}`,"error"),console.error(s)}finally{document.body.contains(n)&&(n.disabled=!1,n.innerHTML=i)}},Ff=e=>{const t=B.dailyTasks.find(a=>a.id===e);t&&(B.editingTask=t,Oa())},Mf=async e=>{if(window.confirm("Are you sure you want to delete this task permanently?"))try{await ap(e),h("Task deleted.","success"),B.editingTask=null,Aa()}catch(t){h(`Failed to delete task: ${t.message}`,"error"),console.error(t)}};function fi(e,t,a=!1){var s,o;const n=document.getElementById("admin-user-modal");n&&n.remove(),document.body.style.overflow="hidden";let i="";e?i='<div class="p-8"></div>':a?i='<p class="text-red-400 text-center p-8">Failed to load submissions.</p>':t.length===0?i='<p class="text-zinc-400 text-center p-8">This user has no rejected submissions.</p>':i=`
             <table class="w-full text-left min-w-[600px]">
                 <thead>
                     <tr class="border-b border-border-color text-xs text-zinc-400 uppercase">
                         <th class="p-3">Link</th>
                         <th class="p-3">Resolved</th>
                         <th class="p-3 text-right">Actions</th>
                     </tr>
                 </thead>
                 <tbody id="modal-submissions-tbody">
                     ${t.map(l=>`
                         <tr class="border-b border-border-color hover:bg-zinc-800/50">
                             <td class="p-3 text-sm max-w-xs truncate" title="${l.url}">
                                 <a href="${l.url}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">${l.url}</a>
                             </td>
                             <td class="p-3 text-xs">${l.resolvedAt?l.resolvedAt.toLocaleString("en-US"):"N/A"}</td>
                             <td class="p-3 text-right">
                                 <button data-user-id="${l.userId}" 
                                         data-submission-id="${l.submissionId}" 
                                         class="re-approve-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                                     <i class="fa-solid fa-check"></i> Re-Approve
                                 </button>
                             </td>
                         </tr>
                     `).join("")}
                 </tbody>
             </table>
         `;const r=`
         <div id="admin-user-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" style="backdrop-filter: blur(5px);">
             <div class="bg-sidebar border border-border-color rounded-xl shadow-lg w-full max-w-3xl max-h-[90vh] flex flex-col">
                 <div class="p-5 border-b border-border-color flex justify-between items-center">
                     <h2 class="text-xl font-bold text-white">Rejected Posts for ${la(B.selectedWallet)}</h2>
                     <button id="close-admin-modal-btn" class="text-zinc-400 hover:text-white text-2xl">&times;</button>
                 </div>
                 <div class="p-6 overflow-y-auto">
                     ${i}
                 </div>
             </div>
         </div>
     `;document.body.insertAdjacentHTML("beforeend",r),e&&document.getElementById("admin-user-modal").querySelector(".p-8"),(s=document.getElementById("close-admin-modal-btn"))==null||s.addEventListener("click",$f),(o=document.getElementById("modal-submissions-tbody"))==null||o.addEventListener("click",Pf)}function Df(e){var i;const t=document.getElementById("admin-user-profile-modal");t&&t.remove(),document.body.style.overflow="hidden";const a=e.isBanned?'<span class="text-xs font-bold py-1 px-3 rounded-full bg-red-600 text-white">BANNED</span>':e.hasPendingAppeal?'<span class="text-xs font-bold py-1 px-3 rounded-full bg-yellow-600 text-white">APPEALING</span>':'<span class="text-xs font-bold py-1 px-3 rounded-full bg-green-600 text-white">ACTIVE</span>',n=`
         <div id="admin-user-profile-modal" class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4" style="backdrop-filter: blur(5px);">
             <div class="bg-sidebar border border-border-color rounded-xl shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col">
                 <div class="p-5 border-b border-border-color flex justify-between items-center">
                     <h2 class="text-xl font-bold text-white">User Profile</h2>
                     <button id="close-admin-profile-modal-btn" class="text-zinc-400 hover:text-white text-2xl">&times;</button>
                 </div>
                 
                 <div class="p-6 overflow-y-auto space-y-4">
                    
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-zinc-100">${la(e.walletAddress)}</h3>
                        ${a}
                    </div>

                    <div class="bg-main p-4 rounded-lg border border-border-color space-y-3">
                        <div class="flex flex-wrap justify-between gap-2">
                            <span class="text-sm text-zinc-400">Full Wallet:</span>
                            <span class="text-sm text-zinc-200 font-mono break-all">${e.walletAddress||"N/A"}</span>
                        </div>
                        <div class="flex flex-wrap justify-between gap-2">
                            <span class="text-sm text-zinc-400">User ID:</span>
                            <span class="text-sm text-zinc-200 font-mono break-all">${e.id||"N/A"}</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Total Points</span>
                            <span class="block text-2xl font-bold text-yellow-400">${(e.totalPoints||0).toLocaleString("en-US")}</span>
                        </div>
                        <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Approved</span>
                            <span class="block text-2xl font-bold text-green-400">${(e.approvedSubmissionsCount||0).toLocaleString("en-US")}</span>
                        </div>
                         <div class="bg-main p-4 rounded-lg border border-border-color text-center">
                            <span class="block text-xs text-zinc-400 uppercase">Rejected</span>
                            <span class="block text-2xl font-bold text-red-400">${(e.rejectedCount||0).toLocaleString("en-US")}</span>
                        </div>
                    </div>

                    <div class="border-t border-border-color pt-4 text-right">
                        <p class="text-sm text-zinc-500 italic text-left">User actions (Ban, Unban, View Rejected) are available in the main table.</p>
                    </div>

                 </div>
             </div>
         </div>
     `;document.body.insertAdjacentHTML("beforeend",n),(i=document.getElementById("close-admin-profile-modal-btn"))==null||i.addEventListener("click",Lf)}const Of=e=>{const t=e.target.closest(".user-filter-btn");!t||t.classList.contains("active")||(B.usersFilter=t.dataset.filter||"all",B.usersPage=1,wt())},Hf=e=>{B.usersSearch=e.target.value,B.usersPage=1,wt()},Uf=e=>{B.usersPage=e,wt()},jf=e=>{B.submissionsPage=e,Bn()},Wf=e=>{B.tasksPage=e,Oa()},wt=()=>{var P,z;const e=document.getElementById("manage-users-content");if(!e)return;const t=B.allUsers;if(!t)return;const n=(B.usersSearch||"").toLowerCase().trim().replace(/[^a-z0-9x]/g,""),i=B.usersFilter;let r=t;n&&(r=r.filter(I=>{var F,K;return((F=I.walletAddress)==null?void 0:F.toLowerCase().includes(n))||((K=I.id)==null?void 0:K.toLowerCase().includes(n))})),i==="banned"?r=r.filter(I=>I.isBanned):i==="appealing"&&(r=r.filter(I=>I.hasPendingAppeal===!0));const s=t.length,o=t.filter(I=>I.isBanned).length,l=t.filter(I=>I.hasPendingAppeal===!0).length,c=r.sort((I,F)=>I.hasPendingAppeal!==F.hasPendingAppeal?I.hasPendingAppeal?-1:1:I.isBanned!==F.isBanned?I.isBanned?-1:1:(F.totalPoints||0)-(I.totalPoints||0)),u=B.usersPage,f=B.usersPerPage,p=c.length,b=Math.ceil(p/f),m=(u-1)*f,x=u*f,y=c.slice(m,x),C=y.length>0?y.map(I=>{let F="border-b border-border-color hover:bg-zinc-800/50",K="";return I.hasPendingAppeal?(F+=" bg-yellow-900/40",K='<span class="ml-2 text-xs font-bold text-yellow-300">[APPEALING]</span>'):I.isBanned&&(F+=" bg-red-900/30 opacity-70",K='<span class="ml-2 text-xs font-bold text-red-400">[BANNED]</span>'),`
        <tr class="${F}">
            <td class="p-3 text-xs text-zinc-300 font-mono" title="User ID: ${I.id}">
                <a href="#" class="user-profile-link font-bold text-blue-400 hover:underline" 
                   data-user-id="${I.id}" 
                   title="Click to view profile. Full Wallet: ${I.walletAddress||"N/A"}">
                    ${la(I.walletAddress)}
                </a>
                ${K}
            </td>
            <td class="p-3 text-sm font-bold text-yellow-400">${(I.totalPoints||0).toLocaleString("en-US")}</td>
            <td class="p-3 text-sm font-bold ${I.rejectedCount>0?"text-red-400":"text-zinc-400"}">${I.rejectedCount||0}</td>
            <td class="p-3 text-right">
                <div class="flex items-center justify-end gap-2">
                    ${I.hasPendingAppeal?`<button data-user-id="${I.id}" data-action="approve" 
                                   class="resolve-appeal-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-check"></i> Approve
                           </button>
                           <button data-user-id="${I.id}" data-action="deny" 
                                   class="resolve-appeal-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-times"></i> Deny
                           </button>`:`<button data-user-id="${I.id}" data-wallet="${I.walletAddress}" 
                                   class="view-rejected-btn bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded">
                               <i class="fa-solid fa-eye"></i> View Rejected
                           </button>
                           ${I.isBanned?`<button data-user-id="${I.id}" data-action="unban" 
                                            class="ban-user-btn bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">
                                       <i class="fa-solid fa-check"></i> Unban
                                   </button>`:`<button data-user-id="${I.id}" data-action="ban" 
                                            class="ban-user-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">
                                       <i class="fa-solid fa-ban"></i> Ban
                                   </button>`}`}
                </div>
            </td>
        </tr>
    `}).join(""):`
        <tr>
            <td colspan="4" class="p-8 text-center text-zinc-400">
                ${s===0?"No users found in Airdrop.":"No users match the current filters."}
            </td>
        </tr>
    `;e.innerHTML=`
        <h2 class="text-2xl font-bold mb-4">Manage Users (${s})</h2>
        
        <div class="mb-4 p-4 bg-zinc-800 rounded-xl border border-border-color flex flex-wrap gap-4 justify-between items-center">
            <div id="user-filters-nav" class="flex items-center gap-2">
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${i==="all"?"bg-blue-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="all">
                    All (${s})
                </button>
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${i==="banned"?"bg-red-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="banned">
                    Banned (${o})
                </button>
                <button class="user-filter-btn text-sm py-2 px-4 rounded-md ${i==="appealing"?"bg-yellow-600 text-white font-bold":"bg-zinc-700 hover:bg-zinc-600 text-zinc-300"}" data-filter="appealing">
                    Appealing (${l})
                </button>
            </div>
            <div class="relative flex-grow max-w-xs">
                <input type="text" id="user-search-input" class="form-input pl-10" placeholder="Search Wallet or User ID..." value="${B.usersSearch}">
                <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-zinc-400"></i>
            </div>
        </div>

        <div class="bg-zinc-800 rounded-xl border border-border-color overflow-x-auto">
            <table class="w-full text-left min-w-[700px]">
                <thead>
                    <tr class="bg-main border-b border-border-color text-xs text-zinc-400 uppercase">
                        <th class="p-3">Wallet / User ID</th>
                        <th class="p-3">Total Points</th>
                        <th class="p-3">Rejections</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-users-tbody">${C}</tbody>
            </table>
        </div>
        
        <div id="admin-users-pagination" class="mt-6"></div>
    `;const A=document.getElementById("admin-users-pagination");A&&b>1&&Ji(A,B.usersPage,b,Uf),(P=document.getElementById("admin-users-tbody"))==null||P.addEventListener("click",I=>{I.target.closest(".user-profile-link")&&Sf(I),I.target.closest(".ban-user-btn")&&Bf(I),I.target.closest(".view-rejected-btn")&&Nf(I),I.target.closest(".resolve-appeal-btn")&&zf(I)}),(z=document.getElementById("user-filters-nav"))==null||z.addEventListener("click",Of);const N=document.getElementById("user-search-input");if(N){let I;N.addEventListener("keyup",F=>{clearTimeout(I),I=setTimeout(()=>Hf(F),300)})}},Bs=()=>{var n;const e=document.getElementById("manage-ugc-points-content");if(!e)return;const t=B.ugcBasePoints;if(!t)return;const a={YouTube:5e3,"YouTube Shorts":2500,Instagram:3e3,"X/Twitter":1500,Facebook:2e3,Telegram:1e3,TikTok:3500,Reddit:1800,LinkedIn:2200,Other:1e3};e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">Manage UGC Base Points</h2>
        <p class="text-sm text-zinc-400 mb-6 max-w-2xl mx-auto">
            Defina os pontos base concedidos para cada plataforma de divulgaÃ§Ã£o (UGC). 
            Este valor serÃ¡ "exportado" para a pÃ¡gina do airdrop e Ã© o valor usado 
            <strong>antes</strong> do multiplicador do usuÃ¡rio ser aplicado.
        </p>
        <form id="ugcPointsForm" class="bg-zinc-800 p-6 rounded-xl space-y-4 border border-border-color max-w-lg mx-auto">
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">YouTube:</label>
                    <input type="number" name="youtubePoints" class="form-input" value="${t.YouTube!==void 0?t.YouTube:a.YouTube}" required>
                </div>
                 <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">YouTube Shorts:</label>
                    <input type="number" name="youtubeShortsPoints" class="form-input" value="${t["YouTube Shorts"]!==void 0?t["YouTube Shorts"]:a["YouTube Shorts"]}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Instagram:</label>
                    <input type="number" name="instagramPoints" class="form-input" value="${t.Instagram!==void 0?t.Instagram:a.Instagram}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">TikTok:</label>
                    <input type="number" name="tiktokPoints" class="form-input" value="${t.TikTok!==void 0?t.TikTok:a.TikTok}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">X/Twitter:</label>
                    <input type="number" name="xTwitterPoints" class="form-input" value="${t["X/Twitter"]!==void 0?t["X/Twitter"]:a["X/Twitter"]}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Facebook:</label>
                    <input type="number" name="facebookPoints" class="form-input" value="${t.Facebook!==void 0?t.Facebook:a.Facebook}" required>
                </div>
            </div>

             <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Reddit:</label>
                    <input type="number" name="redditPoints" class="form-input" value="${t.Reddit!==void 0?t.Reddit:a.Reddit}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">LinkedIn:</label>
                    <input type="number" name="linkedinPoints" class="form-input" value="${t.LinkedIn!==void 0?t.LinkedIn:a.LinkedIn}" required>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                 <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Telegram:</label>
                    <input type="number" name="telegramPoints" class="form-input" value="${t.Telegram!==void 0?t.Telegram:a.Telegram}" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1 text-zinc-300">Other Platform:</label>
                    <input type="number" name="otherPoints" class="form-input" value="${t.Other!==void 0?t.Other:a.Other}" required>
                </div>
            </div>
            
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-md transition-colors shadow-md mt-6">
                <i class="fa-solid fa-save mr-2"></i>Save Base Points
            </button>
        </form>
    `,(n=document.getElementById("ugcPointsForm"))==null||n.addEventListener("submit",_f)},Oa=()=>{var m,x,y;const e=document.getElementById("manage-tasks-content");if(!e)return;const t=B.editingTask,a=!!t,n=C=>{if(!C)return"";try{return(C.toDate?C.toDate():C instanceof Date?C:new Date(C)).toISOString().split("T")[0]}catch{return""}},i=B.tasksPage,r=B.tasksPerPage,s=[...B.dailyTasks].sort((C,A)=>{var z,I;const N=(z=C.startDate)!=null&&z.toDate?C.startDate.toDate():new Date(C.startDate||0);return((I=A.startDate)!=null&&I.toDate?A.startDate.toDate():new Date(A.startDate||0)).getTime()-N.getTime()}),o=s.length,l=Math.ceil(o/r),c=(i-1)*r,u=i*r,f=s.slice(c,u),p=f.length>0?f.map(C=>{var I,F;const A=new Date,N=(I=C.startDate)!=null&&I.toDate?C.startDate.toDate():C.startDate?new Date(C.startDate):null,P=(F=C.endDate)!=null&&F.toDate?C.endDate.toDate():C.endDate?new Date(C.endDate):null;let z="text-zinc-500";return N&&P&&(A>=N&&A<=P?z="text-green-400":A<N&&(z="text-blue-400")),`
        <div class="bg-zinc-800 p-4 rounded-lg border border-border-color flex justify-between items-center flex-wrap gap-3">
            <div class="flex-1 min-w-[250px]">
                <p class="font-semibold text-white">${C.title||"No Title"}</p>
                 <p class="text-xs text-zinc-400 mt-0.5">${C.description||"No Description"}</p>
                <p class="text-xs ${z} mt-1">
                   <span class="font-medium text-amber-400">${C.points||0} Pts</span> |
                   <span class="text-blue-400">${C.cooldownHours||0}h CD</span> |
                   Active: ${n(C.startDate)} to ${n(C.endDate)}
                </p>
                ${C.url?`<a href="${C.url}" target="_blank" rel="noopener noreferrer" class="text-xs text-blue-400 hover:underline break-all block mt-1">${C.url}</a>`:""}
            </div>
            <div class="flex gap-2 shrink-0">
                <button data-id="${C.id}" data-action="edit" class="edit-task-btn bg-amber-600 hover:bg-amber-700 text-black text-xs font-bold py-1 px-3 rounded-md transition-colors"><i class="fa-solid fa-pencil mr-1"></i>Edit</button>
                <button data-id="${C.id}" data-action="delete" class="delete-task-btn bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-3 rounded-md transition-colors"><i class="fa-solid fa-trash mr-1"></i>Delete</button>
            </div>
        </div>
    `}).join(""):document.createElement("div").innerHTML;e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">${a?"Edit Daily Task":"Create New Daily Task"}</h2>

        <form id="taskForm" class="bg-zinc-800 p-6 rounded-xl space-y-4 border border-border-color">
            <input type="hidden" name="id" value="${(t==null?void 0:t.id)||""}">
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Task Title:</label><input type="text" name="title" class="form-input" value="${(t==null?void 0:t.title)||""}" required></div>
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Description:</label><input type="text" name="description" class="form-input" value="${(t==null?void 0:t.description)||""}" required></div>
            <div><label class="block text-sm font-medium mb-1 text-zinc-300">Link URL (Optional):</label><input type="url" name="url" class="form-input" value="${(t==null?void 0:t.url)||""}" placeholder="https://..."></div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Points (Base):</label><input type="number" name="points" class="form-input" value="${(t==null?void 0:t.points)||10}" min="1" required></div>
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Cooldown (Hours):</label><input type="number" name="cooldown" class="form-input" value="${(t==null?void 0:t.cooldownHours)||24}" min="1" required></div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">Start Date (UTC):</label><input type="date" name="startDate" class="form-input" value="${n(t==null?void 0:t.startDate)}" required></div>
                <div><label class="block text-sm font-medium mb-1 text-zinc-300">End Date (UTC):</label><input type="date" name="endDate" class="form-input" value="${n(t==null?void 0:t.endDate)}" required></div>
            </div>

            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-md transition-colors shadow-md">
                ${a?'<i class="fa-solid fa-save mr-2"></i>Save Changes':'<i class="fa-solid fa-plus mr-2"></i>Create Task'}
            </button>
            ${a?'<button type="button" id="cancelEditBtn" class="w-full mt-2 bg-zinc-600 hover:bg-zinc-700 text-white font-bold py-2 rounded-md transition-colors">Cancel Edit</button>':""}
        </form>

        <h3 class="text-xl font-bold mt-10 mb-4 border-t border-border-color pt-6">Existing Tasks (${o})</h3>
        <div id="existing-tasks-list" class="space-y-3">
            ${p}
        </div>
        <div id="admin-tasks-pagination" class="mt-6"></div>
    `;const b=document.getElementById("admin-tasks-pagination");b&&l>1&&Ji(b,B.tasksPage,l,Wf),(m=document.getElementById("taskForm"))==null||m.addEventListener("submit",Rf),(x=document.getElementById("cancelEditBtn"))==null||x.addEventListener("click",()=>{B.editingTask=null,Oa()}),(y=document.getElementById("existing-tasks-list"))==null||y.addEventListener("click",C=>{const A=C.target.closest("button[data-id]");if(!A)return;const N=A.dataset.id;A.dataset.action==="edit"&&Ff(N),A.dataset.action==="delete"&&Mf(N)})},Bn=()=>{var f;const e=document.getElementById("submissions-content");if(!e)return;if(!B.allSubmissions||B.allSubmissions.length===0){const p=document.createElement("div");e.innerHTML=p.innerHTML;return}const t=B.submissionsPage,a=B.submissionsPerPage,n=[...B.allSubmissions].sort((p,b)=>{var m,x;return(((m=b.submittedAt)==null?void 0:m.getTime())||0)-(((x=p.submittedAt)==null?void 0:x.getTime())||0)}),i=n.length,r=Math.ceil(i/a),s=(t-1)*a,o=t*a,c=n.slice(s,o).map(p=>{var b,m;return`
        <tr class="border-b border-border-color hover:bg-zinc-800/50">
            <td class="p-3 text-xs text-zinc-400 font-mono" title="${p.userId}">${la(p.walletAddress)}</td>
            <td class="p-3 text-sm max-w-xs truncate" title="${p.normalizedUrl}">
                <a href="${p.normalizedUrl}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">${p.normalizedUrl}</a>
                <span class="block text-xs text-zinc-500">${p.platform||"N/A"} - ${p.basePoints||0} base pts</span>
            </td>
            <td class="p-3 text-xs text-zinc-400">${p.submittedAt?p.submittedAt.toLocaleString("en-US"):"N/A"}</td>
            <td class="p-3 text-xs font-semibold ${((b=As[p.status])==null?void 0:b.color)||"text-gray-500"}">${((m=As[p.status])==null?void 0:m.text)||p.status}</td>
            <td class="p-3 text-right">
                <div class="flex items-center justify-end gap-2">
                    
                    <button data-user-id="${p.userId}" data-submission-id="${p.submissionId}" data-action="approved" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded transition-colors"><i class="fa-solid fa-check"></i></button>
                    <button data-user-id="${p.userId}" data-submission-id="${p.submissionId}" data-action="rejected" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded transition-colors ml-1"><i class="fa-solid fa-times"></i></button>
                    </div>
            </td>
        </tr>
    `}).join("");e.innerHTML=`
        <h2 class="text-2xl font-bold mb-6">Review Pending Submissions (${n.length})</h2>
        <div class="bg-zinc-800 rounded-xl border border-border-color overflow-x-auto">
            <table class="w-full text-left min-w-[700px]">
                <thead>
                    <tr class="bg-main border-b border-border-color text-xs text-zinc-400 uppercase">
                        <th class="p-3 font-semibold">Wallet</th>
                        <th class="p-3 font-semibold">Link & Platform</th>
                        <th class="p-3 font-semibold">Submitted</th>
                        <th class="p-3 font-semibold">Status</th>
                        <th class="p-3 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-submissions-tbody">${c}</tbody>
            </table>
        </div>
        <div id="admin-submissions-pagination" class="mt-6"></div>
    `;const u=document.getElementById("admin-submissions-pagination");u&&r>1&&Ji(u,B.submissionsPage,r,jf),(f=document.getElementById("admin-submissions-tbody"))==null||f.addEventListener("click",Af)},zn=()=>{var r,s;const e=document.getElementById("platform-usage-content");if(!e)return;const t=B.platformUsageConfig||Wn;let a=0;Object.values(t).forEach(o=>{o.enabled!==!1&&(a+=(o.points||0)*(o.maxCount||1))});const n=Object.entries(t).map(([o,l])=>`
        <tr class="border-b border-zinc-700/50 hover:bg-zinc-800/50" data-action-key="${o}">
            <td class="p-3">
                <div class="flex items-center gap-2">
                    <span class="text-xl">${l.icon||"âš¡"}</span>
                    <span class="text-white font-medium">${l.label||o}</span>
                </div>
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-20 text-amber-400 font-bold text-center" 
                       data-field="points" value="${l.points||0}" min="0" step="100">
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-16 text-white text-center" 
                       data-field="maxCount" value="${l.maxCount||1}" min="1" max="100">
            </td>
            <td class="p-3">
                <input type="number" class="platform-input bg-zinc-900 border border-zinc-700 rounded px-2 py-1 w-16 text-white text-center" 
                       data-field="cooldownHours" value="${l.cooldownHours||0}" min="0" max="168">
            </td>
            <td class="p-3 text-center">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer platform-toggle" data-field="enabled" ${l.enabled!==!1?"checked":""}>
                    <div class="w-9 h-5 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600"></div>
                </label>
            </td>
            <td class="p-3 text-right text-xs text-zinc-400">
                ${((l.points||0)*(l.maxCount||1)).toLocaleString()}
            </td>
        </tr>
    `).join("");e.innerHTML=`
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-2">Platform Usage Points Configuration</h2>
            <p class="text-zinc-400 text-sm">Configure points awarded for using platform features. Changes are saved immediately.</p>
        </div>

        <!-- Stats Summary -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-amber-400">${Object.keys(t).length}</span>
                <p class="text-xs text-zinc-500 mt-1">Total Actions</p>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-green-400">${Object.values(t).filter(o=>o.enabled!==!1).length}</span>
                <p class="text-xs text-zinc-500 mt-1">Enabled</p>
            </div>
            <div class="bg-zinc-800 border border-zinc-700 rounded-xl p-4 text-center">
                <span class="text-2xl font-bold text-purple-400">${a.toLocaleString()}</span>
                <p class="text-xs text-zinc-500 mt-1">Max Points Possible</p>
            </div>
        </div>

        <!-- Actions Table -->
        <div class="bg-zinc-800 rounded-xl border border-zinc-700 overflow-hidden">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-zinc-900 border-b border-zinc-700 text-xs text-zinc-400 uppercase">
                        <th class="p-3 font-semibold">Action</th>
                        <th class="p-3 font-semibold">Points</th>
                        <th class="p-3 font-semibold">Max Count</th>
                        <th class="p-3 font-semibold">Cooldown (h)</th>
                        <th class="p-3 font-semibold text-center">Enabled</th>
                        <th class="p-3 font-semibold text-right">Max Total</th>
                    </tr>
                </thead>
                <tbody id="platform-usage-tbody">
                    ${n}
                </tbody>
            </table>
        </div>

        <!-- Save Button -->
        <div class="mt-6 flex justify-end gap-3">
            <button id="reset-platform-config-btn" class="px-4 py-2 bg-zinc-700 hover:bg-zinc-600 text-white rounded-lg transition-colors">
                <i class="fa-solid fa-rotate-left mr-2"></i>Reset to Default
            </button>
            <button id="save-platform-config-btn" class="px-6 py-2 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-lg transition-colors">
                <i class="fa-solid fa-save mr-2"></i>Save Configuration
            </button>
        </div>

        <!-- Info Box -->
        <div class="mt-6 p-4 bg-blue-900/20 border border-blue-500/30 rounded-xl">
            <h4 class="text-blue-400 font-bold mb-2"><i class="fa-solid fa-info-circle mr-2"></i>How It Works</h4>
            <ul class="text-zinc-400 text-sm space-y-1">
                <li>â€¢ <strong>Points:</strong> Amount awarded per action</li>
                <li>â€¢ <strong>Max Count:</strong> Maximum times a user can earn points for this action</li>
                <li>â€¢ <strong>Cooldown:</strong> Hours between earning points (0 = no cooldown)</li>
                <li>â€¢ <strong>Enabled:</strong> Toggle to enable/disable this action</li>
                <li>â€¢ Points are tracked with transaction hashes to prevent fraud</li>
            </ul>
        </div>
    `;const i=document.getElementById("platform-usage-tbody");i==null||i.addEventListener("input",zs),i==null||i.addEventListener("change",zs),(r=document.getElementById("save-platform-config-btn"))==null||r.addEventListener("click",Gf),(s=document.getElementById("reset-platform-config-btn"))==null||s.addEventListener("click",Kf)},zs=e=>{const t=e.target;if(!t.classList.contains("platform-input")&&!t.classList.contains("platform-toggle"))return;const a=t.closest("tr"),n=a==null?void 0:a.dataset.actionKey,i=t.dataset.field;if(!n||!i)return;B.platformUsageConfig[n]||(B.platformUsageConfig[n]={...Wn[n]}),i==="enabled"?B.platformUsageConfig[n].enabled=t.checked:B.platformUsageConfig[n][i]=parseInt(t.value)||0;const r=B.platformUsageConfig[n],s=a.querySelector("td:last-child");s&&(s.textContent=((r.points||0)*(r.maxCount||1)).toLocaleString())},Gf=async e=>{const t=e.target.closest("button");if(!t)return;const a=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="fa-solid fa-spinner fa-spin mr-2"></i>Saving...';try{await po(B.platformUsageConfig),h("âœ… Platform Usage config saved!","success"),zn()}catch(n){console.error("Error saving platform config:",n),h("Failed to save config: "+n.message,"error")}finally{t.disabled=!1,t.innerHTML=a}},Kf=async()=>{if(confirm("Are you sure you want to reset to default values? This will save immediately."))try{B.platformUsageConfig={...Wn},await po(B.platformUsageConfig),h("âœ… Config reset to defaults!","success"),zn()}catch(e){console.error("Error resetting platform config:",e),h("Failed to reset config: "+e.message,"error")}},Yf=()=>{var a;const e=document.getElementById("admin-content-wrapper");if(!e)return;e.innerHTML=`
        <div id="presale-withdraw-panel" class="mb-8 p-6 bg-zinc-800 rounded-xl border border-border-color flex flex-col md:flex-row gap-4 justify-between items-center">
            <div>
                <h3 class="text-xl font-bold text-white">Presale Contract Funds</h3>
                <p class="text-sm text-zinc-400">Total accumulated in the PublicSale contract available for withdrawal.</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <span class="block text-2xl font-bold text-amber-400" id="presale-balance-amount">
                        <span class="loader !w-5 !h-5 inline-block"></span>
                    </span>
                    <span class="text-xs text-zinc-500">ETH/BNB Balance</span>
                </div>
                <button id="withdraw-presale-funds-btn" class="btn-primary py-3 px-5 whitespace-nowrap">
                    <i class="fa-solid fa-download mr-2"></i> Withdraw Funds
                </button>
            </div>
        </div>

        <h1 class="text-3xl font-bold mb-8">Airdrop Admin Panel</h1>
    
    
        <div class="border-b border-border-color mb-6">
            <nav id="admin-tabs" class="-mb-px flex flex-wrap gap-x-6 gap-y-2">
                <button class="tab-btn ${B.activeTab==="review-submissions"?"active":""}" data-target="review-submissions">Review Submissions</button>
                <button class="tab-btn ${B.activeTab==="manage-users"?"active":""}" data-target="manage-users">Manage Users</button>
                <button class="tab-btn ${B.activeTab==="manage-ugc-points"?"active":""}" data-target="manage-ugc-points">Manage UGC Points</button>
                <button class="tab-btn ${B.activeTab==="manage-tasks"?"active":""}" data-target="manage-tasks">Manage Daily Tasks</button>
                <button class="tab-btn ${B.activeTab==="platform-usage"?"active":""}" data-target="platform-usage">Platform Usage</button>
            </nav>
        </div>

        <div id="review_submissions_tab" class="tab-content ${B.activeTab==="review-submissions"?"active":""}">
            <div id="submissions-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="manage_users_tab" class="tab-content ${B.activeTab==="manage-users"?"active":""}">
            <div id="manage-users-content" class="max-w-7xl mx-auto"></div>
        </div>

        <div id="manage_ugc_points_tab" class="tab-content ${B.activeTab==="manage-ugc-points"?"active":""}">
            <div id="manage-ugc-points-content" class="max-w-4xl mx-auto"></div>
        </div>

        <div id="manage_tasks_tab" class="tab-content ${B.activeTab==="manage-tasks"?"active":""}">
            <div id="manage-tasks-content" class="max-w-4xl mx-auto"></div>
        </div>

        <div id="platform_usage_tab" class="tab-content ${B.activeTab==="platform-usage"?"active":""}">
            <div id="platform-usage-content" class="max-w-4xl mx-auto"></div>
        </div>
    `,(a=document.getElementById("withdraw-presale-funds-btn"))==null||a.addEventListener("click",n=>If(n.target)),Cr(),B.activeTab==="manage-ugc-points"?Bs():B.activeTab==="manage-tasks"?Oa():B.activeTab==="review-submissions"?Bn():B.activeTab==="manage-users"?wt():B.activeTab==="platform-usage"&&zn();const t=document.getElementById("admin-tabs");t&&!t._listenerAttached&&(t.addEventListener("click",n=>{const i=n.target.closest(".tab-btn");if(!i||i.classList.contains("active"))return;const r=i.dataset.target;B.activeTab=r,r!=="manage-users"&&(B.usersPage=1,B.usersFilter="all",B.usersSearch=""),r!=="review-submissions"&&(B.submissionsPage=1),r!=="manage-tasks"&&(B.tasksPage=1),document.querySelectorAll("#admin-tabs .tab-btn").forEach(o=>o.classList.remove("active")),i.classList.add("active"),e.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active"));const s=document.getElementById(r.replace(/-/g,"_")+"_tab");s?(s.classList.add("active"),r==="manage-ugc-points"&&Bs(),r==="manage-tasks"&&Oa(),r==="review-submissions"&&Bn(),r==="manage-users"&&wt(),r==="platform-usage"&&zn()):console.warn(`Tab content container not found for target: ${r}`)}),t._listenerAttached=!0)},Vf={render(){const e=document.getElementById("admin");if(e){if(!Cf()){e.innerHTML='<div class="text-center text-red-400 p-8 bg-sidebar border border-red-500/50 rounded-lg">Access Denied. This page is restricted to administrators.</div>';return}if(Is()){e.innerHTML='<div id="admin-content-wrapper"></div>',Aa();return}e.innerHTML=`
            <div class="flex items-center justify-center min-h-[60vh]">
                <div class="bg-sidebar border border-yellow-500/30 rounded-2xl p-8 max-w-md w-full shadow-xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-shield-halved text-3xl text-yellow-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Admin Access</h2>
                        <p class="text-zinc-400 text-sm">Enter the admin key to continue</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-zinc-400 text-sm mb-2">Admin Key</label>
                            <input type="password" id="admin-key-input" 
                                   class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-yellow-500 focus:outline-none"
                                   placeholder="Enter admin key"
                                   onkeypress="if(event.key === 'Enter') document.getElementById('admin-login-btn').click()">
                        </div>
                        
                        <button id="admin-login-btn"
                                class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 px-4 rounded-xl transition-colors">
                            <i class="fa-solid fa-unlock mr-2"></i>Access Admin Panel
                        </button>
                        
                        <p id="admin-login-error" class="text-red-400 text-sm text-center hidden">
                            <i class="fa-solid fa-exclamation-circle mr-1"></i>Incorrect key
                        </p>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-zinc-800">
                        <p class="text-zinc-500 text-xs text-center">
                            <i class="fa-solid fa-wallet mr-1"></i>Connected: ${la(d.userAddress)}
                        </p>
                    </div>
                </div>
            </div>
        `,document.getElementById("admin-login-btn").addEventListener("click",()=>{const t=document.getElementById("admin-key-input"),a=document.getElementById("admin-login-error");t.value===Ef?(Tf(),h("âœ… Admin access granted!","success"),e.innerHTML='<div id="admin-content-wrapper"></div>',Aa()):(a.classList.remove("hidden"),t.value="",t.focus(),setTimeout(()=>a.classList.add("hidden"),3e3))}),setTimeout(()=>{var t;(t=document.getElementById("admin-key-input"))==null||t.focus()},100)}},refreshData(){const e=document.getElementById("admin");e&&!e.classList.contains("hidden")&&Is()&&(console.log("Refreshing Admin Page data..."),Aa(),Cr())}},bi=2e8,Ps={airdrop:{amount:7e7},liquidity:{amount:13e7}},qf=()=>{if(document.getElementById("tokenomics-styles-v5"))return;const e=document.createElement("style");e.id="tokenomics-styles-v5",e.innerHTML=`
        @keyframes float-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.2); }
            50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.4); }
        }
        
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes flow-right {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        
        .tk-float { animation: float-gentle 4s ease-in-out infinite; }
        .tk-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .tk-fade-up { animation: fade-in-up 0.6s ease-out forwards; }
        .tk-spin { animation: spin-slow 20s linear infinite; }
        
        .tk-section {
            background: linear-gradient(180deg, rgba(24,24,27,0.8) 0%, rgba(9,9,11,0.9) 100%);
            border: 1px solid rgba(63,63,70,0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .tk-card {
            background: rgba(39,39,42,0.4);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 0.75rem;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        .tk-card:hover {
            border-color: rgba(245,158,11,0.3);
            transform: translateY(-2px);
        }
        
        .tk-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .tk-flow-line {
            position: relative;
            height: 2px;
            background: rgba(63,63,70,0.5);
            overflow: hidden;
        }
        
        .tk-flow-line::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, #f59e0b, transparent);
            animation: flow-right 2s linear infinite;
        }
        
        .tk-pie-ring {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            position: relative;
        }
        
        .tk-pie-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            background: #09090b;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #27272a;
        }
        
        .tk-progress-bar {
            height: 8px;
            background: rgba(63,63,70,0.5);
            border-radius: 999px;
            overflow: hidden;
        }
        
        .tk-progress-fill {
            height: 100%;
            border-radius: 999px;
            transition: width 1s ease-out;
        }
        
        .tk-icon-box {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .tk-stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        @media (min-width: 640px) {
            .tk-stat-grid { grid-template-columns: repeat(4, 1fr); }
        }
        
        .tk-timeline {
            position: relative;
            padding-left: 2rem;
        }
        
        .tk-timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, #f59e0b, #10b981);
        }
        
        .tk-timeline-item {
            position: relative;
            padding-bottom: 1.5rem;
        }
        
        .tk-timeline-dot {
            position: absolute;
            left: -1.75rem;
            top: 0.25rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid;
        }
    `,document.head.appendChild(e)},Ba=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(0)+"K":e.toLocaleString();function Xf(){return`
        <div class="text-center mb-6 tk-fade-up">
            <div class="relative inline-block mb-4">
                <img src="./assets/bkc_logo_3d.png" class="w-20 h-20 tk-float tk-glow rounded-full" alt="BKC">
            </div>
            <h1 class="text-2xl font-black text-white mb-2">
                <span class="bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">BACKCOIN</span>
                <span class="text-zinc-400 font-normal">Tokenomics</span>
            </h1>
            <p class="text-zinc-500 text-sm max-w-md mx-auto">
                An ecosystem designed for <span class="text-amber-400">sustainable growth</span>, 
                <span class="text-emerald-400">community rewards</span>, and 
                <span class="text-purple-400">real utility</span>
            </p>
        </div>
    `}function Jf(){const e=d.totalSupply?M(d.totalSupply):4e7,t=(e/bi*100).toFixed(1);return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.1s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-coins text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">Token Supply</h2>
                    <p class="text-zinc-500 text-xs">BKC Token Distribution</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Max Supply</p>
                    <p class="text-xl font-black text-white">${Ba(bi)}</p>
                    <p class="text-amber-400 text-xs">BKC</p>
                </div>
                <div class="tk-card text-center">
                    <p class="text-zinc-500 text-[10px] uppercase mb-1">Current Supply</p>
                    <p class="text-xl font-black text-emerald-400">${Ba(e)}</p>
                    <p class="text-zinc-500 text-xs">${t}% minted</p>
                </div>
            </div>
            
            <div class="tk-progress-bar mb-2">
                <div class="tk-progress-fill bg-gradient-to-r from-amber-500 to-emerald-500" style="width: ${t}%"></div>
            </div>
            <p class="text-center text-zinc-600 text-[10px]">
                <i class="fa-solid fa-hammer mr-1"></i>
                Remaining ${Ba(bi-e)} BKC to be mined through ecosystem activity
            </p>
        </div>
    `}function Zf(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.2s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-purple-500/20">
                    <i class="fa-solid fa-rocket text-purple-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">TGE Distribution</h2>
                    <p class="text-zinc-500 text-xs">Token Generation Event</p>
                </div>
            </div>
            
            <div class="flex items-center justify-center gap-6 mb-4">
                <!-- Pie Chart -->
                <div class="tk-pie-ring" style="background: conic-gradient(#f59e0b 0% 35%, #10b981 35% 100%);">
                    <div class="tk-pie-center">
                        <p class="text-2xl font-black text-white">TGE</p>
                        <p class="text-[10px] text-zinc-500">Initial</p>
                    </div>
                </div>
                
                <!-- Legend -->
                <div class="space-y-3">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                        <div>
                            <p class="text-white font-bold text-sm">35% Airdrop</p>
                            <p class="text-zinc-500 text-[10px]">${Ba(Ps.airdrop.amount)} BKC</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                        <div>
                            <p class="text-white font-bold text-sm">65% Liquidity</p>
                            <p class="text-zinc-500 text-[10px]">${Ba(Ps.liquidity.amount)} BKC</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Airdrop Details -->
            <div class="tk-card bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/30">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xl">ðŸª‚</span>
                    <div>
                        <p class="text-amber-400 font-bold text-sm">Community Airdrop</p>
                        <p class="text-zinc-500 text-[10px]">35% of TGE = 70M BKC</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-zinc-900/50 rounded-lg p-3 text-center">
                        <p class="text-zinc-500 text-[10px] uppercase mb-1">Round 1</p>
                        <p class="text-white font-bold">Early Supporters</p>
                        <p class="text-amber-400 text-xs">Points-based</p>
                    </div>
                    <div class="bg-zinc-900/50 rounded-lg p-3 text-center">
                        <p class="text-zinc-500 text-[10px] uppercase mb-1">Round 2</p>
                        <p class="text-white font-bold">Active Users</p>
                        <p class="text-amber-400 text-xs">Activity-based</p>
                    </div>
                </div>
                
                <p class="text-center text-zinc-600 text-[10px] mt-3">
                    <i class="fa-solid fa-circle-info mr-1"></i>
                    Earn airdrop points by using the platform: staking, notarizing, playing Fortune Pool, and more!
                </p>
            </div>
        </div>
    `}function Qf(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.3s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-emerald-500/20">
                    <i class="fa-solid fa-hammer text-emerald-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">Mining by Purchase</h2>
                    <p class="text-zinc-500 text-xs">New tokens minted when you buy NFTs</p>
                </div>
            </div>
            
            <div class="tk-card mb-4">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-zinc-400 text-sm">How it works</span>
                    <span class="tk-badge bg-emerald-500/20 text-emerald-400">
                        <i class="fa-solid fa-bolt mr-1"></i>Active
                    </span>
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span class="text-blue-400 text-xs font-bold">1</span>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">Buy NFT Booster</p>
                            <p class="text-zinc-500 text-xs">Purchase from any liquidity pool</p>
                        </div>
                    </div>
                    
                    <div class="tk-flow-line my-2"></div>
                    
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span class="text-emerald-400 text-xs font-bold">2</span>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">New BKC Minted</p>
                            <p class="text-zinc-500 text-xs">Fresh tokens created from your purchase</p>
                        </div>
                    </div>
                    
                    <div class="tk-flow-line my-2"></div>
                    
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 rounded-full bg-purple-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                            <span class="text-purple-400 text-xs font-bold">3</span>
                        </div>
                        <div>
                            <p class="text-white text-sm font-medium">Distributed to Stakers</p>
                            <p class="text-zinc-500 text-xs">70% to delegators, 30% to treasury</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mining Distribution -->
            <div class="grid grid-cols-2 gap-3">
                <div class="tk-card text-center bg-gradient-to-br from-purple-500/10 to-violet-500/10 border-purple-500/30">
                    <div class="text-3xl font-black text-purple-400 mb-1">70%</div>
                    <p class="text-white text-sm font-medium">Stakers</p>
                    <p class="text-zinc-500 text-[10px]">Reward Pool</p>
                </div>
                <div class="tk-card text-center bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border-blue-500/30">
                    <div class="text-3xl font-black text-blue-400 mb-1">30%</div>
                    <p class="text-white text-sm font-medium">Treasury</p>
                    <p class="text-zinc-500 text-[10px]">Development</p>
                </div>
            </div>
        </div>
    `}function eb(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.4s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-cyan-500/20">
                    <i class="fa-solid fa-percent text-cyan-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">Platform Fees</h2>
                    <p class="text-zinc-500 text-xs">All fees benefit the ecosystem</p>
                </div>
            </div>
            
            <!-- Fee Distribution Banner -->
            <div class="tk-card bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border-emerald-500/30 mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-chart-pie text-emerald-400 text-xl"></i>
                        <div>
                            <p class="text-white font-bold text-sm">Fee Distribution</p>
                            <p class="text-zinc-500 text-[10px]">Where your fees go</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-center">
                            <p class="text-2xl font-black text-purple-400">70%</p>
                            <p class="text-[10px] text-zinc-500">Stakers</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-black text-blue-400">30%</p>
                            <p class="text-[10px] text-zinc-500">Treasury</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fee Grid -->
            <div class="grid grid-cols-2 gap-2">
                ${[{name:"Delegation Entry",key:"DELEGATION_FEE",default:"2%",icon:"fa-lock",color:"purple"},{name:"Normal Unstake",key:"UNSTAKE_FEE",default:"5%",icon:"fa-unlock",color:"blue"},{name:"Force Unstake",key:"FORCE_UNSTAKE",default:"20%",icon:"fa-bolt",color:"red"},{name:"Claim Rewards",key:"CLAIM_REWARD_FEE",default:"10%",icon:"fa-gift",color:"amber"},{name:"NFT Buy Tax",key:"NFT_BUY_TAX",default:"5%",icon:"fa-cart-shopping",color:"emerald"},{name:"NFT Sell Tax",key:"NFT_SELL_TAX",default:"10%",icon:"fa-tag",color:"cyan"},{name:"Notarization",key:"NOTARY_FEE",default:"1 BKC",icon:"fa-stamp",color:"violet"},{name:"Fortune Pool",key:"FORTUNE_FEE",default:"~10%",icon:"fa-clover",color:"green"}].map(t=>`
                    <div class="tk-card flex items-center gap-2 p-2">
                        <div class="w-8 h-8 rounded-lg bg-${t.color}-500/20 flex items-center justify-center flex-shrink-0">
                            <i class="fa-solid ${t.icon} text-${t.color}-400 text-xs"></i>
                        </div>
                        <div class="min-w-0">
                            <p class="text-white text-xs font-medium truncate">${t.name}</p>
                            <p class="text-${t.color}-400 text-[10px] font-bold">${t.default}</p>
                        </div>
                    </div>
                `).join("")}
            </div>
            
            <!-- Booster Discount Note -->
            <div class="mt-3 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-star text-amber-400"></i>
                    <p class="text-amber-400 text-xs font-medium">NFT Booster holders get fee discounts up to 50%!</p>
                </div>
            </div>
        </div>
    `}function tb(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.5s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-amber-500/20">
                    <i class="fa-solid fa-sack-dollar text-amber-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">How to Earn</h2>
                    <p class="text-zinc-500 text-xs">Multiple ways to grow your BKC</p>
                </div>
            </div>
            
            <div class="space-y-3">
                <!-- Staking Rewards -->
                <div class="tk-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center">
                            <i class="fa-solid fa-lock text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold">Staking Rewards</p>
                            <p class="text-zinc-500 text-xs">Delegate BKC and earn passive income</p>
                        </div>
                        <span class="tk-badge bg-purple-500/20 text-purple-400">
                            <i class="fa-solid fa-fire mr-1"></i>Best APY
                        </span>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center text-[10px]">
                        <div class="bg-zinc-800/50 rounded-lg p-2">
                            <p class="text-zinc-500">Source</p>
                            <p class="text-purple-400 font-medium">70% of fees</p>
                        </div>
                        <div class="bg-zinc-800/50 rounded-lg p-2">
                            <p class="text-zinc-500">Mining</p>
                            <p class="text-emerald-400 font-medium">70% new tokens</p>
                        </div>
                        <div class="bg-zinc-800/50 rounded-lg p-2">
                            <p class="text-zinc-500">Boost</p>
                            <p class="text-amber-400 font-medium">Up to +50%</p>
                        </div>
                    </div>
                </div>
                
                <!-- NFT Rental -->
                <div class="tk-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
                            <i class="fa-solid fa-house text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold">NFT Rental</p>
                            <p class="text-zinc-500 text-xs">Rent your boosters to other users</p>
                        </div>
                        <span class="tk-badge bg-cyan-500/20 text-cyan-400">
                            <i class="fa-solid fa-clock mr-1"></i>Hourly
                        </span>
                    </div>
                    <p class="text-zinc-600 text-xs">
                        Set your own price per hour. Earn while your NFT helps others boost their rewards.
                    </p>
                </div>
                
                <!-- Fortune Pool -->
                <div class="tk-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                            <i class="fa-solid fa-clover text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold">Fortune Pool</p>
                            <p class="text-zinc-500 text-xs">On-chain lottery with real prizes</p>
                        </div>
                        <span class="tk-badge bg-emerald-500/20 text-emerald-400">
                            <i class="fa-solid fa-dice mr-1"></i>Up to 125x
                        </span>
                    </div>
                    <p class="text-zinc-600 text-xs">
                        Match numbers to multiply your wager. Three tiers of difficulty with increasing rewards.
                    </p>
                </div>
                
                <!-- Airdrop Points -->
                <div class="tk-card">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                            <i class="fa-solid fa-parachute-box text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-bold">Airdrop Points</p>
                            <p class="text-zinc-500 text-xs">Earn points for every action</p>
                        </div>
                        <span class="tk-badge bg-amber-500/20 text-amber-400">
                            <i class="fa-solid fa-gift mr-1"></i>35% TGE
                        </span>
                    </div>
                    <div class="grid grid-cols-4 gap-1 text-center text-[10px]">
                        <div class="bg-zinc-800/50 rounded p-1">
                            <i class="fa-solid fa-lock text-purple-400"></i>
                            <p class="text-zinc-500 mt-1">Stake</p>
                        </div>
                        <div class="bg-zinc-800/50 rounded p-1">
                            <i class="fa-solid fa-stamp text-violet-400"></i>
                            <p class="text-zinc-500 mt-1">Notarize</p>
                        </div>
                        <div class="bg-zinc-800/50 rounded p-1">
                            <i class="fa-solid fa-clover text-emerald-400"></i>
                            <p class="text-zinc-500 mt-1">Fortune</p>
                        </div>
                        <div class="bg-zinc-800/50 rounded p-1">
                            <i class="fa-solid fa-share text-cyan-400"></i>
                            <p class="text-zinc-500 mt-1">Share</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `}function ab(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.6s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-violet-500/20">
                    <i class="fa-solid fa-gem text-violet-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">NFT Boosters</h2>
                    <p class="text-zinc-500 text-xs">Enhance your earnings</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-2">
                ${[{tier:"Crystal",boost:"+50%",discount:"50%",color:"purple",price:"~500K"},{tier:"Diamond",boost:"+40%",discount:"40%",color:"cyan",price:"~100K"},{tier:"Platinum",boost:"+30%",discount:"30%",color:"slate",price:"~50K"},{tier:"Gold",boost:"+20%",discount:"20%",color:"yellow",price:"~10K"},{tier:"Silver",boost:"+10%",discount:"10%",color:"gray",price:"~5K"},{tier:"Bronze",boost:"+5%",discount:"5%",color:"orange",price:"~1K"}].map(t=>`
                    <div class="tk-card p-2">
                        <div class="flex items-center gap-2 mb-2">
                            <div class="w-8 h-8 rounded-lg bg-${t.color}-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-gem text-${t.color}-400 text-xs"></i>
                            </div>
                            <div>
                                <p class="text-white text-xs font-bold">${t.tier}</p>
                                <p class="text-zinc-600 text-[10px]">${t.price} BKC</p>
                            </div>
                        </div>
                        <div class="flex justify-between text-[10px]">
                            <span class="text-emerald-400">â¬† ${t.boost} rewards</span>
                            <span class="text-cyan-400">â¬‡ ${t.discount} fees</span>
                        </div>
                    </div>
                `).join("")}
            </div>
        </div>
    `}function nb(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.7s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-blue-500/20">
                    <i class="fa-solid fa-road text-blue-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">Roadmap</h2>
                    <p class="text-zinc-500 text-xs">Our journey ahead</p>
                </div>
            </div>
            
            <div class="tk-timeline">
                ${[{phase:"Phase 1",title:"Foundation",status:"done",items:["Smart Contracts","Core Platform","Testnet Launch"]},{phase:"Phase 2",title:"Growth",status:"active",items:["Airdrop Round 1","Community Building","Partnerships"]},{phase:"Phase 3",title:"Expansion",status:"upcoming",items:["DEX Listing","Mobile App","Airdrop Round 2"]},{phase:"Phase 4",title:"Ecosystem",status:"upcoming",items:["DAO Governance","Cross-chain","Enterprise"]}].map((t,a)=>{const n=t.status==="done"?"emerald":t.status==="active"?"amber":"zinc",i=t.status==="done"?"check":t.status==="active"?"spinner fa-spin":"circle";return`
                        <div class="tk-timeline-item">
                            <div class="tk-timeline-dot bg-${n}-500 border-${n}-400"></div>
                            <div class="tk-card">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <span class="text-${n}-400 text-[10px] font-bold uppercase">${t.phase}</span>
                                        <p class="text-white font-bold text-sm">${t.title}</p>
                                    </div>
                                    <i class="fa-solid fa-${i} text-${n}-400"></i>
                                </div>
                                <div class="flex flex-wrap gap-1">
                                    ${t.items.map(r=>`
                                        <span class="text-[10px] px-2 py-0.5 bg-zinc-800 rounded-full text-zinc-400">${r}</span>
                                    `).join("")}
                                </div>
                            </div>
                        </div>
                    `}).join("")}
            </div>
        </div>
    `}function ib(){return`
        <div class="tk-section tk-fade-up" style="animation-delay: 0.8s">
            <div class="flex items-center gap-2 mb-4">
                <div class="tk-icon-box bg-zinc-500/20">
                    <i class="fa-solid fa-file-contract text-zinc-400"></i>
                </div>
                <div>
                    <h2 class="text-white font-bold">Smart Contracts</h2>
                    <p class="text-zinc-500 text-xs">Verified on Arbitrum Sepolia</p>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-2 text-[10px]">
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-coins text-amber-400"></i>
                    <span class="text-zinc-400">BKC Token</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-lock text-purple-400"></i>
                    <span class="text-zinc-400">DelegationManager</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-hammer text-emerald-400"></i>
                    <span class="text-zinc-400">MiningManager</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-clover text-green-400"></i>
                    <span class="text-zinc-400">FortunePool</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-stamp text-violet-400"></i>
                    <span class="text-zinc-400">DecentralizedNotary</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-house text-cyan-400"></i>
                    <span class="text-zinc-400">RentalManager</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-gem text-blue-400"></i>
                    <span class="text-zinc-400">RewardBoosterNFT</span>
                </div>
                <div class="tk-card p-2 flex items-center gap-2">
                    <i class="fa-solid fa-water text-indigo-400"></i>
                    <span class="text-zinc-400">NFT Liquidity Pools</span>
                </div>
            </div>
            
            <div class="mt-3 text-center">
                <a href="https://sepolia.arbiscan.io" target="_blank" class="inline-flex items-center gap-2 text-xs text-zinc-500 hover:text-amber-400 transition-colors">
                    <i class="fa-solid fa-external-link"></i>
                    View all contracts on Arbiscan
                </a>
            </div>
        </div>
    `}function rb(){const e=document.getElementById("tokenomics");e&&(qf(),e.innerHTML=`
        <div class="max-w-2xl mx-auto px-4 py-6 pb-24">
            ${Xf()}
            ${Jf()}
            ${Zf()}
            ${Qf()}
            ${eb()}
            ${tb()}
            ${ab()}
            ${nb()}
            ${ib()}
            
            <!-- Footer -->
            <div class="text-center py-6 text-zinc-600 text-xs">
                <p>Built with â¤ï¸ for the community</p>
                <p class="mt-1">BACKCOIN Â© 2024-2025</p>
            </div>
        </div>
    `,e.scrollIntoView({behavior:"smooth",block:"start"}))}const sb={render:rb,init:()=>{},update:()=>{}},se=window.ethers,ob=5*1024*1024,pd="https://sepolia.arbiscan.io",lb=`${pd}/tx/`,Ir=`${pd}/token/`,md=["event DocumentNotarized(uint256 indexed tokenId, address indexed owner, string ipfsCid, bytes32 indexed contentHash, uint256 bkcFeePaid, uint256 ethFeePaid, address operator)"],Ze={image:{icon:"fa-regular fa-image",color:"#34d399",bg:"rgba(52,211,153,0.12)",label:"Image"},pdf:{icon:"fa-regular fa-file-pdf",color:"#f87171",bg:"rgba(248,113,113,0.12)",label:"PDF"},audio:{icon:"fa-solid fa-music",color:"#a78bfa",bg:"rgba(167,139,250,0.12)",label:"Audio"},video:{icon:"fa-regular fa-file-video",color:"#60a5fa",bg:"rgba(96,165,250,0.12)",label:"Video"},document:{icon:"fa-regular fa-file-word",color:"#60a5fa",bg:"rgba(96,165,250,0.12)",label:"Document"},spreadsheet:{icon:"fa-regular fa-file-excel",color:"#4ade80",bg:"rgba(74,222,128,0.12)",label:"Spreadsheet"},code:{icon:"fa-solid fa-code",color:"#22d3ee",bg:"rgba(34,211,238,0.12)",label:"Code"},archive:{icon:"fa-regular fa-file-zipper",color:"#facc15",bg:"rgba(250,204,21,0.12)",label:"Archive"},default:{icon:"fa-regular fa-file",color:"#fbbf24",bg:"rgba(251,191,36,0.12)",label:"File"}},T={view:"documents",activeTab:"documents",viewHistory:[],wizStep:1,wizFile:null,wizFileHash:null,wizDescription:"",wizDuplicateCheck:null,wizIsHashing:!1,wizIpfsCid:null,wizUploadDate:null,bkcFee:0n,ethFee:0n,feesLoaded:!1,certificates:[],certsLoading:!1,selectedCert:null,verifyFile:null,verifyHash:null,verifyResult:null,verifyIsChecking:!1,stats:null,totalSupply:0,recentNotarizations:[],statsLoading:!1,isProcessing:!1,processStep:"",isLoading:!1,contractAvailable:!0};function Ja(e="",t=""){const a=e.toLowerCase(),n=t.toLowerCase();return a.includes("image")||/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico)$/.test(n)?Ze.image:a.includes("pdf")||n.endsWith(".pdf")?Ze.pdf:a.includes("audio")||/\.(mp3|wav|ogg|flac|aac|m4a)$/.test(n)?Ze.audio:a.includes("video")||/\.(mp4|avi|mov|mkv|webm|wmv)$/.test(n)?Ze.video:a.includes("word")||a.includes("document")||/\.(doc|docx|odt|rtf)$/.test(n)?Ze.document:a.includes("sheet")||a.includes("excel")||/\.(xls|xlsx|csv|ods)$/.test(n)?Ze.spreadsheet:/\.(js|ts|py|java|cpp|c|h|html|css|json|xml|sol|rs|go|php|rb)$/.test(n)?Ze.code:a.includes("zip")||a.includes("archive")||/\.(zip|rar|7z|tar|gz)$/.test(n)?Ze.archive:Ze.default}function fd(e){if(!e)return"";let t;if(typeof e=="number")t=new Date(e>1e12?e:e*1e3);else if(typeof e=="string")t=new Date(e);else if(e!=null&&e.toDate)t=e.toDate();else if(e!=null&&e.seconds)t=new Date(e.seconds*1e3);else return"";if(isNaN(t.getTime()))return"";const a=new Date,n=a-t,i=Math.floor(n/6e4),r=Math.floor(n/36e5),s=Math.floor(n/864e5);return i<1?"Just now":i<60?`${i}m`:r<24?`${r}h`:s<7?`${s}d`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==a.getFullYear()?"numeric":void 0})}function Ar(e){if(!e)return"";const t=typeof e=="number"?new Date(e>1e12?e:e*1e3):new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}function Br(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function bd(e){return e?e.startsWith("https://")?e:e.startsWith("ipfs://")?`${yi[0]}${e.replace("ipfs://","")}`:`${yi[0]}${e}`:""}function zr(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(2)} MB`}function cb(e,t){T.viewHistory.push({view:T.view,data:T.selectedCert}),T.view=e,t&&(T.selectedCert=t),be(),fa()}function gd(){const e=T.viewHistory.pop();e?(T.view=e.view,T.activeTab=e.view==="cert-detail"?"documents":e.view,T.selectedCert=e.data):(T.view="documents",T.activeTab="documents"),be(),fa()}function db(e){T.activeTab===e&&T.view===e||(T.viewHistory=[],T.view=e,T.activeTab=e,be(),fa())}function ub(){if(document.getElementById("notary-styles-v10"))return;const e=document.createElement("style");e.id="notary-styles-v10",e.textContent=`
        :root {
            --nt-bg:       #0c0c0e;
            --nt-bg2:      #141417;
            --nt-bg3:      #1c1c21;
            --nt-surface:  #222228;
            --nt-border:   rgba(255,255,255,0.06);
            --nt-border-h: rgba(255,255,255,0.1);
            --nt-text:     #f0f0f2;
            --nt-text-2:   #a0a0ab;
            --nt-text-3:   #5c5c68;
            --nt-accent:   #f59e0b;
            --nt-accent-2: #d97706;
            --nt-accent-glow: rgba(245,158,11,0.15);
            --nt-red:      #ef4444;
            --nt-green:    #22c55e;
            --nt-blue:     #3b82f6;
            --nt-radius:   14px;
            --nt-radius-sm: 10px;
            --nt-radius-lg: 20px;
            --nt-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes nt-fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }
        @keyframes nt-scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: none; } }
        @keyframes nt-shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes nt-stamp { 0% { transform: scale(1) rotate(0); } 25% { transform: scale(1.2) rotate(-5deg); } 50% { transform: scale(0.9) rotate(5deg); } 100% { transform: scale(1) rotate(0); } }
        @keyframes nt-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes nt-scan { 0% { top: 0; opacity: 1; } 50% { opacity: 0.5; } 100% { top: 100%; opacity: 1; } }
        @keyframes nt-pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); } 100% { box-shadow: 0 0 0 15px rgba(245,158,11,0); } }

        .nt-shell {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 16px 32px;
            min-height: 100vh;
            background: var(--nt-bg);
        }
        .nt-header {
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 12px 0 0;
            background: var(--nt-bg);
        }
        .nt-header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }
        .nt-brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nt-brand-icon {
            width: 44px; height: 44px;
            border-radius: var(--nt-radius);
            background: var(--nt-accent-glow);
            border: 1px solid rgba(245,158,11,0.2);
            display: flex; align-items: center; justify-content: center;
            color: var(--nt-accent);
            font-size: 20px;
            animation: nt-float 4s ease-in-out infinite;
        }
        .nt-brand-name {
            font-size: 18px;
            font-weight: 800;
            color: var(--nt-text);
            letter-spacing: -0.02em;
        }
        .nt-brand-sub {
            font-size: 11px;
            color: var(--nt-text-3);
        }

        /* Navigation */
        .nt-nav {
            display: flex;
            gap: 2px;
            padding: 4px;
            background: var(--nt-bg2);
            border-radius: var(--nt-radius);
            border: 1px solid var(--nt-border);
            margin-top: 8px;
        }
        .nt-nav-item {
            flex: 1;
            padding: 10px 6px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--nt-text-3);
            border-radius: var(--nt-radius-sm);
            cursor: pointer;
            transition: all var(--nt-transition);
            border: none;
            background: none;
        }
        .nt-nav-item:hover { color: var(--nt-text-2); background: var(--nt-bg3); }
        .nt-nav-item.active {
            color: var(--nt-text);
            background: var(--nt-surface);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .nt-nav-item i { margin-right: 6px; }

        /* Back header */
        .nt-back-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
        }
        .nt-back-btn {
            width: 36px; height: 36px;
            border-radius: var(--nt-radius-sm);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            color: var(--nt-text-2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-back-btn:hover { background: var(--nt-surface); color: var(--nt-text); }

        /* Card */
        .nt-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            padding: 20px;
            animation: nt-fadeIn 0.3s ease;
        }

        /* Certificate grid */
        .nt-cert-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        @media (max-width: 640px) {
            .nt-cert-grid { grid-template-columns: 1fr; }
        }
        .nt-cert-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-cert-card:hover {
            border-color: var(--nt-border-h);
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.3);
        }
        .nt-cert-thumb {
            height: 120px;
            background: var(--nt-bg3);
            display: flex; align-items: center; justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .nt-cert-thumb img {
            width: 100%; height: 100%; object-fit: cover; opacity: 0.8;
        }
        .nt-cert-info {
            padding: 14px;
        }

        /* Dropzone */
        .nt-dropzone {
            border: 2px dashed var(--nt-border-h);
            border-radius: var(--nt-radius-lg);
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.15);
        }
        .nt-dropzone:hover {
            border-color: rgba(245,158,11,0.4);
            background: var(--nt-accent-glow);
        }
        .nt-dropzone.drag-over {
            border-color: var(--nt-accent);
            background: var(--nt-accent-glow);
            transform: scale(1.01);
        }

        /* Wizard steps */
        .nt-steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            margin-bottom: 28px;
        }
        .nt-step-dot {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .nt-step-dot.pending {
            background: var(--nt-bg3);
            color: var(--nt-text-3);
            border: 2px solid var(--nt-border);
        }
        .nt-step-dot.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            box-shadow: 0 0 20px rgba(245,158,11,0.3);
        }
        .nt-step-dot.done {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
        }
        .nt-step-line {
            width: 60px; height: 3px;
            background: var(--nt-border);
            border-radius: 2px;
            transition: all 0.4s ease;
        }
        .nt-step-line.done { background: var(--nt-green); }
        .nt-step-line.active { background: linear-gradient(90deg, var(--nt-green), var(--nt-accent)); }

        /* Fee box */
        .nt-fee-box {
            background: rgba(245,158,11,0.06);
            border: 1px solid rgba(245,158,11,0.15);
            border-radius: var(--nt-radius);
            padding: 16px;
        }
        .nt-fee-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        .nt-fee-row + .nt-fee-row {
            border-top: 1px solid var(--nt-border);
        }

        /* Verify */
        .nt-verified {
            background: rgba(34,197,94,0.08);
            border: 1px solid rgba(34,197,94,0.2);
            border-radius: var(--nt-radius);
            padding: 20px;
        }
        .nt-not-found {
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.2);
            border-radius: var(--nt-radius);
            padding: 20px;
        }

        /* Stats */
        .nt-stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        @media (min-width: 640px) {
            .nt-stat-grid { grid-template-columns: repeat(4, 1fr); }
        }
        .nt-stat-card {
            background: var(--nt-bg2);
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius);
            padding: 16px;
            text-align: center;
            animation: nt-fadeIn 0.3s ease;
        }
        .nt-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--nt-text);
            font-family: monospace;
        }
        .nt-recent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--nt-border);
            transition: background var(--nt-transition);
        }
        .nt-recent-item:hover { background: var(--nt-bg3); }
        .nt-recent-item:last-child { border-bottom: none; }

        /* Detail */
        .nt-detail { animation: nt-fadeIn 0.3s ease; }
        .nt-detail-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        @media (max-width: 640px) {
            .nt-detail-meta { grid-template-columns: 1fr; }
        }
        .nt-hash-display {
            font-family: monospace;
            font-size: 11px;
            color: var(--nt-text-2);
            background: var(--nt-bg3);
            padding: 12px;
            border-radius: var(--nt-radius-sm);
            word-break: break-all;
            cursor: pointer;
            border: 1px solid var(--nt-border);
            transition: border-color var(--nt-transition);
        }
        .nt-hash-display:hover { border-color: var(--nt-accent); }

        /* Buttons */
        .nt-btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
            font-weight: 700;
            border: none;
            border-radius: var(--nt-radius-sm);
            padding: 12px 24px;
            cursor: pointer;
            transition: all var(--nt-transition);
            font-size: 14px;
        }
        .nt-btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(245,158,11,0.3);
        }
        .nt-btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
        .nt-btn-secondary {
            background: var(--nt-bg3);
            color: var(--nt-text-2);
            font-weight: 600;
            border: 1px solid var(--nt-border);
            border-radius: var(--nt-radius-sm);
            padding: 10px 20px;
            cursor: pointer;
            transition: all var(--nt-transition);
            font-size: 13px;
        }
        .nt-btn-secondary:hover { background: var(--nt-surface); color: var(--nt-text); }
        .nt-btn-icon {
            width: 36px; height: 36px;
            border-radius: var(--nt-radius-sm);
            background: var(--nt-bg3);
            border: 1px solid var(--nt-border);
            color: var(--nt-text-2);
            display: inline-flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all var(--nt-transition);
        }
        .nt-btn-icon:hover { background: var(--nt-surface); color: var(--nt-text); }

        /* Overlay */
        .nt-overlay {
            position: fixed; inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.92);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center; justify-content: center;
        }
        .nt-overlay.active { display: flex; }

        /* Shimmer loading */
        .nt-shimmer {
            background: linear-gradient(90deg, var(--nt-bg3) 25%, var(--nt-surface) 50%, var(--nt-bg3) 75%);
            background-size: 200% 100%;
            animation: nt-shimmer 1.5s ease infinite;
            border-radius: var(--nt-radius-sm);
        }

        /* Duplicate warning */
        .nt-duplicate-warn {
            background: rgba(251,191,36,0.08);
            border: 1px solid rgba(251,191,36,0.25);
            border-radius: var(--nt-radius);
            padding: 16px;
        }
    `,document.head.appendChild(e);const t=document.getElementById("notary-styles-v6");t&&t.remove()}function pb(e){const t=document.getElementById("notary");t&&(ub(),t.innerHTML=`
        <div class="nt-shell">
            <div class="nt-header" id="nt-header"></div>
            <div id="nt-content"></div>
            <div id="nt-overlay" class="nt-overlay"></div>
        </div>
    `,fa(),be(),Promise.all([Tb(),Pr(),Ib()]).catch(()=>{}))}function fa(){var t;const e=document.getElementById("nt-header");if(e){if(T.view==="cert-detail"){e.innerHTML=`
            <div class="nt-back-header">
                <button class="nt-back-btn" onclick="NotaryPage.goBack()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div>
                    <div style="font-size:15px;font-weight:700;color:var(--nt-text)">Certificate #${((t=T.selectedCert)==null?void 0:t.id)||""}</div>
                    <div style="font-size:11px;color:var(--nt-text-3)">Document details</div>
                </div>
            </div>
        `;return}e.innerHTML=`
        <div class="nt-header-bar">
            <div class="nt-brand">
                <div class="nt-brand-icon"><i class="fa-solid fa-stamp"></i></div>
                <div>
                    <div class="nt-brand-name">Decentralized Notary</div>
                    <div class="nt-brand-sub">Permanent blockchain certification</div>
                </div>
            </div>
        </div>
        <nav class="nt-nav">
            <button class="nt-nav-item ${T.activeTab==="documents"?"active":""}" onclick="NotaryPage.setTab('documents')">
                <i class="fa-solid fa-certificate"></i><span>Documents</span>
            </button>
            <button class="nt-nav-item ${T.activeTab==="notarize"?"active":""}" onclick="NotaryPage.setTab('notarize')">
                <i class="fa-solid fa-stamp"></i><span>Notarize</span>
            </button>
            <button class="nt-nav-item ${T.activeTab==="verify"?"active":""}" onclick="NotaryPage.setTab('verify')">
                <i class="fa-solid fa-shield-check"></i><span>Verify</span>
            </button>
            <button class="nt-nav-item ${T.activeTab==="stats"?"active":""}" onclick="NotaryPage.setTab('stats')">
                <i class="fa-solid fa-chart-simple"></i><span>Stats</span>
            </button>
        </nav>
    `}}function be(){const e=document.getElementById("nt-content");if(e)switch(T.view){case"documents":Ns(e);break;case"notarize":fb(e);break;case"verify":wb(e);break;case"stats":kb(e);break;case"cert-detail":Eb(e);break;default:Ns(e)}}function Ns(e){if(!d.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to view your certificates</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}if(T.certsLoading){e.innerHTML=`
            <div class="nt-cert-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>`
                    <div class="nt-cert-card">
                        <div class="nt-shimmer" style="height:120px"></div>
                        <div style="padding:14px">
                            <div class="nt-shimmer" style="height:16px;width:70%;margin-bottom:8px"></div>
                            <div class="nt-shimmer" style="height:12px;width:50%"></div>
                        </div>
                    </div>
                `).join("")}
            </div>
        `;return}if(!T.certificates.length){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-stamp" style="font-size:24px;color:var(--nt-accent);opacity:0.5"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">No Certificates</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Notarize a document to create your first certificate</div>
                <button class="nt-btn-primary" onclick="NotaryPage.setTab('notarize')">
                    <i class="fa-solid fa-plus" style="margin-right:8px"></i>Notarize Document
                </button>
            </div>
        `;return}e.innerHTML=`
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:16px;margin-bottom:4px">
            <div style="font-size:13px;color:var(--nt-text-2)">${T.certificates.length} certificate${T.certificates.length>1?"s":""}</div>
            <button class="nt-btn-icon" onclick="NotaryPage.refreshHistory()" title="Refresh">
                <i class="fa-solid fa-rotate-right" style="font-size:12px"></i>
            </button>
        </div>
        <div class="nt-cert-grid">
            ${T.certificates.map(t=>mb(t)).join("")}
        </div>
    `}function mb(e){var r,s;const t=bd(e.ipfs),a=Ja(e.mimeType||"",e.description||e.fileName||""),n=fd(e.timestamp),i=((r=e.description)==null?void 0:r.split("---")[0].trim().split(`
`)[0].trim())||"Notarized Document";return`
        <div class="nt-cert-card" onclick="NotaryPage.viewCert(${e.id})">
            <div class="nt-cert-thumb">
                ${t?`
                    <img src="${t}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="">
                    <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;inset:0;background:var(--nt-bg3)">
                        <i class="${a.icon}" style="font-size:28px;color:${a.color}"></i>
                    </div>
                `:`
                    <i class="${a.icon}" style="font-size:28px;color:${a.color}"></i>
                `}
                <span style="position:absolute;top:8px;right:8px;font-size:10px;font-family:monospace;color:var(--nt-accent);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px;font-weight:700">#${e.id}</span>
                ${n?`<span style="position:absolute;top:8px;left:8px;font-size:10px;color:var(--nt-text-3);background:rgba(0,0,0,0.8);padding:2px 8px;border-radius:20px"><i class="fa-regular fa-clock" style="margin-right:4px"></i>${n}</span>`:""}
            </div>
            <div class="nt-cert-info">
                <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:4px">${i}</div>
                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">SHA-256: ${((s=e.hash)==null?void 0:s.slice(0,18))||"..."}...</div>
            </div>
        </div>
    `}function fb(e){if(!d.isConnected){e.innerHTML=`
            <div class="nt-card" style="margin-top:16px;text-align:center;padding:48px 20px">
                <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-bg3);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-wallet" style="font-size:24px;color:var(--nt-text-3)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:8px">Connect Wallet</div>
                <div style="font-size:13px;color:var(--nt-text-3);margin-bottom:20px">Connect to notarize documents on the blockchain</div>
                <button class="nt-btn-primary" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet" style="margin-right:8px"></i>Connect Wallet
                </button>
            </div>
        `;return}e.innerHTML=`
        <div class="nt-card" style="margin-top:16px">
            ${bb()}
            <div id="nt-wiz-panel"></div>
        </div>
    `;const t=document.getElementById("nt-wiz-panel");if(t)switch(T.wizStep){case 1:gb(t);break;case 2:xd(t);break;case 3:hb(t);break}}function bb(){const e=T.wizStep;return`
        <div class="nt-steps">
            <div class="nt-step-dot ${e>1?"done":e===1?"active":"pending"}">${e>1?'<i class="fa-solid fa-check" style="font-size:12px"></i>':"1"}</div>
            <div class="nt-step-line ${e>1?"done":""}"></div>
            <div class="nt-step-dot ${e>2?"done":e===2?"active":"pending"}">${e>2?'<i class="fa-solid fa-check" style="font-size:12px"></i>':"2"}</div>
            <div class="nt-step-line ${e>2?"done":e===2?"active":""}"></div>
            <div class="nt-step-dot ${e===3?"active":"pending"}">3</div>
        </div>
    `}function gb(e){if(T.wizFile&&T.wizFileHash){const t=T.wizFile,a=Ja(t.type,t.name),n=T.wizDuplicateCheck;e.innerHTML=`
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">File Selected</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">SHA-256 hash computed in your browser</div>
            </div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:14px">
                    <div style="width:48px;height:48px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="${a.icon}" style="font-size:20px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t.name}</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">${zr(t.size)} &bull; ${a.label}</div>
                    </div>
                    <button class="nt-btn-icon" onclick="NotaryPage.wizRemoveFile()" title="Remove">
                        <i class="fa-solid fa-xmark" style="color:var(--nt-red)"></i>
                    </button>
                </div>
            </div>

            <div style="margin-bottom:16px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:6px">
                    <i class="fa-solid fa-fingerprint" style="margin-right:4px;color:var(--nt-accent)"></i>SHA-256 Hash
                </div>
                <div class="nt-hash-display" onclick="NotaryPage.copyHash('${T.wizFileHash}')" title="Click to copy">
                    ${T.wizFileHash}
                    <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                </div>
            </div>

            ${n===null?`
                <div style="text-align:center;padding:12px;color:var(--nt-text-3);font-size:12px">
                    <i class="fa-solid fa-spinner fa-spin" style="margin-right:6px;color:var(--nt-accent)"></i>Checking for duplicates...
                </div>
            `:n!=null&&n.exists?`
                <div class="nt-duplicate-warn" style="margin-bottom:16px">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                        <i class="fa-solid fa-triangle-exclamation" style="color:#fbbf24;font-size:16px"></i>
                        <span style="font-size:13px;font-weight:700;color:#fbbf24">Document already notarized!</span>
                    </div>
                    <div style="font-size:12px;color:var(--nt-text-2);line-height:1.5">
                        This hash already exists on the blockchain.<br>
                        Token ID: <strong style="color:var(--nt-accent)">#${n.tokenId}</strong><br>
                        Owner: <span style="font-family:monospace;font-size:11px">${Br(n.owner)}</span><br>
                        Date: ${Ar(n.timestamp)}
                    </div>
                </div>
            `:`
                <div style="background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:var(--nt-radius);padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:8px">
                    <i class="fa-solid fa-circle-check" style="color:var(--nt-green)"></i>
                    <span style="font-size:12px;color:var(--nt-green);font-weight:600">Hash unico â€” pronto para notarizar</span>
                </div>
            `}

            <div style="display:flex;gap:10px;margin-top:8px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizRemoveFile()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Change File
                </button>
                <button class="nt-btn-primary" style="flex:2" ${n!=null&&n.exists?"disabled":""} onclick="NotaryPage.wizNext()">
                    Continue<i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        `;return}if(T.wizIsHashing){e.innerHTML=`
            <div style="text-align:center;padding:40px 20px">
                <div style="width:56px;height:56px;border-radius:50%;background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:16px">
                    <i class="fa-solid fa-fingerprint fa-spin" style="font-size:24px;color:var(--nt-accent)"></i>
                </div>
                <div style="font-size:14px;font-weight:600;color:var(--nt-text)">Computing SHA-256...</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:6px">Hash being computed locally in your browser</div>
            </div>
        `;return}e.innerHTML=`
        <div style="text-align:center;margin-bottom:20px">
            <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Upload Document</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">Select a file to certify permanently on the blockchain</div>
        </div>

        <div class="nt-dropzone" id="nt-wiz-dropzone">
            <input type="file" id="nt-wiz-file-input" style="display:none">
            <div style="width:56px;height:56px;border-radius:var(--nt-radius);background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:14px">
                <i class="fa-solid fa-cloud-arrow-up" style="font-size:24px;color:var(--nt-accent)"></i>
            </div>
            <div style="font-size:14px;font-weight:600;color:var(--nt-text);margin-bottom:4px">Click or drag file here</div>
            <div style="font-size:11px;color:var(--nt-text-3)">Max 5MB &bull; Any format</div>
        </div>

        <div style="display:flex;align-items:center;justify-content:center;gap:20px;margin-top:16px;font-size:11px;color:var(--nt-text-3)">
            <span><i class="fa-solid fa-shield-halved" style="color:var(--nt-green);margin-right:4px"></i>Local hash</span>
            <span><i class="fa-solid fa-database" style="color:var(--nt-blue);margin-right:4px"></i>IPFS</span>
            <span><i class="fa-solid fa-infinity" style="color:var(--nt-accent);margin-right:4px"></i>Permanent</span>
        </div>
    `,xb()}function xb(){const e=document.getElementById("nt-wiz-dropzone"),t=document.getElementById("nt-wiz-file-input");!e||!t||(e.onclick=()=>t.click(),["dragenter","dragover","dragleave","drop"].forEach(a=>{e.addEventListener(a,n=>{n.preventDefault(),n.stopPropagation()})}),e.addEventListener("dragenter",()=>e.classList.add("drag-over")),e.addEventListener("dragover",()=>e.classList.add("drag-over")),e.addEventListener("dragleave",()=>e.classList.remove("drag-over")),e.addEventListener("drop",a=>{var n,i;e.classList.remove("drag-over"),$s((i=(n=a.dataTransfer)==null?void 0:n.files)==null?void 0:i[0])}),t.addEventListener("change",a=>{var n;return $s((n=a.target.files)==null?void 0:n[0])}))}async function $s(e){if(e){if(e.size>ob){h("File too large (max 5MB)","error");return}T.wizFile=e,T.wizFileHash=null,T.wizDuplicateCheck=null,T.wizIsHashing=!0,be();try{const t=await nt.calculateFileHash(e);T.wizFileHash=t,T.wizIsHashing=!1,be(),T.wizDuplicateCheck=null,be();const a=await nt.verifyByHash(t);T.wizDuplicateCheck=a,be()}catch(t){console.error("[NotaryPage] Hash error:",t),T.wizIsHashing=!1,T.wizFile=null,h("Error computing file hash","error"),be()}}}function xd(e){const t=T.wizFile,a=Ja((t==null?void 0:t.type)||"",(t==null?void 0:t.name)||""),n=T.feesLoaded?se?se.formatEther(T.bkcFee):"1":"...",i=T.feesLoaded?se?se.formatEther(T.ethFee):"0.0001":"...",r=d.currentUserBalance||0n,s=d.currentUserNativeBalance||0n,o=T.feesLoaded?r>=T.bkcFee:!0,l=T.feesLoaded?s>=T.ethFee+((se==null?void 0:se.parseEther("0.001"))||0n):!0,c=o&&l;e.innerHTML=`
        <div style="max-width:420px;margin:0 auto">
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Details & Fees</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px">Describe your document and review the fees</div>
            </div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:12px;margin-bottom:16px;display:flex;align-items:center;gap:12px">
                <div style="width:40px;height:40px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                    <i class="${a.icon}" style="font-size:16px;color:${a.color}"></i>
                </div>
                <div style="flex:1;min-width:0">
                    <div style="font-size:12px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${(t==null?void 0:t.name)||"File"}</div>
                    <div style="font-size:10px;color:var(--nt-text-3)">${zr((t==null?void 0:t.size)||0)}</div>
                </div>
            </div>

            <div style="margin-bottom:16px">
                <label style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;display:block;margin-bottom:6px">
                    Description <span style="font-weight:400;text-transform:none">(optional)</span>
                </label>
                <textarea id="nt-wiz-desc" rows="3"
                    style="width:100%;background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius-sm);padding:12px;font-size:13px;color:var(--nt-text);resize:none;outline:none;font-family:inherit;transition:border-color var(--nt-transition)"
                    onfocus="this.style.borderColor='rgba(245,158,11,0.4)'"
                    onblur="this.style.borderColor='var(--nt-border)'"
                    placeholder="E.g., Property deed signed Jan 2025...">${T.wizDescription}</textarea>
            </div>

            <div class="nt-fee-box" style="margin-bottom:16px">
                <div style="font-size:11px;font-weight:700;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">
                    <i class="fa-solid fa-coins" style="color:var(--nt-accent);margin-right:4px"></i>Service Fees
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">BKC Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-accent);font-family:monospace">${n} BKC</span>
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">ETH Fee (gas fee)</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-blue);font-family:monospace">${i} ETH</span>
                </div>
                ${o?"":`<div style="font-size:11px;color:var(--nt-red);margin-top:8px"><i class="fa-solid fa-circle-xmark" style="margin-right:4px"></i>Insufficient BKC balance (${M(r)} BKC)</div>`}
                ${l?"":'<div style="font-size:11px;color:var(--nt-red);margin-top:4px"><i class="fa-solid fa-circle-xmark" style="margin-right:4px"></i>Insufficient ETH for fee + gas</div>'}
            </div>

            <div style="display:flex;gap:10px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2" ${c?"":"disabled"} onclick="NotaryPage.wizToStep3()">
                    Review<i class="fa-solid fa-arrow-right" style="margin-left:6px"></i>
                </button>
            </div>
        </div>
    `}function hb(e){const t=T.wizFile,a=Ja((t==null?void 0:t.type)||"",(t==null?void 0:t.name)||""),n=T.wizDescription||"No description",i=se?se.formatEther(T.bkcFee):"1",r=se?se.formatEther(T.ethFee):"0.0001";e.innerHTML=`
        <div style="max-width:420px;margin:0 auto;text-align:center">
            <div style="font-size:16px;font-weight:700;color:var(--nt-text);margin-bottom:4px">Confirm & Mint</div>
            <div style="font-size:12px;color:var(--nt-text-3);margin-bottom:20px">Review and sign to create your NFT certificate</div>

            <div style="background:var(--nt-bg3);border:1px solid var(--nt-border);border-radius:var(--nt-radius);padding:16px;text-align:left;margin-bottom:16px">
                <div style="display:flex;align-items:center;gap:12px;padding-bottom:12px;border-bottom:1px solid var(--nt-border);margin-bottom:12px">
                    <div style="width:44px;height:44px;border-radius:var(--nt-radius-sm);background:${a.bg};display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="${a.icon}" style="font-size:18px;color:${a.color}"></i>
                    </div>
                    <div style="flex:1;min-width:0">
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t==null?void 0:t.name}</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">${zr((t==null?void 0:t.size)||0)}</div>
                    </div>
                </div>
                <div style="font-size:12px;color:var(--nt-text-2);font-style:italic">"${n}"</div>
                <div style="font-size:10px;font-family:monospace;color:var(--nt-text-3);margin-top:8px;word-break:break-all">
                    <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>${T.wizFileHash}
                </div>
            </div>

            <div class="nt-fee-box" style="margin-bottom:20px">
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">BKC Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-accent);font-family:monospace">${i} BKC</span>
                </div>
                <div class="nt-fee-row">
                    <span style="font-size:13px;color:var(--nt-text-2)">ETH Fee</span>
                    <span style="font-size:14px;font-weight:700;color:var(--nt-blue);font-family:monospace">${r} ETH</span>
                </div>
            </div>

            <div style="display:flex;gap:10px">
                <button class="nt-btn-secondary" style="flex:1" onclick="NotaryPage.wizBack()">
                    <i class="fa-solid fa-arrow-left" style="margin-right:6px"></i>Back
                </button>
                <button class="nt-btn-primary" style="flex:2" id="nt-btn-mint" onclick="NotaryPage.handleMint()">
                    <i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint
                </button>
            </div>
        </div>
    `}async function vb(){if(T.isProcessing)return;T.isProcessing=!0,T.processStep="SIGNING";const e=document.getElementById("nt-btn-mint");e&&(e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Signing...'),document.getElementById("nt-overlay"),fn("signing");try{const n=await(await d.provider.getSigner()).signMessage("I am signing to authenticate my file for notarization on Backchain.");T.processStep="UPLOADING",fn("uploading");const i=new FormData;i.append("file",T.wizFile),i.append("signature",n),i.append("address",d.userAddress),i.append("description",T.wizDescription||"No description");const r=ze.uploadFileToIPFS||"/api/upload",s=await fetch(r,{method:"POST",body:i,signal:AbortSignal.timeout(18e4)});if(!s.ok)throw s.status===413?new Error("File too large (max 5MB)"):s.status===401?new Error("Signature verification failed"):new Error(`Upload failed (${s.status})`);const o=await s.json(),l=o.ipfsUri||o.metadataUri,c=o.contentHash||T.wizFileHash;if(!l)throw new Error("No IPFS URI returned");if(!c)throw new Error("No content hash returned");T.processStep="MINTING",fn("minting"),await nt.notarize({ipfsCid:l,contentHash:c,description:T.wizDescription||"No description",operator:V(),button:e,onSuccess:(u,f,p)=>{T.processStep="SUCCESS",fn("success",f),setTimeout(()=>{gi(),T.wizFile=null,T.wizFileHash=null,T.wizDescription="",T.wizDuplicateCheck=null,T.wizStep=1,T.isProcessing=!1,T.view="documents",T.activeTab="documents",fa(),be(),Pr(),h("Document notarized successfully!","success")},3e3)},onError:u=>{if(u.cancelled||u.type==="user_rejected"){T.isProcessing=!1,gi(),e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint');return}throw u}})}catch(t){console.error("[NotaryPage] Mint error:",t),gi(),T.isProcessing=!1,e&&(e.disabled=!1,e.innerHTML='<i class="fa-solid fa-stamp" style="margin-right:6px"></i>Sign & Mint'),t.code!==4001&&t.code!=="ACTION_REJECTED"&&h(t.message||"Notarization failed","error")}}function fn(e,t){const a=document.getElementById("nt-overlay");if(!a)return;a.classList.add("active");const n={signing:{icon:"fa-solid fa-signature",text:"Signing message...",sub:"Confirm in MetaMask",pct:10},uploading:{icon:"fa-solid fa-cloud-arrow-up",text:"Uploading to IPFS...",sub:"Decentralized storage",pct:35},minting:{icon:"fa-solid fa-stamp",text:"Minting on Blockchain...",sub:"Waiting for confirmation",pct:65,animate:!0},success:{icon:"fa-solid fa-check",text:"Notarized!",sub:t?`Token ID #${t}`:"Certificate created",pct:100,success:!0}},i=n[e]||n.signing;if(a.innerHTML=`
        <div style="text-align:center;padding:24px;max-width:360px">
            <div style="width:100px;height:100px;margin:0 auto 24px;position:relative">
                ${i.success?"":`
                    <div style="position:absolute;inset:-4px;border-radius:50%;border:3px solid transparent;border-top-color:var(--nt-accent);border-right-color:rgba(245,158,11,0.3);animation:nt-spin 1s linear infinite"></div>
                `}
                <div style="width:100%;height:100%;border-radius:50%;background:${i.success?"rgba(34,197,94,0.15)":"var(--nt-bg3)"};display:flex;align-items:center;justify-content:center;border:2px solid ${i.success?"var(--nt-green)":"rgba(245,158,11,0.2)"}">
                    <i class="${i.icon}" style="font-size:36px;color:${i.success?"var(--nt-green)":"var(--nt-accent)"};${i.animate?"animation:nt-stamp 0.6s ease":""}"></i>
                </div>
            </div>
            <div style="font-size:18px;font-weight:700;color:var(--nt-text);margin-bottom:6px">${i.text}</div>
            <div style="font-size:12px;color:${i.success?"var(--nt-green)":"var(--nt-accent)"};font-family:monospace;margin-bottom:16px">${i.sub}</div>
            <div style="width:100%;height:4px;background:var(--nt-bg3);border-radius:2px;overflow:hidden">
                <div style="height:100%;width:${i.pct}%;background:linear-gradient(90deg,var(--nt-accent),${i.success?"var(--nt-green)":"#fbbf24"});border-radius:2px;transition:width 0.5s ease"></div>
            </div>
            ${i.success?"":'<div style="font-size:10px;color:var(--nt-text-3);margin-top:12px">Do not close this window</div>'}
        </div>
    `,!document.getElementById("nt-spin-kf")){const r=document.createElement("style");r.id="nt-spin-kf",r.textContent="@keyframes nt-spin { to { transform: rotate(360deg); } }",document.head.appendChild(r)}}function gi(){const e=document.getElementById("nt-overlay");e&&e.classList.remove("active")}function wb(e){e.innerHTML=`
        <div class="nt-card" style="margin-top:16px">
            <div style="text-align:center;margin-bottom:20px">
                <div style="width:48px;height:48px;border-radius:50%;background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-shield-check" style="font-size:22px;color:var(--nt-green)"></i>
                </div>
                <div style="font-size:16px;font-weight:700;color:var(--nt-text)">Public Verification</div>
                <div style="font-size:12px;color:var(--nt-text-3);margin-top:4px;max-width:380px;margin-left:auto;margin-right:auto">
                    Verify if a document was notarized on the blockchain. <strong style="color:var(--nt-green)">No wallet needed.</strong>
                </div>
            </div>

            <div class="nt-dropzone" id="nt-verify-dropzone" style="margin-bottom:16px">
                <input type="file" id="nt-verify-file-input" style="display:none">
                <div style="width:48px;height:48px;border-radius:var(--nt-radius);background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:12px">
                    <i class="fa-solid fa-magnifying-glass" style="font-size:20px;color:var(--nt-green)"></i>
                </div>
                <div style="font-size:14px;font-weight:600;color:var(--nt-text);margin-bottom:4px">Drag a file to verify</div>
                <div style="font-size:11px;color:var(--nt-text-3)">The SHA-256 hash will be computed locally</div>
            </div>

            <div id="nt-verify-result"></div>
        </div>
    `,yb(),T.verifyResult&&hd()}function yb(){const e=document.getElementById("nt-verify-dropzone"),t=document.getElementById("nt-verify-file-input");!e||!t||(e.onclick=()=>t.click(),["dragenter","dragover","dragleave","drop"].forEach(a=>{e.addEventListener(a,n=>{n.preventDefault(),n.stopPropagation()})}),e.addEventListener("dragenter",()=>e.classList.add("drag-over")),e.addEventListener("dragover",()=>e.classList.add("drag-over")),e.addEventListener("dragleave",()=>e.classList.remove("drag-over")),e.addEventListener("drop",a=>{var n,i;e.classList.remove("drag-over"),Ss((i=(n=a.dataTransfer)==null?void 0:n.files)==null?void 0:i[0])}),t.addEventListener("change",a=>{var n;return Ss((n=a.target.files)==null?void 0:n[0])}))}async function Ss(e){if(!e)return;T.verifyFile=e,T.verifyHash=null,T.verifyResult=null,T.verifyIsChecking=!0;const t=document.getElementById("nt-verify-result");t&&(t.innerHTML=`
            <div style="text-align:center;padding:20px;color:var(--nt-text-3);font-size:13px">
                <i class="fa-solid fa-spinner fa-spin" style="margin-right:6px;color:var(--nt-accent)"></i>Computing hash and verifying...
            </div>
        `);try{const a=await nt.calculateFileHash(e);T.verifyHash=a;const n=await nt.verifyByHash(a);T.verifyResult=n,T.verifyIsChecking=!1,hd()}catch(a){console.error("[NotaryPage] Verify error:",a),T.verifyIsChecking=!1,t&&(t.innerHTML=`
                <div class="nt-not-found" style="text-align:center">
                    <i class="fa-solid fa-circle-xmark" style="font-size:20px;color:var(--nt-red);margin-bottom:8px"></i>
                    <div style="font-size:13px;color:var(--nt-red)">Verification error: ${a.message}</div>
                </div>
            `)}}function hd(){const e=document.getElementById("nt-verify-result");if(!e||!T.verifyResult)return;const t=T.verifyResult,a=T.verifyFile;t.exists?e.innerHTML=`
            <div class="nt-verified">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
                    <div style="width:40px;height:40px;border-radius:50%;background:rgba(34,197,94,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="fa-solid fa-shield-check" style="font-size:18px;color:var(--nt-green)"></i>
                    </div>
                    <div>
                        <div style="font-size:15px;font-weight:700;color:var(--nt-green)">Document Verified!</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">This document was notarized on the blockchain</div>
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Token ID</div>
                        <div style="font-size:16px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.tokenId}</div>
                    </div>
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Data</div>
                        <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${Ar(t.timestamp)}</div>
                    </div>
                </div>

                <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px;margin-bottom:12px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Owner</div>
                    <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${t.owner}</div>
                </div>

                ${T.verifyHash?`
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">SHA-256 Hash</div>
                        <div style="font-size:10px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${T.verifyHash}</div>
                    </div>
                `:""}

                <div style="margin-top:12px;display:flex;gap:8px">
                    <a href="${Ir}${w==null?void 0:w.decentralizedNotary}?a=${t.tokenId}" target="_blank" class="nt-btn-secondary" style="font-size:12px;padding:8px 14px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i>View on Arbiscan
                    </a>
                </div>
            </div>
        `:e.innerHTML=`
            <div class="nt-not-found">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
                    <div style="width:40px;height:40px;border-radius:50%;background:rgba(239,68,68,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                        <i class="fa-solid fa-circle-xmark" style="font-size:18px;color:var(--nt-red)"></i>
                    </div>
                    <div>
                        <div style="font-size:15px;font-weight:700;color:var(--nt-red)">Not Found</div>
                        <div style="font-size:11px;color:var(--nt-text-3)">This document was not notarized on the blockchain</div>
                    </div>
                </div>

                ${a?`<div style="font-size:12px;color:var(--nt-text-3);margin-bottom:8px">File: <strong style="color:var(--nt-text-2)">${a.name}</strong></div>`:""}
                ${T.verifyHash?`
                    <div style="background:rgba(0,0,0,0.2);border-radius:var(--nt-radius-sm);padding:10px">
                        <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">SHA-256 Hash</div>
                        <div style="font-size:10px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${T.verifyHash}</div>
                    </div>
                `:""}
            </div>
        `}function kb(e){if(T.statsLoading&&!T.stats){e.innerHTML=`
            <div class="nt-stat-grid" style="margin-top:16px">
                ${Array(4).fill("").map(()=>'<div class="nt-stat-card"><div class="nt-shimmer" style="height:32px;width:60%;margin:0 auto 8px"></div><div class="nt-shimmer" style="height:12px;width:40%;margin:0 auto"></div></div>').join("")}
            </div>
        `;return}const t=T.stats,a=T.totalSupply;e.innerHTML=`
        <div style="margin-top:16px">
            <div class="nt-stat-grid">
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:var(--nt-accent-glow);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-stamp" style="font-size:16px;color:var(--nt-accent)"></i>
                    </div>
                    <div class="nt-stat-value">${(t==null?void 0:t.totalNotarizations)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Notarizations</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(34,197,94,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-certificate" style="font-size:16px;color:var(--nt-green)"></i>
                    </div>
                    <div class="nt-stat-value">${a??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">Certificates</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(251,191,36,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-solid fa-coins" style="font-size:16px;color:#fbbf24"></i>
                    </div>
                    <div class="nt-stat-value" style="font-size:18px">${(t==null?void 0:t.totalBKCFormatted)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">BKC Collected</div>
                </div>
                <div class="nt-stat-card">
                    <div style="width:36px;height:36px;border-radius:50%;background:rgba(96,165,250,0.1);display:inline-flex;align-items:center;justify-content:center;margin-bottom:10px">
                        <i class="fa-brands fa-ethereum" style="font-size:16px;color:var(--nt-blue)"></i>
                    </div>
                    <div class="nt-stat-value" style="font-size:18px">${(t==null?void 0:t.totalETHFormatted)??"â€”"}</div>
                    <div style="font-size:11px;color:var(--nt-text-3);margin-top:4px">ETH Collected</div>
                </div>
            </div>

            <!-- Recent notarizations -->
            <div class="nt-card" style="margin-top:16px;padding:0;overflow:hidden">
                <div style="padding:16px 20px;border-bottom:1px solid var(--nt-border)">
                    <div style="font-size:13px;font-weight:700;color:var(--nt-text)">
                        <i class="fa-solid fa-clock-rotate-left" style="color:var(--nt-accent);margin-right:6px"></i>Recent Notarizations
                    </div>
                </div>
                <div id="nt-recent-feed">
                    ${T.recentNotarizations.length===0?`
                        <div style="text-align:center;padding:32px 20px;color:var(--nt-text-3);font-size:13px">
                            ${T.statsLoading?'<i class="fa-solid fa-spinner fa-spin" style="margin-right:6px"></i>Loading...':"No recent notarizations found"}
                        </div>
                    `:T.recentNotarizations.map(n=>`
                        <div class="nt-recent-item">
                            <div style="width:36px;height:36px;border-radius:50%;background:var(--nt-accent-glow);display:flex;align-items:center;justify-content:center;flex-shrink:0">
                                <i class="fa-solid fa-stamp" style="font-size:14px;color:var(--nt-accent)"></i>
                            </div>
                            <div style="flex:1;min-width:0">
                                <div style="font-size:12px;font-weight:600;color:var(--nt-text)">Certificate #${n.tokenId}</div>
                                <div style="font-size:11px;color:var(--nt-text-3)">${Br(n.owner)}</div>
                            </div>
                            <div style="text-align:right;flex-shrink:0">
                                <div style="font-size:11px;color:var(--nt-text-3)">${fd(n.timestamp)}</div>
                            </div>
                        </div>
                    `).join("")}
                </div>
            </div>

            <div style="text-align:center;margin-top:16px">
                <a href="${Ir}${w==null?void 0:w.decentralizedNotary}" target="_blank" class="nt-btn-secondary" style="font-size:12px;padding:10px 20px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>View Contract on Arbiscan
                </a>
            </div>
        </div>
    `}function Eb(e){var i;const t=T.selectedCert;if(!t){gd();return}const a=bd(t.ipfs),n=Ja(t.mimeType||"",t.description||"");(t.mimeType||"").includes("image")||/\.(jpg|jpeg|png|gif|webp|svg|bmp)$/i.test(t.fileName||t.description||""),e.innerHTML=`
        <div class="nt-detail" style="margin-top:8px">
            <!-- Image Preview (large, clickable) -->
            ${a?`
                <a href="${a}" target="_blank" style="display:block;text-decoration:none;margin-bottom:16px">
                    <div style="min-height:240px;max-height:400px;background:var(--nt-bg3);border-radius:var(--nt-radius);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid var(--nt-border);cursor:pointer;transition:border-color var(--nt-transition)" onmouseover="this.style.borderColor='rgba(245,158,11,0.3)'" onmouseout="this.style.borderColor='var(--nt-border)'">
                        <img src="${a}" style="width:100%;height:100%;object-fit:contain;max-height:400px" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'" alt="Certificate #${t.id}">
                        <div style="display:none;flex-direction:column;align-items:center;justify-content:center;width:100%;height:240px;position:absolute;inset:0;background:var(--nt-bg3)">
                            <i class="${n.icon}" style="font-size:48px;color:${n.color};margin-bottom:8px"></i>
                            <span style="font-size:12px;color:var(--nt-text-3)">${n.label} file</span>
                        </div>
                        <div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.id}</div>
                        <div style="position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,0.75);padding:4px 10px;border-radius:8px;font-size:10px;color:var(--nt-text-2)">
                            <i class="fa-solid fa-expand" style="margin-right:4px"></i>Click to view full size
                        </div>
                    </div>
                </a>
            `:`
                <div style="height:200px;background:var(--nt-bg3);border-radius:var(--nt-radius);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;margin-bottom:16px;border:1px solid var(--nt-border)">
                    <div style="text-align:center">
                        <i class="${n.icon}" style="font-size:48px;color:${n.color};margin-bottom:8px"></i>
                        <div style="font-size:12px;color:var(--nt-text-3)">${n.label} file</div>
                    </div>
                    <div style="position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;color:var(--nt-accent);font-family:monospace">#${t.id}</div>
                </div>
            `}

            <!-- Add to Wallet â€” Primary Action -->
            <button class="nt-btn-primary" style="width:100%;padding:14px;font-size:15px;margin-bottom:16px;display:flex;align-items:center;justify-content:center;gap:8px" onclick="NotaryPage.addToWallet('${t.id}', '${a}')">
                <i class="fa-solid fa-wallet"></i>Add Certificate to Wallet
            </button>

            <!-- Description -->
            <div class="nt-card" style="margin-bottom:12px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">Description</div>
                <div style="font-size:14px;color:var(--nt-text);line-height:1.5">${((i=t.description)==null?void 0:i.split("---")[0].trim())||"Notarized Document"}</div>
            </div>

            <!-- Content Hash -->
            <div class="nt-card" style="margin-bottom:12px">
                <div style="font-size:11px;font-weight:600;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px">
                    <i class="fa-solid fa-fingerprint" style="color:var(--nt-accent);margin-right:4px"></i>Content Hash (SHA-256)
                </div>
                <div class="nt-hash-display" onclick="NotaryPage.copyHash('${t.hash}')" title="Click to copy">
                    ${t.hash||"N/A"}
                    <i class="fa-regular fa-copy" style="float:right;margin-top:2px;color:var(--nt-accent)"></i>
                </div>
            </div>

            <!-- Metadata grid -->
            <div class="nt-detail-meta" style="margin-bottom:12px">
                <div class="nt-card" style="padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Date</div>
                    <div style="font-size:13px;font-weight:600;color:var(--nt-text)">${Ar(t.timestamp)||"N/A"}</div>
                </div>
                <div class="nt-card" style="padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Owner</div>
                    <div style="font-size:12px;font-family:monospace;color:var(--nt-text-2)">${Br(t.owner||d.userAddress)}</div>
                </div>
            </div>

            ${t.ipfs?`
                <div class="nt-card" style="margin-bottom:12px;padding:14px">
                    <div style="font-size:10px;color:var(--nt-text-3);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">IPFS CID</div>
                    <div style="font-size:11px;font-family:monospace;color:var(--nt-text-2);word-break:break-all">${t.ipfs}</div>
                </div>
            `:""}

            <!-- Secondary Actions -->
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                ${a?`
                    <a href="${a}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-download"></i>Download from IPFS
                    </a>
                `:""}
                <a href="${Ir}${w==null?void 0:w.decentralizedNotary}?a=${t.id}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>View on Arbiscan
                </a>
                ${t.txHash?`
                    <a href="${lb}${t.txHash}" target="_blank" class="nt-btn-secondary" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;font-size:12px">
                        <i class="fa-solid fa-receipt"></i>Transaction
                    </a>
                `:""}
            </div>
        </div>
    `}async function Tb(){try{const e=await nt.getFee();T.bkcFee=e.bkcFee,T.ethFee=e.ethFee,T.feesLoaded=!0}catch{T.bkcFee=(se==null?void 0:se.parseEther("1"))||0n,T.ethFee=(se==null?void 0:se.parseEther("0.0001"))||0n,T.feesLoaded=!0}}async function Pr(){if(!d.isConnected||!d.userAddress)return;T.certsLoading=!0,be();let e=!1;try{const t=ze.getNotaryHistory;console.log("[NotaryPage] Loading certificates from API:",`${t}/${d.userAddress}`);const a=await fetch(`${t}/${d.userAddress}`);if(!a.ok)throw new Error(`API ${a.status}`);const n=await a.json();console.log("[NotaryPage] API response:",typeof n,Array.isArray(n)?`array(${n.length})`:JSON.stringify(n).substring(0,200));const i=Array.isArray(n)?n:Array.isArray(n==null?void 0:n.documents)?n.documents:Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n==null?void 0:n.history)?n.history:null;i&&i.length>0&&(T.certificates=i.map(r=>({id:r.tokenId||r.id||"?",ipfs:r.ipfsCid||r.ipfsUri||"",description:r.description||"",hash:r.contentHash||"",timestamp:r.createdAt||r.timestamp||"",txHash:r.txHash||r.transactionHash||"",owner:r.owner||d.userAddress,mimeType:r.mimeType||"",fileName:r.fileName||""})).sort((r,s)=>parseInt(s.id)-parseInt(r.id)),e=!0,console.log("[NotaryPage] Loaded",T.certificates.length,"certificates from API"))}catch(t){console.warn("[NotaryPage] API failed:",t.message)}if(!e){console.log("[NotaryPage] Trying on-chain event fallback...");try{const t=await Cb();T.certificates=t,console.log("[NotaryPage] Loaded",t.length,"certificates from chain events")}catch(t){console.error("[NotaryPage] Chain fallback also failed:",t),T.certificates=[]}}T.certsLoading=!1,be()}async function Cb(){if(!se||!(w!=null&&w.decentralizedNotary))return console.warn("[NotaryPage] Chain fallback: missing ethers or contract address"),[];const{NetworkManager:e}=await W(async()=>{const{NetworkManager:o}=await import("./index-Jv5HScoX.js");return{NetworkManager:o}},[]),t=e.getProvider();if(!t)return console.warn("[NotaryPage] Chain fallback: no provider available"),[];console.log("[NotaryPage] Querying DocumentNotarized events for:",d.userAddress);const a=new se.Contract(w.decentralizedNotary,md,t),n=a.filters.DocumentNotarized(null,d.userAddress),i=await t.getBlockNumber(),r=Math.max(0,i-5e5);console.log("[NotaryPage] Block range:",r,"->",i);const s=await a.queryFilter(n,r,i);return console.log("[NotaryPage] Found",s.length,"events"),s.map(o=>({id:Number(o.args.tokenId),ipfs:o.args.ipfsCid||"",description:"",hash:o.args.contentHash||"",timestamp:null,txHash:o.transactionHash,owner:o.args.owner})).sort((o,l)=>l.id-o.id)}async function Ib(){T.statsLoading=!0;try{const[e,t]=await Promise.all([nt.getStats(),nt.getTotalDocuments()]);T.stats=e,T.totalSupply=t}catch(e){console.warn("[NotaryPage] Stats load error:",e)}try{await Ab()}catch{}T.statsLoading=!1,T.view==="stats"&&be()}async function Ab(){if(!se||!(w!=null&&w.decentralizedNotary))return;const{NetworkManager:e}=await W(async()=>{const{NetworkManager:l}=await import("./index-Jv5HScoX.js");return{NetworkManager:l}},[]),t=e.getProvider();if(!t)return;const a=new se.Contract(w.decentralizedNotary,md,t),n=a.filters.DocumentNotarized(),i=await t.getBlockNumber(),r=Math.max(0,i-5e4),o=(await a.queryFilter(n,r,i)).slice(-20).reverse();T.recentNotarizations=o.map(l=>({tokenId:Number(l.args.tokenId),owner:l.args.owner,hash:l.args.contentHash,timestamp:null,blockNumber:l.blockNumber}));try{const l=[...new Set(o.map(u=>u.blockNumber))],c={};await Promise.all(l.slice(0,10).map(async u=>{const f=await t.getBlock(u);f&&(c[u]=f.timestamp)})),T.recentNotarizations.forEach(u=>{c[u.blockNumber]&&(u.timestamp=c[u.blockNumber])})}catch{}}async function Bb(e,t){var a,n;try{const i=l=>{var u;if(!l)return"";if(l.startsWith("https://")&&!l.includes("/ipfs/"))return l;const c=l.startsWith("ipfs://")?l.replace("ipfs://",""):l.includes("/ipfs/")?(u=l.split("/ipfs/")[1])==null?void 0:u.split("?")[0]:"";return c?`${yi[0]}${c}`:l};let r=i(t||"");if(d.decentralizedNotaryContract)try{const l=await d.decentralizedNotaryContract.tokenURI(e);if(l!=null&&l.startsWith("data:application/json;base64,")){const c=JSON.parse(atob(l.replace("data:application/json;base64,","")));c.image&&(r=i(c.image))}}catch{}const s=(w==null?void 0:w.decentralizedNotary)||((a=d.decentralizedNotaryContract)==null?void 0:a.target)||((n=d.decentralizedNotaryContract)!=null&&n.getAddress?await d.decentralizedNotaryContract.getAddress():null);if(!s){h("Contract address not found","error");return}h(`Adding NFT #${e} to wallet...`,"info"),await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC721",options:{address:s,tokenId:String(e),image:r}}})&&h(`NFT #${e} added to wallet!`,"success")}catch(i){if(i.code===4001)return;h("Could not add NFT","error")}}function zb(e){e&&navigator.clipboard.writeText(e).then(()=>{h("Hash copied!","success")}).catch(()=>{h("Failed to copy","error")})}function Pb(){var e;T.wizStep===1&&T.wizFileHash&&!((e=T.wizDuplicateCheck)!=null&&e.exists)?T.wizStep=2:T.wizStep===2&&(T.wizStep=3),be()}function Nb(){T.wizStep>1&&(T.wizStep--,be())}function $b(){const e=document.getElementById("nt-wiz-desc");e&&(T.wizDescription=e.value||""),T.wizStep=3,be()}function Sb(){T.wizFile=null,T.wizFileHash=null,T.wizDuplicateCheck=null,T.wizStep=1,be()}function Lb(e){const t=T.certificates.find(a=>String(a.id)===String(e));t&&cb("cert-detail",t)}const vd={async render(e){e&&pb()},reset(){T.wizFile=null,T.wizFileHash=null,T.wizDescription="",T.wizDuplicateCheck=null,T.wizStep=1,T.view="documents",T.activeTab="documents",T.viewHistory=[],be(),fa()},update(){if(!T.isProcessing&&T.view==="notarize"){const e=document.getElementById("nt-wiz-panel");e&&T.wizStep===2&&xd(e)}},refreshHistory(){Pr()},setTab:db,goBack:gd,viewCert:Lb,handleMint:vb,addToWallet:Bb,copyHash:zb,wizNext:Pb,wizBack:Nb,wizToStep3:$b,wizRemoveFile:Sb};window.NotaryPage=vd;const Gn=window.ethers,Ls=24*60*60,Di={Diamond:{emoji:"ðŸ’Ž",color:"#22d3ee",bg:"rgba(34,211,238,0.15)",border:"rgba(34,211,238,0.3)",keepRate:100,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeicgip72jcqgsirlrhn3tq5cc226vmko6etnndzl6nlhqrktfikafq"},Gold:{emoji:"ðŸ¥‡",color:"#fbbf24",bg:"rgba(251,191,36,0.15)",border:"rgba(251,191,36,0.3)",keepRate:90,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeifponccrbicg2pcjrn2hrfoqgc77xhm2r4ld7hdpw6cxxkbsckf44"},Silver:{emoji:"ðŸ¥ˆ",color:"#9ca3af",bg:"rgba(156,163,175,0.15)",border:"rgba(156,163,175,0.3)",keepRate:75,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeihvi2inujm5zpi7tl667g4srq273536pjkglwyrtbwmgnskmu7jg4"},Bronze:{emoji:"ðŸ¥‰",color:"#fb923c",bg:"rgba(251,146,60,0.15)",border:"rgba(251,146,60,0.3)",keepRate:60,image:"https://white-defensive-eel-240.mypinata.cloud/ipfs/bafybeiclqidb67rt3tchhjpsib62s624li7j2bpxnr6b5w5mfp4tomhu7m"}},_={activeTab:"marketplace",filterTier:"ALL",sortBy:"featured",selectedListing:null,isLoading:!1,isTransactionPending:!1,countdownIntervals:[],promotions:new Map},Ue=e=>e==null?"":String(e),Rb=(e,t)=>Ue(e)===Ue(t),Ha=(e,t)=>e&&t&&e.toLowerCase()===t.toLowerCase();function Za(e){return he.find(t=>t.boostBips===Number(e))||{name:"Unknown",boostBips:0}}function Kn(e){return Di[e]||{emoji:"ðŸ’Ž",color:"#71717a",bg:"rgba(113,113,122,0.15)",border:"rgba(113,113,122,0.3)",keepRate:50}}function wd(e){const t=e-Math.floor(Date.now()/1e3);if(t<=0)return{text:"Expired",expired:!0,seconds:0};const a=Math.floor(t/3600),n=Math.floor(t%3600/60),i=t%60;return a>0?{text:`${a}h ${n}m`,expired:!1,seconds:t}:n>0?{text:`${n}m ${i}s`,expired:!1,seconds:t}:{text:`${i}s`,expired:!1,seconds:t}}function _b(e){const t=Math.floor(Date.now()/1e3),a=e-t;if(a<=0)return null;const n=Math.floor(a/3600),i=Math.floor(a%3600/60);return n>0?`${n}h ${i}m`:`${i}m`}function yd(e){if(e.lastRentalEndTime)return Number(e.lastRentalEndTime)+Ls;if(e.rentalEndTime&&!e.isRented){const t=Number(e.rentalEndTime),a=Math.floor(Date.now()/1e3);if(t<a)return t+Ls}return null}function Rs(e){const t=Math.floor(Date.now()/1e3),a=yd(e);return a&&a>t}function _s(e){const t=Math.floor(Date.now()/1e3);if(!e.lastRentalEndTime&&!e.rentalEndTime)return e.createdAt?t-Number(e.createdAt):Number.MAX_SAFE_INTEGER;const a=e.lastRentalEndTime?Number(e.lastRentalEndTime):e.rentalEndTime?Number(e.rentalEndTime):0;return a>t?0:t-a}function Fb(){if(document.getElementById("rental-styles-v6"))return;const e=document.createElement("style");e.id="rental-styles-v6",e.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V6.9 Rental Page Styles - Modern & Clean
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        @keyframes float { 
            0%, 100% { transform: translateY(0) rotate(-2deg); } 
            50% { transform: translateY(-8px) rotate(2deg); } 
        }
        @keyframes pulse-glow { 
            0%, 100% { box-shadow: 0 0 20px rgba(34,197,94,0.2); } 
            50% { box-shadow: 0 0 40px rgba(34,197,94,0.4); } 
        }
        @keyframes card-in {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .float-animation { animation: float 4s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        
        /* Main Cards */
        .rental-card-base {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        /* NFT Cards */
        .nft-card {
            background: linear-gradient(165deg, rgba(24,24,27,0.98) 0%, rgba(15,15,17,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 20px;
            overflow: hidden;
            animation: card-in 0.5s ease-out forwards;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nft-card:hover {
            transform: translateY(-6px);
            border-color: rgba(34,197,94,0.4);
            box-shadow: 0 25px 50px -15px rgba(0,0,0,0.5), 0 0 30px -10px rgba(34,197,94,0.15);
        }
        .nft-card.promoted {
            border-color: rgba(251,191,36,0.3);
            box-shadow: 0 0 30px -10px rgba(251,191,36,0.2);
        }
        .nft-card.promoted:hover {
            border-color: rgba(251,191,36,0.5);
        }
        .nft-card.owned { border-color: rgba(59,130,246,0.3); }
        .nft-card.cooldown { opacity: 0.6; filter: grayscale(40%); }
        .nft-card.cooldown:hover { transform: none; }
        
        /* Tier Badge */
        .tier-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Tabs */
        .rental-tab {
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.25s;
            cursor: pointer;
            color: #71717a;
            white-space: nowrap;
            border: none;
            background: transparent;
        }
        .rental-tab:hover:not(.active) {
            color: #a1a1aa;
            background: rgba(63,63,70,0.3);
        }
        .rental-tab.active {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #000;
            box-shadow: 0 4px 20px rgba(34,197,94,0.35);
        }
        .rental-tab .tab-count {
            display: inline-flex;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            margin-left: 6px;
            font-size: 10px;
            font-weight: 700;
            border-radius: 9px;
            background: rgba(0,0,0,0.25);
            align-items: center;
            justify-content: center;
        }
        
        /* Filter Chips */
        .filter-chip {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.25s;
            cursor: pointer;
            border: 1px solid transparent;
            background: rgba(39,39,42,0.7);
            color: #71717a;
        }
        .filter-chip:hover:not(.active) {
            color: #fff;
            background: rgba(63,63,70,0.7);
        }
        .filter-chip.active {
            background: rgba(34,197,94,0.15);
            color: #22c55e;
            border-color: rgba(34,197,94,0.3);
        }
        
        /* Buttons */
        .btn-rent {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-rent:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34,197,94,0.4);
        }
        .btn-rent:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: rgba(63,63,70,0.8);
            color: #a1a1aa;
            font-weight: 600;
            border: 1px solid rgba(63,63,70,0.8);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background: rgba(63,63,70,1);
            color: #fff;
        }
        
        .btn-danger {
            background: rgba(239,68,68,0.15);
            color: #f87171;
            font-weight: 600;
            border: 1px solid rgba(239,68,68,0.3);
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-danger:hover {
            background: rgba(239,68,68,0.25);
        }
        
        /* Timer */
        .rental-timer {
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 8px;
        }
        .rental-timer.active {
            background: rgba(34,197,94,0.15);
            color: #22c55e;
            border: 1px solid rgba(34,197,94,0.25);
        }
        .rental-timer.warning {
            background: rgba(245,158,11,0.15);
            color: #f59e0b;
            border: 1px solid rgba(245,158,11,0.25);
        }
        .rental-timer.critical {
            background: rgba(239,68,68,0.15);
            color: #ef4444;
            border: 1px solid rgba(239,68,68,0.25);
            animation: pulse 1s infinite;
        }
        .rental-timer.cooldown {
            background: rgba(99,102,241,0.15);
            color: #818cf8;
            border: 1px solid rgba(99,102,241,0.25);
        }
        
        /* Promo Badge */
        .promo-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(90deg, rgba(251,191,36,0.15) 0%, rgba(249,115,22,0.15) 100%);
            border: 1px solid rgba(251,191,36,0.25);
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            color: #fbbf24;
            text-transform: uppercase;
        }
        
        /* Modal */
        .rental-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .rental-modal.active { display: flex; }
        .rental-modal-content {
            background: linear-gradient(145deg, rgba(39,39,42,0.98) 0%, rgba(24,24,27,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Empty State */
        .rental-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }
        
        /* Scrollbar */
        .rental-scrollbar::-webkit-scrollbar { width: 5px; }
        .rental-scrollbar::-webkit-scrollbar-track { background: rgba(39,39,42,0.5); border-radius: 3px; }
        .rental-scrollbar::-webkit-scrollbar-thumb { background: rgba(113,113,122,0.5); border-radius: 3px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .rental-stats-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .nft-grid { grid-template-columns: 1fr !important; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
    `,document.head.appendChild(e)}function Oi(){const e=document.getElementById("rental");if(!e)return;Fb();const t=d.rentalListings||[],a=t.filter(r=>d.isConnected&&Ha(r.owner,d.userAddress)),n=Math.floor(Date.now()/1e3),i=(d.myRentals||[]).filter(r=>Ha(r.tenant,d.userAddress)&&Number(r.endTime)>n);e.innerHTML=`
        <div class="max-w-6xl mx-auto px-4 py-6">
            
            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-green-600/20 border border-emerald-500/30 flex items-center justify-center float-animation">
                        <i class="fa-solid fa-key text-2xl text-emerald-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">AirBNFT</h1>
                        <p class="text-sm text-zinc-500">Rent NFTs to reduce burn rate on claims</p>
                    </div>
                </div>
                <div id="header-stats" class="flex items-center gap-3"></div>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6 rental-stats-grid">
                <div class="rental-card-base p-4 text-center">
                    <p class="text-2xl font-bold text-emerald-400 font-mono">${t.length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Listed NFTs</p>
                </div>
                <div class="rental-card-base p-4 text-center">
                    <p class="text-2xl font-bold text-blue-400 font-mono">${t.filter(r=>r.isRented).length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Currently Rented</p>
                </div>
                <div class="rental-card-base p-4 text-center">
                    <p class="text-2xl font-bold text-amber-400 font-mono">${a.length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">My Listings</p>
                </div>
                <div class="rental-card-base p-4 text-center">
                    <p class="text-2xl font-bold text-purple-400 font-mono">${i.length}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">My Rentals</p>
                </div>
            </div>
            
            <!-- Tabs -->
            <div class="flex flex-wrap items-center gap-2 mb-6 pb-4 border-b border-zinc-800/50">
                <button class="rental-tab ${_.activeTab==="marketplace"?"active":""}" data-tab="marketplace">
                    <i class="fa-solid fa-store mr-2"></i>Marketplace
                </button>
                <button class="rental-tab ${_.activeTab==="my-listings"?"active":""}" data-tab="my-listings">
                    <i class="fa-solid fa-tags mr-2"></i>My Listings
                    <span class="tab-count" id="cnt-listings">${a.length}</span>
                </button>
                <button class="rental-tab ${_.activeTab==="my-rentals"?"active":""}" data-tab="my-rentals">
                    <i class="fa-solid fa-clock-rotate-left mr-2"></i>My Rentals
                    <span class="tab-count" id="cnt-rentals">${i.length}</span>
                </button>
            </div>
            
            <!-- Tab Content -->
            <div id="tab-content"></div>
        </div>
        
        <!-- Modals -->
        ${jb()}
        ${Wb()}
        ${Gb()}
    `,Kb(),za()}function Mb(){return d.isConnected?`
        <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20">
            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
            <span class="text-emerald-400 text-sm font-medium">Connected</span>
        </div>
    `:`
            <button onclick="window.openConnectModal && window.openConnectModal()" 
                class="btn-rent px-6 py-2.5 text-sm">
                <i class="fa-solid fa-wallet mr-2"></i>Connect
            </button>
        `}function za(){const e=document.getElementById("tab-content");if(e){switch(_.activeTab){case"marketplace":e.innerHTML=Db();break;case"my-listings":e.innerHTML=Ob();break;case"my-rentals":e.innerHTML=Hb();break}document.getElementById("header-stats").innerHTML=Mb(),_.activeTab==="my-rentals"&&Zb()}}function Db(){const e=d.rentalListings||[],t=Math.floor(Date.now()/1e3);let a=e.filter(n=>!(n.isRented||n.rentalEndTime&&Number(n.rentalEndTime)>t||_.filterTier!=="ALL"&&Za(n.boostBips).name!==_.filterTier));return a.sort((n,i)=>{const r=BigInt(n.promotionFee||"0")||_.promotions.get(Ue(n.tokenId))||0n,s=BigInt(i.promotionFee||"0")||_.promotions.get(Ue(i.tokenId))||0n,o=Rs(n),l=Rs(i);if(!o&&l)return-1;if(o&&!l||s>r)return 1;if(s<r)return-1;if(_.sortBy==="featured"){const f=_s(n),p=_s(i);if(p!==f)return p-f}const c=BigInt(n.pricePerHour||0),u=BigInt(i.pricePerHour||0);return _.sortBy==="price-low"?c<u?-1:1:_.sortBy==="price-high"?c>u?-1:1:(i.boostBips||0)-(n.boostBips||0)}),`
        <div>
            <!-- Filters & Sort -->
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                <div class="flex flex-wrap gap-2">
                    <button class="filter-chip ${_.filterTier==="ALL"?"active":""}" data-filter="ALL">All Tiers</button>
                    ${Object.keys(Di).map(n=>`
                        <button class="filter-chip ${_.filterTier===n?"active":""}" data-filter="${n}">
                            ${Di[n].emoji} ${n}
                        </button>
                    `).join("")}
                </div>
                <div class="flex items-center gap-3">
                    <select id="sort-select" class="bg-zinc-800/80 border border-zinc-700 rounded-xl px-4 py-2.5 text-sm text-white outline-none cursor-pointer">
                        <option value="featured" ${_.sortBy==="featured"?"selected":""}>ðŸ”¥ Featured</option>
                        <option value="price-low" ${_.sortBy==="price-low"?"selected":""}>Price: Low to High</option>
                        <option value="price-high" ${_.sortBy==="price-high"?"selected":""}>Price: High to Low</option>
                        <option value="boost-high" ${_.sortBy==="boost-high"?"selected":""}>Keep Rate: High to Low</option>
                    </select>
                    ${d.isConnected?`
                        <button id="btn-open-list" class="btn-rent px-5 py-2.5 text-sm">
                            <i class="fa-solid fa-plus mr-2"></i>List NFT
                        </button>
                    `:""}
                </div>
            </div>
            
            <!-- NFT Grid -->
            ${a.length===0?Nr("No NFTs Available","Be the first to list your NFT!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 nft-grid">
                    ${a.map((n,i)=>kd(n,i)).join("")}
                </div>
            `}
        </div>
    `}function kd(e,t){const a=Za(e.boostBips),n=Kn(a.name),i=M(BigInt(e.pricePerHour||0)).toFixed(2),r=Ue(e.tokenId),s=d.isConnected&&Ha(e.owner,d.userAddress),o=yd(e),l=Math.floor(Date.now()/1e3),c=o&&o>l,u=c?_b(o):null,f=BigInt(e.promotionFee||"0")||_.promotions.get(r)||0n,p=f>0n,b=p?parseFloat(Gn.formatEther(f)).toFixed(3):"0",m=ht(e.boostBips||0);return`
        <div class="nft-card ${p?"promoted":""} ${s?"owned":""} ${c?"cooldown":""}" 
             style="animation-delay:${t*60}ms">
            
            <!-- Header -->
            <div class="flex items-center justify-between p-4 pb-0">
                <div class="tier-badge" style="background:${n.bg};color:${n.color};border:1px solid ${n.border}">
                    ${n.emoji} ${a.name}
                </div>
                <span class="text-sm font-bold font-mono" style="color:${n.color}">
                    Keep ${m}%
                </span>
            </div>
            
            <!-- Promo Badge -->
            ${p?`
                <div class="mx-4 mt-3">
                    <div class="promo-badge">
                        <i class="fa-solid fa-fire"></i>
                        <span>PROMOTED</span>
                        <span class="ml-auto font-mono">${b} ETH</span>
                    </div>
                </div>
            `:""}
            
            <!-- NFT Display -->
            <div class="relative aspect-square flex items-center justify-center p-6">
                <div class="absolute inset-0 rounded-2xl opacity-50"
                     style="background: radial-gradient(circle at center, ${n.color}15 0%, transparent 70%);"></div>
                <img src="${n.image}" alt="${a.name} Booster" class="w-4/5 h-4/5 object-contain float-animation rounded-xl" onerror="this.outerHTML='<div class=\\'text-7xl float-animation\\'>${n.emoji}</div>'">
                
                ${s?`
                    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 px-3 py-1.5 rounded-full bg-blue-500/20 border border-blue-500/30 text-blue-400 text-[10px] font-bold">
                        <i class="fa-solid fa-user mr-1"></i>YOURS
                    </div>
                `:""}
                
                ${c&&!s?`
                    <div class="absolute inset-0 bg-black/70 rounded-2xl flex flex-col items-center justify-center">
                        <i class="fa-solid fa-hourglass-half text-3xl text-indigo-400 mb-2"></i>
                        <span class="text-xs text-indigo-300 font-semibold">Cooldown</span>
                        <span class="text-lg text-indigo-400 font-bold font-mono">${u}</span>
                    </div>
                `:""}
            </div>
            
            <!-- Info -->
            <div class="p-4 pt-0">
                <div class="flex items-baseline justify-between mb-2">
                    <h3 class="text-base font-bold text-white">${a.name} Booster</h3>
                    <span class="text-xs font-mono" style="color:${n.color}">#${r}</span>
                </div>
                
                <p class="text-xs ${m===100?"text-emerald-400":"text-zinc-500"} mb-4">
                    ${m===100?"âœ¨ Keep 100% of your rewards!":`Save ${m-50}% on claim burns`}
                </p>
                
                <div class="h-px bg-gradient-to-r from-transparent via-zinc-700 to-transparent mb-4"></div>
                
                <!-- Price & Actions -->
                <div class="flex items-end justify-between">
                    <div>
                        <span class="text-[10px] text-zinc-500 uppercase block mb-1">Price/Hour</span>
                        <div class="flex items-baseline gap-1">
                            <span class="text-xl font-bold text-white">${i}</span>
                            <span class="text-xs text-zinc-500">BKC</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        ${s?`
                            <button class="promote-btn btn-secondary px-3 py-2 text-xs" data-id="${r}">
                                <i class="fa-solid fa-rocket"></i>
                            </button>
                            <button class="withdraw-btn btn-danger px-4 py-2 text-xs" data-id="${r}">
                                <i class="fa-solid fa-arrow-right-from-bracket mr-1"></i>Withdraw
                            </button>
                        `:`
                            <button class="rent-btn btn-rent px-5 py-2.5 text-sm" data-id="${r}" ${c?"disabled":""}>
                                <i class="fa-solid fa-bolt mr-1"></i>Rent
                            </button>
                        `}
                    </div>
                </div>
            </div>
        </div>
    `}function Ob(){if(!d.isConnected)return Ed("View your listings");const e=d.rentalListings||[],t=e.filter(r=>Ha(r.owner,d.userAddress)),a=new Set(e.map(r=>Ue(r.tokenId))),n=(d.myBoosters||[]).filter(r=>!a.has(Ue(r.tokenId)));return`
        <div>
            <!-- Earnings Card -->
            <div class="rental-card-base p-6 mb-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-5">
                    <div class="flex items-center gap-5">
                        <div class="w-16 h-16 rounded-2xl bg-emerald-500/15 flex items-center justify-center border border-emerald-500/25">
                            <i class="fa-solid fa-sack-dollar text-emerald-400 text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-zinc-400">Total Earnings</p>
                            <p class="text-3xl font-bold text-white">
                                ${t.reduce((r,s)=>r+Number(Gn.formatEther(BigInt(s.totalEarnings||0))),0).toFixed(4)} <span class="text-lg text-zinc-500">BKC</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <div class="rental-card-base p-4 text-center min-w-[100px]">
                            <p class="text-2xl font-bold text-white">${t.length}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">Listed</p>
                        </div>
                        <div class="rental-card-base p-4 text-center min-w-[100px]">
                            <p class="text-2xl font-bold text-white">${n.length}</p>
                            <p class="text-[10px] text-zinc-500 uppercase">Available</p>
                        </div>
                        <button id="btn-open-list" class="btn-rent px-6 py-4" ${n.length===0?"disabled":""}>
                            <i class="fa-solid fa-plus mr-2"></i>List
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- My Listed NFTs -->
            ${t.length===0?Nr("No Listings Yet","List your first NFT to start earning!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5 nft-grid">
                    ${t.map((r,s)=>kd(r,s)).join("")}
                </div>
            `}
        </div>
    `}function Hb(){if(!d.isConnected)return Ed("View your active rentals");const e=Math.floor(Date.now()/1e3),t=(d.myRentals||[]).filter(a=>Ha(a.tenant,d.userAddress)&&Number(a.endTime)>e);return`
        <div>
            <!-- Info Card -->
            <div class="rental-card-base p-5 mb-6 border-emerald-500/20">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/15 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-circle-info text-emerald-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-white mb-1">How Rentals Work</h3>
                        <p class="text-xs text-zinc-400">
                            Rented NFTs reduce your burn rate when claiming rewards. 
                            Diamond = Keep 100%, Gold = 90%, Silver = 75%, Bronze = 60%.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Active Rentals -->
            ${t.length===0?Nr("No Active Rentals","Rent an NFT to reduce your claim burn rate!"):`
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
                    ${t.map((a,n)=>Ub(a,n)).join("")}
                </div>
            `}
        </div>
    `}function Ub(e,t){const a=Za(e.boostBips),n=Kn(a.name),i=wd(Number(e.endTime)),r=ht(e.boostBips||0);let s="active";return i.seconds<3600?s="critical":i.seconds<7200&&(s="warning"),`
        <div class="rental-card-base p-5" style="animation: card-in 0.5s ease-out ${t*60}ms forwards; opacity: 0;">
            <div class="flex items-center justify-between mb-4">
                <div class="tier-badge" style="background:${n.bg};color:${n.color};border:1px solid ${n.border}">
                    ${n.emoji} ${a.name}
                </div>
                <div class="rental-timer ${s}" data-end="${e.endTime}">
                    <i class="fa-solid fa-clock mr-1"></i>${i.text}
                </div>
            </div>
            
            <div class="flex items-center gap-4 mb-4">
                <div class="w-16 h-16 rounded-xl flex items-center justify-center overflow-hidden"
                     style="background:${n.bg}">
                    <img src="${n.image}" alt="${a.name}" class="w-full h-full object-contain" onerror="this.outerHTML='<span class=\\'text-4xl\\'>${n.emoji}</span>'">
                </div>
                <div>
                    <h3 class="text-lg font-bold text-white">${a.name} Booster</h3>
                    <p class="text-xs text-zinc-500">Token #${Ue(e.tokenId)}</p>
                </div>
            </div>
            
            <div class="p-3 rounded-xl ${r===100?"bg-emerald-500/10 border border-emerald-500/20":"bg-zinc-800/50"}">
                <p class="text-sm ${r===100?"text-emerald-400":"text-zinc-300"}">
                    <i class="fa-solid fa-shield-check mr-2"></i>
                    ${r===100?"Keep 100% of rewards!":`Keep ${r}% of rewards on claims`}
                </p>
            </div>
        </div>
    `}function jb(){const e=d.rentalListings||[],t=new Set(e.map(n=>Ue(n.tokenId)));return`
        <div class="rental-modal" id="modal-list">
            <div class="rental-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-tag text-emerald-400"></i>List NFT
                    </h3>
                    <button onclick="RentalPage.closeListModal()" class="text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="p-5 space-y-5">
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Select NFT</label>
                        <select id="list-select" class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none">
                            <option value="">-- Select an NFT --</option>
                            ${(d.myBoosters||[]).filter(n=>!t.has(Ue(n.tokenId))).map(n=>{const i=Za(n.boostBips),r=Kn(i.name);return`<option value="${n.tokenId}">${r.emoji} ${i.name} Booster #${n.tokenId}</option>`}).join("")}
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Price per Hour (BKC)</label>
                        <input type="number" id="list-price" min="0.01" step="0.01" placeholder="10.00"
                            class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none text-lg font-mono">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">
                            Promotion (ETH) <span class="text-zinc-600 font-normal">- optional</span>
                        </label>
                        <input type="number" id="list-promo-amount" min="0" step="0.001" placeholder="0.00"
                            class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none font-mono">
                        <p class="text-[10px] text-zinc-600 mt-2">Promoted listings appear first in marketplace</p>
                    </div>
                </div>
                <div class="flex gap-3 p-5 pt-0">
                    <button onclick="RentalPage.closeListModal()" class="btn-secondary flex-1 py-3">Cancel</button>
                    <button id="confirm-list" onclick="RentalPage.handleList()" class="btn-rent flex-1 py-3">
                        <i class="fa-solid fa-check mr-2"></i>List NFT
                    </button>
                </div>
            </div>
        </div>
    `}function Wb(){return`
        <div class="rental-modal" id="modal-rent">
            <div class="rental-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-bolt text-emerald-400"></i>Rent NFT
                    </h3>
                    <button onclick="RentalPage.closeRentModal()" class="text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div id="rent-modal-content" class="p-5">
                    <!-- Content populated dynamically -->
                </div>
            </div>
        </div>
    `}function Gb(){return`
        <div class="rental-modal" id="modal-promote">
            <div class="rental-modal-content">
                <div class="flex items-center justify-between p-5 border-b border-zinc-800">
                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                        <i class="fa-solid fa-rocket text-amber-400"></i>Promote Listing
                    </h3>
                    <button onclick="RentalPage.closePromoteModal()" class="text-zinc-500 hover:text-white text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="p-5 space-y-5">
                    <p class="text-sm text-zinc-400">
                        Pay ETH to boost your listing's visibility. Promoted listings appear at the top of the marketplace.
                    </p>
                    <div>
                        <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Amount (ETH)</label>
                        <input type="number" id="promote-amount" min="0.001" step="0.001" placeholder="0.01"
                            class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none text-lg font-mono">
                    </div>
                    <input type="hidden" id="promote-token-id">
                </div>
                <div class="flex gap-3 p-5 pt-0">
                    <button onclick="RentalPage.closePromoteModal()" class="btn-secondary flex-1 py-3">Cancel</button>
                    <button id="confirm-promote" onclick="RentalPage.handlePromote()" class="btn-rent flex-1 py-3">
                        <i class="fa-solid fa-rocket mr-2"></i>Promote
                    </button>
                </div>
            </div>
        </div>
    `}function Nr(e,t){return`
        <div class="rental-empty">
            <div class="w-20 h-20 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-key text-3xl text-zinc-600"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">${e}</h3>
            <p class="text-sm text-zinc-500">${t}</p>
        </div>
    `}function Ed(e){return`
        <div class="rental-empty">
            <div class="w-20 h-20 rounded-2xl bg-zinc-800/50 flex items-center justify-center mb-4">
                <i class="fa-solid fa-wallet text-3xl text-zinc-500"></i>
            </div>
            <h3 class="text-lg font-bold text-white mb-2">Connect Wallet</h3>
            <p class="text-sm text-zinc-500 mb-4">${e}</p>
            <button onclick="window.openConnectModal && window.openConnectModal()" class="btn-rent px-8 py-3">
                <i class="fa-solid fa-wallet mr-2"></i>Connect Wallet
            </button>
        </div>
    `}function Kb(){document.addEventListener("click",e=>{const t=e.target.closest(".rental-tab");if(t){_.activeTab=t.dataset.tab,document.querySelectorAll(".rental-tab").forEach(s=>s.classList.remove("active")),t.classList.add("active"),za();return}const a=e.target.closest(".filter-chip");if(a){_.filterTier=a.dataset.filter,za();return}if(e.target.closest("#btn-open-list")){Td();return}const n=e.target.closest(".rent-btn");if(n&&!n.disabled){Yb(n.dataset.id);return}const i=e.target.closest(".withdraw-btn");if(i){Bd(i);return}const r=e.target.closest(".promote-btn");if(r){Vb(r.dataset.id);return}}),document.addEventListener("change",e=>{e.target.id==="sort-select"&&(_.sortBy=e.target.value,za())})}function Td(){document.getElementById("modal-list").classList.add("active")}function Cd(){document.getElementById("modal-list").classList.remove("active")}function Yb(e){const t=(d.rentalListings||[]).find(s=>Rb(s.tokenId,e));if(!t)return;_.selectedListing=t;const a=Za(t.boostBips),n=Kn(a.name),i=M(BigInt(t.pricePerHour||0)),r=ht(t.boostBips||0);document.getElementById("rent-modal-content").innerHTML=`
        <div class="flex items-center gap-4 mb-5 p-4 rounded-xl" style="background:${n.bg}">
            <img src="${n.image}" alt="${a.name}" class="w-16 h-16 object-contain rounded-lg" onerror="this.outerHTML='<div class=\\'text-5xl\\'>${n.emoji}</div>'">
            <div>
                <h3 class="text-lg font-bold text-white">${a.name} Booster #${e}</h3>
                <p class="text-sm" style="color:${n.color}">Keep ${r}% of rewards</p>
            </div>
        </div>
        
        <div class="space-y-4 mb-5">
            <div class="flex justify-between text-sm">
                <span class="text-zinc-500">Price per hour</span>
                <span class="text-white font-bold">${i} BKC</span>
            </div>
            <div>
                <label class="text-xs font-bold text-zinc-400 uppercase block mb-2">Rental Duration (hours)</label>
                <input type="number" id="rent-hours" min="1" max="168" value="1"
                    class="w-full bg-zinc-800 border border-zinc-700 rounded-xl px-4 py-3 text-white outline-none text-lg font-mono">
            </div>
            <div id="rent-total" class="p-4 rounded-xl bg-zinc-800/50">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-zinc-500">Total Cost</span>
                    <span class="text-xl font-bold text-emerald-400">${i} BKC</span>
                </div>
            </div>
        </div>
        
        <div class="flex gap-3">
            <button onclick="RentalPage.closeRentModal()" class="btn-secondary flex-1 py-3">Cancel</button>
            <button id="confirm-rent" onclick="RentalPage.handleRent()" class="btn-rent flex-1 py-3">
                <i class="fa-solid fa-bolt mr-2"></i>Rent Now
            </button>
        </div>
    `,document.getElementById("rent-hours").addEventListener("input",s=>{const o=parseInt(s.target.value)||1,l=Number(i)*o;document.querySelector("#rent-total span:last-child").textContent=`${l.toFixed(2)} BKC`}),document.getElementById("modal-rent").classList.add("active")}function Id(){document.getElementById("modal-rent").classList.remove("active"),_.selectedListing=null}function Vb(e){document.getElementById("promote-token-id").value=e,document.getElementById("promote-amount").value="",document.getElementById("modal-promote").classList.add("active")}function Ad(){document.getElementById("modal-promote").classList.remove("active")}async function qb(){if(_.isTransactionPending||!_.selectedListing)return;const e=parseInt(document.getElementById("rent-hours").value)||1,t=Ue(_.selectedListing.tokenId),a=document.getElementById("confirm-rent");_.isTransactionPending=!0;try{await Xa.rent({tokenId:t,hours:e,button:a,onSuccess:async()=>{_.isTransactionPending=!1,Id(),h("ðŸŽ‰ NFT Rented Successfully!","success"),await ia()},onError:n=>{_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&h("Failed: "+(n.message||"Error"),"error")}})}catch(n){_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&h("Failed: "+(n.message||"Error"),"error")}}async function Xb(){var n;if(_.isTransactionPending)return;const e=document.getElementById("list-select").value,t=document.getElementById("list-price").value;if(parseFloat((n=document.getElementById("list-promo-amount"))==null?void 0:n.value),!e){h("Select an NFT","error");return}if(!t||parseFloat(t)<=0){h("Enter valid price","error");return}const a=document.getElementById("confirm-list");_.isTransactionPending=!0;try{await Xa.list({tokenId:e,pricePerHour:Gn.parseUnits(t,18),minHours:1,maxHours:168,button:a,onSuccess:async()=>{_.isTransactionPending=!1,Cd(),h("ðŸ·ï¸ NFT Listed Successfully!","success"),await ia()},onError:i=>{_.isTransactionPending=!1,!i.cancelled&&i.type!=="user_rejected"&&h("Failed: "+(i.message||"Error"),"error")}})}catch(i){_.isTransactionPending=!1,!i.cancelled&&i.type!=="user_rejected"&&h("Failed: "+(i.message||"Error"),"error")}}async function Bd(e){if(_.isTransactionPending)return;const t=e.dataset.id;if(confirm("Withdraw this NFT from marketplace?")){_.isTransactionPending=!0;try{await Xa.withdraw({tokenId:t,button:e,onSuccess:async()=>{_.isTransactionPending=!1,h("â†©ï¸ NFT Withdrawn Successfully!","success"),await ia()},onError:a=>{_.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&h("Failed: "+(a.message||"Error"),"error")}})}catch(a){_.isTransactionPending=!1,!a.cancelled&&a.type!=="user_rejected"&&h("Failed: "+(a.message||"Error"),"error")}}}async function Jb(){if(_.isTransactionPending)return;const e=document.getElementById("promote-token-id").value,t=document.getElementById("promote-amount").value;if(!t||parseFloat(t)<=0){h("Enter valid amount","error");return}const a=document.getElementById("confirm-promote");_.isTransactionPending=!0;try{await Xa.spotlight({tokenId:e,amount:Gn.parseEther(t),button:a,onSuccess:async()=>{_.isTransactionPending=!1,Ad(),h("ðŸš€ Listing Promoted!","success"),await ia()},onError:n=>{_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&h("Failed: "+(n.message||"Error"),"error")}})}catch(n){_.isTransactionPending=!1,!n.cancelled&&n.type!=="user_rejected"&&h("Failed: "+(n.message||"Error"),"error")}}function Zb(){_.countdownIntervals.forEach(clearInterval),_.countdownIntervals=[],document.querySelectorAll(".rental-timer[data-end]").forEach(e=>{const t=Number(e.dataset.end),a=setInterval(()=>{const n=wd(t);e.innerHTML=`<i class="fa-solid fa-clock mr-1"></i>${n.text}`,n.expired?(clearInterval(a),za()):n.seconds<3600?e.className="rental-timer critical":n.seconds<7200&&(e.className="rental-timer warning")},1e3);_.countdownIntervals.push(a)})}async function ia(){_.isLoading=!0;try{await Promise.all([no(),d.isConnected?Hu():Promise.resolve(),d.isConnected?zt():Promise.resolve()])}catch(e){console.warn("Refresh error:",e)}_.isLoading=!1,Oi()}const zd={async render(e){e&&(Oi(),await ia())},update(){Oi()},refresh:ia,openListModal:Td,closeListModal:Cd,closeRentModal:Id,closePromoteModal:Ad,handleRent:qb,handleList:Xb,handleWithdraw:Bd,handlePromote:Jb};window.RentalPage=zd;const Qb={render:async e=>{const t=document.getElementById("socials");if(!t||!e&&t.innerHTML.trim()!=="")return;const a=`
            <style>
                @keyframes telegram-pulse {
                    0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); transform: scale(1); }
                    70% { box-shadow: 0 0 0 15px rgba(56, 189, 248, 0); transform: scale(1.02); }
                    100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); transform: scale(1); }
                }
                .telegram-glow {
                    animation: telegram-pulse 2s infinite;
                }
            </style>
        `;t.innerHTML=`
            ${a}
            <div class="max-w-5xl mx-auto py-8">
                
                <div class="text-center mb-10">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-yellow-200 mb-4">
                        Join the Backcoin Community
                    </h1>
                    <p class="text-zinc-400 text-lg max-w-2xl mx-auto">
                        Connect with thousands of holders, stay updated on the Mainnet launch, and participate in exclusive airdrops.
                    </p>
                </div>

                <div class="mb-12 flex justify-center">
                    <a href="https://t.me/BackCoinorg" target="_blank" 
                       class="telegram-glow relative group w-full max-w-2xl bg-gradient-to-br from-sky-600 to-blue-700 hover:from-sky-500 hover:to-blue-600 border border-sky-400/50 rounded-2xl p-8 flex flex-col md:flex-row items-center justify-between gap-6 transition-all duration-300 shadow-2xl">
                        
                        <div class="flex items-center gap-6">
                            <div class="bg-white/20 p-4 rounded-full backdrop-blur-sm">
                                <i class="fa-brands fa-telegram text-5xl text-white"></i>
                            </div>
                            <div class="text-center md:text-left">
                                <h2 class="text-2xl font-bold text-white mb-1">Official Telegram Group</h2>
                                <p class="text-sky-100 text-sm font-medium">Chat with the team & community â€¢ 24/7 Support</p>
                            </div>
                        </div>

                        <div class="bg-white text-blue-600 font-extrabold py-3 px-8 rounded-full shadow-lg group-hover:scale-105 transition-transform flex items-center gap-2 whitespace-nowrap">
                            JOIN NOW <i class="fa-solid fa-arrow-right"></i>
                        </div>
                    </a>
                </div>

                <div class="border-t border-zinc-800 my-10"></div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
                    
                    <a href="https://x.com/backcoin" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-zinc-500 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-x-twitter text-3xl text-white"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">X (Twitter)</h3>
                        <p class="text-zinc-400 text-sm">Latest news & announcements</p>
                    </a>

                    <a href="https://www.youtube.com/@Backcoin" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-red-500/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-youtube text-3xl text-red-500"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">YouTube</h3>
                        <p class="text-zinc-400 text-sm">Video tutorials & AMAs</p>
                    </a>

                    <a href="https://www.instagram.com/backcoin.bkc/" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-pink-500/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-instagram text-3xl text-pink-500"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Instagram</h3>
                        <p class="text-zinc-400 text-sm">Visual updates & stories</p>
                    </a>

                    <a href="https://www.tiktok.com/@backcoin.org" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-cyan-400/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-tiktok text-3xl text-cyan-400"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">TikTok</h3>
                        <p class="text-zinc-400 text-sm">Short clips & viral content</p>
                    </a>

                    <a href="https://www.facebook.com/profile.php?id=61584248964781" target="_blank" class="group bg-zinc-800/50 hover:bg-zinc-800 border border-zinc-700 hover:border-blue-600/50 rounded-xl p-6 transition-all duration-300 hover:-translate-y-1">
                        <div class="flex justify-between items-start mb-4">
                            <i class="fa-brands fa-facebook text-3xl text-blue-600"></i>
                            <i class="fa-solid fa-external-link-alt text-zinc-500 text-sm group-hover:text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-1">Facebook</h3>
                        <p class="text-zinc-400 text-sm">Community discussions</p>
                    </a>

                </div>

                <div class="mt-12 text-center text-zinc-500 text-sm">
                    <p>Always verify links. Official admins will never DM you first asking for funds.</p>
                </div>
            </div>
        `},cleanup:()=>{}},Pd=document.createElement("style");Pd.innerHTML=`
    .card-gradient { background: linear-gradient(135deg, #18181b 0%, #3f3f46 100%); }
    .chip { background: linear-gradient(135deg, #d4af37 0%, #facc15 100%); }
    .glass-mockup { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    .transaction-row:hover { background: rgba(255,255,255,0.03); }
`;document.head.appendChild(Pd);const eg={render:async e=>{if(!e)return;const t=document.getElementById("creditcard");t&&(t.innerHTML=`
            <div class="animate-fadeIn max-w-5xl mx-auto py-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                            <i class="fa-solid fa-credit-card text-amber-500"></i> BKC Black Card
                        </h1>
                        <p class="text-zinc-400 text-sm">Spend your crypto anywhere. Earn 3% Cashback in $BKC instantly.</p>
                    </div>
                    <div class="px-4 py-2 bg-amber-500/10 border border-amber-500/30 text-amber-400 rounded-full text-xs font-bold uppercase tracking-wider flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-amber-500 animate-pulse"></span> Coming Soon
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    
                    <div class="space-y-8">
                        <div class="relative w-full aspect-[1.586/1] max-w-md mx-auto transform hover:scale-[1.02] transition-transform duration-500 cursor-pointer group perspective-1000">
                            <div class="absolute inset-0 card-gradient rounded-2xl shadow-2xl border border-zinc-700 overflow-hidden">
                                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                                <div class="absolute -top-20 -right-20 w-64 h-64 bg-amber-500/20 rounded-full blur-3xl"></div>
                                <div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-black/50 to-transparent"></div>

                                <div class="relative z-10 p-6 h-full flex flex-col justify-between">
                                    <div class="flex justify-between items-start">
                                        <img src="assets/bkc_logo_3d.png" class="w-12 h-12 opacity-90" alt="Logo">
                                        <div class="text-white/50 font-mono text-xs tracking-widest">DEBIT</div>
                                    </div>
                                    
                                    <div class="my-auto pl-2">
                                        <div class="w-12 h-9 rounded-md chip mb-4 shadow-inner border border-yellow-600/30"></div>
                                        <div class="flex gap-4">
                                            <div class="text-white font-mono text-xl tracking-[0.15em] drop-shadow-md">****</div>
                                            <div class="text-white font-mono text-xl tracking-[0.15em] drop-shadow-md">****</div>
                                            <div class="text-white font-mono text-xl tracking-[0.15em] drop-shadow-md">****</div>
                                            <div class="text-white font-mono text-xl tracking-[0.15em] drop-shadow-md">4288</div>
                                        </div>
                                    </div>

                                    <div class="flex justify-between items-end">
                                        <div>
                                            <div class="text-[10px] text-zinc-400 uppercase tracking-wider mb-1">Card Holder</div>
                                            <div class="text-white font-medium tracking-wide uppercase">Early Adopter</div>
                                        </div>
                                        <div class="flex flex-col items-end">
                                            <div class="text-[8px] text-zinc-400 uppercase tracking-wider mb-1">Valid Thru</div>
                                            <div class="text-white font-mono">12/28</div>
                                        </div>
                                        <i class="fa-brands fa-cc-visa text-3xl text-white/80 ml-4"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="glass-mockup p-4 rounded-xl text-center">
                                <i class="fa-solid fa-rotate-left text-2xl text-green-400 mb-2"></i>
                                <div class="text-lg font-bold text-white">3% Back</div>
                                <div class="text-xs text-zinc-500">On every purchase</div>
                            </div>
                            <div class="glass-mockup p-4 rounded-xl text-center">
                                <i class="fa-solid fa-globe text-2xl text-blue-400 mb-2"></i>
                                <div class="text-lg font-bold text-white">No Fees</div>
                                <div class="text-xs text-zinc-500">International usage</div>
                            </div>
                        </div>
                        
                        <div class="bg-amber-500/5 border border-amber-500/20 p-4 rounded-xl">
                            <h4 class="text-amber-400 font-bold text-sm mb-2"><i class="fa-solid fa-star mr-2"></i> Join the Waitlist</h4>
                            <p class="text-zinc-400 text-xs mb-4">Be among the first to receive the physical metal card. Top 1000 holders get priority shipping.</p>
                            <button class="w-full bg-amber-500 hover:bg-amber-600 text-black font-bold py-3 rounded-lg transition-colors cursor-not-allowed opacity-80" disabled>
                                Reserve Spot (Opens Soon)
                            </button>
                        </div>
                    </div>

                    <div class="glass-mockup rounded-2xl p-6 h-full flex flex-col">
                        <h3 class="text-white font-bold mb-6 flex items-center gap-2">
                            <i class="fa-solid fa-mobile-screen text-zinc-500"></i> App Simulation
                        </h3>

                        <div class="bg-zinc-800 rounded-xl p-6 mb-6 text-center border border-zinc-700">
                            <div class="text-zinc-400 text-xs uppercase tracking-wider mb-1">Card Balance</div>
                            <div class="text-3xl font-bold text-white mb-2">$ 4,250.00</div>
                            <div class="text-xs text-green-400 font-mono flex items-center justify-center gap-1">
                                <i class="fa-solid fa-arrow-trend-up"></i> +$128.50 (Cashback this month)
                            </div>
                        </div>

                        <div class="flex-1">
                            <h4 class="text-zinc-500 text-xs font-bold uppercase mb-4 px-1">Recent Activity</h4>
                            <div class="space-y-2">
                                ${va("Starbucks Coffee","Today, 8:30 AM","- $5.40","+ 15 BKC","fa-mug-hot")}
                                ${va("Uber Ride","Yesterday, 6:15 PM","- $24.50","+ 82 BKC","fa-car")}
                                ${va("Netflix Subscription","Oct 24, 2025","- $15.99","+ 53 BKC","fa-film")}
                                ${va("Amazon Purchase","Oct 22, 2025","- $142.00","+ 475 BKC","fa-box-open")}
                                ${va("Shell Station","Oct 20, 2025","- $45.00","+ 150 BKC","fa-gas-pump")}
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        `)}};function va(e,t,a,n,i){return`
        <div class="transaction-row flex items-center justify-between p-3 rounded-lg cursor-default transition-colors">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-zinc-700 flex items-center justify-center text-zinc-400">
                    <i class="fa-solid ${i}"></i>
                </div>
                <div>
                    <div class="text-white text-sm font-medium">${e}</div>
                    <div class="text-zinc-500 text-xs">${t}</div>
                </div>
            </div>
            <div class="text-right">
                <div class="text-white text-sm font-bold">${a}</div>
                <div class="text-amber-500 text-xs font-mono">${n}</div>
            </div>
        </div>
    `}const U={state:{tokens:{ETH:{name:"Ethereum",symbol:"ETH",balance:5.45,price:3050,logo:"https://cryptologos.cc/logos/ethereum-eth-logo.png?v=026"},USDT:{name:"Tether USD",symbol:"USDT",balance:12500,price:1,logo:"https://cryptologos.cc/logos/tether-usdt-logo.png?v=026"},ARB:{name:"Arbitrum",symbol:"ARB",balance:2450,price:1.1,logo:"https://cryptologos.cc/logos/arbitrum-arb-logo.png?v=026"},WBTC:{name:"Wrapped BTC",symbol:"WBTC",balance:.15,price:62e3,logo:"https://cryptologos.cc/logos/wrapped-bitcoin-wbtc-logo.png?v=026"},MATIC:{name:"Polygon",symbol:"MATIC",balance:5e3,price:.85,logo:"https://cryptologos.cc/logos/polygon-matic-logo.png?v=026"},BNB:{name:"BNB Chain",symbol:"BNB",balance:12.5,price:580,logo:"https://cryptologos.cc/logos/bnb-bnb-logo.png?v=026"},BKC:{name:"Backcoin",symbol:"BKC",balance:1500,price:.12,logo:"assets/bkc_logo_3d.png",isNative:!0}},settings:{slippage:.5,deadline:20},swap:{tokenIn:"ETH",tokenOut:"BKC",amountIn:"",loading:!1},mining:{rate:.05}},calculate:()=>{const{tokens:e,swap:t,mining:a}=U.state;if(!t.amountIn||parseFloat(t.amountIn)===0)return null;const n=e[t.tokenIn],i=e[t.tokenOut],s=parseFloat(t.amountIn)*n.price,o=s*.003,l=s-o,c=e.BKC.price,u=o*a.rate/c,f=l/i.price,p=Math.min(s/1e5*100,5).toFixed(2);return{amountOut:f,usdValue:s,feeUsd:o,miningReward:u,priceImpact:p,rate:n.price/i.price}},render:async e=>{if(!e)return;const t=document.getElementById("dex");t&&(t.innerHTML=`
            <div class="animate-fadeIn min-h-screen flex items-center justify-center py-12 px-4">
                
                <div class="w-full max-w-[480px] bg-[#131313] border border-zinc-800 rounded-3xl p-2 shadow-2xl relative">
                    
                    <div class="flex justify-between items-center p-4 mb-2">
                        <div class="flex gap-4 text-zinc-400 font-medium text-sm">
                            <span class="text-white border-b-2 border-amber-500 pb-1 cursor-pointer">Swap</span>
                            <span class="hover:text-white cursor-pointer transition-colors">Limit</span>
                            <span class="hover:text-white cursor-pointer transition-colors">Buy Crypto</span>
                        </div>
                        <div class="flex gap-3 text-zinc-400">
                             <div class="flex items-center gap-1 text-xs bg-amber-500/10 text-amber-500 px-2 py-1 rounded-full border border-amber-500/20" title="Mining Rewards Active">
                                <i class="fa-solid fa-pickaxe"></i> Mining On
                            </div>
                            <button class="hover:text-white transition-colors"><i class="fa-solid fa-gear"></i></button>
                        </div>
                    </div>

                    <div class="bg-[#1b1b1b] rounded-2xl p-4 border border-transparent hover:border-zinc-700 transition-colors group">
                        <div class="flex justify-between text-zinc-500 text-xs mb-2">
                            <span>You pay</span>
                            <span class="cursor-pointer hover:text-amber-500 transition-colors" id="btn-max-in">Balance: <span id="bal-in">0.00</span></span>
                        </div>
                        <div class="flex justify-between items-center gap-2">
                            <input type="number" id="input-in" placeholder="0" class="bg-transparent text-3xl text-white font-medium outline-none w-full placeholder-zinc-600 appearance-none">
                            <button id="btn-token-in" class="flex items-center gap-2 bg-[#2c2c2c] hover:bg-[#363636] text-white py-1.5 px-3 rounded-full font-bold text-lg transition-all shrink-0 shadow-lg border border-zinc-700/50">
                                <span id="img-in-container"></span>
                                <span id="symbol-in">ETH</span>
                                <i class="fa-solid fa-chevron-down text-xs ml-1 text-zinc-400"></i>
                            </button>
                        </div>
                        <div class="flex justify-between text-zinc-500 text-xs mt-2 h-4">
                            <span id="usd-in">$0.00</span>
                        </div>
                    </div>

                    <div class="relative h-1 z-10">
                        <div id="btn-switch" class="absolute left-1/2 -translate-x-1/2 -top-4 bg-[#131313] border-[4px] border-[#131313] rounded-xl p-1 cursor-pointer group">
                            <div class="bg-[#2c2c2c] group-hover:bg-zinc-700 p-2 rounded-lg transition-colors border border-zinc-700/50">
                                <i class="fa-solid fa-arrow-down text-zinc-400 group-hover:text-white text-sm transition-colors"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#1b1b1b] rounded-2xl p-4 mt-1 border border-transparent hover:border-zinc-700 transition-colors">
                        <div class="flex justify-between text-zinc-500 text-xs mb-2">
                            <span>You receive</span>
                            <span>Balance: <span id="bal-out">0.00</span></span>
                        </div>
                        <div class="flex justify-between items-center gap-2">
                            <input type="text" id="input-out" placeholder="0" disabled class="bg-transparent text-3xl text-zinc-300 font-medium outline-none w-full placeholder-zinc-600 cursor-default">
                            <button id="btn-token-out" class="flex items-center gap-2 bg-[#2c2c2c] hover:bg-[#363636] text-white py-1.5 px-3 rounded-full font-bold text-lg transition-all shrink-0 shadow-lg border border-zinc-700/50">
                                <span id="img-out-container"></span>
                                <span id="symbol-out">BKC</span>
                                <i class="fa-solid fa-chevron-down text-xs ml-1 text-zinc-400"></i>
                            </button>
                        </div>
                        <div class="flex justify-between text-zinc-500 text-xs mt-2 h-4">
                            <span id="usd-out">$0.00</span>
                            <span id="price-impact" class="hidden text-amber-500 font-medium text-[10px] bg-amber-500/10 px-1 rounded"></span>
                        </div>
                    </div>

                    <div id="swap-details" class="hidden mt-3 px-3 py-3 rounded-xl bg-gradient-to-r from-amber-500/10 to-transparent border border-amber-500/20 animate-fadeIn">
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-zinc-400 flex items-center gap-1"><i class="fa-solid fa-gas-pump text-xs"></i> Network Cost</span>
                            <span class="text-white">~$0.25 (L2)</span>
                        </div>
                        <div class="flex justify-between items-center text-sm mb-1">
                            <span class="text-zinc-400">Protocol Fee</span>
                            <span class="text-white" id="fee-display">$0.00</span>
                        </div>
                        <div class="h-px bg-amber-500/20 my-2"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-amber-500 font-bold text-sm flex items-center gap-2">
                                <i class="fa-solid fa-gift animate-pulse"></i> Mining Reward
                            </span>
                            <span class="text-amber-400 font-mono font-bold" id="mining-reward-display">+0.00 BKC</span>
                        </div>
                    </div>

                    <button id="btn-swap" class="w-full mt-4 bg-zinc-800 text-zinc-500 font-bold text-lg py-4 rounded-2xl transition-all duration-300 shadow-lg transform active:scale-[0.99] cursor-not-allowed" disabled>
                        Enter an amount
                    </button>

                </div>

                <div id="token-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fadeIn">
                    <div class="bg-[#131313] w-full max-w-md rounded-3xl border border-zinc-800 shadow-2xl overflow-hidden flex flex-col max-h-[80vh]">
                        <div class="p-5 border-b border-zinc-800">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-white font-bold text-lg">Select a token</h3>
                                <button id="close-modal" class="text-zinc-400 hover:text-white transition-colors"><i class="fa-solid fa-xmark text-xl"></i></button>
                            </div>
                            <div class="relative">
                                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500"></i>
                                <input type="text" placeholder="Search name or paste address" class="w-full bg-[#1b1b1b] text-white pl-10 pr-4 py-3 rounded-xl outline-none border border-zinc-800 focus:border-amber-500/50 transition-colors placeholder-zinc-600">
                            </div>
                            <div class="flex gap-2 mt-3">
                                <button class="quick-token px-3 py-1 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-xs text-zinc-300 border border-zinc-700 transition-colors" data-symbol="ETH">ETH</button>
                                <button class="quick-token px-3 py-1 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-xs text-zinc-300 border border-zinc-700 transition-colors" data-symbol="ARB">ARB</button>
                                <button class="quick-token px-3 py-1 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-xs text-zinc-300 border border-zinc-700 transition-colors" data-symbol="USDT">USDT</button>
                                <button class="quick-token px-3 py-1 rounded-lg bg-zinc-800 hover:bg-zinc-700 text-xs text-zinc-300 border border-zinc-700 transition-colors" data-symbol="BKC">BKC</button>
                            </div>
                        </div>
                        
                        <div id="token-list" class="flex-1 overflow-y-auto p-2 scrollbar-hide">
                            </div>
                    </div>
                </div>

            </div>
        `,U.updateUI(),U.bindEvents())},updateUI:()=>{const{tokens:e,swap:t}=U.state,a=e[t.tokenIn],n=e[t.tokenOut],i=(l,c)=>{document.getElementById(`symbol-${l}`).innerText=c.symbol;const u=document.getElementById(`img-${l}-container`);c.logo?u.innerHTML=`<img src="${c.logo}" class="w-6 h-6 rounded-full" onerror="this.style.display='none'">`:u.innerHTML=`<div class="w-6 h-6 rounded-full bg-zinc-700 flex items-center justify-center text-[10px]">${c.symbol[0]}</div>`};i("in",a),i("out",n),document.getElementById("bal-in").innerText=a.balance.toFixed(4),document.getElementById("bal-out").innerText=n.balance.toFixed(4);const r=U.calculate(),s=document.getElementById("btn-swap"),o=document.getElementById("swap-details");if(!t.amountIn)document.getElementById("input-out").value="",document.getElementById("usd-in").innerText="$0.00",document.getElementById("usd-out").innerText="$0.00",o.classList.add("hidden"),s.innerText="Enter an amount",s.className="w-full mt-4 bg-zinc-800 text-zinc-500 font-bold text-lg py-4 rounded-2xl cursor-not-allowed",s.disabled=!0;else if(parseFloat(t.amountIn)>a.balance)s.innerText=`Insufficient ${a.symbol} balance`,s.className="w-full mt-4 bg-[#3d1818] text-red-500 font-bold text-lg py-4 rounded-2xl cursor-not-allowed border border-red-900/30",s.disabled=!0,o.classList.add("hidden");else if(r){document.getElementById("input-out").value=r.amountOut.toFixed(6),document.getElementById("usd-in").innerText=`~$${r.usdValue.toFixed(2)}`,document.getElementById("usd-out").innerText=`~$${(r.usdValue-r.feeUsd).toFixed(2)}`,o.classList.remove("hidden"),document.getElementById("fee-display").innerText=`$${r.feeUsd.toFixed(2)}`,document.getElementById("mining-reward-display").innerText=`+${r.miningReward.toFixed(4)} BKC`;const l=document.getElementById("price-impact");parseFloat(r.priceImpact)>2?(l.classList.remove("hidden"),l.innerText=`Price Impact: -${r.priceImpact}%`):l.classList.add("hidden"),s.innerHTML=t.loading?'<i class="fa-solid fa-circle-notch fa-spin"></i> Swapping...':"Swap",s.className="w-full mt-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold text-lg py-4 rounded-2xl shadow-lg shadow-blue-900/20 cursor-pointer border border-blue-500/20",s.disabled=t.loading}},bindEvents:()=>{document.getElementById("input-in").addEventListener("input",t=>{U.state.swap.amountIn=t.target.value,U.updateUI()}),document.getElementById("btn-max-in").addEventListener("click",()=>{const t=U.state.tokens[U.state.swap.tokenIn].balance;U.state.swap.amountIn=t.toString(),document.getElementById("input-in").value=t,U.updateUI()}),document.getElementById("btn-switch").addEventListener("click",()=>{const t=U.state.swap.tokenIn;U.state.swap.tokenIn=U.state.swap.tokenOut,U.state.swap.tokenOut=t,U.state.swap.amountIn="",document.getElementById("input-in").value="",U.updateUI()}),document.getElementById("btn-swap").addEventListener("click",async()=>{const t=document.getElementById("btn-swap");if(t.disabled)return;U.state.swap.loading=!0,U.updateUI(),await new Promise(r=>setTimeout(r,1500));const a=U.calculate(),{tokens:n,swap:i}=U.state;n[i.tokenIn].balance-=parseFloat(i.amountIn),n[i.tokenOut].balance+=a.amountOut,n.BKC.balance+=a.miningReward,U.state.swap.loading=!1,U.state.swap.amountIn="",document.getElementById("input-in").value="",t.className="w-full mt-4 bg-green-600 text-white font-bold text-lg py-4 rounded-2xl shadow-[0_0_20px_rgba(22,163,74,0.4)]",t.innerHTML=`<i class="fa-solid fa-check"></i> Swap Success! +${a.miningReward.toFixed(2)} BKC Mined!`,setTimeout(()=>{U.updateUI()},3e3)});const e=t=>{const a=document.getElementById("token-modal"),n=document.getElementById("token-list");a.classList.remove("hidden"),(()=>{n.innerHTML=Object.values(U.state.tokens).map(r=>{const s=U.state.swap[`token${t==="in"?"In":"Out"}`]===r.symbol;return U.state.swap[`token${t==="in"?"Out":"In"}`]===r.symbol?"":`
                        <div class="token-item flex justify-between items-center p-3 hover:bg-[#2c2c2c] rounded-xl cursor-pointer transition-colors ${s?"opacity-50 pointer-events-none":""}" data-symbol="${r.symbol}">
                            <div class="flex items-center gap-3">
                                <img src="${r.logo}" class="w-8 h-8 rounded-full bg-zinc-800" onerror="this.src='https://via.placeholder.com/32'">
                                <div>
                                    <div class="text-white font-bold text-sm">${r.symbol}</div>
                                    <div class="text-zinc-500 text-xs">${r.name}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-white text-sm font-medium">${r.balance.toFixed(4)}</div>
                                ${r.isNative?'<i class="fa-solid fa-star text-[10px] text-amber-500"></i>':""}
                            </div>
                        </div>
                    `}).join(""),document.querySelectorAll(".token-item").forEach(r=>{r.addEventListener("click",()=>{U.state.swap[`token${t==="in"?"In":"Out"}`]=r.dataset.symbol,a.classList.add("hidden"),U.updateUI()})})})(),document.querySelectorAll(".quick-token").forEach(r=>{r.onclick=()=>{U.state.swap[`token${t==="in"?"In":"Out"}`]=r.dataset.symbol,a.classList.add("hidden"),U.updateUI()}})};document.getElementById("btn-token-in").addEventListener("click",()=>e("in")),document.getElementById("btn-token-out").addEventListener("click",()=>e("out")),document.getElementById("close-modal").addEventListener("click",()=>document.getElementById("token-modal").classList.add("hidden")),document.getElementById("token-modal").addEventListener("click",t=>{t.target.id==="token-modal"&&t.target.classList.add("hidden")})}},tg={render:async e=>{if(!e)return;const t=document.getElementById("dao");t&&(t.innerHTML=`
            <div class="animate-fadeIn max-w-6xl mx-auto py-6">
                
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4 border-b border-zinc-800 pb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-white mb-2 flex items-center gap-3">
                            <i class="fa-solid fa-landmark-dome text-amber-500"></i> Backchain Governance
                        </h1>
                        <p class="text-zinc-400 text-sm">Vote on proposals and shape the future of the ecosystem.</p>
                    </div>
                    <div class="flex gap-3">
                        <button class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg text-sm font-medium transition-colors cursor-not-allowed">
                            <i class="fa-solid fa-plus mr-2"></i> New Proposal
                        </button>
                        <div class="px-4 py-2 bg-zinc-900 border border-zinc-700 text-zinc-400 rounded-lg text-sm font-mono flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-zinc-500"></div> Snapshot Only
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    
                    <div class="lg:col-span-2 space-y-6">
                        <h3 class="text-zinc-500 text-xs font-bold uppercase tracking-wider mb-2">Active Proposals</h3>
                        
                        <div class="bg-zinc-900/50 border border-zinc-700 rounded-xl p-6 hover:border-amber-500/30 transition-all cursor-pointer group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex gap-2">
                                    <span class="bg-green-500/10 text-green-400 border border-green-500/20 px-2 py-1 rounded text-xs font-bold">Active</span>
                                    <span class="text-zinc-500 text-xs py-1">OIP-12</span>
                                </div>
                                <span class="text-zinc-400 text-xs font-mono">Ends in 2 days</span>
                            </div>
                            <h4 class="text-xl font-bold text-white mb-2 group-hover:text-amber-400 transition-colors">Increase Rental Marketplace Fees to 5%</h4>
                            <p class="text-zinc-400 text-sm mb-6 line-clamp-2">This proposal aims to increase the protocol fee on NFT rentals from 2.5% to 5% to boost the Community Treasury and accelerate BKC burns.</p>
                            
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs">
                                    <span class="text-white font-bold">Yes</span>
                                    <span class="text-zinc-400">1.2M BKC (85%)</span>
                                </div>
                                <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-zinc-900/50 border border-zinc-700 rounded-xl p-6 opacity-75">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex gap-2">
                                    <span class="bg-purple-500/10 text-purple-400 border border-purple-500/20 px-2 py-1 rounded text-xs font-bold">Closed</span>
                                    <span class="text-zinc-500 text-xs py-1">OIP-11</span>
                                </div>
                                <span class="text-zinc-400 text-xs font-mono">Ended Oct 15</span>
                            </div>
                            <h4 class="text-xl font-bold text-white mb-2">Fund Marketing Campaign Q4</h4>
                            <p class="text-zinc-400 text-sm mb-6 line-clamp-2">Allocate 500,000 BKC from the Treasury for influencer marketing and partnership announcements.</p>
                            
                            <div class="space-y-2">
                                <div class="flex justify-between text-xs">
                                    <span class="text-white font-bold">Passed</span>
                                    <span class="text-zinc-400">3.5M BKC (98%)</span>
                                </div>
                                <div class="w-full bg-zinc-800 rounded-full h-2 overflow-hidden">
                                    <div class="bg-purple-500 h-2 rounded-full" style="width: 98%"></div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="space-y-6">
                        <div class="bg-zinc-900 p-6 rounded-xl border border-zinc-800">
                            <h4 class="text-white font-bold mb-4">Your Voting Power</h4>
                            <div class="text-3xl font-mono font-bold text-amber-500 mb-1">0.00 vBKC</div>
                            <p class="text-xs text-zinc-500 mb-6">Based on your Staked BKC + NFT Boosters.</p>
                            <button class="w-full bg-zinc-800 text-zinc-500 font-bold py-3 rounded-lg text-sm cursor-not-allowed">Delegate Votes</button>
                        </div>

                        <div class="bg-zinc-900 p-6 rounded-xl border border-zinc-800">
                            <h4 class="text-white font-bold mb-4">DAO Treasury</h4>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-zinc-400 text-sm">BKC Balance</span>
                                <span class="text-white font-mono">15,420,000</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-zinc-400 text-sm">Value (USD)</span>
                                <span class="text-white font-mono">$ --</span>
                            </div>
                        </div>

                        <div class="p-4 rounded-xl bg-blue-900/10 border border-blue-500/20">
                            <div class="flex items-start gap-3">
                                <i class="fa-solid fa-info-circle text-blue-400 mt-1"></i>
                                <div>
                                    <h5 class="text-blue-400 font-bold text-sm mb-1">Governance Launch</h5>
                                    <p class="text-zinc-400 text-xs">The DAO module is currently in simulation mode. On-chain voting will be enabled after the initial token distribution phase.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        `)}},Y="https://www.youtube.com/@Backcoin",xi={gettingStarted:[{id:"v1",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"3:42",tag:"beginner",en:{title:"MetaMask Setup (PC & Mobile)",description:"Your passport to the Backcoin universe. Learn how to install and configure MetaMask for Web3.",url:Y},pt:{title:"Configurando MetaMask (PC & Mobile)",description:"Seu passaporte para o universo Backcoin. Aprenda a instalar e configurar a MetaMask para Web3.",url:Y}},{id:"v2",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:53",tag:"beginner",en:{title:"Connect & Claim Starter Pack",description:"Fill your tank! Connect your wallet and claim free BKC tokens plus ETH for gas fees.",url:Y},pt:{title:"Conectar e Receber Starter Pack",description:"Encha o tanque! Conecte sua carteira e receba BKC grÃ¡tis mais ETH para taxas de gÃ¡s.",url:Y}},{id:"v10",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:40",tag:"beginner",en:{title:"Airdrop Ambassador Campaign",description:"35% of TGE for the community! Learn how to earn points by promoting Backcoin.",url:Y},pt:{title:"Campanha de Airdrop - Embaixador",description:"35% do TGE para a comunidade! Aprenda a ganhar pontos promovendo o Backcoin.",url:Y}}],ecosystem:[{id:"v4",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:48",tag:"intermediate",en:{title:"Staking Pool - Passive Income",description:"Lock your tokens and earn a share of all protocol fees. Up to 10x multiplier for loyalty!",url:Y},pt:{title:"Staking Pool - Renda Passiva",description:"Trave seus tokens e ganhe parte das taxas do protocolo. AtÃ© 10x multiplicador por lealdade!",url:Y}},{id:"v5",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:50",tag:"intermediate",en:{title:"NFT Market - Boost Your Account",description:"Buy NFT Boosters to reduce fees and increase mining efficiency. Prices set by math, not sellers.",url:Y},pt:{title:"NFT Market - Turbine sua Conta",description:"Compre NFT Boosters para reduzir taxas e aumentar eficiÃªncia. PreÃ§os definidos por matemÃ¡tica.",url:Y}},{id:"v6",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"0:53",tag:"intermediate",en:{title:"AirBNFT - Rent NFT Power",description:"Need a boost but don't want to buy? Rent NFT power from other players for a fraction of the cost.",url:Y},pt:{title:"AirBNFT - Aluguel de Poder",description:"Precisa de boost mas nÃ£o quer comprar? Alugue poder de NFT de outros jogadores.",url:Y}},{id:"v7a",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:05",tag:"intermediate",en:{title:"List Your NFT for Rent",description:"Turn your idle NFTs into passive income. List on AirBNFT and earn while you sleep.",url:Y},pt:{title:"Liste seu NFT para Aluguel",description:"Transforme NFTs parados em renda passiva. Liste no AirBNFT e ganhe dormindo.",url:Y}},{id:"v7b",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:31",tag:"intermediate",en:{title:"Decentralized Notary",description:"Register documents on the blockchain forever. Immutable proof of ownership for just 1 BKC.",url:Y},pt:{title:"CartÃ³rio Descentralizado",description:"Registre documentos na blockchain para sempre. Prova imutÃ¡vel de autoria por apenas 1 BKC.",url:Y}},{id:"v8",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:34",tag:"intermediate",en:{title:"Fortune Pool - The Big Jackpot",description:"Test your luck with decentralized oracle results. Up to 100x multipliers!",url:Y},pt:{title:"Fortune Pool - O Grande Jackpot",description:"Teste sua sorte com resultados de orÃ¡culo descentralizado. Multiplicadores atÃ© 100x!",url:Y}},{id:"v9",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:20",tag:"beginner",en:{title:"The Backcoin Manifesto (Promo)",description:"Economy, Games, Passive Income, Utility. This is not just a token - it's a new digital economy.",url:Y},pt:{title:"O Manifesto Backcoin (Promo)",description:"Economia, Jogos, Renda Passiva, Utilidade. NÃ£o Ã© apenas um token - Ã© uma nova economia digital.",url:Y}}],advanced:[{id:"v11",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:25",tag:"advanced",en:{title:"Hub & Spoke Architecture",description:"Deep dive into Backcoin's technical architecture. How the ecosystem manager connects all services.",url:Y},pt:{title:"Arquitetura Hub & Spoke",description:"Mergulho tÃ©cnico na arquitetura do Backcoin. Como o gerenciador conecta todos os serviÃ§os.",url:Y}},{id:"v12",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:25",tag:"advanced",en:{title:"Mining Evolution: PoW vs PoS vs Backcoin",description:"From Proof of Work to Proof of Stake to Proof of Purchase. The third generation of crypto mining.",url:Y},pt:{title:"EvoluÃ§Ã£o da MineraÃ§Ã£o: PoW vs PoS vs Backcoin",description:"Do Proof of Work ao Proof of Stake ao Proof of Purchase. A terceira geraÃ§Ã£o de mineraÃ§Ã£o.",url:Y}},{id:"v13",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:25",tag:"advanced",en:{title:"The Infinite Future (Roadmap)",description:"Credit cards, insurance, DEX, lending... What's coming next in the Backcoin Super App.",url:Y},pt:{title:"O Futuro Infinito (Roadmap)",description:"CartÃµes de crÃ©dito, seguros, DEX, emprÃ©stimos... O que vem no Super App Backcoin.",url:Y}},{id:"v14",thumbnail:"https://img.youtube.com/vi/VIDEO_ID_HERE/maxresdefault.jpg",duration:"1:35",tag:"advanced",en:{title:"The New Wave of Millionaires",description:"Mathematical scarcity, revenue sharing, early adopter advantage. The wealth transfer is happening.",url:Y},pt:{title:"A Nova Leva de MilionÃ¡rios",description:"Escassez matemÃ¡tica, dividendos, vantagem do early adopter. A transferÃªncia de riqueza estÃ¡ acontecendo.",url:Y}}]},$r={en:{heroTitle:"Master the Backcoin Ecosystem",heroSubtitle:"Complete video tutorials to help you navigate staking, NFTs, Fortune Pool and more",videos:"Videos",languages:"2 Languages",catGettingStarted:"Getting Started",catGettingStartedDesc:"3 videos â€¢ Setup & First Steps",catEcosystem:"Ecosystem Features",catEcosystemDesc:"7 videos â€¢ Core Features & Tools",catAdvanced:"Advanced & Vision",catAdvancedDesc:"4 videos â€¢ Deep Dives & Future",tagBeginner:"Beginner",tagIntermediate:"Intermediate",tagAdvanced:"Advanced"},pt:{heroTitle:"Domine o Ecossistema Backcoin",heroSubtitle:"Tutoriais completos em vÃ­deo para ajudÃ¡-lo a navegar staking, NFTs, Fortune Pool e mais",videos:"VÃ­deos",languages:"2 Idiomas",catGettingStarted:"Primeiros Passos",catGettingStartedDesc:"3 vÃ­deos â€¢ ConfiguraÃ§Ã£o Inicial",catEcosystem:"Recursos do Ecossistema",catEcosystemDesc:"7 vÃ­deos â€¢ Ferramentas Principais",catAdvanced:"AvanÃ§ado & VisÃ£o",catAdvancedDesc:"4 vÃ­deos â€¢ Aprofundamento & Futuro",tagBeginner:"Iniciante",tagIntermediate:"IntermediÃ¡rio",tagAdvanced:"AvanÃ§ado"}};let Mt=localStorage.getItem("backcoin-tutorials-lang")||"en";function ag(e,t){const a=e[Mt],n=e.tag==="beginner"?"bg-emerald-500/20 text-emerald-400":e.tag==="intermediate"?"bg-amber-500/20 text-amber-400":"bg-red-500/20 text-red-400",i=$r[Mt][`tag${e.tag.charAt(0).toUpperCase()+e.tag.slice(1)}`];return`
        <a href="${a.url}" target="_blank" rel="noopener noreferrer" 
           class="group block bg-zinc-800/50 border border-zinc-700 rounded-xl overflow-hidden transition-all duration-300 hover:border-amber-500/50 hover:shadow-lg hover:shadow-amber-500/10 hover:-translate-y-1">
            <div class="relative aspect-video overflow-hidden bg-zinc-900">
                <img src="${e.thumbnail}" alt="${a.title}" 
                     class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                     onerror="this.src='./assets/bkc_logo_3d.png'; this.style.objectFit='contain'; this.style.padding='40px';">
                <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    <div class="w-14 h-14 bg-amber-500 rounded-full flex items-center justify-center shadow-lg">
                        <i class="fa-solid fa-play text-zinc-900 text-xl ml-1"></i>
                    </div>
                </div>
                <span class="absolute top-2 left-2 bg-black/70 backdrop-blur px-2 py-1 rounded text-xs font-bold text-amber-400">#${t+1}</span>
                <span class="absolute bottom-2 right-2 bg-black/80 px-2 py-1 rounded text-xs font-semibold text-white">${e.duration}</span>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-white text-sm mb-1 line-clamp-2">${a.title}</h3>
                <p class="text-zinc-400 text-xs line-clamp-2 mb-3">${a.description}</p>
                <span class="inline-block text-[10px] font-bold uppercase px-2 py-1 rounded ${n}">${i}</span>
            </div>
        </a>
    `}function hi(e,t,a,n,i,r,s){const o=$r[Mt];let l=`
        <div class="mb-10">
            <div class="flex items-center gap-3 mb-6 pb-3 border-b border-zinc-700">
                <div class="w-10 h-10 rounded-lg bg-${a}-500/20 flex items-center justify-center">
                    <i class="fa-solid fa-${t} text-${a}-400"></i>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-white">${o[i]}</h2>
                    <p class="text-xs text-zinc-500">${o[r]}</p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    `,c=s;return n.forEach(u=>{l+=ag(u,c++)}),l+="</div></div>",{html:l,nextIndex:c}}function ng(e){var t,a,n,i,r,s,o,l;Mt=e,localStorage.setItem("backcoin-tutorials-lang",e),(t=document.getElementById("tutorials-btn-en"))==null||t.classList.toggle("bg-amber-500",e==="en"),(a=document.getElementById("tutorials-btn-en"))==null||a.classList.toggle("text-zinc-900",e==="en"),(n=document.getElementById("tutorials-btn-en"))==null||n.classList.toggle("bg-zinc-700",e!=="en"),(i=document.getElementById("tutorials-btn-en"))==null||i.classList.toggle("text-zinc-300",e!=="en"),(r=document.getElementById("tutorials-btn-pt"))==null||r.classList.toggle("bg-amber-500",e==="pt"),(s=document.getElementById("tutorials-btn-pt"))==null||s.classList.toggle("text-zinc-900",e==="pt"),(o=document.getElementById("tutorials-btn-pt"))==null||o.classList.toggle("bg-zinc-700",e!=="pt"),(l=document.getElementById("tutorials-btn-pt"))==null||l.classList.toggle("text-zinc-300",e!=="pt"),Nd()}function Nd(){const e=document.getElementById("tutorials-content");if(!e)return;const t=$r[Mt];let a=`
        <!-- Hero -->
        <div class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold mb-3">
                <span class="bg-gradient-to-r from-amber-400 via-yellow-500 to-amber-400 bg-clip-text text-transparent">
                    ${t.heroTitle}
                </span>
            </h1>
            <p class="text-zinc-400 max-w-2xl mx-auto">${t.heroSubtitle}</p>
            <div class="flex items-center justify-center gap-4 mt-4">
                <div class="flex items-center gap-2 text-sm text-zinc-500">
                    <i class="fa-solid fa-video text-amber-400"></i>
                    <span>14 ${t.videos}</span>
                </div>
                <div class="w-1 h-1 bg-zinc-600 rounded-full"></div>
                <div class="flex items-center gap-2 text-sm text-zinc-500">
                    <i class="fa-solid fa-language text-emerald-400"></i>
                    <span>${t.languages}</span>
                </div>
            </div>
        </div>
    `,n=hi("getting-started","rocket","emerald",xi.gettingStarted,"catGettingStarted","catGettingStartedDesc",0);a+=n.html,n=hi("ecosystem","cubes","amber",xi.ecosystem,"catEcosystem","catEcosystemDesc",n.nextIndex),a+=n.html,n=hi("advanced","graduation-cap","cyan",xi.advanced,"catAdvanced","catAdvancedDesc",n.nextIndex),a+=n.html,e.innerHTML=a}const $d={render:function(e=!1){const t=document.getElementById("tutorials");t&&(e||t.innerHTML.trim()==="")&&(t.innerHTML=`
                <div class="max-w-6xl mx-auto">
                    <!-- Header with Language Switcher -->
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center">
                                <i class="fa-solid fa-play-circle text-cyan-400 text-xl"></i>
                            </div>
                            <div>
                                <h1 class="text-xl font-bold text-white">Video Tutorials</h1>
                                <p class="text-xs text-zinc-500">Learn how to use Backcoin</p>
                            </div>
                        </div>
                        
                        <!-- Language Switcher -->
                        <div class="flex items-center gap-1 bg-zinc-800 p-1 rounded-lg border border-zinc-700">
                            <button id="tutorials-btn-en" onclick="TutorialsPage.setLang('en')" 
                                    class="flex items-center gap-2 px-3 py-2 rounded-md text-xs font-bold transition-all ${Mt==="en"?"bg-amber-500 text-zinc-900":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}">
                                <img src="./assets/en.png" alt="EN" class="w-5 h-5 rounded-full">
                                <span class="hidden sm:inline">EN</span>
                            </button>
                            <button id="tutorials-btn-pt" onclick="TutorialsPage.setLang('pt')" 
                                    class="flex items-center gap-2 px-3 py-2 rounded-md text-xs font-bold transition-all ${Mt==="pt"?"bg-amber-500 text-zinc-900":"bg-zinc-700 text-zinc-300 hover:bg-zinc-600"}">
                                <img src="./assets/pt.png" alt="PT" class="w-5 h-5 rounded-full">
                                <span class="hidden sm:inline">PT</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Content Container -->
                    <div id="tutorials-content"></div>
                </div>
            `,Nd())},update:function(e){},cleanup:function(){},setLang:ng};window.TutorialsPage=$d;const Wt=window.ethers,ig={ACTIVE:0,COMPLETED:1,CANCELLED:2,WITHDRAWN:3},Sr=e=>typeof e=="number"?e:typeof e=="string"?isNaN(parseInt(e))?ig[e.toUpperCase()]??0:parseInt(e):0,Lr=e=>Sr(e.status)===0&&Number(e.deadline)>Math.floor(Date.now()/1e3),Rr=["function getCampaign(uint256 _campaignId) view returns (address creator, string title, string description, uint96 goalAmount, uint96 raisedAmount, uint32 donationCount, uint64 deadline, uint64 createdAt, uint96 boostAmount, uint64 boostTime, uint8 status, bool goalReached)","function campaignCounter() view returns (uint64)","function getStats() view returns (uint64 totalCampaigns, uint256 totalRaised, uint256 totalDonations, uint256 totalFees)"],Qa={getCampaigns:"https://getcharitycampaigns-4wvdcuoouq-uc.a.run.app",saveCampaign:"https://savecharitycampaign-4wvdcuoouq-uc.a.run.app",uploadImage:"/api/upload-image"},Sd="https://sepolia.arbiscan.io/address/",Pn={animal:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=800&q=80",humanitarian:"https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=800&q=80",default:"https://images.unsplash.com/photo-1532629345422-7515f3d16bb6?w=800&q=80"},Le={animal:{name:"Animal Welfare",emoji:"ðŸ¾",color:"#10b981",gradient:"from-emerald-500/20 to-green-600/20"},humanitarian:{name:"Humanitarian Aid",emoji:"ðŸ’—",color:"#ec4899",gradient:"from-pink-500/20 to-rose-600/20"}},Fs={0:{label:"Active",color:"#10b981",icon:"fa-circle-play",bg:"bg-emerald-500/15"},1:{label:"Ended",color:"#3b82f6",icon:"fa-circle-check",bg:"bg-blue-500/15"},2:{label:"Cancelled",color:"#ef4444",icon:"fa-circle-xmark",bg:"bg-red-500/15"},3:{label:"Completed",color:"#8b5cf6",icon:"fa-circle-dollar-to-slot",bg:"bg-purple-500/15"}},Ld=5*1024*1024,Rd=["image/jpeg","image/png","image/gif","image/webp"],E={campaigns:[],stats:null,currentView:"main",currentCampaign:null,selectedCategory:null,isLoading:!1,pendingImage:null,pendingImageFile:null,editingCampaign:null,createStep:1,createCategory:null,createTitle:"",createDesc:"",createGoal:"",createDuration:"",createImageFile:null,createImageUrl:"",createImagePreview:null};function rg(){if(document.getElementById("charity-styles-v6"))return;const e=document.createElement("style");e.id="charity-styles-v6",e.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V6.9 Charity Page Styles - Modern & Clean
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        @keyframes float { 
            0%, 100% { transform: translateY(0); } 
            50% { transform: translateY(-6px); } 
        }
        @keyframes pulse-border {
            0%, 100% { border-color: rgba(245,158,11,0.3); }
            50% { border-color: rgba(245,158,11,0.6); }
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .float-animation { animation: float 3s ease-in-out infinite; }
        
        .charity-page {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem 1rem;
            min-height: 400px;
        }
        
        /* Cards */
        .cp-card-base {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .cp-card-base:hover {
            border-color: rgba(245,158,11,0.3);
            transform: translateY(-2px);
        }
        
        /* Stats Cards */
        .cp-stat-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.7) 0%, rgba(24,24,27,0.8) 100%);
            border: 1px solid rgba(63,63,70,0.4);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }
        
        /* Category Cards */
        .cp-category-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .cp-category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .cp-category-card.animal:hover { border-color: #10b981; }
        .cp-category-card.humanitarian:hover { border-color: #ec4899; }
        .cp-category-card.selected { animation: pulse-border 2s ease-in-out infinite; }
        
        /* Campaign Cards */
        .cp-campaign-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .cp-campaign-card:hover {
            transform: translateY(-4px);
            border-color: rgba(245,158,11,0.4);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .cp-campaign-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: rgba(63,63,70,0.5);
        }
        
        /* Progress Bar */
        .cp-progress {
            height: 8px;
            background: rgba(63,63,70,0.5);
            border-radius: 4px;
            overflow: hidden;
        }
        .cp-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s ease;
        }
        .cp-progress-fill.animal { background: linear-gradient(90deg, #10b981, #059669); }
        .cp-progress-fill.humanitarian { background: linear-gradient(90deg, #ec4899, #db2777); }
        
        /* Badges */
        .cp-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        /* Buttons */
        .cp-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .cp-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .cp-btn-primary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
        }
        .cp-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245,158,11,0.3);
        }
        
        .cp-btn-secondary {
            background: rgba(63,63,70,0.8);
            color: #fafafa;
            border: 1px solid rgba(63,63,70,0.8);
        }
        .cp-btn-secondary:hover:not(:disabled) {
            background: rgba(63,63,70,1);
        }
        
        .cp-btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
        }
        .cp-btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16,185,129,0.3);
        }
        
        .cp-btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: #fff;
        }
        .cp-btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239,68,68,0.3);
        }
        
        /* Modal */
        .cp-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .cp-modal.active { display: flex; }
        .cp-modal-content {
            background: linear-gradient(145deg, rgba(39,39,42,0.98) 0%, rgba(24,24,27,0.99) 100%);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 20px;
            width: 100%;
            max-width: 520px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .cp-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid rgba(63,63,70,0.5);
        }
        .cp-modal-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #fafafa;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        .cp-modal-close {
            background: none;
            border: none;
            color: #a1a1aa;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s;
        }
        .cp-modal-close:hover { color: #fafafa; }
        .cp-modal-body { padding: 1.25rem; }
        .cp-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 1rem 1.25rem;
            border-top: 1px solid rgba(63,63,70,0.5);
        }
        
        /* Form Elements */
        .cp-form-group { margin-bottom: 1rem; }
        .cp-form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #fafafa;
            margin-bottom: 6px;
        }
        .cp-form-label span { color: #a1a1aa; font-weight: 400; }
        .cp-form-input {
            width: 100%;
            padding: 12px 14px;
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 10px;
            color: #fafafa;
            font-size: 14px;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        .cp-form-input:focus {
            outline: none;
            border-color: rgba(245,158,11,0.6);
        }
        .cp-form-textarea { min-height: 100px; resize: vertical; }
        .cp-form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        
        /* Category Selector */
        .cp-cat-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .cp-cat-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cp-cat-option:hover { border-color: rgba(245,158,11,0.4); }
        .cp-cat-option.selected {
            border-color: #f59e0b;
            background: rgba(245,158,11,0.1);
        }
        .cp-cat-option input { display: none; }
        .cp-cat-option-icon { font-size: 1.5rem; margin-bottom: 6px; }
        .cp-cat-option-name { font-size: 12px; font-weight: 600; color: #fafafa; }
        
        /* Donate Input */
        .cp-donate-input-wrap { position: relative; }
        .cp-donate-input {
            width: 100%;
            padding: 1rem;
            padding-right: 4rem;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            color: #fafafa;
            box-sizing: border-box;
        }
        .cp-donate-input:focus { outline: none; border-color: rgba(16,185,129,0.6); }
        .cp-donate-currency {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #a1a1aa;
            font-weight: 600;
        }
        .cp-donate-presets { display: flex; gap: 8px; margin: 10px 0; }
        .cp-preset {
            flex: 1;
            padding: 8px;
            background: rgba(63,63,70,0.5);
            border: 1px solid rgba(63,63,70,0.8);
            border-radius: 8px;
            color: #fafafa;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .cp-preset:hover { background: rgba(63,63,70,0.8); }
        
        /* Image Upload */
        .cp-image-upload {
            border: 2px dashed rgba(63,63,70,0.8);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(0,0,0,0.2);
        }
        .cp-image-upload:hover {
            border-color: rgba(245,158,11,0.5);
            background: rgba(245,158,11,0.05);
        }
        .cp-image-upload input { display: none; }
        .cp-image-upload-icon { font-size: 2rem; color: #a1a1aa; margin-bottom: 8px; }
        .cp-image-upload-text { font-size: 13px; color: #a1a1aa; }
        .cp-image-upload-text span { color: #f59e0b; font-weight: 600; }
        .cp-image-preview { width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; margin-bottom: 8px; }
        .cp-image-remove { background: #ef4444; color: #fff; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; }
        
        /* Tabs */
        .cp-tabs { display: flex; gap: 8px; margin-bottom: 1rem; }
        .cp-tab {
            flex: 1;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 8px;
            color: #a1a1aa;
            font-size: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .cp-tab.active {
            background: rgba(245,158,11,0.2);
            border-color: rgba(245,158,11,0.5);
            color: #f59e0b;
            font-weight: 600;
        }
        
        /* Detail Page */
        .cp-detail { max-width: 900px; margin: 0 auto; }
        .cp-detail-img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            background: rgba(63,63,70,0.5);
        }
        .cp-detail-content {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 1.5rem;
        }
        .cp-detail-sidebar { display: flex; flex-direction: column; gap: 1rem; }
        
        /* Share Box */
        .cp-share-box {
            background: rgba(63,63,70,0.3);
            border-radius: 12px;
            padding: 1rem;
        }
        .cp-share-title { font-size: 12px; color: #a1a1aa; margin-bottom: 10px; text-align: center; }
        .cp-share-btns { display: flex; justify-content: center; gap: 8px; }
        .cp-share-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .cp-share-btn:hover { transform: scale(1.1); }
        .cp-share-btn.twitter { background: #000; color: #fff; }
        .cp-share-btn.telegram { background: #0088cc; color: #fff; }
        .cp-share-btn.whatsapp { background: #25d366; color: #fff; }
        .cp-share-btn.copy { background: rgba(63,63,70,0.8); color: #fafafa; }
        
        /* Empty & Loading */
        .cp-empty { text-align: center; padding: 3rem 1rem; color: #a1a1aa; }
        .cp-empty i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
        .cp-empty h3 { color: #fafafa; margin: 0 0 8px; }
        .cp-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; gap: 1rem; }
        .cp-spinner { width: 40px; height: 40px; border: 3px solid rgba(63,63,70,0.5); border-top-color: #f59e0b; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Scrollbar */
        .cp-scrollbar::-webkit-scrollbar { width: 5px; }
        .cp-scrollbar::-webkit-scrollbar-track { background: rgba(39,39,42,0.5); border-radius: 3px; }
        .cp-scrollbar::-webkit-scrollbar-thumb { background: rgba(113,113,122,0.5); border-radius: 3px; }
        
        /* Step Wizard */
        .cp-step-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            padding: 0 1rem;
        }
        .cp-step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
        }
        .cp-step-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        .cp-step-dot.pending {
            background: rgba(39,39,42,0.8);
            color: #71717a;
            border: 2px solid rgba(63,63,70,0.8);
        }
        .cp-step-dot.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #000;
            box-shadow: 0 0 20px rgba(245,158,11,0.4);
        }
        .cp-step-dot.done {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
        }
        .cp-step-line {
            position: absolute;
            top: 20px;
            height: 3px;
            background: rgba(63,63,70,0.5);
            transition: all 0.5s ease;
        }
        .cp-step-line.ln-1 { left: 14%; width: 22%; }
        .cp-step-line.ln-2 { left: 39%; width: 22%; }
        .cp-step-line.ln-3 { left: 64%; width: 22%; }
        .cp-step-line.active { background: linear-gradient(90deg, #10b981, #f59e0b); }
        .cp-step-line.done { background: #10b981; }

        /* Wizard Cards */
        .cp-wiz-cat-card {
            background: linear-gradient(145deg, rgba(39,39,42,0.9) 0%, rgba(24,24,27,0.95) 100%);
            border: 2px solid rgba(63,63,70,0.5);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .cp-wiz-cat-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .cp-wiz-cat-card.animal:hover, .cp-wiz-cat-card.animal.selected { border-color: #10b981; }
        .cp-wiz-cat-card.humanitarian:hover, .cp-wiz-cat-card.humanitarian.selected { border-color: #ec4899; }
        .cp-wiz-cat-card.selected { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.3); }

        .cp-wiz-char-count {
            text-align: right;
            font-size: 11px;
            color: #71717a;
            margin-top: 4px;
        }
        .cp-wiz-char-count.warn { color: #f59e0b; }
        .cp-wiz-char-count.danger { color: #ef4444; }

        .cp-wiz-summary {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(63,63,70,0.5);
            border-radius: 12px;
            padding: 1rem;
        }
        .cp-wiz-summary-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 13px;
        }
        .cp-wiz-summary-row + .cp-wiz-summary-row { border-top: 1px solid rgba(63,63,70,0.3); }

        /* Responsive */
        @media(max-width:768px) {
            .cp-stats-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .cp-cats-grid { grid-template-columns: 1fr !important; }
            .cp-detail-content { grid-template-columns: 1fr; }
            .cp-detail-sidebar { order: -1; }
            .cp-form-row { grid-template-columns: 1fr; }
            .cp-wiz-cats-grid { grid-template-columns: 1fr !important; }
        }
    `,document.head.appendChild(e)}const Be=e=>{try{const t=Number(e)/1e18;return t<1e-4?"0":t<1?t.toFixed(4):t<1e3?t.toFixed(2):t.toLocaleString("en-US",{maximumFractionDigits:2})}catch{return"0"}},_d=e=>e?`${e.slice(0,6)}...${e.slice(-4)}`:"",en=(e,t)=>{const a=Number(e||0),n=Number(t||1);return Math.min(100,Math.round(a/n*100))},Fd=e=>{const t=Math.floor(Date.now()/1e3),a=Number(e)-t;if(a<=0)return{text:"Ended",color:"#ef4444"};const n=Math.floor(a/86400);return n>0?{text:`${n}d left`,color:"#10b981"}:{text:`${Math.floor(a/3600)}h left`,color:"#f59e0b"}},Yn=e=>(e==null?void 0:e.imageUrl)||Pn[e==null?void 0:e.category]||Pn.default,Md=e=>`${window.location.origin}${window.location.pathname}#charity/${e}`,Dd=()=>{const t=window.location.hash.match(/#charity\/(\d+)/);return t?t[1]:null},sg=e=>{window.location.hash=`charity/${e}`},og=()=>{window.location.hash.startsWith("#charity/")&&(window.location.hash="charity")},Od=e=>{const t=Sr(e.status),a=Number(e.deadline)<=Math.floor(Date.now()/1e3);return(t===0||t===1)&&a&&!e.withdrawn&&BigInt(e.raisedAmount||0)>0n},Hd="charity-meta-";function _r(e,t){try{localStorage.setItem(`${Hd}${e}`,JSON.stringify(t))}catch{}}function Ud(e){try{return JSON.parse(localStorage.getItem(`${Hd}${e}`)||"null")}catch{return null}}async function yt(){E.isLoading=!0;try{const[e,t]=await Promise.all([fetch(Qa.getCampaigns).then(i=>i.json()).catch(()=>({campaigns:[]})),lg()]),a=(e==null?void 0:e.campaigns)||[],n=d==null?void 0:d.publicProvider;if(n){const i=new Wt.Contract(w.charityPool,Rr,n),r=await i.campaignCounter(),s=Number(r),o=await Promise.all(Array.from({length:s},(l,c)=>c+1).map(async l=>{try{const c=await i.getCampaign(l),u=a.find(p=>String(p.id)===String(l)),f=Ud(l);return{id:String(l),creator:c.creator||c[0],title:(u==null?void 0:u.title)||c.title||c[1]||`Campaign #${l}`,description:(u==null?void 0:u.description)||c.description||c[2]||"",goalAmount:BigInt((c.goalAmount||c[3]).toString()),raisedAmount:BigInt((c.raisedAmount||c[4]).toString()),donationCount:Number(c.donationCount||c[5]),deadline:Number(c.deadline||c[6]),createdAt:Number(c.createdAt||c[7]),status:Number(c.status||c[10]),category:(u==null?void 0:u.category)||(f==null?void 0:f.category)||"humanitarian",imageUrl:(u==null?void 0:u.imageUrl)||(f==null?void 0:f.imageUrl)||null}}catch{return null}}));E.campaigns=o.filter(Boolean)}E.stats=t}catch(e){console.error("Load data:",e)}finally{E.isLoading=!1}}async function lg(){try{const e=d==null?void 0:d.publicProvider;if(!e)return null;const a=await new Wt.Contract(w.charityPool,Rr,e).getStats();return{raised:a.totalRaised??a[1],fees:a.totalFees??a[3],created:Number(a.totalCampaigns??a[0]),donations:Number(a.totalDonations??a[2])}}catch{return null}}function cg(e,t="create"){var i;const a=(i=e.target.files)==null?void 0:i[0];if(!a)return;if(!Rd.includes(a.type)){h("Please select a valid image (JPG, PNG, GIF, WebP)","error");return}if(a.size>Ld){h("Image must be less than 5MB","error");return}E.pendingImageFile=a;const n=new FileReader;n.onload=r=>{const s=t==="edit"?"edit-image-preview":"create-image-preview",o=document.getElementById(t==="edit"?"edit-image-upload":"create-image-upload"),l=document.getElementById(s);l&&(l.innerHTML=`
                <img src="${r.target.result}" class="cp-image-preview">
                <button type="button" class="cp-image-remove" onclick="CharityPage.removeImage('${t}')">
                    <i class="fa-solid fa-xmark"></i> Remove
                </button>
            `),o&&o.classList.add("has-image")},n.readAsDataURL(a)}function dg(e="create"){E.pendingImageFile=null,E.pendingImage=null;const t=e==="edit"?"edit-image-preview":"create-image-preview",a=document.getElementById(e==="edit"?"edit-image-upload":"create-image-upload"),n=document.getElementById(t);n&&(n.innerHTML=""),a&&a.classList.remove("has-image");const i=document.getElementById(e==="edit"?"edit-image-file":"create-image-file");i&&(i.value="")}function ug(e,t="create"){document.querySelectorAll(`#${t}-image-tabs .cp-tab`).forEach(r=>r.classList.toggle("active",r.dataset.tab===e));const n=document.getElementById(`${t}-image-upload`),i=document.getElementById(`${t}-image-url-wrap`);n&&(n.style.display=e==="upload"?"block":"none"),i&&(i.style.display=e==="url"?"block":"none")}async function Fr(e){const t=new FormData;t.append("image",e);const a=await fetch(Qa.uploadImage,{method:"POST",body:t,signal:AbortSignal.timeout(6e4)});if(!a.ok){const i=await a.json().catch(()=>({}));throw new Error(i.error||`Upload failed (${a.status})`)}return(await a.json()).imageUrl}const jd=e=>{const t=Fs[Sr(e)]||Fs[0];return`<span class="cp-badge" style="background:${t.color}20;color:${t.color}"><i class="fa-solid ${t.icon}"></i> ${t.label}</span>`},pg=()=>'<div class="cp-loading"><div class="cp-spinner"></div><span class="text-zinc-500">Loading campaigns...</span></div>',Wd=e=>`<div class="cp-empty"><i class="fa-solid fa-inbox"></i><h3>${e}</h3><p class="text-zinc-600 text-sm">Be the first to create a campaign!</p></div>`,Gd=e=>{var i,r,s,o;const t=en(e.raisedAmount,e.goalAmount),a=Fd(e.deadline),n=e.category||"humanitarian";return`
        <div class="cp-campaign-card" onclick="CharityPage.viewCampaign('${e.id}')">
            <img src="${Yn(e)}" alt="${e.title}" onerror="this.src='${Pn.default}'">
            <div class="p-4">
                <div class="flex flex-wrap gap-1.5 mb-2">
                    ${jd(e.status)}
                    <span class="cp-badge" style="background:${(i=Le[n])==null?void 0:i.color}20;color:${(r=Le[n])==null?void 0:r.color}">
                        ${(s=Le[n])==null?void 0:s.emoji} ${(o=Le[n])==null?void 0:o.name}
                    </span>
                </div>
                <h3 class="text-white font-bold text-sm mb-1 line-clamp-2">${e.title}</h3>
                <p class="text-zinc-500 text-xs mb-3">by <a href="${Sd}${e.creator}" target="_blank" class="text-amber-500 hover:text-amber-400">${_d(e.creator)}</a></p>
                <div class="cp-progress mb-2">
                    <div class="cp-progress-fill ${n}" style="width:${t}%"></div>
                </div>
                <div class="flex justify-between text-xs mb-3">
                    <span class="text-white font-semibold"><i class="fa-brands fa-ethereum text-zinc-500 mr-1"></i>${Be(e.raisedAmount)} ETH</span>
                    <span class="text-zinc-500">${t}% of ${Be(e.goalAmount)}</span>
                </div>
                <div class="flex justify-between text-xs text-zinc-500 pt-2 border-t border-zinc-800">
                    <span><i class="fa-solid fa-heart mr-1"></i>${e.donationCount||0}</span>
                    <span style="color:${a.color}">${a.text}</span>
                </div>
            </div>
        </div>
    `},Ms=()=>{var n,i,r,s;const e=E.campaigns.filter(o=>Lr(o)),t=e.filter(o=>o.category==="animal"),a=e.filter(o=>o.category==="humanitarian");return`
        <div class="charity-page">
            ${mg()}
            ${Kd()}
            ${Mr()}
            
            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 border border-amber-500/30 flex items-center justify-center float-animation">
                        <i class="fa-solid fa-hand-holding-heart text-2xl text-amber-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Charity Pool</h1>
                        <p class="text-sm text-zinc-500">Support causes with ETH â€¢ 95% goes directly to campaigns</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button class="cp-btn cp-btn-secondary" onclick="CharityPage.openMyCampaigns()">
                        <i class="fa-solid fa-folder-open"></i> My Campaigns
                    </button>
                    <button class="cp-btn cp-btn-primary" onclick="CharityPage.openCreate()">
                        <i class="fa-solid fa-plus"></i> Create
                    </button>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6 cp-stats-grid">
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-emerald-400 font-mono">
                        <i class="fa-brands fa-ethereum text-lg mr-1"></i>${E.stats?Be(E.stats.raised):"--"}
                    </p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Total Raised</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-blue-400 font-mono">${E.stats?Be(E.stats.fees):"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Platform Fees</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-amber-400 font-mono">${((n=E.stats)==null?void 0:n.created)??"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Campaigns</p>
                </div>
                <div class="cp-stat-card">
                    <p class="text-2xl font-bold text-purple-400 font-mono">${((i=E.stats)==null?void 0:i.donations)??"--"}</p>
                    <p class="text-[10px] text-zinc-500 uppercase mt-1">Donations</p>
                </div>
            </div>
            
            <!-- Categories -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8 cp-cats-grid">
                <div class="cp-category-card animal ${E.selectedCategory==="animal"?"selected":""}" onclick="CharityPage.selectCat('animal')">
                    <div class="w-16 h-16 rounded-full bg-emerald-500/15 flex items-center justify-center mx-auto mb-3">
                        <span class="text-3xl">ðŸ¾</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Animal Welfare</h3>
                    <div class="flex justify-center gap-6 text-sm text-zinc-400 mb-3">
                        <span><strong class="text-white">${t.length}</strong> active</span>
                        <span><i class="fa-brands fa-ethereum"></i> <strong class="text-white">${Be(t.reduce((o,l)=>o+BigInt(l.raisedAmount||0),0n))}</strong></span>
                    </div>
                    <button class="cp-btn cp-btn-success text-xs py-2 px-4" onclick="event.stopPropagation();CharityPage.openCreate('animal')">
                        <i class="fa-solid fa-plus"></i> Create Campaign
                    </button>
                </div>
                
                <div class="cp-category-card humanitarian ${E.selectedCategory==="humanitarian"?"selected":""}" onclick="CharityPage.selectCat('humanitarian')">
                    <div class="w-16 h-16 rounded-full bg-pink-500/15 flex items-center justify-center mx-auto mb-3">
                        <span class="text-3xl">ðŸ’—</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Humanitarian Aid</h3>
                    <div class="flex justify-center gap-6 text-sm text-zinc-400 mb-3">
                        <span><strong class="text-white">${a.length}</strong> active</span>
                        <span><i class="fa-brands fa-ethereum"></i> <strong class="text-white">${Be(a.reduce((o,l)=>o+BigInt(l.raisedAmount||0),0n))}</strong></span>
                    </div>
                    <button class="cp-btn cp-btn-success text-xs py-2 px-4" onclick="event.stopPropagation();CharityPage.openCreate('humanitarian')">
                        <i class="fa-solid fa-plus"></i> Create Campaign
                    </button>
                </div>
            </div>
            
            <!-- Campaigns Grid -->
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-white flex items-center gap-2">
                    ${E.selectedCategory?`
                        <button onclick="CharityPage.clearCat()" class="text-zinc-500 hover:text-white transition-colors">
                            <i class="fa-solid fa-arrow-left"></i>
                        </button>
                        ${(r=Le[E.selectedCategory])==null?void 0:r.emoji} ${(s=Le[E.selectedCategory])==null?void 0:s.name}
                    `:`
                        <i class="fa-solid fa-fire text-amber-500"></i> Active Campaigns
                    `}
                </h2>
                <span class="text-xs text-zinc-500">${e.filter(o=>!E.selectedCategory||o.category===E.selectedCategory).length} campaigns</span>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="cp-grid">
                ${e.length?e.filter(o=>!E.selectedCategory||o.category===E.selectedCategory).sort((o,l)=>Number(l.createdAt||0)-Number(o.createdAt||0)).map(o=>Gd(o)).join(""):Wd("No active campaigns")}
            </div>
        </div>
    `},Ds=e=>{var o,l,c,u,f,p;if(!e)return`
        <div class="charity-page">
            <button class="cp-btn cp-btn-secondary mb-6" onclick="CharityPage.goBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <div class="cp-empty">
                <i class="fa-solid fa-circle-question"></i>
                <h3>Campaign not found</h3>
            </div>
        </div>
    `;const t=en(e.raisedAmount,e.goalAmount),a=Fd(e.deadline),n=e.category||"humanitarian",i=Lr(e),r=((o=e.creator)==null?void 0:o.toLowerCase())===((l=d==null?void 0:d.userAddress)==null?void 0:l.toLowerCase()),s=Od(e);return`
        <div class="charity-page">
            ${Mr()}
            ${Kd()}
            
            <div class="cp-detail">
                <!-- Header -->
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <button class="cp-btn cp-btn-secondary" onclick="CharityPage.goBack()">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </button>
                    ${jd(e.status)}
                    <span class="cp-badge" style="background:${(c=Le[n])==null?void 0:c.color}20;color:${(u=Le[n])==null?void 0:u.color}">
                        ${(f=Le[n])==null?void 0:f.emoji} ${(p=Le[n])==null?void 0:p.name}
                    </span>
                    ${r?'<span class="cp-badge" style="background:rgba(245,158,11,0.2);color:#f59e0b"><i class="fa-solid fa-user"></i> Your Campaign</span>':""}
                    ${r?`
                        <button class="cp-btn cp-btn-secondary text-xs py-2 ml-auto" onclick="CharityPage.openEdit('${e.id}')">
                            <i class="fa-solid fa-pen"></i> Edit
                        </button>
                    `:""}
                </div>
                
                <img src="${Yn(e)}" class="cp-detail-img" onerror="this.src='${Pn.default}'">
                
                <div class="cp-detail-content">
                    <!-- Main Content -->
                    <div class="cp-card-base p-6">
                        <h1 class="text-2xl font-bold text-white mb-2">${e.title}</h1>
                        <p class="text-sm text-zinc-500 mb-4">
                            Created by <a href="${Sd}${e.creator}" target="_blank" class="text-amber-500 hover:text-amber-400">${_d(e.creator)}</a>
                        </p>
                        <p class="text-zinc-400 leading-relaxed whitespace-pre-wrap">${e.description||"No description provided."}</p>
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="cp-detail-sidebar">
                        <!-- Progress Card -->
                        <div class="cp-card-base p-5">
                            <div class="cp-progress h-3 mb-3">
                                <div class="cp-progress-fill ${n}" style="width:${t}%"></div>
                            </div>
                            <p class="text-3xl font-bold text-white mb-1">
                                <i class="fa-brands fa-ethereum text-zinc-500"></i> ${Be(e.raisedAmount)} ETH
                            </p>
                            <p class="text-sm text-zinc-500 mb-4">raised of ${Be(e.goalAmount)} ETH goal (${t}%)</p>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div class="text-center p-3 bg-zinc-800/50 rounded-xl">
                                    <p class="text-lg font-bold text-white">${e.donationCount||0}</p>
                                    <p class="text-[10px] text-zinc-500 uppercase">Donations</p>
                                </div>
                                <div class="text-center p-3 bg-zinc-800/50 rounded-xl">
                                    <p class="text-lg font-bold" style="color:${a.color}">${a.text}</p>
                                    <p class="text-[10px] text-zinc-500 uppercase">${i?"Remaining":"Status"}</p>
                                </div>
                            </div>
                        </div>
                        
                        ${i?`
                        <!-- Donate Card -->
                        <div class="cp-card-base p-5">
                            <h4 class="text-sm font-bold text-white mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-heart text-emerald-500"></i> Make a Donation
                            </h4>
                            <input type="number" id="detail-amount" placeholder="Amount in ETH" min="0.001" step="0.001"
                                   class="cp-form-input text-center text-lg font-bold mb-2">
                            <div class="cp-donate-presets mb-3">
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.01)">0.01</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.05)">0.05</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.1)">0.1</button>
                                <button class="cp-preset" onclick="CharityPage.setAmt(0.5)">0.5</button>
                            </div>
                            <button id="btn-donate-detail" class="cp-btn cp-btn-success w-full" onclick="CharityPage.donateDetail('${e.id}')">
                                <i class="fa-solid fa-heart"></i> Donate Now
                            </button>
                            <p class="text-center text-[10px] text-zinc-500 mt-2">
                                <strong>5%</strong> platform fee â€¢ <strong>95%</strong> to campaign
                            </p>
                        </div>
                        `:""}
                        
                        ${r&&i?`
                        <button id="btn-cancel" class="cp-btn cp-btn-danger w-full" onclick="CharityPage.cancel('${e.id}')">
                            <i class="fa-solid fa-xmark"></i> Cancel Campaign
                        </button>
                        `:""}
                        
                        ${r&&s?`
                        <button id="btn-withdraw" class="cp-btn cp-btn-primary w-full" onclick="CharityPage.withdraw('${e.id}')">
                            <i class="fa-solid fa-wallet"></i> Withdraw Funds
                        </button>
                        `:""}
                        
                        <!-- Share -->
                        <div class="cp-share-box">
                            <p class="cp-share-title">Share this campaign</p>
                            <div class="cp-share-btns">
                                <button class="cp-share-btn twitter" onclick="CharityPage.share('twitter')">
                                    <i class="fa-brands fa-x-twitter"></i>
                                </button>
                                <button class="cp-share-btn telegram" onclick="CharityPage.share('telegram')">
                                    <i class="fa-brands fa-telegram"></i>
                                </button>
                                <button class="cp-share-btn whatsapp" onclick="CharityPage.share('whatsapp')">
                                    <i class="fa-brands fa-whatsapp"></i>
                                </button>
                                <button class="cp-share-btn copy" onclick="CharityPage.copyLink()">
                                    <i class="fa-solid fa-link"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `},Mr=()=>`
    <div class="cp-modal" id="modal-donate">
        <div class="cp-modal-content">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-heart text-emerald-500"></i> Donate</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('donate')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body">
                <div id="donate-campaign-info"></div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Amount (ETH)</label>
                    <div class="cp-donate-input-wrap">
                        <input type="number" id="donate-amount" class="cp-donate-input" placeholder="0.1" min="0.001" step="0.001">
                        <span class="cp-donate-currency">ETH</span>
                    </div>
                    <div class="cp-donate-presets">
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.01)">0.01</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.05)">0.05</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.1)">0.1</button>
                        <button class="cp-preset" onclick="CharityPage.setAmt(0.5)">0.5</button>
                    </div>
                </div>
                <div class="text-center text-xs text-zinc-500 p-3 bg-zinc-800/50 rounded-xl">
                    <strong>5%</strong> platform fee â€¢ <strong>95%</strong> goes to campaign
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.closeModal('donate')">Cancel</button>
                <button id="btn-donate" class="cp-btn cp-btn-success" onclick="CharityPage.donate()"><i class="fa-solid fa-heart"></i> Donate</button>
            </div>
        </div>
    </div>
`,mg=()=>`
    <div class="cp-modal" id="modal-my">
        <div class="cp-modal-content" style="max-width:600px">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-folder-open text-amber-500"></i> My Campaigns</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('my')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body cp-scrollbar" style="max-height:60vh;overflow-y:auto">
                <div id="my-campaigns-list"></div>
            </div>
        </div>
    </div>
`,Kd=()=>`
    <div class="cp-modal" id="modal-edit">
        <div class="cp-modal-content">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title"><i class="fa-solid fa-pen text-amber-500"></i> Edit Campaign</h3>
                <button class="cp-modal-close" onclick="CharityPage.closeModal('edit')"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="cp-modal-body cp-scrollbar" style="max-height:60vh;overflow-y:auto">
                <input type="hidden" id="edit-campaign-id">
                <div class="cp-form-group">
                    <label class="cp-form-label">Category</label>
                    <div class="cp-cat-selector">
                        <label class="cp-cat-option" id="edit-opt-animal" onclick="CharityPage.selCatOpt('animal','edit')">
                            <input type="radio" name="edit-category" value="animal">
                            <div class="cp-cat-option-icon">ðŸ¾</div>
                            <div class="cp-cat-option-name">Animal</div>
                        </label>
                        <label class="cp-cat-option" id="edit-opt-humanitarian" onclick="CharityPage.selCatOpt('humanitarian','edit')">
                            <input type="radio" name="edit-category" value="humanitarian">
                            <div class="cp-cat-option-icon">ðŸ’—</div>
                            <div class="cp-cat-option-name">Humanitarian</div>
                        </label>
                    </div>
                </div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Image</label>
                    <div class="cp-tabs" id="edit-image-tabs">
                        <button type="button" class="cp-tab active" data-tab="upload" onclick="CharityPage.switchImageTab('upload','edit')">Upload</button>
                        <button type="button" class="cp-tab" data-tab="url" onclick="CharityPage.switchImageTab('url','edit')">URL</button>
                    </div>
                    <div class="cp-image-upload" id="edit-image-upload" onclick="document.getElementById('edit-image-file').click()">
                        <input type="file" id="edit-image-file" accept="image/*" onchange="CharityPage.handleImageSelect(event,'edit')">
                        <div class="cp-image-upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                        <div class="cp-image-upload-text"><span>Click to upload</span> new image</div>
                        <div id="edit-image-preview"></div>
                    </div>
                    <div id="edit-image-url-wrap" style="display:none">
                        <input type="url" id="edit-image-url" class="cp-form-input" placeholder="https://example.com/image.jpg">
                    </div>
                </div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Title</label>
                    <input type="text" id="edit-title" class="cp-form-input" maxlength="100">
                </div>
                <div class="cp-form-group">
                    <label class="cp-form-label">Description</label>
                    <textarea id="edit-desc" class="cp-form-input cp-form-textarea" maxlength="2000"></textarea>
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.closeModal('edit')">Cancel</button>
                <button id="btn-save-edit" class="cp-btn cp-btn-primary" onclick="CharityPage.saveEdit()"><i class="fa-solid fa-check"></i> Save</button>
            </div>
        </div>
    </div>
`,fg=()=>`
    <div class="charity-page">
        ${Mr()}
        <!-- Header -->
        <div class="flex items-center gap-4 mb-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.cancelCreate()">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <div>
                <h1 class="text-xl font-bold text-white">Create Campaign</h1>
                <p class="text-sm text-zinc-500">Step ${E.createStep} of 4</p>
            </div>
        </div>

        <!-- Step Indicator -->
        <div class="cp-card-base p-5 mb-6">
            <div class="cp-step-container">
                <div class="cp-step-line ln-1" id="cp-ln-1"></div>
                <div class="cp-step-line ln-2" id="cp-ln-2"></div>
                <div class="cp-step-line ln-3" id="cp-ln-3"></div>
                <div class="cp-step-item">
                    <div class="cp-step-dot active" id="cp-step-1">1</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Category</span>
                </div>
                <div class="cp-step-item">
                    <div class="cp-step-dot pending" id="cp-step-2">2</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Details</span>
                </div>
                <div class="cp-step-item">
                    <div class="cp-step-dot pending" id="cp-step-3">3</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Image</span>
                </div>
                <div class="cp-step-item">
                    <div class="cp-step-dot pending" id="cp-step-4">4</div>
                    <span class="text-[10px] text-zinc-500 mt-2">Confirm</span>
                </div>
            </div>
        </div>

        <!-- Step Content -->
        <div class="cp-card-base p-6" id="cp-wiz-panel"></div>
    </div>
`;function bg(){[1,2,3,4].forEach(t=>{const a=document.getElementById(`cp-step-${t}`);a&&(t<E.createStep?(a.className="cp-step-dot done",a.innerHTML='<i class="fa-solid fa-check text-sm"></i>'):t===E.createStep?(a.className="cp-step-dot active",a.textContent=t):(a.className="cp-step-dot pending",a.textContent=t))}),[1,2,3].forEach(t=>{const a=document.getElementById(`cp-ln-${t}`);a&&(a.className=`cp-step-line ln-${t} ${E.createStep>t?"done":E.createStep===t?"active":""}`)});const e=document.querySelector(".charity-page .text-sm.text-zinc-500");e&&(e.textContent=`Step ${E.createStep} of 4`)}function tn(){const e=document.getElementById("cp-wiz-panel");if(e)switch(bg(),E.createStep){case 1:gg(e);break;case 2:xg(e);break;case 3:hg(e);break;case 4:vg(e);break}}function gg(e){e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Choose a Category</h2>
        <p class="text-sm text-zinc-500 mb-6">Select what type of cause your campaign supports</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 cp-wiz-cats-grid">
            <div class="cp-wiz-cat-card animal ${E.createCategory==="animal"?"selected":""}" onclick="CharityPage.wizardSelectCategory('animal')">
                <div class="w-16 h-16 rounded-full bg-emerald-500/15 flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">ðŸ¾</span>
                </div>
                <h3 class="text-lg font-bold text-white mb-1">Animal Welfare</h3>
                <p class="text-xs text-zinc-500">Rescue, shelter, and protection of animals</p>
            </div>
            <div class="cp-wiz-cat-card humanitarian ${E.createCategory==="humanitarian"?"selected":""}" onclick="CharityPage.wizardSelectCategory('humanitarian')">
                <div class="w-16 h-16 rounded-full bg-pink-500/15 flex items-center justify-center mx-auto mb-3">
                    <span class="text-3xl">ðŸ’—</span>
                </div>
                <h3 class="text-lg font-bold text-white mb-1">Humanitarian Aid</h3>
                <p class="text-xs text-zinc-500">Help communities and people in need</p>
            </div>
        </div>
        <div class="flex justify-end mt-6">
            <button class="cp-btn cp-btn-primary ${E.createCategory?"":"opacity-50 cursor-not-allowed"}"
                    onclick="CharityPage.wizardNext()" ${E.createCategory?"":"disabled"}>
                Next <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    `}function xg(e){const t=E.createTitle.length,a=E.createDesc.length;e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Campaign Details</h2>
        <p class="text-sm text-zinc-500 mb-6">Tell your story â€” what is this campaign about?</p>
        <div class="cp-form-group">
            <label class="cp-form-label">Title *</label>
            <input type="text" id="wiz-title" class="cp-form-input" placeholder="Give your campaign a clear title" maxlength="100"
                   value="${E.createTitle.replace(/"/g,"&quot;")}" oninput="CharityPage.wizardUpdateCharCount('title', this)">
            <div class="cp-wiz-char-count ${t>80?t>95?"danger":"warn":""}" id="wiz-title-count">${t}/100</div>
        </div>
        <div class="cp-form-group">
            <label class="cp-form-label">Description *</label>
            <textarea id="wiz-desc" class="cp-form-input cp-form-textarea" placeholder="Describe the cause, how funds will be used, and why it matters..."
                      maxlength="2000" style="min-height:140px" oninput="CharityPage.wizardUpdateCharCount('desc', this)">${E.createDesc}</textarea>
            <div class="cp-wiz-char-count ${a>1800?a>1950?"danger":"warn":""}" id="wiz-desc-count">${a}/2000</div>
        </div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <button class="cp-btn cp-btn-primary" onclick="CharityPage.wizardNext()">
                Next <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    `}function hg(e){e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Campaign Image</h2>
        <p class="text-sm text-zinc-500 mb-6">Add a cover image to attract more donors <span class="text-zinc-600">(optional)</span></p>
        <div class="cp-tabs mb-4" id="wiz-image-tabs">
            <button type="button" class="cp-tab active" data-tab="upload" onclick="CharityPage.switchImageTab('upload','wiz')">
                <i class="fa-solid fa-cloud-arrow-up mr-1"></i> Upload
            </button>
            <button type="button" class="cp-tab" data-tab="url" onclick="CharityPage.switchImageTab('url','wiz')">
                <i class="fa-solid fa-link mr-1"></i> URL
            </button>
        </div>
        <div id="wiz-image-upload" class="cp-image-upload" onclick="document.getElementById('wiz-image-file').click()">
            <input type="file" id="wiz-image-file" accept="image/*" onchange="CharityPage.handleWizardImageSelect(event)">
            <div id="wiz-image-preview">
                ${E.createImagePreview?`
                    <img src="${E.createImagePreview}" class="cp-image-preview">
                    <button type="button" class="cp-image-remove" onclick="event.stopPropagation();CharityPage.removeWizardImage()">
                        <i class="fa-solid fa-xmark"></i> Remove
                    </button>
                `:`
                    <div class="cp-image-upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
                    <div class="cp-image-upload-text"><span>Click to upload</span> or drag and drop<br><small>PNG, JPG, GIF, WebP â€” max 5MB</small></div>
                `}
            </div>
        </div>
        <div id="wiz-image-url-wrap" style="display:none">
            <input type="url" id="wiz-image-url" class="cp-form-input" placeholder="https://example.com/image.jpg"
                   value="${E.createImageUrl.replace(/"/g,"&quot;")}">
        </div>
        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <div class="flex gap-2">
                <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardSkipImage()">
                    Skip <i class="fa-solid fa-forward"></i>
                </button>
                <button class="cp-btn cp-btn-primary" onclick="CharityPage.wizardNext()">
                    Next <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>
    `}function vg(e){const t=Le[E.createCategory]||Le.humanitarian;e.innerHTML=`
        <h2 class="text-lg font-bold text-white mb-2">Confirm & Launch</h2>
        <p class="text-sm text-zinc-500 mb-6">Set your goal, duration and review before launching</p>
        <div class="cp-form-row mb-4">
            <div class="cp-form-group">
                <label class="cp-form-label">Goal (ETH) *</label>
                <input type="number" id="wiz-goal" class="cp-form-input" placeholder="1.0" min="0.01" step="0.01"
                       value="${E.createGoal}">
            </div>
            <div class="cp-form-group">
                <label class="cp-form-label">Duration (Days) * <span>1-180</span></label>
                <input type="number" id="wiz-duration" class="cp-form-input" placeholder="30" min="1" max="180"
                       value="${E.createDuration}">
            </div>
        </div>

        <!-- Summary -->
        <div class="cp-wiz-summary mb-4">
            <h4 class="text-sm font-bold text-white mb-3"><i class="fa-solid fa-clipboard-list text-amber-500 mr-2"></i>Summary</h4>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Category</span>
                <span class="text-white">${t.emoji} ${t.name}</span>
            </div>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Title</span>
                <span class="text-white truncate ml-4" style="max-width:200px">${E.createTitle||"â€”"}</span>
            </div>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Description</span>
                <span class="text-white">${E.createDesc?`${E.createDesc.length} chars`:"â€”"}</span>
            </div>
            <div class="cp-wiz-summary-row">
                <span class="text-zinc-500">Image</span>
                <span class="text-white">${E.createImagePreview||E.createImageUrl?'<i class="fa-solid fa-check text-emerald-400"></i> Added':'<span class="text-zinc-600">None</span>'}</span>
            </div>
        </div>

        <!-- Cost Info -->
        <div class="text-center text-xs text-zinc-500 p-3 bg-zinc-800/50 rounded-xl mb-4">
            <i class="fa-solid fa-coins text-amber-400 mr-1"></i>
            Campaign creation costs <strong class="text-amber-400">1 BKC</strong> token
        </div>

        <div class="flex justify-between mt-6">
            <button class="cp-btn cp-btn-secondary" onclick="CharityPage.wizardBack()">
                <i class="fa-solid fa-arrow-left"></i> Back
            </button>
            <button id="btn-wizard-launch" class="cp-btn cp-btn-primary" onclick="CharityPage.wizardLaunch()">
                <i class="fa-solid fa-rocket"></i> Launch Campaign
            </button>
        </div>
    `}function wg(e){E.createCategory=e,tn()}function yg(){var e,t,a,n,i,r;switch(E.createStep){case 1:if(!E.createCategory)return h("Select a category","error");break;case 2:{const s=((t=(e=document.getElementById("wiz-title"))==null?void 0:e.value)==null?void 0:t.trim())||"",o=((n=(a=document.getElementById("wiz-desc"))==null?void 0:a.value)==null?void 0:n.trim())||"";if(E.createTitle=s,E.createDesc=o,!s)return h("Enter a title","error");if(!o)return h("Enter a description","error");break}case 3:{const s=((r=(i=document.getElementById("wiz-image-url"))==null?void 0:i.value)==null?void 0:r.trim())||"";s&&(E.createImageUrl=s);break}}E.createStep=Math.min(4,E.createStep+1),tn()}function kg(){Tg(),E.createStep=Math.max(1,E.createStep-1),tn()}function Eg(){E.createImageFile=null,E.createImageUrl="",E.createImagePreview=null,E.pendingImageFile=null,E.createStep=4,tn()}function Yd(){E.currentView="main",E.createStep=1,E.createCategory=null,E.createTitle="",E.createDesc="",E.createGoal="",E.createDuration="",E.createImageFile=null,E.createImageUrl="",E.createImagePreview=null,E.pendingImageFile=null,We()}function Tg(){switch(E.createStep){case 2:{const e=document.getElementById("wiz-title"),t=document.getElementById("wiz-desc");e&&(E.createTitle=e.value),t&&(E.createDesc=t.value);break}case 3:{const e=document.getElementById("wiz-image-url");e&&(E.createImageUrl=e.value.trim());break}case 4:{const e=document.getElementById("wiz-goal"),t=document.getElementById("wiz-duration");e&&(E.createGoal=e.value),t&&(E.createDuration=t.value);break}}}function Cg(e,t){const a=t.value.length,n=e==="title"?100:2e3,i=e==="title"?80:1800,r=e==="title"?95:1950,s=document.getElementById(`wiz-${e}-count`);s&&(s.textContent=`${a}/${n}`,s.className=`cp-wiz-char-count ${a>r?"danger":a>i?"warn":""}`)}function Ig(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(!t)return;if(!Rd.includes(t.type)){h("Please select a valid image (JPG, PNG, GIF, WebP)","error");return}if(t.size>Ld){h("Image must be less than 5MB","error");return}E.createImageFile=t,E.pendingImageFile=t;const a=new FileReader;a.onload=i=>{E.createImagePreview=i.target.result;const r=document.getElementById("wiz-image-preview");r&&(r.innerHTML=`
                <img src="${i.target.result}" class="cp-image-preview">
                <button type="button" class="cp-image-remove" onclick="event.stopPropagation();CharityPage.removeWizardImage()">
                    <i class="fa-solid fa-xmark"></i> Remove
                </button>
            `)},a.readAsDataURL(t)}function Ag(){E.createImageFile=null,E.createImagePreview=null,E.createImageUrl="",E.pendingImageFile=null;const e=document.getElementById("wiz-image-preview");e&&(e.innerHTML=`
            <div class="cp-image-upload-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div>
            <div class="cp-image-upload-text"><span>Click to upload</span> or drag and drop<br><small>PNG, JPG, GIF, WebP â€” max 5MB</small></div>
        `);const t=document.getElementById("wiz-image-file");t&&(t.value="")}async function Bg(){var l,c;if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");const e=(l=document.getElementById("wiz-goal"))==null?void 0:l.value,t=(c=document.getElementById("wiz-duration"))==null?void 0:c.value;if(E.createGoal=e||"",E.createDuration=t||"",!E.createCategory)return h("Select a category","error");if(!E.createTitle)return h("Enter a title","error");if(!E.createDesc)return h("Enter a description","error");if(!e||parseFloat(e)<.01)return h("Goal must be at least 0.01 ETH","error");if(!t||parseInt(t)<1||parseInt(t)>180)return h("Duration must be 1-180 days","error");let a=E.createImageUrl||"";if(E.createImageFile)try{h("Uploading image to IPFS...","info"),a=await Fr(E.createImageFile),h("Image uploaded!","success")}catch(u){console.error("Image upload failed:",u),h("Image upload failed â€” campaign will be created without image","warning")}const n=E.createTitle,i=E.createDesc,r=E.createCategory,s=Wt.parseEther(e),o=parseInt(t);await Ht.createCampaign({title:n,description:i,goalAmount:s,durationDays:o,button:document.getElementById("btn-wizard-launch"),onSuccess:async(u,f)=>{if(f){_r(f,{imageUrl:a,category:r,title:n,description:i});try{await fetch(Qa.saveCampaign,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:f,title:n,description:i,category:r,imageUrl:a,creator:d.userAddress})})}catch{}}h("Campaign created!","success"),Yd(),await yt(),We()},onError:u=>{var f;!u.cancelled&&u.type!=="user_rejected"&&h(((f=u.message)==null?void 0:f.slice(0,80))||"Failed","error")}})}function Vn(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.add("active")}function ft(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.remove("active")}function zg(e=null){E.createStep=e?2:1,E.createCategory=e,E.createTitle="",E.createDesc="",E.createGoal="",E.createDuration="",E.createImageFile=null,E.createImageUrl="",E.createImagePreview=null,E.pendingImageFile=null,E.currentView="create",We()}function Pg(e){const t=E.campaigns.find(i=>i.id===e||i.id===String(e));if(!t)return;const a=document.getElementById("donate-campaign-info");a&&(a.innerHTML=`
            <div class="flex items-center gap-3 p-3 bg-zinc-800/50 rounded-xl mb-4">
                <img src="${Yn(t)}" class="w-12 h-12 rounded-lg object-cover">
                <div class="flex-1 min-w-0">
                    <p class="text-white font-semibold text-sm truncate">${t.title}</p>
                    <p class="text-zinc-500 text-xs">${en(t.raisedAmount,t.goalAmount)}% funded</p>
                </div>
            </div>
        `);const n=document.getElementById("donate-amount");n&&(n.value=""),E.currentCampaign=t,Vn("donate")}function Ng(){var n;const e=(n=d==null?void 0:d.userAddress)==null?void 0:n.toLowerCase(),t=E.campaigns.filter(i=>{var r;return((r=i.creator)==null?void 0:r.toLowerCase())===e}),a=document.getElementById("my-campaigns-list");a&&(t.length===0?a.innerHTML=`
            <div class="cp-empty">
                <i class="fa-solid fa-folder-open"></i>
                <h3>No campaigns yet</h3>
                <p class="text-zinc-600 text-sm mb-4">Create your first campaign to start raising funds</p>
                <button class="cp-btn cp-btn-primary" onclick="CharityPage.closeModal('my');CharityPage.openCreate()">
                    <i class="fa-solid fa-plus"></i> Create Campaign
                </button>
            </div>
        `:a.innerHTML=t.map(i=>{const r=en(i.raisedAmount,i.goalAmount),s=Od(i);return`
                <div class="flex items-center gap-3 p-3 bg-zinc-800/30 rounded-xl mb-2 hover:bg-zinc-800/50 transition-colors">
                    <img src="${Yn(i)}" class="w-14 h-14 rounded-lg object-cover cursor-pointer" onclick="CharityPage.viewCampaign('${i.id}')">
                    <div class="flex-1 min-w-0">
                        <p class="text-white font-semibold text-sm truncate cursor-pointer hover:text-amber-400" onclick="CharityPage.viewCampaign('${i.id}')">${i.title}</p>
                        <p class="text-zinc-500 text-xs"><i class="fa-brands fa-ethereum"></i> ${Be(i.raisedAmount)} / ${Be(i.goalAmount)} ETH (${r}%)</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="cp-btn cp-btn-secondary text-xs py-1.5 px-3" onclick="CharityPage.openEdit('${i.id}')">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                        ${s?`
                            <button id="btn-withdraw-${i.id}" class="cp-btn cp-btn-primary text-xs py-1.5 px-3" onclick="CharityPage.withdraw('${i.id}')">
                                <i class="fa-solid fa-wallet"></i>
                            </button>
                        `:""}
                    </div>
                </div>
            `}).join(""),Vn("my"))}function $g(e){var n,i,r;const t=E.campaigns.find(s=>s.id===e||s.id===String(e));if(!t)return;if(((n=t.creator)==null?void 0:n.toLowerCase())!==((i=d==null?void 0:d.userAddress)==null?void 0:i.toLowerCase())){h("Not your campaign","error");return}E.editingCampaign=t,E.pendingImageFile=null,document.getElementById("edit-campaign-id").value=t.id,document.getElementById("edit-title").value=t.title||"",document.getElementById("edit-desc").value=t.description||"",document.getElementById("edit-image-url").value=t.imageUrl||"",document.querySelectorAll("#modal-edit .cp-cat-option").forEach(s=>s.classList.remove("selected")),(r=document.getElementById(`edit-opt-${t.category||"humanitarian"}`))==null||r.classList.add("selected");const a=document.getElementById("edit-image-preview");a&&t.imageUrl?a.innerHTML=`<img src="${t.imageUrl}" class="cp-image-preview">`:a&&(a.innerHTML=""),Vn("edit")}function Sg(e,t="create"){var i;const a=t==="edit"?"edit-opt-":"opt-",n=t==="edit"?"#modal-edit":"#modal-create";document.querySelectorAll(`${n} .cp-cat-option`).forEach(r=>r.classList.remove("selected")),(i=document.getElementById(`${a}${e}`))==null||i.classList.add("selected")}function Lg(e){const t=document.getElementById("donate-amount")||document.getElementById("detail-amount");t&&(t.value=e)}async function Rg(){var l,c,u,f,p,b,m,x;if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");const e=document.querySelector("#modal-create .cp-cat-option.selected input"),t=(e==null?void 0:e.value)||"humanitarian",a=(c=(l=document.getElementById("campaign-title"))==null?void 0:l.value)==null?void 0:c.trim(),n=(f=(u=document.getElementById("campaign-desc"))==null?void 0:u.value)==null?void 0:f.trim(),i=(p=document.getElementById("campaign-goal"))==null?void 0:p.value,r=(b=document.getElementById("campaign-duration"))==null?void 0:b.value;let s=(x=(m=document.getElementById("campaign-image-url"))==null?void 0:m.value)==null?void 0:x.trim();if(!a)return h("Enter a title","error");if(!n)return h("Enter a description","error");if(!i||parseFloat(i)<.01)return h("Goal must be at least 0.01 ETH","error");if(!r||parseInt(r)<1)return h("Duration must be at least 1 day","error");if(E.pendingImageFile)try{h("Uploading image...","info"),s=await Fr(E.pendingImageFile)}catch(y){console.error("Image upload failed:",y)}const o=Wt.parseEther(i);await Ht.createCampaign({title:a,description:n,goalAmount:o,durationDays:parseInt(r),button:document.getElementById("btn-create"),onSuccess:async(y,C)=>{if(C){_r(C,{imageUrl:s,category:t,title:a,description:n});try{await fetch(Qa.saveCampaign,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:C,title:a,description:n,category:t,imageUrl:s,creator:d.userAddress})})}catch{}}h("Campaign created!","success"),ft("create"),E.pendingImageFile=null,await yt(),We()},onError:y=>{var C;!y.cancelled&&y.type!=="user_rejected"&&h(((C=y.message)==null?void 0:C.slice(0,80))||"Failed","error")}})}async function _g(){var n;if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");const e=E.currentCampaign;if(!e)return;const t=(n=document.getElementById("donate-amount"))==null?void 0:n.value;if(!t||parseFloat(t)<.001)return h("Minimum 0.001 ETH","error");const a=Wt.parseEther(t);await Ht.donate({campaignId:e.id,amount:a,button:document.getElementById("btn-donate"),onSuccess:async()=>{h("â¤ï¸ Thank you for your donation!","success"),ft("donate"),await yt(),We()},onError:i=>{var r;!i.cancelled&&i.type!=="user_rejected"&&h(((r=i.message)==null?void 0:r.slice(0,80))||"Failed","error")}})}async function Fg(e){var n;if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");const t=(n=document.getElementById("detail-amount"))==null?void 0:n.value;if(!t||parseFloat(t)<.001)return h("Minimum 0.001 ETH","error");const a=Wt.parseEther(t);await Ht.donate({campaignId:e,amount:a,button:document.getElementById("btn-donate-detail"),onSuccess:async()=>{h("â¤ï¸ Thank you for your donation!","success"),await yt(),await Gt(e)},onError:i=>{var r;!i.cancelled&&i.type!=="user_rejected"&&h(((r=i.message)==null?void 0:r.slice(0,80))||"Failed","error")}})}async function Mg(e){if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");confirm("Cancel this campaign? This cannot be undone.")&&await Ht.cancelCampaign({campaignId:e,button:document.getElementById("btn-cancel"),onSuccess:async()=>{h("Campaign cancelled","success"),await yt(),We()},onError:t=>{var a;!t.cancelled&&t.type!=="user_rejected"&&h(((a=t.message)==null?void 0:a.slice(0,80))||"Failed","error")}})}async function Dg(e){if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");const t=E.campaigns.find(i=>i.id===e||i.id===String(e));if(!t)return;const a=en(t.raisedAmount,t.goalAmount);let n=`Withdraw ${Be(t.raisedAmount)} ETH?

5% platform fee applies.`;a<100&&(n+=`
Goal not reached - partial withdrawal.`),confirm(n)&&await Ht.withdraw({campaignId:e,button:document.getElementById(`btn-withdraw-${e}`)||document.getElementById("btn-withdraw"),onSuccess:async()=>{var i;h("âœ… Funds withdrawn successfully!","success"),ft("my"),await yt(),We(),((i=E.currentCampaign)==null?void 0:i.id)===e&&await Gt(e)},onError:i=>{var r;!i.cancelled&&i.type!=="user_rejected"&&h(((r=i.message)==null?void 0:r.slice(0,80))||"Failed","error")}})}async function Og(){var o,l,c,u,f,p,b,m;if(!(d!=null&&d.isConnected))return h("Connect wallet","warning");const e=(o=document.getElementById("edit-campaign-id"))==null?void 0:o.value,t=(c=(l=document.getElementById("edit-title"))==null?void 0:l.value)==null?void 0:c.trim(),a=(f=(u=document.getElementById("edit-desc"))==null?void 0:u.value)==null?void 0:f.trim();let n=(b=(p=document.getElementById("edit-image-url"))==null?void 0:p.value)==null?void 0:b.trim();const i=document.querySelector("#modal-edit .cp-cat-option.selected input"),r=(i==null?void 0:i.value)||"humanitarian";if(!t)return h("Enter title","error");if(E.pendingImageFile)try{h("Uploading image...","info"),n=await Fr(E.pendingImageFile)}catch(x){console.error("Image upload failed:",x)}const s=document.getElementById("btn-save-edit");s&&(s.disabled=!0,s.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Saving...');try{_r(e,{imageUrl:n,category:r,title:t,description:a}),await fetch(Qa.saveCampaign,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,title:t,description:a,category:r,imageUrl:n,creator:d.userAddress})}),h("Campaign updated!","success"),ft("edit"),E.pendingImageFile=null,await yt(),((m=E.currentCampaign)==null?void 0:m.id)===e?await Gt(e):We()}catch{h("Failed to save","error")}finally{s&&(s.disabled=!1,s.innerHTML='<i class="fa-solid fa-check"></i> Save')}}function Hg(e){const t=E.currentCampaign;if(!t)return;const a=Md(t.id),n=`ðŸ™ Support "${t.title}" on Backcoin Charity!

${Be(t.raisedAmount)} raised of ${Be(t.goalAmount)} goal.

`;let i;e==="twitter"?i=`https://twitter.com/intent/tweet?text=${encodeURIComponent(n)}&url=${encodeURIComponent(a)}`:e==="telegram"?i=`https://t.me/share/url?url=${encodeURIComponent(a)}&text=${encodeURIComponent(n)}`:e==="whatsapp"&&(i=`https://wa.me/?text=${encodeURIComponent(n+a)}`),i&&window.open(i,"_blank","width=600,height=400")}function Ug(){const e=E.currentCampaign;e&&navigator.clipboard.writeText(Md(e.id)).then(()=>h("Link copied!","success")).catch(()=>h("Copy failed","error"))}function Vd(){og(),E.currentCampaign=null,E.currentView="main",We()}function jg(e){ft("my"),ft("donate"),ft("edit"),sg(e),Gt(e)}function Wg(e){E.selectedCategory=E.selectedCategory===e?null:e,Dr()}function Gg(){E.selectedCategory=null,Dr()}function Dr(){const e=document.getElementById("cp-grid");if(!e)return;let t=E.campaigns.filter(a=>Lr(a));E.selectedCategory&&(t=t.filter(a=>a.category===E.selectedCategory)),t.sort((a,n)=>Number(n.createdAt||0)-Number(a.createdAt||0)),e.innerHTML=t.length?t.map(a=>Gd(a)).join(""):Wd("No campaigns")}async function Gt(e){E.currentView="detail",E.isLoading=!0;const t=Hi();t&&(t.innerHTML=pg());try{let a=E.campaigns.find(n=>n.id===e||n.id===String(e));if(!a){const n=d==null?void 0:d.publicProvider;if(n){const r=await new Wt.Contract(w.charityPool,Rr,n).getCampaign(e),s=Ud(e);a={id:String(e),creator:r.creator||r[0],title:r.title||r[1]||`Campaign #${e}`,description:r.description||r[2]||"",goalAmount:BigInt((r.goalAmount||r[3]).toString()),raisedAmount:BigInt((r.raisedAmount||r[4]).toString()),donationCount:Number(r.donationCount||r[5]),deadline:Number(r.deadline||r[6]),createdAt:Number(r.createdAt||r[7]),status:Number(r.status||r[10]),category:(s==null?void 0:s.category)||"humanitarian",imageUrl:(s==null?void 0:s.imageUrl)||null}}}E.currentCampaign=a,t&&(t.innerHTML=Ds(a))}catch{t&&(t.innerHTML=Ds(null))}finally{E.isLoading=!1}}function Hi(){let e=document.getElementById("charity-container");if(e)return e;const t=document.getElementById("charity");return t?(e=document.createElement("div"),e.id="charity-container",t.innerHTML="",t.appendChild(e),e):null}function We(){rg();const e=Hi();if(!e)return;if(E.currentView==="create"){e.innerHTML=fg(),tn();return}const t=Dd();t?Gt(t):(E.currentView="main",E.currentCampaign=null,e.innerHTML=Ms(),yt().then(()=>{if(E.currentView==="main"){const a=Hi();a&&(a.innerHTML=Ms())}}))}async function Kg(){E.campaigns=[],E.stats=null,E.currentView==="detail"&&E.currentCampaign?await Gt(E.currentCampaign.id):We()}window.addEventListener("hashchange",()=>{var e;if(window.location.hash.startsWith("#charity")){const t=Dd();t?((e=E.currentCampaign)==null?void 0:e.id)!==t&&Gt(t):E.currentView!=="main"&&Vd()}});const qd={render(e){e&&We()},update(){E.currentView==="main"&&Dr()},refresh:Kg,openModal:Vn,closeModal:ft,openCreate:zg,openDonate:Pg,openMyCampaigns:Ng,openEdit:$g,create:Rg,donate:_g,donateDetail:Fg,cancel:Mg,withdraw:Dg,saveEdit:Og,selCatOpt:Sg,setAmt:Lg,goBack:Vd,viewCampaign:jg,selectCat:Wg,clearCat:Gg,share:Hg,copyLink:Ug,handleImageSelect:cg,removeImage:dg,switchImageTab:ug,wizardSelectCategory:wg,wizardNext:yg,wizardBack:kg,wizardSkipImage:Eg,cancelCreate:Yd,wizardUpdateCharCount:Cg,handleWizardImageSelect:Ig,removeWizardImage:Ag,wizardLaunch:Bg};window.CharityPage=qd;const Lt=window.ethers,Xd="https://sepolia.arbiscan.io/address/",Yg=yu,bt=500;function Jd(){return w.backchat||w.Backchat||null}function ot(){return w.operator||w.treasury||null}const g={view:"feed",activeTab:"feed",viewHistory:[],posts:[],trendingPosts:[],allItems:[],replies:new Map,likesMap:new Map,replyCountMap:new Map,repostCountMap:new Map,postsById:new Map,userProfile:null,profiles:new Map,hasProfile:null,following:new Set,followers:new Set,followCounts:new Map,pendingImage:null,pendingImagePreview:null,isUploadingImage:!1,selectedPost:null,selectedProfile:null,wizStep:1,wizUsername:"",wizDisplayName:"",wizBio:"",wizUsernameOk:null,wizFee:null,wizChecking:!1,fees:{post:0n,reply:0n,like:0n,follow:0n,repost:0n,superLikeMin:0n,boostMin:0n,badge:0n},pendingEth:0n,hasBadge:!1,isBoosted:!1,boostExpiry:0,badgeExpiry:0,referralStats:null,referredBy:null,isLoading:!1,isPosting:!1,contractAvailable:!0,error:null};function Vg(){if(document.getElementById("backchat-styles-v70"))return;const e=document.getElementById("backchat-styles-v69");e&&e.remove();const t=document.createElement("style");t.id="backchat-styles-v70",t.textContent=`
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           V7.0 Backchat â€” Decentralized Social Network
           Professional UI aligned with Backchain system design
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        :root {
            --bc-bg:        #0c0c0e;
            --bc-bg2:       #141417;
            --bc-bg3:       #1c1c21;
            --bc-surface:   #222228;
            --bc-border:    rgba(255,255,255,0.06);
            --bc-border-h:  rgba(255,255,255,0.1);
            --bc-text:      #f0f0f2;
            --bc-text-2:    #a0a0ab;
            --bc-text-3:    #5c5c68;
            --bc-accent:    #f59e0b;
            --bc-accent-2:  #d97706;
            --bc-accent-glow: rgba(245,158,11,0.15);
            --bc-red:       #ef4444;
            --bc-green:     #22c55e;
            --bc-blue:      #3b82f6;
            --bc-purple:    #8b5cf6;
            --bc-radius:    14px;
            --bc-radius-sm: 10px;
            --bc-radius-lg: 20px;
            --bc-transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Animations */
        @keyframes bc-fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes bc-scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to   { opacity: 1; transform: scale(1); }
        }
        @keyframes bc-spin {
            to { transform: rotate(360deg); }
        }
        @keyframes bc-shimmer {
            0%   { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        @keyframes bc-like-pop {
            0%   { transform: scale(1); }
            40%  { transform: scale(1.35); }
            100% { transform: scale(1); }
        }
        @keyframes bc-pulse-ring {
            0%   { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); }
            70%  { box-shadow: 0 0 0 8px rgba(245,158,11,0); }
            100% { box-shadow: 0 0 0 0 rgba(245,158,11,0); }
        }
        
        /* â”€â”€â”€ Layout â”€â”€â”€ */
        .bc-shell {
            max-width: 640px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--bc-bg);
            position: relative;
        }
        
        /* â”€â”€â”€ Header â”€â”€â”€ */
        .bc-header {
            position: sticky;
            top: 0;
            z-index: 200;
            background: rgba(12,12,14,0.82);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border-bottom: 1px solid var(--bc-border);
        }
        
        .bc-header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
        }
        
        .bc-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bc-brand-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            object-fit: contain;
        }
        
        .bc-brand-name {
            font-size: 19px;
            font-weight: 800;
            letter-spacing: -0.3px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .bc-header-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .bc-icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--bc-border);
            color: var(--bc-text-2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all var(--bc-transition);
            position: relative;
        }
        .bc-icon-btn:hover {
            background: var(--bc-bg3);
            border-color: var(--bc-border-h);
            color: var(--bc-text);
        }
        .bc-icon-btn.earnings-btn {
            border-color: rgba(34,197,94,0.3);
            color: var(--bc-green);
        }
        .bc-icon-btn.earnings-btn:hover {
            background: rgba(34,197,94,0.1);
        }
        
        /* â”€â”€â”€ Tabs â”€â”€â”€ */
        .bc-nav {
            display: flex;
            padding: 0 20px;
        }
        
        .bc-nav-item {
            flex: 1;
            padding: 12px 0;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--bc-text-3);
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: all var(--bc-transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 7px;
        }
        .bc-nav-item:hover {
            color: var(--bc-text-2);
        }
        .bc-nav-item.active {
            color: var(--bc-accent);
            border-bottom-color: var(--bc-accent);
        }
        .bc-nav-item i {
            font-size: 14px;
        }
        
        /* â”€â”€â”€ Compose â”€â”€â”€ */
        .bc-compose {
            padding: 20px;
            border-bottom: 1px solid var(--bc-border);
            background: var(--bc-bg2);
        }
        
        .bc-compose-row {
            display: flex;
            gap: 14px;
        }
        
        .bc-compose-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bc-accent), #fbbf24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #000;
            font-size: 15px;
            flex-shrink: 0;
        }
        
        .bc-compose-body {
            flex: 1;
            min-width: 0;
        }
        
        .bc-compose-textarea {
            width: 100%;
            min-height: 72px;
            max-height: 240px;
            background: transparent;
            border: none;
            color: var(--bc-text);
            font-size: 16px;
            line-height: 1.5;
            resize: none;
            outline: none;
            font-family: inherit;
        }
        .bc-compose-textarea::placeholder {
            color: var(--bc-text-3);
        }
        
        .bc-compose-divider {
            height: 1px;
            background: var(--bc-border);
            margin: 12px 0;
        }
        
        .bc-compose-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .bc-compose-tools {
            display: flex;
            gap: 4px;
        }
        
        .bc-compose-tool {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: none;
            border: none;
            color: var(--bc-accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            transition: background var(--bc-transition);
        }
        .bc-compose-tool:hover:not(:disabled) {
            background: var(--bc-accent-glow);
        }
        .bc-compose-tool:disabled {
            color: var(--bc-text-3);
            cursor: not-allowed;
        }
        
        .bc-compose-right {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        
        .bc-char-count {
            font-size: 12px;
            color: var(--bc-text-3);
            font-variant-numeric: tabular-nums;
        }
        .bc-char-count.warn { color: var(--bc-accent); }
        .bc-char-count.danger { color: var(--bc-red); }
        
        .bc-compose-fee {
            font-size: 11px;
            color: var(--bc-text-3);
            background: var(--bc-bg3);
            padding: 4px 10px;
            border-radius: 20px;
        }
        
        .bc-post-btn {
            padding: 9px 22px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: none;
            border-radius: 24px;
            color: #000;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all var(--bc-transition);
            letter-spacing: 0.01em;
        }
        .bc-post-btn:hover:not(:disabled) {
            box-shadow: 0 4px 20px rgba(245,158,11,0.35);
            transform: translateY(-1px);
        }
        .bc-post-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* â”€â”€â”€ Post Card â”€â”€â”€ */
        .bc-post {
            padding: 18px 20px;
            border-bottom: 1px solid var(--bc-border);
            transition: background var(--bc-transition);
            animation: bc-fadeIn 0.35s ease-out both;
        }
        .bc-post:hover {
            background: rgba(255,255,255,0.015);
        }
        
        .bc-post-top {
            display: flex;
            gap: 12px;
        }
        
        .bc-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bc-accent) 0%, #fbbf24 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #000;
            font-size: 15px;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform var(--bc-transition);
        }
        .bc-avatar:hover {
            transform: scale(1.06);
        }
        .bc-avatar.boosted {
            box-shadow: 0 0 0 2.5px var(--bc-bg), 0 0 0 4.5px var(--bc-accent);
            animation: bc-pulse-ring 2s infinite;
        }
        
        .bc-post-head {
            flex: 1;
            min-width: 0;
        }
        
        .bc-post-author-row {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .bc-author-name {
            font-weight: 700;
            color: var(--bc-text);
            font-size: 15px;
            cursor: pointer;
            transition: color var(--bc-transition);
        }
        .bc-author-name:hover {
            color: var(--bc-accent);
        }
        
        .bc-verified-icon {
            color: var(--bc-accent);
            font-size: 13px;
        }
        
        .bc-post-time {
            color: var(--bc-text-3);
            font-size: 13px;
        }
        
        .bc-post-context {
            color: var(--bc-text-3);
            font-size: 13px;
            margin-top: 1px;
        }
        
        .bc-trending-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 9px;
            background: var(--bc-accent-glow);
            border: 1px solid rgba(245,158,11,0.2);
            border-radius: 20px;
            color: var(--bc-accent);
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.02em;
        }
        .bc-trending-tag i { font-size: 9px; }
        
        .bc-post-body {
            margin-top: 10px;
            margin-left: 56px;
            color: var(--bc-text);
            font-size: 15px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .bc-post-media {
            margin-top: 14px;
            margin-left: 56px;
            border-radius: var(--bc-radius);
            overflow: hidden;
            border: 1px solid var(--bc-border);
        }
        .bc-post-media img {
            width: 100%;
            max-height: 420px;
            object-fit: cover;
            display: block;
        }
        
        /* â”€â”€â”€ Engagement Bar â”€â”€â”€ */
        .bc-actions {
            display: flex;
            gap: 2px;
            margin-top: 12px;
            margin-left: 56px;
            max-width: 420px;
            justify-content: space-between;
        }
        
        .bc-action {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 7px 12px;
            background: none;
            border: none;
            border-radius: 24px;
            color: var(--bc-text-3);
            font-size: 13px;
            cursor: pointer;
            transition: all var(--bc-transition);
        }
        .bc-action i { font-size: 15px; transition: transform 0.2s; }
        
        .bc-action.act-reply:hover    { color: var(--bc-blue);   background: rgba(59,130,246,0.08); }
        .bc-action.act-repost:hover   { color: var(--bc-green);  background: rgba(34,197,94,0.08); }
        .bc-action.act-like:hover     { color: var(--bc-red);    background: rgba(239,68,68,0.08); }
        .bc-action.act-like:hover i   { transform: scale(1.2); }
        .bc-action.act-like.liked     { color: var(--bc-red); }
        .bc-action.act-like.liked i   { animation: bc-like-pop 0.3s ease-out; }
        .bc-action.act-super:hover    { color: var(--bc-accent); background: var(--bc-accent-glow); }
        .bc-action.act-super:hover i  { transform: scale(1.2) rotate(15deg); }
        .bc-action.act-tip:hover      { color: var(--bc-purple); background: rgba(139,92,246,0.08); }
        
        /* â”€â”€â”€ Profile â”€â”€â”€ */
        .bc-profile-section {
            animation: bc-fadeIn 0.4s ease-out;
        }
        
        .bc-profile-banner {
            height: 120px;
            background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(217,119,6,0.08), rgba(12,12,14,0));
            position: relative;
        }
        
        .bc-profile-main {
            padding: 0 20px 20px;
            margin-top: -40px;
            position: relative;
        }
        
        .bc-profile-top-row {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .bc-profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bc-accent), #fbbf24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: #000;
            border: 4px solid var(--bc-bg);
        }
        .bc-profile-pic.boosted {
            box-shadow: 0 0 0 3px var(--bc-bg), 0 0 0 5px var(--bc-accent);
        }
        
        .bc-profile-actions {
            display: flex;
            gap: 8px;
            padding-bottom: 6px;
        }
        
        .bc-profile-name-row {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .bc-profile-name {
            font-size: 22px;
            font-weight: 800;
            color: var(--bc-text);
            letter-spacing: -0.3px;
        }
        
        .bc-profile-badge {
            color: var(--bc-accent);
            font-size: 16px;
        }
        
        .bc-boosted-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            background: var(--bc-accent-glow);
            border: 1px solid rgba(245,158,11,0.2);
            border-radius: 20px;
            color: var(--bc-accent);
            font-size: 11px;
            font-weight: 700;
        }
        
        .bc-profile-handle {
            margin-top: 4px;
        }
        .bc-profile-handle a {
            color: var(--bc-text-3);
            text-decoration: none;
            font-size: 13px;
            transition: color var(--bc-transition);
        }
        .bc-profile-handle a:hover { color: var(--bc-accent); }
        .bc-profile-handle a i { font-size: 10px; margin-left: 4px; }
        
        .bc-profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
            gap: 1px;
            margin-top: 20px;
            background: var(--bc-border);
            border-radius: var(--bc-radius);
            overflow: hidden;
        }
        
        .bc-stat-cell {
            background: var(--bc-bg2);
            padding: 16px 12px;
            text-align: center;
        }
        .bc-stat-cell:first-child { border-radius: var(--bc-radius) 0 0 var(--bc-radius); }
        .bc-stat-cell:last-child  { border-radius: 0 var(--bc-radius) var(--bc-radius) 0; }
        
        .bc-stat-value {
            font-size: 20px;
            font-weight: 800;
            color: var(--bc-text);
        }
        .bc-stat-label {
            font-size: 12px;
            color: var(--bc-text-3);
            margin-top: 2px;
            font-weight: 500;
        }
        
        /* â”€â”€â”€ Earnings â”€â”€â”€ */
        .bc-earnings-card {
            margin: 20px;
            padding: 20px;
            background: linear-gradient(145deg, rgba(34,197,94,0.1), rgba(16,185,129,0.05));
            border: 1px solid rgba(34,197,94,0.2);
            border-radius: var(--bc-radius-lg);
            animation: bc-fadeIn 0.4s ease-out 0.1s both;
        }
        
        .bc-earnings-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--bc-green);
            margin-bottom: 12px;
        }
        
        .bc-earnings-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--bc-text);
            letter-spacing: -0.5px;
        }
        .bc-earnings-value small {
            font-size: 16px;
            color: var(--bc-text-3);
            font-weight: 600;
        }
        
        /* â”€â”€â”€ Referral Card (V8) â”€â”€â”€ */
        .bc-referral-card {
            margin: 20px;
            padding: 20px;
            background: linear-gradient(145deg, rgba(139,92,246,0.1), rgba(59,130,246,0.05));
            border: 1px solid rgba(139,92,246,0.2);
            border-radius: var(--bc-radius-lg);
            animation: bc-fadeIn 0.4s ease-out 0.15s both;
        }
        .bc-referral-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--bc-purple);
            margin-bottom: 16px;
        }
        .bc-referral-link-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bc-bg);
            border: 1px solid var(--bc-border);
            border-radius: var(--bc-radius-sm);
            padding: 10px 12px;
            margin-bottom: 16px;
        }
        .bc-referral-link-text {
            flex: 1;
            font-size: 12px;
            color: var(--bc-text-2);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: monospace;
        }
        .bc-referral-link-box button {
            flex-shrink: 0;
            background: var(--bc-surface);
            border: 1px solid var(--bc-border);
            color: var(--bc-text);
            padding: 6px 12px;
            border-radius: var(--bc-radius-sm);
            font-size: 12px;
            cursor: pointer;
            transition: all var(--bc-transition);
        }
        .bc-referral-link-box button:hover {
            background: var(--bc-accent);
            color: #000;
            border-color: var(--bc-accent);
        }
        .bc-referral-stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }
        .bc-referral-stat {
            background: var(--bc-bg2);
            border-radius: var(--bc-radius-sm);
            padding: 12px;
            text-align: center;
        }
        .bc-referral-stat-value {
            font-size: 22px;
            font-weight: 800;
            color: var(--bc-text);
        }
        .bc-referral-stat-label {
            font-size: 11px;
            color: var(--bc-text-3);
            margin-top: 2px;
        }
        .bc-referral-info {
            font-size: 12px;
            color: var(--bc-text-3);
            line-height: 1.5;
            text-align: center;
        }

        /* â”€â”€â”€ Section Header â”€â”€â”€ */
        .bc-section-head {
            padding: 16px 20px;
            border-bottom: 1px solid var(--bc-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .bc-section-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--bc-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .bc-section-title i {
            color: var(--bc-accent);
            font-size: 14px;
        }
        
        .bc-section-subtitle {
            font-size: 13px;
            color: var(--bc-text-3);
        }
        
        /* â”€â”€â”€ Trending Header â”€â”€â”€ */
        .bc-trending-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--bc-border);
            background: linear-gradient(180deg, rgba(245,158,11,0.06), transparent);
        }
        .bc-trending-header h2 {
            font-size: 18px;
            font-weight: 800;
            color: var(--bc-text);
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }
        .bc-trending-header h2 i { color: var(--bc-accent); }
        .bc-trending-header p {
            margin: 4px 0 0;
            font-size: 13px;
            color: var(--bc-text-3);
        }
        
        /* â”€â”€â”€ Buttons â”€â”€â”€ */
        .bc-btn {
            padding: 9px 18px;
            border-radius: 24px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all var(--bc-transition);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            letter-spacing: 0.01em;
        }
        
        .bc-btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #000;
        }
        .bc-btn-primary:hover {
            box-shadow: 0 4px 16px rgba(245,158,11,0.3);
            transform: translateY(-1px);
        }
        
        .bc-btn-outline {
            background: transparent;
            border: 1px solid var(--bc-border-h);
            color: var(--bc-text);
        }
        .bc-btn-outline:hover {
            background: var(--bc-bg3);
            border-color: rgba(255,255,255,0.15);
        }
        
        .bc-btn-follow {
            background: var(--bc-text);
            color: var(--bc-bg);
        }
        .bc-btn-follow:hover { opacity: 0.9; }
        
        /* â”€â”€â”€ Empty State â”€â”€â”€ */
        .bc-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 72px 24px;
            text-align: center;
            animation: bc-fadeIn 0.5s ease-out;
        }
        
        .bc-empty-glyph {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--bc-bg3);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .bc-empty-glyph i {
            font-size: 28px;
            color: var(--bc-text-3);
        }
        .bc-empty-glyph.accent {
            background: var(--bc-accent-glow);
        }
        .bc-empty-glyph.accent i {
            color: var(--bc-accent);
        }
        
        .bc-empty-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--bc-text);
            margin-bottom: 8px;
        }
        
        .bc-empty-text {
            color: var(--bc-text-3);
            font-size: 14px;
            max-width: 280px;
            line-height: 1.5;
        }
        
        /* â”€â”€â”€ Loading â”€â”€â”€ */
        .bc-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 56px;
            gap: 16px;
        }
        
        .bc-spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--bc-bg3);
            border-top-color: var(--bc-accent);
            border-radius: 50%;
            animation: bc-spin 0.8s linear infinite;
        }
        
        .bc-loading-text {
            font-size: 13px;
            color: var(--bc-text-3);
        }
        
        /* â”€â”€â”€ Modal â”€â”€â”€ */
        .bc-modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(0,0,0,0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .bc-modal-overlay.active {
            display: flex;
        }
        
        .bc-modal-box {
            background: var(--bc-bg2);
            border: 1px solid var(--bc-border-h);
            border-radius: var(--bc-radius-lg);
            width: 100%;
            max-width: 440px;
            max-height: 90vh;
            overflow-y: auto;
            animation: bc-scaleIn 0.25s ease-out;
        }
        
        .bc-modal-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 20px;
            border-bottom: 1px solid var(--bc-border);
        }
        
        .bc-modal-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--bc-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .bc-modal-x {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bc-bg3);
            border: none;
            color: var(--bc-text-2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all var(--bc-transition);
        }
        .bc-modal-x:hover {
            background: var(--bc-surface);
            color: var(--bc-text);
        }
        
        .bc-modal-inner {
            padding: 20px;
        }
        
        .bc-modal-desc {
            color: var(--bc-text-2);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        /* â”€â”€â”€ Form Fields â”€â”€â”€ */
        .bc-field {
            margin-bottom: 18px;
        }
        
        .bc-label {
            display: block;
            margin-bottom: 8px;
            color: var(--bc-text-2);
            font-size: 13px;
            font-weight: 600;
        }
        
        .bc-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bc-bg3);
            border: 1px solid var(--bc-border-h);
            border-radius: var(--bc-radius-sm);
            color: var(--bc-text);
            font-size: 15px;
            outline: none;
            transition: border-color var(--bc-transition);
            font-family: inherit;
        }
        .bc-input:focus {
            border-color: rgba(245,158,11,0.5);
        }
        
        .bc-fee-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--bc-accent-glow);
            border: 1px solid rgba(245,158,11,0.15);
            border-radius: var(--bc-radius-sm);
        }
        
        .bc-fee-label {
            font-size: 13px;
            color: var(--bc-accent);
            font-weight: 500;
        }
        
        .bc-fee-val {
            font-size: 14px;
            font-weight: 700;
            color: var(--bc-text);
        }
        
        /* â”€â”€â”€ Back Header â”€â”€â”€ */
        .bc-back-header { display:flex; align-items:center; gap:12px; padding:14px 20px; }
        .bc-back-btn { width:34px; height:34px; border-radius:50%; background:transparent; border:1px solid var(--bc-border); color:var(--bc-text); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; transition:all var(--bc-transition); }
        .bc-back-btn:hover { background:var(--bc-bg3); border-color:var(--bc-border-h); }
        .bc-back-title { font-size:17px; font-weight:700; color:var(--bc-text); }

        /* â”€â”€â”€ Profile Wizard â”€â”€â”€ */
        .bc-wizard { padding:24px 20px; animation:bc-fadeIn 0.4s ease-out; }
        .bc-wizard-title { font-size:22px; font-weight:800; color:var(--bc-text); margin-bottom:6px; }
        .bc-wizard-desc { font-size:14px; color:var(--bc-text-3); margin-bottom:24px; line-height:1.5; }
        .bc-wizard-dots { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:28px; }
        .bc-wizard-dot { width:10px; height:10px; border-radius:50%; background:var(--bc-bg3); transition:all var(--bc-transition); }
        .bc-wizard-dot.active { background:var(--bc-accent); width:28px; border-radius:10px; }
        .bc-wizard-dot.done { background:var(--bc-green); }
        .bc-wizard-card { background:var(--bc-bg2); border:1px solid var(--bc-border); border-radius:var(--bc-radius-lg); padding:24px; margin-bottom:20px; }
        .bc-username-row { display:flex; align-items:center; gap:8px; margin-top:8px; min-height:24px; }
        .bc-username-ok { color:var(--bc-green); font-size:13px; display:flex; align-items:center; gap:4px; }
        .bc-username-taken { color:var(--bc-red); font-size:13px; display:flex; align-items:center; gap:4px; }
        .bc-username-checking { color:var(--bc-text-3); font-size:13px; }
        .bc-username-fee { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.15); border-radius:20px; color:var(--bc-accent); font-size:12px; font-weight:600; margin-left:8px; }
        .bc-wizard-nav { display:flex; gap:12px; margin-top:20px; }
        .bc-wizard-nav .bc-btn { flex:1; justify-content:center; }

        /* â”€â”€â”€ Thread View â”€â”€â”€ */
        .bc-thread-parent { border-bottom:1px solid var(--bc-border); }
        .bc-thread-divider { padding:12px 20px; font-size:13px; font-weight:700; color:var(--bc-text-2); border-bottom:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-thread-reply { position:relative; padding-left:36px; }
        .bc-thread-reply::before { content:''; position:absolute; left:40px; top:0; bottom:0; width:2px; background:var(--bc-border); }
        .bc-thread-reply:last-child::before { bottom:50%; }
        .bc-reply-compose { padding:16px 20px; border-top:1px solid var(--bc-border); background:var(--bc-bg2); }
        .bc-reply-label { font-size:13px; color:var(--bc-text-3); margin-bottom:8px; }
        .bc-reply-row { display:flex; gap:12px; align-items:flex-start; }
        .bc-reply-input { flex:1; min-height:48px; max-height:160px; background:var(--bc-bg3); border:1px solid var(--bc-border-h); border-radius:var(--bc-radius-sm); color:var(--bc-text); font-size:14px; padding:10px 14px; resize:none; outline:none; font-family:inherit; }
        .bc-reply-input:focus { border-color:rgba(245,158,11,0.5); }
        .bc-reply-send { padding:10px 18px; }

        /* â”€â”€â”€ Repost Banner â”€â”€â”€ */
        .bc-repost-banner { display:flex; align-items:center; gap:6px; padding:8px 20px 0 68px; font-size:13px; color:var(--bc-green); font-weight:600; }
        .bc-repost-banner i { font-size:12px; }

        /* â”€â”€â”€ Image Upload â”€â”€â”€ */
        .bc-image-preview { position:relative; margin-top:12px; border-radius:var(--bc-radius); overflow:hidden; border:1px solid var(--bc-border); max-height:200px; }
        .bc-image-preview img { width:100%; max-height:200px; object-fit:cover; display:block; }
        .bc-image-remove { position:absolute; top:8px; right:8px; width:28px; height:28px; border-radius:50%; background:rgba(0,0,0,0.7); border:none; color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:14px; }
        .bc-image-remove:hover { background:var(--bc-red); }
        .bc-uploading-badge { display:inline-flex; align-items:center; gap:6px; padding:4px 12px; background:rgba(245,158,11,0.1); border:1px solid rgba(245,158,11,0.2); border-radius:20px; color:var(--bc-accent); font-size:12px; margin-top:8px; }

        /* â”€â”€â”€ User Profile Page â”€â”€â”€ */
        .bc-profile-bio { margin-top:8px; font-size:14px; color:var(--bc-text-2); line-height:1.5; }
        .bc-profile-username { color:var(--bc-text-3); font-size:14px; margin-top:2px; }
        .bc-follow-toggle { padding:8px 20px; border-radius:24px; font-weight:700; font-size:13px; cursor:pointer; transition:all var(--bc-transition); border:none; }
        .bc-follow-toggle.do-follow { background:var(--bc-text); color:var(--bc-bg); }
        .bc-follow-toggle.do-follow:hover { opacity:0.9; }
        .bc-follow-toggle.do-unfollow { background:transparent; border:1px solid var(--bc-border-h); color:var(--bc-text); }
        .bc-follow-toggle.do-unfollow:hover { border-color:var(--bc-red); color:var(--bc-red); background:rgba(239,68,68,0.08); }
        .bc-profile-create-banner { margin:16px 20px; padding:16px; background:var(--bc-accent-glow); border:1px solid rgba(245,158,11,0.2); border-radius:var(--bc-radius); text-align:center; animation:bc-fadeIn 0.4s ease-out; }
        .bc-profile-create-banner p { font-size:13px; color:var(--bc-text-2); margin-bottom:12px; }

        /* â”€â”€â”€ Engagement Count â”€â”€â”€ */
        .bc-action .count { font-variant-numeric:tabular-nums; }

        /* â”€â”€â”€ Responsive â”€â”€â”€ */
        @media (max-width: 640px) {
            .bc-shell {
                max-width: 100%;
            }
            .bc-actions {
                margin-left: 0;
                margin-top: 14px;
            }
            .bc-post-body {
                margin-left: 0;
                margin-top: 12px;
            }
            .bc-post-media {
                margin-left: 0;
            }
            .bc-compose-avatar {
                display: none;
            }
        }
    `,document.head.appendChild(t)}function Ua(e){return e?`${e.slice(0,6)}...${e.slice(-4)}`:""}function qg(e){const a=Date.now()/1e3-e;return a<60?"now":a<3600?`${Math.floor(a/60)}m`:a<86400?`${Math.floor(a/3600)}h`:a<604800?`${Math.floor(a/86400)}d`:new Date(e*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function it(e){if(!e||e===0n)return"0";const t=parseFloat(Lt.formatEther(e));return t<1e-4?"<0.0001":t<.01?t.toFixed(4):t<1?t.toFixed(3):t.toFixed(2)}function qn(e){return e?e.slice(2,4).toUpperCase():"?"}function He(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Pa(e){if(!e)return"?";const t=g.profiles.get(e.toLowerCase());return t!=null&&t.displayName?t.displayName:t!=null&&t.username?`@${t.username}`:Ua(e)}function Xg(e){if(!e)return null;const t=g.profiles.get(e.toLowerCase());return(t==null?void 0:t.username)||null}function Jg(e){var t;return(e==null?void 0:e.toLowerCase())===((t=d.userAddress)==null?void 0:t.toLowerCase())?g.isBoosted:!1}function Zg(e){var t;return(e==null?void 0:e.toLowerCase())===((t=d.userAddress)==null?void 0:t.toLowerCase())?g.hasBadge:!1}function bn(e,t){g.viewHistory.push({view:g.view,activeTab:g.activeTab,selectedPost:g.selectedPost,selectedProfile:g.selectedProfile}),g.view=e,t!=null&&t.post&&(g.selectedPost=t.post),t!=null&&t.profile&&(g.selectedProfile=t.profile),mt()}function Qg(){if(g.viewHistory.length>0){const e=g.viewHistory.pop();g.view=e.view,g.activeTab=e.activeTab||g.view,g.selectedPost=e.selectedPost,g.selectedProfile=e.selectedProfile}else g.view="feed",g.activeTab="feed";mt()}function an(){if(d.backchatContract)return d.backchatContract;if(d.backchatContractPublic)return d.backchatContractPublic;const e=Jd();return e?d.publicProvider?new Lt.Contract(e,Zs,d.publicProvider):null:(console.warn("Backchat address not found in deployment-addresses.json"),null)}async function Os(){try{const e=an();if(!e)return;const t=await e.getCurrentFees(),a=async n=>{var i;try{const r=(i=e.runner)==null?void 0:i.provider;if(r){const s=await r.getFeeData(),o=s.gasPrice||s.maxFeePerGas||100000000n,l=await e.calculateFee(n,{gasPrice:o});if(l&&l>0n)return l}}catch{}return window.ethers.parseEther("0.0001")};g.fees={post:t.postFee||await a(1e5),reply:t.replyFee||await a(12e4),like:t.likeFee||await a(55e3),follow:t.followFee||await a(45e3),repost:t.repostFee||await a(8e4),superLikeMin:t.superLikeMin||await a(6e4),boostMin:t.boostMin||await a(5e4),badge:t.badgeFee_||await a(2e5)}}catch(e){console.warn("Failed to load fees:",e.message)}}async function Hs(){if(!(!d.isConnected||!d.userAddress)){try{const e=an();if(!e)return;const[t,a,n,i,r,s,o]=await Promise.all([e.getPendingBalance(d.userAddress).catch(()=>0n),e.hasTrustBadge(d.userAddress).catch(()=>!1),e.isProfileBoosted(d.userAddress).catch(()=>!1),e.boostExpiry(d.userAddress).catch(()=>0),e.badgeExpiry(d.userAddress).catch(()=>0),e.referredBy(d.userAddress).catch(()=>Lt.ZeroAddress),e.getReferralStats(d.userAddress).catch(()=>({totalReferred:0n,totalEarned:0n}))]);g.pendingEth=t,g.hasBadge=a,g.isBoosted=n,g.boostExpiry=Number(i),g.badgeExpiry=Number(r),g.referredBy=s&&s!==Lt.ZeroAddress?s:null,g.referralStats={totalReferred:Number(o.totalReferred),totalEarned:o.totalEarned,totalEarnedFormatted:Lt.formatEther(o.totalEarned)}}catch(e){console.warn("Failed to load user status:",e.message)}await ex()}}async function Us(){try{const e=an();if(!e){g.hasProfile=!1;return}const[t,a]=await Promise.all([e.queryFilter(e.filters.ProfileCreated(),-1e5).catch(()=>[]),e.queryFilter(e.filters.ProfileUpdated(),-1e5).catch(()=>[])]);for(const n of t){const i=n.args.user.toLowerCase();g.profiles.set(i,{username:n.args.username,displayName:n.args.displayName||"",bio:n.args.bio||""})}for(const n of a){const i=n.args.user.toLowerCase(),r=g.profiles.get(i);r&&(r.displayName=n.args.displayName||r.displayName,r.bio=n.args.bio||r.bio)}if(d.isConnected&&d.userAddress){const n=d.userAddress.toLowerCase(),i=g.profiles.get(n);i?(g.userProfile={...i,address:d.userAddress},g.hasProfile=!0):(g.hasProfile=!1,g.userProfile=null)}else g.hasProfile=!1;console.log("[Backchat] Profiles loaded:",g.profiles.size,"| hasProfile:",g.hasProfile)}catch(e){console.warn("Failed to load profiles:",e.message),g.hasProfile=!1}ie()}async function js(){var e;if(!(!d.isConnected||!d.userAddress))try{const t=an();if(!t)return;const[a,n]=await Promise.all([t.queryFilter(t.filters.Followed(),-1e5).catch(()=>[]),t.queryFilter(t.filters.Unfollowed(),-1e5).catch(()=>[])]),i=new Map;for(const s of a){const o=s.args.follower.toLowerCase(),l=s.args.followed.toLowerCase();i.has(o)||i.set(o,new Set),i.get(o).add(l)}for(const s of n){const o=s.args.follower.toLowerCase(),l=s.args.followed.toLowerCase();(e=i.get(o))==null||e.delete(l)}const r=d.userAddress.toLowerCase();g.following=i.get(r)||new Set,g.followers=new Set;for(const[s,o]of i)o.has(r)&&g.followers.add(s);g.followCounts=new Map;for(const[s,o]of i){for(const l of o)g.followCounts.has(l)||g.followCounts.set(l,{followers:0,following:0}),g.followCounts.get(l).followers++;g.followCounts.has(s)||g.followCounts.set(s,{followers:0,following:0}),g.followCounts.get(s).following=o.size}}catch(t){console.warn("Failed to load social graph:",t.message)}}async function ex(){var e,t;try{if(!d.isConnected||!d.userAddress||g.referredBy)return;const a=localStorage.getItem("backchain_referrer");if(!a)return;if(a.toLowerCase()===d.userAddress.toLowerCase()){localStorage.removeItem("backchain_referrer");return}const n=getSignedContract();if(!n)return;console.log("[Referral] Auto-setting referrer:",a);const i=await n.setReferrer(a);h("Setting your referrer...","info"),await i.wait(),g.referredBy=a,localStorage.removeItem("backchain_referrer"),h("Referrer registered! They earn 30% of your fees.","success"),ie()}catch(a){console.warn("[Referral] Auto-set failed:",a.message),((e=a.message)!=null&&e.includes("ReferrerAlreadySet")||(t=a.message)!=null&&t.includes("already set"))&&localStorage.removeItem("backchain_referrer")}}async function ra(){g.isLoading=!0,ie();try{if(!Jd()){g.contractAvailable=!1,g.error="Backchat contract not deployed yet.";return}const t=an();if(!t){g.contractAvailable=!1,g.error="Could not connect to Backchat contract";return}g.contractAvailable=!0;const[a,n,i,r,s]=await Promise.all([t.queryFilter(t.filters.PostCreated(),-1e5).catch(()=>[]),t.queryFilter(t.filters.ReplyCreated(),-1e5).catch(()=>[]),t.queryFilter(t.filters.RepostCreated(),-1e5).catch(()=>[]),t.queryFilter(t.filters.Liked(),-1e5).catch(()=>[]),t.queryFilter(t.filters.SuperLiked(),-1e5).catch(()=>[])]);g.likesMap=new Map;for(const u of r){const f=u.args.postId.toString();g.likesMap.has(f)||g.likesMap.set(f,new Set),g.likesMap.get(f).add(u.args.user.toLowerCase())}const o=new Map;for(const u of s){const f=u.args.postId.toString();o.set(f,(o.get(f)||0n)+u.args.ethAmount)}const l=[],c=[];g.postsById=new Map,g.replies=new Map,g.replyCountMap=new Map,g.repostCountMap=new Map;for(const u of a.slice(-80)){const f=await u.getBlock(),p={id:u.args.postId.toString(),type:"post",author:u.args.author,content:u.args.content,mediaCID:u.args.mediaCID,timestamp:f.timestamp,superLikes:o.get(u.args.postId.toString())||0n,txHash:u.transactionHash};l.push(p),c.push(p),g.postsById.set(p.id,p)}for(const u of n.slice(-60)){const f=await u.getBlock(),p={id:u.args.postId.toString(),type:"reply",parentId:u.args.parentId.toString(),author:u.args.author,content:u.args.content,mediaCID:u.args.mediaCID,tipBkc:u.args.tipBkc,timestamp:f.timestamp,superLikes:o.get(u.args.postId.toString())||0n,txHash:u.transactionHash};l.push(p),g.postsById.set(p.id,p);const b=p.parentId;g.replies.has(b)||g.replies.set(b,[]),g.replies.get(b).push(p),g.replyCountMap.set(b,(g.replyCountMap.get(b)||0)+1)}for(const u of i.slice(-30)){const f=await u.getBlock(),p={id:u.args.newPostId.toString(),type:"repost",originalPostId:u.args.originalPostId.toString(),author:u.args.reposter,timestamp:f.timestamp,txHash:u.transactionHash};l.push(p),c.push(p),g.postsById.set(p.id,p);const b=p.originalPostId;g.repostCountMap.set(b,(g.repostCountMap.get(b)||0)+1)}c.sort((u,f)=>f.timestamp-u.timestamp),g.posts=c,g.allItems=l,g.trendingPosts=[...l].filter(u=>u.type!=="repost"&&u.superLikes>0n).sort((u,f)=>{const p=BigInt(u.superLikes||0),b=BigInt(f.superLikes||0);return b>p?1:b<p?-1:0})}catch(e){console.error("Failed to load posts:",e),g.error=e.message}finally{g.isLoading=!1,ie()}}async function tx(){var r;const e=document.getElementById("bc-compose-input"),t=(r=e==null?void 0:e.value)==null?void 0:r.trim();if(!t){h("Please write something","error");return}if(t.length>bt){h(`Post too long (max ${bt} chars)`,"error");return}g.isPosting=!0,ie();let a="";if(g.pendingImage)try{g.isUploadingImage=!0,ie(),a=(await mx(g.pendingImage)).ipfsHash||""}catch(s){h("Image upload failed: "+s.message,"error"),g.isPosting=!1,g.isUploadingImage=!1,ie();return}finally{g.isUploadingImage=!1}const n=t,i=document.getElementById("bc-post-btn");await ke.createPost({content:n,mediaCID:a,operator:ot(),button:i,onSuccess:async()=>{e&&(e.value=""),g.pendingImage=null,g.pendingImagePreview=null,g.isPosting=!1,h("Post created!","success"),await ra()},onError:s=>{g.isPosting=!1,ie()}}),g.isPosting=!1,ie()}async function ax(e){var i;const t=document.getElementById("bc-reply-input"),a=(i=t==null?void 0:t.value)==null?void 0:i.trim();if(!a){h("Please write a reply","error");return}const n=document.getElementById("bc-reply-btn");await ke.createReply({parentId:e,content:a,mediaCID:"",tipBkc:0,operator:ot(),button:n,onSuccess:async()=>{t&&(t.value=""),h("Reply posted!","success"),await ra(),ie()}})}async function nx(e){const t=document.getElementById("bc-repost-confirm-btn");await ke.createRepost({originalPostId:e,tipBkc:0,operator:ot(),button:t,onSuccess:async()=>{kt("repost"),h("Reposted!","success"),await ra()}})}async function ix(e){var a;const t=(a=d.userAddress)==null?void 0:a.toLowerCase();t&&(g.likesMap.has(e)||g.likesMap.set(e,new Set),g.likesMap.get(e).add(t),ie()),await ke.like({postId:e,tipBkc:0,operator:ot(),onSuccess:()=>{h("Liked!","success")},onError:()=>{var n;(n=g.likesMap.get(e))==null||n.delete(t),ie()}})}async function rx(e,t){const a=Lt.parseEther(t);await ke.superLike({postId:e,ethAmount:a,tipBkc:0,operator:ot(),onSuccess:async()=>{h("Super Liked!","success"),await ra()}})}async function sx(e){await ke.follow({toFollow:e,tipBkc:0,operator:ot(),onSuccess:()=>{g.following.add(e.toLowerCase()),h("Followed!","success"),ie()}})}async function ox(e){await ke.unfollow({toUnfollow:e,onSuccess:()=>{g.following.delete(e.toLowerCase()),h("Unfollowed","success"),ie()}})}async function lx(){if(g.pendingEth===0n){h("No earnings to withdraw","warning");return}await ke.withdraw({onSuccess:()=>{h(`Withdrawn ${it(g.pendingEth)} ETH!`,"success"),g.pendingEth=0n,ie()}})}async function cx(){const e=document.getElementById("bc-wizard-confirm-btn");await ke.createProfile({username:g.wizUsername,displayName:g.wizDisplayName,bio:g.wizBio,operator:ot(),button:e,onSuccess:async()=>{h("Profile created!","success"),g.hasProfile=!0,g.userProfile={username:g.wizUsername,displayName:g.wizDisplayName,bio:g.wizBio,address:d.userAddress},g.profiles.set(d.userAddress.toLowerCase(),{username:g.wizUsername,displayName:g.wizDisplayName,bio:g.wizBio}),g.wizStep=1,g.wizUsername="",g.wizDisplayName="",g.wizBio="",g.view="profile",g.activeTab="profile",mt()}})}async function dx(){var n,i,r,s;const e=((i=(n=document.getElementById("edit-displayname"))==null?void 0:n.value)==null?void 0:i.trim())||"",t=((s=(r=document.getElementById("edit-bio"))==null?void 0:r.value)==null?void 0:s.trim())||"",a=document.getElementById("bc-edit-profile-btn");await ke.updateProfile({displayName:e,bio:t,button:a,onSuccess:()=>{g.userProfile.displayName=e,g.userProfile.bio=t,g.profiles.set(d.userAddress.toLowerCase(),{...g.profiles.get(d.userAddress.toLowerCase()),displayName:e,bio:t}),kt("edit-profile"),h("Profile updated!","success"),ie()}})}async function ux(){await ke.obtainBadge({operator:ot(),onSuccess:()=>{g.hasBadge=!0,kt("badge"),h("Badge obtained!","success"),ie()}})}async function px(e){const t=Lt.parseEther(e);await ke.boostProfile({ethAmount:t,operator:ot(),onSuccess:()=>{g.isBoosted=!0,kt("boost"),h("Profile boosted!","success"),ie()}})}async function mx(e){const t=new FormData;t.append("image",e);const a=new AbortController,n=setTimeout(()=>a.abort(),6e4);try{const i=await fetch("/api/upload-image",{method:"POST",body:t,signal:a.signal});if(clearTimeout(n),!i.ok){const r=await i.json().catch(()=>({}));throw new Error(r.error||`Upload failed (${i.status})`)}return await i.json()}catch(i){throw clearTimeout(n),i}}function fx(e){var n,i;const t=(i=(n=e.target)==null?void 0:n.files)==null?void 0:i[0];if(!t)return;if(t.size>5*1024*1024){h("Image too large. Maximum 5MB.","error");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type)){h("Invalid image type. Use JPG, PNG, GIF, or WebP.","error");return}g.pendingImage=t;const a=new FileReader;a.onload=r=>{g.pendingImagePreview=r.target.result,ie()},a.readAsDataURL(t)}function bx(){g.pendingImage=null,g.pendingImagePreview=null;const e=document.getElementById("bc-image-input");e&&(e.value=""),ie()}let Ws=null;function gx(e){g.wizUsername=e.toLowerCase().replace(/[^a-z0-9_]/g,""),g.wizUsernameOk=null,g.wizFee=null,clearTimeout(Ws);const t=document.getElementById("wiz-username-input");t&&(t.value=g.wizUsername),g.wizUsername.length>=1&&g.wizUsername.length<=15?(g.wizChecking=!0,vi(),Ws=setTimeout(async()=>{try{const[a,n]=await Promise.all([ke.isUsernameAvailable(g.wizUsername),ke.getUsernameFee(g.wizUsername.length)]);g.wizUsernameOk=a,g.wizFee=n.formatted}catch(a){console.warn("Username check failed:",a)}g.wizChecking=!1,vi()},600)):(g.wizChecking=!1,vi())}function vi(){const e=document.getElementById("wiz-username-status");e&&(g.wizChecking?e.innerHTML='<span class="bc-username-checking"><i class="fa-solid fa-spinner fa-spin"></i> Checking...</span>':g.wizUsernameOk===!0?e.innerHTML=`<span class="bc-username-ok"><i class="fa-solid fa-check"></i> Available</span>
                ${g.wizFee&&g.wizFee!=="0.0"?`<span class="bc-username-fee">${g.wizFee} ETH</span>`:'<span class="bc-username-fee">FREE</span>'}`:g.wizUsernameOk===!1?e.innerHTML='<span class="bc-username-taken"><i class="fa-solid fa-xmark"></i> Taken</span>':e.innerHTML="");const t=document.querySelector(".bc-wizard-nav .bc-btn-primary");t&&g.wizStep===1&&(t.disabled=!g.wizUsernameOk)}function xx(){if(["post-detail","user-profile","profile-setup"].includes(g.view)){let t="Post";return g.view==="user-profile"&&(t=Pa(g.selectedProfile)),g.view==="profile-setup"&&(t="Create Profile"),`
            <div class="bc-header">
                <div class="bc-back-header">
                    <button class="bc-back-btn" onclick="BackchatPage.goBack()">
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                    <span class="bc-back-title">${t}</span>
                </div>
            </div>
        `}return`
        <div class="bc-header">
            <div class="bc-header-bar">
                <div class="bc-brand">
                    <img src="assets/backchat.png" alt="Backchat" class="bc-brand-icon" onerror="this.style.display='none'">
                    <span class="bc-brand-name">Backchat</span>
                </div>
                <div class="bc-header-right">
                    ${d.isConnected&&g.pendingEth>0n?`
                        <button class="bc-icon-btn earnings-btn" onclick="BackchatPage.openEarnings()" title="Earnings: ${it(g.pendingEth)} ETH">
                            <i class="fa-solid fa-coins"></i>
                        </button>
                    `:""}
                    <button class="bc-icon-btn" onclick="BackchatPage.refresh()" title="Refresh">
                        <i class="fa-solid fa-arrows-rotate"></i>
                    </button>
                </div>
            </div>
            <div class="bc-nav">
                <button class="bc-nav-item ${g.activeTab==="feed"?"active":""}" onclick="BackchatPage.setTab('feed')">
                    <i class="fa-solid fa-house"></i> Feed
                </button>
                <button class="bc-nav-item ${g.activeTab==="trending"?"active":""}" onclick="BackchatPage.setTab('trending')">
                    <i class="fa-solid fa-fire"></i> Trending
                </button>
                <button class="bc-nav-item ${g.activeTab==="profile"?"active":""}" onclick="BackchatPage.setTab('profile')">
                    <i class="fa-solid fa-user"></i> Profile
                </button>
            </div>
        </div>
    `}function Gs(){var a;if(!d.isConnected)return"";const e=it(g.fees.post);return`
        ${!g.hasProfile&&d.isConnected?`
        <div class="bc-profile-create-banner">
            <p>Create your profile to get a username and bio</p>
            <button class="bc-btn bc-btn-primary" onclick="BackchatPage.openProfileSetup()">
                <i class="fa-solid fa-user-plus"></i> Create Profile
            </button>
        </div>`:""}
        <div class="bc-compose">
            <div class="bc-compose-row">
                <div class="bc-compose-avatar">
                    ${(a=g.userProfile)!=null&&a.username?g.userProfile.username.charAt(0).toUpperCase():qn(d.userAddress)}
                </div>
                <div class="bc-compose-body">
                    <textarea
                        id="bc-compose-input"
                        class="bc-compose-textarea"
                        placeholder="What's happening on-chain?"
                        maxlength="${bt}"
                        oninput="BackchatPage._updateCharCount(this)"
                    ></textarea>
                    ${g.pendingImagePreview?`
                        <div class="bc-image-preview">
                            <img src="${g.pendingImagePreview}" alt="Preview">
                            <button class="bc-image-remove" onclick="BackchatPage.removeImage()"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                    `:""}
                    ${g.isUploadingImage?'<div class="bc-uploading-badge"><i class="fa-solid fa-spinner fa-spin"></i> Uploading image...</div>':""}
                </div>
            </div>
            <div class="bc-compose-divider"></div>
            <div class="bc-compose-bottom">
                <div class="bc-compose-tools">
                    <button class="bc-compose-tool" title="Add image" onclick="document.getElementById('bc-image-input').click()">
                        <i class="fa-solid fa-image"></i>
                    </button>
                    <input type="file" id="bc-image-input" hidden accept="image/jpeg,image/png,image/gif,image/webp" onchange="BackchatPage.handleImageSelect(event)">
                </div>
                <div class="bc-compose-right">
                    <span class="bc-char-count" id="bc-char-counter">0/${bt}</span>
                    <span class="bc-compose-fee">${e} ETH</span>
                    <button id="bc-post-btn" class="bc-post-btn" onclick="BackchatPage.createPost()" ${g.isPosting?"disabled":""}>
                        ${g.isPosting?'<i class="fa-solid fa-spinner fa-spin"></i> Posting':"Post"}
                    </button>
                </div>
            </div>
        </div>
    `}function Dt(e,t=0,a={}){var b,m,x,y;if(e.type==="repost"&&!a.isRepostContent){const C=g.postsById.get(e.originalPostId);return`
            <div class="bc-post" data-post-id="${e.id}" style="animation-delay:${Math.min(t*.04,.4)}s">
                <div class="bc-repost-banner">
                    <i class="fa-solid fa-retweet"></i>
                    <span>${Pa(e.author)} reposted</span>
                </div>
                ${C?Dt(C,t,{isRepostContent:!0,noAnimation:!0}):`
                    <div class="bc-post-body" style="padding:16px 20px;color:var(--bc-text-3);">Original post not found</div>
                `}
            </div>
        `}const n=Pa(e.author),i=Xg(e.author),r=Jg(e.author),s=Zg(e.author),o=it(e.superLikes),l=g.replyCountMap.get(e.id)||0,c=g.repostCountMap.get(e.id)||0,u=((b=g.likesMap.get(e.id))==null?void 0:b.size)||0,f=((x=g.likesMap.get(e.id))==null?void 0:x.has((m=d.userAddress)==null?void 0:m.toLowerCase()))||!1,p=a.noAnimation?"":`style="animation-delay:${Math.min(t*.04,.4)}s"`;return`
        <div class="bc-post" data-post-id="${e.id}" ${p} onclick="BackchatPage.viewPost('${e.id}')">
            <div class="bc-post-top">
                <div class="bc-avatar ${r?"boosted":""}" onclick="event.stopPropagation(); BackchatPage.viewProfile('${e.author}')">
                    ${i?i.charAt(0).toUpperCase():qn(e.author)}
                </div>
                <div class="bc-post-head">
                    <div class="bc-post-author-row">
                        <span class="bc-author-name" onclick="event.stopPropagation(); BackchatPage.viewProfile('${e.author}')">${n}</span>
                        ${s?'<i class="fa-solid fa-circle-check bc-verified-icon" title="Verified"></i>':""}
                        ${i?`<span class="bc-post-time">@${i}</span>`:""}
                        <span class="bc-post-time">&middot; ${qg(e.timestamp)}</span>
                        ${e.superLikes>0n?`<span class="bc-trending-tag"><i class="fa-solid fa-bolt"></i> ${o}</span>`:""}
                    </div>
                    ${e.type==="reply"?`<div class="bc-post-context">Replying to ${Pa((y=g.postsById.get(e.parentId))==null?void 0:y.author)}</div>`:""}
                </div>
            </div>

            ${e.content?`<div class="bc-post-body">${He(e.content)}</div>`:""}

            ${e.mediaCID?`
                <div class="bc-post-media">
                    <img src="${Yg}${e.mediaCID}" alt="Media" loading="lazy" onerror="this.style.display='none'">
                </div>
            `:""}

            <div class="bc-actions" onclick="event.stopPropagation()">
                <button class="bc-action act-reply" onclick="BackchatPage.openReply('${e.id}')" title="Reply">
                    <i class="fa-regular fa-comment"></i>
                    ${l>0?`<span class="count">${l}</span>`:""}
                </button>
                <button class="bc-action act-repost" onclick="BackchatPage.openRepostConfirm('${e.id}')" title="Repost">
                    <i class="fa-solid fa-retweet"></i>
                    ${c>0?`<span class="count">${c}</span>`:""}
                </button>
                <button class="bc-action act-like ${f?"liked":""}" onclick="BackchatPage.like('${e.id}')" title="Like">
                    <i class="${f?"fa-solid":"fa-regular"} fa-heart"></i>
                    ${u>0?`<span class="count">${u}</span>`:""}
                </button>
                <button class="bc-action act-super" onclick="BackchatPage.openSuperLike('${e.id}')" title="Super Like">
                    <i class="fa-solid fa-star"></i>
                </button>
            </div>
        </div>
    `}function Ks(){return g.contractAvailable?g.isLoading?`
            <div class="bc-loading">
                <div class="bc-spinner"></div>
                <span class="bc-loading-text">Loading feed...</span>
            </div>
        `:g.posts.length===0?`
            <div class="bc-empty">
                <div class="bc-empty-glyph">
                    <i class="fa-regular fa-comment-dots"></i>
                </div>
                <div class="bc-empty-title">No posts yet</div>
                <div class="bc-empty-text">Be the first to post on the unstoppable social network!</div>
            </div>
        `:g.posts.map((e,t)=>Dt(e,t)).join(""):`
            <div class="bc-empty">
                <div class="bc-empty-glyph accent">
                    <i class="fa-solid fa-rocket"></i>
                </div>
                <div class="bc-empty-title">Coming Soon!</div>
                <div class="bc-empty-text">
                    ${g.error||"Backchat is being deployed. The unstoppable social network will be live soon!"}
                </div>
                <button class="bc-btn bc-btn-outline" style="margin-top:24px;" onclick="BackchatPage.refresh()">
                    <i class="fa-solid fa-arrows-rotate"></i> Retry
                </button>
            </div>
        `}function hx(){return g.trendingPosts.length===0?`
            <div class="bc-empty">
                <div class="bc-empty-glyph accent">
                    <i class="fa-solid fa-fire"></i>
                </div>
                <div class="bc-empty-title">No trending posts</div>
                <div class="bc-empty-text">Super Like posts to make them trend! Ranking is 100% organic, based on ETH spent.</div>
            </div>
        `:`
        <div class="bc-trending-header">
            <h2><i class="fa-solid fa-fire"></i> Trending</h2>
            <p>Ranked by Super Like value â€” pure organic discovery</p>
        </div>
        ${g.trendingPosts.map((e,t)=>Dt(e,t)).join("")}
    `}function vx(){var s,o,l,c,u,f;if(!d.isConnected)return`
            <div class="bc-empty">
                <div class="bc-empty-glyph"><i class="fa-solid fa-wallet"></i></div>
                <div class="bc-empty-title">Connect Wallet</div>
                <div class="bc-empty-text">Connect your wallet to view your profile and manage earnings.</div>
                <button class="bc-btn bc-btn-primary" style="margin-top:24px;" onclick="window.openConnectModal && window.openConnectModal()">
                    <i class="fa-solid fa-wallet"></i> Connect Wallet
                </button>
            </div>
        `;const e=(s=d.userAddress)==null?void 0:s.toLowerCase(),t=g.allItems.filter(p=>{var b;return((b=p.author)==null?void 0:b.toLowerCase())===e&&p.type!=="repost"}),a=g.followers.size,n=g.following.size,i=((o=g.userProfile)==null?void 0:o.displayName)||((l=g.userProfile)==null?void 0:l.username)||Ua(d.userAddress),r=(c=g.userProfile)!=null&&c.username?g.userProfile.username.charAt(0).toUpperCase():qn(d.userAddress);return`
        <div class="bc-profile-section">
            <div class="bc-profile-banner"></div>
            <div class="bc-profile-main">
                <div class="bc-profile-top-row">
                    <div class="bc-profile-pic ${g.isBoosted?"boosted":""}">${r}</div>
                    <div class="bc-profile-actions">
                        ${g.hasProfile?`
                            <button class="bc-btn bc-btn-outline" onclick="BackchatPage.openEditProfile()">
                                <i class="fa-solid fa-pen"></i> Edit
                            </button>
                        `:`
                            <button class="bc-btn bc-btn-primary" onclick="BackchatPage.openProfileSetup()">
                                <i class="fa-solid fa-user-plus"></i> Create Profile
                            </button>
                        `}
                        ${g.hasBadge?"":'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.openBadge()"><i class="fa-solid fa-circle-check"></i> Badge</button>'}
                        ${g.isBoosted?"":'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.openBoost()"><i class="fa-solid fa-rocket"></i> Boost</button>'}
                    </div>
                </div>

                <div class="bc-profile-name-row">
                    <span class="bc-profile-name">${He(i)}</span>
                    ${g.hasBadge?'<i class="fa-solid fa-circle-check bc-profile-badge"></i>':""}
                    ${g.isBoosted?'<span class="bc-boosted-tag"><i class="fa-solid fa-rocket"></i> Boosted</span>':""}
                </div>
                ${(u=g.userProfile)!=null&&u.username?`<div class="bc-profile-username">@${g.userProfile.username}</div>`:""}
                ${(f=g.userProfile)!=null&&f.bio?`<div class="bc-profile-bio">${He(g.userProfile.bio)}</div>`:""}

                <div class="bc-profile-handle">
                    <a href="${Xd}${d.userAddress}" target="_blank" rel="noopener">
                        View on Explorer <i class="fa-solid fa-arrow-up-right-from-square"></i>
                    </a>
                </div>

                <div class="bc-profile-stats">
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${t.length}</div>
                        <div class="bc-stat-label">Posts</div>
                    </div>
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${a}</div>
                        <div class="bc-stat-label">Followers</div>
                    </div>
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${n}</div>
                        <div class="bc-stat-label">Following</div>
                    </div>
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${it(g.pendingEth)}</div>
                        <div class="bc-stat-label">Earned</div>
                    </div>
                </div>
            </div>

            ${g.pendingEth>0n?`
                <div class="bc-earnings-card">
                    <div class="bc-earnings-header"><i class="fa-solid fa-coins"></i> Pending Earnings</div>
                    <div class="bc-earnings-value">${it(g.pendingEth)} <small>ETH</small></div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:16px;" onclick="BackchatPage.withdraw()">
                        <i class="fa-solid fa-wallet"></i> Withdraw Earnings
                    </button>
                </div>
            `:""}

            ${wx()}

            <div class="bc-section-head">
                <span class="bc-section-title"><i class="fa-solid fa-clock-rotate-left"></i> Your Posts</span>
                <span class="bc-section-subtitle">${t.length} total</span>
            </div>

            ${t.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No posts yet â€” share your first thought!</div></div>':t.map((p,b)=>Dt(p,b)).join("")}
        </div>
    `}function wx(){var n,i;if(!d.isConnected)return"";const e=`${window.location.origin}/#backchat?ref=${d.userAddress}`,t=((n=g.referralStats)==null?void 0:n.totalReferred)||0,a=((i=g.referralStats)==null?void 0:i.totalEarnedFormatted)||"0.0";return`
        <div class="bc-referral-card">
            <div class="bc-referral-header">
                <i class="fa-solid fa-link"></i> Viral Referral
            </div>
            <div class="bc-referral-link-box">
                <span class="bc-referral-link-text" id="referral-link-text">${e}</span>
                <button onclick="BackchatPage.copyReferralLink()">
                    <i class="fa-solid fa-copy"></i> Copy
                </button>
            </div>
            <div class="bc-referral-stats-row">
                <div class="bc-referral-stat">
                    <div class="bc-referral-stat-value">${t}</div>
                    <div class="bc-referral-stat-label">Referred</div>
                </div>
                <div class="bc-referral-stat">
                    <div class="bc-referral-stat-value">${a}</div>
                    <div class="bc-referral-stat-label">ETH Earned</div>
                </div>
            </div>
            <button class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="BackchatPage.shareReferral()">
                <i class="fa-solid fa-share-nodes"></i> Share Referral Link
            </button>
            <div class="bc-referral-info" style="margin-top:12px;">
                Earn 30% of all fees from users who join through your link.
                ${g.referredBy?`<br>You were referred by <code style="font-size:11px;color:var(--bc-accent);">${Ua(g.referredBy)}</code>`:""}
            </div>
        </div>
    `}function ie(){const e=document.getElementById("backchat-content");if(!e)return;let t="";switch(g.view){case"feed":t=Gs()+Ks();break;case"trending":t=hx();break;case"profile":t=!g.hasProfile&&d.isConnected?Ys():vx();break;case"post-detail":t=yx();break;case"user-profile":t=kx();break;case"profile-setup":t=Ys();break;default:t=Gs()+Ks()}e.innerHTML=t}function yx(){const e=g.selectedPost?g.postsById.get(g.selectedPost):null;if(!e)return'<div class="bc-empty"><div class="bc-empty-title">Post not found</div></div>';const t=g.replies.get(e.id)||[];t.sort((n,i)=>n.timestamp-i.timestamp);const a=Pa(e.author);return`
        <div class="bc-thread-parent">
            ${Dt(e,0,{noAnimation:!0})}
        </div>
        <div class="bc-thread-divider">
            Replies ${t.length>0?`(${t.length})`:""}
        </div>
        ${t.length===0?`
            <div class="bc-empty" style="padding:40px 20px;">
                <div class="bc-empty-text">No replies yet. Be the first!</div>
            </div>
        `:t.map((n,i)=>`
            <div class="bc-thread-reply">
                ${Dt(n,i,{noAnimation:!0})}
            </div>
        `).join("")}
        ${d.isConnected?`
            <div class="bc-reply-compose">
                <div class="bc-reply-label">Replying to ${a}</div>
                <div class="bc-reply-row">
                    <textarea id="bc-reply-input" class="bc-reply-input" placeholder="Write a reply..." maxlength="${bt}"></textarea>
                    <button id="bc-reply-btn" class="bc-btn bc-btn-primary bc-reply-send" onclick="BackchatPage.submitReply('${e.id}')">
                        Reply
                    </button>
                </div>
                <div style="font-size:11px;color:var(--bc-text-3);margin-top:6px;">Fee: ${it(g.fees.reply)} ETH</div>
            </div>
        `:""}
    `}function kx(){var f;const e=g.selectedProfile;if(!e)return'<div class="bc-empty"><div class="bc-empty-title">User not found</div></div>';const t=e.toLowerCase(),a=g.profiles.get(t),n=(a==null?void 0:a.displayName)||(a==null?void 0:a.username)||Ua(e),i=a==null?void 0:a.username,r=a==null?void 0:a.bio,s=i?i.charAt(0).toUpperCase():qn(e),o=t===((f=d.userAddress)==null?void 0:f.toLowerCase()),l=g.following.has(t),c=g.followCounts.get(t)||{followers:0,following:0},u=g.allItems.filter(p=>{var b;return((b=p.author)==null?void 0:b.toLowerCase())===t&&p.type!=="repost"});return`
        <div class="bc-profile-section">
            <div class="bc-profile-banner"></div>
            <div class="bc-profile-main">
                <div class="bc-profile-top-row">
                    <div class="bc-profile-pic">${s}</div>
                    <div class="bc-profile-actions">
                        ${!o&&d.isConnected?`
                            <button class="bc-follow-toggle ${l?"do-unfollow":"do-follow"}"
                                onclick="BackchatPage.${l?"unfollow":"follow"}('${e}')">
                                ${l?"Following":"Follow"}
                            </button>
                        `:""}
                    </div>
                </div>

                <div class="bc-profile-name-row">
                    <span class="bc-profile-name">${He(n)}</span>
                </div>
                ${i?`<div class="bc-profile-username">@${i}</div>`:""}
                ${r?`<div class="bc-profile-bio">${He(r)}</div>`:""}

                <div class="bc-profile-handle">
                    <a href="${Xd}${e}" target="_blank" rel="noopener">
                        ${Ua(e)} <i class="fa-solid fa-arrow-up-right-from-square"></i>
                    </a>
                </div>

                <div class="bc-profile-stats">
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${u.length}</div>
                        <div class="bc-stat-label">Posts</div>
                    </div>
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${c.followers}</div>
                        <div class="bc-stat-label">Followers</div>
                    </div>
                    <div class="bc-stat-cell">
                        <div class="bc-stat-value">${c.following}</div>
                        <div class="bc-stat-label">Following</div>
                    </div>
                </div>
            </div>

            <div class="bc-section-head">
                <span class="bc-section-title"><i class="fa-solid fa-clock-rotate-left"></i> Posts</span>
                <span class="bc-section-subtitle">${u.length}</span>
            </div>
            ${u.length===0?'<div class="bc-empty" style="padding:40px 20px;"><div class="bc-empty-text">No posts yet</div></div>':u.sort((p,b)=>b.timestamp-p.timestamp).map((p,b)=>Dt(p,b)).join("")}
        </div>
    `}function Ys(){if(!d.isConnected)return`
            <div class="bc-empty">
                <div class="bc-empty-glyph"><i class="fa-solid fa-wallet"></i></div>
                <div class="bc-empty-title">Connect Wallet</div>
                <div class="bc-empty-text">Connect your wallet to create your profile.</div>
            </div>
        `;const e=g.wizStep;return`
        <div class="bc-wizard">
            <div class="bc-wizard-title">Create Your Profile</div>
            <div class="bc-wizard-desc">Set up your on-chain identity in ${e===3?"one last step":"a few steps"}</div>

            <div class="bc-wizard-dots">
                <div class="bc-wizard-dot ${e===1?"active":e>1?"done":""}"></div>
                <div class="bc-wizard-dot ${e===2?"active":e>2?"done":""}"></div>
                <div class="bc-wizard-dot ${e===3?"active":""}"></div>
            </div>

            <div class="bc-wizard-card">
                ${e===1?`
                    <div class="bc-field">
                        <label class="bc-label">Choose a Username</label>
                        <input type="text" id="wiz-username-input" class="bc-input" placeholder="e.g. satoshi"
                            value="${g.wizUsername}" maxlength="15"
                            oninput="BackchatPage.onWizUsernameInput(this.value)">
                        <div id="wiz-username-status" class="bc-username-row"></div>
                        <div style="font-size:12px;color:var(--bc-text-3);margin-top:8px;">1-15 chars: lowercase letters, numbers, underscores. Shorter usernames cost more ETH.</div>
                    </div>
                `:e===2?`
                    <div class="bc-field">
                        <label class="bc-label">Display Name</label>
                        <input type="text" id="wiz-displayname-input" class="bc-input" placeholder="Your public name" value="${He(g.wizDisplayName)}" maxlength="30"
                            oninput="BackchatPage._wizSave()">
                    </div>
                    <div class="bc-field">
                        <label class="bc-label">Bio</label>
                        <textarea id="wiz-bio-input" class="bc-input" placeholder="Tell the world about yourself..." maxlength="160" rows="3"
                            oninput="BackchatPage._wizSave()" style="resize:none;">${He(g.wizBio)}</textarea>
                    </div>
                `:`
                    <div style="text-align:center;">
                        <div style="font-size:48px; margin-bottom:16px;">${g.wizUsername.charAt(0).toUpperCase()}</div>
                        <div style="font-size:18px; font-weight:700; color:var(--bc-text);">@${g.wizUsername}</div>
                        ${g.wizDisplayName?`<div style="font-size:14px; color:var(--bc-text-2); margin-top:4px;">${He(g.wizDisplayName)}</div>`:""}
                        ${g.wizBio?`<div style="font-size:13px; color:var(--bc-text-3); margin-top:8px;">${He(g.wizBio)}</div>`:""}
                        <div class="bc-fee-row" style="margin-top:20px;">
                            <span class="bc-fee-label">Username Fee</span>
                            <span class="bc-fee-val">${g.wizFee||"0"} ETH</span>
                        </div>
                    </div>
                `}
            </div>

            <div class="bc-wizard-nav">
                ${e>1?'<button class="bc-btn bc-btn-outline" onclick="BackchatPage.wizBack()"><i class="fa-solid fa-arrow-left"></i> Back</button>':""}
                ${e<3?`
                    <button class="bc-btn bc-btn-primary" onclick="BackchatPage.wizNext()"
                        ${e===1&&!g.wizUsernameOk?"disabled":""}>
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                `:`
                    <button id="bc-wizard-confirm-btn" class="bc-btn bc-btn-primary" onclick="BackchatPage.wizConfirm()">
                        <i class="fa-solid fa-check"></i> Create Profile
                    </button>
                `}
            </div>
        </div>
    `}function Ex(){var e,t;return`
        <!-- Super Like Modal -->
        <div class="bc-modal-overlay" id="modal-superlike">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-star" style="color:var(--bc-accent)"></i> Super Like</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('superlike')">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">
                        Super Likes boost posts to trending. The more ETH you contribute, the higher it ranks â€” a fully organic discovery system.
                    </p>
                    <div class="bc-field">
                        <label class="bc-label">Amount (ETH)</label>
                        <input type="number" id="superlike-amount" class="bc-input" value="0.001" min="0.0001" step="0.0001">
                    </div>
                    <div class="bc-fee-row">
                        <span class="bc-fee-label">Minimum</span>
                        <span class="bc-fee-val">0.0001 ETH</span>
                    </div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="BackchatPage.confirmSuperLike()">
                        <i class="fa-solid fa-star"></i> Super Like
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Badge Modal -->
        <div class="bc-modal-overlay" id="modal-badge">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-circle-check" style="color:var(--bc-accent)"></i> Trust Badge</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('badge')">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">
                        Get a verified trust badge for 1 year. Show the community you're a committed, trusted member.
                    </p>
                    <div class="bc-fee-row">
                        <span class="bc-fee-label">Badge Fee</span>
                        <span class="bc-fee-val">${it(g.fees.badge)} ETH</span>
                    </div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="BackchatPage.confirmBadge()">
                        <i class="fa-solid fa-circle-check"></i> Get Badge (1 Year)
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Boost Modal -->
        <div class="bc-modal-overlay" id="modal-boost">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-rocket" style="color:var(--bc-accent)"></i> Profile Boost</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('boost')">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">
                        Boost your profile visibility for increased exposure. Each 0.0005 ETH gives you 1 day of boost.
                    </p>
                    <div class="bc-field">
                        <label class="bc-label">Amount (ETH)</label>
                        <input type="number" id="boost-amount" class="bc-input" value="0.001" min="0.0005" step="0.0005">
                    </div>
                    <div class="bc-fee-row">
                        <span class="bc-fee-label">Minimum</span>
                        <span class="bc-fee-val">0.0005 ETH (1 day)</span>
                    </div>
                    <button class="bc-btn bc-btn-primary" style="width:100%;margin-top:20px;justify-content:center;" onclick="BackchatPage.confirmBoost()">
                        <i class="fa-solid fa-rocket"></i> Boost Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Repost Confirm Modal -->
        <div class="bc-modal-overlay" id="modal-repost">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-retweet" style="color:var(--bc-green)"></i> Repost</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('repost')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <p class="bc-modal-desc">Repost this to your followers? Fee: ${it(g.fees.repost)} ETH</p>
                    <button id="bc-repost-confirm-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="BackchatPage.confirmRepost()">
                        <i class="fa-solid fa-retweet"></i> Repost
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div class="bc-modal-overlay" id="modal-edit-profile">
            <div class="bc-modal-box">
                <div class="bc-modal-top">
                    <span class="bc-modal-title"><i class="fa-solid fa-pen" style="color:var(--bc-accent)"></i> Edit Profile</span>
                    <button class="bc-modal-x" onclick="BackchatPage.closeModal('edit-profile')"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="bc-modal-inner">
                    <div class="bc-field">
                        <label class="bc-label">Display Name</label>
                        <input type="text" id="edit-displayname" class="bc-input" value="${He(((e=g.userProfile)==null?void 0:e.displayName)||"")}" maxlength="30" placeholder="Your display name">
                    </div>
                    <div class="bc-field">
                        <label class="bc-label">Bio</label>
                        <textarea id="edit-bio" class="bc-input" maxlength="160" rows="3" placeholder="About you..." style="resize:none;">${He(((t=g.userProfile)==null?void 0:t.bio)||"")}</textarea>
                    </div>
                    <p style="font-size:12px;color:var(--bc-text-3);margin-bottom:16px;">Username cannot be changed. Only gas fee applies.</p>
                    <button id="bc-edit-profile-btn" class="bc-btn bc-btn-primary" style="width:100%;justify-content:center;" onclick="BackchatPage.confirmEditProfile()">
                        <i class="fa-solid fa-check"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    `}function mt(){Vg();const e=document.getElementById("backchat");e&&(e.innerHTML=`
        <div class="bc-shell">
            ${xx()}
            <div id="backchat-content"></div>
        </div>
        ${Ex()}
    `,ie())}let Xn=null;function Tx(e){var t;Xn=e,(t=document.getElementById("modal-superlike"))==null||t.classList.add("active")}async function Cx(){var t;const e=((t=document.getElementById("superlike-amount"))==null?void 0:t.value)||"0.001";kt("superlike"),await rx(Xn,e)}function Ix(){var e;(e=document.getElementById("modal-badge"))==null||e.classList.add("active")}async function Ax(){kt("badge"),await ux()}function Bx(){var e;(e=document.getElementById("modal-boost"))==null||e.classList.add("active")}async function zx(){var t;const e=((t=document.getElementById("boost-amount"))==null?void 0:t.value)||"0.001";kt("boost"),await px(e)}function Px(e){var t;Xn=e,(t=document.getElementById("modal-repost"))==null||t.classList.add("active")}async function Nx(){await nx(Xn)}function $x(){var e;mt(),(e=document.getElementById("modal-edit-profile"))==null||e.classList.add("active")}async function Sx(){await dx()}function kt(e){var t;(t=document.getElementById(`modal-${e}`))==null||t.classList.remove("active")}function Lx(e){const t=document.getElementById("bc-char-counter");if(!t)return;const a=e.value.length;t.textContent=`${a}/${bt}`,t.className="bc-char-count",a>bt-50?t.classList.add("danger"):a>bt-150&&t.classList.add("warn")}const Zd={async render(e){e&&(mt(),await Promise.all([Os(),Hs(),Us(),ra(),js()]))},async refresh(){await Promise.all([Os(),Hs(),Us(),ra(),js()])},setTab(e){g.activeTab=e,g.view=e,mt()},goBack:Qg,viewPost(e){bn("post-detail",{post:e})},viewProfile(e){var t;(e==null?void 0:e.toLowerCase())===((t=d.userAddress)==null?void 0:t.toLowerCase())?(g.activeTab="profile",g.view="profile",mt()):bn("user-profile",{profile:e})},openReply(e){bn("post-detail",{post:e})},openProfileSetup(){g.wizStep=1,g.wizUsername="",g.wizDisplayName="",g.wizBio="",g.wizUsernameOk=null,g.wizFee=null,bn("profile-setup")},createPost:tx,submitReply:ax,like:ix,follow:sx,unfollow:ox,withdraw:lx,openSuperLike:Tx,confirmSuperLike:Cx,openRepostConfirm:Px,confirmRepost:Nx,openBadge:Ix,confirmBadge:Ax,openBoost:Bx,confirmBoost:zx,openEditProfile:$x,confirmEditProfile:Sx,closeModal:kt,openEarnings(){g.activeTab="profile",g.view="profile",mt()},handleImageSelect:fx,removeImage:bx,onWizUsernameInput:gx,wizNext(){var e,t,a,n;g.wizStep===1&&!g.wizUsernameOk||(g.wizStep===1?g.wizStep=2:g.wizStep===2&&(g.wizDisplayName=((t=(e=document.getElementById("wiz-displayname-input"))==null?void 0:e.value)==null?void 0:t.trim())||"",g.wizBio=((n=(a=document.getElementById("wiz-bio-input"))==null?void 0:a.value)==null?void 0:n.trim())||"",g.wizStep=3),ie())},wizBack(){var e,t,a,n;g.wizStep>1&&(g.wizStep===2&&(g.wizDisplayName=((t=(e=document.getElementById("wiz-displayname-input"))==null?void 0:e.value)==null?void 0:t.trim())||"",g.wizBio=((n=(a=document.getElementById("wiz-bio-input"))==null?void 0:a.value)==null?void 0:n.trim())||""),g.wizStep--,ie())},wizConfirm:cx,_wizSave(){},_updateCharCount:Lx,copyReferralLink(){const e=`${window.location.origin}/#backchat?ref=${d.userAddress}`;navigator.clipboard.writeText(e).then(()=>h("Referral link copied!","success"),()=>h("Failed to copy","error"))},shareReferral(){const e=`${window.location.origin}/#backchat?ref=${d.userAddress}`,t="Join Backchat â€” earn crypto by posting, liking, and referring friends! 30% referral rewards.";navigator.share?navigator.share({title:"Backchat Referral",text:t,url:e}).catch(()=>{}):navigator.clipboard.writeText(`${t}
${e}`).then(()=>h("Referral message copied!","success"),()=>h("Failed to copy","error"))}};window.BackchatPage=Zd;const Rx=window.inject||(()=>{console.warn("Dev Mode: Analytics disabled.")});if(window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1")try{Rx()}catch(e){console.error("Analytics Error:",e)}const Or="".toLowerCase();window.__ADMIN_WALLET__=Or;Or&&console.log("âœ… Admin access granted");let $t=null,wa=null,wi=!1;const xe={dashboard:Yc,mine:ed,store:Z0,rewards:Cn,actions:Om,charity:qd,backchat:Zd,notary:vd,airdrop:yf,tokenomics:sb,about:Jm,admin:Vf,rental:zd,socials:Qb,creditcard:eg,dex:U,dao:tg,tutorials:$d};function Qd(e){return!e||e.length<42?"...":`${e.slice(0,6)}...${e.slice(-4)}`}function _x(e){if(!e)return"0.00";const t=M(e);return t>=1e9?(t/1e9).toFixed(2)+"B":t>=1e6?(t/1e6).toFixed(2)+"M":t>=1e4?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function ba(e,t=!1){const a=document.querySelector("main > div.container"),n=document.querySelectorAll(".sidebar-link");if(!a){console.error("âŒ Page container not found");return}const i=window.location.hash.includes("/");if(!($t!==e||t||i)){xe[e]&&typeof xe[e].update=="function"&&xe[e].update(d.isConnected);return}console.log(`ðŸ“ Navigating: ${$t} â†’ ${e} (force: ${t})`),wa&&typeof wa=="function"&&(wa(),wa=null),Array.from(a.children).forEach(l=>{l.tagName==="SECTION"&&(l.classList.add("hidden"),l.classList.remove("active"))});const s=document.getElementById("charity-container");s&&e!=="charity"&&(s.innerHTML=""),n.forEach(l=>{l.classList.remove("active"),l.classList.add("text-zinc-400","hover:text-white","hover:bg-zinc-700")});const o=document.getElementById(e);if(o&&xe[e]){o.classList.remove("hidden"),o.classList.add("active");const l=$t!==e;$t=e;const c=document.querySelector(`.sidebar-link[data-target="${e}"]`);c&&(c.classList.remove("text-zinc-400","hover:text-white","hover:bg-zinc-700"),c.classList.add("active")),xe[e]&&typeof xe[e].render=="function"&&xe[e].render(l||t),typeof xe[e].cleanup=="function"&&(wa=xe[e].cleanup),l&&window.scrollTo(0,0)}else e!=="dashboard"&&e!=="faucet"&&(console.warn(`Route '${e}' not found, redirecting to dashboard.`),ba("dashboard",!0))}window.navigateTo=ba;const Vs="wallet-btn text-xs font-mono text-center max-w-fit whitespace-nowrap relative font-bold py-2 px-4 rounded-md transition-colors";function Hr(e=!1){wi||(wi=!0,requestAnimationFrame(()=>{Fx(e),wi=!1}))}function Fx(e){const t=document.getElementById("admin-link-container"),a=document.getElementById("statUserBalance"),n=document.getElementById("connectButtonDesktop"),i=document.getElementById("connectButtonMobile"),r=document.getElementById("mobileAppDisplay");let s=d.userAddress;const o=[n,i];if(d.isConnected&&s){const c=_x(d.currentUserBalance),f=`
            <div class="status-dot"></div>
            <span>${Qd(s)}</span>
            <div class="balance-pill">
                ${c} BKC
            </div>
        `;if(o.forEach(p=>{p&&(p.innerHTML=f,p.className=Vs+" wallet-btn-connected")}),r&&(r.textContent="Backcoin.org",r.classList.add("text-white"),r.classList.remove("text-amber-400")),t){const p=s.toLowerCase()===Or;t.style.display=p?"block":"none"}a&&(a.textContent=c)}else{const c='<i class="fa-solid fa-plug"></i> Connect Wallet';o.forEach(u=>{u&&(u.innerHTML=c,u.className=Vs+" wallet-btn-disconnected")}),r&&(r.textContent="Backcoin.org",r.classList.add("text-amber-400"),r.classList.remove("text-white")),t&&(t.style.display="none"),a&&(a.textContent="--")}const l=$t||"dashboard";e||!$t?ba(l,!0):xe[l]&&typeof xe[l].update=="function"&&xe[l].update(d.isConnected)}function Mx(e){const{isConnected:t,address:a,isNewConnection:n,wasConnected:i}=e,r=n||t!==i;d.isConnected=t,a&&(d.userAddress=a),Hr(r),t&&n?h(`Connected: ${Qd(a)}`,"success"):!t&&i&&h("Wallet disconnected.","info")}function Dx(){const e=document.getElementById("testnet-banner"),t=document.getElementById("close-testnet-banner");if(!(!e||!t)){if(localStorage.getItem("hideTestnetBanner")==="true"){e.remove();return}e.style.transform="translateY(0)",t.addEventListener("click",()=>{e.style.transform="translateY(100%)",setTimeout(()=>e.remove(),500),localStorage.setItem("hideTestnetBanner","true")})}}function Ox(){const e=document.querySelectorAll(".sidebar-link"),t=document.getElementById("menu-btn"),a=document.getElementById("sidebar"),n=document.getElementById("sidebar-backdrop"),i=document.getElementById("connectButtonDesktop"),r=document.getElementById("connectButtonMobile"),s=document.getElementById("shareProjectBtn");Dx(),e.length>0&&e.forEach(l=>{l.addEventListener("click",async c=>{c.preventDefault();const u=l.dataset.target;if(u==="faucet"){h("Accessing Testnet Faucet...","info"),await Qi("BKC")&&Hr(!0);return}u&&(window.location.hash=u,ba(u,!0),a&&a.classList.contains("translate-x-0")&&(a.classList.remove("translate-x-0"),a.classList.add("-translate-x-full"),n&&n.classList.add("hidden")))})});const o=()=>{xo()};i&&i.addEventListener("click",o),r&&r.addEventListener("click",o),s&&s.addEventListener("click",()=>bu(d.userAddress)),t&&a&&n&&(t.addEventListener("click",()=>{a.classList.contains("translate-x-0")?(a.classList.add("-translate-x-full"),a.classList.remove("translate-x-0"),n.classList.add("hidden")):(a.classList.remove("-translate-x-full"),a.classList.add("translate-x-0"),n.classList.remove("hidden"))}),n.addEventListener("click",()=>{a.classList.add("-translate-x-full"),a.classList.remove("translate-x-0"),n.classList.add("hidden")}))}function eu(){const e=window.location.hash.replace("#","");if(!e)return"dashboard";const t=e.split(/[/?]/)[0];return xe[t]?t:"dashboard"}function tu(){try{const e=window.location.hash,t=e.indexOf("?");if(t===-1)return;const n=new URLSearchParams(e.substring(t)).get("ref");n&&/^0x[a-fA-F0-9]{40}$/.test(n)&&(localStorage.getItem("backchain_referrer")||(localStorage.setItem("backchain_referrer",n),console.log("[Referral] Captured referrer from URL:",n)))}catch(e){console.warn("[Referral] Failed to parse referral param:",e.message)}}window.addEventListener("load",async()=>{console.log("ðŸš€ App Initializing..."),_e.earn||(_e.earn=document.getElementById("mine"));try{if(!await ku())throw new Error("Failed to load contract addresses")}catch(a){console.error("âŒ Critical Initialization Error:",a),h("Initialization failed. Please refresh.","error");return}Ox(),await vp(),wp(Mx),gu();const e=document.getElementById("preloader");e&&(e.style.display="none"),tu();const t=eu();console.log("ðŸ“ Initial page from URL:",t,"Hash:",window.location.hash),ba(t,!0),console.log("âœ… App Ready.")});window.addEventListener("hashchange",()=>{tu();const e=eu(),t=window.location.hash;console.log("ðŸ”„ Hash changed to:",e,"Full hash:",t),e!==$t?ba(e,!0):e==="charity"&&xe[e]&&typeof xe[e].render=="function"&&xe[e].render(!0)});window.EarnPage=ed;window.openConnectModal=xo;window.disconnectWallet=yp;window.updateUIState=Hr;export{St as C,X as E,Mp as G,ue as N,Op as T,ee as V,ai as a,ni as b,v as c,ii as d,re as e,Dp as f,er as g,Eo as h,Up as i,jp as j,tt as k,Wp as l,Xt as n,V as r,Hp as s,O as t};
